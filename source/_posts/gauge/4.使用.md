---
uuid: bbaf6f27-c0ab-11ec-92a1-7557b2313227
title: gauge命令
tags: gauge
categories: BDD
abbrlink: a84f6b4b
---

Gauge是一流的命令行工具，这意味着您可以完全从命令行进行操作。或者如果您更喜欢使用IDE，那么Gauge也可以与多个IDE进行良好的集成。

## 命令行接口

Gauge具有良好的命令行支持，安装gauge，列出运行支持的子命令/标志。

> gauge

这个命令行接口是跨平台的。在GNU/[Linux](https://so.csdn.net/so/search?from=pc_blog_highlight&q=Linux)和OSX，你可以使用任意终端，在windows上你可以使用cmd或者Powershell。

### help

由于子命令或者标识是通过版本被添加或者被弃用，所以建议通过gauge它本身来获取参考。

> gauge -v
>
> gauge help

### 创建项目

创建或者初始化项目通过执行

> gauge init <template>

这里的template可以是python,js,java等等，更多细节可以查看官方文档

### 执行测试

在Gauge项目内，您可以通过调用spec的路径来执行测试。按照惯例，spec存储在项目根目录中的./spec/子目录中。
语法是：

> gauge run [flags] <path-to=specs>

Gauge命令行实用程序允许多种方式执行要执行的spec。用于执行测试的有效路径可以是：包含spec的目录路径或者sepc文件路径或者scenarios路径或者三种的混合。

为执行在已有文件夹`specs`内的所有用例，使用:

> gauge run specs/

这将给出一个彩色的控制台输出，其中包括执行细节以及执行摘要。

### 指定场景

可以通过在spec中指定该场景的跨度中的行号来执行spec的单个场景，要执行下列spec中的`Admin Login` 场景，请使用命令`gauge run specs/login_test.spec:4`

~~~markdown
 Configuration
 =============
 
 Admin Login
 -----------
 * User must login as "admin"
 * Navigate to the configuration page
~~~

这仅执行在行号4（即login_test.spec中的`Admin Login`）中存在的场景。在上述spec中，由于跨度，指定行号4-7会执行相同的场景。

也可以选择性的执行多种场景如下：

> gauge run specs/helloworld.spec:4 specs/helloword.spec:7

这些场景也可以属于不同的spec文件。
你也可以指定一个具体的scenario或者scenario列表来执行。要执行scenario，gauge将获取spec文件的路径，后跟冒号和零索引数字（译者注：从0开始的索引）的scenario。

例如：要执行名为`spec1.spec`的spec文件的第二个scenario，你应该执行：

> gauge run specs/spec1.spec:1

要指定多个scenarios，请添加多个这样的参数。例如，要执行名为`spec1.spec`的spec文件的第一和第三个scenario，你应该执行：

> gauge run specs/spec1.spec:0 specs/spec1.spec:2

### 指定目录

你可以指定存储spec文件的一个单独目录，Gauge扫描这个目录，并取出可用的spec文件。
例如：

> gauge run specs/

你也可以指定存储spec文件的多个目录，Gauge扫描所有的目录内可用的spec文件并在一次运行过程中执行它们。
例如：

> gauge run specs-dir1/ specs-dir2/ specs-dir3/

### 指定文件

你可以指定spec文件的路径，在这种情况下，Gauge仅执行提供的spec文件。
例如：要执行一个单独的spec文件：

> gauge run specs/spec1.spec

或者，执行多个spec文件：

> gauge run specs/spec1.spec specs/spec2.spec specs/spec3.spec

### 详细报告

默认情况下，在执行测试中，gauge提供spec级别的报告。您可以使用`--verbose`标志来启用详细的步骤级别报告。例如：

> gauge run --verbose specs/

### 执行中的错误

#### spec文件解析错误

如果spec文件不符合预期的语法或者无法解析参数，则会发生这种情况。
例如：

> [ParseError] hello_world.spec : line no: 25, Dynamic parameter could not be resolved

#### spec文件未实现的步骤

如果spec文件包含未用项目编程语言实现的步骤，则会出现验证错误。必须要为执行的spec中的所有步骤提供适当的底层代码实现。
例如：

> login.spec:33: Step implementation not found. login with “user” and “p@ssword”

#### 启动语言执行插件失败

如果项目中语言特定插件未安装则执行会失败。

### 数据驱动执行

- 在任何步骤前，数据表格以markdown表格格式定义在spec的开头
- 数据表格应该有标题行，且至少有一行数据
- 表格中的标题名称，用在有角括号`<>`的步骤中，用于将数据表中特定列引用为参数
- 一次执行，每个场景都会执行表格中的每一行数据
- 表格很容易的在IDE中被创建，使用模版`table:<no of columns>`，然后点击`Tab`键
- 表格参数以多标记表格格式编写

示例

~~~markdown
Table driven execution
======================

     |id| name    |
     |--|---------|
     |1 |vishnu   |
     |2 |prateek  |
     |3 |navaneeth|

Scenario
--------
* Say "hello" to <name>

Second Scenario
---------------
* Say "namaste" to <name>
~~~

在上面的示例，步骤使用数据表格中的`name`列作为动态参数。
`Scenario`和 `Second Scenario`都会首先执行第一行数据`1,vishnu`，然后连续地执行表格中第二和第三行的值。

#### 执行选中的表格数据行

默认情况下，spec中的场景会针对所有数据表格行运行。可以使用标志`--table-rows`针对选定的数据表行运行，并指定应执行场景的行号。如果有多个行号，则应以逗号分隔。
例如：

> gauge run --table-rows "1" specs/hello.spec
>
> gauge run --table-rows "1,4,7" specs/hello.spec

针对哪些场景运行，也可以指定表格行范围。
例如：

> gauge run --table-rows "1-3" specs/hello.spec

这将针对表格行1，2，3执行场景。

#### 执行标签

标签允许您快速过滤将要执行的spec和场景。执行标有某些标签的所有specs和场景，使用下面的命令：

> gauge run --tags tag1,tag2 spec

或者

> gauge run --tags "tag1, tag2" specs

这仅执行标记有`tag1`和`tag2`的场景和spec。

示例：

~~~markdown
Search Specification
====================
The admin user must be able to search for available projects on the search page.
Tags: search, admin

* User must be logged in as "admin"
* Open the product search page

Successful search
-----------------
Tags: successful

For an existing product name, the search result will contain the product name.

* Search for product "Die Hard"
* "Die Hard" should show up in the search results

Unsuccessful search
-------------------
On an unknown product name search the search results will be empty

* Search for product "unknown"
* The search results will be empty
~~~

在上述spec中，如果想要标记有"search"和"admin"的所有场景被执行，使用下列命令：

> gauge run --tags "search & admin" SPEC_FILE_NAME

#### 标签表达式

标签可以通过表达式被选中，例如：

|          Tags          | Selects specs/scenario that                        |
| :--------------------: | :------------------------------------------------- |
|         !TagA          | do not have TagA                                   |
|      TagA & TagB       | have both TagA and TagB.                           |
|      TagA & !TagB      | have TagA and not TagB.                            |
|      TagA \| TagB      | have either TagA or TagB.                          |
| (TagA & TagB) \| TagC  | have either TagC or both TagA and TagB             |
| !(TagA & TagB) \| TagC | have either TagC or do not have both TagA and TagB |
| (TagA \| TagB) & TagC  | have either [TagA and TagC] or [TagB and TagC]     |

#### 并行执行

可以并行执行spec以更快的运行测试并分发负载。
这可以通过命令完成：

> gauge run --parallel specs
>
> gauge run -p specs

这根据机器的核数量创建多个执行流，并在执行者之间分配负载。
并行执行流数量可以通过`-n`标志指定。
例如：

> gauge run --parallel -n=4 specs

这会创建四个并行执行流。

备注
执行流数量的指定应该是由机器的可用CPU核数量决定，超过此数量可能会导致不良结果。要进行优化，请尝试使用线程并行执行（译者注：下一节）。

#### 使用线程并行执行

在并行执行中，每个执行流会启动一个新的工作者进程。这可以通过使用多线程取代进程来优化。这样进行并行执行只有一个工作进程且启动多个线程。
为使用它，设置`enable_multithreading`环境变量为true。这个属性也可以添加到默认/自定义环境。

> enable_multithreading = true

必要条件：

- 线程安全测试代码
- 语言执行插件应该支持多线程

备注：目前，这个功能只有 Java语言插件支持。

#### 执行一组spec

spec可以分成组，并且`--group`和`-g`标志提供执行特定组的功能。
可以通过下面的命令完成：

> gauge run -n=4 -g=2 specs

上述创建4组（由`-n`标志提供）spec，并且执行第二个（由`-g`提供）组。
spec按照字母顺序排序，然后分成组，保证每个组都有相同的spec集合，无论执行多少次。
例如：

> gauge run -n=4 -g=2 specs
>
> gauge run -n=4 -g=2 specs

上面的两条命令将会执行同样的一组spec。

#### 懒惰分配测试执行您的测试套件

此功能允许您在执行期间动态分配spec给工作流，而不是在执行开始时。
这使得Gauge可以优化您的代理/执行环境的资源。这是有用的，因为某些spec可能需要比其他spec更多的时间，因为它们中的场景数量或者被测功能的性质。
以下命令将在指定数量的流中分配测试：

> gauge run -n=4 --strategy="lazy" specs

或者

> gauge run -n=4 specs

假设您有100个测试用例，您选择运行4个流/核心；在执行期间，懒惰分配将动态地将下一个spec分配给已完成先前执行的流并等待更多工作的流。

懒惰分配测试是默认的行为。

根据需求，另一种叫做`eager`的策略也是有用的。在这种情况下，100个测试用例在执行之前分发，从而使它们的数量相等。

> gauge run -n=4 --strategy="eager" specs

备注：懒惰策略只有在你未使用`-g`标志时生效。这是因为分组依赖于开始执行之前测试的分配。结合懒惰策略使用它将不会对您的测试套件执行产生影响。

#### 重新执行一个执行流

spec可以分成组，`--group` 和 `-g`提供执行具体组的功能。

可以通过下列命令完成：

> gauge run -n=4 -g=2 specs

上述创建4组（由`-n`标志提供）spec，并且执行第二个（由`-g`提供）组。
spec按照字母顺序排序，然后分成组，保证每个组都有相同的spec集合，无论执行多少次。
例如：

> gauge run -n=4 -g=2 specs
>
> gauge run -n=4 -g=2 specs

上面的两条命令将会执行同样的一组spec。

### Hook中的当前执行上下文

- 要获取有关当前spec，场景，步骤执行的其他信息，可以在hooks方法中添加一个附加的`ExecutionContext`参数。

~~~java
  @BeforeScenario
  public void loginUser(ExecutionContext context) {
    String scenarioName = context.getCurrentScenario().getName();
    // Code for before scenario
  }

  @AfterSpec
  public void performAfterSpec(ExecutionContext context) {
    Specification currentSpecification = context.getCurrentSpecification();
    // Code for after step
  }
~~~

### 基于标签过滤Hooks执行

您可以指定执行hooks可以运行的标签，这将确保hook仅在具有所需标签的场景和spec上运行。

~~~java
  // A before spec hook that runs when tag1 and tag2
  // is present in the current scenario and spec.
  @BeforeSpec(tags = {"tag1, tag2"})
  public void loginUser() {
      // Code forbefore scenario
  }

  // A after step hook runs when tag1 or tag2
  // is present in the currentscenario and spec.
  // Default tagAggregation value is Operator.AND.
  @AfterStep(tags = {"tag1", "tag2"}, tagAggregation = Operator.OR)
  public void performAfterStep() {
      // Code for after step
  }
~~~

备注：
标签不能被指定在`@BeforeSuite`和`@AfterSuite`hooks上.

## Gauge项目模版

Gauge提供的模版可用于引导初始化Gauge项目的过程以及合适的构建依赖工具，webdriver等。

运行下面的命令，列出所有gauge项目可用的模版：

> gauge init --templates

这些模版也可以在[Bintray网站Gauge模版](https://bintray.com/gauge/Templates/gauge-templates/view#files)处找到。

### 通过模版初始化Gauge项目

假如您想使用Java编写测试代码以及Selenium作为驱动来初始化Gauge项目。

您可以通过使用`java_maven_selenium`gauge模版快速设置此项目，该项目已准备好开始使用selenium编写测试 。

要使用模版初始化gauge项目，从运行`gauge init --templates`后展示的名字选择其一然后在初始化gauge项目时将此名作为参数传入。

例如，为创建使用`java_maven_selenium`模版的gauge项目，你需要运行下面的命令：

> gauge init java_maven_selenium

此模版将maven作为构建工具以及selenium作为webdrvier来创建gauge项目， 这将会下载gauge模版`java_maven_selenium`然后使用有用的示例代码设置您的项目。

现在，您可以开始编写spec然后执行它们。

## 步骤别名

多个步骤名称对应相同的实现，所有步骤名称的参数的数量和类型必须与实现上的参数数量想匹配。

### 用例

可能在一些情况下，在创作spec的时候，您可能希望以不同的方式表达相同的功能，以使得spec更容易阅读。

#### 示例1

~~~markdown
User Creation
=============
Multiple Users
--------------
* Create a user "user 1"
* Verify "user 1" has access to dashboard
* Create another user "user 2"
* Verify "user 2" has access to dashboard
~~~

在名为Multiple Users的场景里，第一和第三步的底层功能是一样的，但是它们的表达是不一样的。这有助于更清楚的传达意图和功能。在这样的情况下，应该使用步骤别名功能，以便您可以在代码级别实践DRY原则，同事确保功能被清楚的表达.

**实现**

~~~java
  public class Users {

      @Step({"Create a user <user_name>", "Create another user <user_name>"})
      public void helloWorld(String user_name) {
          // create user user_name
      }

  }
~~~

**示例2**

~~~markdown
User Creation
-------------
* User creates a new account
* A "welcome" email is sent to the user

Shopping Cart
-------------
* User checks out the shopping cart
* Payment is successfully received
* An email confirming the "order" is sent
~~~

在此用例中，两个场景的最后一行（发送邮件）底层功能是一样的，但是使用别名后表达更清楚。底层的步骤实现可能是这样的。

实现

~~~java
  public class Users {

      @Step({"A <email_type> email is sent to the user", "An email confirming the <email_type> is sent"})
      public void helloWorld(String email_type) {
          // Send email of email_type
      }

  }
~~~

## 失败用例重新运行

Gauge提供仅重新执行上次执行过程中失败场景的功能。失败场景运行可以通过使用gauge标签`--failed`。

假如您运行`gauge run specs`后3个场景失败了，您通过下面的命令，可以仅仅重新执行失败场景而不是执行所有的场景。

> gauge run --failed

这个命令甚至会设置在您上次运行中提供的标志，例如：如果您已经执行了下列命令：

> gauge run --env="chrome" --verbose specs

并且三个场景在这次运行过程中失败了，`gauge run --failed`命令设置`--env` 和`--verbose`标志为对应的值然后仅仅执行失败的三个场景。这个情况下`gauge run --failed`相当于命令:

> gauge run --env="chrome" --verbose specs <path_to_failed_scenarios>

## 重构

### 改写步骤

Gauge允许您改写项目中的步骤，改写步骤运行：

> gauge refactor "old step <name>" "new step name"

这里`<`和`>`用来表示步骤中的参数。参数可以在改写过程中被添加，被移除或者被修改。

这样会修改所有的spec文件以及代码文件（用于支持重构的语言插件）。

#### 示例

假设我们的spec文件有以下步骤：

~~~markdown
* create user "john" with id "123"
* create user "mark" with id "345"
~~~

现在，如果你需要添加一个额外的参数`last name`在这个步骤里，我们可以执行下面的命令：

> gauge refactor "create user <name> with id <id>" "create user <name> with <id> and last name <watson>"

这将修改所有的spec文件已反映修改。

~~~markdown
* create user "john" with id "123" and last name "watson"
* create user "mark" with id "345" and last name "watson"
~~~

### 项目结构体

在初始化特定语言的gauge项目时，将使用以下文件创建项目框架：

### 通用Gauge文件

GAUGE_PROJECT_ROOT环境变量保存创建Gauge项目的路径。

> ├── env
> │ └── default
> │ └── default.properties
> ├── manifest.json
> ├── specs
> │ └── example.spec

### Env目录

env目录包含多个环境特定的目录，每个目录都有.property文件，用于定义在特定环境执行期间设置的环境变量。

env/default目录是在项目初始化的时候创建，包含执行过程中设置的默认环境变量。

学习更多关于[管理环境](https://docs.getgauge.io/configuration.html#environments)的内容。

### Specs目录

specs目录包含此项目所有的spec文件，它们是用简单的markdown语法编写的业务层spec。

一个简单的spec示例（example.spec）被建在specs目录中，它易于理解spec的格式。

学习更多关于[spec](https://docs.getgauge.io/syntax.html#spec-syntax)的内容。

### manifest文件

manifest.json文件包含spec特定的配置，其中包括项目中所需的插件信息。

项目初始化后，manifest.json文件将具有一下内容：

~~~json
{
  "Language": "<language>",
  "Plugins": [
    "html-report"
  ]
}
~~~

- Language：编写测试代码的编程语言，Gauge使用对应的Language runner来执行specs。
- Plugins：项目所用的Gauge插件，一些插件会在每个Gauge项目中默认被使用。插件可以通过执行下面的命令添加到项目中：

> gauge add <plugin-name>

例如：

> gauge add xml-report

在运行上面的命令之后，manifest.json文件将会具有以下内容：

~~~json
{
  "Language": "<language>",
  "Plugins": [
    "html-report",
    "xml-report"
  ]
}
~~~

参考信息:[更多信息](https://blog.csdn.net/amoscn/article/details/77855944?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163841644516780271542590%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=163841644516780271542590&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~sobaiduend~default-1-77855944.pc_v2_rank_blog_default&utm_term=gauge&spm=1018.2226.3001.4450)
