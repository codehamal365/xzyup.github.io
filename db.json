{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/photo-1540202404-fad3e2190841.jpeg","path":"img/photo-1540202404-fad3e2190841.jpeg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/img/photo-1625990943295-6b06dbca7948.jpeg","path":"img/photo-1625990943295-6b06dbca7948.jpeg","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/footer-beautify-runtime.js","path":"js/footer-beautify-runtime.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/font/19nmu3k6x55llqlde6ex.ttf","path":"font/19nmu3k6x55llqlde6ex.ttf","modified":0,"renderable":1},{"_id":"themes/butterfly/source/font/FZSJ.TTF","path":"font/FZSJ.TTF","modified":0,"renderable":1},{"_id":"themes/butterfly/source/font/igeodgtrm3w1budutaar.ttf","path":"font/igeodgtrm3w1budutaar.ttf","modified":0,"renderable":1},{"_id":"themes/butterfly/source/font/FZSJ-RUFSYXK.TTF","path":"font/FZSJ-RUFSYXK.TTF","modified":0,"renderable":1},{"_id":"themes/butterfly/source/font/skxv68sn9lo0inhx6p0g.ttf","path":"font/skxv68sn9lo0inhx6p0g.ttf","modified":0,"renderable":1},{"_id":"themes/butterfly/source/font/tys5w31dsefi5v491d7t.ttf","path":"font/tys5w31dsefi5v491d7t.ttf","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"themes/butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/_posts/hello-world.md","hash":"3aec413ee73f55e53d93612f631c32a63333093b","modified":1651634696186},{"_id":"source/about/index.md","hash":"4ac7cf9f2409b4b9e053019e8b856e763928a230","modified":1650458591926},{"_id":"source/_data/link.yml","hash":"8d31c36b37ae6c66f527ce1f31b2b305d5319d70","modified":1650458591938},{"_id":"source/_posts/idea下载源码报拒绝连接.md","hash":"f986e1d4155aaca086e451ca263f6c4245579bf0","modified":1651634704305},{"_id":"source/_posts/mac使用brew管理后台服务.md","hash":"6b2cbaebef19cd7946141226baef56437a4073a1","modified":1651634718441},{"_id":"source/_posts/mac安装kafka.md","hash":"a2b734b3a952098d98a358c659ab030d7cecd6d0","modified":1651634728866},{"_id":"source/_posts/sonarqube.md","hash":"9304b43094024e04145dd0f9fd2c2aac63f6056c","modified":1651634757442},{"_id":"source/_posts/swagger-editor生成api文件.md","hash":"f132ca5029b337027a0c8d11214cc5c9f0a1338c","modified":1651634764540},{"_id":"source/_posts/nginx配置https.md","hash":"0129b74bb323a54967214ebc3567280afcc1a782","modified":1650462420270},{"_id":"source/_posts/项目开发中有哪些环境.md","hash":"b22b196a62a3ed013f1935a9cb87e04cbcbc8b48","modified":1651634671539},{"_id":"source/_posts/swagger-ui访问api接口.md","hash":"f771db6607dde09396ea99b97cec67d761edfa7b","modified":1651634771186},{"_id":"source/link/index.md","hash":"e926347e5b1080131fa5f40b424ffcec586f25ef","modified":1650458591917},{"_id":"source/_posts/基于openapi的yaml文件快速生成代码.md","hash":"e412dd55f3fce7ff403d4b565bb4b3dc9fc1a22e","modified":1650462420334},{"_id":"source/categories/index.md","hash":"24a0a56ca523a3a052f5512da1fa03ee662681f4","modified":1650548185726},{"_id":"source/tags/index.md","hash":"e10351bb55dc58f376d8507ae7cf871788cb191d","modified":1650458591907},{"_id":"source/bookmark/index.md","hash":"e9c40875ce0036cb01da202809dab371e14f1576","modified":1650458587704},{"_id":"source/messageboard/index.md","hash":"ea6076ebaec8483f2f98686d3c65cf55206b91f1","modified":1650549697298},{"_id":"source/_posts/design-pattern/代理模式.md","hash":"9f95ab345367ba07e93b55807dca3a35a3a7563a","modified":1651633216438},{"_id":"source/_posts/design-pattern/单例模式.md","hash":"ee66fe89ebde6a44d3c8b8a978b92e200332ac93","modified":1651633238673},{"_id":"source/_posts/design-pattern/原型模式.md","hash":"e53054a724b0b06e7d26e06e754fb8e29b9cd77e","modified":1651633285338},{"_id":"source/_posts/design-pattern/工厂模式.md","hash":"61dcd06a7a34820c309e7ec497fb96da8862b3a2","modified":1651633262024},{"_id":"source/_posts/design-pattern/模板方法.md","hash":"09a6a1473ff380a3ae2b46d349e9cbf38e3930f8","modified":1651633271474},{"_id":"source/_posts/design-pattern/状态模式.md","hash":"9197570180c5f02a169ea750183321b5eed073a2","modified":1651633294083},{"_id":"source/_posts/design-pattern/策略模式.md","hash":"db3ff3168a39e43aa3bde5a698288f165d01a650","modified":1651633186943},{"_id":"source/_posts/docker/dockerfile-commands.md","hash":"07bf90dab0200e174834f1335936eabe03b5b2f3","modified":1651633324765},{"_id":"source/_posts/docker/docker-commands.md","hash":"cb3d603b62ae7fcd930dca3f6ecdc85611ffa83d","modified":1651633312435},{"_id":"source/_posts/design-pattern/访问者模式.md","hash":"d31cac0bf97e69c53d470e1858e80b8f96a1c830","modified":1651633251289},{"_id":"source/_posts/gauge/2.创建项目.md","hash":"1cfeee6e932bf237c06818fe7342aa1378e79b26","modified":1651633347783},{"_id":"source/_posts/gauge/3.语法.md","hash":"564fef8e20e27c47e07b33679e604cba1a08928c","modified":1651633362590},{"_id":"source/_posts/gauge/4.使用.md","hash":"dc7a19f9c7d59159e2a9077a8caee4a02d441682","modified":1651633385507},{"_id":"source/_posts/git/git-commands.md","hash":"6ad36ea3ff1aa9c907642bdbbc6c8870132e509d","modified":1651633400931},{"_id":"source/_posts/go/相关资料.md","hash":"8a32e7fe8ff0bafe06aae067a14718db3cb50e9a","modified":1651633413564},{"_id":"source/_posts/guava/CaseFormat.md","hash":"488413f70086069c653d0590e420836864668a41","modified":1651633637118},{"_id":"source/_posts/gauge/1.安装.md","hash":"8f59d0985af1d410ff71cef5f0bae4acaeac1ec9","modified":1651378385195},{"_id":"source/_posts/guava/Functions.md","hash":"25830b928ba3f815d0f5e42e8df7ded08a6f0505","modified":1651633917773},{"_id":"source/_posts/guava/CharMatcher.md","hash":"f1e6053b47ac0b6dcea26a799cfeb3e0c9a279e9","modified":1651633905027},{"_id":"source/_posts/guava/Optional.md","hash":"4ab96b87f355f81d17836d107231ab011d3ce37e","modified":1651634088556},{"_id":"source/_posts/guava/Joiner.md","hash":"79ac24409881b656749bcf3697de0c2ae3d1bba4","modified":1651633931714},{"_id":"source/_posts/guava/Preconditions.md","hash":"d25314bec4a2522f266a0e3832e5d4e0da7e3060","modified":1651634185786},{"_id":"source/_posts/guava/Objects&MoreObjects.md","hash":"557cf434d1b713c72ef01e8dbedc050d61648782","modified":1651634048662},{"_id":"source/_posts/guava/Ordering.md","hash":"8b0bd6f28b34b8e874c6786c026b8cada2774ab9","modified":1651634172970},{"_id":"source/_posts/guava/Splitter.md","hash":"fb612394e88305c3994d0ca7cee842a1588e0e63","modified":1651634253870},{"_id":"source/_posts/guava/Range.md","hash":"3357315bb834b09cf58615cab8024471582db238","modified":1651634239372},{"_id":"source/_posts/guava/Strings.md","hash":"2e6a3ffbbc135e3cc2c6a90f72219a41a0182ba8","modified":1651634268528},{"_id":"source/_posts/guava/Suppliers.md","hash":"a73525c02d24927949cdb03a637236af67ddbbd8","modified":1651634275473},{"_id":"source/_posts/guava/Predicates.md","hash":"e95908d0419f02393191527c9326e3006df61d0c","modified":1651634197994},{"_id":"source/_posts/guava/Throwables.md","hash":"49b5b2085109069e41765f0bf617a190cbbd8167","modified":1651634289898},{"_id":"source/_posts/java/spi.md","hash":"3c690a7e7a1b193eee5475ac41fd96adf799be0e","modified":1651634322288},{"_id":"source/_posts/linux/chmod.md","hash":"f937d9e8e70df2d35f38bcc7fd5f891eed043c72","modified":1651634424083},{"_id":"source/_posts/job/常见定时任务类型.md","hash":"a6d0c7be7bf9ba99259a5529fc1c69559dd85adc","modified":1651634392900},{"_id":"source/_posts/java/spi之autoservice.md","hash":"933d74b57cac8a9fcc5df67e91fd66b8017d4b01","modified":1651634370087},{"_id":"source/_posts/linux/linux目录.md","hash":"133ddd8a1b772aa6cab656154e20e71bf80221b3","modified":1651634432673},{"_id":"source/_posts/linux/shell执行的三种方式.md","hash":"e122cd148ddeb06d7f40dea7e3745be1b7eaff3a","modified":1651634476966},{"_id":"source/_posts/linux/scp.md","hash":"0a7bb20db757efd9029988ef649bc7f106951cb5","modified":1651634448264},{"_id":"source/_posts/linux/基础教程.md","hash":"56b013baa887284f4cb3e9c6a8bf22040d02302b","modified":1651634404360},{"_id":"source/_posts/mq/什么是消息队列.md","hash":"26ebdab2f2453f32d35635c9e31a8773da843a6c","modified":1651634492149},{"_id":"source/_posts/linux/文件基本属性.md","hash":"b65df526070a08a852bbc03f83ae6b150e428bfe","modified":1651634415085},{"_id":"source/_posts/network/curl-get-header-etc.md","hash":"8afebd5edcd727d3f029347ed1445e532ce32c58","modified":1651634522534},{"_id":"source/_posts/mq/rabbitmq入门.md","hash":"200024f47e552005e64d7f5e97ff82eac932e342","modified":1651634510169},{"_id":"source/_posts/network/curl-post.md","hash":"fd365beb6b8845f60e84093b8d2a69e7c968d0db","modified":1651634533501},{"_id":"source/_posts/network/curl参数.md","hash":"b467c7308b5cd390730609b935c04d55d2cc22e2","modified":1651634542627},{"_id":"source/_posts/spring/ConfigurationProperties解析.md","hash":"a9e47dc0776da2e82fa02ecd0cfa1ea902cf18ba","modified":1651634565180},{"_id":"source/_posts/spring/configurationProperties属性转换.md","hash":"33e8e7830360706296e5b4247fde465be412f48e","modified":1651634573300},{"_id":"source/_posts/spring/@Value.md","hash":"d625031c49c0a2f0305d164a2460412fdfb63901","modified":1650462420315},{"_id":"source/_posts/spring/Springboot加载自定义配置文件.md","hash":"5106ea6221eb5554eb0623e58096c6358150d89f","modified":1651634590877},{"_id":"source/_posts/uml/plantuml思维导图.md","hash":"a0782d7243fdd4a54d61f566a37948ec46495f42","modified":1651634656754},{"_id":"source/_posts/spring/springboot项目打包jar.md","hash":"2b2b8ee8edc8b4a21d9a791ec9c25c1670e0a8a9","modified":1651634608100},{"_id":"source/_posts/spring/spring注入bean的四种方式.md","hash":"dabb15adc00a3789d2dacd61b11f36fae62be314","modified":1651634582494},{"_id":"source/_posts/spring/springboot项目打包瘦身.md","hash":"7526d3220de6edea2dc522dc1e3200c6c5311244","modified":1651634599571},{"_id":"source/_posts/uml/plantuml简介.md","hash":"627555375c7d0a521666294631b7b588e6dd6726","modified":1651634647166},{"_id":"source/_posts/uml/plantuml活动图.md","hash":"154fdba3b12e7f84a221d8c12062c6ca35891141","modified":1651634625125},{"_id":"source/_posts/guava/collections/Bimap.md","hash":"058f0c107373b3075707bfa189acec361248ec61","modified":1651633438438},{"_id":"source/_posts/docker下安装zookeeper(单机&集群).md","hash":"6bf06f05b99e15a4aa44b77ba16cb46343033873","modified":1651634688190},{"_id":"source/_posts/guava/collections/Multimap.md","hash":"6e46ebfb8a2f0245c1bf1b4db8cf319e65fc6390","modified":1651633448425},{"_id":"source/_posts/guava/collections/Multiset.md","hash":"ad74779e1c4979f7432ac405977606ac162c454e","modified":1651633529659},{"_id":"source/_posts/guava/collections/Table.md","hash":"15bc4b579053fe5e0b9fcc8232f736d6feba5a5d","modified":1651633628558},{"_id":"themes/butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":1650458589458},{"_id":"themes/butterfly/package.json","hash":"80ebdf46caa7266fc43cd51c96c97731adbc5694","modified":1650458589069},{"_id":"themes/butterfly/README.md","hash":"6ee27baf95a5741abbc224ef8938d679b6597665","modified":1650458589042},{"_id":"themes/butterfly/README_CN.md","hash":"49ace5208f98783344f17a00adab7641cda43280","modified":1650458589056},{"_id":"themes/butterfly/languages/default.yml","hash":"7fd2950554e99a6f15232267621f36f026a85380","modified":1650458589038},{"_id":"themes/butterfly/languages/en.yml","hash":"4b2c351f2b5fd4f8497e806085364928e1af0b5b","modified":1650458589507},{"_id":"themes/butterfly/languages/zh-TW.yml","hash":"ef035065ebb37fce3e56e51f8b56deb596db78b2","modified":1650458589052},{"_id":"themes/butterfly/.github/stale.yml","hash":"05a55a87fa7f122c59683e41c8b2e37e79f688f0","modified":1650458589363},{"_id":"themes/butterfly/languages/zh-CN.yml","hash":"cb5a52dabaec03fcc4f900ca0a8efbacaccd471f","modified":1650471708543},{"_id":"themes/butterfly/_config.yml","hash":"a791c8df298c2a536dbe40aa4905eff76ecd41e9","modified":1650458589066},{"_id":"themes/butterfly/layout/archive.pug","hash":"abbc4dafbfc12fcb04c1581765449e08da465a07","modified":1650458588604},{"_id":"themes/butterfly/layout/category.pug","hash":"eac777dff9d57c9c0b25923fb037288c8590dfee","modified":1650548310549},{"_id":"themes/butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":1650458588600},{"_id":"themes/butterfly/layout/page.pug","hash":"3b5f9c7eb1a24e264259cae8aee65e03f410fd2b","modified":1650458588514},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/custom.md","hash":"eff495eb1584cf4586e33c76e8b2fa6a469a179b","modified":1650458589384},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/bug_report.md","hash":"476802922b774b679225102ac30a9d9183394701","modified":1650458589465},{"_id":"themes/butterfly/.github/ISSUE_TEMPLATE/feature_request.md","hash":"f6867a2f0417fe89a0f2008730ee19dd38422021","modified":1650458589469},{"_id":"themes/butterfly/layout/tag.pug","hash":"543f49e403d751a03cac884caf95b1163d80f437","modified":1650458587670},{"_id":"themes/butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":1650458589391},{"_id":"themes/butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":1650458588517},{"_id":"themes/butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":1650458588769},{"_id":"themes/butterfly/layout/includes/additional-js.pug","hash":"ab3bdeb6e0acd3d58091698c1335afb069eea7e5","modified":1650458588526},{"_id":"themes/butterfly/layout/includes/footer.pug","hash":"268da57e5a0289f706f16eb7e0e360119d59a701","modified":1650458588851},{"_id":"themes/butterfly/layout/includes/head.pug","hash":"847a5cbc13db1a435a4f762a7c0007d9bcbb79a2","modified":1650458588848},{"_id":"themes/butterfly/layout/includes/layout.pug","hash":"6f2608c4d93d3d10ae6b2cd7f8918f303f024321","modified":1650458588841},{"_id":"themes/butterfly/layout/includes/rightside.pug","hash":"699d0d2cff233628752956c4434125c8203f7d63","modified":1650458588504},{"_id":"themes/butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":1650458589528},{"_id":"themes/butterfly/layout/includes/sidebar.pug","hash":"f093ab771257a6a939b194f68607a2038c8d7da3","modified":1650458588844},{"_id":"themes/butterfly/scripts/events/config.js","hash":"a72c2020c87c4998aa124a16e9f8560875b9f86d","modified":1650458589519},{"_id":"themes/butterfly/scripts/events/init.js","hash":"a7f567b3d3110afe2f99c967b8e15351a7f5bd6d","modified":1650458589533},{"_id":"themes/butterfly/scripts/events/stylus.js","hash":"9819f0996234fbd80d6c50a9e526c56ebf22588d","modified":1650458589523},{"_id":"themes/butterfly/scripts/events/welcome.js","hash":"3cfc46c749e2fd7ae9c2a17206238ed0e0e17e7d","modified":1650458589545},{"_id":"themes/butterfly/scripts/filters/post_lazyload.js","hash":"932df912976261929f809b7dbd4eb473e7787345","modified":1650458589542},{"_id":"themes/butterfly/scripts/filters/random_cover.js","hash":"21379ed2dccb69c43b893895c9d56238c11e5f43","modified":1650458589538},{"_id":"themes/butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":1650458589495},{"_id":"themes/butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":1650458589515},{"_id":"themes/butterfly/scripts/helpers/page.js","hash":"c6611d97087c51845cb1ab4821696a62fa33daeb","modified":1650458589501},{"_id":"themes/butterfly/scripts/helpers/related_post.js","hash":"21556f9cb412ddc500ad12ecfd419f3ea6c9f663","modified":1650458589492},{"_id":"themes/butterfly/scripts/helpers/inject_head_js.js","hash":"6a103a2472903289bdecd5240eb89cac0b9e13d9","modified":1650458589511},{"_id":"themes/butterfly/scripts/tag/button.js","hash":"91d954f6e9fe6e571eb8ec9f8996294b2dc3688e","modified":1650458589425},{"_id":"themes/butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":1650458589437},{"_id":"themes/butterfly/scripts/tag/gallery.js","hash":"f79c99f6c5b626c272dc2bed2b0250d6b91bb28a","modified":1650458589431},{"_id":"themes/butterfly/scripts/tag/hide.js","hash":"396c3ab1bcf1c7693ad7e506eadd13016c6769b6","modified":1650458589488},{"_id":"themes/butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":1650458589444},{"_id":"themes/butterfly/scripts/tag/label.js","hash":"03b2afef41d02bd1045c89578a02402c28356006","modified":1650458589440},{"_id":"themes/butterfly/scripts/tag/mermaid.js","hash":"531808a290b8bdd66bac2faab211ada8e9646a37","modified":1650458589451},{"_id":"themes/butterfly/scripts/tag/note.js","hash":"c16c6eb058af2b36bcd583b2591076c7ebdd51ad","modified":1650458589472},{"_id":"themes/butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":1650458589477},{"_id":"themes/butterfly/scripts/tag/timeline.js","hash":"300eb779588bf35a1b687d9f829d866074b707e3","modified":1650458589455},{"_id":"themes/butterfly/layout/includes/pagination.pug","hash":"77403dea714a596f334bb289adfa09bbde0f5fae","modified":1650471783182},{"_id":"themes/butterfly/source/css/index.styl","hash":"861998e4ac67a59529a8245a9130d68f826c9c12","modified":1650458589395},{"_id":"themes/butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1650458589414},{"_id":"themes/butterfly/source/css/var.styl","hash":"4890a40366d6443f8b8942a4e9a6dce9fe3494f5","modified":1650458589349},{"_id":"themes/butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1650458589368},{"_id":"themes/butterfly/source/js/footer-beautify-runtime.js","hash":"110cefb4b144e29154939151ab257fa94478fe66","modified":1650458588564},{"_id":"themes/butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1650458589373},{"_id":"themes/butterfly/source/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":1650458588561},{"_id":"themes/butterfly/source/js/main.js","hash":"04efcbd28b37875cfec88eb87cab7256a9ebb327","modified":1650458588569},{"_id":"themes/butterfly/source/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":1650458588573},{"_id":"themes/butterfly/layout/includes/custom/hide-page-header.pug","hash":"751ee38bcc22c0bf45dc2935f76427348f5e7979","modified":1650458587875},{"_id":"themes/butterfly/layout/includes/head/Open_Graph.pug","hash":"6c41f49a3e682067533dd9384e6e4511fc3a1349","modified":1650458587785},{"_id":"themes/butterfly/layout/includes/head/analytics.pug","hash":"15530d9ac59c576d79af75dd687efe71e8d261b0","modified":1650458587798},{"_id":"themes/butterfly/layout/includes/head/config.pug","hash":"9e58c80af8bbd0c66ccb4f94d3781818cebf0d66","modified":1650458587761},{"_id":"themes/butterfly/layout/includes/head/preconnect.pug","hash":"65a23b5170204e55b813ce13a79d799b66b7382c","modified":1650458587789},{"_id":"themes/butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":1650458587794},{"_id":"themes/butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":1650458587729},{"_id":"themes/butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":1650458587734},{"_id":"themes/butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":1650458587757},{"_id":"themes/butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":1650458587719},{"_id":"themes/butterfly/layout/includes/header/index.pug","hash":"65fa23680af0daf64930a399c2f2ca37809a8149","modified":1650458587870},{"_id":"themes/butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":1650458587819},{"_id":"themes/butterfly/layout/includes/header/nav.pug","hash":"78a3abd90bb3c18cd773d3d5abac3541e7f415e5","modified":1650458587863},{"_id":"themes/butterfly/layout/includes/header/social.pug","hash":"0d953e51d04a9294a64153c89c20f491a9ec42d4","modified":1650458587813},{"_id":"themes/butterfly/layout/includes/header/post-info.pug","hash":"dc3913c1a6dd207051c3d3414a33851ae8bc0a45","modified":1650458587803},{"_id":"themes/butterfly/layout/includes/mixins/article-sort.pug","hash":"2fb74d0b0e4b98749427c5a1a1b0acb6c85fadc4","modified":1650458587839},{"_id":"themes/butterfly/layout/includes/mixins/post-ui.pug","hash":"b9ebb02af8ccf43e3f73be43db19254fa913c57b","modified":1650458587834},{"_id":"themes/butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1650458587738},{"_id":"themes/butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":1650458587742},{"_id":"themes/butterfly/layout/includes/loading/loading.pug","hash":"5276937fbcceb9d62879dc47be880cd469a27349","modified":1650458588761},{"_id":"themes/butterfly/layout/includes/page/flink.pug","hash":"fed069baa9b383f57db32bb631115071d29bdc60","modified":1650458587752},{"_id":"themes/butterfly/layout/includes/loading/loading-js.pug","hash":"4cfcf0100e37ce91864703cd44f1cb99cb5493ea","modified":1650458588765},{"_id":"themes/butterfly/layout/includes/page/tags.pug","hash":"6311eda08e4515281c51bd49f43902a51832383c","modified":1650458587747},{"_id":"themes/butterfly/layout/includes/post/post-copyright.pug","hash":"88e3b611b03149665e4113cfa39595c1a3fca7e5","modified":1650458587843},{"_id":"themes/butterfly/layout/includes/post/reward.pug","hash":"864869c43fe5b5bb6f4ac6b13dd4bfb16ea47550","modified":1650458587857},{"_id":"themes/butterfly/layout/includes/third-party/aplayer.pug","hash":"292646dfab135973b09f0fa9e3931e83da2ed30e","modified":1650458588938},{"_id":"themes/butterfly/layout/includes/third-party/effect.pug","hash":"b9d54a01d7c2a7a183cb7209e99430ce7fea1fe3","modified":1650458588950},{"_id":"themes/butterfly/layout/includes/third-party/pangu.pug","hash":"d5fec7dedc52ab23865fb4db002755e9bdaadc9f","modified":1650458588946},{"_id":"themes/butterfly/layout/includes/third-party/pjax.pug","hash":"d4072f9ab79f4ac49aa251ae470abc45a2fddbd6","modified":1650458588992},{"_id":"themes/butterfly/layout/includes/third-party/prismjs.pug","hash":"1fbecfd299068f90d727f0c8c65e2a792fa6e3e2","modified":1650458588943},{"_id":"themes/butterfly/layout/includes/third-party/subtitle.pug","hash":"b63fd8ec48d782f51ee11226753fed1998bbf34a","modified":1650458588962},{"_id":"themes/butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":1650458588787},{"_id":"themes/butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":1650458588746},{"_id":"themes/butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":1650458588800},{"_id":"themes/butterfly/layout/includes/widget/card_author.pug","hash":"0380a1e048e6219ea4b4a8a4eadba960edf308f0","modified":1650458588777},{"_id":"themes/butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":1650458588753},{"_id":"themes/butterfly/layout/includes/widget/card_newest_comment.pug","hash":"6d93564a8bd13cb9b52ee5e178db3bcbf18b1bc6","modified":1650458588749},{"_id":"themes/butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":1650458588797},{"_id":"themes/butterfly/layout/includes/widget/card_post_toc.pug","hash":"3057a2f6f051355e35d3b205121af8735100eacf","modified":1650458588804},{"_id":"themes/butterfly/layout/includes/widget/card_recent_post.pug","hash":"9c1229af6ab48961021886882c473514101fba21","modified":1650458588757},{"_id":"themes/butterfly/layout/includes/widget/card_webinfo.pug","hash":"0612aaee878f33ea8d3da0293c7dc3b6cd871466","modified":1650458588782},{"_id":"themes/butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":1650458588793},{"_id":"themes/butterfly/layout/includes/widget/index.pug","hash":"7fb096656c8a6c21a4b6a5100885b1081d6021ed","modified":1650458587828},{"_id":"themes/butterfly/source/css/_highlight/highlight.styl","hash":"2f95e99b8351fbecd9037a1bbdc3fee9d6ea8a77","modified":1650458589406},{"_id":"themes/butterfly/layout/includes/widget/card_tags.pug","hash":"a4de64ebc23f60fa9a7f4eb54c188393326a09a7","modified":1650721001559},{"_id":"themes/butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":1650458589403},{"_id":"themes/butterfly/source/css/_layout/chat.styl","hash":"29f48f9370f245e6e575b5836bccf47eb5688d8b","modified":1650458588728},{"_id":"themes/butterfly/source/css/_global/index.styl","hash":"df16e68bca2735e6fde7b13e9580e3096144fc04","modified":1650723946916},{"_id":"themes/butterfly/source/css/_global/function.styl","hash":"ac0f16f3bbd6d4917505a068616750702f01c13a","modified":1650593196408},{"_id":"themes/butterfly/source/css/_layout/aside.styl","hash":"a51e46571bb2ef0130c4bfe1d0325534cf23c268","modified":1650722571426},{"_id":"themes/butterfly/source/css/_layout/comments.styl","hash":"c61dccca690d486c3d9c29cf028d87b777385141","modified":1650458588697},{"_id":"themes/butterfly/source/css/_layout/loading.styl","hash":"ef21990de28bd75dcd0f88b8d616e1a7a137502f","modified":1650458588704},{"_id":"themes/butterfly/source/css/_layout/footer.styl","hash":"e9bb624162e4f5512c19faedacd5b41815629ed8","modified":1650515199878},{"_id":"themes/butterfly/source/css/_layout/head.styl","hash":"cc4325a52d66170ae4410e8614cd4352480dc25b","modified":1650515359907},{"_id":"themes/butterfly/source/css/_layout/pagination.styl","hash":"6d8fda6286d6072b31e9e69f4d8c875ea79da3df","modified":1650471805394},{"_id":"themes/butterfly/source/css/_layout/relatedposts.styl","hash":"c9bd1f00d2de815f5da6541f979971bea13c9a39","modified":1650468792012},{"_id":"themes/butterfly/source/css/_layout/post.styl","hash":"84d4f27fde933bdf839629eb3bddcbc0f4592836","modified":1650458588690},{"_id":"themes/butterfly/source/css/_layout/reward.styl","hash":"c5cfed620708807a48076b5ee59b0ba84e29aa80","modified":1650458588687},{"_id":"themes/butterfly/source/css/_layout/sidebar.styl","hash":"1bcbc80dff19cd53d0b367c3b9a3c751d3a1f10d","modified":1650458588708},{"_id":"themes/butterfly/source/css/_layout/third-party.styl","hash":"e5008f43897d8482b4831cd4c13a0af40e496762","modified":1650458589343},{"_id":"themes/butterfly/source/css/_mode/darkmode.styl","hash":"f67177310f5594954b25a591d186d28d5d450b18","modified":1650458588577},{"_id":"themes/butterfly/source/css/_layout/rightside.styl","hash":"bd88ee30ebf8ca2e7b4d3a034c317fd61733921f","modified":1650458588701},{"_id":"themes/butterfly/source/css/_mode/readmode.styl","hash":"69f8e9414526dfda3af9a71c8e528fdd0ecbbfe5","modified":1650458588583},{"_id":"themes/butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":1650458588661},{"_id":"themes/butterfly/source/css/_page/archives.styl","hash":"6f4b4ede52305bce9b22c8c897dcbde8af6e2ce4","modified":1650458588677},{"_id":"themes/butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":1650458588668},{"_id":"themes/butterfly/source/css/_page/common.styl","hash":"a58d35d698885f1034dedbe99f7dbc1a801412c6","modified":1650458588672},{"_id":"themes/butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":1650458588654},{"_id":"themes/butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":1650458588651},{"_id":"themes/butterfly/source/css/_search/index.styl","hash":"0290605c4984882990059eefe3ad18d2ac6a19ef","modified":1650458589353},{"_id":"themes/butterfly/source/css/_search/algolia.styl","hash":"656f9007d94cf29a20532705d94fb7f22827e6fe","modified":1650458589357},{"_id":"themes/butterfly/source/css/_search/local-search.styl","hash":"e4c987c0202162b50dec91e1df74665d0fa933c9","modified":1650458589346},{"_id":"themes/butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":1650458588638},{"_id":"themes/butterfly/source/css/_tags/gallery.styl","hash":"a310e48f826a4cacc55d8e68f43806e5085554f6","modified":1650458588641},{"_id":"themes/butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":1650458588635},{"_id":"themes/butterfly/source/css/_page/homepage.styl","hash":"46318e328552f0f1773d316ccba83e826a63b45c","modified":1650722823425},{"_id":"themes/butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":1650458588621},{"_id":"themes/butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":1650458588722},{"_id":"themes/butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":1650458588649},{"_id":"themes/butterfly/source/css/_tags/note.styl","hash":"08493b66b9f31f2bd3e9a3115017a0ce16142b20","modified":1650458588625},{"_id":"themes/butterfly/source/css/_tags/tabs.styl","hash":"bf9568444dd54e39dc59b461323dcd38942f27d9","modified":1650458588645},{"_id":"themes/butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":1650458588719},{"_id":"themes/butterfly/source/js/search/algolia.js","hash":"aaa5e44125dcf321866bc2355a73773b11db8c9c","modified":1650458588607},{"_id":"themes/butterfly/source/js/search/local-search.js","hash":"ec62117f38e095425f295b1170c222c7a1399425","modified":1650458588610},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":1650458588541},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"7848ec58c6ec03243abf80a3b22b4dc10f3edf53","modified":1650458588954},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"e3bf847553515174f6085df982f0623e9783db7a","modified":1650458588958},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"ef1b2b5b980d6aeaa5d06b97d1afc9644b155a16","modified":1650458588544},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"bba9871f446c10ffcc8fa9023f5a2eb701a86bae","modified":1650458588531},{"_id":"themes/butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":1650547660439},{"_id":"themes/butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"400ce038548d6f9ddb486150c724c87b6923a88b","modified":1650458588536},{"_id":"themes/butterfly/layout/includes/third-party/chat/chatra.pug","hash":"481cd5053bafb1a19f623554a27d3aa077ea59c3","modified":1650458588818},{"_id":"themes/butterfly/layout/includes/third-party/chat/crisp.pug","hash":"76634112c64023177260d1317ae39cef2a68e35f","modified":1650458588855},{"_id":"themes/butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"cfe63e7d26a6665df6aa32ca90868ad48e05ec04","modified":1650458588811},{"_id":"themes/butterfly/layout/includes/third-party/chat/gitter.pug","hash":"d1d2474420bf4edc2e43ccdff6f92b8b082143df","modified":1650458588807},{"_id":"themes/butterfly/layout/includes/third-party/chat/tidio.pug","hash":"24a926756c2300b9c561aaab6bd3a71fdd16e16d","modified":1650458588815},{"_id":"themes/butterfly/layout/includes/third-party/chat/index.pug","hash":"3f05f8311ae559d768ee3d0925e84ed767c314d3","modified":1650458588859},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqus.pug","hash":"a111407fdcafcf1099e26ffa69786f8822c5d9fb","modified":1650458588900},{"_id":"themes/butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"143236e395c18d80ab8dc794821eb337c85f6b32","modified":1650458588995},{"_id":"themes/butterfly/layout/includes/third-party/comments/giscus.pug","hash":"0764709381fa29778f6390d645ed137d2f91228f","modified":1650458588889},{"_id":"themes/butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"fe684aaad4c99b908dc4499c85afd9a2cd893aae","modified":1650458588989},{"_id":"themes/butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"9c96e6e67931977268b218b99084b98597c2e42b","modified":1650458588893},{"_id":"themes/butterfly/layout/includes/third-party/comments/index.pug","hash":"e4850f2c9ba5f6b2248808f7257662679e0fab0a","modified":1650458588897},{"_id":"themes/butterfly/layout/includes/third-party/comments/js.pug","hash":"9302837f1e35f153323bb4f166514c7e96e8ecdd","modified":1650458588872},{"_id":"themes/butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"c271cacbac14ed665bbf47aa9c6e74e94c69dcef","modified":1650458588985},{"_id":"themes/butterfly/layout/includes/third-party/comments/utterances.pug","hash":"c1c75abe5c899618ed6699c97ac999544840098a","modified":1650458588999},{"_id":"themes/butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":1650458588980},{"_id":"themes/butterfly/layout/includes/third-party/comments/valine.pug","hash":"59c22ebf3aaee90152e7cdb17ff5841c888fcd82","modified":1650458588970},{"_id":"themes/butterfly/layout/includes/third-party/comments/waline.pug","hash":"7648e4cb0b224f480b5f1356d64f62c9235f6723","modified":1650458588973},{"_id":"themes/butterfly/layout/includes/third-party/math/katex.pug","hash":"f9b00ead54573ba6e6eb33481588af144aab648d","modified":1650458588822},{"_id":"themes/butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":1650458588837},{"_id":"themes/butterfly/layout/includes/third-party/math/mathjax.pug","hash":"a47d8f9f593091cc91192c0c49deaa2c0d2317fd","modified":1650458588825},{"_id":"themes/butterfly/layout/includes/third-party/math/mermaid.pug","hash":"0a7587a0211011b5942edba2aa80d51169561d30","modified":1650458588912},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"04b2a5882e789a988e41d45abe606f0617b08e38","modified":1650458588511},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"e846ddfe4a63b15d1416f6055f5756af5e3da7c6","modified":1650458588507},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"f6506ccfd1ce994b9e53aa95588d0b6dbad11411","modified":1650458588557},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"ac811c1d6e0bf08aeb933ade1b9557e0c560d0c9","modified":1650458588501},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"9028efac78e4122acd734edd5ef9110ef3f05cd1","modified":1650458588547},{"_id":"themes/butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"5e32d903903c76db55a625640f9417d15a3a312f","modified":1650458588551},{"_id":"themes/butterfly/layout/includes/third-party/search/algolia.pug","hash":"c92df4f9d0611cf44c1a4491e226f242ec80f5bb","modified":1650458588879},{"_id":"themes/butterfly/layout/includes/third-party/search/index.pug","hash":"da3b9437d061ee68dbc383057db5c73034c49605","modified":1650458588921},{"_id":"themes/butterfly/layout/includes/third-party/search/local-search.pug","hash":"8ce336a4c8cae81b58ee26ff51040ca650ff1519","modified":1650458588885},{"_id":"themes/butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":1650458588907},{"_id":"themes/butterfly/layout/includes/third-party/share/addtoany.pug","hash":"309f51bc5302e72fc469d54c577fbcfe57fb07a8","modified":1650458588926},{"_id":"themes/butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":1650458588904},{"_id":"themes/butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":1650458589313},{"_id":"themes/butterfly/layout/includes/third-party/share/share-js.pug","hash":"006acc91ce25fc7c7d778ca043e970f57dc46b83","modified":1650458588933},{"_id":"themes/butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":1650458589315},{"_id":"themes/butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":1650458589303},{"_id":"themes/butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":1650458589320},{"_id":"themes/butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":1650458589299},{"_id":"themes/butterfly/source/img/photo-1540202404-fad3e2190841.jpeg","hash":"94b8f34ef3ad63f6fe56f92d8e8c5a21f313e7e4","modified":1650516355506},{"_id":"themes/butterfly/source/img/photo-1625990943295-6b06dbca7948.jpeg","hash":"11d8250a243450cb1ffe7d81efe734db80246c30","modified":1650721420109},{"_id":"themes/butterfly/source/font/tys5w31dsefi5v491d7t.ttf","hash":"15deb4ea647e1060e93504bc5c0c3b5bf0010ec8","modified":1650723740504},{"_id":"themes/butterfly/source/font/FZSJ.TTF","hash":"02f837925733b67c592577c35034ed8b8c4c58e0","modified":1650723081623},{"_id":"themes/butterfly/source/font/skxv68sn9lo0inhx6p0g.ttf","hash":"8ffcba4d84981e58e896f02bc677a732cf38c355","modified":1650723669801},{"_id":"themes/butterfly/source/font/igeodgtrm3w1budutaar.ttf","hash":"ea6eb0a6e2cdc64f46d21431c608737b8e69e714","modified":1650723485595},{"_id":"themes/butterfly/source/font/19nmu3k6x55llqlde6ex.ttf","hash":"720811a34b515e6528c6df6abf05c22f82d7c05b","modified":1650723593845},{"_id":"themes/butterfly/source/font/FZSJ-RUFSYXK.TTF","hash":"f8e23c06fb68b17398a09a0518c846ee9ed4b29d","modified":1650592538508}],"Category":[{"name":"IDE","_id":"cl2qzftgt000713nogch22268"},{"name":"MiddleWare","_id":"cl2qzftgy000g13no09egamdl"},{"name":"CodeCheck","_id":"cl2qzfth4000q13no2u2y1l4s"},{"name":"Tool","_id":"cl2qzfth6000x13no23061hyn"},{"name":"Java","_id":"cl2qzfthc001e13no1q5yhmfx"},{"name":"Docker","_id":"cl2qzftht002u13nobcasdppd"},{"name":"BDD","_id":"cl2qzfthw003913nob2q9f1l4"},{"name":"Git","_id":"cl2qzfti2003t13no9b85d39c"},{"name":"Go","_id":"cl2qzfti4004013no0id14ibz"},{"name":"Linux","_id":"cl2qzfti6004a13no6zuz4stf"},{"name":"Uml","_id":"cl2qzftil005n13no7resbm4e"}],"Data":[{"_id":"link","data":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}],"Page":[{"title":"关于我","date":"2022-03-13T14:10:03.000Z","_content":"\n> Life is hard and likes <b>SHIT</b>\n---\n\n## 本人\n- 瞎扯淡工程师\n- 什么都搞，什么都不精\n- java、python、go、docker、vue\n\n<p style=\"display: none\">http://legendtkl.com/booklist/</p>","source":"about/index.md","raw":"---\ntitle: 关于我\ndate: 2022-03-13 22:10:03\n---\n\n> Life is hard and likes <b>SHIT</b>\n---\n\n## 本人\n- 瞎扯淡工程师\n- 什么都搞，什么都不精\n- java、python、go、docker、vue\n\n<p style=\"display: none\">http://legendtkl.com/booklist/</p>","updated":"2022-04-20T12:43:11.926Z","path":"about/index.html","comments":1,"layout":"page","_id":"cl2qzftgi000013no5gcia8kx","content":"<blockquote>\n<p>Life is hard and likes <b>SHIT</b></p>\n</blockquote>\n<hr>\n<h2 id=\"本人\"><a href=\"#本人\" class=\"headerlink\" title=\"本人\"></a>本人</h2><ul>\n<li>瞎扯淡工程师</li>\n<li>什么都搞，什么都不精</li>\n<li>java、python、go、docker、vue</li>\n</ul>\n<p style=\"display: none\">http://legendtkl.com/booklist/</p>","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<blockquote>\n<p>Life is hard and likes <b>SHIT</b></p>\n</blockquote>\n<hr>\n<h2 id=\"本人\"><a href=\"#本人\" class=\"headerlink\" title=\"本人\"></a>本人</h2><ul>\n<li>瞎扯淡工程师</li>\n<li>什么都搞，什么都不精</li>\n<li>java、python、go、docker、vue</li>\n</ul>\n<p style=\"display: none\">http://legendtkl.com/booklist/</p>"},{"title":"分类","date":"2022-03-19T11:27:55.000Z","type":"categories","_content":"\n\n---","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2022-03-19 19:27:55\ntype: categories\n---\n\n\n---","updated":"2022-04-21T13:36:25.726Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cl2qzftgo000213noc5r4dg73","content":"<hr>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<hr>\n"},{"title":"书签","date":"2022-03-14T13:05:40.000Z","_content":"\n## 前沿技术\n- [美团技术团队](https://tech.meituan.com/)\n\n## Java相关\n- [Java全栈技术手册](https://pdai.tech/)\n- [Java IO模型](https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b)\n- [Mall商城 Github](https://github.com/macrozheng/mall-learning)\n- [Guava 教程](https://www.yiibai.com/guava/guava_charmatcher.html)\n- [Java设计模式](https://www.journaldev.com/1827/java-design-patterns-example-tutorial)\n- [Kan cloud 看云 - SpringBoot](https://www.kancloud.cn/explore)\n- [KeyCloak 文档](https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview)\n- [RabbitMQ 入门](https://blog.csdn.net/kavito/article/details/91403659)\n\n## Go相关\n- [地鼠文档](https://www.topgoer.cn/)\n- [Go 高级编程](https://chai2010.gitbooks.io/advanced-go-programming-book/content/)\n\n\n## 工具\n- [Draw IO](https://www.diagrams.net/)\n- [Idea Theme](https://plugins.jetbrains.com/search?tags=Theme)\n- [Typora picGo](https://juejin.cn/post/6847902225881104397)\n- [内网穿透](https://natapp.cn/)\n- [MacWK 软件](https://www.macwk.com/)\n- [Ip Address](https://www.ipaddress.com/)\n- [Jwt Token解析](https://jwt.io/)\n- [MVN Repository](https://mvnrepository.com/)\n- [icon 素材库](https://fontawesome.com/)\n- [font icons](https://www.iconfont.cn/)\n- [Alpine linux lib](https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14)\n- [梯子](https://shadowflys.us/user)\n- [菜鸟教程](https://www.runoob.com/)\n\n## 文档\n- [NestJS 文档](https://nestjs.bootcss.com/)\n- [Vuetify 文档](https://vuetifyjs.com/en/)\n- [CDNJS 搜索](https://cdnjs.com/libraries/vuetify/2.6.3)\n- [Flutter 文档](https://docs.flutter.dev/get-started/install)\n- [Openresty最佳实践](https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html)\n- [Nginx 官方文档](http://nginx.org/en/docs/)\n- [Nginx 运维手册](http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau)\n- [Nginx 极简教程](https://github.com/dunwu/nginx-tutorial)\n- [linux教程](http://c.biancheng.net/linux_tutorial/text_processing/)\n- [Hexo docs](https://hexo.io/docs/)\n- [GitBook简明教程](https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html)\n- [JUnit5 文档](https://doczhcn.gitbook.io/junit5/)\n- [Gauge 相关使用](https://blog.csdn.net/amoscn/article/details/77855944)\n- [Behave doc](https://behave.readthedocs.io/en/stable/install.html)\n- [Wiremock Doc](https://wiremock.org/docs/)\n- [Swagger入门实践](https://blog.csdn.net/luanpeng825485697/article/details/82819977)\n- [Docker Hub](https://hub.docker.com/)\n- [Docker 从入门到实践](https://yeasy.gitbook.io/docker_practice/)\n- [Docker到Kubernetes进阶](https://www.qikqiak.com/k8s-book/)\n\n## 面试\n- [常用网址、面试合集](https://istio.tech/about/)\n- [常见技术手册](https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764)\n\n\n\n\n\n\n\n\n\n\n","source":"bookmark/index.md","raw":"---\ntitle: 书签\ndate: 2022-03-14 21:05:40\n---\n\n## 前沿技术\n- [美团技术团队](https://tech.meituan.com/)\n\n## Java相关\n- [Java全栈技术手册](https://pdai.tech/)\n- [Java IO模型](https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b)\n- [Mall商城 Github](https://github.com/macrozheng/mall-learning)\n- [Guava 教程](https://www.yiibai.com/guava/guava_charmatcher.html)\n- [Java设计模式](https://www.journaldev.com/1827/java-design-patterns-example-tutorial)\n- [Kan cloud 看云 - SpringBoot](https://www.kancloud.cn/explore)\n- [KeyCloak 文档](https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview)\n- [RabbitMQ 入门](https://blog.csdn.net/kavito/article/details/91403659)\n\n## Go相关\n- [地鼠文档](https://www.topgoer.cn/)\n- [Go 高级编程](https://chai2010.gitbooks.io/advanced-go-programming-book/content/)\n\n\n## 工具\n- [Draw IO](https://www.diagrams.net/)\n- [Idea Theme](https://plugins.jetbrains.com/search?tags=Theme)\n- [Typora picGo](https://juejin.cn/post/6847902225881104397)\n- [内网穿透](https://natapp.cn/)\n- [MacWK 软件](https://www.macwk.com/)\n- [Ip Address](https://www.ipaddress.com/)\n- [Jwt Token解析](https://jwt.io/)\n- [MVN Repository](https://mvnrepository.com/)\n- [icon 素材库](https://fontawesome.com/)\n- [font icons](https://www.iconfont.cn/)\n- [Alpine linux lib](https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14)\n- [梯子](https://shadowflys.us/user)\n- [菜鸟教程](https://www.runoob.com/)\n\n## 文档\n- [NestJS 文档](https://nestjs.bootcss.com/)\n- [Vuetify 文档](https://vuetifyjs.com/en/)\n- [CDNJS 搜索](https://cdnjs.com/libraries/vuetify/2.6.3)\n- [Flutter 文档](https://docs.flutter.dev/get-started/install)\n- [Openresty最佳实践](https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html)\n- [Nginx 官方文档](http://nginx.org/en/docs/)\n- [Nginx 运维手册](http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau)\n- [Nginx 极简教程](https://github.com/dunwu/nginx-tutorial)\n- [linux教程](http://c.biancheng.net/linux_tutorial/text_processing/)\n- [Hexo docs](https://hexo.io/docs/)\n- [GitBook简明教程](https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html)\n- [JUnit5 文档](https://doczhcn.gitbook.io/junit5/)\n- [Gauge 相关使用](https://blog.csdn.net/amoscn/article/details/77855944)\n- [Behave doc](https://behave.readthedocs.io/en/stable/install.html)\n- [Wiremock Doc](https://wiremock.org/docs/)\n- [Swagger入门实践](https://blog.csdn.net/luanpeng825485697/article/details/82819977)\n- [Docker Hub](https://hub.docker.com/)\n- [Docker 从入门到实践](https://yeasy.gitbook.io/docker_practice/)\n- [Docker到Kubernetes进阶](https://www.qikqiak.com/k8s-book/)\n\n## 面试\n- [常用网址、面试合集](https://istio.tech/about/)\n- [常见技术手册](https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764)\n\n\n\n\n\n\n\n\n\n\n","updated":"2022-04-20T12:43:07.704Z","path":"bookmark/index.html","comments":1,"layout":"page","_id":"cl2qzftgs000513no4p60dqoh","content":"<h2 id=\"前沿技术\"><a href=\"#前沿技术\" class=\"headerlink\" title=\"前沿技术\"></a>前沿技术</h2><ul>\n<li><a href=\"https://tech.meituan.com/\">美团技术团队</a></li>\n</ul>\n<h2 id=\"Java相关\"><a href=\"#Java相关\" class=\"headerlink\" title=\"Java相关\"></a>Java相关</h2><ul>\n<li><a href=\"https://pdai.tech/\">Java全栈技术手册</a></li>\n<li><a href=\"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b\">Java IO模型</a></li>\n<li><a href=\"https://github.com/macrozheng/mall-learning\">Mall商城 Github</a></li>\n<li><a href=\"https://www.yiibai.com/guava/guava_charmatcher.html\">Guava 教程</a></li>\n<li><a href=\"https://www.journaldev.com/1827/java-design-patterns-example-tutorial\">Java设计模式</a></li>\n<li><a href=\"https://www.kancloud.cn/explore\">Kan cloud 看云 - SpringBoot</a></li>\n<li><a href=\"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview\">KeyCloak 文档</a></li>\n<li><a href=\"https://blog.csdn.net/kavito/article/details/91403659\">RabbitMQ 入门</a></li>\n</ul>\n<h2 id=\"Go相关\"><a href=\"#Go相关\" class=\"headerlink\" title=\"Go相关\"></a>Go相关</h2><ul>\n<li><a href=\"https://www.topgoer.cn/\">地鼠文档</a></li>\n<li><a href=\"https://chai2010.gitbooks.io/advanced-go-programming-book/content/\">Go 高级编程</a></li>\n</ul>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><ul>\n<li><a href=\"https://www.diagrams.net/\">Draw IO</a></li>\n<li><a href=\"https://plugins.jetbrains.com/search?tags=Theme\">Idea Theme</a></li>\n<li><a href=\"https://juejin.cn/post/6847902225881104397\">Typora picGo</a></li>\n<li><a href=\"https://natapp.cn/\">内网穿透</a></li>\n<li><a href=\"https://www.macwk.com/\">MacWK 软件</a></li>\n<li><a href=\"https://www.ipaddress.com/\">Ip Address</a></li>\n<li><a href=\"https://jwt.io/\">Jwt Token解析</a></li>\n<li><a href=\"https://mvnrepository.com/\">MVN Repository</a></li>\n<li><a href=\"https://fontawesome.com/\">icon 素材库</a></li>\n<li><a href=\"https://www.iconfont.cn/\">font icons</a></li>\n<li><a href=\"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14\">Alpine linux lib</a></li>\n<li><a href=\"https://shadowflys.us/user\">梯子</a></li>\n<li><a href=\"https://www.runoob.com/\">菜鸟教程</a></li>\n</ul>\n<h2 id=\"文档\"><a href=\"#文档\" class=\"headerlink\" title=\"文档\"></a>文档</h2><ul>\n<li><a href=\"https://nestjs.bootcss.com/\">NestJS 文档</a></li>\n<li><a href=\"https://vuetifyjs.com/en/\">Vuetify 文档</a></li>\n<li><a href=\"https://cdnjs.com/libraries/vuetify/2.6.3\">CDNJS 搜索</a></li>\n<li><a href=\"https://docs.flutter.dev/get-started/install\">Flutter 文档</a></li>\n<li><a href=\"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html\">Openresty最佳实践</a></li>\n<li><a href=\"http://nginx.org/en/docs/\">Nginx 官方文档</a></li>\n<li><a href=\"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau\">Nginx 运维手册</a></li>\n<li><a href=\"https://github.com/dunwu/nginx-tutorial\">Nginx 极简教程</a></li>\n<li><a href=\"http://c.biancheng.net/linux_tutorial/text_processing/\">linux教程</a></li>\n<li><a href=\"https://hexo.io/docs/\">Hexo docs</a></li>\n<li><a href=\"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html\">GitBook简明教程</a></li>\n<li><a href=\"https://doczhcn.gitbook.io/junit5/\">JUnit5 文档</a></li>\n<li><a href=\"https://blog.csdn.net/amoscn/article/details/77855944\">Gauge 相关使用</a></li>\n<li><a href=\"https://behave.readthedocs.io/en/stable/install.html\">Behave doc</a></li>\n<li><a href=\"https://wiremock.org/docs/\">Wiremock Doc</a></li>\n<li><a href=\"https://blog.csdn.net/luanpeng825485697/article/details/82819977\">Swagger入门实践</a></li>\n<li><a href=\"https://hub.docker.com/\">Docker Hub</a></li>\n<li><a href=\"https://yeasy.gitbook.io/docker_practice/\">Docker 从入门到实践</a></li>\n<li><a href=\"https://www.qikqiak.com/k8s-book/\">Docker到Kubernetes进阶</a></li>\n</ul>\n<h2 id=\"面试\"><a href=\"#面试\" class=\"headerlink\" title=\"面试\"></a>面试</h2><ul>\n<li><a href=\"https://istio.tech/about/\">常用网址、面试合集</a></li>\n<li><a href=\"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764\">常见技术手册</a></li>\n</ul>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"前沿技术\"><a href=\"#前沿技术\" class=\"headerlink\" title=\"前沿技术\"></a>前沿技术</h2><ul>\n<li><a href=\"https://tech.meituan.com/\">美团技术团队</a></li>\n</ul>\n<h2 id=\"Java相关\"><a href=\"#Java相关\" class=\"headerlink\" title=\"Java相关\"></a>Java相关</h2><ul>\n<li><a href=\"https://pdai.tech/\">Java全栈技术手册</a></li>\n<li><a href=\"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b\">Java IO模型</a></li>\n<li><a href=\"https://github.com/macrozheng/mall-learning\">Mall商城 Github</a></li>\n<li><a href=\"https://www.yiibai.com/guava/guava_charmatcher.html\">Guava 教程</a></li>\n<li><a href=\"https://www.journaldev.com/1827/java-design-patterns-example-tutorial\">Java设计模式</a></li>\n<li><a href=\"https://www.kancloud.cn/explore\">Kan cloud 看云 - SpringBoot</a></li>\n<li><a href=\"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview\">KeyCloak 文档</a></li>\n<li><a href=\"https://blog.csdn.net/kavito/article/details/91403659\">RabbitMQ 入门</a></li>\n</ul>\n<h2 id=\"Go相关\"><a href=\"#Go相关\" class=\"headerlink\" title=\"Go相关\"></a>Go相关</h2><ul>\n<li><a href=\"https://www.topgoer.cn/\">地鼠文档</a></li>\n<li><a href=\"https://chai2010.gitbooks.io/advanced-go-programming-book/content/\">Go 高级编程</a></li>\n</ul>\n<h2 id=\"工具\"><a href=\"#工具\" class=\"headerlink\" title=\"工具\"></a>工具</h2><ul>\n<li><a href=\"https://www.diagrams.net/\">Draw IO</a></li>\n<li><a href=\"https://plugins.jetbrains.com/search?tags=Theme\">Idea Theme</a></li>\n<li><a href=\"https://juejin.cn/post/6847902225881104397\">Typora picGo</a></li>\n<li><a href=\"https://natapp.cn/\">内网穿透</a></li>\n<li><a href=\"https://www.macwk.com/\">MacWK 软件</a></li>\n<li><a href=\"https://www.ipaddress.com/\">Ip Address</a></li>\n<li><a href=\"https://jwt.io/\">Jwt Token解析</a></li>\n<li><a href=\"https://mvnrepository.com/\">MVN Repository</a></li>\n<li><a href=\"https://fontawesome.com/\">icon 素材库</a></li>\n<li><a href=\"https://www.iconfont.cn/\">font icons</a></li>\n<li><a href=\"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14\">Alpine linux lib</a></li>\n<li><a href=\"https://shadowflys.us/user\">梯子</a></li>\n<li><a href=\"https://www.runoob.com/\">菜鸟教程</a></li>\n</ul>\n<h2 id=\"文档\"><a href=\"#文档\" class=\"headerlink\" title=\"文档\"></a>文档</h2><ul>\n<li><a href=\"https://nestjs.bootcss.com/\">NestJS 文档</a></li>\n<li><a href=\"https://vuetifyjs.com/en/\">Vuetify 文档</a></li>\n<li><a href=\"https://cdnjs.com/libraries/vuetify/2.6.3\">CDNJS 搜索</a></li>\n<li><a href=\"https://docs.flutter.dev/get-started/install\">Flutter 文档</a></li>\n<li><a href=\"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html\">Openresty最佳实践</a></li>\n<li><a href=\"http://nginx.org/en/docs/\">Nginx 官方文档</a></li>\n<li><a href=\"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau\">Nginx 运维手册</a></li>\n<li><a href=\"https://github.com/dunwu/nginx-tutorial\">Nginx 极简教程</a></li>\n<li><a href=\"http://c.biancheng.net/linux_tutorial/text_processing/\">linux教程</a></li>\n<li><a href=\"https://hexo.io/docs/\">Hexo docs</a></li>\n<li><a href=\"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html\">GitBook简明教程</a></li>\n<li><a href=\"https://doczhcn.gitbook.io/junit5/\">JUnit5 文档</a></li>\n<li><a href=\"https://blog.csdn.net/amoscn/article/details/77855944\">Gauge 相关使用</a></li>\n<li><a href=\"https://behave.readthedocs.io/en/stable/install.html\">Behave doc</a></li>\n<li><a href=\"https://wiremock.org/docs/\">Wiremock Doc</a></li>\n<li><a href=\"https://blog.csdn.net/luanpeng825485697/article/details/82819977\">Swagger入门实践</a></li>\n<li><a href=\"https://hub.docker.com/\">Docker Hub</a></li>\n<li><a href=\"https://yeasy.gitbook.io/docker_practice/\">Docker 从入门到实践</a></li>\n<li><a href=\"https://www.qikqiak.com/k8s-book/\">Docker到Kubernetes进阶</a></li>\n</ul>\n<h2 id=\"面试\"><a href=\"#面试\" class=\"headerlink\" title=\"面试\"></a>面试</h2><ul>\n<li><a href=\"https://istio.tech/about/\">常用网址、面试合集</a></li>\n<li><a href=\"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764\">常见技术手册</a></li>\n</ul>\n"},{"date":"2022-03-19T11:31:10.000Z","type":"link","_content":"","source":"link/index.md","raw":"---\ndate: 2022-03-19 19:31:10\ntype: link\n---\n","updated":"2022-04-20T12:43:11.917Z","path":"link/index.html","title":"","comments":1,"layout":"page","_id":"cl2qzftgu000813no3htl8qc0","content":"","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":""},{"title":"留言板","date":"2022-04-19T13:24:35.000Z","_content":"","source":"messageboard/index.md","raw":"---\ntitle: 留言板\ndate: 2022-04-19 21:24:35\n---\n","updated":"2022-04-21T14:01:37.298Z","path":"messageboard/index.html","comments":1,"layout":"page","_id":"cl2qzftgv000a13no3n0z1r4u","content":"","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":""},{"title":"标签分类","date":"2022-03-19T11:26:51.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签分类\ndate: 2022-03-19 19:26:51\ntype: tags\n---\n","updated":"2022-04-20T12:43:11.907Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cl2qzftgw000e13noh9utbidv","content":"","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":""}],"Post":[{"uuid":"bbaeabd0-c0ab-11ec-92a1-7557b2313227","title":"Hexo Hello world","abbrlink":"c8ba8fd6","_content":"Welcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","source":"_posts/hello-world.md","raw":"---\nuuid: bbaeabd0-c0ab-11ec-92a1-7557b2313227\ntitle: Hexo Hello world\ntags:\n  - hexo\nabbrlink: c8ba8fd6\n---\nWelcome to [Hexo](https://hexo.io/)! This is your very first post. Check [documentation](https://hexo.io/docs/) for more info. If you get any problems when using Hexo, you can find the answer in [troubleshooting](https://hexo.io/docs/troubleshooting.html) or you can ask me on [GitHub](https://github.com/hexojs/hexo/issues).\n\n## Quick Start\n\n### Create a new post\n\n``` bash\n$ hexo new \"My New Post\"\n```\n\nMore info: [Writing](https://hexo.io/docs/writing.html)\n\n### Run server\n\n``` bash\n$ hexo server\n```\n\nMore info: [Server](https://hexo.io/docs/server.html)\n\n### Generate static files\n\n``` bash\n$ hexo generate\n```\n\nMore info: [Generating](https://hexo.io/docs/generating.html)\n\n### Deploy to remote sites\n\n``` bash\n$ hexo deploy\n```\n\nMore info: [Deployment](https://hexo.io/docs/one-command-deployment.html)\n","slug":"hello-world","published":1,"date":"2022-04-20T12:41:20.962Z","updated":"2022-05-04T03:24:56.186Z","_id":"cl2qzftgl000113no075r7gte","comments":1,"layout":"post","photos":[],"link":"","content":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>Welcome to <a href=\"https://hexo.io/\">Hexo</a>! This is your very first post. Check <a href=\"https://hexo.io/docs/\">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href=\"https://hexo.io/docs/troubleshooting.html\">troubleshooting</a> or you can ask me on <a href=\"https://github.com/hexojs/hexo/issues\">GitHub</a>.</p>\n<h2 id=\"Quick-Start\"><a href=\"#Quick-Start\" class=\"headerlink\" title=\"Quick Start\"></a>Quick Start</h2><h3 id=\"Create-a-new-post\"><a href=\"#Create-a-new-post\" class=\"headerlink\" title=\"Create a new post\"></a>Create a new post</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo new <span class=\"string\">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/writing.html\">Writing</a></p>\n<h3 id=\"Run-server\"><a href=\"#Run-server\" class=\"headerlink\" title=\"Run server\"></a>Run server</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo server</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/server.html\">Server</a></p>\n<h3 id=\"Generate-static-files\"><a href=\"#Generate-static-files\" class=\"headerlink\" title=\"Generate static files\"></a>Generate static files</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo generate</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/generating.html\">Generating</a></p>\n<h3 id=\"Deploy-to-remote-sites\"><a href=\"#Deploy-to-remote-sites\" class=\"headerlink\" title=\"Deploy to remote sites\"></a>Deploy to remote sites</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ hexo deploy</span><br></pre></td></tr></table></figure>\n\n<p>More info: <a href=\"https://hexo.io/docs/one-command-deployment.html\">Deployment</a></p>\n"},{"uuid":"bbaed2e0-c0ab-11ec-92a1-7557b2313227","title":"idea下载源码报拒绝连接","abbrlink":"4060ceab","date":"2022-04-13T08:24:50.000Z","_content":"\n大家用idea开发的时候，下载源码可能出现`Caused by: java.rmi.ConnectException: Connection refused to host: 127.0.0.1`的错误。可在idea中做如下配置解决问题。\n\n`Preferences`->`Build`->`Build Tools`->`Maven`->`Importing`->`JDK for importer`做修改了在尝试。\n\n![image-20220413163757010](https://raw.githubusercontent.com/xzyup/image/master/202204131637914.png)\n\n","source":"_posts/idea下载源码报拒绝连接.md","raw":"---\nuuid: bbaed2e0-c0ab-11ec-92a1-7557b2313227\ntitle: idea下载源码报拒绝连接\ncategories: IDE\ntags: idea\nabbrlink: 4060ceab\ndate: 2022-04-13 16:24:50\n---\n\n大家用idea开发的时候，下载源码可能出现`Caused by: java.rmi.ConnectException: Connection refused to host: 127.0.0.1`的错误。可在idea中做如下配置解决问题。\n\n`Preferences`->`Build`->`Build Tools`->`Maven`->`Importing`->`JDK for importer`做修改了在尝试。\n\n![image-20220413163757010](https://raw.githubusercontent.com/xzyup/image/master/202204131637914.png)\n\n","slug":"idea下载源码报拒绝连接","published":1,"updated":"2022-05-04T03:25:04.305Z","_id":"cl2qzftgp000313nocmxk7cm2","comments":1,"layout":"post","photos":[],"link":"","content":"<p>大家用idea开发的时候，下载源码可能出现<code>Caused by: java.rmi.ConnectException: Connection refused to host: 127.0.0.1</code>的错误。可在idea中做如下配置解决问题。</p>\n<p><code>Preferences</code>-&gt;<code>Build</code>-&gt;<code>Build Tools</code>-&gt;<code>Maven</code>-&gt;<code>Importing</code>-&gt;<code>JDK for importer</code>做修改了在尝试。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202204131637914.png\" alt=\"image-20220413163757010\"></p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>大家用idea开发的时候，下载源码可能出现<code>Caused by: java.rmi.ConnectException: Connection refused to host: 127.0.0.1</code>的错误。可在idea中做如下配置解决问题。</p>\n<p><code>Preferences</code>-&gt;<code>Build</code>-&gt;<code>Build Tools</code>-&gt;<code>Maven</code>-&gt;<code>Importing</code>-&gt;<code>JDK for importer</code>做修改了在尝试。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202204131637914.png\" alt=\"image-20220413163757010\"></p>\n"},{"uuid":"bbaed2e1-c0ab-11ec-92a1-7557b2313227","title":"mac使用brew管理后台服务","abbrlink":"467b8595","date":"2022-04-10T10:06:55.000Z","_content":"\n在编写项目的时候，时常需要开启一些诸如 `nginx`、`mysql`、`redis` 等后台服务，然而每次开机都要重新手动去开启这些服务，而且有些还要保留一些终端窗口去维持服务。这时我们可以用到 `brew services` 来管理这些后台服务。\n\n## 查看services列表\n\n> **brew services list**\n>\n> Name      Status  User   File\n> kafka     none\n> openresty none\n> redis     started xiewei ~/Library/LaunchAgents/homebrew.mxcl.redis.plist\n> zookeeper none\n\n会返回一个表格，可以查看本地下载好的服务。\n\n- Name 服务名称\n- Status 服务状态\n- User 开启的用户\n- Plist 后缀名为`.plist`的xml文件存储的位置\n\n## 常用命令\n\n以mysql为例\n\n~~~bash\nbrew services run mysql # 启动mysql 服务\nbrew services start mysql # 启动 mysql 服务，并注册开机自启\nbrew services stop mysql # 停止 mysql 服务，并取消开机自启\nbrew services restart mysql # 重启 mysql 服务，并注册开机自启\nbrew services cleanup # 清除已卸载应用的无用配置\n~~~\n\n> 此处注册开机自启后，会自动创建`.plist`文件，取消开机自启后会自动删除该文件\n\n## 与launchtl的关系\n\nmac使用`launchctl`命令加载开机自动运行的服务，那么`launchctl`与`brew services`的关系是啥？\n\n> launchctl list\n\n会返回一串自启的服务，在里面我们可以看到我们用`brew services`设置的自启服务。\n\n> -\t0\tcom.google.keystone.user.agent\n> -\t0\tcom.apple.ap.adservicesd\n> 12823\t0\thomebrew.mxcl.redis\n\n由此，我们可以猜测`brew services`是`launchctl`的一个子集。\n","source":"_posts/mac使用brew管理后台服务.md","raw":"---\nuuid: bbaed2e1-c0ab-11ec-92a1-7557b2313227\ntitle: mac使用brew管理后台服务\ntags:\n  - mac\nabbrlink: 467b8595\ndate: 2022-04-10 18:06:55\n---\n\n在编写项目的时候，时常需要开启一些诸如 `nginx`、`mysql`、`redis` 等后台服务，然而每次开机都要重新手动去开启这些服务，而且有些还要保留一些终端窗口去维持服务。这时我们可以用到 `brew services` 来管理这些后台服务。\n\n## 查看services列表\n\n> **brew services list**\n>\n> Name      Status  User   File\n> kafka     none\n> openresty none\n> redis     started xiewei ~/Library/LaunchAgents/homebrew.mxcl.redis.plist\n> zookeeper none\n\n会返回一个表格，可以查看本地下载好的服务。\n\n- Name 服务名称\n- Status 服务状态\n- User 开启的用户\n- Plist 后缀名为`.plist`的xml文件存储的位置\n\n## 常用命令\n\n以mysql为例\n\n~~~bash\nbrew services run mysql # 启动mysql 服务\nbrew services start mysql # 启动 mysql 服务，并注册开机自启\nbrew services stop mysql # 停止 mysql 服务，并取消开机自启\nbrew services restart mysql # 重启 mysql 服务，并注册开机自启\nbrew services cleanup # 清除已卸载应用的无用配置\n~~~\n\n> 此处注册开机自启后，会自动创建`.plist`文件，取消开机自启后会自动删除该文件\n\n## 与launchtl的关系\n\nmac使用`launchctl`命令加载开机自动运行的服务，那么`launchctl`与`brew services`的关系是啥？\n\n> launchctl list\n\n会返回一串自启的服务，在里面我们可以看到我们用`brew services`设置的自启服务。\n\n> -\t0\tcom.google.keystone.user.agent\n> -\t0\tcom.apple.ap.adservicesd\n> 12823\t0\thomebrew.mxcl.redis\n\n由此，我们可以猜测`brew services`是`launchctl`的一个子集。\n","slug":"mac使用brew管理后台服务","published":1,"updated":"2022-05-04T03:25:18.441Z","_id":"cl2qzftgs000613nod0oh2si9","comments":1,"layout":"post","photos":[],"link":"","content":"<p>在编写项目的时候，时常需要开启一些诸如 <code>nginx</code>、<code>mysql</code>、<code>redis</code> 等后台服务，然而每次开机都要重新手动去开启这些服务，而且有些还要保留一些终端窗口去维持服务。这时我们可以用到 <code>brew services</code> 来管理这些后台服务。</p>\n<h2 id=\"查看services列表\"><a href=\"#查看services列表\" class=\"headerlink\" title=\"查看services列表\"></a>查看services列表</h2><blockquote>\n<p><strong>brew services list</strong></p>\n<p>Name      Status  User   File<br>kafka     none<br>openresty none<br>redis     started xiewei ~/Library/LaunchAgents/homebrew.mxcl.redis.plist<br>zookeeper none</p>\n</blockquote>\n<p>会返回一个表格，可以查看本地下载好的服务。</p>\n<ul>\n<li>Name 服务名称</li>\n<li>Status 服务状态</li>\n<li>User 开启的用户</li>\n<li>Plist 后缀名为<code>.plist</code>的xml文件存储的位置</li>\n</ul>\n<h2 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><p>以mysql为例</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew services run mysql <span class=\"comment\"># 启动mysql 服务</span></span><br><span class=\"line\">brew services start mysql <span class=\"comment\"># 启动 mysql 服务，并注册开机自启</span></span><br><span class=\"line\">brew services stop mysql <span class=\"comment\"># 停止 mysql 服务，并取消开机自启</span></span><br><span class=\"line\">brew services restart mysql <span class=\"comment\"># 重启 mysql 服务，并注册开机自启</span></span><br><span class=\"line\">brew services cleanup <span class=\"comment\"># 清除已卸载应用的无用配置</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>此处注册开机自启后，会自动创建<code>.plist</code>文件，取消开机自启后会自动删除该文件</p>\n</blockquote>\n<h2 id=\"与launchtl的关系\"><a href=\"#与launchtl的关系\" class=\"headerlink\" title=\"与launchtl的关系\"></a>与launchtl的关系</h2><p>mac使用<code>launchctl</code>命令加载开机自动运行的服务，那么<code>launchctl</code>与<code>brew services</code>的关系是啥？</p>\n<blockquote>\n<p>launchctl list</p>\n</blockquote>\n<p>会返回一串自启的服务，在里面我们可以看到我们用<code>brew services</code>设置的自启服务。</p>\n<blockquote>\n<ul>\n<li>   0    com.google.keystone.user.agent</li>\n<li>   0    com.apple.ap.adservicesd<br>12823    0    homebrew.mxcl.redis</li>\n</ul>\n</blockquote>\n<p>由此，我们可以猜测<code>brew services</code>是<code>launchctl</code>的一个子集。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>在编写项目的时候，时常需要开启一些诸如 <code>nginx</code>、<code>mysql</code>、<code>redis</code> 等后台服务，然而每次开机都要重新手动去开启这些服务，而且有些还要保留一些终端窗口去维持服务。这时我们可以用到 <code>brew services</code> 来管理这些后台服务。</p>\n<h2 id=\"查看services列表\"><a href=\"#查看services列表\" class=\"headerlink\" title=\"查看services列表\"></a>查看services列表</h2><blockquote>\n<p><strong>brew services list</strong></p>\n<p>Name      Status  User   File<br>kafka     none<br>openresty none<br>redis     started xiewei ~/Library/LaunchAgents/homebrew.mxcl.redis.plist<br>zookeeper none</p>\n</blockquote>\n<p>会返回一个表格，可以查看本地下载好的服务。</p>\n<ul>\n<li>Name 服务名称</li>\n<li>Status 服务状态</li>\n<li>User 开启的用户</li>\n<li>Plist 后缀名为<code>.plist</code>的xml文件存储的位置</li>\n</ul>\n<h2 id=\"常用命令\"><a href=\"#常用命令\" class=\"headerlink\" title=\"常用命令\"></a>常用命令</h2><p>以mysql为例</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew services run mysql <span class=\"comment\"># 启动mysql 服务</span></span><br><span class=\"line\">brew services start mysql <span class=\"comment\"># 启动 mysql 服务，并注册开机自启</span></span><br><span class=\"line\">brew services stop mysql <span class=\"comment\"># 停止 mysql 服务，并取消开机自启</span></span><br><span class=\"line\">brew services restart mysql <span class=\"comment\"># 重启 mysql 服务，并注册开机自启</span></span><br><span class=\"line\">brew services cleanup <span class=\"comment\"># 清除已卸载应用的无用配置</span></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>此处注册开机自启后，会自动创建<code>.plist</code>文件，取消开机自启后会自动删除该文件</p>\n</blockquote>\n<h2 id=\"与launchtl的关系\"><a href=\"#与launchtl的关系\" class=\"headerlink\" title=\"与launchtl的关系\"></a>与launchtl的关系</h2><p>mac使用<code>launchctl</code>命令加载开机自动运行的服务，那么<code>launchctl</code>与<code>brew services</code>的关系是啥？</p>\n<blockquote>\n<p>launchctl list</p>\n</blockquote>\n<p>会返回一串自启的服务，在里面我们可以看到我们用<code>brew services</code>设置的自启服务。</p>\n<blockquote>\n<ul>\n<li>   0    com.google.keystone.user.agent</li>\n<li>   0    com.apple.ap.adservicesd<br>12823    0    homebrew.mxcl.redis</li>\n</ul>\n</blockquote>\n<p>由此，我们可以猜测<code>brew services</code>是<code>launchctl</code>的一个子集。</p>\n"},{"uuid":"bbaed2e5-c0ab-11ec-92a1-7557b2313227","title":"nginx配置https","abbrlink":"a4734f","date":"2022-03-25T13:02:42.000Z","_content":"\n25 21:02:42\n---\n\n","source":"_posts/nginx配置https.md","raw":"---\nuuid: bbaed2e5-c0ab-11ec-92a1-7557b2313227\ntitle: nginx配置https\ncategories: MiddleWare\ntags:\n  - todo\nabbrlink: a4734f\ndate: 2022-03-25 21:02:42\n---\n\n25 21:02:42\n---\n\n","slug":"nginx配置https","published":1,"updated":"2022-04-20T13:47:00.270Z","_id":"cl2qzftgu000913no5ec64wd7","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"25-21-02-42\"><a href=\"#25-21-02-42\" class=\"headerlink\" title=\"25 21:02:42\"></a>25 21:02:42</h2>","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"25-21-02-42\"><a href=\"#25-21-02-42\" class=\"headerlink\" title=\"25 21:02:42\"></a>25 21:02:42</h2>"},{"uuid":"bbaed2e2-c0ab-11ec-92a1-7557b2313227","title":"mac安装常用软件","abbrlink":"b8a54843","date":"2022-04-10T08:19:02.000Z","_content":"\n\n\n\n\n\n\n# MAC常见编程软件安装\n\n\n\nmac系统可以使用`homebrew`工具进行安装，如果没有安装该工具，可以执行如下命令。\n\n> /bin/zsh -c \"$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)\"\n\n## 安装kafka\n\n使用`homebrew`安装kafka\n\n~~~bash\nbrew install kafka\n~~~\n\n安装完成后可以使用\n\n~~~bash\nbrew info kafka\n~~~\n\n可以查看安装路径`/usr/local/Cellar/kafka/3.1.0`和配置路径`/usr/local/etc/kafka/server.properties`\n\n### 启动kafka\n\nkafka依赖zookeeper，而kafa默认以安装依赖zookeeper.\n\n进入目录`/usr/local/Cellar/kafka/3.1.0/bin`执行脚本，启动zookeeper。\n\n~~~bash\nzookeeper-server-start /usr/local/etc/kafka/zookeeper.properties\n~~~\n\n在另外一个窗口，进入同样的目录`/usr/local/Cellar/kafka/3.1.0/bin`执行脚本\n\n~~~bash\nkafka-server-start /usr/local/etc/kafka/server.properties\n~~~\n\n### 测试消息\n\n1. 在启动一个控制窗口，进入同样的bin目录，执行命令\n\n   ~~~bash\n   kafka-topics --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test\n   ~~~\n\n   查看主题是否创建成功\n\n   ~~~bash\n   kafka-topics --list --bootstrap-server localhost:9092\n   ~~~\n\n2. 测试生产者（producer）\n\n   执行如下命令\n\n   ~~~bash\n   kafka-console-producer --broker-list localhost:9092 --topic test\n   ~~~\n\n3. 测试消费者\n\n   执行如下命令\n\n   ~~~bash\n   kafka-console-consumer --bootstrap-server localhost:9092 --topic test --from-beginning\n   ~~~\n\n### 注意事项 \n\n启动zookeeper的时候，可能出现如下的错误\n\n> /usr/local/etc/kafka/zookeeper.properties\n> /usr/local/Cellar/kafka/3.1.0/libexec/bin/kafka-run-class.sh: line 342: /usr/local/Cellar/kafka/3.1.0/bin/@@HOMEBREW_JAVA@@/bin/java: No such file or directory\n> /usr/local/Cellar/kafka/3.1.0/libexec/bin/kafka-run-class.sh: line 342: exec: /usr/local/Cellar/kafka/3.1.0/bin/@@HOMEBREW_JAVA@@/bin/java: cannot execute: No such file or directory\n\n可以重新执行如下命令\n\n~~~bash\nHOMEBREW_BOTTLE_DOMAIN= brew reinstall kafka    \n~~~\n\n> 相关的解释，可以参考如下连接\n>\n> https://github.com/Homebrew/discussions/discussions/2530\n\n\n\n## 安装nginx\n\n使用`$ brew install nginx`安装nginx，安装过程中报错\n\n```\ntar: Error opening archive: Failed to open '/Users/xiewei/Library/Caches/Homebrew/downloads/a70cee0678540d0eff9f1fe99b798891029e5142a719e17cf30a4f57cb5ddba6--pcre-8.45.big_sur.bottle.tar.gz'\n```\n\n需要替换homebrew-bottles\n\n首先要区分mac使用的是哪种终端环境，如果是`bash`,则执行\n\n```bash\necho 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles' >> ~/.bash_profile\n \nsource ~/.bash_profile\n```\n\n如果是`zsh`，则执行\n\n```bash\necho 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles' >> ~/.zshrc\n \nsource ~/.zshrc\n```\n\n重新执行`brew install nginx`就可以了。\n\n其他镜像替换\n\n- 替换 brew.git\n\n  ```\n  git -C \"$(brew --repo)\" remote set-url origin https://mirrors.ustc.edu.cn/brew.git\n  ```\n\n- 替换 homebrew-core.git\n\n  ```\n  git -C \"$(brew --repo homebrew/core)\" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git\n  ```\n\n- 替换 homebrew-cask.git\n\n  ```\n  git -C \"$(brew --repo homebrew/cask)\" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git\n  ```\n\n  备注：Homebrew 主要由四个部分组成: brew、homebrew-core 、homebrew-cask、homebrew-bottles，它们对应的功能如下：\n\n  | 组成             | 功能                                |\n  | ---------------- | ----------------------------------- |\n  | Homebrew         | 源代码仓库                          |\n  | homebrew-core    | Homebrew 核心源                     |\n  | homebrew-cask    | 提供macos应用和大型二进制文件的安装 |\n  | homebrew-bottles | 预编译二进制软件包                  |\n\n安装完成后：\n\n使用`brew info nginx`查看nginx相关信息\n\n```\nxiewei@xw ssl % brew info nginx\n\nnginx: stable 1.21.2 (bottled), HEAD\nHTTP(S) server and reverse proxy, and IMAP/POP3 proxy server\nhttps://nginx.org/\n/usr/local/Cellar/nginx/1.21.2 (26 files, 2.2MB) *\n  Poured from bottle on 2021-09-07 at 09:40:33\nFrom: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git/Formula/nginx.rb\nLicense: BSD-2-Clause\n==> Dependencies\nRequired: openssl@1.1 ✔, pcre ✔\n==> Options\n--HEAD\n\tInstall HEAD version\n==> Caveats\nDocroot is: /usr/local/var/www\n\nThe default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that\nnginx can run without sudo.\n\nnginx will load all files in /usr/local/etc/nginx/servers/.\n\nTo start nginx:\n  brew services start nginx\nOr, if you don't want/need a background service you can just run:\n  /usr/local/opt/nginx/bin/nginx -g daemon off;\n==> Analytics\ninstall: 36,549 (30 days), 108,707 (90 days), 503,356 (365 days)\ninstall-on-request: 36,473 (30 days), 108,471 (90 days), 500,591 (365 days)\nbuild-error: 0 (30 days)\n```\n\n可以使用`brew list nginx`查看nginx文件的位置\n\n```\nxiewei@xw ssl % brew list nginx\n\n/usr/local/Cellar/nginx/1.21.2/.bottle/etc/ (15 files)\n/usr/local/Cellar/nginx/1.21.2/bin/nginx\n/usr/local/Cellar/nginx/1.21.2/homebrew.mxcl.nginx.plist\n/usr/local/Cellar/nginx/1.21.2/homebrew.nginx.service\n/usr/local/Cellar/nginx/1.21.2/html -> ../../../var/www\n/usr/local/Cellar/nginx/1.21.2/share/man/man8/nginx.8\n/usr/local/Cellar/nginx/1.21.2/share/nginx/ (2 files)\n```\n\n由`brew info nginx`可以知道nginx的一些配置路径\n\n```\n/usr/local/etc/nginx/nginx.conf （配置文件路径）\n/usr/local/var/www （服务器默认路径）\n/usr/local/Cellar/nginx/1.19.10 （安装路径）\nnginx日志log的目录路径\n/usr/local/var/log/nginx\n```\n\n可以查看nginx安装路径`open /usr/local/Cellar/nginx`\n\n配置nginx环境变量：`vim ~/.zshrc`\n\n```\nexport NGINX_HOME=/usr/local/Cellar/nginx/1.21.2\nexport PATH=$NGINX_HOME/bin:$GO_HOME/bin:$JAVA_HOME/bin:$M2_HOME/bin:$FLUTTER_HOME/bin:$PATH\n```\n\n然后`source ~/.zshrc`\n\n`nginx` 启动nginx，nginx其他相关命令\n\n```bash\nnginx -s stop\nnginx -s reload\n```\n\n查看nginx相关日志\n\n```bash\ncd /usr/local/var/log/nginx\n# 查看访问日志\ncat access.log\n# 查看错误日志\ncat error.log \t\n```\n\n相关nginx启动等命令\n\n```bash\nps -ef | grep nginx\n# 查看配置 brew info nginx\nnginx -t\n# 启动\n$ sudo brew services start nginx\n\n# 暂停\n$ nginx -s stop\n\n# 重载配置文件\n$ nginx -s reload\n\n# 退出：\n$ nginx -s quit \n\n# 重启：\n$ nginx -s reopen\t\n```\n\n\n\n## 安装redis\n\n执行命令`brew install redis`\n\n### 查看安装和配置文件路径\n\n- 安装路径`/usr/local/Cellar/redis/6.2.6`\n- redis的配置文件`redis.conf`存放在`/usr/local/etc/redis.conf`\n\n### 启动redis服务\n\n>// 方式一 后台启动\n>\n>brew services start redis\n>\n>// 方式二 前台启动\n>\n>redis-server /usr/local/etc/redis.conf\n\n### 查看redis服务进程\n\n~~~bash\nps axu | grep redis\n~~~\n\n### redis-cli连接redis服务\n\n~~~bash\nredis-cli -h 127.0.0.1 -p 6379\n~~~\n\n可以看到如下\n\n> [17:45:53] xiewei :: xw  ➜  kafka/3.1.0/bin » redis-cli -h 127.0.0.1 -p 6379\n>\n> 127.0.0.1:6379> ping\n> PONG\n> 127.0.0.1:6379>\n\n### 关闭redis服务\n\n- 正确停止redis的方式应该是像redis发送`SHUTDOWN`命令\n\n  ~~~bash\n  redis-cli shutdown\n  ~~~\n\n- 也可以通过`homebrew`命令停止\n\n  ~~~bash\n  brew services stop redis\n  ~~~\n\n- 强行终止\n\n  ~~~bash\n  sudo pkill redis-server\n  ~~~\n\n### 注意事项\n\n使用`redis-server`默认是前台启动，如果想以后台方式运行，可以在`redis.conf`中将`daemonize no`改为`daemonize yes`。\n\n","source":"_posts/mac安装kafka.md","raw":"---\nuuid: bbaed2e2-c0ab-11ec-92a1-7557b2313227\ntitle: mac安装常用软件\ncategories: MiddleWare\ntags:\n  - mac\nabbrlink: b8a54843\ndate: 2022-04-10 16:19:02\n---\n\n\n\n\n\n\n\n# MAC常见编程软件安装\n\n\n\nmac系统可以使用`homebrew`工具进行安装，如果没有安装该工具，可以执行如下命令。\n\n> /bin/zsh -c \"$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)\"\n\n## 安装kafka\n\n使用`homebrew`安装kafka\n\n~~~bash\nbrew install kafka\n~~~\n\n安装完成后可以使用\n\n~~~bash\nbrew info kafka\n~~~\n\n可以查看安装路径`/usr/local/Cellar/kafka/3.1.0`和配置路径`/usr/local/etc/kafka/server.properties`\n\n### 启动kafka\n\nkafka依赖zookeeper，而kafa默认以安装依赖zookeeper.\n\n进入目录`/usr/local/Cellar/kafka/3.1.0/bin`执行脚本，启动zookeeper。\n\n~~~bash\nzookeeper-server-start /usr/local/etc/kafka/zookeeper.properties\n~~~\n\n在另外一个窗口，进入同样的目录`/usr/local/Cellar/kafka/3.1.0/bin`执行脚本\n\n~~~bash\nkafka-server-start /usr/local/etc/kafka/server.properties\n~~~\n\n### 测试消息\n\n1. 在启动一个控制窗口，进入同样的bin目录，执行命令\n\n   ~~~bash\n   kafka-topics --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test\n   ~~~\n\n   查看主题是否创建成功\n\n   ~~~bash\n   kafka-topics --list --bootstrap-server localhost:9092\n   ~~~\n\n2. 测试生产者（producer）\n\n   执行如下命令\n\n   ~~~bash\n   kafka-console-producer --broker-list localhost:9092 --topic test\n   ~~~\n\n3. 测试消费者\n\n   执行如下命令\n\n   ~~~bash\n   kafka-console-consumer --bootstrap-server localhost:9092 --topic test --from-beginning\n   ~~~\n\n### 注意事项 \n\n启动zookeeper的时候，可能出现如下的错误\n\n> /usr/local/etc/kafka/zookeeper.properties\n> /usr/local/Cellar/kafka/3.1.0/libexec/bin/kafka-run-class.sh: line 342: /usr/local/Cellar/kafka/3.1.0/bin/@@HOMEBREW_JAVA@@/bin/java: No such file or directory\n> /usr/local/Cellar/kafka/3.1.0/libexec/bin/kafka-run-class.sh: line 342: exec: /usr/local/Cellar/kafka/3.1.0/bin/@@HOMEBREW_JAVA@@/bin/java: cannot execute: No such file or directory\n\n可以重新执行如下命令\n\n~~~bash\nHOMEBREW_BOTTLE_DOMAIN= brew reinstall kafka    \n~~~\n\n> 相关的解释，可以参考如下连接\n>\n> https://github.com/Homebrew/discussions/discussions/2530\n\n\n\n## 安装nginx\n\n使用`$ brew install nginx`安装nginx，安装过程中报错\n\n```\ntar: Error opening archive: Failed to open '/Users/xiewei/Library/Caches/Homebrew/downloads/a70cee0678540d0eff9f1fe99b798891029e5142a719e17cf30a4f57cb5ddba6--pcre-8.45.big_sur.bottle.tar.gz'\n```\n\n需要替换homebrew-bottles\n\n首先要区分mac使用的是哪种终端环境，如果是`bash`,则执行\n\n```bash\necho 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles' >> ~/.bash_profile\n \nsource ~/.bash_profile\n```\n\n如果是`zsh`，则执行\n\n```bash\necho 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles' >> ~/.zshrc\n \nsource ~/.zshrc\n```\n\n重新执行`brew install nginx`就可以了。\n\n其他镜像替换\n\n- 替换 brew.git\n\n  ```\n  git -C \"$(brew --repo)\" remote set-url origin https://mirrors.ustc.edu.cn/brew.git\n  ```\n\n- 替换 homebrew-core.git\n\n  ```\n  git -C \"$(brew --repo homebrew/core)\" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git\n  ```\n\n- 替换 homebrew-cask.git\n\n  ```\n  git -C \"$(brew --repo homebrew/cask)\" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git\n  ```\n\n  备注：Homebrew 主要由四个部分组成: brew、homebrew-core 、homebrew-cask、homebrew-bottles，它们对应的功能如下：\n\n  | 组成             | 功能                                |\n  | ---------------- | ----------------------------------- |\n  | Homebrew         | 源代码仓库                          |\n  | homebrew-core    | Homebrew 核心源                     |\n  | homebrew-cask    | 提供macos应用和大型二进制文件的安装 |\n  | homebrew-bottles | 预编译二进制软件包                  |\n\n安装完成后：\n\n使用`brew info nginx`查看nginx相关信息\n\n```\nxiewei@xw ssl % brew info nginx\n\nnginx: stable 1.21.2 (bottled), HEAD\nHTTP(S) server and reverse proxy, and IMAP/POP3 proxy server\nhttps://nginx.org/\n/usr/local/Cellar/nginx/1.21.2 (26 files, 2.2MB) *\n  Poured from bottle on 2021-09-07 at 09:40:33\nFrom: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git/Formula/nginx.rb\nLicense: BSD-2-Clause\n==> Dependencies\nRequired: openssl@1.1 ✔, pcre ✔\n==> Options\n--HEAD\n\tInstall HEAD version\n==> Caveats\nDocroot is: /usr/local/var/www\n\nThe default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that\nnginx can run without sudo.\n\nnginx will load all files in /usr/local/etc/nginx/servers/.\n\nTo start nginx:\n  brew services start nginx\nOr, if you don't want/need a background service you can just run:\n  /usr/local/opt/nginx/bin/nginx -g daemon off;\n==> Analytics\ninstall: 36,549 (30 days), 108,707 (90 days), 503,356 (365 days)\ninstall-on-request: 36,473 (30 days), 108,471 (90 days), 500,591 (365 days)\nbuild-error: 0 (30 days)\n```\n\n可以使用`brew list nginx`查看nginx文件的位置\n\n```\nxiewei@xw ssl % brew list nginx\n\n/usr/local/Cellar/nginx/1.21.2/.bottle/etc/ (15 files)\n/usr/local/Cellar/nginx/1.21.2/bin/nginx\n/usr/local/Cellar/nginx/1.21.2/homebrew.mxcl.nginx.plist\n/usr/local/Cellar/nginx/1.21.2/homebrew.nginx.service\n/usr/local/Cellar/nginx/1.21.2/html -> ../../../var/www\n/usr/local/Cellar/nginx/1.21.2/share/man/man8/nginx.8\n/usr/local/Cellar/nginx/1.21.2/share/nginx/ (2 files)\n```\n\n由`brew info nginx`可以知道nginx的一些配置路径\n\n```\n/usr/local/etc/nginx/nginx.conf （配置文件路径）\n/usr/local/var/www （服务器默认路径）\n/usr/local/Cellar/nginx/1.19.10 （安装路径）\nnginx日志log的目录路径\n/usr/local/var/log/nginx\n```\n\n可以查看nginx安装路径`open /usr/local/Cellar/nginx`\n\n配置nginx环境变量：`vim ~/.zshrc`\n\n```\nexport NGINX_HOME=/usr/local/Cellar/nginx/1.21.2\nexport PATH=$NGINX_HOME/bin:$GO_HOME/bin:$JAVA_HOME/bin:$M2_HOME/bin:$FLUTTER_HOME/bin:$PATH\n```\n\n然后`source ~/.zshrc`\n\n`nginx` 启动nginx，nginx其他相关命令\n\n```bash\nnginx -s stop\nnginx -s reload\n```\n\n查看nginx相关日志\n\n```bash\ncd /usr/local/var/log/nginx\n# 查看访问日志\ncat access.log\n# 查看错误日志\ncat error.log \t\n```\n\n相关nginx启动等命令\n\n```bash\nps -ef | grep nginx\n# 查看配置 brew info nginx\nnginx -t\n# 启动\n$ sudo brew services start nginx\n\n# 暂停\n$ nginx -s stop\n\n# 重载配置文件\n$ nginx -s reload\n\n# 退出：\n$ nginx -s quit \n\n# 重启：\n$ nginx -s reopen\t\n```\n\n\n\n## 安装redis\n\n执行命令`brew install redis`\n\n### 查看安装和配置文件路径\n\n- 安装路径`/usr/local/Cellar/redis/6.2.6`\n- redis的配置文件`redis.conf`存放在`/usr/local/etc/redis.conf`\n\n### 启动redis服务\n\n>// 方式一 后台启动\n>\n>brew services start redis\n>\n>// 方式二 前台启动\n>\n>redis-server /usr/local/etc/redis.conf\n\n### 查看redis服务进程\n\n~~~bash\nps axu | grep redis\n~~~\n\n### redis-cli连接redis服务\n\n~~~bash\nredis-cli -h 127.0.0.1 -p 6379\n~~~\n\n可以看到如下\n\n> [17:45:53] xiewei :: xw  ➜  kafka/3.1.0/bin » redis-cli -h 127.0.0.1 -p 6379\n>\n> 127.0.0.1:6379> ping\n> PONG\n> 127.0.0.1:6379>\n\n### 关闭redis服务\n\n- 正确停止redis的方式应该是像redis发送`SHUTDOWN`命令\n\n  ~~~bash\n  redis-cli shutdown\n  ~~~\n\n- 也可以通过`homebrew`命令停止\n\n  ~~~bash\n  brew services stop redis\n  ~~~\n\n- 强行终止\n\n  ~~~bash\n  sudo pkill redis-server\n  ~~~\n\n### 注意事项\n\n使用`redis-server`默认是前台启动，如果想以后台方式运行，可以在`redis.conf`中将`daemonize no`改为`daemonize yes`。\n\n","slug":"mac安装kafka","published":1,"updated":"2022-05-04T03:25:28.866Z","_id":"cl2qzftgv000b13nognza5g87","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"MAC常见编程软件安装\"><a href=\"#MAC常见编程软件安装\" class=\"headerlink\" title=\"MAC常见编程软件安装\"></a>MAC常见编程软件安装</h1><p>mac系统可以使用<code>homebrew</code>工具进行安装，如果没有安装该工具，可以执行如下命令。</p>\n<blockquote>\n<p>/bin/zsh -c “$(curl -fsSL <a href=\"https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;\">https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;</a></p>\n</blockquote>\n<h2 id=\"安装kafka\"><a href=\"#安装kafka\" class=\"headerlink\" title=\"安装kafka\"></a>安装kafka</h2><p>使用<code>homebrew</code>安装kafka</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install kafka</span><br></pre></td></tr></table></figure>\n\n<p>安装完成后可以使用</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew info kafka</span><br></pre></td></tr></table></figure>\n\n<p>可以查看安装路径<code>/usr/local/Cellar/kafka/3.1.0</code>和配置路径<code>/usr/local/etc/kafka/server.properties</code></p>\n<h3 id=\"启动kafka\"><a href=\"#启动kafka\" class=\"headerlink\" title=\"启动kafka\"></a>启动kafka</h3><p>kafka依赖zookeeper，而kafa默认以安装依赖zookeeper.</p>\n<p>进入目录<code>/usr/local/Cellar/kafka/3.1.0/bin</code>执行脚本，启动zookeeper。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties</span><br></pre></td></tr></table></figure>\n\n<p>在另外一个窗口，进入同样的目录<code>/usr/local/Cellar/kafka/3.1.0/bin</code>执行脚本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-server-start /usr/local/etc/kafka/server.properties</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"测试消息\"><a href=\"#测试消息\" class=\"headerlink\" title=\"测试消息\"></a>测试消息</h3><ol>\n<li><p>在启动一个控制窗口，进入同样的bin目录，执行命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-topics --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic <span class=\"built_in\">test</span></span><br></pre></td></tr></table></figure>\n\n<p>查看主题是否创建成功</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-topics --list --bootstrap-server localhost:9092</span><br></pre></td></tr></table></figure></li>\n<li><p>测试生产者（producer）</p>\n<p>执行如下命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-console-producer --broker-list localhost:9092 --topic <span class=\"built_in\">test</span></span><br></pre></td></tr></table></figure></li>\n<li><p>测试消费者</p>\n<p>执行如下命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-console-consumer --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span> --from-beginning</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h3><p>启动zookeeper的时候，可能出现如下的错误</p>\n<blockquote>\n<p>/usr/local/etc/kafka/zookeeper.properties<br>/usr/local/Cellar/kafka/3.1.0/libexec/bin/kafka-run-class.sh: line 342: /usr/local/Cellar/kafka/3.1.0/bin/@@HOMEBREW_JAVA@@/bin/java: No such file or directory<br>/usr/local/Cellar/kafka/3.1.0/libexec/bin/kafka-run-class.sh: line 342: exec: /usr/local/Cellar/kafka/3.1.0/bin/@@HOMEBREW_JAVA@@/bin/java: cannot execute: No such file or directory</p>\n</blockquote>\n<p>可以重新执行如下命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HOMEBREW_BOTTLE_DOMAIN= brew reinstall kafka    </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>相关的解释，可以参考如下连接</p>\n<p><a href=\"https://github.com/Homebrew/discussions/discussions/2530\">https://github.com/Homebrew/discussions/discussions/2530</a></p>\n</blockquote>\n<h2 id=\"安装nginx\"><a href=\"#安装nginx\" class=\"headerlink\" title=\"安装nginx\"></a>安装nginx</h2><p>使用<code>$ brew install nginx</code>安装nginx，安装过程中报错</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar: Error opening archive: Failed to open &#x27;/Users/xiewei/Library/Caches/Homebrew/downloads/a70cee0678540d0eff9f1fe99b798891029e5142a719e17cf30a4f57cb5ddba6--pcre-8.45.big_sur.bottle.tar.gz&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>需要替换homebrew-bottles</p>\n<p>首先要区分mac使用的是哪种终端环境，如果是<code>bash</code>,则执行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles&#x27;</span> &gt;&gt; ~/.bash_profile</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>\n\n<p>如果是<code>zsh</code>，则执行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>\n\n<p>重新执行<code>brew install nginx</code>就可以了。</p>\n<p>其他镜像替换</p>\n<ul>\n<li><p>替换 brew.git</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git -C &quot;$(brew --repo)&quot; remote set-url origin https://mirrors.ustc.edu.cn/brew.git</span><br></pre></td></tr></table></figure></li>\n<li><p>替换 homebrew-core.git</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git -C &quot;$(brew --repo homebrew/core)&quot; remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git</span><br></pre></td></tr></table></figure></li>\n<li><p>替换 homebrew-cask.git</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git -C &quot;$(brew --repo homebrew/cask)&quot; remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git</span><br></pre></td></tr></table></figure>\n\n<p>备注：Homebrew 主要由四个部分组成: brew、homebrew-core 、homebrew-cask、homebrew-bottles，它们对应的功能如下：</p>\n<table>\n<thead>\n<tr>\n<th>组成</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Homebrew</td>\n<td>源代码仓库</td>\n</tr>\n<tr>\n<td>homebrew-core</td>\n<td>Homebrew 核心源</td>\n</tr>\n<tr>\n<td>homebrew-cask</td>\n<td>提供macos应用和大型二进制文件的安装</td>\n</tr>\n<tr>\n<td>homebrew-bottles</td>\n<td>预编译二进制软件包</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n<p>安装完成后：</p>\n<p>使用<code>brew info nginx</code>查看nginx相关信息</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xiewei@xw ssl % brew info nginx</span><br><span class=\"line\"></span><br><span class=\"line\">nginx: stable 1.21.2 (bottled), HEAD</span><br><span class=\"line\">HTTP(S) server and reverse proxy, and IMAP/POP3 proxy server</span><br><span class=\"line\">https://nginx.org/</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2 (26 files, 2.2MB) *</span><br><span class=\"line\">  Poured from bottle on 2021-09-07 at 09:40:33</span><br><span class=\"line\">From: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git/Formula/nginx.rb</span><br><span class=\"line\">License: BSD-2-Clause</span><br><span class=\"line\">==&gt; Dependencies</span><br><span class=\"line\">Required: openssl@1.1 ✔, pcre ✔</span><br><span class=\"line\">==&gt; Options</span><br><span class=\"line\">--HEAD</span><br><span class=\"line\">\tInstall HEAD version</span><br><span class=\"line\">==&gt; Caveats</span><br><span class=\"line\">Docroot is: /usr/local/var/www</span><br><span class=\"line\"></span><br><span class=\"line\">The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that</span><br><span class=\"line\">nginx can run without sudo.</span><br><span class=\"line\"></span><br><span class=\"line\">nginx will load all files in /usr/local/etc/nginx/servers/.</span><br><span class=\"line\"></span><br><span class=\"line\">To start nginx:</span><br><span class=\"line\">  brew services start nginx</span><br><span class=\"line\">Or, if you don&#x27;t want/need a background service you can just run:</span><br><span class=\"line\">  /usr/local/opt/nginx/bin/nginx -g daemon off;</span><br><span class=\"line\">==&gt; Analytics</span><br><span class=\"line\">install: 36,549 (30 days), 108,707 (90 days), 503,356 (365 days)</span><br><span class=\"line\">install-on-request: 36,473 (30 days), 108,471 (90 days), 500,591 (365 days)</span><br><span class=\"line\">build-error: 0 (30 days)</span><br></pre></td></tr></table></figure>\n\n<p>可以使用<code>brew list nginx</code>查看nginx文件的位置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xiewei@xw ssl % brew list nginx</span><br><span class=\"line\"></span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/.bottle/etc/ (15 files)</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/bin/nginx</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/homebrew.mxcl.nginx.plist</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/homebrew.nginx.service</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/html -&gt; ../../../var/www</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/share/man/man8/nginx.8</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/share/nginx/ (2 files)</span><br></pre></td></tr></table></figure>\n\n<p>由<code>brew info nginx</code>可以知道nginx的一些配置路径</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/etc/nginx/nginx.conf （配置文件路径）</span><br><span class=\"line\">/usr/local/var/www （服务器默认路径）</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.19.10 （安装路径）</span><br><span class=\"line\">nginx日志log的目录路径</span><br><span class=\"line\">/usr/local/var/log/nginx</span><br></pre></td></tr></table></figure>\n\n<p>可以查看nginx安装路径<code>open /usr/local/Cellar/nginx</code></p>\n<p>配置nginx环境变量：<code>vim ~/.zshrc</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export NGINX_HOME=/usr/local/Cellar/nginx/1.21.2</span><br><span class=\"line\">export PATH=$NGINX_HOME/bin:$GO_HOME/bin:$JAVA_HOME/bin:$M2_HOME/bin:$FLUTTER_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>\n\n<p>然后<code>source ~/.zshrc</code></p>\n<p><code>nginx</code> 启动nginx，nginx其他相关命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -s stop</span><br><span class=\"line\">nginx -s reload</span><br></pre></td></tr></table></figure>\n\n<p>查看nginx相关日志</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/var/log/nginx</span><br><span class=\"line\"><span class=\"comment\"># 查看访问日志</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> access.log</span><br><span class=\"line\"><span class=\"comment\"># 查看错误日志</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> error.log \t</span><br></pre></td></tr></table></figure>\n\n<p>相关nginx启动等命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -ef | grep nginx</span><br><span class=\"line\"><span class=\"comment\"># 查看配置 brew info nginx</span></span><br><span class=\"line\">nginx -t</span><br><span class=\"line\"><span class=\"comment\"># 启动</span></span><br><span class=\"line\">$ sudo brew services start nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 暂停</span></span><br><span class=\"line\">$ nginx -s stop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重载配置文件</span></span><br><span class=\"line\">$ nginx -s reload</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 退出：</span></span><br><span class=\"line\">$ nginx -s quit </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启：</span></span><br><span class=\"line\">$ nginx -s reopen\t</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"安装redis\"><a href=\"#安装redis\" class=\"headerlink\" title=\"安装redis\"></a>安装redis</h2><p>执行命令<code>brew install redis</code></p>\n<h3 id=\"查看安装和配置文件路径\"><a href=\"#查看安装和配置文件路径\" class=\"headerlink\" title=\"查看安装和配置文件路径\"></a>查看安装和配置文件路径</h3><ul>\n<li>安装路径<code>/usr/local/Cellar/redis/6.2.6</code></li>\n<li>redis的配置文件<code>redis.conf</code>存放在<code>/usr/local/etc/redis.conf</code></li>\n</ul>\n<h3 id=\"启动redis服务\"><a href=\"#启动redis服务\" class=\"headerlink\" title=\"启动redis服务\"></a>启动redis服务</h3><blockquote>\n<p>// 方式一 后台启动</p>\n<p>brew services start redis</p>\n<p>// 方式二 前台启动</p>\n<p>redis-server /usr/local/etc/redis.conf</p>\n</blockquote>\n<h3 id=\"查看redis服务进程\"><a href=\"#查看redis服务进程\" class=\"headerlink\" title=\"查看redis服务进程\"></a>查看redis服务进程</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps axu | grep redis</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"redis-cli连接redis服务\"><a href=\"#redis-cli连接redis服务\" class=\"headerlink\" title=\"redis-cli连接redis服务\"></a>redis-cli连接redis服务</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli -h 127.0.0.1 -p 6379</span><br></pre></td></tr></table></figure>\n\n<p>可以看到如下</p>\n<blockquote>\n<p>[17:45:53] xiewei :: xw  ➜  kafka/3.1.0/bin » redis-cli -h 127.0.0.1 -p 6379</p>\n<p>127.0.0.1:6379&gt; ping<br>PONG<br>127.0.0.1:6379&gt;</p>\n</blockquote>\n<h3 id=\"关闭redis服务\"><a href=\"#关闭redis服务\" class=\"headerlink\" title=\"关闭redis服务\"></a>关闭redis服务</h3><ul>\n<li><p>正确停止redis的方式应该是像redis发送<code>SHUTDOWN</code>命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli shutdown</span><br></pre></td></tr></table></figure></li>\n<li><p>也可以通过<code>homebrew</code>命令停止</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew services stop redis</span><br></pre></td></tr></table></figure></li>\n<li><p>强行终止</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo pkill redis-server</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"注意事项-1\"><a href=\"#注意事项-1\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h3><p>使用<code>redis-server</code>默认是前台启动，如果想以后台方式运行，可以在<code>redis.conf</code>中将<code>daemonize no</code>改为<code>daemonize yes</code>。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"MAC常见编程软件安装\"><a href=\"#MAC常见编程软件安装\" class=\"headerlink\" title=\"MAC常见编程软件安装\"></a>MAC常见编程软件安装</h1><p>mac系统可以使用<code>homebrew</code>工具进行安装，如果没有安装该工具，可以执行如下命令。</p>\n<blockquote>\n<p>/bin/zsh -c “$(curl -fsSL <a href=\"https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;\">https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;</a></p>\n</blockquote>\n<h2 id=\"安装kafka\"><a href=\"#安装kafka\" class=\"headerlink\" title=\"安装kafka\"></a>安装kafka</h2><p>使用<code>homebrew</code>安装kafka</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install kafka</span><br></pre></td></tr></table></figure>\n\n<p>安装完成后可以使用</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew info kafka</span><br></pre></td></tr></table></figure>\n\n<p>可以查看安装路径<code>/usr/local/Cellar/kafka/3.1.0</code>和配置路径<code>/usr/local/etc/kafka/server.properties</code></p>\n<h3 id=\"启动kafka\"><a href=\"#启动kafka\" class=\"headerlink\" title=\"启动kafka\"></a>启动kafka</h3><p>kafka依赖zookeeper，而kafa默认以安装依赖zookeeper.</p>\n<p>进入目录<code>/usr/local/Cellar/kafka/3.1.0/bin</code>执行脚本，启动zookeeper。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zookeeper-server-start /usr/local/etc/kafka/zookeeper.properties</span><br></pre></td></tr></table></figure>\n\n<p>在另外一个窗口，进入同样的目录<code>/usr/local/Cellar/kafka/3.1.0/bin</code>执行脚本</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-server-start /usr/local/etc/kafka/server.properties</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"测试消息\"><a href=\"#测试消息\" class=\"headerlink\" title=\"测试消息\"></a>测试消息</h3><ol>\n<li><p>在启动一个控制窗口，进入同样的bin目录，执行命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-topics --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic <span class=\"built_in\">test</span></span><br></pre></td></tr></table></figure>\n\n<p>查看主题是否创建成功</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-topics --list --bootstrap-server localhost:9092</span><br></pre></td></tr></table></figure></li>\n<li><p>测试生产者（producer）</p>\n<p>执行如下命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-console-producer --broker-list localhost:9092 --topic <span class=\"built_in\">test</span></span><br></pre></td></tr></table></figure></li>\n<li><p>测试消费者</p>\n<p>执行如下命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kafka-console-consumer --bootstrap-server localhost:9092 --topic <span class=\"built_in\">test</span> --from-beginning</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h3><p>启动zookeeper的时候，可能出现如下的错误</p>\n<blockquote>\n<p>/usr/local/etc/kafka/zookeeper.properties<br>/usr/local/Cellar/kafka/3.1.0/libexec/bin/kafka-run-class.sh: line 342: /usr/local/Cellar/kafka/3.1.0/bin/@@HOMEBREW_JAVA@@/bin/java: No such file or directory<br>/usr/local/Cellar/kafka/3.1.0/libexec/bin/kafka-run-class.sh: line 342: exec: /usr/local/Cellar/kafka/3.1.0/bin/@@HOMEBREW_JAVA@@/bin/java: cannot execute: No such file or directory</p>\n</blockquote>\n<p>可以重新执行如下命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HOMEBREW_BOTTLE_DOMAIN= brew reinstall kafka    </span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>相关的解释，可以参考如下连接</p>\n<p><a href=\"https://github.com/Homebrew/discussions/discussions/2530\">https://github.com/Homebrew/discussions/discussions/2530</a></p>\n</blockquote>\n<h2 id=\"安装nginx\"><a href=\"#安装nginx\" class=\"headerlink\" title=\"安装nginx\"></a>安装nginx</h2><p>使用<code>$ brew install nginx</code>安装nginx，安装过程中报错</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar: Error opening archive: Failed to open &#x27;/Users/xiewei/Library/Caches/Homebrew/downloads/a70cee0678540d0eff9f1fe99b798891029e5142a719e17cf30a4f57cb5ddba6--pcre-8.45.big_sur.bottle.tar.gz&#x27;</span><br></pre></td></tr></table></figure>\n\n<p>需要替换homebrew-bottles</p>\n<p>首先要区分mac使用的是哪种终端环境，如果是<code>bash</code>,则执行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles&#x27;</span> &gt;&gt; ~/.bash_profile</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure>\n\n<p>如果是<code>zsh</code>，则执行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> <span class=\"string\">&#x27;export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles&#x27;</span> &gt;&gt; ~/.zshrc</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"built_in\">source</span> ~/.zshrc</span><br></pre></td></tr></table></figure>\n\n<p>重新执行<code>brew install nginx</code>就可以了。</p>\n<p>其他镜像替换</p>\n<ul>\n<li><p>替换 brew.git</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git -C &quot;$(brew --repo)&quot; remote set-url origin https://mirrors.ustc.edu.cn/brew.git</span><br></pre></td></tr></table></figure></li>\n<li><p>替换 homebrew-core.git</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git -C &quot;$(brew --repo homebrew/core)&quot; remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git</span><br></pre></td></tr></table></figure></li>\n<li><p>替换 homebrew-cask.git</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git -C &quot;$(brew --repo homebrew/cask)&quot; remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git</span><br></pre></td></tr></table></figure>\n\n<p>备注：Homebrew 主要由四个部分组成: brew、homebrew-core 、homebrew-cask、homebrew-bottles，它们对应的功能如下：</p>\n<table>\n<thead>\n<tr>\n<th>组成</th>\n<th>功能</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>Homebrew</td>\n<td>源代码仓库</td>\n</tr>\n<tr>\n<td>homebrew-core</td>\n<td>Homebrew 核心源</td>\n</tr>\n<tr>\n<td>homebrew-cask</td>\n<td>提供macos应用和大型二进制文件的安装</td>\n</tr>\n<tr>\n<td>homebrew-bottles</td>\n<td>预编译二进制软件包</td>\n</tr>\n</tbody></table>\n</li>\n</ul>\n<p>安装完成后：</p>\n<p>使用<code>brew info nginx</code>查看nginx相关信息</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xiewei@xw ssl % brew info nginx</span><br><span class=\"line\"></span><br><span class=\"line\">nginx: stable 1.21.2 (bottled), HEAD</span><br><span class=\"line\">HTTP(S) server and reverse proxy, and IMAP/POP3 proxy server</span><br><span class=\"line\">https://nginx.org/</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2 (26 files, 2.2MB) *</span><br><span class=\"line\">  Poured from bottle on 2021-09-07 at 09:40:33</span><br><span class=\"line\">From: https://mirrors.tuna.tsinghua.edu.cn/git/homebrew/homebrew-core.git/Formula/nginx.rb</span><br><span class=\"line\">License: BSD-2-Clause</span><br><span class=\"line\">==&gt; Dependencies</span><br><span class=\"line\">Required: openssl@1.1 ✔, pcre ✔</span><br><span class=\"line\">==&gt; Options</span><br><span class=\"line\">--HEAD</span><br><span class=\"line\">\tInstall HEAD version</span><br><span class=\"line\">==&gt; Caveats</span><br><span class=\"line\">Docroot is: /usr/local/var/www</span><br><span class=\"line\"></span><br><span class=\"line\">The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that</span><br><span class=\"line\">nginx can run without sudo.</span><br><span class=\"line\"></span><br><span class=\"line\">nginx will load all files in /usr/local/etc/nginx/servers/.</span><br><span class=\"line\"></span><br><span class=\"line\">To start nginx:</span><br><span class=\"line\">  brew services start nginx</span><br><span class=\"line\">Or, if you don&#x27;t want/need a background service you can just run:</span><br><span class=\"line\">  /usr/local/opt/nginx/bin/nginx -g daemon off;</span><br><span class=\"line\">==&gt; Analytics</span><br><span class=\"line\">install: 36,549 (30 days), 108,707 (90 days), 503,356 (365 days)</span><br><span class=\"line\">install-on-request: 36,473 (30 days), 108,471 (90 days), 500,591 (365 days)</span><br><span class=\"line\">build-error: 0 (30 days)</span><br></pre></td></tr></table></figure>\n\n<p>可以使用<code>brew list nginx</code>查看nginx文件的位置</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xiewei@xw ssl % brew list nginx</span><br><span class=\"line\"></span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/.bottle/etc/ (15 files)</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/bin/nginx</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/homebrew.mxcl.nginx.plist</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/homebrew.nginx.service</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/html -&gt; ../../../var/www</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/share/man/man8/nginx.8</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.21.2/share/nginx/ (2 files)</span><br></pre></td></tr></table></figure>\n\n<p>由<code>brew info nginx</code>可以知道nginx的一些配置路径</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/etc/nginx/nginx.conf （配置文件路径）</span><br><span class=\"line\">/usr/local/var/www （服务器默认路径）</span><br><span class=\"line\">/usr/local/Cellar/nginx/1.19.10 （安装路径）</span><br><span class=\"line\">nginx日志log的目录路径</span><br><span class=\"line\">/usr/local/var/log/nginx</span><br></pre></td></tr></table></figure>\n\n<p>可以查看nginx安装路径<code>open /usr/local/Cellar/nginx</code></p>\n<p>配置nginx环境变量：<code>vim ~/.zshrc</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">export NGINX_HOME=/usr/local/Cellar/nginx/1.21.2</span><br><span class=\"line\">export PATH=$NGINX_HOME/bin:$GO_HOME/bin:$JAVA_HOME/bin:$M2_HOME/bin:$FLUTTER_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>\n\n<p>然后<code>source ~/.zshrc</code></p>\n<p><code>nginx</code> 启动nginx，nginx其他相关命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -s stop</span><br><span class=\"line\">nginx -s reload</span><br></pre></td></tr></table></figure>\n\n<p>查看nginx相关日志</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/local/var/log/nginx</span><br><span class=\"line\"><span class=\"comment\"># 查看访问日志</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> access.log</span><br><span class=\"line\"><span class=\"comment\"># 查看错误日志</span></span><br><span class=\"line\"><span class=\"built_in\">cat</span> error.log \t</span><br></pre></td></tr></table></figure>\n\n<p>相关nginx启动等命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps -ef | grep nginx</span><br><span class=\"line\"><span class=\"comment\"># 查看配置 brew info nginx</span></span><br><span class=\"line\">nginx -t</span><br><span class=\"line\"><span class=\"comment\"># 启动</span></span><br><span class=\"line\">$ sudo brew services start nginx</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 暂停</span></span><br><span class=\"line\">$ nginx -s stop</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重载配置文件</span></span><br><span class=\"line\">$ nginx -s reload</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 退出：</span></span><br><span class=\"line\">$ nginx -s quit </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重启：</span></span><br><span class=\"line\">$ nginx -s reopen\t</span><br></pre></td></tr></table></figure>\n\n\n\n<h2 id=\"安装redis\"><a href=\"#安装redis\" class=\"headerlink\" title=\"安装redis\"></a>安装redis</h2><p>执行命令<code>brew install redis</code></p>\n<h3 id=\"查看安装和配置文件路径\"><a href=\"#查看安装和配置文件路径\" class=\"headerlink\" title=\"查看安装和配置文件路径\"></a>查看安装和配置文件路径</h3><ul>\n<li>安装路径<code>/usr/local/Cellar/redis/6.2.6</code></li>\n<li>redis的配置文件<code>redis.conf</code>存放在<code>/usr/local/etc/redis.conf</code></li>\n</ul>\n<h3 id=\"启动redis服务\"><a href=\"#启动redis服务\" class=\"headerlink\" title=\"启动redis服务\"></a>启动redis服务</h3><blockquote>\n<p>// 方式一 后台启动</p>\n<p>brew services start redis</p>\n<p>// 方式二 前台启动</p>\n<p>redis-server /usr/local/etc/redis.conf</p>\n</blockquote>\n<h3 id=\"查看redis服务进程\"><a href=\"#查看redis服务进程\" class=\"headerlink\" title=\"查看redis服务进程\"></a>查看redis服务进程</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ps axu | grep redis</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"redis-cli连接redis服务\"><a href=\"#redis-cli连接redis服务\" class=\"headerlink\" title=\"redis-cli连接redis服务\"></a>redis-cli连接redis服务</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli -h 127.0.0.1 -p 6379</span><br></pre></td></tr></table></figure>\n\n<p>可以看到如下</p>\n<blockquote>\n<p>[17:45:53] xiewei :: xw  ➜  kafka/3.1.0/bin » redis-cli -h 127.0.0.1 -p 6379</p>\n<p>127.0.0.1:6379&gt; ping<br>PONG<br>127.0.0.1:6379&gt;</p>\n</blockquote>\n<h3 id=\"关闭redis服务\"><a href=\"#关闭redis服务\" class=\"headerlink\" title=\"关闭redis服务\"></a>关闭redis服务</h3><ul>\n<li><p>正确停止redis的方式应该是像redis发送<code>SHUTDOWN</code>命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">redis-cli shutdown</span><br></pre></td></tr></table></figure></li>\n<li><p>也可以通过<code>homebrew</code>命令停止</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew services stop redis</span><br></pre></td></tr></table></figure></li>\n<li><p>强行终止</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo pkill redis-server</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"注意事项-1\"><a href=\"#注意事项-1\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h3><p>使用<code>redis-server</code>默认是前台启动，如果想以后台方式运行，可以在<code>redis.conf</code>中将<code>daemonize no</code>改为<code>daemonize yes</code>。</p>\n"},{"uuid":"bbaed2e6-c0ab-11ec-92a1-7557b2313227","title":"sonarqube简单使用","abbrlink":"1646358","_content":"\n### sonarqube\n\n**登陆：admin/admin**\n\n- 进入sonarqube官网下载zip文件，解压。进入对应文件夹，修改wrapper.conf\n\n  ~~~xml\n  # 修改为对应java_home下java命令，请针对不同源码配置不同jdk版本\n  wrapper.java.command=/Library/Java/JavaVirtualMachines/jdk-11.0.11.jdk/Contents/Home/bin/java\n  ~~~\n\n- 进入bin目录，不同操作系统选择不通目录。本次为macos\n\n  ~~~\n  执行\n  lsof -i tcp:9000\n  kill -9 pid\n  ./sonar.sh stop\n  ./sonar.sh start\n  ~~~\n\n- [进入sonarqube首页](http://localhost:9000/)，依次进入Administration > Security > Force user authentication,将这个配置禁用，方便本地代码检测无密码。\n\n- idea集合sonarlint代码分析\n\n  idea结合sonar的话，可以下载sonarLint插件，操作步骤如下：\n\n  1. 进入idea ，进入插件安装，在插件市场中搜索sonarLint，点击进行安装后重启idea；\n  2. 配置sonarLint插件，设置settings中，查找到other settings,然后选择sonarLint General Setting ,在右侧的输入\n  3. 接下来输入要连接的服务器的登录信息，如输入token或者是使用账号和密码的方式\n  4. 配置当前的项目和sonar的关系,点击进入设置settings->other settings->SonarLint Project Settings\n  5. Bind to Server 选择刚才配置的服务器信息。SonarQube project的选择可以点击Search in list查看sonar仓库中配置的项目信息，完成选择以后点击ok即可\n  6. 代码分析，可以查看到当前的窗口中多了一个SonarLint的窗口（如无此窗口，可以点击analysis菜单进行查找），在其中选择report，点击文件夹图标，会弹窗提示，点击process之后即可进行项目分析。\n\n- 配置完idea插件后，idea命令行执行\n\n  ~~~\n  mvn clean install sonar:sonar\n  或者\n  mvn sonar:sonar \\\n   # 以下可以忽略\n    -Dsonar.projectKey={project-name} \\\n    -Dsonar.host.url=http://192.168.30.217:9000 \\\n    -Dsonar.login=10ac31fd0b091a4e9ee93e7351bc40f90f91acb3\n  ~~~\n\n  > 相关参考资料\n  >\n  > https://www.jianshu.com/p/b357cf94e4d2\n\n- TODO\n\n   - sonarqube与jenkins集合\n   - Sonarqube max 开机自启动设置\n   - Sonar.scanner 相关配置\n\n","source":"_posts/sonarqube.md","raw":"---\nuuid: bbaed2e6-c0ab-11ec-92a1-7557b2313227\ntitle: sonarqube简单使用\ncategories: CodeCheck\ntags:\n  - sonarqube\nabbrlink: '1646358'\n---\n\n### sonarqube\n\n**登陆：admin/admin**\n\n- 进入sonarqube官网下载zip文件，解压。进入对应文件夹，修改wrapper.conf\n\n  ~~~xml\n  # 修改为对应java_home下java命令，请针对不同源码配置不同jdk版本\n  wrapper.java.command=/Library/Java/JavaVirtualMachines/jdk-11.0.11.jdk/Contents/Home/bin/java\n  ~~~\n\n- 进入bin目录，不同操作系统选择不通目录。本次为macos\n\n  ~~~\n  执行\n  lsof -i tcp:9000\n  kill -9 pid\n  ./sonar.sh stop\n  ./sonar.sh start\n  ~~~\n\n- [进入sonarqube首页](http://localhost:9000/)，依次进入Administration > Security > Force user authentication,将这个配置禁用，方便本地代码检测无密码。\n\n- idea集合sonarlint代码分析\n\n  idea结合sonar的话，可以下载sonarLint插件，操作步骤如下：\n\n  1. 进入idea ，进入插件安装，在插件市场中搜索sonarLint，点击进行安装后重启idea；\n  2. 配置sonarLint插件，设置settings中，查找到other settings,然后选择sonarLint General Setting ,在右侧的输入\n  3. 接下来输入要连接的服务器的登录信息，如输入token或者是使用账号和密码的方式\n  4. 配置当前的项目和sonar的关系,点击进入设置settings->other settings->SonarLint Project Settings\n  5. Bind to Server 选择刚才配置的服务器信息。SonarQube project的选择可以点击Search in list查看sonar仓库中配置的项目信息，完成选择以后点击ok即可\n  6. 代码分析，可以查看到当前的窗口中多了一个SonarLint的窗口（如无此窗口，可以点击analysis菜单进行查找），在其中选择report，点击文件夹图标，会弹窗提示，点击process之后即可进行项目分析。\n\n- 配置完idea插件后，idea命令行执行\n\n  ~~~\n  mvn clean install sonar:sonar\n  或者\n  mvn sonar:sonar \\\n   # 以下可以忽略\n    -Dsonar.projectKey={project-name} \\\n    -Dsonar.host.url=http://192.168.30.217:9000 \\\n    -Dsonar.login=10ac31fd0b091a4e9ee93e7351bc40f90f91acb3\n  ~~~\n\n  > 相关参考资料\n  >\n  > https://www.jianshu.com/p/b357cf94e4d2\n\n- TODO\n\n   - sonarqube与jenkins集合\n   - Sonarqube max 开机自启动设置\n   - Sonar.scanner 相关配置\n\n","slug":"sonarqube","published":1,"date":"2022-04-20T12:41:20.931Z","updated":"2022-05-04T03:25:57.442Z","_id":"cl2qzftgx000f13no9p0phptv","comments":1,"layout":"post","photos":[],"link":"","content":"<h3 id=\"sonarqube\"><a href=\"#sonarqube\" class=\"headerlink\" title=\"sonarqube\"></a>sonarqube</h3><p><strong>登陆：admin/admin</strong></p>\n<ul>\n<li><p>进入sonarqube官网下载zip文件，解压。进入对应文件夹，修改wrapper.conf</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改为对应java_home下java命令，请针对不同源码配置不同jdk版本</span><br><span class=\"line\">wrapper.java.command=/Library/Java/JavaVirtualMachines/jdk-11.0.11.jdk/Contents/Home/bin/java</span><br></pre></td></tr></table></figure></li>\n<li><p>进入bin目录，不同操作系统选择不通目录。本次为macos</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">执行</span><br><span class=\"line\">lsof -i tcp:9000</span><br><span class=\"line\">kill -9 pid</span><br><span class=\"line\">./sonar.sh stop</span><br><span class=\"line\">./sonar.sh start</span><br></pre></td></tr></table></figure></li>\n<li><p><a href=\"http://localhost:9000/\">进入sonarqube首页</a>，依次进入Administration &gt; Security &gt; Force user authentication,将这个配置禁用，方便本地代码检测无密码。</p>\n</li>\n<li><p>idea集合sonarlint代码分析</p>\n<p>idea结合sonar的话，可以下载sonarLint插件，操作步骤如下：</p>\n<ol>\n<li>进入idea ，进入插件安装，在插件市场中搜索sonarLint，点击进行安装后重启idea；</li>\n<li>配置sonarLint插件，设置settings中，查找到other settings,然后选择sonarLint General Setting ,在右侧的输入</li>\n<li>接下来输入要连接的服务器的登录信息，如输入token或者是使用账号和密码的方式</li>\n<li>配置当前的项目和sonar的关系,点击进入设置settings-&gt;other settings-&gt;SonarLint Project Settings</li>\n<li>Bind to Server 选择刚才配置的服务器信息。SonarQube project的选择可以点击Search in list查看sonar仓库中配置的项目信息，完成选择以后点击ok即可</li>\n<li>代码分析，可以查看到当前的窗口中多了一个SonarLint的窗口（如无此窗口，可以点击analysis菜单进行查找），在其中选择report，点击文件夹图标，会弹窗提示，点击process之后即可进行项目分析。</li>\n</ol>\n</li>\n<li><p>配置完idea插件后，idea命令行执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean install sonar:sonar</span><br><span class=\"line\">或者</span><br><span class=\"line\">mvn sonar:sonar \\</span><br><span class=\"line\"> # 以下可以忽略</span><br><span class=\"line\">  -Dsonar.projectKey=&#123;project-name&#125; \\</span><br><span class=\"line\">  -Dsonar.host.url=http://192.168.30.217:9000 \\</span><br><span class=\"line\">  -Dsonar.login=10ac31fd0b091a4e9ee93e7351bc40f90f91acb3</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>相关参考资料</p>\n<p><a href=\"https://www.jianshu.com/p/b357cf94e4d2\">https://www.jianshu.com/p/b357cf94e4d2</a></p>\n</blockquote>\n</li>\n<li><p>TODO</p>\n<ul>\n<li>sonarqube与jenkins集合</li>\n<li>Sonarqube max 开机自启动设置</li>\n<li>Sonar.scanner 相关配置</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h3 id=\"sonarqube\"><a href=\"#sonarqube\" class=\"headerlink\" title=\"sonarqube\"></a>sonarqube</h3><p><strong>登陆：admin/admin</strong></p>\n<ul>\n<li><p>进入sonarqube官网下载zip文件，解压。进入对应文件夹，修改wrapper.conf</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 修改为对应java_home下java命令，请针对不同源码配置不同jdk版本</span><br><span class=\"line\">wrapper.java.command=/Library/Java/JavaVirtualMachines/jdk-11.0.11.jdk/Contents/Home/bin/java</span><br></pre></td></tr></table></figure></li>\n<li><p>进入bin目录，不同操作系统选择不通目录。本次为macos</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">执行</span><br><span class=\"line\">lsof -i tcp:9000</span><br><span class=\"line\">kill -9 pid</span><br><span class=\"line\">./sonar.sh stop</span><br><span class=\"line\">./sonar.sh start</span><br></pre></td></tr></table></figure></li>\n<li><p><a href=\"http://localhost:9000/\">进入sonarqube首页</a>，依次进入Administration &gt; Security &gt; Force user authentication,将这个配置禁用，方便本地代码检测无密码。</p>\n</li>\n<li><p>idea集合sonarlint代码分析</p>\n<p>idea结合sonar的话，可以下载sonarLint插件，操作步骤如下：</p>\n<ol>\n<li>进入idea ，进入插件安装，在插件市场中搜索sonarLint，点击进行安装后重启idea；</li>\n<li>配置sonarLint插件，设置settings中，查找到other settings,然后选择sonarLint General Setting ,在右侧的输入</li>\n<li>接下来输入要连接的服务器的登录信息，如输入token或者是使用账号和密码的方式</li>\n<li>配置当前的项目和sonar的关系,点击进入设置settings-&gt;other settings-&gt;SonarLint Project Settings</li>\n<li>Bind to Server 选择刚才配置的服务器信息。SonarQube project的选择可以点击Search in list查看sonar仓库中配置的项目信息，完成选择以后点击ok即可</li>\n<li>代码分析，可以查看到当前的窗口中多了一个SonarLint的窗口（如无此窗口，可以点击analysis菜单进行查找），在其中选择report，点击文件夹图标，会弹窗提示，点击process之后即可进行项目分析。</li>\n</ol>\n</li>\n<li><p>配置完idea插件后，idea命令行执行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean install sonar:sonar</span><br><span class=\"line\">或者</span><br><span class=\"line\">mvn sonar:sonar \\</span><br><span class=\"line\"> # 以下可以忽略</span><br><span class=\"line\">  -Dsonar.projectKey=&#123;project-name&#125; \\</span><br><span class=\"line\">  -Dsonar.host.url=http://192.168.30.217:9000 \\</span><br><span class=\"line\">  -Dsonar.login=10ac31fd0b091a4e9ee93e7351bc40f90f91acb3</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>相关参考资料</p>\n<p><a href=\"https://www.jianshu.com/p/b357cf94e4d2\">https://www.jianshu.com/p/b357cf94e4d2</a></p>\n</blockquote>\n</li>\n<li><p>TODO</p>\n<ul>\n<li>sonarqube与jenkins集合</li>\n<li>Sonarqube max 开机自启动设置</li>\n<li>Sonar.scanner 相关配置</li>\n</ul>\n</li>\n</ul>\n"},{"uuid":"bbaed2e7-c0ab-11ec-92a1-7557b2313227","title":"swagger-editor生成api文件","abbrlink":"3172e0c6","date":"2022-04-15T15:34:17.000Z","_content":"\n# 写在前面\n\n前面我们分别说了用`openapi`插件生成代码，用`swagger-ui`来测试api接口。那么这两个的前提都是`api`文档yaml文件的存在。那么我们怎么正确的编写\n\nyaml文件呢？今天的主角`swagger-editor`就能很方便的帮我们完成这件事，可以让我们编写的时候及时预览。\n\n当然，这里有个更牛的地方就是，你也可以使用预览界面去做api的测试。**可以编写边测试，而且可以实时修改api文档接口。简直不要太舒服。**\n\n## 参考文档\n\n> https://github.com/swagger-api/swagger-editor\n\n该项目也是一个`nodejs`项目，我们可以把项目down下来本来启动，但感觉也没这个必要。我们可以直接用docker启动，简单方便。\n\n\n\n## docker启动\n\n> docker pull swaggerapi/swagger-editor\n> docker run -d -p 80:8080 swaggerapi/swagger-editor\n\n当然也可以想swagger-ui一样，配置`URL`或`SWAGGER_FILE`(两个同时存在，`URL`优先级更高)、`BASE_URL`访问路径。\n\n例如如下\n\n> docker run -d -p 80:8080 --name swagger-editor -e URL=\"https://petstore3.swagger.io/api/v3/openapi.json\" swaggerapi/swagger-editor\n>\n> docker run -d -p 80:8080 --name swagger-editor -v $(pwd):/tmp -e SWAGGER_FILE=/tmp/swagger.json swaggerapi/swagger-editor\n>\n> docker run -d -p 80:8080 --name swagger-editor -e BASE_URL=/swagger-editor swaggerapi/swagger-editor\n\n\n\n## 关于api文档说明\n\n那么有人肯定会问，`openapi`文档的书写要求，字段说明是哪些。可以参考如下。\n\n> https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.3.md\n\n其实我也写的少，只是项目中看别人用到了，所有需要编写的时候，大概还是得看文档来写。\n\n\n\n## 更多\n\n当你访问编辑页面，你会看到工具栏还有生成服务端和客户端代码的功能。可谓是真的强大，大家可以研究下是怎么做的。\n\n不过我看到官方有另外两个项目：\n\n- `https://github.com/swagger-api/swagger-codegen`\n- `https://github.com/swagger-api/swagger-parser`\n\n大致应该是基于这两个项目做的。有兴趣的朋友可以参考下。\n\n","source":"_posts/swagger-editor生成api文件.md","raw":"---\nuuid: bbaed2e7-c0ab-11ec-92a1-7557b2313227\ntitle: swagger-editor生成api文件\ncategories: Tool\ntags:\n  - swagger\nabbrlink: 3172e0c6\ndate: 2022-04-15 23:34:17\n---\n\n# 写在前面\n\n前面我们分别说了用`openapi`插件生成代码，用`swagger-ui`来测试api接口。那么这两个的前提都是`api`文档yaml文件的存在。那么我们怎么正确的编写\n\nyaml文件呢？今天的主角`swagger-editor`就能很方便的帮我们完成这件事，可以让我们编写的时候及时预览。\n\n当然，这里有个更牛的地方就是，你也可以使用预览界面去做api的测试。**可以编写边测试，而且可以实时修改api文档接口。简直不要太舒服。**\n\n## 参考文档\n\n> https://github.com/swagger-api/swagger-editor\n\n该项目也是一个`nodejs`项目，我们可以把项目down下来本来启动，但感觉也没这个必要。我们可以直接用docker启动，简单方便。\n\n\n\n## docker启动\n\n> docker pull swaggerapi/swagger-editor\n> docker run -d -p 80:8080 swaggerapi/swagger-editor\n\n当然也可以想swagger-ui一样，配置`URL`或`SWAGGER_FILE`(两个同时存在，`URL`优先级更高)、`BASE_URL`访问路径。\n\n例如如下\n\n> docker run -d -p 80:8080 --name swagger-editor -e URL=\"https://petstore3.swagger.io/api/v3/openapi.json\" swaggerapi/swagger-editor\n>\n> docker run -d -p 80:8080 --name swagger-editor -v $(pwd):/tmp -e SWAGGER_FILE=/tmp/swagger.json swaggerapi/swagger-editor\n>\n> docker run -d -p 80:8080 --name swagger-editor -e BASE_URL=/swagger-editor swaggerapi/swagger-editor\n\n\n\n## 关于api文档说明\n\n那么有人肯定会问，`openapi`文档的书写要求，字段说明是哪些。可以参考如下。\n\n> https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.3.md\n\n其实我也写的少，只是项目中看别人用到了，所有需要编写的时候，大概还是得看文档来写。\n\n\n\n## 更多\n\n当你访问编辑页面，你会看到工具栏还有生成服务端和客户端代码的功能。可谓是真的强大，大家可以研究下是怎么做的。\n\n不过我看到官方有另外两个项目：\n\n- `https://github.com/swagger-api/swagger-codegen`\n- `https://github.com/swagger-api/swagger-parser`\n\n大致应该是基于这两个项目做的。有兴趣的朋友可以参考下。\n\n","slug":"swagger-editor生成api文件","published":1,"updated":"2022-05-04T03:26:04.540Z","_id":"cl2qzftgy000h13no9tft7s94","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h1><p>前面我们分别说了用<code>openapi</code>插件生成代码，用<code>swagger-ui</code>来测试api接口。那么这两个的前提都是<code>api</code>文档yaml文件的存在。那么我们怎么正确的编写</p>\n<p>yaml文件呢？今天的主角<code>swagger-editor</code>就能很方便的帮我们完成这件事，可以让我们编写的时候及时预览。</p>\n<p>当然，这里有个更牛的地方就是，你也可以使用预览界面去做api的测试。<strong>可以编写边测试，而且可以实时修改api文档接口。简直不要太舒服。</strong></p>\n<h2 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h2><blockquote>\n<p><a href=\"https://github.com/swagger-api/swagger-editor\">https://github.com/swagger-api/swagger-editor</a></p>\n</blockquote>\n<p>该项目也是一个<code>nodejs</code>项目，我们可以把项目down下来本来启动，但感觉也没这个必要。我们可以直接用docker启动，简单方便。</p>\n<h2 id=\"docker启动\"><a href=\"#docker启动\" class=\"headerlink\" title=\"docker启动\"></a>docker启动</h2><blockquote>\n<p>docker pull swaggerapi/swagger-editor<br>docker run -d -p 80:8080 swaggerapi/swagger-editor</p>\n</blockquote>\n<p>当然也可以想swagger-ui一样，配置<code>URL</code>或<code>SWAGGER_FILE</code>(两个同时存在，<code>URL</code>优先级更高)、<code>BASE_URL</code>访问路径。</p>\n<p>例如如下</p>\n<blockquote>\n<p>docker run -d -p 80:8080 –name swagger-editor -e URL=”<a href=\"https://petstore3.swagger.io/api/v3/openapi.json&quot;\">https://petstore3.swagger.io/api/v3/openapi.json&quot;</a> swaggerapi/swagger-editor</p>\n<p>docker run -d -p 80:8080 –name swagger-editor -v $(pwd):/tmp -e SWAGGER_FILE=/tmp/swagger.json swaggerapi/swagger-editor</p>\n<p>docker run -d -p 80:8080 –name swagger-editor -e BASE_URL=/swagger-editor swaggerapi/swagger-editor</p>\n</blockquote>\n<h2 id=\"关于api文档说明\"><a href=\"#关于api文档说明\" class=\"headerlink\" title=\"关于api文档说明\"></a>关于api文档说明</h2><p>那么有人肯定会问，<code>openapi</code>文档的书写要求，字段说明是哪些。可以参考如下。</p>\n<blockquote>\n<p><a href=\"https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.3.md\">https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.3.md</a></p>\n</blockquote>\n<p>其实我也写的少，只是项目中看别人用到了，所有需要编写的时候，大概还是得看文档来写。</p>\n<h2 id=\"更多\"><a href=\"#更多\" class=\"headerlink\" title=\"更多\"></a>更多</h2><p>当你访问编辑页面，你会看到工具栏还有生成服务端和客户端代码的功能。可谓是真的强大，大家可以研究下是怎么做的。</p>\n<p>不过我看到官方有另外两个项目：</p>\n<ul>\n<li><code>https://github.com/swagger-api/swagger-codegen</code></li>\n<li><code>https://github.com/swagger-api/swagger-parser</code></li>\n</ul>\n<p>大致应该是基于这两个项目做的。有兴趣的朋友可以参考下。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h1><p>前面我们分别说了用<code>openapi</code>插件生成代码，用<code>swagger-ui</code>来测试api接口。那么这两个的前提都是<code>api</code>文档yaml文件的存在。那么我们怎么正确的编写</p>\n<p>yaml文件呢？今天的主角<code>swagger-editor</code>就能很方便的帮我们完成这件事，可以让我们编写的时候及时预览。</p>\n<p>当然，这里有个更牛的地方就是，你也可以使用预览界面去做api的测试。<strong>可以编写边测试，而且可以实时修改api文档接口。简直不要太舒服。</strong></p>\n<h2 id=\"参考文档\"><a href=\"#参考文档\" class=\"headerlink\" title=\"参考文档\"></a>参考文档</h2><blockquote>\n<p><a href=\"https://github.com/swagger-api/swagger-editor\">https://github.com/swagger-api/swagger-editor</a></p>\n</blockquote>\n<p>该项目也是一个<code>nodejs</code>项目，我们可以把项目down下来本来启动，但感觉也没这个必要。我们可以直接用docker启动，简单方便。</p>\n<h2 id=\"docker启动\"><a href=\"#docker启动\" class=\"headerlink\" title=\"docker启动\"></a>docker启动</h2><blockquote>\n<p>docker pull swaggerapi/swagger-editor<br>docker run -d -p 80:8080 swaggerapi/swagger-editor</p>\n</blockquote>\n<p>当然也可以想swagger-ui一样，配置<code>URL</code>或<code>SWAGGER_FILE</code>(两个同时存在，<code>URL</code>优先级更高)、<code>BASE_URL</code>访问路径。</p>\n<p>例如如下</p>\n<blockquote>\n<p>docker run -d -p 80:8080 –name swagger-editor -e URL=”<a href=\"https://petstore3.swagger.io/api/v3/openapi.json&quot;\">https://petstore3.swagger.io/api/v3/openapi.json&quot;</a> swaggerapi/swagger-editor</p>\n<p>docker run -d -p 80:8080 –name swagger-editor -v $(pwd):/tmp -e SWAGGER_FILE=/tmp/swagger.json swaggerapi/swagger-editor</p>\n<p>docker run -d -p 80:8080 –name swagger-editor -e BASE_URL=/swagger-editor swaggerapi/swagger-editor</p>\n</blockquote>\n<h2 id=\"关于api文档说明\"><a href=\"#关于api文档说明\" class=\"headerlink\" title=\"关于api文档说明\"></a>关于api文档说明</h2><p>那么有人肯定会问，<code>openapi</code>文档的书写要求，字段说明是哪些。可以参考如下。</p>\n<blockquote>\n<p><a href=\"https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.3.md\">https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.3.md</a></p>\n</blockquote>\n<p>其实我也写的少，只是项目中看别人用到了，所有需要编写的时候，大概还是得看文档来写。</p>\n<h2 id=\"更多\"><a href=\"#更多\" class=\"headerlink\" title=\"更多\"></a>更多</h2><p>当你访问编辑页面，你会看到工具栏还有生成服务端和客户端代码的功能。可谓是真的强大，大家可以研究下是怎么做的。</p>\n<p>不过我看到官方有另外两个项目：</p>\n<ul>\n<li><code>https://github.com/swagger-api/swagger-codegen</code></li>\n<li><code>https://github.com/swagger-api/swagger-parser</code></li>\n</ul>\n<p>大致应该是基于这两个项目做的。有兴趣的朋友可以参考下。</p>\n"},{"uuid":"bbaed2e9-c0ab-11ec-92a1-7557b2313227","title":"基于openapi的yaml文件快速生成代码","abbrlink":"543da2f4","date":"2022-03-29T14:08:29.000Z","_content":"# 写在前面\n有时候项目在需求对接或是澄清阶段，客户或是技术经理会把需求的api接口通过yaml定义出来，也就是我们所说的`swagger-api`文件。这样开发人员能更清楚的了解到接口的入参和出参，方便开发。\n这时候，你可能觉得自己根据yaml手写model和api定义接口就可以了，我以前也是这么做的，但是看到团队的代码，发现有一种更简洁的方法,那就是根据`openapi-generator`自动生成java代码，这样就方便多了，简直不要太爽了。\n\n# 官方资料\n官方参考资料可以参考如下。\n> https://github.com/OpenAPITools/openapi-generator\n\n本篇所讲的是基于`openapi-generator`的maven插件，参考地址如下\n> https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin\n\n截止当前使用版本为：`v5.4.0`\n\n# 具体步骤\n\n## 添加pom依赖\n**build 块**\n```xml\n<!-- build 块 -->\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.openapitools</groupId>\n            <artifactId>openapi-generator-maven-plugin</artifactId>\n            <version>5.4.0</version>\n            <executions>\n                <execution>\n                    <id>generatePetEtc</id>\n                    <goals>\n                        <goal>generate</goal>\n                    </goals>\n                    <configuration>\n                        <inputSpec>${project.basedir}/doc/api.yaml</inputSpec>\n                        <generatorName>spring</generatorName>\n                        <apiPackage>org.example.api</apiPackage>\n                        <modelPackage>org.example.model</modelPackage>\n                        <!-- 这里会将代码生成在src目录，实际中我们可以省略该处 那么代码会生成在target目录 -->\n                        <output>${project.basedir}</output>\n                        <supportingFilesToGenerate>ApiUtil.java</supportingFilesToGenerate>\n                        <configOptions>\n                            <skipDefaultInterface>true</skipDefaultInterface>\n                            <interfaceOnly>true</interfaceOnly>\n                        </configOptions>\n                    </configuration>\n                </execution>\n            </executions>\n        </plugin>\n    </plugins>\n</build>\n```\n**dependencies 块**\n\n注意这里依赖以下模块，不然会报错\n- web 依赖http\n- validation-api 依赖api的校验部分\n- swagger-annotations 代码生成的依赖\n- jackson-databind-nullable 数据绑定依赖\n\n```xml\n<dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n    \n        <dependency>\n            <groupId>javax.validation</groupId>\n            <artifactId>validation-api</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>io.swagger.core.v3</groupId>\n            <artifactId>swagger-annotations</artifactId>\n            <version>2.1.13</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.openapitools</groupId>\n            <artifactId>jackson-databind-nullable</artifactId>\n            <version>0.2.2</version>\n            <scope>compile</scope>\n        </dependency>\n</dependencies>\n```\n\n## build块解读\n- <inputSpec>${project.basedir}/doc/api.yaml</inputSpec>\n  - 项目doc目录下的api.yaml\n  - 关于api.yaml写法可以参考官方文档 \n  > https://github.com/OpenAPITools/openapi-generator/blob/master/modules/openapi-generator/src/test/resources/3_0/petstore.yaml\n- <output>${project.basedir}</output>\n  实践中最好不要改配置，这样代码生成都在target目录下，不会影响源代码。\n- `<execution>`块可以写多个\n\n\n## 执行 mvn clean package\n执行成功后,切换到 /target/generated-sources/openapi/src/main/java/org/example   会看到生成的model和api接口。odel和api接口。","source":"_posts/基于openapi的yaml文件快速生成代码.md","raw":"---\nuuid: bbaed2e9-c0ab-11ec-92a1-7557b2313227\ntitle: 基于openapi的yaml文件快速生成代码\ncategories: Tool\ntags:\n  - openapi\nabbrlink: 543da2f4\ndate: 2022-03-29 22:08:29\n---\n# 写在前面\n有时候项目在需求对接或是澄清阶段，客户或是技术经理会把需求的api接口通过yaml定义出来，也就是我们所说的`swagger-api`文件。这样开发人员能更清楚的了解到接口的入参和出参，方便开发。\n这时候，你可能觉得自己根据yaml手写model和api定义接口就可以了，我以前也是这么做的，但是看到团队的代码，发现有一种更简洁的方法,那就是根据`openapi-generator`自动生成java代码，这样就方便多了，简直不要太爽了。\n\n# 官方资料\n官方参考资料可以参考如下。\n> https://github.com/OpenAPITools/openapi-generator\n\n本篇所讲的是基于`openapi-generator`的maven插件，参考地址如下\n> https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin\n\n截止当前使用版本为：`v5.4.0`\n\n# 具体步骤\n\n## 添加pom依赖\n**build 块**\n```xml\n<!-- build 块 -->\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.openapitools</groupId>\n            <artifactId>openapi-generator-maven-plugin</artifactId>\n            <version>5.4.0</version>\n            <executions>\n                <execution>\n                    <id>generatePetEtc</id>\n                    <goals>\n                        <goal>generate</goal>\n                    </goals>\n                    <configuration>\n                        <inputSpec>${project.basedir}/doc/api.yaml</inputSpec>\n                        <generatorName>spring</generatorName>\n                        <apiPackage>org.example.api</apiPackage>\n                        <modelPackage>org.example.model</modelPackage>\n                        <!-- 这里会将代码生成在src目录，实际中我们可以省略该处 那么代码会生成在target目录 -->\n                        <output>${project.basedir}</output>\n                        <supportingFilesToGenerate>ApiUtil.java</supportingFilesToGenerate>\n                        <configOptions>\n                            <skipDefaultInterface>true</skipDefaultInterface>\n                            <interfaceOnly>true</interfaceOnly>\n                        </configOptions>\n                    </configuration>\n                </execution>\n            </executions>\n        </plugin>\n    </plugins>\n</build>\n```\n**dependencies 块**\n\n注意这里依赖以下模块，不然会报错\n- web 依赖http\n- validation-api 依赖api的校验部分\n- swagger-annotations 代码生成的依赖\n- jackson-databind-nullable 数据绑定依赖\n\n```xml\n<dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n    \n        <dependency>\n            <groupId>javax.validation</groupId>\n            <artifactId>validation-api</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>io.swagger.core.v3</groupId>\n            <artifactId>swagger-annotations</artifactId>\n            <version>2.1.13</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.openapitools</groupId>\n            <artifactId>jackson-databind-nullable</artifactId>\n            <version>0.2.2</version>\n            <scope>compile</scope>\n        </dependency>\n</dependencies>\n```\n\n## build块解读\n- <inputSpec>${project.basedir}/doc/api.yaml</inputSpec>\n  - 项目doc目录下的api.yaml\n  - 关于api.yaml写法可以参考官方文档 \n  > https://github.com/OpenAPITools/openapi-generator/blob/master/modules/openapi-generator/src/test/resources/3_0/petstore.yaml\n- <output>${project.basedir}</output>\n  实践中最好不要改配置，这样代码生成都在target目录下，不会影响源代码。\n- `<execution>`块可以写多个\n\n\n## 执行 mvn clean package\n执行成功后,切换到 /target/generated-sources/openapi/src/main/java/org/example   会看到生成的model和api接口。odel和api接口。","slug":"基于openapi的yaml文件快速生成代码","published":1,"updated":"2022-04-20T13:47:00.334Z","_id":"cl2qzfth0000j13no1dhocivl","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h1><p>有时候项目在需求对接或是澄清阶段，客户或是技术经理会把需求的api接口通过yaml定义出来，也就是我们所说的<code>swagger-api</code>文件。这样开发人员能更清楚的了解到接口的入参和出参，方便开发。<br>这时候，你可能觉得自己根据yaml手写model和api定义接口就可以了，我以前也是这么做的，但是看到团队的代码，发现有一种更简洁的方法,那就是根据<code>openapi-generator</code>自动生成java代码，这样就方便多了，简直不要太爽了。</p>\n<h1 id=\"官方资料\"><a href=\"#官方资料\" class=\"headerlink\" title=\"官方资料\"></a>官方资料</h1><p>官方参考资料可以参考如下。</p>\n<blockquote>\n<p><a href=\"https://github.com/OpenAPITools/openapi-generator\">https://github.com/OpenAPITools/openapi-generator</a></p>\n</blockquote>\n<p>本篇所讲的是基于<code>openapi-generator</code>的maven插件，参考地址如下</p>\n<blockquote>\n<p><a href=\"https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin\">https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin</a></p>\n</blockquote>\n<p>截止当前使用版本为：<code>v5.4.0</code></p>\n<h1 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h1><h2 id=\"添加pom依赖\"><a href=\"#添加pom依赖\" class=\"headerlink\" title=\"添加pom依赖\"></a>添加pom依赖</h2><p><strong>build 块</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- build 块 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.openapitools<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>openapi-generator-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.4.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>generatePetEtc<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>generate<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">inputSpec</span>&gt;</span>$&#123;project.basedir&#125;/doc/api.yaml<span class=\"tag\">&lt;/<span class=\"name\">inputSpec</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">generatorName</span>&gt;</span>spring<span class=\"tag\">&lt;/<span class=\"name\">generatorName</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">apiPackage</span>&gt;</span>org.example.api<span class=\"tag\">&lt;/<span class=\"name\">apiPackage</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">modelPackage</span>&gt;</span>org.example.model<span class=\"tag\">&lt;/<span class=\"name\">modelPackage</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"comment\">&lt;!-- 这里会将代码生成在src目录，实际中我们可以省略该处 那么代码会生成在target目录 --&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">output</span>&gt;</span>$&#123;project.basedir&#125;<span class=\"tag\">&lt;/<span class=\"name\">output</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">supportingFilesToGenerate</span>&gt;</span>ApiUtil.java<span class=\"tag\">&lt;/<span class=\"name\">supportingFilesToGenerate</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">configOptions</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">skipDefaultInterface</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">skipDefaultInterface</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">interfaceOnly</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">interfaceOnly</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">configOptions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><strong>dependencies 块</strong></p>\n<p>注意这里依赖以下模块，不然会报错</p>\n<ul>\n<li>web 依赖http</li>\n<li>validation-api 依赖api的校验部分</li>\n<li>swagger-annotations 代码生成的依赖</li>\n<li>jackson-databind-nullable 数据绑定依赖</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.validation<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>validation-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.swagger.core.v3<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>swagger-annotations<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1.13<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.openapitools<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-databind-nullable<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.2.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"build块解读\"><a href=\"#build块解读\" class=\"headerlink\" title=\"build块解读\"></a>build块解读</h2><ul>\n<li><inputSpec>${project.basedir}/doc/api.yaml</inputSpec><ul>\n<li>项目doc目录下的api.yaml</li>\n<li>关于api.yaml写法可以参考官方文档 <blockquote>\n<p><a href=\"https://github.com/OpenAPITools/openapi-generator/blob/master/modules/openapi-generator/src/test/resources/3_0/petstore.yaml\">https://github.com/OpenAPITools/openapi-generator/blob/master/modules/openapi-generator/src/test/resources/3_0/petstore.yaml</a></p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li><output>${project.basedir}</output><br>实践中最好不要改配置，这样代码生成都在target目录下，不会影响源代码。</li>\n<li><code>&lt;execution&gt;</code>块可以写多个</li>\n</ul>\n<h2 id=\"执行-mvn-clean-package\"><a href=\"#执行-mvn-clean-package\" class=\"headerlink\" title=\"执行 mvn clean package\"></a>执行 mvn clean package</h2><p>执行成功后,切换到 /target/generated-sources/openapi/src/main/java/org/example   会看到生成的model和api接口。odel和api接口。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h1><p>有时候项目在需求对接或是澄清阶段，客户或是技术经理会把需求的api接口通过yaml定义出来，也就是我们所说的<code>swagger-api</code>文件。这样开发人员能更清楚的了解到接口的入参和出参，方便开发。<br>这时候，你可能觉得自己根据yaml手写model和api定义接口就可以了，我以前也是这么做的，但是看到团队的代码，发现有一种更简洁的方法,那就是根据<code>openapi-generator</code>自动生成java代码，这样就方便多了，简直不要太爽了。</p>\n<h1 id=\"官方资料\"><a href=\"#官方资料\" class=\"headerlink\" title=\"官方资料\"></a>官方资料</h1><p>官方参考资料可以参考如下。</p>\n<blockquote>\n<p><a href=\"https://github.com/OpenAPITools/openapi-generator\">https://github.com/OpenAPITools/openapi-generator</a></p>\n</blockquote>\n<p>本篇所讲的是基于<code>openapi-generator</code>的maven插件，参考地址如下</p>\n<blockquote>\n<p><a href=\"https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin\">https://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator-maven-plugin</a></p>\n</blockquote>\n<p>截止当前使用版本为：<code>v5.4.0</code></p>\n<h1 id=\"具体步骤\"><a href=\"#具体步骤\" class=\"headerlink\" title=\"具体步骤\"></a>具体步骤</h1><h2 id=\"添加pom依赖\"><a href=\"#添加pom依赖\" class=\"headerlink\" title=\"添加pom依赖\"></a>添加pom依赖</h2><p><strong>build 块</strong></p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- build 块 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.openapitools<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>openapi-generator-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>5.4.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>generatePetEtc<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>generate<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">inputSpec</span>&gt;</span>$&#123;project.basedir&#125;/doc/api.yaml<span class=\"tag\">&lt;/<span class=\"name\">inputSpec</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">generatorName</span>&gt;</span>spring<span class=\"tag\">&lt;/<span class=\"name\">generatorName</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">apiPackage</span>&gt;</span>org.example.api<span class=\"tag\">&lt;/<span class=\"name\">apiPackage</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">modelPackage</span>&gt;</span>org.example.model<span class=\"tag\">&lt;/<span class=\"name\">modelPackage</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"comment\">&lt;!-- 这里会将代码生成在src目录，实际中我们可以省略该处 那么代码会生成在target目录 --&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">output</span>&gt;</span>$&#123;project.basedir&#125;<span class=\"tag\">&lt;/<span class=\"name\">output</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">supportingFilesToGenerate</span>&gt;</span>ApiUtil.java<span class=\"tag\">&lt;/<span class=\"name\">supportingFilesToGenerate</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">configOptions</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">skipDefaultInterface</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">skipDefaultInterface</span>&gt;</span></span><br><span class=\"line\">                            <span class=\"tag\">&lt;<span class=\"name\">interfaceOnly</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">interfaceOnly</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;/<span class=\"name\">configOptions</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p><strong>dependencies 块</strong></p>\n<p>注意这里依赖以下模块，不然会报错</p>\n<ul>\n<li>web 依赖http</li>\n<li>validation-api 依赖api的校验部分</li>\n<li>swagger-annotations 代码生成的依赖</li>\n<li>jackson-databind-nullable 数据绑定依赖</li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>javax.validation<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>validation-api<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.swagger.core.v3<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>swagger-annotations<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.1.13<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.openapitools<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jackson-databind-nullable<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.2.2<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">scope</span>&gt;</span>compile<span class=\"tag\">&lt;/<span class=\"name\">scope</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"build块解读\"><a href=\"#build块解读\" class=\"headerlink\" title=\"build块解读\"></a>build块解读</h2><ul>\n<li><inputSpec>${project.basedir}/doc/api.yaml</inputSpec><ul>\n<li>项目doc目录下的api.yaml</li>\n<li>关于api.yaml写法可以参考官方文档 <blockquote>\n<p><a href=\"https://github.com/OpenAPITools/openapi-generator/blob/master/modules/openapi-generator/src/test/resources/3_0/petstore.yaml\">https://github.com/OpenAPITools/openapi-generator/blob/master/modules/openapi-generator/src/test/resources/3_0/petstore.yaml</a></p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li><output>${project.basedir}</output><br>实践中最好不要改配置，这样代码生成都在target目录下，不会影响源代码。</li>\n<li><code>&lt;execution&gt;</code>块可以写多个</li>\n</ul>\n<h2 id=\"执行-mvn-clean-package\"><a href=\"#执行-mvn-clean-package\" class=\"headerlink\" title=\"执行 mvn clean package\"></a>执行 mvn clean package</h2><p>执行成功后,切换到 /target/generated-sources/openapi/src/main/java/org/example   会看到生成的model和api接口。odel和api接口。</p>\n"},{"uuid":"bbaed2ea-c0ab-11ec-92a1-7557b2313227","title":"项目开发中有哪些环境","abbrlink":"80aa85d8","date":"2022-03-15T13:04:54.000Z","_content":"\n## 项目的环境 \n\n一般一个项目或者说一般公司的项目都分几个环境：\n- dev或本地环境\n- test测试环境\n- staging预发布环境\n- production线上环境\n\n开发同学一般会在本地环境进行开发，根据需求文档进行功能开发，开发完成后提到dev环境进行自测\n\n如果公司对开发质量要求比较高，开发同学一般要将自己开发的功能进行自测。如果开发时间紧开发功能多，\n可能测试会介入更多时间\n\n<b>dev环境主要是干嘛的？</b>\n- 开发进行自测，将功能点串起来\n- 出现bug后，进行bug修改和验证，提交代码到test环境。\n\n<b>test环境主要是干嘛的？</b>\n- 测试重点关注的，进行新功能的测试。提交bug等都是依据test环境进行的。\n- 进行老功能测试回归，bug回归等。\n\n<b>staging环境主要是干嘛的？</b>\n- staging环境一般是产品同学进行验收，比如看一下开发是否按需求来的，是否有大的问题没考虑到\n- 进行到生成环境的预部署(包括sql兼容语句，ui页面或接口的提前上线等等)\n\npro环境就是正式环境，一般就是我们说的线上环境。\n\n## 项目开发流程\n\n一般开发流程：\n一般开发feature会从dev分支新建一个feature分支，开发完成后将feature分支合到\ntest分支，测试发现bug，feature分支修改bug后再次合到test分支，验证通过后将feature\n分支合到dev分支，上线时合到master分支。\n\ngit工作流的分支策略可以参考：\n> https://bbs.huaweicloud.com/blogs/281789\n","source":"_posts/项目开发中有哪些环境.md","raw":"---\nuuid: bbaed2ea-c0ab-11ec-92a1-7557b2313227\ntitle: 项目开发中有哪些环境\ntags:\n  - 项目开发环境\nabbrlink: 80aa85d8\ndate: 2022-03-15 21:04:54\n---\n\n## 项目的环境 \n\n一般一个项目或者说一般公司的项目都分几个环境：\n- dev或本地环境\n- test测试环境\n- staging预发布环境\n- production线上环境\n\n开发同学一般会在本地环境进行开发，根据需求文档进行功能开发，开发完成后提到dev环境进行自测\n\n如果公司对开发质量要求比较高，开发同学一般要将自己开发的功能进行自测。如果开发时间紧开发功能多，\n可能测试会介入更多时间\n\n<b>dev环境主要是干嘛的？</b>\n- 开发进行自测，将功能点串起来\n- 出现bug后，进行bug修改和验证，提交代码到test环境。\n\n<b>test环境主要是干嘛的？</b>\n- 测试重点关注的，进行新功能的测试。提交bug等都是依据test环境进行的。\n- 进行老功能测试回归，bug回归等。\n\n<b>staging环境主要是干嘛的？</b>\n- staging环境一般是产品同学进行验收，比如看一下开发是否按需求来的，是否有大的问题没考虑到\n- 进行到生成环境的预部署(包括sql兼容语句，ui页面或接口的提前上线等等)\n\npro环境就是正式环境，一般就是我们说的线上环境。\n\n## 项目开发流程\n\n一般开发流程：\n一般开发feature会从dev分支新建一个feature分支，开发完成后将feature分支合到\ntest分支，测试发现bug，feature分支修改bug后再次合到test分支，验证通过后将feature\n分支合到dev分支，上线时合到master分支。\n\ngit工作流的分支策略可以参考：\n> https://bbs.huaweicloud.com/blogs/281789\n","slug":"项目开发中有哪些环境","published":1,"updated":"2022-05-04T03:24:31.539Z","_id":"cl2qzfth3000n13no7h2k8nlg","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"项目的环境\"><a href=\"#项目的环境\" class=\"headerlink\" title=\"项目的环境\"></a>项目的环境</h2><p>一般一个项目或者说一般公司的项目都分几个环境：</p>\n<ul>\n<li>dev或本地环境</li>\n<li>test测试环境</li>\n<li>staging预发布环境</li>\n<li>production线上环境</li>\n</ul>\n<p>开发同学一般会在本地环境进行开发，根据需求文档进行功能开发，开发完成后提到dev环境进行自测</p>\n<p>如果公司对开发质量要求比较高，开发同学一般要将自己开发的功能进行自测。如果开发时间紧开发功能多，<br>可能测试会介入更多时间</p>\n<p><b>dev环境主要是干嘛的？</b></p>\n<ul>\n<li>开发进行自测，将功能点串起来</li>\n<li>出现bug后，进行bug修改和验证，提交代码到test环境。</li>\n</ul>\n<p><b>test环境主要是干嘛的？</b></p>\n<ul>\n<li>测试重点关注的，进行新功能的测试。提交bug等都是依据test环境进行的。</li>\n<li>进行老功能测试回归，bug回归等。</li>\n</ul>\n<p><b>staging环境主要是干嘛的？</b></p>\n<ul>\n<li>staging环境一般是产品同学进行验收，比如看一下开发是否按需求来的，是否有大的问题没考虑到</li>\n<li>进行到生成环境的预部署(包括sql兼容语句，ui页面或接口的提前上线等等)</li>\n</ul>\n<p>pro环境就是正式环境，一般就是我们说的线上环境。</p>\n<h2 id=\"项目开发流程\"><a href=\"#项目开发流程\" class=\"headerlink\" title=\"项目开发流程\"></a>项目开发流程</h2><p>一般开发流程：<br>一般开发feature会从dev分支新建一个feature分支，开发完成后将feature分支合到<br>test分支，测试发现bug，feature分支修改bug后再次合到test分支，验证通过后将feature<br>分支合到dev分支，上线时合到master分支。</p>\n<p>git工作流的分支策略可以参考：</p>\n<blockquote>\n<p><a href=\"https://bbs.huaweicloud.com/blogs/281789\">https://bbs.huaweicloud.com/blogs/281789</a></p>\n</blockquote>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"项目的环境\"><a href=\"#项目的环境\" class=\"headerlink\" title=\"项目的环境\"></a>项目的环境</h2><p>一般一个项目或者说一般公司的项目都分几个环境：</p>\n<ul>\n<li>dev或本地环境</li>\n<li>test测试环境</li>\n<li>staging预发布环境</li>\n<li>production线上环境</li>\n</ul>\n<p>开发同学一般会在本地环境进行开发，根据需求文档进行功能开发，开发完成后提到dev环境进行自测</p>\n<p>如果公司对开发质量要求比较高，开发同学一般要将自己开发的功能进行自测。如果开发时间紧开发功能多，<br>可能测试会介入更多时间</p>\n<p><b>dev环境主要是干嘛的？</b></p>\n<ul>\n<li>开发进行自测，将功能点串起来</li>\n<li>出现bug后，进行bug修改和验证，提交代码到test环境。</li>\n</ul>\n<p><b>test环境主要是干嘛的？</b></p>\n<ul>\n<li>测试重点关注的，进行新功能的测试。提交bug等都是依据test环境进行的。</li>\n<li>进行老功能测试回归，bug回归等。</li>\n</ul>\n<p><b>staging环境主要是干嘛的？</b></p>\n<ul>\n<li>staging环境一般是产品同学进行验收，比如看一下开发是否按需求来的，是否有大的问题没考虑到</li>\n<li>进行到生成环境的预部署(包括sql兼容语句，ui页面或接口的提前上线等等)</li>\n</ul>\n<p>pro环境就是正式环境，一般就是我们说的线上环境。</p>\n<h2 id=\"项目开发流程\"><a href=\"#项目开发流程\" class=\"headerlink\" title=\"项目开发流程\"></a>项目开发流程</h2><p>一般开发流程：<br>一般开发feature会从dev分支新建一个feature分支，开发完成后将feature分支合到<br>test分支，测试发现bug，feature分支修改bug后再次合到test分支，验证通过后将feature<br>分支合到dev分支，上线时合到master分支。</p>\n<p>git工作流的分支策略可以参考：</p>\n<blockquote>\n<p><a href=\"https://bbs.huaweicloud.com/blogs/281789\">https://bbs.huaweicloud.com/blogs/281789</a></p>\n</blockquote>\n"},{"uuid":"bbaed2e8-c0ab-11ec-92a1-7557b2313227","title":"swagger-ui访问api接口","abbrlink":"3f47fec0","date":"2022-04-15T14:13:54.000Z","_content":"\n# 写在前面\n\n之前我们写过可以通过`openapi`的插件快速生成代码(包括我们常用的model、api的接口等)，这样我们就能快速开发业务了。那么接口开发完成后，我们除了通过ut测试接口的完备性，同样也可以通过`postman`来测试接口是否正确。那么`postman`有一个问题就是，我们需要手动去配入接口的路径和参数，那么有人可能就说了，一个人配置后共享配置的`json`文件就行了，可行是可行，甚至还有在线的类型共享测试接口的开源软件。\n\n我们今天其实并不关心这个问题，我们关心我们自己开发的时候如何去快速测试接口，提高效率，并不是来考虑团队协作之类的。\n\n那么主角`swagger-ui`就来了,我们一起看看吧。\n\n# 官方资料\n\n官方资料可参考\n\n> https://github.com/swagger-api/swagger-ui\n\n说明以下，这是一个`nodejs`项目，我们可以先安装`node`环境。然后体验本地dev开发。\n\n## dev开发说明\n\n### 步骤\n\n1. `git clone https://github.com/swagger-api/swagger-ui.git`\n2. `cd swagger-ui`\n3. `npm run dev`\n4. Wait a bit\n5. Open http://localhost:3200/\n\n### 使用本地yaml或json文件替换api说明文档\n\n之前`openapi`使用的是yaml文件，我们可以直接拿过来，当然`json`文件也可以，但是最好和`openapi`同一起来，这样方便也好书写。\n\n可以在`dev-helper/index.html`文件中替换为该yaml文件。那么本地文件放在哪呢？\n\n在`dev-helper`文件下新建目录`examples`，然后url替换为`url: \"./examples/your-local-api-definition.yaml\"`\n\n这样启动之后，就可以调试本地`api接口`了。\n\n\n\n## api页面之线上\n\n如果公司或自己有服务器，可以将该项目生成的静态文件放到服务器上的目录。例如nginx的目录。\n\n执行步骤如下。\n\n1. `npm run build`\n2. 替换`dist`目录下的`index.html`里的`url`参数\n3. 放入nginx目录\n4. 启动nginx即可\n\n\n\n## docker启动swagger-ui\n\n步骤。\n\n1. `docker pull swaggerapi/swagger-ui`\n2. `docker run  --name swagger-ui -p 8888:8080 -e BASE_URL=/swagger -e SWAGGER_JSON=/foo/api.yml -v ~/tmp/api:/foo swaggerapi/swagger-ui`\n\n3. 访问`http://localhost:8888/swagger`就可以看到ui界面了。\n\n这里我们配置了`BASE_URL`即是host后面的路径，通过volume配置了api的路径。\n\n关于docker的更多配置可以参考[配置](https://github.com/swagger-api/swagger-ui/blob/master/docs/usage/configuration.md#docker)。\n\n当然我们也可以对官方的镜像做定制来满足我们的各种需求。后面如果有时间，会写一篇文章。\n","source":"_posts/swagger-ui访问api接口.md","raw":"---\nuuid: bbaed2e8-c0ab-11ec-92a1-7557b2313227\ntitle: swagger-ui访问api接口\ncategories: Tool\ntags:\n  - swagger\nabbrlink: 3f47fec0\ndate: 2022-04-15 22:13:54\n---\n\n# 写在前面\n\n之前我们写过可以通过`openapi`的插件快速生成代码(包括我们常用的model、api的接口等)，这样我们就能快速开发业务了。那么接口开发完成后，我们除了通过ut测试接口的完备性，同样也可以通过`postman`来测试接口是否正确。那么`postman`有一个问题就是，我们需要手动去配入接口的路径和参数，那么有人可能就说了，一个人配置后共享配置的`json`文件就行了，可行是可行，甚至还有在线的类型共享测试接口的开源软件。\n\n我们今天其实并不关心这个问题，我们关心我们自己开发的时候如何去快速测试接口，提高效率，并不是来考虑团队协作之类的。\n\n那么主角`swagger-ui`就来了,我们一起看看吧。\n\n# 官方资料\n\n官方资料可参考\n\n> https://github.com/swagger-api/swagger-ui\n\n说明以下，这是一个`nodejs`项目，我们可以先安装`node`环境。然后体验本地dev开发。\n\n## dev开发说明\n\n### 步骤\n\n1. `git clone https://github.com/swagger-api/swagger-ui.git`\n2. `cd swagger-ui`\n3. `npm run dev`\n4. Wait a bit\n5. Open http://localhost:3200/\n\n### 使用本地yaml或json文件替换api说明文档\n\n之前`openapi`使用的是yaml文件，我们可以直接拿过来，当然`json`文件也可以，但是最好和`openapi`同一起来，这样方便也好书写。\n\n可以在`dev-helper/index.html`文件中替换为该yaml文件。那么本地文件放在哪呢？\n\n在`dev-helper`文件下新建目录`examples`，然后url替换为`url: \"./examples/your-local-api-definition.yaml\"`\n\n这样启动之后，就可以调试本地`api接口`了。\n\n\n\n## api页面之线上\n\n如果公司或自己有服务器，可以将该项目生成的静态文件放到服务器上的目录。例如nginx的目录。\n\n执行步骤如下。\n\n1. `npm run build`\n2. 替换`dist`目录下的`index.html`里的`url`参数\n3. 放入nginx目录\n4. 启动nginx即可\n\n\n\n## docker启动swagger-ui\n\n步骤。\n\n1. `docker pull swaggerapi/swagger-ui`\n2. `docker run  --name swagger-ui -p 8888:8080 -e BASE_URL=/swagger -e SWAGGER_JSON=/foo/api.yml -v ~/tmp/api:/foo swaggerapi/swagger-ui`\n\n3. 访问`http://localhost:8888/swagger`就可以看到ui界面了。\n\n这里我们配置了`BASE_URL`即是host后面的路径，通过volume配置了api的路径。\n\n关于docker的更多配置可以参考[配置](https://github.com/swagger-api/swagger-ui/blob/master/docs/usage/configuration.md#docker)。\n\n当然我们也可以对官方的镜像做定制来满足我们的各种需求。后面如果有时间，会写一篇文章。\n","slug":"swagger-ui访问api接口","published":1,"updated":"2022-05-04T03:26:11.186Z","_id":"cl2qzfth4000p13no96mm355q","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h1><p>之前我们写过可以通过<code>openapi</code>的插件快速生成代码(包括我们常用的model、api的接口等)，这样我们就能快速开发业务了。那么接口开发完成后，我们除了通过ut测试接口的完备性，同样也可以通过<code>postman</code>来测试接口是否正确。那么<code>postman</code>有一个问题就是，我们需要手动去配入接口的路径和参数，那么有人可能就说了，一个人配置后共享配置的<code>json</code>文件就行了，可行是可行，甚至还有在线的类型共享测试接口的开源软件。</p>\n<p>我们今天其实并不关心这个问题，我们关心我们自己开发的时候如何去快速测试接口，提高效率，并不是来考虑团队协作之类的。</p>\n<p>那么主角<code>swagger-ui</code>就来了,我们一起看看吧。</p>\n<h1 id=\"官方资料\"><a href=\"#官方资料\" class=\"headerlink\" title=\"官方资料\"></a>官方资料</h1><p>官方资料可参考</p>\n<blockquote>\n<p><a href=\"https://github.com/swagger-api/swagger-ui\">https://github.com/swagger-api/swagger-ui</a></p>\n</blockquote>\n<p>说明以下，这是一个<code>nodejs</code>项目，我们可以先安装<code>node</code>环境。然后体验本地dev开发。</p>\n<h2 id=\"dev开发说明\"><a href=\"#dev开发说明\" class=\"headerlink\" title=\"dev开发说明\"></a>dev开发说明</h2><h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><ol>\n<li><code>git clone https://github.com/swagger-api/swagger-ui.git</code></li>\n<li><code>cd swagger-ui</code></li>\n<li><code>npm run dev</code></li>\n<li>Wait a bit</li>\n<li>Open <a href=\"http://localhost:3200/\">http://localhost:3200/</a></li>\n</ol>\n<h3 id=\"使用本地yaml或json文件替换api说明文档\"><a href=\"#使用本地yaml或json文件替换api说明文档\" class=\"headerlink\" title=\"使用本地yaml或json文件替换api说明文档\"></a>使用本地yaml或json文件替换api说明文档</h3><p>之前<code>openapi</code>使用的是yaml文件，我们可以直接拿过来，当然<code>json</code>文件也可以，但是最好和<code>openapi</code>同一起来，这样方便也好书写。</p>\n<p>可以在<code>dev-helper/index.html</code>文件中替换为该yaml文件。那么本地文件放在哪呢？</p>\n<p>在<code>dev-helper</code>文件下新建目录<code>examples</code>，然后url替换为<code>url: &quot;./examples/your-local-api-definition.yaml&quot;</code></p>\n<p>这样启动之后，就可以调试本地<code>api接口</code>了。</p>\n<h2 id=\"api页面之线上\"><a href=\"#api页面之线上\" class=\"headerlink\" title=\"api页面之线上\"></a>api页面之线上</h2><p>如果公司或自己有服务器，可以将该项目生成的静态文件放到服务器上的目录。例如nginx的目录。</p>\n<p>执行步骤如下。</p>\n<ol>\n<li><code>npm run build</code></li>\n<li>替换<code>dist</code>目录下的<code>index.html</code>里的<code>url</code>参数</li>\n<li>放入nginx目录</li>\n<li>启动nginx即可</li>\n</ol>\n<h2 id=\"docker启动swagger-ui\"><a href=\"#docker启动swagger-ui\" class=\"headerlink\" title=\"docker启动swagger-ui\"></a>docker启动swagger-ui</h2><p>步骤。</p>\n<ol>\n<li><p><code>docker pull swaggerapi/swagger-ui</code></p>\n</li>\n<li><p><code>docker run  --name swagger-ui -p 8888:8080 -e BASE_URL=/swagger -e SWAGGER_JSON=/foo/api.yml -v ~/tmp/api:/foo swaggerapi/swagger-ui</code></p>\n</li>\n<li><p>访问<code>http://localhost:8888/swagger</code>就可以看到ui界面了。</p>\n</li>\n</ol>\n<p>这里我们配置了<code>BASE_URL</code>即是host后面的路径，通过volume配置了api的路径。</p>\n<p>关于docker的更多配置可以参考<a href=\"https://github.com/swagger-api/swagger-ui/blob/master/docs/usage/configuration.md#docker\">配置</a>。</p>\n<p>当然我们也可以对官方的镜像做定制来满足我们的各种需求。后面如果有时间，会写一篇文章。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h1><p>之前我们写过可以通过<code>openapi</code>的插件快速生成代码(包括我们常用的model、api的接口等)，这样我们就能快速开发业务了。那么接口开发完成后，我们除了通过ut测试接口的完备性，同样也可以通过<code>postman</code>来测试接口是否正确。那么<code>postman</code>有一个问题就是，我们需要手动去配入接口的路径和参数，那么有人可能就说了，一个人配置后共享配置的<code>json</code>文件就行了，可行是可行，甚至还有在线的类型共享测试接口的开源软件。</p>\n<p>我们今天其实并不关心这个问题，我们关心我们自己开发的时候如何去快速测试接口，提高效率，并不是来考虑团队协作之类的。</p>\n<p>那么主角<code>swagger-ui</code>就来了,我们一起看看吧。</p>\n<h1 id=\"官方资料\"><a href=\"#官方资料\" class=\"headerlink\" title=\"官方资料\"></a>官方资料</h1><p>官方资料可参考</p>\n<blockquote>\n<p><a href=\"https://github.com/swagger-api/swagger-ui\">https://github.com/swagger-api/swagger-ui</a></p>\n</blockquote>\n<p>说明以下，这是一个<code>nodejs</code>项目，我们可以先安装<code>node</code>环境。然后体验本地dev开发。</p>\n<h2 id=\"dev开发说明\"><a href=\"#dev开发说明\" class=\"headerlink\" title=\"dev开发说明\"></a>dev开发说明</h2><h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><ol>\n<li><code>git clone https://github.com/swagger-api/swagger-ui.git</code></li>\n<li><code>cd swagger-ui</code></li>\n<li><code>npm run dev</code></li>\n<li>Wait a bit</li>\n<li>Open <a href=\"http://localhost:3200/\">http://localhost:3200/</a></li>\n</ol>\n<h3 id=\"使用本地yaml或json文件替换api说明文档\"><a href=\"#使用本地yaml或json文件替换api说明文档\" class=\"headerlink\" title=\"使用本地yaml或json文件替换api说明文档\"></a>使用本地yaml或json文件替换api说明文档</h3><p>之前<code>openapi</code>使用的是yaml文件，我们可以直接拿过来，当然<code>json</code>文件也可以，但是最好和<code>openapi</code>同一起来，这样方便也好书写。</p>\n<p>可以在<code>dev-helper/index.html</code>文件中替换为该yaml文件。那么本地文件放在哪呢？</p>\n<p>在<code>dev-helper</code>文件下新建目录<code>examples</code>，然后url替换为<code>url: &quot;./examples/your-local-api-definition.yaml&quot;</code></p>\n<p>这样启动之后，就可以调试本地<code>api接口</code>了。</p>\n<h2 id=\"api页面之线上\"><a href=\"#api页面之线上\" class=\"headerlink\" title=\"api页面之线上\"></a>api页面之线上</h2><p>如果公司或自己有服务器，可以将该项目生成的静态文件放到服务器上的目录。例如nginx的目录。</p>\n<p>执行步骤如下。</p>\n<ol>\n<li><code>npm run build</code></li>\n<li>替换<code>dist</code>目录下的<code>index.html</code>里的<code>url</code>参数</li>\n<li>放入nginx目录</li>\n<li>启动nginx即可</li>\n</ol>\n<h2 id=\"docker启动swagger-ui\"><a href=\"#docker启动swagger-ui\" class=\"headerlink\" title=\"docker启动swagger-ui\"></a>docker启动swagger-ui</h2><p>步骤。</p>\n<ol>\n<li><p><code>docker pull swaggerapi/swagger-ui</code></p>\n</li>\n<li><p><code>docker run  --name swagger-ui -p 8888:8080 -e BASE_URL=/swagger -e SWAGGER_JSON=/foo/api.yml -v ~/tmp/api:/foo swaggerapi/swagger-ui</code></p>\n</li>\n<li><p>访问<code>http://localhost:8888/swagger</code>就可以看到ui界面了。</p>\n</li>\n</ol>\n<p>这里我们配置了<code>BASE_URL</code>即是host后面的路径，通过volume配置了api的路径。</p>\n<p>关于docker的更多配置可以参考<a href=\"https://github.com/swagger-api/swagger-ui/blob/master/docs/usage/configuration.md#docker\">配置</a>。</p>\n<p>当然我们也可以对官方的镜像做定制来满足我们的各种需求。后面如果有时间，会写一篇文章。</p>\n"},{"uuid":"bbaed2eb-c0ab-11ec-92a1-7557b2313227","title":"代理模式","abbrlink":"7b510e10","_content":"\n代理模式（Proxy Pattern）为指定的类的对象提供代理对象，并通过代理对象对原对象的引用，代理后者执行操作。\n\n咱们搞技术的，大多都需要用到网络代理服务，毕竟国外有丰富最新的IT资料，而国内的网络环境你懂得。不同的代理服务，由于协议和技术不同，原理也有差异，但大体思路都差不多。\n\n![HTTP代理示意图](https://raw.githubusercontent.com/xzyup/image/master/202203191512727.png)\n如图，作为客户端的我们，当想访问海外的某台HTTP服务的时候，由于墙，网页打不开，这时候就需要网络代理服务，我们在自己电脑上安装一个代理客户端，这个代理客户端就能够将我们对那台海外HTTP服务器的请求转送至同样位于国外的网络代理服务器上，由于代理服务器在国外，因此访问海外HTTP服务器没问题，于是代为发送请求，并将收到的响应内容再传回给我们自己电脑，这样我们就相当于可以访问国外技术资料了。\n\n# 例子\n\n## 静态代理\n\n那么我们就以这个为例，写一个简单的代理模式的代码。\n\n首先，我们看，无论是海外HTTP服务还是网络代理服务器，对于我们来说，都是HTTP服务器，都能够接收HTTP请求，并返回相应的结果页面。我们并不关心如何进行的代理，实际上我们也不清楚它的具体原理和实现，我们只关心HTTP服务功能。于是我们的需求可以用以下接口来概况：\n\nHttpServer.java\n```\npublic interface HttpServer {\n    void handleRequest();\n}\n```\n\n我们想访问的那个海外网站的HTTP服务器就是一个具体实现：\n\nOverseasHttpServer.java\n```\npublic class OverseasHttpServer implements HttpServer {\n    public void handleRequest() {\n        System.out.println(\"海外的HTTP服务器处理请求并返回结果...\");\n    }\n}\n```\n\n我们来看一下代理服务器：\n\nHttpProxy.java\n```\npublic class HttpProxy implements HttpServer {\n    private HttpServer overseasHttpServer;\n\n    public HttpProxy(HttpServer overseasHttpServer) {\n        this.overseasHttpServer = overseasHttpServer;\n    }\n\n    public void handleRequest() {\n        preRequest();\n        this.overseasHttpServer.handleRequest();\n        postRequest();\n    }\n\n    public void preRequest() {\n        System.out.println(\"拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...\");\n    }\n    public void postRequest() {\n        System.out.println(\"海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...\");\n    }\n}\n```\n\n代理服务器也实现了`HttpServer`，这也很好理解，毕竟我们需要的是一个HTTP服务器，无论你是实际的，还是代理的，能够处理请求就好了，别的我不care～这是代理模式的第一个特点，那就是**代理类同被代理类一样，都实现同样的接口，以便对外提供同样的服务**。\n\n但是代理服务器毕竟只是一个中转，它**必须要引入被代理服务器作为成员变量来执行核心的操作**。此外，代理服务器可以在核心操作前后进行一些其他工作，以便更好的提供服务。\n\n测试一下代理效果：\n\nClient.java\n```\nHttpServer overseasHttpServer = new OverseasHttpServer();\nHttpServer httpServer = new HttpProxy(overseasHttpServer);\nhttpServer.handleRequest();\n```\n\n输出为：\n```\n拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...\n海外的HTTP服务器处理请求并返回结果...\n海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...\n```\n\n可见确实是按照我们上边介绍的原理执行的HTTP代理服务。\n\n\n## 动态代理\n\n不知您是否用过Spring进行开发，Spring以及其他的一些开发框架，都提供了面向切面开发（AOP）的能力。\n\n举个栗子，我们开发一个系统，首先要关心的是业务功能，而对于像记录日志这样的功能，通常是作为系统基础能力由框架提供。这样理想的效果就是，开发人员只需要开发功能就好，记录日志的功能由框架“切入”到具体业务方法的前后来实现。\n\n这其实类似于我们刚才提到的代理的例子，有`pre`和`post`的处理。但是对于框架来说，并不知道会增加什么样的业务类和业务操作，需要动态为业务类的具体业务操作提供代理，而不是交由业务类的开发人员对每个业务类开发相应的代理类，且不说提高了不少的开发量，如果哪天除了日志再增加一个权限处理的基础能力，还要对所有的代理类进行补充，岂不是要撞墙了。\n\nSpring的AOP借助了Java语言提供的动态代理机制对业务方法进行动态代理。当然Spring也对AspectJ这种功能更加强大的切面处理库进行了集成，本文不表。\n\n对于动态代理来说，需要首先有一个实现`InvocationHandler`接口的handler，可以简单认为是对被代理的方法的包装。\n\nHttpProxyHandler.java\n```\npublic class HttpProxyHandler implements InvocationHandler {\n    private HttpServer overseasHttpServer;\n\n    public HttpProxyHandler(HttpServer overseasHttpServer) {\n        this.overseasHttpServer = overseasHttpServer;\n    }\n\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        preRequest();\n        Object o = method.invoke(overseasHttpServer, args);\n        postRequest();\n        return o;\n    }\n\n    public void preRequest() {\n        System.out.println(\"拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...\");\n    }\n    public void postRequest() {\n        System.out.println(\"海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...\");\n    }\n}\n```\n\n这里，Handler中仍然需要引用被代理类的对象作为成员变量，甚至可以将成员变量直接声明为`Object`类型，从而代理类可以为更多业务类提供代理，如下：\n\n```\npublic class ProxyHandler implements InvocationHandler {\n    private Object obj;\n\n    public ProxyHandler(Object obj) {\n        this.obj = obj;\n    }\n\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        preRequest();\n        Object o = method.invoke(obj, args);\n        postRequest();\n        return o;\n    }\n    \n    public void preInvoke() {}\n    public void postInvoke() {}\n}\n```\n\n这样，可以由子类覆盖`preInvode()`和`postInvoke()`，从而实现`HttpProxyHandler`和`HttpsProxyHandler`等等，用来具体定义Http和Https协议分别如何进行代理。这里其实有了模板模式的影子，这两个空方法就是模板元素。我们言归正传，仍然使用上一段代码继续我们的例子。\n\n我们看`InvocationHandler`的`invoke(Object proxy, Method method, Object[] args)`方法，`proxy`指的是动态生成的代理对象，`method`指的是被代理的操作方法，`args`指的是被代理方法的参数。可见Java语言的动态代理机制都已经给准备好了，我们只需要执行`method.invoke(obj, args)`就相当于被代理的对象执行了被代理的方法。\n\nHandler有了，那么动态代理的对象怎么生成的呢？Java提供了`Proxy`工具类`newProxyInstance(ClassLoader loader, Class<?>[] interfaces, InvocationHandler h)`来生成代理对象。其中第一个参数`loader`是类加载器，通常使用被代理类的类加载器即可；第二个参数`interfaces`是被代理类所实现的接口类数组，可见这种代理方式仍然是基于接口代理的，第三个参数就是我们刚刚准备好的handler。\n\n这个方法会返回一个代理对象，这个对象实现了`interfaces`指定的接口，因此可以转换类型，然后就可以同静态代理一样的方式来使用了。\n\nClient.java\n```\nHttpProxyHandler proxy = new HttpProxyHandler(overseasHttpServer);\nHttpServer httpProxy = (HttpServer) Proxy.newProxyInstance(proxy.getClass().getClassLoader(), \n    overseasHttpServer.getClass().getInterfaces(), proxy);\nhttpProxy.handleRequest();\n```\n\n# 总结\n\n关于代理模式，不用说太多，一图胜千言啊：\n\n![代理模式](https://raw.githubusercontent.com/xzyup/image/master/202203191513110.png)\n\n其特点有二：1. 代理类与被代理类基于同样的接口；2. 代理类引用了被代理类。\n\n这个模式容易与其他模式混淆，比如适配器模式：\n\n![适配器模式](https://raw.githubusercontent.com/xzyup/image/master/202203191513054.png)\n\n这两个分别是类适配器模式和对象适配器模式，尤其是对象适配器模式更像，但它们有本质的区别，那就是，适配器类和被适配的类并不基于同样的接口，而这正是“适配器”的用意所在——适配不同的接口。\n\n还有装饰器模式：\n\n![装饰器模式](https://raw.githubusercontent.com/xzyup/image/master/202203191514852.png)\n\n这俩就更像了，对装饰器模式来说，装饰者（decorator）和被装饰者（decoratee）都实现同一个 接口。对代理模式来说，代理类（proxy class）和真实处理的类（real class）都实现同一个接口。此外，不论我们使用哪一个模式，都可以很容易地在真实对象的方法前面或者后面加上自定义的方法。\n\n这两个模式从类关系上看，确实相差不多，但是主要区别在于应用场景和目的，装饰器模式应当为所装饰的对象提供增强功能，而代理模式对被代理的对象施加控制，并不提供对对象本身的增强。\n","source":"_posts/design-pattern/代理模式.md","raw":"---\nuuid: bbaed2eb-c0ab-11ec-92a1-7557b2313227\ntitle: 代理模式\ntags: 设计模式\ncategories: Java\nabbrlink: 7b510e10\n---\n\n代理模式（Proxy Pattern）为指定的类的对象提供代理对象，并通过代理对象对原对象的引用，代理后者执行操作。\n\n咱们搞技术的，大多都需要用到网络代理服务，毕竟国外有丰富最新的IT资料，而国内的网络环境你懂得。不同的代理服务，由于协议和技术不同，原理也有差异，但大体思路都差不多。\n\n![HTTP代理示意图](https://raw.githubusercontent.com/xzyup/image/master/202203191512727.png)\n如图，作为客户端的我们，当想访问海外的某台HTTP服务的时候，由于墙，网页打不开，这时候就需要网络代理服务，我们在自己电脑上安装一个代理客户端，这个代理客户端就能够将我们对那台海外HTTP服务器的请求转送至同样位于国外的网络代理服务器上，由于代理服务器在国外，因此访问海外HTTP服务器没问题，于是代为发送请求，并将收到的响应内容再传回给我们自己电脑，这样我们就相当于可以访问国外技术资料了。\n\n# 例子\n\n## 静态代理\n\n那么我们就以这个为例，写一个简单的代理模式的代码。\n\n首先，我们看，无论是海外HTTP服务还是网络代理服务器，对于我们来说，都是HTTP服务器，都能够接收HTTP请求，并返回相应的结果页面。我们并不关心如何进行的代理，实际上我们也不清楚它的具体原理和实现，我们只关心HTTP服务功能。于是我们的需求可以用以下接口来概况：\n\nHttpServer.java\n```\npublic interface HttpServer {\n    void handleRequest();\n}\n```\n\n我们想访问的那个海外网站的HTTP服务器就是一个具体实现：\n\nOverseasHttpServer.java\n```\npublic class OverseasHttpServer implements HttpServer {\n    public void handleRequest() {\n        System.out.println(\"海外的HTTP服务器处理请求并返回结果...\");\n    }\n}\n```\n\n我们来看一下代理服务器：\n\nHttpProxy.java\n```\npublic class HttpProxy implements HttpServer {\n    private HttpServer overseasHttpServer;\n\n    public HttpProxy(HttpServer overseasHttpServer) {\n        this.overseasHttpServer = overseasHttpServer;\n    }\n\n    public void handleRequest() {\n        preRequest();\n        this.overseasHttpServer.handleRequest();\n        postRequest();\n    }\n\n    public void preRequest() {\n        System.out.println(\"拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...\");\n    }\n    public void postRequest() {\n        System.out.println(\"海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...\");\n    }\n}\n```\n\n代理服务器也实现了`HttpServer`，这也很好理解，毕竟我们需要的是一个HTTP服务器，无论你是实际的，还是代理的，能够处理请求就好了，别的我不care～这是代理模式的第一个特点，那就是**代理类同被代理类一样，都实现同样的接口，以便对外提供同样的服务**。\n\n但是代理服务器毕竟只是一个中转，它**必须要引入被代理服务器作为成员变量来执行核心的操作**。此外，代理服务器可以在核心操作前后进行一些其他工作，以便更好的提供服务。\n\n测试一下代理效果：\n\nClient.java\n```\nHttpServer overseasHttpServer = new OverseasHttpServer();\nHttpServer httpServer = new HttpProxy(overseasHttpServer);\nhttpServer.handleRequest();\n```\n\n输出为：\n```\n拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...\n海外的HTTP服务器处理请求并返回结果...\n海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...\n```\n\n可见确实是按照我们上边介绍的原理执行的HTTP代理服务。\n\n\n## 动态代理\n\n不知您是否用过Spring进行开发，Spring以及其他的一些开发框架，都提供了面向切面开发（AOP）的能力。\n\n举个栗子，我们开发一个系统，首先要关心的是业务功能，而对于像记录日志这样的功能，通常是作为系统基础能力由框架提供。这样理想的效果就是，开发人员只需要开发功能就好，记录日志的功能由框架“切入”到具体业务方法的前后来实现。\n\n这其实类似于我们刚才提到的代理的例子，有`pre`和`post`的处理。但是对于框架来说，并不知道会增加什么样的业务类和业务操作，需要动态为业务类的具体业务操作提供代理，而不是交由业务类的开发人员对每个业务类开发相应的代理类，且不说提高了不少的开发量，如果哪天除了日志再增加一个权限处理的基础能力，还要对所有的代理类进行补充，岂不是要撞墙了。\n\nSpring的AOP借助了Java语言提供的动态代理机制对业务方法进行动态代理。当然Spring也对AspectJ这种功能更加强大的切面处理库进行了集成，本文不表。\n\n对于动态代理来说，需要首先有一个实现`InvocationHandler`接口的handler，可以简单认为是对被代理的方法的包装。\n\nHttpProxyHandler.java\n```\npublic class HttpProxyHandler implements InvocationHandler {\n    private HttpServer overseasHttpServer;\n\n    public HttpProxyHandler(HttpServer overseasHttpServer) {\n        this.overseasHttpServer = overseasHttpServer;\n    }\n\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        preRequest();\n        Object o = method.invoke(overseasHttpServer, args);\n        postRequest();\n        return o;\n    }\n\n    public void preRequest() {\n        System.out.println(\"拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...\");\n    }\n    public void postRequest() {\n        System.out.println(\"海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...\");\n    }\n}\n```\n\n这里，Handler中仍然需要引用被代理类的对象作为成员变量，甚至可以将成员变量直接声明为`Object`类型，从而代理类可以为更多业务类提供代理，如下：\n\n```\npublic class ProxyHandler implements InvocationHandler {\n    private Object obj;\n\n    public ProxyHandler(Object obj) {\n        this.obj = obj;\n    }\n\n    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n        preRequest();\n        Object o = method.invoke(obj, args);\n        postRequest();\n        return o;\n    }\n    \n    public void preInvoke() {}\n    public void postInvoke() {}\n}\n```\n\n这样，可以由子类覆盖`preInvode()`和`postInvoke()`，从而实现`HttpProxyHandler`和`HttpsProxyHandler`等等，用来具体定义Http和Https协议分别如何进行代理。这里其实有了模板模式的影子，这两个空方法就是模板元素。我们言归正传，仍然使用上一段代码继续我们的例子。\n\n我们看`InvocationHandler`的`invoke(Object proxy, Method method, Object[] args)`方法，`proxy`指的是动态生成的代理对象，`method`指的是被代理的操作方法，`args`指的是被代理方法的参数。可见Java语言的动态代理机制都已经给准备好了，我们只需要执行`method.invoke(obj, args)`就相当于被代理的对象执行了被代理的方法。\n\nHandler有了，那么动态代理的对象怎么生成的呢？Java提供了`Proxy`工具类`newProxyInstance(ClassLoader loader, Class<?>[] interfaces, InvocationHandler h)`来生成代理对象。其中第一个参数`loader`是类加载器，通常使用被代理类的类加载器即可；第二个参数`interfaces`是被代理类所实现的接口类数组，可见这种代理方式仍然是基于接口代理的，第三个参数就是我们刚刚准备好的handler。\n\n这个方法会返回一个代理对象，这个对象实现了`interfaces`指定的接口，因此可以转换类型，然后就可以同静态代理一样的方式来使用了。\n\nClient.java\n```\nHttpProxyHandler proxy = new HttpProxyHandler(overseasHttpServer);\nHttpServer httpProxy = (HttpServer) Proxy.newProxyInstance(proxy.getClass().getClassLoader(), \n    overseasHttpServer.getClass().getInterfaces(), proxy);\nhttpProxy.handleRequest();\n```\n\n# 总结\n\n关于代理模式，不用说太多，一图胜千言啊：\n\n![代理模式](https://raw.githubusercontent.com/xzyup/image/master/202203191513110.png)\n\n其特点有二：1. 代理类与被代理类基于同样的接口；2. 代理类引用了被代理类。\n\n这个模式容易与其他模式混淆，比如适配器模式：\n\n![适配器模式](https://raw.githubusercontent.com/xzyup/image/master/202203191513054.png)\n\n这两个分别是类适配器模式和对象适配器模式，尤其是对象适配器模式更像，但它们有本质的区别，那就是，适配器类和被适配的类并不基于同样的接口，而这正是“适配器”的用意所在——适配不同的接口。\n\n还有装饰器模式：\n\n![装饰器模式](https://raw.githubusercontent.com/xzyup/image/master/202203191514852.png)\n\n这俩就更像了，对装饰器模式来说，装饰者（decorator）和被装饰者（decoratee）都实现同一个 接口。对代理模式来说，代理类（proxy class）和真实处理的类（real class）都实现同一个接口。此外，不论我们使用哪一个模式，都可以很容易地在真实对象的方法前面或者后面加上自定义的方法。\n\n这两个模式从类关系上看，确实相差不多，但是主要区别在于应用场景和目的，装饰器模式应当为所装饰的对象提供增强功能，而代理模式对被代理的对象施加控制，并不提供对对象本身的增强。\n","slug":"design-pattern/代理模式","published":1,"date":"2022-04-20T12:41:20.945Z","updated":"2022-05-04T03:00:16.438Z","_id":"cl2qzfth5000t13nohx02gqy7","comments":1,"layout":"post","photos":[],"link":"","content":"<p>代理模式（Proxy Pattern）为指定的类的对象提供代理对象，并通过代理对象对原对象的引用，代理后者执行操作。</p>\n<p>咱们搞技术的，大多都需要用到网络代理服务，毕竟国外有丰富最新的IT资料，而国内的网络环境你懂得。不同的代理服务，由于协议和技术不同，原理也有差异，但大体思路都差不多。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191512727.png\" alt=\"HTTP代理示意图\"><br>如图，作为客户端的我们，当想访问海外的某台HTTP服务的时候，由于墙，网页打不开，这时候就需要网络代理服务，我们在自己电脑上安装一个代理客户端，这个代理客户端就能够将我们对那台海外HTTP服务器的请求转送至同样位于国外的网络代理服务器上，由于代理服务器在国外，因此访问海外HTTP服务器没问题，于是代为发送请求，并将收到的响应内容再传回给我们自己电脑，这样我们就相当于可以访问国外技术资料了。</p>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><h2 id=\"静态代理\"><a href=\"#静态代理\" class=\"headerlink\" title=\"静态代理\"></a>静态代理</h2><p>那么我们就以这个为例，写一个简单的代理模式的代码。</p>\n<p>首先，我们看，无论是海外HTTP服务还是网络代理服务器，对于我们来说，都是HTTP服务器，都能够接收HTTP请求，并返回相应的结果页面。我们并不关心如何进行的代理，实际上我们也不清楚它的具体原理和实现，我们只关心HTTP服务功能。于是我们的需求可以用以下接口来概况：</p>\n<p>HttpServer.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface HttpServer &#123;</span><br><span class=\"line\">    void handleRequest();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们想访问的那个海外网站的HTTP服务器就是一个具体实现：</p>\n<p>OverseasHttpServer.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class OverseasHttpServer implements HttpServer &#123;</span><br><span class=\"line\">    public void handleRequest() &#123;</span><br><span class=\"line\">        System.out.println(&quot;海外的HTTP服务器处理请求并返回结果...&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们来看一下代理服务器：</p>\n<p>HttpProxy.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class HttpProxy implements HttpServer &#123;</span><br><span class=\"line\">    private HttpServer overseasHttpServer;</span><br><span class=\"line\"></span><br><span class=\"line\">    public HttpProxy(HttpServer overseasHttpServer) &#123;</span><br><span class=\"line\">        this.overseasHttpServer = overseasHttpServer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void handleRequest() &#123;</span><br><span class=\"line\">        preRequest();</span><br><span class=\"line\">        this.overseasHttpServer.handleRequest();</span><br><span class=\"line\">        postRequest();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void preRequest() &#123;</span><br><span class=\"line\">        System.out.println(&quot;拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    public void postRequest() &#123;</span><br><span class=\"line\">        System.out.println(&quot;海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代理服务器也实现了<code>HttpServer</code>，这也很好理解，毕竟我们需要的是一个HTTP服务器，无论你是实际的，还是代理的，能够处理请求就好了，别的我不care～这是代理模式的第一个特点，那就是<strong>代理类同被代理类一样，都实现同样的接口，以便对外提供同样的服务</strong>。</p>\n<p>但是代理服务器毕竟只是一个中转，它<strong>必须要引入被代理服务器作为成员变量来执行核心的操作</strong>。此外，代理服务器可以在核心操作前后进行一些其他工作，以便更好的提供服务。</p>\n<p>测试一下代理效果：</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HttpServer overseasHttpServer = new OverseasHttpServer();</span><br><span class=\"line\">HttpServer httpServer = new HttpProxy(overseasHttpServer);</span><br><span class=\"line\">httpServer.handleRequest();</span><br></pre></td></tr></table></figure>\n\n<p>输出为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...</span><br><span class=\"line\">海外的HTTP服务器处理请求并返回结果...</span><br><span class=\"line\">海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...</span><br></pre></td></tr></table></figure>\n\n<p>可见确实是按照我们上边介绍的原理执行的HTTP代理服务。</p>\n<h2 id=\"动态代理\"><a href=\"#动态代理\" class=\"headerlink\" title=\"动态代理\"></a>动态代理</h2><p>不知您是否用过Spring进行开发，Spring以及其他的一些开发框架，都提供了面向切面开发（AOP）的能力。</p>\n<p>举个栗子，我们开发一个系统，首先要关心的是业务功能，而对于像记录日志这样的功能，通常是作为系统基础能力由框架提供。这样理想的效果就是，开发人员只需要开发功能就好，记录日志的功能由框架“切入”到具体业务方法的前后来实现。</p>\n<p>这其实类似于我们刚才提到的代理的例子，有<code>pre</code>和<code>post</code>的处理。但是对于框架来说，并不知道会增加什么样的业务类和业务操作，需要动态为业务类的具体业务操作提供代理，而不是交由业务类的开发人员对每个业务类开发相应的代理类，且不说提高了不少的开发量，如果哪天除了日志再增加一个权限处理的基础能力，还要对所有的代理类进行补充，岂不是要撞墙了。</p>\n<p>Spring的AOP借助了Java语言提供的动态代理机制对业务方法进行动态代理。当然Spring也对AspectJ这种功能更加强大的切面处理库进行了集成，本文不表。</p>\n<p>对于动态代理来说，需要首先有一个实现<code>InvocationHandler</code>接口的handler，可以简单认为是对被代理的方法的包装。</p>\n<p>HttpProxyHandler.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class HttpProxyHandler implements InvocationHandler &#123;</span><br><span class=\"line\">    private HttpServer overseasHttpServer;</span><br><span class=\"line\"></span><br><span class=\"line\">    public HttpProxyHandler(HttpServer overseasHttpServer) &#123;</span><br><span class=\"line\">        this.overseasHttpServer = overseasHttpServer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class=\"line\">        preRequest();</span><br><span class=\"line\">        Object o = method.invoke(overseasHttpServer, args);</span><br><span class=\"line\">        postRequest();</span><br><span class=\"line\">        return o;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void preRequest() &#123;</span><br><span class=\"line\">        System.out.println(&quot;拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    public void postRequest() &#123;</span><br><span class=\"line\">        System.out.println(&quot;海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里，Handler中仍然需要引用被代理类的对象作为成员变量，甚至可以将成员变量直接声明为<code>Object</code>类型，从而代理类可以为更多业务类提供代理，如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ProxyHandler implements InvocationHandler &#123;</span><br><span class=\"line\">    private Object obj;</span><br><span class=\"line\"></span><br><span class=\"line\">    public ProxyHandler(Object obj) &#123;</span><br><span class=\"line\">        this.obj = obj;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class=\"line\">        preRequest();</span><br><span class=\"line\">        Object o = method.invoke(obj, args);</span><br><span class=\"line\">        postRequest();</span><br><span class=\"line\">        return o;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    public void preInvoke() &#123;&#125;</span><br><span class=\"line\">    public void postInvoke() &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样，可以由子类覆盖<code>preInvode()</code>和<code>postInvoke()</code>，从而实现<code>HttpProxyHandler</code>和<code>HttpsProxyHandler</code>等等，用来具体定义Http和Https协议分别如何进行代理。这里其实有了模板模式的影子，这两个空方法就是模板元素。我们言归正传，仍然使用上一段代码继续我们的例子。</p>\n<p>我们看<code>InvocationHandler</code>的<code>invoke(Object proxy, Method method, Object[] args)</code>方法，<code>proxy</code>指的是动态生成的代理对象，<code>method</code>指的是被代理的操作方法，<code>args</code>指的是被代理方法的参数。可见Java语言的动态代理机制都已经给准备好了，我们只需要执行<code>method.invoke(obj, args)</code>就相当于被代理的对象执行了被代理的方法。</p>\n<p>Handler有了，那么动态代理的对象怎么生成的呢？Java提供了<code>Proxy</code>工具类<code>newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</code>来生成代理对象。其中第一个参数<code>loader</code>是类加载器，通常使用被代理类的类加载器即可；第二个参数<code>interfaces</code>是被代理类所实现的接口类数组，可见这种代理方式仍然是基于接口代理的，第三个参数就是我们刚刚准备好的handler。</p>\n<p>这个方法会返回一个代理对象，这个对象实现了<code>interfaces</code>指定的接口，因此可以转换类型，然后就可以同静态代理一样的方式来使用了。</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HttpProxyHandler proxy = new HttpProxyHandler(overseasHttpServer);</span><br><span class=\"line\">HttpServer httpProxy = (HttpServer) Proxy.newProxyInstance(proxy.getClass().getClassLoader(), </span><br><span class=\"line\">    overseasHttpServer.getClass().getInterfaces(), proxy);</span><br><span class=\"line\">httpProxy.handleRequest();</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>关于代理模式，不用说太多，一图胜千言啊：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191513110.png\" alt=\"代理模式\"></p>\n<p>其特点有二：1. 代理类与被代理类基于同样的接口；2. 代理类引用了被代理类。</p>\n<p>这个模式容易与其他模式混淆，比如适配器模式：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191513054.png\" alt=\"适配器模式\"></p>\n<p>这两个分别是类适配器模式和对象适配器模式，尤其是对象适配器模式更像，但它们有本质的区别，那就是，适配器类和被适配的类并不基于同样的接口，而这正是“适配器”的用意所在——适配不同的接口。</p>\n<p>还有装饰器模式：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191514852.png\" alt=\"装饰器模式\"></p>\n<p>这俩就更像了，对装饰器模式来说，装饰者（decorator）和被装饰者（decoratee）都实现同一个 接口。对代理模式来说，代理类（proxy class）和真实处理的类（real class）都实现同一个接口。此外，不论我们使用哪一个模式，都可以很容易地在真实对象的方法前面或者后面加上自定义的方法。</p>\n<p>这两个模式从类关系上看，确实相差不多，但是主要区别在于应用场景和目的，装饰器模式应当为所装饰的对象提供增强功能，而代理模式对被代理的对象施加控制，并不提供对对象本身的增强。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>代理模式（Proxy Pattern）为指定的类的对象提供代理对象，并通过代理对象对原对象的引用，代理后者执行操作。</p>\n<p>咱们搞技术的，大多都需要用到网络代理服务，毕竟国外有丰富最新的IT资料，而国内的网络环境你懂得。不同的代理服务，由于协议和技术不同，原理也有差异，但大体思路都差不多。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191512727.png\" alt=\"HTTP代理示意图\"><br>如图，作为客户端的我们，当想访问海外的某台HTTP服务的时候，由于墙，网页打不开，这时候就需要网络代理服务，我们在自己电脑上安装一个代理客户端，这个代理客户端就能够将我们对那台海外HTTP服务器的请求转送至同样位于国外的网络代理服务器上，由于代理服务器在国外，因此访问海外HTTP服务器没问题，于是代为发送请求，并将收到的响应内容再传回给我们自己电脑，这样我们就相当于可以访问国外技术资料了。</p>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><h2 id=\"静态代理\"><a href=\"#静态代理\" class=\"headerlink\" title=\"静态代理\"></a>静态代理</h2><p>那么我们就以这个为例，写一个简单的代理模式的代码。</p>\n<p>首先，我们看，无论是海外HTTP服务还是网络代理服务器，对于我们来说，都是HTTP服务器，都能够接收HTTP请求，并返回相应的结果页面。我们并不关心如何进行的代理，实际上我们也不清楚它的具体原理和实现，我们只关心HTTP服务功能。于是我们的需求可以用以下接口来概况：</p>\n<p>HttpServer.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface HttpServer &#123;</span><br><span class=\"line\">    void handleRequest();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们想访问的那个海外网站的HTTP服务器就是一个具体实现：</p>\n<p>OverseasHttpServer.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class OverseasHttpServer implements HttpServer &#123;</span><br><span class=\"line\">    public void handleRequest() &#123;</span><br><span class=\"line\">        System.out.println(&quot;海外的HTTP服务器处理请求并返回结果...&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们来看一下代理服务器：</p>\n<p>HttpProxy.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class HttpProxy implements HttpServer &#123;</span><br><span class=\"line\">    private HttpServer overseasHttpServer;</span><br><span class=\"line\"></span><br><span class=\"line\">    public HttpProxy(HttpServer overseasHttpServer) &#123;</span><br><span class=\"line\">        this.overseasHttpServer = overseasHttpServer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void handleRequest() &#123;</span><br><span class=\"line\">        preRequest();</span><br><span class=\"line\">        this.overseasHttpServer.handleRequest();</span><br><span class=\"line\">        postRequest();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void preRequest() &#123;</span><br><span class=\"line\">        System.out.println(&quot;拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    public void postRequest() &#123;</span><br><span class=\"line\">        System.out.println(&quot;海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代理服务器也实现了<code>HttpServer</code>，这也很好理解，毕竟我们需要的是一个HTTP服务器，无论你是实际的，还是代理的，能够处理请求就好了，别的我不care～这是代理模式的第一个特点，那就是<strong>代理类同被代理类一样，都实现同样的接口，以便对外提供同样的服务</strong>。</p>\n<p>但是代理服务器毕竟只是一个中转，它<strong>必须要引入被代理服务器作为成员变量来执行核心的操作</strong>。此外，代理服务器可以在核心操作前后进行一些其他工作，以便更好的提供服务。</p>\n<p>测试一下代理效果：</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HttpServer overseasHttpServer = new OverseasHttpServer();</span><br><span class=\"line\">HttpServer httpServer = new HttpProxy(overseasHttpServer);</span><br><span class=\"line\">httpServer.handleRequest();</span><br></pre></td></tr></table></figure>\n\n<p>输出为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...</span><br><span class=\"line\">海外的HTTP服务器处理请求并返回结果...</span><br><span class=\"line\">海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...</span><br></pre></td></tr></table></figure>\n\n<p>可见确实是按照我们上边介绍的原理执行的HTTP代理服务。</p>\n<h2 id=\"动态代理\"><a href=\"#动态代理\" class=\"headerlink\" title=\"动态代理\"></a>动态代理</h2><p>不知您是否用过Spring进行开发，Spring以及其他的一些开发框架，都提供了面向切面开发（AOP）的能力。</p>\n<p>举个栗子，我们开发一个系统，首先要关心的是业务功能，而对于像记录日志这样的功能，通常是作为系统基础能力由框架提供。这样理想的效果就是，开发人员只需要开发功能就好，记录日志的功能由框架“切入”到具体业务方法的前后来实现。</p>\n<p>这其实类似于我们刚才提到的代理的例子，有<code>pre</code>和<code>post</code>的处理。但是对于框架来说，并不知道会增加什么样的业务类和业务操作，需要动态为业务类的具体业务操作提供代理，而不是交由业务类的开发人员对每个业务类开发相应的代理类，且不说提高了不少的开发量，如果哪天除了日志再增加一个权限处理的基础能力，还要对所有的代理类进行补充，岂不是要撞墙了。</p>\n<p>Spring的AOP借助了Java语言提供的动态代理机制对业务方法进行动态代理。当然Spring也对AspectJ这种功能更加强大的切面处理库进行了集成，本文不表。</p>\n<p>对于动态代理来说，需要首先有一个实现<code>InvocationHandler</code>接口的handler，可以简单认为是对被代理的方法的包装。</p>\n<p>HttpProxyHandler.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class HttpProxyHandler implements InvocationHandler &#123;</span><br><span class=\"line\">    private HttpServer overseasHttpServer;</span><br><span class=\"line\"></span><br><span class=\"line\">    public HttpProxyHandler(HttpServer overseasHttpServer) &#123;</span><br><span class=\"line\">        this.overseasHttpServer = overseasHttpServer;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class=\"line\">        preRequest();</span><br><span class=\"line\">        Object o = method.invoke(overseasHttpServer, args);</span><br><span class=\"line\">        postRequest();</span><br><span class=\"line\">        return o;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void preRequest() &#123;</span><br><span class=\"line\">        System.out.println(&quot;拦截客户端的HTTP请求，发送至海外的代理服务器，由其向海外HTTP服务器发送请求...&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    public void postRequest() &#123;</span><br><span class=\"line\">        System.out.println(&quot;海外代理服务其接收海外HTTP服务器反馈的结果，发送回客户端浏览器进行显示...&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里，Handler中仍然需要引用被代理类的对象作为成员变量，甚至可以将成员变量直接声明为<code>Object</code>类型，从而代理类可以为更多业务类提供代理，如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ProxyHandler implements InvocationHandler &#123;</span><br><span class=\"line\">    private Object obj;</span><br><span class=\"line\"></span><br><span class=\"line\">    public ProxyHandler(Object obj) &#123;</span><br><span class=\"line\">        this.obj = obj;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class=\"line\">        preRequest();</span><br><span class=\"line\">        Object o = method.invoke(obj, args);</span><br><span class=\"line\">        postRequest();</span><br><span class=\"line\">        return o;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    public void preInvoke() &#123;&#125;</span><br><span class=\"line\">    public void postInvoke() &#123;&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这样，可以由子类覆盖<code>preInvode()</code>和<code>postInvoke()</code>，从而实现<code>HttpProxyHandler</code>和<code>HttpsProxyHandler</code>等等，用来具体定义Http和Https协议分别如何进行代理。这里其实有了模板模式的影子，这两个空方法就是模板元素。我们言归正传，仍然使用上一段代码继续我们的例子。</p>\n<p>我们看<code>InvocationHandler</code>的<code>invoke(Object proxy, Method method, Object[] args)</code>方法，<code>proxy</code>指的是动态生成的代理对象，<code>method</code>指的是被代理的操作方法，<code>args</code>指的是被代理方法的参数。可见Java语言的动态代理机制都已经给准备好了，我们只需要执行<code>method.invoke(obj, args)</code>就相当于被代理的对象执行了被代理的方法。</p>\n<p>Handler有了，那么动态代理的对象怎么生成的呢？Java提供了<code>Proxy</code>工具类<code>newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</code>来生成代理对象。其中第一个参数<code>loader</code>是类加载器，通常使用被代理类的类加载器即可；第二个参数<code>interfaces</code>是被代理类所实现的接口类数组，可见这种代理方式仍然是基于接口代理的，第三个参数就是我们刚刚准备好的handler。</p>\n<p>这个方法会返回一个代理对象，这个对象实现了<code>interfaces</code>指定的接口，因此可以转换类型，然后就可以同静态代理一样的方式来使用了。</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HttpProxyHandler proxy = new HttpProxyHandler(overseasHttpServer);</span><br><span class=\"line\">HttpServer httpProxy = (HttpServer) Proxy.newProxyInstance(proxy.getClass().getClassLoader(), </span><br><span class=\"line\">    overseasHttpServer.getClass().getInterfaces(), proxy);</span><br><span class=\"line\">httpProxy.handleRequest();</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>关于代理模式，不用说太多，一图胜千言啊：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191513110.png\" alt=\"代理模式\"></p>\n<p>其特点有二：1. 代理类与被代理类基于同样的接口；2. 代理类引用了被代理类。</p>\n<p>这个模式容易与其他模式混淆，比如适配器模式：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191513054.png\" alt=\"适配器模式\"></p>\n<p>这两个分别是类适配器模式和对象适配器模式，尤其是对象适配器模式更像，但它们有本质的区别，那就是，适配器类和被适配的类并不基于同样的接口，而这正是“适配器”的用意所在——适配不同的接口。</p>\n<p>还有装饰器模式：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191514852.png\" alt=\"装饰器模式\"></p>\n<p>这俩就更像了，对装饰器模式来说，装饰者（decorator）和被装饰者（decoratee）都实现同一个 接口。对代理模式来说，代理类（proxy class）和真实处理的类（real class）都实现同一个接口。此外，不论我们使用哪一个模式，都可以很容易地在真实对象的方法前面或者后面加上自定义的方法。</p>\n<p>这两个模式从类关系上看，确实相差不多，但是主要区别在于应用场景和目的，装饰器模式应当为所装饰的对象提供增强功能，而代理模式对被代理的对象施加控制，并不提供对对象本身的增强。</p>\n"},{"uuid":"bbaed2ed-c0ab-11ec-92a1-7557b2313227","title":"原型模式","abbrlink":"91ad9ce3","_content":"\n原型模式（Prototype Pattern）用于创建重复的对象，这种类型的设计模式属于创建型模式，与工厂模式类似，不同在于工厂模式通过`new`的方式创建对象，而原型模式通过复制既有对象的方式创建对象。当直接创建对象的代价比较大时，则采用这种模式。例如，一个对象需要在一个高代价的数据库操作之后被创建。我们可以缓存该对象，在下一个请求时返回它的克隆，在需要的时候更新数据库，以此来减少数据库调用。\n\n# 例子\n\n既然原型模式也是创建型模式，那么我们就用之前工厂模式的例子，也方便比较不同点。\n\n我们在用画图软件或做PPT的时候经常用到的操作就是复制图形。为什么复制呢？因为现画一个图形比较麻烦嘛，需要调整大小、设置填充色、边框颜色、图形内字体大小颜色等等。这也是原型模式用到的一种场景，那就是当类属性多而且复杂的时候，在new的时候传入各种参数给构造方法，不如直接用一个现有的对象直接复制一个来的痛快。\n\n假设我们在用PPT作图，无论是圆形、矩形还是三角形，都有填充颜色和边框颜色，以及图形内文字，因此可以抽象出一个`Shape`的抽象类，并且重写了`clone`方法。\n\nShape.java\n\n```\npublic abstract class Shape implements Cloneable {\n    protected String type;\n    protected String fillColor;\n    protected String frameColor;\n    protected String innerText;\n\n    @Override\n    public Shape clone() throws CloneNotSupportedException {\n        return (Shape)super.clone();\n    }\n\n    public abstract void draw();\n    \n    // getters & setters ... ...\n    \n}\n```\n\n各种不同的图形均继承`Shape`，同样也继承了其`clone()`方法。\n\nCircle.java\n\n```\npublic class Circle extends Shape {\n    public Circle() {\n        this.type = \"circle\";\n    }\n\n    public void draw() {\n        System.out.println(\"Draw a \" + type + \", fill with \" + fillColor + \", frame color is \" + frameColor + \", inner text is [\" + innerText + \"].\");\n    }\n}\n```\n\nRectangle.java\n\n```\npublic class Rectangle extends Shape {\n    public Rectangle() {\n        this.type = \"rectangle\";\n    }\n\n    public void draw() {\n        System.out.println(\"Draw a \" + type + \", fill with \" + fillColor + \", frame color is \" + frameColor + \", inner text is [\" + innerText + \"].\");\n    }\n}\n```\n\nTriangle.java\n\n```\npublic class Triangle extends Shape {\n    public Triangle() {\n        this.type = \"triangle\";\n    }\n\n    public void draw() {\n        System.out.println(\"Draw a \" + type + \", fill with \" + fillColor + \", frame color is \" + frameColor + \", inner text is [\" + innerText + \"].\");\n    }\n}\n```\n\n下面我们来在main方法中使用一下这个原型复制的能力。\n\nClient.java\n\n```\npublic static void main(String[] args) throws CloneNotSupportedException {\n    Shape circle1 = new Circle();\n    circle1.setFillColor(\"red\");\n    circle1.setFrameColor(\"green\");\n    circle1.setInnerText(\"Design patterns\");\n    circle1.draw();\n\n    Shape circle2 = circle1.clone();\n    circle2.draw();\n}\n```\n\n输出为：\n\n```\nDraw a circle, fill with red, frame color is green, inner text is [Design patterns].\nDraw a circle, fill with red, frame color is green, inner text is [Design patterns].\n```\n\n这就是原型模式。\n\n# 总结\n\n通过上述内容，你大概也知道了原型模型的应用场景，那就是“当new一个对象成本较高的时候”，再举几个例子：\n\n1. 当一个系统应该独立于它的产品创建，构成和表示时。\n2. 当要实例化的类是在运行时指定时，例如，通过动态装载。\n3. 为了避免创建一个与产品类层次平行的工厂类层次时。\n4. 当一个类的实例只能有几个不同状态组合中的一种时。建立相应数目的原型并克隆它们可能比每次用合适的状态手工实例化该类更方便一些。\n\n除此之外，还有别的好处哟：\n\n1. 性能好`clone()`是源自`Object`类中的`native`方法，其执行效率相对较高。\n2. 可以逃避构造方法的束缚，因为不需要`new`了嘛。\n\n使用原型模式有几点注意事项：\n\n1. 类本身或其父类必须实现`Cloneable`接口，并用`public`的`clone()`方法覆盖`Object`的同名方法；\n2. 根据实际情况判断是”浅复制“还是”深复制“，若深复制用序列化方式实现，则类本身或其父类须实现`Serializable`接口；\n3. 实际开发过程中注意业务逻辑，比如id等成员要保证不重复。\n\n其实结合最近几个设计模式的例子，你可能会发现，我前边介绍到的设计模式的类关系模型，有些是同GoF的一致的，有些是有差别的。其实看网上其他的设计模式的博文介绍也有这种感觉，那就是似乎感觉同样一个设计模式，不同的文章介绍出来类关系怎么不一样。比如对于抽象，有的是用接口，有的是用抽象类；比如对于继承关系，有的是一层，有的是两层。这时候总有些不知所措：到底哪个是正宗的呢？\n\n其实对于设计模式，大可不必追求“正宗”，就像到了长沙，各种臭豆腐店，尝遍之后也很难说哪个是正宗的，但是它们都有共同点：基本是黑色的黑暗料理，闻起来有点臭但是吃起来香，烹饪方法都是油炸等等。抓住这些基本特点，只要好吃，那就OK咯～说回设计模式，归根到底是对“面向对象思想”应用的一些成熟的模型，不要“拿来主义”生搬硬套，抓住核心特征，符合实际情况即可，所谓“无招胜有招”嘛。那么对于原型模式，其核心特征在于`clone`。\n","source":"_posts/design-pattern/原型模式.md","raw":"---\nuuid: bbaed2ed-c0ab-11ec-92a1-7557b2313227\ntitle: 原型模式\ntags: 设计模式\ncategories: Java\nabbrlink: 91ad9ce3\n---\n\n原型模式（Prototype Pattern）用于创建重复的对象，这种类型的设计模式属于创建型模式，与工厂模式类似，不同在于工厂模式通过`new`的方式创建对象，而原型模式通过复制既有对象的方式创建对象。当直接创建对象的代价比较大时，则采用这种模式。例如，一个对象需要在一个高代价的数据库操作之后被创建。我们可以缓存该对象，在下一个请求时返回它的克隆，在需要的时候更新数据库，以此来减少数据库调用。\n\n# 例子\n\n既然原型模式也是创建型模式，那么我们就用之前工厂模式的例子，也方便比较不同点。\n\n我们在用画图软件或做PPT的时候经常用到的操作就是复制图形。为什么复制呢？因为现画一个图形比较麻烦嘛，需要调整大小、设置填充色、边框颜色、图形内字体大小颜色等等。这也是原型模式用到的一种场景，那就是当类属性多而且复杂的时候，在new的时候传入各种参数给构造方法，不如直接用一个现有的对象直接复制一个来的痛快。\n\n假设我们在用PPT作图，无论是圆形、矩形还是三角形，都有填充颜色和边框颜色，以及图形内文字，因此可以抽象出一个`Shape`的抽象类，并且重写了`clone`方法。\n\nShape.java\n\n```\npublic abstract class Shape implements Cloneable {\n    protected String type;\n    protected String fillColor;\n    protected String frameColor;\n    protected String innerText;\n\n    @Override\n    public Shape clone() throws CloneNotSupportedException {\n        return (Shape)super.clone();\n    }\n\n    public abstract void draw();\n    \n    // getters & setters ... ...\n    \n}\n```\n\n各种不同的图形均继承`Shape`，同样也继承了其`clone()`方法。\n\nCircle.java\n\n```\npublic class Circle extends Shape {\n    public Circle() {\n        this.type = \"circle\";\n    }\n\n    public void draw() {\n        System.out.println(\"Draw a \" + type + \", fill with \" + fillColor + \", frame color is \" + frameColor + \", inner text is [\" + innerText + \"].\");\n    }\n}\n```\n\nRectangle.java\n\n```\npublic class Rectangle extends Shape {\n    public Rectangle() {\n        this.type = \"rectangle\";\n    }\n\n    public void draw() {\n        System.out.println(\"Draw a \" + type + \", fill with \" + fillColor + \", frame color is \" + frameColor + \", inner text is [\" + innerText + \"].\");\n    }\n}\n```\n\nTriangle.java\n\n```\npublic class Triangle extends Shape {\n    public Triangle() {\n        this.type = \"triangle\";\n    }\n\n    public void draw() {\n        System.out.println(\"Draw a \" + type + \", fill with \" + fillColor + \", frame color is \" + frameColor + \", inner text is [\" + innerText + \"].\");\n    }\n}\n```\n\n下面我们来在main方法中使用一下这个原型复制的能力。\n\nClient.java\n\n```\npublic static void main(String[] args) throws CloneNotSupportedException {\n    Shape circle1 = new Circle();\n    circle1.setFillColor(\"red\");\n    circle1.setFrameColor(\"green\");\n    circle1.setInnerText(\"Design patterns\");\n    circle1.draw();\n\n    Shape circle2 = circle1.clone();\n    circle2.draw();\n}\n```\n\n输出为：\n\n```\nDraw a circle, fill with red, frame color is green, inner text is [Design patterns].\nDraw a circle, fill with red, frame color is green, inner text is [Design patterns].\n```\n\n这就是原型模式。\n\n# 总结\n\n通过上述内容，你大概也知道了原型模型的应用场景，那就是“当new一个对象成本较高的时候”，再举几个例子：\n\n1. 当一个系统应该独立于它的产品创建，构成和表示时。\n2. 当要实例化的类是在运行时指定时，例如，通过动态装载。\n3. 为了避免创建一个与产品类层次平行的工厂类层次时。\n4. 当一个类的实例只能有几个不同状态组合中的一种时。建立相应数目的原型并克隆它们可能比每次用合适的状态手工实例化该类更方便一些。\n\n除此之外，还有别的好处哟：\n\n1. 性能好`clone()`是源自`Object`类中的`native`方法，其执行效率相对较高。\n2. 可以逃避构造方法的束缚，因为不需要`new`了嘛。\n\n使用原型模式有几点注意事项：\n\n1. 类本身或其父类必须实现`Cloneable`接口，并用`public`的`clone()`方法覆盖`Object`的同名方法；\n2. 根据实际情况判断是”浅复制“还是”深复制“，若深复制用序列化方式实现，则类本身或其父类须实现`Serializable`接口；\n3. 实际开发过程中注意业务逻辑，比如id等成员要保证不重复。\n\n其实结合最近几个设计模式的例子，你可能会发现，我前边介绍到的设计模式的类关系模型，有些是同GoF的一致的，有些是有差别的。其实看网上其他的设计模式的博文介绍也有这种感觉，那就是似乎感觉同样一个设计模式，不同的文章介绍出来类关系怎么不一样。比如对于抽象，有的是用接口，有的是用抽象类；比如对于继承关系，有的是一层，有的是两层。这时候总有些不知所措：到底哪个是正宗的呢？\n\n其实对于设计模式，大可不必追求“正宗”，就像到了长沙，各种臭豆腐店，尝遍之后也很难说哪个是正宗的，但是它们都有共同点：基本是黑色的黑暗料理，闻起来有点臭但是吃起来香，烹饪方法都是油炸等等。抓住这些基本特点，只要好吃，那就OK咯～说回设计模式，归根到底是对“面向对象思想”应用的一些成熟的模型，不要“拿来主义”生搬硬套，抓住核心特征，符合实际情况即可，所谓“无招胜有招”嘛。那么对于原型模式，其核心特征在于`clone`。\n","slug":"design-pattern/原型模式","published":1,"date":"2022-04-20T12:41:20.950Z","updated":"2022-05-04T03:01:25.338Z","_id":"cl2qzfth6000v13noc3sfcdp7","comments":1,"layout":"post","photos":[],"link":"","content":"<p>原型模式（Prototype Pattern）用于创建重复的对象，这种类型的设计模式属于创建型模式，与工厂模式类似，不同在于工厂模式通过<code>new</code>的方式创建对象，而原型模式通过复制既有对象的方式创建对象。当直接创建对象的代价比较大时，则采用这种模式。例如，一个对象需要在一个高代价的数据库操作之后被创建。我们可以缓存该对象，在下一个请求时返回它的克隆，在需要的时候更新数据库，以此来减少数据库调用。</p>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>既然原型模式也是创建型模式，那么我们就用之前工厂模式的例子，也方便比较不同点。</p>\n<p>我们在用画图软件或做PPT的时候经常用到的操作就是复制图形。为什么复制呢？因为现画一个图形比较麻烦嘛，需要调整大小、设置填充色、边框颜色、图形内字体大小颜色等等。这也是原型模式用到的一种场景，那就是当类属性多而且复杂的时候，在new的时候传入各种参数给构造方法，不如直接用一个现有的对象直接复制一个来的痛快。</p>\n<p>假设我们在用PPT作图，无论是圆形、矩形还是三角形，都有填充颜色和边框颜色，以及图形内文字，因此可以抽象出一个<code>Shape</code>的抽象类，并且重写了<code>clone</code>方法。</p>\n<p>Shape.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public abstract class Shape implements Cloneable &#123;</span><br><span class=\"line\">    protected String type;</span><br><span class=\"line\">    protected String fillColor;</span><br><span class=\"line\">    protected String frameColor;</span><br><span class=\"line\">    protected String innerText;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public Shape clone() throws CloneNotSupportedException &#123;</span><br><span class=\"line\">        return (Shape)super.clone();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public abstract void draw();</span><br><span class=\"line\">    </span><br><span class=\"line\">    // getters &amp; setters ... ...</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>各种不同的图形均继承<code>Shape</code>，同样也继承了其<code>clone()</code>方法。</p>\n<p>Circle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Circle extends Shape &#123;</span><br><span class=\"line\">    public Circle() &#123;</span><br><span class=\"line\">        this.type = &quot;circle&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void draw() &#123;</span><br><span class=\"line\">        System.out.println(&quot;Draw a &quot; + type + &quot;, fill with &quot; + fillColor + &quot;, frame color is &quot; + frameColor + &quot;, inner text is [&quot; + innerText + &quot;].&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Rectangle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Rectangle extends Shape &#123;</span><br><span class=\"line\">    public Rectangle() &#123;</span><br><span class=\"line\">        this.type = &quot;rectangle&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void draw() &#123;</span><br><span class=\"line\">        System.out.println(&quot;Draw a &quot; + type + &quot;, fill with &quot; + fillColor + &quot;, frame color is &quot; + frameColor + &quot;, inner text is [&quot; + innerText + &quot;].&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Triangle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Triangle extends Shape &#123;</span><br><span class=\"line\">    public Triangle() &#123;</span><br><span class=\"line\">        this.type = &quot;triangle&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void draw() &#123;</span><br><span class=\"line\">        System.out.println(&quot;Draw a &quot; + type + &quot;, fill with &quot; + fillColor + &quot;, frame color is &quot; + frameColor + &quot;, inner text is [&quot; + innerText + &quot;].&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面我们来在main方法中使用一下这个原型复制的能力。</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void main(String[] args) throws CloneNotSupportedException &#123;</span><br><span class=\"line\">    Shape circle1 = new Circle();</span><br><span class=\"line\">    circle1.setFillColor(&quot;red&quot;);</span><br><span class=\"line\">    circle1.setFrameColor(&quot;green&quot;);</span><br><span class=\"line\">    circle1.setInnerText(&quot;Design patterns&quot;);</span><br><span class=\"line\">    circle1.draw();</span><br><span class=\"line\"></span><br><span class=\"line\">    Shape circle2 = circle1.clone();</span><br><span class=\"line\">    circle2.draw();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Draw a circle, fill with red, frame color is green, inner text is [Design patterns].</span><br><span class=\"line\">Draw a circle, fill with red, frame color is green, inner text is [Design patterns].</span><br></pre></td></tr></table></figure>\n\n<p>这就是原型模式。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>通过上述内容，你大概也知道了原型模型的应用场景，那就是“当new一个对象成本较高的时候”，再举几个例子：</p>\n<ol>\n<li>当一个系统应该独立于它的产品创建，构成和表示时。</li>\n<li>当要实例化的类是在运行时指定时，例如，通过动态装载。</li>\n<li>为了避免创建一个与产品类层次平行的工厂类层次时。</li>\n<li>当一个类的实例只能有几个不同状态组合中的一种时。建立相应数目的原型并克隆它们可能比每次用合适的状态手工实例化该类更方便一些。</li>\n</ol>\n<p>除此之外，还有别的好处哟：</p>\n<ol>\n<li>性能好<code>clone()</code>是源自<code>Object</code>类中的<code>native</code>方法，其执行效率相对较高。</li>\n<li>可以逃避构造方法的束缚，因为不需要<code>new</code>了嘛。</li>\n</ol>\n<p>使用原型模式有几点注意事项：</p>\n<ol>\n<li>类本身或其父类必须实现<code>Cloneable</code>接口，并用<code>public</code>的<code>clone()</code>方法覆盖<code>Object</code>的同名方法；</li>\n<li>根据实际情况判断是”浅复制“还是”深复制“，若深复制用序列化方式实现，则类本身或其父类须实现<code>Serializable</code>接口；</li>\n<li>实际开发过程中注意业务逻辑，比如id等成员要保证不重复。</li>\n</ol>\n<p>其实结合最近几个设计模式的例子，你可能会发现，我前边介绍到的设计模式的类关系模型，有些是同GoF的一致的，有些是有差别的。其实看网上其他的设计模式的博文介绍也有这种感觉，那就是似乎感觉同样一个设计模式，不同的文章介绍出来类关系怎么不一样。比如对于抽象，有的是用接口，有的是用抽象类；比如对于继承关系，有的是一层，有的是两层。这时候总有些不知所措：到底哪个是正宗的呢？</p>\n<p>其实对于设计模式，大可不必追求“正宗”，就像到了长沙，各种臭豆腐店，尝遍之后也很难说哪个是正宗的，但是它们都有共同点：基本是黑色的黑暗料理，闻起来有点臭但是吃起来香，烹饪方法都是油炸等等。抓住这些基本特点，只要好吃，那就OK咯～说回设计模式，归根到底是对“面向对象思想”应用的一些成熟的模型，不要“拿来主义”生搬硬套，抓住核心特征，符合实际情况即可，所谓“无招胜有招”嘛。那么对于原型模式，其核心特征在于<code>clone</code>。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>原型模式（Prototype Pattern）用于创建重复的对象，这种类型的设计模式属于创建型模式，与工厂模式类似，不同在于工厂模式通过<code>new</code>的方式创建对象，而原型模式通过复制既有对象的方式创建对象。当直接创建对象的代价比较大时，则采用这种模式。例如，一个对象需要在一个高代价的数据库操作之后被创建。我们可以缓存该对象，在下一个请求时返回它的克隆，在需要的时候更新数据库，以此来减少数据库调用。</p>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>既然原型模式也是创建型模式，那么我们就用之前工厂模式的例子，也方便比较不同点。</p>\n<p>我们在用画图软件或做PPT的时候经常用到的操作就是复制图形。为什么复制呢？因为现画一个图形比较麻烦嘛，需要调整大小、设置填充色、边框颜色、图形内字体大小颜色等等。这也是原型模式用到的一种场景，那就是当类属性多而且复杂的时候，在new的时候传入各种参数给构造方法，不如直接用一个现有的对象直接复制一个来的痛快。</p>\n<p>假设我们在用PPT作图，无论是圆形、矩形还是三角形，都有填充颜色和边框颜色，以及图形内文字，因此可以抽象出一个<code>Shape</code>的抽象类，并且重写了<code>clone</code>方法。</p>\n<p>Shape.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public abstract class Shape implements Cloneable &#123;</span><br><span class=\"line\">    protected String type;</span><br><span class=\"line\">    protected String fillColor;</span><br><span class=\"line\">    protected String frameColor;</span><br><span class=\"line\">    protected String innerText;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Override</span><br><span class=\"line\">    public Shape clone() throws CloneNotSupportedException &#123;</span><br><span class=\"line\">        return (Shape)super.clone();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public abstract void draw();</span><br><span class=\"line\">    </span><br><span class=\"line\">    // getters &amp; setters ... ...</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>各种不同的图形均继承<code>Shape</code>，同样也继承了其<code>clone()</code>方法。</p>\n<p>Circle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Circle extends Shape &#123;</span><br><span class=\"line\">    public Circle() &#123;</span><br><span class=\"line\">        this.type = &quot;circle&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void draw() &#123;</span><br><span class=\"line\">        System.out.println(&quot;Draw a &quot; + type + &quot;, fill with &quot; + fillColor + &quot;, frame color is &quot; + frameColor + &quot;, inner text is [&quot; + innerText + &quot;].&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Rectangle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Rectangle extends Shape &#123;</span><br><span class=\"line\">    public Rectangle() &#123;</span><br><span class=\"line\">        this.type = &quot;rectangle&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void draw() &#123;</span><br><span class=\"line\">        System.out.println(&quot;Draw a &quot; + type + &quot;, fill with &quot; + fillColor + &quot;, frame color is &quot; + frameColor + &quot;, inner text is [&quot; + innerText + &quot;].&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Triangle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Triangle extends Shape &#123;</span><br><span class=\"line\">    public Triangle() &#123;</span><br><span class=\"line\">        this.type = &quot;triangle&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void draw() &#123;</span><br><span class=\"line\">        System.out.println(&quot;Draw a &quot; + type + &quot;, fill with &quot; + fillColor + &quot;, frame color is &quot; + frameColor + &quot;, inner text is [&quot; + innerText + &quot;].&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面我们来在main方法中使用一下这个原型复制的能力。</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public static void main(String[] args) throws CloneNotSupportedException &#123;</span><br><span class=\"line\">    Shape circle1 = new Circle();</span><br><span class=\"line\">    circle1.setFillColor(&quot;red&quot;);</span><br><span class=\"line\">    circle1.setFrameColor(&quot;green&quot;);</span><br><span class=\"line\">    circle1.setInnerText(&quot;Design patterns&quot;);</span><br><span class=\"line\">    circle1.draw();</span><br><span class=\"line\"></span><br><span class=\"line\">    Shape circle2 = circle1.clone();</span><br><span class=\"line\">    circle2.draw();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Draw a circle, fill with red, frame color is green, inner text is [Design patterns].</span><br><span class=\"line\">Draw a circle, fill with red, frame color is green, inner text is [Design patterns].</span><br></pre></td></tr></table></figure>\n\n<p>这就是原型模式。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>通过上述内容，你大概也知道了原型模型的应用场景，那就是“当new一个对象成本较高的时候”，再举几个例子：</p>\n<ol>\n<li>当一个系统应该独立于它的产品创建，构成和表示时。</li>\n<li>当要实例化的类是在运行时指定时，例如，通过动态装载。</li>\n<li>为了避免创建一个与产品类层次平行的工厂类层次时。</li>\n<li>当一个类的实例只能有几个不同状态组合中的一种时。建立相应数目的原型并克隆它们可能比每次用合适的状态手工实例化该类更方便一些。</li>\n</ol>\n<p>除此之外，还有别的好处哟：</p>\n<ol>\n<li>性能好<code>clone()</code>是源自<code>Object</code>类中的<code>native</code>方法，其执行效率相对较高。</li>\n<li>可以逃避构造方法的束缚，因为不需要<code>new</code>了嘛。</li>\n</ol>\n<p>使用原型模式有几点注意事项：</p>\n<ol>\n<li>类本身或其父类必须实现<code>Cloneable</code>接口，并用<code>public</code>的<code>clone()</code>方法覆盖<code>Object</code>的同名方法；</li>\n<li>根据实际情况判断是”浅复制“还是”深复制“，若深复制用序列化方式实现，则类本身或其父类须实现<code>Serializable</code>接口；</li>\n<li>实际开发过程中注意业务逻辑，比如id等成员要保证不重复。</li>\n</ol>\n<p>其实结合最近几个设计模式的例子，你可能会发现，我前边介绍到的设计模式的类关系模型，有些是同GoF的一致的，有些是有差别的。其实看网上其他的设计模式的博文介绍也有这种感觉，那就是似乎感觉同样一个设计模式，不同的文章介绍出来类关系怎么不一样。比如对于抽象，有的是用接口，有的是用抽象类；比如对于继承关系，有的是一层，有的是两层。这时候总有些不知所措：到底哪个是正宗的呢？</p>\n<p>其实对于设计模式，大可不必追求“正宗”，就像到了长沙，各种臭豆腐店，尝遍之后也很难说哪个是正宗的，但是它们都有共同点：基本是黑色的黑暗料理，闻起来有点臭但是吃起来香，烹饪方法都是油炸等等。抓住这些基本特点，只要好吃，那就OK咯～说回设计模式，归根到底是对“面向对象思想”应用的一些成熟的模型，不要“拿来主义”生搬硬套，抓住核心特征，符合实际情况即可，所谓“无招胜有招”嘛。那么对于原型模式，其核心特征在于<code>clone</code>。</p>\n"},{"uuid":"bbaed2ee-c0ab-11ec-92a1-7557b2313227","title":"工厂模式","abbrlink":"54788f73","_content":"\n\n工厂模式（Factory Pattern）是 Java 中最常用的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象很好的方式。具体来说，有简单工厂模式（simple factory）、工厂方法模式（factory method)和抽象工厂模式（abstract factory）等模式。 本篇先从简单工厂模式谈起。\n\n# 例子\n\n请设想一个简单的需求，你在做一个画图软件，可以画矩形、三角形和圆形等，每一种图形都用一个类来管理：\n\n- `Rectangle`\n- `Circle`\n- `Triangle` 每个类都有各自的`draw()`方法，当需要画某种图形的时候就可以：\n\nClient.java\n\n```\n// 画矩形时：\nRectangle r = new Rectangle();\nr.draw();\n// 画圆形时：\nCircle c = new Circle();\nc.draw();\n// 画三角形时：\nTriangle t = new Triangle();\nt.draw();\n```\n\n如果这时增加一个`Star`类型的图形，就得需要增加一个`new Star()`来获取对象，这显然是不符合开闭原则。所谓开闭原则，即对扩展开放，对修改关闭。\n\n要想实现开闭原则，就需要考虑把创建对象的过程统一起来，并且能够满足扩展图形类型的需要。我们自然而然地就能想到这些图形都是有共同点可以抽象的，它们都实现了`draw()`方法，因此可以增加一个共同的接口，即“针对接口编程，依赖于抽象而不依赖于具体”，这就是“依赖倒转”的原则。\n\nShape.java\n\n```\npublic interface Shape {\n   void draw();\n}\n```\n\nRectangle.java\n\n```\npublic class Rectangle implements Shape {\n   @Override\n   public void draw() {\n      System.out.println(\"Draw a rectangle.\");\n   }\n}\n```\n\nTriangle.java\n\n```\npublic class Triangle implements Shape {\n   @Override\n   public void draw() {\n      System.out.println(\"Draw a triangle.\");\n   }\n}\n```\n\nCircle.java\n\n```\npublic class Circle implements Shape {\n   @Override\n   public void draw() {\n      System.out.println(\"Draw a circle.\");\n   }\n}\n```\n\n然后屏蔽掉具体类型的创建语句，那么就可以一定程度上做到“开闭原则”了。这时就需要工厂类登场了，它有一个用来返回具体产品对象的方法，注意这个方法是静态（static）的，也因此简单工厂模式有时候也被叫做“静态工厂模式”。\n\nShapeFactory.java\n\n```\npublic class ShapeFactory {\n   //使用 getShape 方法获取形状类型的对象\n   public static Shape getShape(String shapeType){\n      if(shapeType == null){\n         return null;\n      }        \n      if(shapeType.equalsIgnoreCase(\"CIRCLE\")){\n         return new Circle();\n      } else if(shapeType.equalsIgnoreCase(\"RECTANGLE\")){\n         return new Rectangle();\n      } else if(shapeType.equalsIgnoreCase(\"TRIANGLE\")){\n         return new Triangle();\n      }\n      return null;\n   }\n}\n```\n\n有了工厂类，再画图的时候刚才的`Client.java`就可以改一改了：\n\nClient.java\n\n```\n//画矩形时:\nShape r = ShapeFactory.getShape(\"RECTANGLE\");\nr.draw();\n//画圆形时:\nShape c = ShapeFactory.getShape(\"CIRCLE\");\nc.draw();\n//画三角形时:\nShape t = ShapeFactory.getShape(\"TRIANGLE\");\nt.draw();\n```\n\n此时如果增加一个Star的图形类型，也可以从容应对了，从使用者`Client`的角度，无需关心对象是如何创建的。 各个类之间的关系如下：\n![关系类图](https://raw.githubusercontent.com/xzyup/image/master/202203191517555.png)\n\n此外还有一个类似的例子，可自行查看源码：\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191518463.png)\n\n看到这里可能你会觉得，前后两个版本的`Client`并没有太大的不同，反而采用了工厂模式后更加复杂了。其实作为一种创建类模式，在任何需要生成复杂对象的地方，都可以使用工厂方法模式。有一点需要注意的地方就是**复杂对象适合使用工厂模式，而简单对象，特别是只需要通过 new 就可以完成创建的对象，无需使用工厂模式。如果使用工厂模式，就需要引入一个工厂类，会增加系统的复杂度。**\n\n此外，在具体使用时，也会有不同的调整，比如：\n\n1. `ShapeFactory`的`getShape(String)`方法也可以改为非`static`的，这样就需要首先构造一个实际的工厂对象来创建产品了；\n2. 工厂类、抽象产品和具体产品这三个角色有可能部分或全部合并，我们来看一个Java中经常用到的关于日期类型格式化的例子：\n\nDateTest.java\n\n```\nimport java.util.*;  \nimport java.text.*;  \npublic class DateTest  \n{  \n    public static void main(String[] args)  \n    {  \n        Locale local = Locale.FRENCH;  \n        Date date = new Date();  \n        String now = DateFormat.getTimeInstance(DateFormat.DEFAULT,local).format(date);  \n        System.out.println(now);  \n        try  \n        {  \n            date = DateFormat.getDateInstance(DateFormat.DEFAULT,local).parse(\"16 nov. 01\");  \n            System.out.println(date);  \n        }  \n        catch (ParseException e)  \n        {  \n            System.out.println(\"Parsing exception:\" + e);  \n        }  \n    }  \n}  \n```\n\n而我们知道DateFormat是个抽象类，`public final static DateFormat getDateInstance(...)`的静态方法，也使得它自身既是一个抽象产品角色，又是一个工厂类角色，完成具体产品角色的创建（比如`SimpleDateFormat`）。\n\n如果三个角色全部合并，其实就是一个类，增加了一个创建自身对象的方法。\n\n# 总结\n\n在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。\n\n**使用场景**： 1、日志记录器：记录可能记录到本地硬盘、系统事件、远程服务器等，用户可以选择记录日志到什么地方。 2、数据库访问，当用户不知道最后系统采用哪一类数据库，以及数据库可能有变化时。 3、设计一个连接服务器的框架，需要三个协议，\"POP3\"、\"IMAP\"、\"HTTP\"，可以把这三个作为产品类，共同实现一个接口。\n\n**优点**： 一个调用者想创建一个对象，只要提出要求就可以了；屏蔽产品的具体实现，调用者只关心产品的接口；一定程度上提高了扩展性。\n\n**缺点**：每次增加一个产品时，都需要增加一个具体类和对象实现工厂，使得系统中类的个数成倍增加，在一定程度上增加了系统的复杂度，同时也增加了系统具体类的依赖。可见，简单工厂模式对\"开-闭\"原则的支持还不够，因为如果有新的产品加入到系统中去，就需要修改工厂类，将必要的逻辑加入到工厂类中。\n","source":"_posts/design-pattern/工厂模式.md","raw":"---\nuuid: bbaed2ee-c0ab-11ec-92a1-7557b2313227\ntitle: 工厂模式\ntags: 设计模式\ncategories: Java\nabbrlink: 54788f73\n---\n\n\n工厂模式（Factory Pattern）是 Java 中最常用的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象很好的方式。具体来说，有简单工厂模式（simple factory）、工厂方法模式（factory method)和抽象工厂模式（abstract factory）等模式。 本篇先从简单工厂模式谈起。\n\n# 例子\n\n请设想一个简单的需求，你在做一个画图软件，可以画矩形、三角形和圆形等，每一种图形都用一个类来管理：\n\n- `Rectangle`\n- `Circle`\n- `Triangle` 每个类都有各自的`draw()`方法，当需要画某种图形的时候就可以：\n\nClient.java\n\n```\n// 画矩形时：\nRectangle r = new Rectangle();\nr.draw();\n// 画圆形时：\nCircle c = new Circle();\nc.draw();\n// 画三角形时：\nTriangle t = new Triangle();\nt.draw();\n```\n\n如果这时增加一个`Star`类型的图形，就得需要增加一个`new Star()`来获取对象，这显然是不符合开闭原则。所谓开闭原则，即对扩展开放，对修改关闭。\n\n要想实现开闭原则，就需要考虑把创建对象的过程统一起来，并且能够满足扩展图形类型的需要。我们自然而然地就能想到这些图形都是有共同点可以抽象的，它们都实现了`draw()`方法，因此可以增加一个共同的接口，即“针对接口编程，依赖于抽象而不依赖于具体”，这就是“依赖倒转”的原则。\n\nShape.java\n\n```\npublic interface Shape {\n   void draw();\n}\n```\n\nRectangle.java\n\n```\npublic class Rectangle implements Shape {\n   @Override\n   public void draw() {\n      System.out.println(\"Draw a rectangle.\");\n   }\n}\n```\n\nTriangle.java\n\n```\npublic class Triangle implements Shape {\n   @Override\n   public void draw() {\n      System.out.println(\"Draw a triangle.\");\n   }\n}\n```\n\nCircle.java\n\n```\npublic class Circle implements Shape {\n   @Override\n   public void draw() {\n      System.out.println(\"Draw a circle.\");\n   }\n}\n```\n\n然后屏蔽掉具体类型的创建语句，那么就可以一定程度上做到“开闭原则”了。这时就需要工厂类登场了，它有一个用来返回具体产品对象的方法，注意这个方法是静态（static）的，也因此简单工厂模式有时候也被叫做“静态工厂模式”。\n\nShapeFactory.java\n\n```\npublic class ShapeFactory {\n   //使用 getShape 方法获取形状类型的对象\n   public static Shape getShape(String shapeType){\n      if(shapeType == null){\n         return null;\n      }        \n      if(shapeType.equalsIgnoreCase(\"CIRCLE\")){\n         return new Circle();\n      } else if(shapeType.equalsIgnoreCase(\"RECTANGLE\")){\n         return new Rectangle();\n      } else if(shapeType.equalsIgnoreCase(\"TRIANGLE\")){\n         return new Triangle();\n      }\n      return null;\n   }\n}\n```\n\n有了工厂类，再画图的时候刚才的`Client.java`就可以改一改了：\n\nClient.java\n\n```\n//画矩形时:\nShape r = ShapeFactory.getShape(\"RECTANGLE\");\nr.draw();\n//画圆形时:\nShape c = ShapeFactory.getShape(\"CIRCLE\");\nc.draw();\n//画三角形时:\nShape t = ShapeFactory.getShape(\"TRIANGLE\");\nt.draw();\n```\n\n此时如果增加一个Star的图形类型，也可以从容应对了，从使用者`Client`的角度，无需关心对象是如何创建的。 各个类之间的关系如下：\n![关系类图](https://raw.githubusercontent.com/xzyup/image/master/202203191517555.png)\n\n此外还有一个类似的例子，可自行查看源码：\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191518463.png)\n\n看到这里可能你会觉得，前后两个版本的`Client`并没有太大的不同，反而采用了工厂模式后更加复杂了。其实作为一种创建类模式，在任何需要生成复杂对象的地方，都可以使用工厂方法模式。有一点需要注意的地方就是**复杂对象适合使用工厂模式，而简单对象，特别是只需要通过 new 就可以完成创建的对象，无需使用工厂模式。如果使用工厂模式，就需要引入一个工厂类，会增加系统的复杂度。**\n\n此外，在具体使用时，也会有不同的调整，比如：\n\n1. `ShapeFactory`的`getShape(String)`方法也可以改为非`static`的，这样就需要首先构造一个实际的工厂对象来创建产品了；\n2. 工厂类、抽象产品和具体产品这三个角色有可能部分或全部合并，我们来看一个Java中经常用到的关于日期类型格式化的例子：\n\nDateTest.java\n\n```\nimport java.util.*;  \nimport java.text.*;  \npublic class DateTest  \n{  \n    public static void main(String[] args)  \n    {  \n        Locale local = Locale.FRENCH;  \n        Date date = new Date();  \n        String now = DateFormat.getTimeInstance(DateFormat.DEFAULT,local).format(date);  \n        System.out.println(now);  \n        try  \n        {  \n            date = DateFormat.getDateInstance(DateFormat.DEFAULT,local).parse(\"16 nov. 01\");  \n            System.out.println(date);  \n        }  \n        catch (ParseException e)  \n        {  \n            System.out.println(\"Parsing exception:\" + e);  \n        }  \n    }  \n}  \n```\n\n而我们知道DateFormat是个抽象类，`public final static DateFormat getDateInstance(...)`的静态方法，也使得它自身既是一个抽象产品角色，又是一个工厂类角色，完成具体产品角色的创建（比如`SimpleDateFormat`）。\n\n如果三个角色全部合并，其实就是一个类，增加了一个创建自身对象的方法。\n\n# 总结\n\n在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。\n\n**使用场景**： 1、日志记录器：记录可能记录到本地硬盘、系统事件、远程服务器等，用户可以选择记录日志到什么地方。 2、数据库访问，当用户不知道最后系统采用哪一类数据库，以及数据库可能有变化时。 3、设计一个连接服务器的框架，需要三个协议，\"POP3\"、\"IMAP\"、\"HTTP\"，可以把这三个作为产品类，共同实现一个接口。\n\n**优点**： 一个调用者想创建一个对象，只要提出要求就可以了；屏蔽产品的具体实现，调用者只关心产品的接口；一定程度上提高了扩展性。\n\n**缺点**：每次增加一个产品时，都需要增加一个具体类和对象实现工厂，使得系统中类的个数成倍增加，在一定程度上增加了系统的复杂度，同时也增加了系统具体类的依赖。可见，简单工厂模式对\"开-闭\"原则的支持还不够，因为如果有新的产品加入到系统中去，就需要修改工厂类，将必要的逻辑加入到工厂类中。\n","slug":"design-pattern/工厂模式","published":1,"date":"2022-04-20T12:41:20.952Z","updated":"2022-05-04T03:01:02.024Z","_id":"cl2qzfth7000z13no984541p3","comments":1,"layout":"post","photos":[],"link":"","content":"<p>工厂模式（Factory Pattern）是 Java 中最常用的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象很好的方式。具体来说，有简单工厂模式（simple factory）、工厂方法模式（factory method)和抽象工厂模式（abstract factory）等模式。 本篇先从简单工厂模式谈起。</p>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>请设想一个简单的需求，你在做一个画图软件，可以画矩形、三角形和圆形等，每一种图形都用一个类来管理：</p>\n<ul>\n<li><code>Rectangle</code></li>\n<li><code>Circle</code></li>\n<li><code>Triangle</code> 每个类都有各自的<code>draw()</code>方法，当需要画某种图形的时候就可以：</li>\n</ul>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 画矩形时：</span><br><span class=\"line\">Rectangle r = new Rectangle();</span><br><span class=\"line\">r.draw();</span><br><span class=\"line\">// 画圆形时：</span><br><span class=\"line\">Circle c = new Circle();</span><br><span class=\"line\">c.draw();</span><br><span class=\"line\">// 画三角形时：</span><br><span class=\"line\">Triangle t = new Triangle();</span><br><span class=\"line\">t.draw();</span><br></pre></td></tr></table></figure>\n\n<p>如果这时增加一个<code>Star</code>类型的图形，就得需要增加一个<code>new Star()</code>来获取对象，这显然是不符合开闭原则。所谓开闭原则，即对扩展开放，对修改关闭。</p>\n<p>要想实现开闭原则，就需要考虑把创建对象的过程统一起来，并且能够满足扩展图形类型的需要。我们自然而然地就能想到这些图形都是有共同点可以抽象的，它们都实现了<code>draw()</code>方法，因此可以增加一个共同的接口，即“针对接口编程，依赖于抽象而不依赖于具体”，这就是“依赖倒转”的原则。</p>\n<p>Shape.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface Shape &#123;</span><br><span class=\"line\">   void draw();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Rectangle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Rectangle implements Shape &#123;</span><br><span class=\"line\">   @Override</span><br><span class=\"line\">   public void draw() &#123;</span><br><span class=\"line\">      System.out.println(&quot;Draw a rectangle.&quot;);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Triangle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Triangle implements Shape &#123;</span><br><span class=\"line\">   @Override</span><br><span class=\"line\">   public void draw() &#123;</span><br><span class=\"line\">      System.out.println(&quot;Draw a triangle.&quot;);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Circle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Circle implements Shape &#123;</span><br><span class=\"line\">   @Override</span><br><span class=\"line\">   public void draw() &#123;</span><br><span class=\"line\">      System.out.println(&quot;Draw a circle.&quot;);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后屏蔽掉具体类型的创建语句，那么就可以一定程度上做到“开闭原则”了。这时就需要工厂类登场了，它有一个用来返回具体产品对象的方法，注意这个方法是静态（static）的，也因此简单工厂模式有时候也被叫做“静态工厂模式”。</p>\n<p>ShapeFactory.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ShapeFactory &#123;</span><br><span class=\"line\">   //使用 getShape 方法获取形状类型的对象</span><br><span class=\"line\">   public static Shape getShape(String shapeType)&#123;</span><br><span class=\"line\">      if(shapeType == null)&#123;</span><br><span class=\"line\">         return null;</span><br><span class=\"line\">      &#125;        </span><br><span class=\"line\">      if(shapeType.equalsIgnoreCase(&quot;CIRCLE&quot;))&#123;</span><br><span class=\"line\">         return new Circle();</span><br><span class=\"line\">      &#125; else if(shapeType.equalsIgnoreCase(&quot;RECTANGLE&quot;))&#123;</span><br><span class=\"line\">         return new Rectangle();</span><br><span class=\"line\">      &#125; else if(shapeType.equalsIgnoreCase(&quot;TRIANGLE&quot;))&#123;</span><br><span class=\"line\">         return new Triangle();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      return null;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>有了工厂类，再画图的时候刚才的<code>Client.java</code>就可以改一改了：</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//画矩形时:</span><br><span class=\"line\">Shape r = ShapeFactory.getShape(&quot;RECTANGLE&quot;);</span><br><span class=\"line\">r.draw();</span><br><span class=\"line\">//画圆形时:</span><br><span class=\"line\">Shape c = ShapeFactory.getShape(&quot;CIRCLE&quot;);</span><br><span class=\"line\">c.draw();</span><br><span class=\"line\">//画三角形时:</span><br><span class=\"line\">Shape t = ShapeFactory.getShape(&quot;TRIANGLE&quot;);</span><br><span class=\"line\">t.draw();</span><br></pre></td></tr></table></figure>\n\n<p>此时如果增加一个Star的图形类型，也可以从容应对了，从使用者<code>Client</code>的角度，无需关心对象是如何创建的。 各个类之间的关系如下：<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191517555.png\" alt=\"关系类图\"></p>\n<p>此外还有一个类似的例子，可自行查看源码：<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191518463.png\"></p>\n<p>看到这里可能你会觉得，前后两个版本的<code>Client</code>并没有太大的不同，反而采用了工厂模式后更加复杂了。其实作为一种创建类模式，在任何需要生成复杂对象的地方，都可以使用工厂方法模式。有一点需要注意的地方就是<strong>复杂对象适合使用工厂模式，而简单对象，特别是只需要通过 new 就可以完成创建的对象，无需使用工厂模式。如果使用工厂模式，就需要引入一个工厂类，会增加系统的复杂度。</strong></p>\n<p>此外，在具体使用时，也会有不同的调整，比如：</p>\n<ol>\n<li><code>ShapeFactory</code>的<code>getShape(String)</code>方法也可以改为非<code>static</code>的，这样就需要首先构造一个实际的工厂对象来创建产品了；</li>\n<li>工厂类、抽象产品和具体产品这三个角色有可能部分或全部合并，我们来看一个Java中经常用到的关于日期类型格式化的例子：</li>\n</ol>\n<p>DateTest.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import java.util.*;  </span><br><span class=\"line\">import java.text.*;  </span><br><span class=\"line\">public class DateTest  </span><br><span class=\"line\">&#123;  </span><br><span class=\"line\">    public static void main(String[] args)  </span><br><span class=\"line\">    &#123;  </span><br><span class=\"line\">        Locale local = Locale.FRENCH;  </span><br><span class=\"line\">        Date date = new Date();  </span><br><span class=\"line\">        String now = DateFormat.getTimeInstance(DateFormat.DEFAULT,local).format(date);  </span><br><span class=\"line\">        System.out.println(now);  </span><br><span class=\"line\">        try  </span><br><span class=\"line\">        &#123;  </span><br><span class=\"line\">            date = DateFormat.getDateInstance(DateFormat.DEFAULT,local).parse(&quot;16 nov. 01&quot;);  </span><br><span class=\"line\">            System.out.println(date);  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">        catch (ParseException e)  </span><br><span class=\"line\">        &#123;  </span><br><span class=\"line\">            System.out.println(&quot;Parsing exception:&quot; + e);  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br></pre></td></tr></table></figure>\n\n<p>而我们知道DateFormat是个抽象类，<code>public final static DateFormat getDateInstance(...)</code>的静态方法，也使得它自身既是一个抽象产品角色，又是一个工厂类角色，完成具体产品角色的创建（比如<code>SimpleDateFormat</code>）。</p>\n<p>如果三个角色全部合并，其实就是一个类，增加了一个创建自身对象的方法。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。</p>\n<p><strong>使用场景</strong>： 1、日志记录器：记录可能记录到本地硬盘、系统事件、远程服务器等，用户可以选择记录日志到什么地方。 2、数据库访问，当用户不知道最后系统采用哪一类数据库，以及数据库可能有变化时。 3、设计一个连接服务器的框架，需要三个协议，”POP3”、”IMAP”、”HTTP”，可以把这三个作为产品类，共同实现一个接口。</p>\n<p><strong>优点</strong>： 一个调用者想创建一个对象，只要提出要求就可以了；屏蔽产品的具体实现，调用者只关心产品的接口；一定程度上提高了扩展性。</p>\n<p><strong>缺点</strong>：每次增加一个产品时，都需要增加一个具体类和对象实现工厂，使得系统中类的个数成倍增加，在一定程度上增加了系统的复杂度，同时也增加了系统具体类的依赖。可见，简单工厂模式对”开-闭”原则的支持还不够，因为如果有新的产品加入到系统中去，就需要修改工厂类，将必要的逻辑加入到工厂类中。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>工厂模式（Factory Pattern）是 Java 中最常用的设计模式之一。这种类型的设计模式属于创建型模式，它提供了一种创建对象很好的方式。具体来说，有简单工厂模式（simple factory）、工厂方法模式（factory method)和抽象工厂模式（abstract factory）等模式。 本篇先从简单工厂模式谈起。</p>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>请设想一个简单的需求，你在做一个画图软件，可以画矩形、三角形和圆形等，每一种图形都用一个类来管理：</p>\n<ul>\n<li><code>Rectangle</code></li>\n<li><code>Circle</code></li>\n<li><code>Triangle</code> 每个类都有各自的<code>draw()</code>方法，当需要画某种图形的时候就可以：</li>\n</ul>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 画矩形时：</span><br><span class=\"line\">Rectangle r = new Rectangle();</span><br><span class=\"line\">r.draw();</span><br><span class=\"line\">// 画圆形时：</span><br><span class=\"line\">Circle c = new Circle();</span><br><span class=\"line\">c.draw();</span><br><span class=\"line\">// 画三角形时：</span><br><span class=\"line\">Triangle t = new Triangle();</span><br><span class=\"line\">t.draw();</span><br></pre></td></tr></table></figure>\n\n<p>如果这时增加一个<code>Star</code>类型的图形，就得需要增加一个<code>new Star()</code>来获取对象，这显然是不符合开闭原则。所谓开闭原则，即对扩展开放，对修改关闭。</p>\n<p>要想实现开闭原则，就需要考虑把创建对象的过程统一起来，并且能够满足扩展图形类型的需要。我们自然而然地就能想到这些图形都是有共同点可以抽象的，它们都实现了<code>draw()</code>方法，因此可以增加一个共同的接口，即“针对接口编程，依赖于抽象而不依赖于具体”，这就是“依赖倒转”的原则。</p>\n<p>Shape.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface Shape &#123;</span><br><span class=\"line\">   void draw();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Rectangle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Rectangle implements Shape &#123;</span><br><span class=\"line\">   @Override</span><br><span class=\"line\">   public void draw() &#123;</span><br><span class=\"line\">      System.out.println(&quot;Draw a rectangle.&quot;);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Triangle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Triangle implements Shape &#123;</span><br><span class=\"line\">   @Override</span><br><span class=\"line\">   public void draw() &#123;</span><br><span class=\"line\">      System.out.println(&quot;Draw a triangle.&quot;);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Circle.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Circle implements Shape &#123;</span><br><span class=\"line\">   @Override</span><br><span class=\"line\">   public void draw() &#123;</span><br><span class=\"line\">      System.out.println(&quot;Draw a circle.&quot;);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后屏蔽掉具体类型的创建语句，那么就可以一定程度上做到“开闭原则”了。这时就需要工厂类登场了，它有一个用来返回具体产品对象的方法，注意这个方法是静态（static）的，也因此简单工厂模式有时候也被叫做“静态工厂模式”。</p>\n<p>ShapeFactory.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ShapeFactory &#123;</span><br><span class=\"line\">   //使用 getShape 方法获取形状类型的对象</span><br><span class=\"line\">   public static Shape getShape(String shapeType)&#123;</span><br><span class=\"line\">      if(shapeType == null)&#123;</span><br><span class=\"line\">         return null;</span><br><span class=\"line\">      &#125;        </span><br><span class=\"line\">      if(shapeType.equalsIgnoreCase(&quot;CIRCLE&quot;))&#123;</span><br><span class=\"line\">         return new Circle();</span><br><span class=\"line\">      &#125; else if(shapeType.equalsIgnoreCase(&quot;RECTANGLE&quot;))&#123;</span><br><span class=\"line\">         return new Rectangle();</span><br><span class=\"line\">      &#125; else if(shapeType.equalsIgnoreCase(&quot;TRIANGLE&quot;))&#123;</span><br><span class=\"line\">         return new Triangle();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      return null;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>有了工厂类，再画图的时候刚才的<code>Client.java</code>就可以改一改了：</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//画矩形时:</span><br><span class=\"line\">Shape r = ShapeFactory.getShape(&quot;RECTANGLE&quot;);</span><br><span class=\"line\">r.draw();</span><br><span class=\"line\">//画圆形时:</span><br><span class=\"line\">Shape c = ShapeFactory.getShape(&quot;CIRCLE&quot;);</span><br><span class=\"line\">c.draw();</span><br><span class=\"line\">//画三角形时:</span><br><span class=\"line\">Shape t = ShapeFactory.getShape(&quot;TRIANGLE&quot;);</span><br><span class=\"line\">t.draw();</span><br></pre></td></tr></table></figure>\n\n<p>此时如果增加一个Star的图形类型，也可以从容应对了，从使用者<code>Client</code>的角度，无需关心对象是如何创建的。 各个类之间的关系如下：<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191517555.png\" alt=\"关系类图\"></p>\n<p>此外还有一个类似的例子，可自行查看源码：<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191518463.png\"></p>\n<p>看到这里可能你会觉得，前后两个版本的<code>Client</code>并没有太大的不同，反而采用了工厂模式后更加复杂了。其实作为一种创建类模式，在任何需要生成复杂对象的地方，都可以使用工厂方法模式。有一点需要注意的地方就是<strong>复杂对象适合使用工厂模式，而简单对象，特别是只需要通过 new 就可以完成创建的对象，无需使用工厂模式。如果使用工厂模式，就需要引入一个工厂类，会增加系统的复杂度。</strong></p>\n<p>此外，在具体使用时，也会有不同的调整，比如：</p>\n<ol>\n<li><code>ShapeFactory</code>的<code>getShape(String)</code>方法也可以改为非<code>static</code>的，这样就需要首先构造一个实际的工厂对象来创建产品了；</li>\n<li>工厂类、抽象产品和具体产品这三个角色有可能部分或全部合并，我们来看一个Java中经常用到的关于日期类型格式化的例子：</li>\n</ol>\n<p>DateTest.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import java.util.*;  </span><br><span class=\"line\">import java.text.*;  </span><br><span class=\"line\">public class DateTest  </span><br><span class=\"line\">&#123;  </span><br><span class=\"line\">    public static void main(String[] args)  </span><br><span class=\"line\">    &#123;  </span><br><span class=\"line\">        Locale local = Locale.FRENCH;  </span><br><span class=\"line\">        Date date = new Date();  </span><br><span class=\"line\">        String now = DateFormat.getTimeInstance(DateFormat.DEFAULT,local).format(date);  </span><br><span class=\"line\">        System.out.println(now);  </span><br><span class=\"line\">        try  </span><br><span class=\"line\">        &#123;  </span><br><span class=\"line\">            date = DateFormat.getDateInstance(DateFormat.DEFAULT,local).parse(&quot;16 nov. 01&quot;);  </span><br><span class=\"line\">            System.out.println(date);  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">        catch (ParseException e)  </span><br><span class=\"line\">        &#123;  </span><br><span class=\"line\">            System.out.println(&quot;Parsing exception:&quot; + e);  </span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br></pre></td></tr></table></figure>\n\n<p>而我们知道DateFormat是个抽象类，<code>public final static DateFormat getDateInstance(...)</code>的静态方法，也使得它自身既是一个抽象产品角色，又是一个工厂类角色，完成具体产品角色的创建（比如<code>SimpleDateFormat</code>）。</p>\n<p>如果三个角色全部合并，其实就是一个类，增加了一个创建自身对象的方法。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>在工厂模式中，我们在创建对象时不会对客户端暴露创建逻辑，并且是通过使用一个共同的接口来指向新创建的对象。</p>\n<p><strong>使用场景</strong>： 1、日志记录器：记录可能记录到本地硬盘、系统事件、远程服务器等，用户可以选择记录日志到什么地方。 2、数据库访问，当用户不知道最后系统采用哪一类数据库，以及数据库可能有变化时。 3、设计一个连接服务器的框架，需要三个协议，”POP3”、”IMAP”、”HTTP”，可以把这三个作为产品类，共同实现一个接口。</p>\n<p><strong>优点</strong>： 一个调用者想创建一个对象，只要提出要求就可以了；屏蔽产品的具体实现，调用者只关心产品的接口；一定程度上提高了扩展性。</p>\n<p><strong>缺点</strong>：每次增加一个产品时，都需要增加一个具体类和对象实现工厂，使得系统中类的个数成倍增加，在一定程度上增加了系统的复杂度，同时也增加了系统具体类的依赖。可见，简单工厂模式对”开-闭”原则的支持还不够，因为如果有新的产品加入到系统中去，就需要修改工厂类，将必要的逻辑加入到工厂类中。</p>\n"},{"uuid":"bbaef9f0-c0ab-11ec-92a1-7557b2313227","title":"模板方法","abbrlink":"e60e2110","_content":"\n在模板方法模式（Template Method Pattern）中，一个抽象类公开定义了执行它的方法的方式/模板。它的子类可以按需要重写方法实现，但调用将以抽象类中定义的方式进行。这种类型的设计模式属于行为型模式。\n\n关于模板，大家生活中都有体会：\n\n- 我们总感觉新闻联播里的新闻有些固定的“套路”，比如`______在____的陪同下，不远万里，来到_____家中，为_____带来了节日的祝福和良好的祝愿，并饶有兴致的观看了_____。____握着___的手激动的说_______`。\n- 我们学生期间填了各种表格，写了不少报告，比如实验报告：`1、实验目的和要求；2、实验设备（环境）及要求；3、实验步骤；4、实验结果；5、讨论和分析`。\n\n这样的例子能举出好多来，这就是模板，里边的空或步骤是我们具体要去补充的地方。为什么要搞这些模板出来呢？**规范**，为了希望大家都按照一定的规范约束来实现。这也是我们在类关系的设计中，采用这种设计模式的初衷。\n\n# 例子\n\n下边这个例子是通过学生或老师的自我介绍来演示模板方法模式的应用。\n\n无论老师还是学生，在做自我介绍时通常都有自我基本情况介绍、获得过什么奖励、求学/教学经历等方面的内容，可以认为是一个模板。我们的例子中，自我介绍包含两部分，基本情况介绍和表决心（哈哈），如下：\n\nSchoolPerson.java\n\n~~~java\npublic abstract class SchoolPerson {\n    protected String name;\n    protected int age;\n    protected String schoolName;\n    protected String hometown;\n\n    public SchoolPerson(String name, int age, String schoolName, String hometown) {\n        this.name = name;\n        this.age = age;\n        this.schoolName = schoolName;\n        this.hometown = hometown;\n    }\n\n    public void selfIntroduction() {\n        myBasicInfo();\n        myslogan();\n    }\n\n    public abstract void myBasicInfo();\n\n    public abstract void mySlogan();\n}\n~~~\n\n我们看到，这个模板如果作为填空题的话，“空”就在`myBasicInfo`和`mySlogan`两个方法上。这两个方法是抽象的，要求子类去实现。\n\nStudent.java\n\n~~~java\npublic class Student extends SchoolPerson {\n    public Student(String name, int age, String schoolName, String hometown) {\n        super(name, age, schoolName, hometown);\n    }\n\n    public void myBasicInfo() {\n        System.out.println(\"我是一名学生，名叫\" + this.name + \"， 今年\" + this.age + \"岁， \" + this.hometown + \"人， 在\" + this.schoolName + \"上学。\");\n    }\n\n    public void mySlogan() {\n        System.out.println(\"在我在\" + this.schoolName + \"求学的过程中，我一定 好好学习，天天向上！\");\n    }\n}\n~~~\n\nTeacher.java\n\n~~~java\npublic class Teacher extends SchoolPerson {\n\n    public Teacher(String name, int age, String schoolName, String hometown) {\n        super(name, age, schoolName, hometown);\n    }\n\n    public void myBasicInfo() {\n        System.out.println(\"我是一名教师，名叫\" + this.name + \"， 今年\" + this.age + \"岁， \" + this.hometown + \"人， 在\" + this.schoolName + \"教书。\");\n    }\n\n    public void mySlogan() {\n        System.out.println(\"在我在\" + this.schoolName + \"教学的过程中，我一定 为人师表，诲人不倦！\");\n    }\n}\n~~~\n\n学生和老师对两个模板方法都有不同的实现。我们看一下执行效果：\n\nClient.java\n\n~~~java\npublic class Client {\n    public static void main(String[] args) {\n        SchoolPerson student = new Student(\"张三\", 12, \"光明小学\", \"山东济南\");\n        student.selfIntroduction();\n\n        SchoolPerson teacher = new Teacher(\"李四\", 32, \"光明小学\", \"山东青岛\");\n        teacher.selfIntroduction();\n    }\n}\n~~~\n\n输出为：\n\n~~~\n我是一名学生，名叫张三， 今年12岁， 山东济南人， 在光明小学上学。\n在我在光明小学求学的过程中，我一定 好好学习，天天向上！\n我是一名教师，名叫李四， 今年32岁， 山东青岛人， 在光明小学教书。\n在我在光明小学教学的过程中，我一定 为人师表，诲人不倦！\n~~~\n\n# 总结\n\n看这个例子，你可能会感觉，这就是继承嘛，有啥新鲜的？的确，虽然我们以前一直说类的组合（或说委托）优先于类的继承来使用。但是模板方法模式是为数不多的为我们示范关于继承的使用方式的设计模式。\n\n模板方法模式的特点很好总结，它将一般性的可复用的行为由基类固化，而把特殊化的行为交由具体的子类来实现。具体来说：\n\n1. 子类通常不关心全局（比如整个流程、提纲、步骤），而只负责”填空“；”填空“通过实现或重写父类的方法来实现。\n2. 从父类角度，全局性的规范约束掌握在自己手中，具体来说通过模板方法来约束，从而能够尽量简化子类的复杂度。父类并不一定是抽象类，模板方法也并不一定是抽象方法。\n\n再简单介绍一个实际的例子。我们知道，Servlet有特定的规范，以便Servlet的容器（比如tomcat）和Servlet的实现（我们开发的JavaEE应用）能够很好的合作。\n\n其中`javax.servlet.http.HttpServlet`就是Servlet规范在Http协议方面的”践行者“。`HttpServlet`也是一种`Servlet`，因此也必须有`service`方法来提供服务。但是Http有其具体的服务分类（GET、POST、PUT等不同的请求方法），我们看一下`HttpServlet.service`方法的实现：\n\nHttpServlet.java\n\n~~~java\nprotected void service(HttpServletRequest req, HttpServletResponse resp)\n    throws ServletException, IOException\n{\n    String method = req.getMethod();\n\n    if (method.equals(METHOD_GET)) {\n        ...\n        doGet(req, resp);\n        ...\n\n    } else if (method.equals(METHOD_HEAD)) {\n        ...\n        doHead(req, resp);\n\n    } else if (method.equals(METHOD_POST)) {\n        doPost(req, resp);\n        \n    } else if (method.equals(METHOD_PUT)) {\n        doPut(req, resp);\n        \n    } else if (method.equals(METHOD_DELETE)) {\n        doDelete(req, resp);\n        \n    } else if (method.equals(METHOD_OPTIONS)) {\n        doOptions(req,resp);\n        \n    } else if (method.equals(METHOD_TRACE)) {\n        doTrace(req,resp);\n        \n    } else {\n        ...\n    }\n}\n~~~\n\n简单起见，用省略号代替了一些代码，可以看到，service接到请求后，会先判断请求方法的类型，如果是GET请求就交给doGet去实现，如果是POST请求就交给doPost去实现。\n\n对于一个具体的servlet（`ConcreteHttpServlet`）来说，只需要继承`HttpServlet`并重写具体的方法就可以了。比如某个Servlet是用来处理GET请求的，那么只重写`doGet`方法填写处理逻辑就OK了。其它的处理不用care。\n\n不过现在由于Spring等Web框架的出现，我们不需要一个一个servlet去写JavaWeb程序，而是由比如Spring的`DispatcherServlet`这样的统一的Servlet入口来处理了，它直接映射了”/\"这样的请求URL，从而托管了所有的请求。但是既然是JavaEE框架，还是要遵循Servlet规范的，`DispatcherServlet`的父类`FrameworkServlet`就对`doGet`、`doPost`等模板方法进行了重写，以满足规范的要求。\n","source":"_posts/design-pattern/模板方法.md","raw":"---\nuuid: bbaef9f0-c0ab-11ec-92a1-7557b2313227\ntitle: 模板方法\ntags: 设计模式\ncategories: Java\nabbrlink: e60e2110\n---\n\n在模板方法模式（Template Method Pattern）中，一个抽象类公开定义了执行它的方法的方式/模板。它的子类可以按需要重写方法实现，但调用将以抽象类中定义的方式进行。这种类型的设计模式属于行为型模式。\n\n关于模板，大家生活中都有体会：\n\n- 我们总感觉新闻联播里的新闻有些固定的“套路”，比如`______在____的陪同下，不远万里，来到_____家中，为_____带来了节日的祝福和良好的祝愿，并饶有兴致的观看了_____。____握着___的手激动的说_______`。\n- 我们学生期间填了各种表格，写了不少报告，比如实验报告：`1、实验目的和要求；2、实验设备（环境）及要求；3、实验步骤；4、实验结果；5、讨论和分析`。\n\n这样的例子能举出好多来，这就是模板，里边的空或步骤是我们具体要去补充的地方。为什么要搞这些模板出来呢？**规范**，为了希望大家都按照一定的规范约束来实现。这也是我们在类关系的设计中，采用这种设计模式的初衷。\n\n# 例子\n\n下边这个例子是通过学生或老师的自我介绍来演示模板方法模式的应用。\n\n无论老师还是学生，在做自我介绍时通常都有自我基本情况介绍、获得过什么奖励、求学/教学经历等方面的内容，可以认为是一个模板。我们的例子中，自我介绍包含两部分，基本情况介绍和表决心（哈哈），如下：\n\nSchoolPerson.java\n\n~~~java\npublic abstract class SchoolPerson {\n    protected String name;\n    protected int age;\n    protected String schoolName;\n    protected String hometown;\n\n    public SchoolPerson(String name, int age, String schoolName, String hometown) {\n        this.name = name;\n        this.age = age;\n        this.schoolName = schoolName;\n        this.hometown = hometown;\n    }\n\n    public void selfIntroduction() {\n        myBasicInfo();\n        myslogan();\n    }\n\n    public abstract void myBasicInfo();\n\n    public abstract void mySlogan();\n}\n~~~\n\n我们看到，这个模板如果作为填空题的话，“空”就在`myBasicInfo`和`mySlogan`两个方法上。这两个方法是抽象的，要求子类去实现。\n\nStudent.java\n\n~~~java\npublic class Student extends SchoolPerson {\n    public Student(String name, int age, String schoolName, String hometown) {\n        super(name, age, schoolName, hometown);\n    }\n\n    public void myBasicInfo() {\n        System.out.println(\"我是一名学生，名叫\" + this.name + \"， 今年\" + this.age + \"岁， \" + this.hometown + \"人， 在\" + this.schoolName + \"上学。\");\n    }\n\n    public void mySlogan() {\n        System.out.println(\"在我在\" + this.schoolName + \"求学的过程中，我一定 好好学习，天天向上！\");\n    }\n}\n~~~\n\nTeacher.java\n\n~~~java\npublic class Teacher extends SchoolPerson {\n\n    public Teacher(String name, int age, String schoolName, String hometown) {\n        super(name, age, schoolName, hometown);\n    }\n\n    public void myBasicInfo() {\n        System.out.println(\"我是一名教师，名叫\" + this.name + \"， 今年\" + this.age + \"岁， \" + this.hometown + \"人， 在\" + this.schoolName + \"教书。\");\n    }\n\n    public void mySlogan() {\n        System.out.println(\"在我在\" + this.schoolName + \"教学的过程中，我一定 为人师表，诲人不倦！\");\n    }\n}\n~~~\n\n学生和老师对两个模板方法都有不同的实现。我们看一下执行效果：\n\nClient.java\n\n~~~java\npublic class Client {\n    public static void main(String[] args) {\n        SchoolPerson student = new Student(\"张三\", 12, \"光明小学\", \"山东济南\");\n        student.selfIntroduction();\n\n        SchoolPerson teacher = new Teacher(\"李四\", 32, \"光明小学\", \"山东青岛\");\n        teacher.selfIntroduction();\n    }\n}\n~~~\n\n输出为：\n\n~~~\n我是一名学生，名叫张三， 今年12岁， 山东济南人， 在光明小学上学。\n在我在光明小学求学的过程中，我一定 好好学习，天天向上！\n我是一名教师，名叫李四， 今年32岁， 山东青岛人， 在光明小学教书。\n在我在光明小学教学的过程中，我一定 为人师表，诲人不倦！\n~~~\n\n# 总结\n\n看这个例子，你可能会感觉，这就是继承嘛，有啥新鲜的？的确，虽然我们以前一直说类的组合（或说委托）优先于类的继承来使用。但是模板方法模式是为数不多的为我们示范关于继承的使用方式的设计模式。\n\n模板方法模式的特点很好总结，它将一般性的可复用的行为由基类固化，而把特殊化的行为交由具体的子类来实现。具体来说：\n\n1. 子类通常不关心全局（比如整个流程、提纲、步骤），而只负责”填空“；”填空“通过实现或重写父类的方法来实现。\n2. 从父类角度，全局性的规范约束掌握在自己手中，具体来说通过模板方法来约束，从而能够尽量简化子类的复杂度。父类并不一定是抽象类，模板方法也并不一定是抽象方法。\n\n再简单介绍一个实际的例子。我们知道，Servlet有特定的规范，以便Servlet的容器（比如tomcat）和Servlet的实现（我们开发的JavaEE应用）能够很好的合作。\n\n其中`javax.servlet.http.HttpServlet`就是Servlet规范在Http协议方面的”践行者“。`HttpServlet`也是一种`Servlet`，因此也必须有`service`方法来提供服务。但是Http有其具体的服务分类（GET、POST、PUT等不同的请求方法），我们看一下`HttpServlet.service`方法的实现：\n\nHttpServlet.java\n\n~~~java\nprotected void service(HttpServletRequest req, HttpServletResponse resp)\n    throws ServletException, IOException\n{\n    String method = req.getMethod();\n\n    if (method.equals(METHOD_GET)) {\n        ...\n        doGet(req, resp);\n        ...\n\n    } else if (method.equals(METHOD_HEAD)) {\n        ...\n        doHead(req, resp);\n\n    } else if (method.equals(METHOD_POST)) {\n        doPost(req, resp);\n        \n    } else if (method.equals(METHOD_PUT)) {\n        doPut(req, resp);\n        \n    } else if (method.equals(METHOD_DELETE)) {\n        doDelete(req, resp);\n        \n    } else if (method.equals(METHOD_OPTIONS)) {\n        doOptions(req,resp);\n        \n    } else if (method.equals(METHOD_TRACE)) {\n        doTrace(req,resp);\n        \n    } else {\n        ...\n    }\n}\n~~~\n\n简单起见，用省略号代替了一些代码，可以看到，service接到请求后，会先判断请求方法的类型，如果是GET请求就交给doGet去实现，如果是POST请求就交给doPost去实现。\n\n对于一个具体的servlet（`ConcreteHttpServlet`）来说，只需要继承`HttpServlet`并重写具体的方法就可以了。比如某个Servlet是用来处理GET请求的，那么只重写`doGet`方法填写处理逻辑就OK了。其它的处理不用care。\n\n不过现在由于Spring等Web框架的出现，我们不需要一个一个servlet去写JavaWeb程序，而是由比如Spring的`DispatcherServlet`这样的统一的Servlet入口来处理了，它直接映射了”/\"这样的请求URL，从而托管了所有的请求。但是既然是JavaEE框架，还是要遵循Servlet规范的，`DispatcherServlet`的父类`FrameworkServlet`就对`doGet`、`doPost`等模板方法进行了重写，以满足规范的要求。\n","slug":"design-pattern/模板方法","published":1,"date":"2022-04-20T12:41:20.954Z","updated":"2022-05-04T03:01:11.474Z","_id":"cl2qzfth8001113no89dz1vwj","comments":1,"layout":"post","photos":[],"link":"","content":"<p>在模板方法模式（Template Method Pattern）中，一个抽象类公开定义了执行它的方法的方式/模板。它的子类可以按需要重写方法实现，但调用将以抽象类中定义的方式进行。这种类型的设计模式属于行为型模式。</p>\n<p>关于模板，大家生活中都有体会：</p>\n<ul>\n<li>我们总感觉新闻联播里的新闻有些固定的“套路”，比如<code>______在____的陪同下，不远万里，来到_____家中，为_____带来了节日的祝福和良好的祝愿，并饶有兴致的观看了_____。____握着___的手激动的说_______</code>。</li>\n<li>我们学生期间填了各种表格，写了不少报告，比如实验报告：<code>1、实验目的和要求；2、实验设备（环境）及要求；3、实验步骤；4、实验结果；5、讨论和分析</code>。</li>\n</ul>\n<p>这样的例子能举出好多来，这就是模板，里边的空或步骤是我们具体要去补充的地方。为什么要搞这些模板出来呢？<strong>规范</strong>，为了希望大家都按照一定的规范约束来实现。这也是我们在类关系的设计中，采用这种设计模式的初衷。</p>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>下边这个例子是通过学生或老师的自我介绍来演示模板方法模式的应用。</p>\n<p>无论老师还是学生，在做自我介绍时通常都有自我基本情况介绍、获得过什么奖励、求学/教学经历等方面的内容，可以认为是一个模板。我们的例子中，自我介绍包含两部分，基本情况介绍和表决心（哈哈），如下：</p>\n<p>SchoolPerson.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SchoolPerson</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> String schoolName;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> String hometown;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">SchoolPerson</span><span class=\"params\">(String name, <span class=\"type\">int</span> age, String schoolName, String hometown)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schoolName = schoolName;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.hometown = hometown;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">selfIntroduction</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        myBasicInfo();</span><br><span class=\"line\">        myslogan();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title function_\">myBasicInfo</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title function_\">mySlogan</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们看到，这个模板如果作为填空题的话，“空”就在<code>myBasicInfo</code>和<code>mySlogan</code>两个方法上。这两个方法是抽象的，要求子类去实现。</p>\n<p>Student.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Student</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">SchoolPerson</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Student</span><span class=\"params\">(String name, <span class=\"type\">int</span> age, String schoolName, String hometown)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(name, age, schoolName, hometown);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">myBasicInfo</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;我是一名学生，名叫&quot;</span> + <span class=\"built_in\">this</span>.name + <span class=\"string\">&quot;， 今年&quot;</span> + <span class=\"built_in\">this</span>.age + <span class=\"string\">&quot;岁， &quot;</span> + <span class=\"built_in\">this</span>.hometown + <span class=\"string\">&quot;人， 在&quot;</span> + <span class=\"built_in\">this</span>.schoolName + <span class=\"string\">&quot;上学。&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">mySlogan</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;在我在&quot;</span> + <span class=\"built_in\">this</span>.schoolName + <span class=\"string\">&quot;求学的过程中，我一定 好好学习，天天向上！&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Teacher.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Teacher</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">SchoolPerson</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Teacher</span><span class=\"params\">(String name, <span class=\"type\">int</span> age, String schoolName, String hometown)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(name, age, schoolName, hometown);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">myBasicInfo</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;我是一名教师，名叫&quot;</span> + <span class=\"built_in\">this</span>.name + <span class=\"string\">&quot;， 今年&quot;</span> + <span class=\"built_in\">this</span>.age + <span class=\"string\">&quot;岁， &quot;</span> + <span class=\"built_in\">this</span>.hometown + <span class=\"string\">&quot;人， 在&quot;</span> + <span class=\"built_in\">this</span>.schoolName + <span class=\"string\">&quot;教书。&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">mySlogan</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;在我在&quot;</span> + <span class=\"built_in\">this</span>.schoolName + <span class=\"string\">&quot;教学的过程中，我一定 为人师表，诲人不倦！&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>学生和老师对两个模板方法都有不同的实现。我们看一下执行效果：</p>\n<p>Client.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Client</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">SchoolPerson</span> <span class=\"variable\">student</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Student</span>(<span class=\"string\">&quot;张三&quot;</span>, <span class=\"number\">12</span>, <span class=\"string\">&quot;光明小学&quot;</span>, <span class=\"string\">&quot;山东济南&quot;</span>);</span><br><span class=\"line\">        student.selfIntroduction();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">SchoolPerson</span> <span class=\"variable\">teacher</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Teacher</span>(<span class=\"string\">&quot;李四&quot;</span>, <span class=\"number\">32</span>, <span class=\"string\">&quot;光明小学&quot;</span>, <span class=\"string\">&quot;山东青岛&quot;</span>);</span><br><span class=\"line\">        teacher.selfIntroduction();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">我是一名学生，名叫张三， 今年12岁， 山东济南人， 在光明小学上学。</span><br><span class=\"line\">在我在光明小学求学的过程中，我一定 好好学习，天天向上！</span><br><span class=\"line\">我是一名教师，名叫李四， 今年32岁， 山东青岛人， 在光明小学教书。</span><br><span class=\"line\">在我在光明小学教学的过程中，我一定 为人师表，诲人不倦！</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>看这个例子，你可能会感觉，这就是继承嘛，有啥新鲜的？的确，虽然我们以前一直说类的组合（或说委托）优先于类的继承来使用。但是模板方法模式是为数不多的为我们示范关于继承的使用方式的设计模式。</p>\n<p>模板方法模式的特点很好总结，它将一般性的可复用的行为由基类固化，而把特殊化的行为交由具体的子类来实现。具体来说：</p>\n<ol>\n<li>子类通常不关心全局（比如整个流程、提纲、步骤），而只负责”填空“；”填空“通过实现或重写父类的方法来实现。</li>\n<li>从父类角度，全局性的规范约束掌握在自己手中，具体来说通过模板方法来约束，从而能够尽量简化子类的复杂度。父类并不一定是抽象类，模板方法也并不一定是抽象方法。</li>\n</ol>\n<p>再简单介绍一个实际的例子。我们知道，Servlet有特定的规范，以便Servlet的容器（比如tomcat）和Servlet的实现（我们开发的JavaEE应用）能够很好的合作。</p>\n<p>其中<code>javax.servlet.http.HttpServlet</code>就是Servlet规范在Http协议方面的”践行者“。<code>HttpServlet</code>也是一种<code>Servlet</code>，因此也必须有<code>service</code>方法来提供服务。但是Http有其具体的服务分类（GET、POST、PUT等不同的请求方法），我们看一下<code>HttpServlet.service</code>方法的实现：</p>\n<p>HttpServlet.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">service</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class=\"line\">    <span class=\"keyword\">throws</span> ServletException, IOException</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> req.getMethod();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (method.equals(METHOD_GET)) &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        doGet(req, resp);</span><br><span class=\"line\">        ...</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_HEAD)) &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        doHead(req, resp);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_POST)) &#123;</span><br><span class=\"line\">        doPost(req, resp);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_PUT)) &#123;</span><br><span class=\"line\">        doPut(req, resp);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_DELETE)) &#123;</span><br><span class=\"line\">        doDelete(req, resp);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_OPTIONS)) &#123;</span><br><span class=\"line\">        doOptions(req,resp);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_TRACE)) &#123;</span><br><span class=\"line\">        doTrace(req,resp);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>简单起见，用省略号代替了一些代码，可以看到，service接到请求后，会先判断请求方法的类型，如果是GET请求就交给doGet去实现，如果是POST请求就交给doPost去实现。</p>\n<p>对于一个具体的servlet（<code>ConcreteHttpServlet</code>）来说，只需要继承<code>HttpServlet</code>并重写具体的方法就可以了。比如某个Servlet是用来处理GET请求的，那么只重写<code>doGet</code>方法填写处理逻辑就OK了。其它的处理不用care。</p>\n<p>不过现在由于Spring等Web框架的出现，我们不需要一个一个servlet去写JavaWeb程序，而是由比如Spring的<code>DispatcherServlet</code>这样的统一的Servlet入口来处理了，它直接映射了”/“这样的请求URL，从而托管了所有的请求。但是既然是JavaEE框架，还是要遵循Servlet规范的，<code>DispatcherServlet</code>的父类<code>FrameworkServlet</code>就对<code>doGet</code>、<code>doPost</code>等模板方法进行了重写，以满足规范的要求。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>在模板方法模式（Template Method Pattern）中，一个抽象类公开定义了执行它的方法的方式/模板。它的子类可以按需要重写方法实现，但调用将以抽象类中定义的方式进行。这种类型的设计模式属于行为型模式。</p>\n<p>关于模板，大家生活中都有体会：</p>\n<ul>\n<li>我们总感觉新闻联播里的新闻有些固定的“套路”，比如<code>______在____的陪同下，不远万里，来到_____家中，为_____带来了节日的祝福和良好的祝愿，并饶有兴致的观看了_____。____握着___的手激动的说_______</code>。</li>\n<li>我们学生期间填了各种表格，写了不少报告，比如实验报告：<code>1、实验目的和要求；2、实验设备（环境）及要求；3、实验步骤；4、实验结果；5、讨论和分析</code>。</li>\n</ul>\n<p>这样的例子能举出好多来，这就是模板，里边的空或步骤是我们具体要去补充的地方。为什么要搞这些模板出来呢？<strong>规范</strong>，为了希望大家都按照一定的规范约束来实现。这也是我们在类关系的设计中，采用这种设计模式的初衷。</p>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>下边这个例子是通过学生或老师的自我介绍来演示模板方法模式的应用。</p>\n<p>无论老师还是学生，在做自我介绍时通常都有自我基本情况介绍、获得过什么奖励、求学/教学经历等方面的内容，可以认为是一个模板。我们的例子中，自我介绍包含两部分，基本情况介绍和表决心（哈哈），如下：</p>\n<p>SchoolPerson.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SchoolPerson</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"type\">int</span> age;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> String schoolName;</span><br><span class=\"line\">    <span class=\"keyword\">protected</span> String hometown;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">SchoolPerson</span><span class=\"params\">(String name, <span class=\"type\">int</span> age, String schoolName, String hometown)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.age = age;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.schoolName = schoolName;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.hometown = hometown;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">selfIntroduction</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        myBasicInfo();</span><br><span class=\"line\">        myslogan();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title function_\">myBasicInfo</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">void</span> <span class=\"title function_\">mySlogan</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们看到，这个模板如果作为填空题的话，“空”就在<code>myBasicInfo</code>和<code>mySlogan</code>两个方法上。这两个方法是抽象的，要求子类去实现。</p>\n<p>Student.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Student</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">SchoolPerson</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Student</span><span class=\"params\">(String name, <span class=\"type\">int</span> age, String schoolName, String hometown)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(name, age, schoolName, hometown);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">myBasicInfo</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;我是一名学生，名叫&quot;</span> + <span class=\"built_in\">this</span>.name + <span class=\"string\">&quot;， 今年&quot;</span> + <span class=\"built_in\">this</span>.age + <span class=\"string\">&quot;岁， &quot;</span> + <span class=\"built_in\">this</span>.hometown + <span class=\"string\">&quot;人， 在&quot;</span> + <span class=\"built_in\">this</span>.schoolName + <span class=\"string\">&quot;上学。&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">mySlogan</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;在我在&quot;</span> + <span class=\"built_in\">this</span>.schoolName + <span class=\"string\">&quot;求学的过程中，我一定 好好学习，天天向上！&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Teacher.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Teacher</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">SchoolPerson</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Teacher</span><span class=\"params\">(String name, <span class=\"type\">int</span> age, String schoolName, String hometown)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>(name, age, schoolName, hometown);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">myBasicInfo</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;我是一名教师，名叫&quot;</span> + <span class=\"built_in\">this</span>.name + <span class=\"string\">&quot;， 今年&quot;</span> + <span class=\"built_in\">this</span>.age + <span class=\"string\">&quot;岁， &quot;</span> + <span class=\"built_in\">this</span>.hometown + <span class=\"string\">&quot;人， 在&quot;</span> + <span class=\"built_in\">this</span>.schoolName + <span class=\"string\">&quot;教书。&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">mySlogan</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;在我在&quot;</span> + <span class=\"built_in\">this</span>.schoolName + <span class=\"string\">&quot;教学的过程中，我一定 为人师表，诲人不倦！&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>学生和老师对两个模板方法都有不同的实现。我们看一下执行效果：</p>\n<p>Client.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Client</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">SchoolPerson</span> <span class=\"variable\">student</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Student</span>(<span class=\"string\">&quot;张三&quot;</span>, <span class=\"number\">12</span>, <span class=\"string\">&quot;光明小学&quot;</span>, <span class=\"string\">&quot;山东济南&quot;</span>);</span><br><span class=\"line\">        student.selfIntroduction();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">SchoolPerson</span> <span class=\"variable\">teacher</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Teacher</span>(<span class=\"string\">&quot;李四&quot;</span>, <span class=\"number\">32</span>, <span class=\"string\">&quot;光明小学&quot;</span>, <span class=\"string\">&quot;山东青岛&quot;</span>);</span><br><span class=\"line\">        teacher.selfIntroduction();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">我是一名学生，名叫张三， 今年12岁， 山东济南人， 在光明小学上学。</span><br><span class=\"line\">在我在光明小学求学的过程中，我一定 好好学习，天天向上！</span><br><span class=\"line\">我是一名教师，名叫李四， 今年32岁， 山东青岛人， 在光明小学教书。</span><br><span class=\"line\">在我在光明小学教学的过程中，我一定 为人师表，诲人不倦！</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>看这个例子，你可能会感觉，这就是继承嘛，有啥新鲜的？的确，虽然我们以前一直说类的组合（或说委托）优先于类的继承来使用。但是模板方法模式是为数不多的为我们示范关于继承的使用方式的设计模式。</p>\n<p>模板方法模式的特点很好总结，它将一般性的可复用的行为由基类固化，而把特殊化的行为交由具体的子类来实现。具体来说：</p>\n<ol>\n<li>子类通常不关心全局（比如整个流程、提纲、步骤），而只负责”填空“；”填空“通过实现或重写父类的方法来实现。</li>\n<li>从父类角度，全局性的规范约束掌握在自己手中，具体来说通过模板方法来约束，从而能够尽量简化子类的复杂度。父类并不一定是抽象类，模板方法也并不一定是抽象方法。</li>\n</ol>\n<p>再简单介绍一个实际的例子。我们知道，Servlet有特定的规范，以便Servlet的容器（比如tomcat）和Servlet的实现（我们开发的JavaEE应用）能够很好的合作。</p>\n<p>其中<code>javax.servlet.http.HttpServlet</code>就是Servlet规范在Http协议方面的”践行者“。<code>HttpServlet</code>也是一种<code>Servlet</code>，因此也必须有<code>service</code>方法来提供服务。但是Http有其具体的服务分类（GET、POST、PUT等不同的请求方法），我们看一下<code>HttpServlet.service</code>方法的实现：</p>\n<p>HttpServlet.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">service</span><span class=\"params\">(HttpServletRequest req, HttpServletResponse resp)</span></span><br><span class=\"line\">    <span class=\"keyword\">throws</span> ServletException, IOException</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">method</span> <span class=\"operator\">=</span> req.getMethod();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (method.equals(METHOD_GET)) &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        doGet(req, resp);</span><br><span class=\"line\">        ...</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_HEAD)) &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">        doHead(req, resp);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_POST)) &#123;</span><br><span class=\"line\">        doPost(req, resp);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_PUT)) &#123;</span><br><span class=\"line\">        doPut(req, resp);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_DELETE)) &#123;</span><br><span class=\"line\">        doDelete(req, resp);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_OPTIONS)) &#123;</span><br><span class=\"line\">        doOptions(req,resp);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method.equals(METHOD_TRACE)) &#123;</span><br><span class=\"line\">        doTrace(req,resp);</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>简单起见，用省略号代替了一些代码，可以看到，service接到请求后，会先判断请求方法的类型，如果是GET请求就交给doGet去实现，如果是POST请求就交给doPost去实现。</p>\n<p>对于一个具体的servlet（<code>ConcreteHttpServlet</code>）来说，只需要继承<code>HttpServlet</code>并重写具体的方法就可以了。比如某个Servlet是用来处理GET请求的，那么只重写<code>doGet</code>方法填写处理逻辑就OK了。其它的处理不用care。</p>\n<p>不过现在由于Spring等Web框架的出现，我们不需要一个一个servlet去写JavaWeb程序，而是由比如Spring的<code>DispatcherServlet</code>这样的统一的Servlet入口来处理了，它直接映射了”/“这样的请求URL，从而托管了所有的请求。但是既然是JavaEE框架，还是要遵循Servlet规范的，<code>DispatcherServlet</code>的父类<code>FrameworkServlet</code>就对<code>doGet</code>、<code>doPost</code>等模板方法进行了重写，以满足规范的要求。</p>\n"},{"uuid":"bbaef9f1-c0ab-11ec-92a1-7557b2313227","title":"状态模式","abbrlink":"8acb1976","_content":"\n在状态模式（State Pattern）中，类的行为是基于它的状态改变的。这种类型的设计模式属于行为型模式。\n\n我们程序猿在码代码的时候由于不同的工作状态，可能写出质量不一的代码，并我们不是AI嘛。\n\n- 早上上班的时候，休息了一夜，精力旺盛，程序猿能够高效码代码，bug也不多；\n- 当熬夜加班的时候，运转了一天的大脑无比疲惫，写出的代码常有bug出没；\n- 当然，我们也都非常期待在码代码的时候能够达到“天人合一”之境界（虽然这种状态通常出现在玩游戏时），没有烦人的会议、没有别人的打扰，虽然没有程序猿鼓励妹子在侧，却能几分钟写出通常需要几个小时才能写出的逻辑，解决近几天都未解决的问题，可谓“码神附体”！\n\n# 例子\n\n如果上述情况用代码来表述的话，我们来设计一下。\n\n**程序猿还是同一个人，但是同一个任务在不同的状态下，可能会达到不同的效果。**\n\n注意上边这句话，有两个“同一个”和两个”不同的“。\n\n人和任务是相同的，是不变的部分；状态和效果是不同的，是变的部分。按照设计模式的套路，不变的和变化的是要分开来的，从而满足”开闭“原则，有利于扩展。\n\n不变的是人（类`Developer`）和任务（方法`Developer.develop()`），变化的状态（类`XxxState`）作为`Developer`的成员变量能够随时切换看来就可以解决这个问题。\n\n由于状态是变化的，因此需要不同的类`XxxState`来描述，其方法`XxxState.develop()`正好可以灵活实现不同状态下的工作效果。\n\n完美！最后还有一个，按照设计模式的通常套路，同一类变化的类要抽象为接口或抽象类，并提供统一的接口方法，从而做到”面向接口“编程，以应对变化。\n\n设计完毕，那就开工：\n\nDeveloper.java\n\n```\npublic class Developer {\n    private State state;\n\n    public Developer(State state) {\n        this.state = state;\n    }\n\n    public void setState(State state) {\n        this.state = state;\n    }\n\n    public void develop() {\n        state.coding();\n    }\n}\n```\n\n`Developer`维护有`State`的引用，并提供`setState(State)`方法切换状态。\n\nState.java\n\n```\npublic interface State {\n    void coding();\n}\n```\n\nEffectiveState.java\n\n```\npublic class EffectiveState implements State {\n    public void coding() {\n        System.out.println(\"高效码代码，偶有bug，人非圣贤嘛～\");\n    }\n}\n```\n\nExhaustedState.java\n\n```\npublic class ExhaustedState implements State {\n    public void coding() {\n        System.out.println(\"加班熬夜码代码，专业写bug\");\n    }\n}\n```\n\nTianRenHeYiState.java\n\n```\npublic class TianRenHeYiState implements State {\n    public void coding() {\n        System.out.println(\"写代码进入天人合一境界，仿佛三头六臂，码神附体\");\n    }\n}\n```\n\n![状态模式](https://raw.githubusercontent.com/xzyup/image/master/202203191519836.png)\n\n不同的状态有不同的实现效果，通过`State`抽象出统一的接口。\n\n测试一下：\n\nClient.java\n\n```\npublic class Client {\n    public static void main(String[] args) {\n        Developer developer = new Developer(new EffectiveState());\n        developer.develop();\n        developer.setState(new ExhaustedState());\n        developer.develop();\n        developer.setState(new TianRenHeYiState());\n        developer.develop();\n    }\n}\n```\n\n使用`Developer`的`setState`方法切换不同的状态，从而实现不同的操作：\n\n```\n高效码代码，偶有bug，人非圣贤嘛～\n加班熬夜码代码，专业写bug\n写代码进入天人合一境界，仿佛三头六臂，码神附体\n```\n\n# 总结\n\n这就是状态模式，将不同的状态包装为不同的类，供其本体引用，从而实现灵活的状态切换。\n\n看到这里其实感觉状态模式和策略模式很像，状态模式是将不同的状态对象作为成员变量给使用者（也称”环境“），策略模式是将不同的策略对象作为成员变量给使用者（也称”环境“）。其实二者还是有些使用上的区别的：\n\n- 策略模式中，作为成员变量的策略对象通常不会经常变化；而状态模式在使用者（也称”环境“）的整个生命周期中会不断变化。\n- 策略模式中，通常并不明确告诉客户端所选择的具体策略；而状态模式中，所处的状态是明确告知客户端的；\n- 通常策略模式的使用者自己选择一个具体策略；而状态模式的使用者（也称”环境“）通常是被动使用某种状态。\n\n**使用场景**\n\n- 一个对象的行为依赖于它所处的状态，对象的行为必须随着其状态的改变而改变；\n- 对象在某个方法里依赖一重或多重的条件转移语句，而且其中有大量代码的时候。\n\n**注意事项**\n\n- 状态模式并未规定哪个角色来进行状态切换，上边的例子是由使用者（也称”环境“）的`setState`方法来切换状态，而有些情况下是由”状态“对象本身来切换到下一个状态。\n- 使用者（也称”环境“）也可以把自己作为参数传递给状态对象，从而状态对象也可以调用使用者的方法。\n","source":"_posts/design-pattern/状态模式.md","raw":"---\nuuid: bbaef9f1-c0ab-11ec-92a1-7557b2313227\ntitle: 状态模式\ntags: 设计模式\ncategories: Java\nabbrlink: 8acb1976\n---\n\n在状态模式（State Pattern）中，类的行为是基于它的状态改变的。这种类型的设计模式属于行为型模式。\n\n我们程序猿在码代码的时候由于不同的工作状态，可能写出质量不一的代码，并我们不是AI嘛。\n\n- 早上上班的时候，休息了一夜，精力旺盛，程序猿能够高效码代码，bug也不多；\n- 当熬夜加班的时候，运转了一天的大脑无比疲惫，写出的代码常有bug出没；\n- 当然，我们也都非常期待在码代码的时候能够达到“天人合一”之境界（虽然这种状态通常出现在玩游戏时），没有烦人的会议、没有别人的打扰，虽然没有程序猿鼓励妹子在侧，却能几分钟写出通常需要几个小时才能写出的逻辑，解决近几天都未解决的问题，可谓“码神附体”！\n\n# 例子\n\n如果上述情况用代码来表述的话，我们来设计一下。\n\n**程序猿还是同一个人，但是同一个任务在不同的状态下，可能会达到不同的效果。**\n\n注意上边这句话，有两个“同一个”和两个”不同的“。\n\n人和任务是相同的，是不变的部分；状态和效果是不同的，是变的部分。按照设计模式的套路，不变的和变化的是要分开来的，从而满足”开闭“原则，有利于扩展。\n\n不变的是人（类`Developer`）和任务（方法`Developer.develop()`），变化的状态（类`XxxState`）作为`Developer`的成员变量能够随时切换看来就可以解决这个问题。\n\n由于状态是变化的，因此需要不同的类`XxxState`来描述，其方法`XxxState.develop()`正好可以灵活实现不同状态下的工作效果。\n\n完美！最后还有一个，按照设计模式的通常套路，同一类变化的类要抽象为接口或抽象类，并提供统一的接口方法，从而做到”面向接口“编程，以应对变化。\n\n设计完毕，那就开工：\n\nDeveloper.java\n\n```\npublic class Developer {\n    private State state;\n\n    public Developer(State state) {\n        this.state = state;\n    }\n\n    public void setState(State state) {\n        this.state = state;\n    }\n\n    public void develop() {\n        state.coding();\n    }\n}\n```\n\n`Developer`维护有`State`的引用，并提供`setState(State)`方法切换状态。\n\nState.java\n\n```\npublic interface State {\n    void coding();\n}\n```\n\nEffectiveState.java\n\n```\npublic class EffectiveState implements State {\n    public void coding() {\n        System.out.println(\"高效码代码，偶有bug，人非圣贤嘛～\");\n    }\n}\n```\n\nExhaustedState.java\n\n```\npublic class ExhaustedState implements State {\n    public void coding() {\n        System.out.println(\"加班熬夜码代码，专业写bug\");\n    }\n}\n```\n\nTianRenHeYiState.java\n\n```\npublic class TianRenHeYiState implements State {\n    public void coding() {\n        System.out.println(\"写代码进入天人合一境界，仿佛三头六臂，码神附体\");\n    }\n}\n```\n\n![状态模式](https://raw.githubusercontent.com/xzyup/image/master/202203191519836.png)\n\n不同的状态有不同的实现效果，通过`State`抽象出统一的接口。\n\n测试一下：\n\nClient.java\n\n```\npublic class Client {\n    public static void main(String[] args) {\n        Developer developer = new Developer(new EffectiveState());\n        developer.develop();\n        developer.setState(new ExhaustedState());\n        developer.develop();\n        developer.setState(new TianRenHeYiState());\n        developer.develop();\n    }\n}\n```\n\n使用`Developer`的`setState`方法切换不同的状态，从而实现不同的操作：\n\n```\n高效码代码，偶有bug，人非圣贤嘛～\n加班熬夜码代码，专业写bug\n写代码进入天人合一境界，仿佛三头六臂，码神附体\n```\n\n# 总结\n\n这就是状态模式，将不同的状态包装为不同的类，供其本体引用，从而实现灵活的状态切换。\n\n看到这里其实感觉状态模式和策略模式很像，状态模式是将不同的状态对象作为成员变量给使用者（也称”环境“），策略模式是将不同的策略对象作为成员变量给使用者（也称”环境“）。其实二者还是有些使用上的区别的：\n\n- 策略模式中，作为成员变量的策略对象通常不会经常变化；而状态模式在使用者（也称”环境“）的整个生命周期中会不断变化。\n- 策略模式中，通常并不明确告诉客户端所选择的具体策略；而状态模式中，所处的状态是明确告知客户端的；\n- 通常策略模式的使用者自己选择一个具体策略；而状态模式的使用者（也称”环境“）通常是被动使用某种状态。\n\n**使用场景**\n\n- 一个对象的行为依赖于它所处的状态，对象的行为必须随着其状态的改变而改变；\n- 对象在某个方法里依赖一重或多重的条件转移语句，而且其中有大量代码的时候。\n\n**注意事项**\n\n- 状态模式并未规定哪个角色来进行状态切换，上边的例子是由使用者（也称”环境“）的`setState`方法来切换状态，而有些情况下是由”状态“对象本身来切换到下一个状态。\n- 使用者（也称”环境“）也可以把自己作为参数传递给状态对象，从而状态对象也可以调用使用者的方法。\n","slug":"design-pattern/状态模式","published":1,"date":"2022-04-20T12:41:20.956Z","updated":"2022-05-04T03:01:34.083Z","_id":"cl2qzfth9001513noe9gb1q6x","comments":1,"layout":"post","photos":[],"link":"","content":"<p>在状态模式（State Pattern）中，类的行为是基于它的状态改变的。这种类型的设计模式属于行为型模式。</p>\n<p>我们程序猿在码代码的时候由于不同的工作状态，可能写出质量不一的代码，并我们不是AI嘛。</p>\n<ul>\n<li>早上上班的时候，休息了一夜，精力旺盛，程序猿能够高效码代码，bug也不多；</li>\n<li>当熬夜加班的时候，运转了一天的大脑无比疲惫，写出的代码常有bug出没；</li>\n<li>当然，我们也都非常期待在码代码的时候能够达到“天人合一”之境界（虽然这种状态通常出现在玩游戏时），没有烦人的会议、没有别人的打扰，虽然没有程序猿鼓励妹子在侧，却能几分钟写出通常需要几个小时才能写出的逻辑，解决近几天都未解决的问题，可谓“码神附体”！</li>\n</ul>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>如果上述情况用代码来表述的话，我们来设计一下。</p>\n<p><strong>程序猿还是同一个人，但是同一个任务在不同的状态下，可能会达到不同的效果。</strong></p>\n<p>注意上边这句话，有两个“同一个”和两个”不同的“。</p>\n<p>人和任务是相同的，是不变的部分；状态和效果是不同的，是变的部分。按照设计模式的套路，不变的和变化的是要分开来的，从而满足”开闭“原则，有利于扩展。</p>\n<p>不变的是人（类<code>Developer</code>）和任务（方法<code>Developer.develop()</code>），变化的状态（类<code>XxxState</code>）作为<code>Developer</code>的成员变量能够随时切换看来就可以解决这个问题。</p>\n<p>由于状态是变化的，因此需要不同的类<code>XxxState</code>来描述，其方法<code>XxxState.develop()</code>正好可以灵活实现不同状态下的工作效果。</p>\n<p>完美！最后还有一个，按照设计模式的通常套路，同一类变化的类要抽象为接口或抽象类，并提供统一的接口方法，从而做到”面向接口“编程，以应对变化。</p>\n<p>设计完毕，那就开工：</p>\n<p>Developer.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Developer &#123;</span><br><span class=\"line\">    private State state;</span><br><span class=\"line\"></span><br><span class=\"line\">    public Developer(State state) &#123;</span><br><span class=\"line\">        this.state = state;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setState(State state) &#123;</span><br><span class=\"line\">        this.state = state;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void develop() &#123;</span><br><span class=\"line\">        state.coding();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Developer</code>维护有<code>State</code>的引用，并提供<code>setState(State)</code>方法切换状态。</p>\n<p>State.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface State &#123;</span><br><span class=\"line\">    void coding();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>EffectiveState.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class EffectiveState implements State &#123;</span><br><span class=\"line\">    public void coding() &#123;</span><br><span class=\"line\">        System.out.println(&quot;高效码代码，偶有bug，人非圣贤嘛～&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ExhaustedState.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ExhaustedState implements State &#123;</span><br><span class=\"line\">    public void coding() &#123;</span><br><span class=\"line\">        System.out.println(&quot;加班熬夜码代码，专业写bug&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>TianRenHeYiState.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class TianRenHeYiState implements State &#123;</span><br><span class=\"line\">    public void coding() &#123;</span><br><span class=\"line\">        System.out.println(&quot;写代码进入天人合一境界，仿佛三头六臂，码神附体&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191519836.png\" alt=\"状态模式\"></p>\n<p>不同的状态有不同的实现效果，通过<code>State</code>抽象出统一的接口。</p>\n<p>测试一下：</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Client &#123;</span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        Developer developer = new Developer(new EffectiveState());</span><br><span class=\"line\">        developer.develop();</span><br><span class=\"line\">        developer.setState(new ExhaustedState());</span><br><span class=\"line\">        developer.develop();</span><br><span class=\"line\">        developer.setState(new TianRenHeYiState());</span><br><span class=\"line\">        developer.develop();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>Developer</code>的<code>setState</code>方法切换不同的状态，从而实现不同的操作：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">高效码代码，偶有bug，人非圣贤嘛～</span><br><span class=\"line\">加班熬夜码代码，专业写bug</span><br><span class=\"line\">写代码进入天人合一境界，仿佛三头六臂，码神附体</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>这就是状态模式，将不同的状态包装为不同的类，供其本体引用，从而实现灵活的状态切换。</p>\n<p>看到这里其实感觉状态模式和策略模式很像，状态模式是将不同的状态对象作为成员变量给使用者（也称”环境“），策略模式是将不同的策略对象作为成员变量给使用者（也称”环境“）。其实二者还是有些使用上的区别的：</p>\n<ul>\n<li>策略模式中，作为成员变量的策略对象通常不会经常变化；而状态模式在使用者（也称”环境“）的整个生命周期中会不断变化。</li>\n<li>策略模式中，通常并不明确告诉客户端所选择的具体策略；而状态模式中，所处的状态是明确告知客户端的；</li>\n<li>通常策略模式的使用者自己选择一个具体策略；而状态模式的使用者（也称”环境“）通常是被动使用某种状态。</li>\n</ul>\n<p><strong>使用场景</strong></p>\n<ul>\n<li>一个对象的行为依赖于它所处的状态，对象的行为必须随着其状态的改变而改变；</li>\n<li>对象在某个方法里依赖一重或多重的条件转移语句，而且其中有大量代码的时候。</li>\n</ul>\n<p><strong>注意事项</strong></p>\n<ul>\n<li>状态模式并未规定哪个角色来进行状态切换，上边的例子是由使用者（也称”环境“）的<code>setState</code>方法来切换状态，而有些情况下是由”状态“对象本身来切换到下一个状态。</li>\n<li>使用者（也称”环境“）也可以把自己作为参数传递给状态对象，从而状态对象也可以调用使用者的方法。</li>\n</ul>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>在状态模式（State Pattern）中，类的行为是基于它的状态改变的。这种类型的设计模式属于行为型模式。</p>\n<p>我们程序猿在码代码的时候由于不同的工作状态，可能写出质量不一的代码，并我们不是AI嘛。</p>\n<ul>\n<li>早上上班的时候，休息了一夜，精力旺盛，程序猿能够高效码代码，bug也不多；</li>\n<li>当熬夜加班的时候，运转了一天的大脑无比疲惫，写出的代码常有bug出没；</li>\n<li>当然，我们也都非常期待在码代码的时候能够达到“天人合一”之境界（虽然这种状态通常出现在玩游戏时），没有烦人的会议、没有别人的打扰，虽然没有程序猿鼓励妹子在侧，却能几分钟写出通常需要几个小时才能写出的逻辑，解决近几天都未解决的问题，可谓“码神附体”！</li>\n</ul>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>如果上述情况用代码来表述的话，我们来设计一下。</p>\n<p><strong>程序猿还是同一个人，但是同一个任务在不同的状态下，可能会达到不同的效果。</strong></p>\n<p>注意上边这句话，有两个“同一个”和两个”不同的“。</p>\n<p>人和任务是相同的，是不变的部分；状态和效果是不同的，是变的部分。按照设计模式的套路，不变的和变化的是要分开来的，从而满足”开闭“原则，有利于扩展。</p>\n<p>不变的是人（类<code>Developer</code>）和任务（方法<code>Developer.develop()</code>），变化的状态（类<code>XxxState</code>）作为<code>Developer</code>的成员变量能够随时切换看来就可以解决这个问题。</p>\n<p>由于状态是变化的，因此需要不同的类<code>XxxState</code>来描述，其方法<code>XxxState.develop()</code>正好可以灵活实现不同状态下的工作效果。</p>\n<p>完美！最后还有一个，按照设计模式的通常套路，同一类变化的类要抽象为接口或抽象类，并提供统一的接口方法，从而做到”面向接口“编程，以应对变化。</p>\n<p>设计完毕，那就开工：</p>\n<p>Developer.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Developer &#123;</span><br><span class=\"line\">    private State state;</span><br><span class=\"line\"></span><br><span class=\"line\">    public Developer(State state) &#123;</span><br><span class=\"line\">        this.state = state;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void setState(State state) &#123;</span><br><span class=\"line\">        this.state = state;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void develop() &#123;</span><br><span class=\"line\">        state.coding();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>Developer</code>维护有<code>State</code>的引用，并提供<code>setState(State)</code>方法切换状态。</p>\n<p>State.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public interface State &#123;</span><br><span class=\"line\">    void coding();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>EffectiveState.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class EffectiveState implements State &#123;</span><br><span class=\"line\">    public void coding() &#123;</span><br><span class=\"line\">        System.out.println(&quot;高效码代码，偶有bug，人非圣贤嘛～&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>ExhaustedState.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class ExhaustedState implements State &#123;</span><br><span class=\"line\">    public void coding() &#123;</span><br><span class=\"line\">        System.out.println(&quot;加班熬夜码代码，专业写bug&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>TianRenHeYiState.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class TianRenHeYiState implements State &#123;</span><br><span class=\"line\">    public void coding() &#123;</span><br><span class=\"line\">        System.out.println(&quot;写代码进入天人合一境界，仿佛三头六臂，码神附体&quot;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191519836.png\" alt=\"状态模式\"></p>\n<p>不同的状态有不同的实现效果，通过<code>State</code>抽象出统一的接口。</p>\n<p>测试一下：</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Client &#123;</span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        Developer developer = new Developer(new EffectiveState());</span><br><span class=\"line\">        developer.develop();</span><br><span class=\"line\">        developer.setState(new ExhaustedState());</span><br><span class=\"line\">        developer.develop();</span><br><span class=\"line\">        developer.setState(new TianRenHeYiState());</span><br><span class=\"line\">        developer.develop();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>Developer</code>的<code>setState</code>方法切换不同的状态，从而实现不同的操作：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">高效码代码，偶有bug，人非圣贤嘛～</span><br><span class=\"line\">加班熬夜码代码，专业写bug</span><br><span class=\"line\">写代码进入天人合一境界，仿佛三头六臂，码神附体</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>这就是状态模式，将不同的状态包装为不同的类，供其本体引用，从而实现灵活的状态切换。</p>\n<p>看到这里其实感觉状态模式和策略模式很像，状态模式是将不同的状态对象作为成员变量给使用者（也称”环境“），策略模式是将不同的策略对象作为成员变量给使用者（也称”环境“）。其实二者还是有些使用上的区别的：</p>\n<ul>\n<li>策略模式中，作为成员变量的策略对象通常不会经常变化；而状态模式在使用者（也称”环境“）的整个生命周期中会不断变化。</li>\n<li>策略模式中，通常并不明确告诉客户端所选择的具体策略；而状态模式中，所处的状态是明确告知客户端的；</li>\n<li>通常策略模式的使用者自己选择一个具体策略；而状态模式的使用者（也称”环境“）通常是被动使用某种状态。</li>\n</ul>\n<p><strong>使用场景</strong></p>\n<ul>\n<li>一个对象的行为依赖于它所处的状态，对象的行为必须随着其状态的改变而改变；</li>\n<li>对象在某个方法里依赖一重或多重的条件转移语句，而且其中有大量代码的时候。</li>\n</ul>\n<p><strong>注意事项</strong></p>\n<ul>\n<li>状态模式并未规定哪个角色来进行状态切换，上边的例子是由使用者（也称”环境“）的<code>setState</code>方法来切换状态，而有些情况下是由”状态“对象本身来切换到下一个状态。</li>\n<li>使用者（也称”环境“）也可以把自己作为参数传递给状态对象，从而状态对象也可以调用使用者的方法。</li>\n</ul>\n"},{"uuid":"bbaed2ec-c0ab-11ec-92a1-7557b2313227","title":"单例模式","abbrlink":"f1601c3e","_content":"\n单例模式（Singleton Pattern）是Java中最简单的设计模式之一，但也是一个很值得玩味儿的设计模式，这是一个创建型的模式。\n\n单例模式的目的在于，对于一些类，需要保证其仅有一个实例。比如一个Web中的计数器，不用每次刷新在数据库里记录一次，可以用一个单例的对象先缓存起来。但是这个计数器不能有多个实例，否则岂不是不准了。\n\n具体来说，该设计模式有如下特点或要求：\n\n1. 单例类只能有一个实例。\n2. 单例类必须自己创建自己的唯一实例。\n3. 单例类必须给所有其他对象提供这一实例。\n\n# 例子\n\n## 饿汉式\n\n我们考虑一下上述的三个要求。\n\n首先，单例类只能有一个实例。我们知道，一个类的`static`的成员变量或方法可以看作归属于类本身的，可以被这个类所有的实例共享，可以认为是”独一份儿“的。所以用`static`关键字修饰这个类的对象，就可以做到。\n\n然后，单例类必须自己创建自己的唯一实例。那也好办，单例类自己定义一个类型为自己的成员变量，然后设置为`static`的就可以了。然后把构造方法设置为`private`的，这样就不能被其他类或对象`new`了。\n\n最后，单例类必须给所有其他对象提供这一实例。那就是提供一个get方法可以获取到这个类型为自己的成员变量。\n\n分析过后，先撸一版代码：\n\nSingleObject.java\n\n```\npublic class SingleObject {\n\n    private final static SingleObject INSTANCE = new SingleObject();\n\n    private SingleObject() {}\n\n    public static SingleObject getInstance() {\n        return instance;\n    }\n}\n```\n\n我们搞一个Client检验一下：\n\nClient.java\n\n```\npublic class Client {\n    public static void main(String[] args) {\n        System.out.println(SingleObject.getInstance());\n        System.out.println(SingleObject.getInstance());\n    }\n}\n```\n\n返回结果：\n\n```\ncom.getset.designpatterns.singleton.SingleObject@5e2de80c\ncom.getset.designpatterns.singleton.SingleObject@5e2de80c\n```\n\n根据对象的hash可以看出，两次调用`getInstance()`返回的是同一个对象。\n\n这种是比较常用的方式，叫做“饿汉式”，为啥叫这名自己体会哟～ 我们知道，类加载时，static的成员变量会初始化，所以一旦类加载，那么`INSTANCE`所指向的对象就被创建了。其实这就是个常亮了，所以可以用大写，然后`final`修饰。\n\n## 懒汉式\n\n在有些情况下，如果单例类本身比较消耗资源或加载缓慢，希望能够在使用的时候才创建实例，那么可以采用懒加载的方式，如下：\n\nLazySingleObject.java\n\n```\n// 本例是线程不安全的\npublic class LazySingleObject {\n    private static LazySingleObject instance;\n    private LazySingleObject() {}\n\n    public static LazySingleObject getInstance() {\n        if (instance == null) {\n            instance = new LazySingleObject();\n        }\n        return instance;\n    }\n}\n```\n\n如此，只有在调用`getInstance()`的时候才会创建实例。\n\n但是这种方式是线程不安全的，假设有两个线程同时调用了`getInstance()`，可能都会检测到`instance == null`。所以可以把`getInstance()`方法使用`synchronized`修饰，以便保证线程安全。\n\n但是在实际使用过程中，一旦实例被创建后，`getInstance()`方法只是返回实例，是不需要同步的，而加锁会影响效率，因此我们考虑不对整个方法加锁，而仅仅只对`new`实例的过程加锁，如下：\n\nLazySingleObject.java\n\n```\n// 双检锁/双重校验锁（DCL，即 double-checked locking）\npublic class LazySingleObject {\n    // 使用volatile修饰单例变量\n    private static volatile LazySingleObject instance;\n    private LazySingleObject() {}\n    public static LazySingleObject getInstance() {\n        // 第一次判断，此时是未加锁的\n        if (instance == null) {\n            synchronized (LazySingleObject.class) {\n                // 第二次判断，此时是线程安全的\n                if (instance == null) {\n                    instance = new LazySingleObject();\n                }\n            }\n        }\n        return instance;\n    }\n}\n```\n\n可见，只有在实例未创建（`instance == null`）的时候才同步创建实例对象。在`synchronized`代码库内部，再次检查实例是否创建，因为第一次检查并不是线程安全的。也因此，这种方式叫做“双检锁/双重校验锁”。这样，一旦实例创建之后，就不再进入同步代码块了，从而效率更高。\n\n要特别注意的是，单例变量`instance`要用`volatile`进行修饰。原因在于编译器出于优化需要会对内存的读写操作重排序，因此LazySingleObject对象初始化时的写操作与写入instance字段的操作可以是无序的。导致的结果就是如果某个线程调用getInstance()可能看到instance字段指向了一个LazySingleObject对象，但看到该对象里的字段值却是默认值，而不是在LazySingleObject构造方法里设置的那些值。而使用`volatile`字段修饰后，编译器和运行时都会注意到这是个共享变量，因此不会将该变量上的操作和其他内存操作一起重排序，真正保证线程安全。\n\n以上两种方式可根据场景选择。\n\n## 登记式/静态内部类\n\n如果感觉“双检锁/双重校验锁”这种方式复杂难学，可以采用静态内部类来实现线程安全的懒加载。\n\nLazyHandlerSingleObject.java\n\n```\npublic class LazyHandlerSingleObject {\n    private static class SingleObjectHandler {\n        private final static LazyHandlerSingleObject instance = new LazyHandlerSingleObject();\n    }\n    private static LazyHandlerSingleObject instance;\n\n    public static LazyHandlerSingleObject getInstance() {\n        return SingleObjectHandler.instance;\n    }\n}\n```\n\n我们知道，类在使用的时候才会被classloder加载，静态内部类`SingleObjectHandler`正是利用了这个特点，来懒加载其外部对象`LazyHandlerSingleObject`的实例。\n\n> 类嵌套一向是一种比较难以理解的概念，静态内部类是最简单的一种嵌套类，最好把他看作是普通的类，只是碰巧被声明在另一个类内部而已。唯一与普通类不同的是，静态内部类和其外部类可以互相访问所有成员，包括私有成员。\n\n当第一次调用`getInstance()`方法的时候，`SingleObjectHandler`才第一次被使用到，从而加载它，自然也就创建了`LazyHandlerSingleObject`的实例，`SingleObjectHandler`通过`static`保证这个实例是唯一的。\n\n## 枚举\n\n这种实现方式还没有被广泛采用，但这是实现单例模式的最佳方法。它更简洁，自动支持序列化机制，绝对防止多次实例化。\n\n这种方式是《Effective Java》作者 Josh Bloch 提倡的方式，它不仅能避免多线程同步问题，而且还自动支持序列化机制，防止反序列化重新创建新的对象，绝对防止多次实例化。推荐在需要使用单例的时候使用这种方式。\n\nEnumSingleton.java\n\n```\npublic enum EnumSingleton {\n    INSTANCE;\n    public void doSomething() {\n        ...\n    }\n}\n```\n\n就是这么简单！直接使用`EnumSingleton.INSTANCE`就可以了，比如`EnumSingleton.INSTANCE.doSomething()`。Enum类型类似于类，也可以有成员变量和成员方法。\n\n# 总结\n\n首先，请尝试使用枚举的方式来实现单例，枚举机制本身对单例有很好的支持。\n\n如果觉得枚举方式不熟悉，那么：\n\n通常，比较轻量的单例直接用饿汉式即可；\n\n重量级的单例对象，最好通过懒加载的方式构建，根据线程安全性的要求选择以上两种懒汉式的方式；当然静态内部类也是一种不错的懒加载方式。\n","source":"_posts/design-pattern/单例模式.md","raw":"---\nuuid: bbaed2ec-c0ab-11ec-92a1-7557b2313227\ntitle: 单例模式\ntags: 设计模式\ncategories: Java\nabbrlink: f1601c3e\n---\n\n单例模式（Singleton Pattern）是Java中最简单的设计模式之一，但也是一个很值得玩味儿的设计模式，这是一个创建型的模式。\n\n单例模式的目的在于，对于一些类，需要保证其仅有一个实例。比如一个Web中的计数器，不用每次刷新在数据库里记录一次，可以用一个单例的对象先缓存起来。但是这个计数器不能有多个实例，否则岂不是不准了。\n\n具体来说，该设计模式有如下特点或要求：\n\n1. 单例类只能有一个实例。\n2. 单例类必须自己创建自己的唯一实例。\n3. 单例类必须给所有其他对象提供这一实例。\n\n# 例子\n\n## 饿汉式\n\n我们考虑一下上述的三个要求。\n\n首先，单例类只能有一个实例。我们知道，一个类的`static`的成员变量或方法可以看作归属于类本身的，可以被这个类所有的实例共享，可以认为是”独一份儿“的。所以用`static`关键字修饰这个类的对象，就可以做到。\n\n然后，单例类必须自己创建自己的唯一实例。那也好办，单例类自己定义一个类型为自己的成员变量，然后设置为`static`的就可以了。然后把构造方法设置为`private`的，这样就不能被其他类或对象`new`了。\n\n最后，单例类必须给所有其他对象提供这一实例。那就是提供一个get方法可以获取到这个类型为自己的成员变量。\n\n分析过后，先撸一版代码：\n\nSingleObject.java\n\n```\npublic class SingleObject {\n\n    private final static SingleObject INSTANCE = new SingleObject();\n\n    private SingleObject() {}\n\n    public static SingleObject getInstance() {\n        return instance;\n    }\n}\n```\n\n我们搞一个Client检验一下：\n\nClient.java\n\n```\npublic class Client {\n    public static void main(String[] args) {\n        System.out.println(SingleObject.getInstance());\n        System.out.println(SingleObject.getInstance());\n    }\n}\n```\n\n返回结果：\n\n```\ncom.getset.designpatterns.singleton.SingleObject@5e2de80c\ncom.getset.designpatterns.singleton.SingleObject@5e2de80c\n```\n\n根据对象的hash可以看出，两次调用`getInstance()`返回的是同一个对象。\n\n这种是比较常用的方式，叫做“饿汉式”，为啥叫这名自己体会哟～ 我们知道，类加载时，static的成员变量会初始化，所以一旦类加载，那么`INSTANCE`所指向的对象就被创建了。其实这就是个常亮了，所以可以用大写，然后`final`修饰。\n\n## 懒汉式\n\n在有些情况下，如果单例类本身比较消耗资源或加载缓慢，希望能够在使用的时候才创建实例，那么可以采用懒加载的方式，如下：\n\nLazySingleObject.java\n\n```\n// 本例是线程不安全的\npublic class LazySingleObject {\n    private static LazySingleObject instance;\n    private LazySingleObject() {}\n\n    public static LazySingleObject getInstance() {\n        if (instance == null) {\n            instance = new LazySingleObject();\n        }\n        return instance;\n    }\n}\n```\n\n如此，只有在调用`getInstance()`的时候才会创建实例。\n\n但是这种方式是线程不安全的，假设有两个线程同时调用了`getInstance()`，可能都会检测到`instance == null`。所以可以把`getInstance()`方法使用`synchronized`修饰，以便保证线程安全。\n\n但是在实际使用过程中，一旦实例被创建后，`getInstance()`方法只是返回实例，是不需要同步的，而加锁会影响效率，因此我们考虑不对整个方法加锁，而仅仅只对`new`实例的过程加锁，如下：\n\nLazySingleObject.java\n\n```\n// 双检锁/双重校验锁（DCL，即 double-checked locking）\npublic class LazySingleObject {\n    // 使用volatile修饰单例变量\n    private static volatile LazySingleObject instance;\n    private LazySingleObject() {}\n    public static LazySingleObject getInstance() {\n        // 第一次判断，此时是未加锁的\n        if (instance == null) {\n            synchronized (LazySingleObject.class) {\n                // 第二次判断，此时是线程安全的\n                if (instance == null) {\n                    instance = new LazySingleObject();\n                }\n            }\n        }\n        return instance;\n    }\n}\n```\n\n可见，只有在实例未创建（`instance == null`）的时候才同步创建实例对象。在`synchronized`代码库内部，再次检查实例是否创建，因为第一次检查并不是线程安全的。也因此，这种方式叫做“双检锁/双重校验锁”。这样，一旦实例创建之后，就不再进入同步代码块了，从而效率更高。\n\n要特别注意的是，单例变量`instance`要用`volatile`进行修饰。原因在于编译器出于优化需要会对内存的读写操作重排序，因此LazySingleObject对象初始化时的写操作与写入instance字段的操作可以是无序的。导致的结果就是如果某个线程调用getInstance()可能看到instance字段指向了一个LazySingleObject对象，但看到该对象里的字段值却是默认值，而不是在LazySingleObject构造方法里设置的那些值。而使用`volatile`字段修饰后，编译器和运行时都会注意到这是个共享变量，因此不会将该变量上的操作和其他内存操作一起重排序，真正保证线程安全。\n\n以上两种方式可根据场景选择。\n\n## 登记式/静态内部类\n\n如果感觉“双检锁/双重校验锁”这种方式复杂难学，可以采用静态内部类来实现线程安全的懒加载。\n\nLazyHandlerSingleObject.java\n\n```\npublic class LazyHandlerSingleObject {\n    private static class SingleObjectHandler {\n        private final static LazyHandlerSingleObject instance = new LazyHandlerSingleObject();\n    }\n    private static LazyHandlerSingleObject instance;\n\n    public static LazyHandlerSingleObject getInstance() {\n        return SingleObjectHandler.instance;\n    }\n}\n```\n\n我们知道，类在使用的时候才会被classloder加载，静态内部类`SingleObjectHandler`正是利用了这个特点，来懒加载其外部对象`LazyHandlerSingleObject`的实例。\n\n> 类嵌套一向是一种比较难以理解的概念，静态内部类是最简单的一种嵌套类，最好把他看作是普通的类，只是碰巧被声明在另一个类内部而已。唯一与普通类不同的是，静态内部类和其外部类可以互相访问所有成员，包括私有成员。\n\n当第一次调用`getInstance()`方法的时候，`SingleObjectHandler`才第一次被使用到，从而加载它，自然也就创建了`LazyHandlerSingleObject`的实例，`SingleObjectHandler`通过`static`保证这个实例是唯一的。\n\n## 枚举\n\n这种实现方式还没有被广泛采用，但这是实现单例模式的最佳方法。它更简洁，自动支持序列化机制，绝对防止多次实例化。\n\n这种方式是《Effective Java》作者 Josh Bloch 提倡的方式，它不仅能避免多线程同步问题，而且还自动支持序列化机制，防止反序列化重新创建新的对象，绝对防止多次实例化。推荐在需要使用单例的时候使用这种方式。\n\nEnumSingleton.java\n\n```\npublic enum EnumSingleton {\n    INSTANCE;\n    public void doSomething() {\n        ...\n    }\n}\n```\n\n就是这么简单！直接使用`EnumSingleton.INSTANCE`就可以了，比如`EnumSingleton.INSTANCE.doSomething()`。Enum类型类似于类，也可以有成员变量和成员方法。\n\n# 总结\n\n首先，请尝试使用枚举的方式来实现单例，枚举机制本身对单例有很好的支持。\n\n如果觉得枚举方式不熟悉，那么：\n\n通常，比较轻量的单例直接用饿汉式即可；\n\n重量级的单例对象，最好通过懒加载的方式构建，根据线程安全性的要求选择以上两种懒汉式的方式；当然静态内部类也是一种不错的懒加载方式。\n","slug":"design-pattern/单例模式","published":1,"date":"2022-04-20T12:41:20.947Z","updated":"2022-05-04T03:00:38.673Z","_id":"cl2qzfth9001613no7ao2et1o","comments":1,"layout":"post","photos":[],"link":"","content":"<p>单例模式（Singleton Pattern）是Java中最简单的设计模式之一，但也是一个很值得玩味儿的设计模式，这是一个创建型的模式。</p>\n<p>单例模式的目的在于，对于一些类，需要保证其仅有一个实例。比如一个Web中的计数器，不用每次刷新在数据库里记录一次，可以用一个单例的对象先缓存起来。但是这个计数器不能有多个实例，否则岂不是不准了。</p>\n<p>具体来说，该设计模式有如下特点或要求：</p>\n<ol>\n<li>单例类只能有一个实例。</li>\n<li>单例类必须自己创建自己的唯一实例。</li>\n<li>单例类必须给所有其他对象提供这一实例。</li>\n</ol>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><h2 id=\"饿汉式\"><a href=\"#饿汉式\" class=\"headerlink\" title=\"饿汉式\"></a>饿汉式</h2><p>我们考虑一下上述的三个要求。</p>\n<p>首先，单例类只能有一个实例。我们知道，一个类的<code>static</code>的成员变量或方法可以看作归属于类本身的，可以被这个类所有的实例共享，可以认为是”独一份儿“的。所以用<code>static</code>关键字修饰这个类的对象，就可以做到。</p>\n<p>然后，单例类必须自己创建自己的唯一实例。那也好办，单例类自己定义一个类型为自己的成员变量，然后设置为<code>static</code>的就可以了。然后把构造方法设置为<code>private</code>的，这样就不能被其他类或对象<code>new</code>了。</p>\n<p>最后，单例类必须给所有其他对象提供这一实例。那就是提供一个get方法可以获取到这个类型为自己的成员变量。</p>\n<p>分析过后，先撸一版代码：</p>\n<p>SingleObject.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SingleObject &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    private final static SingleObject INSTANCE = new SingleObject();</span><br><span class=\"line\"></span><br><span class=\"line\">    private SingleObject() &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static SingleObject getInstance() &#123;</span><br><span class=\"line\">        return instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们搞一个Client检验一下：</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Client &#123;</span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        System.out.println(SingleObject.getInstance());</span><br><span class=\"line\">        System.out.println(SingleObject.getInstance());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>返回结果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">com.getset.designpatterns.singleton.SingleObject@5e2de80c</span><br><span class=\"line\">com.getset.designpatterns.singleton.SingleObject@5e2de80c</span><br></pre></td></tr></table></figure>\n\n<p>根据对象的hash可以看出，两次调用<code>getInstance()</code>返回的是同一个对象。</p>\n<p>这种是比较常用的方式，叫做“饿汉式”，为啥叫这名自己体会哟～ 我们知道，类加载时，static的成员变量会初始化，所以一旦类加载，那么<code>INSTANCE</code>所指向的对象就被创建了。其实这就是个常亮了，所以可以用大写，然后<code>final</code>修饰。</p>\n<h2 id=\"懒汉式\"><a href=\"#懒汉式\" class=\"headerlink\" title=\"懒汉式\"></a>懒汉式</h2><p>在有些情况下，如果单例类本身比较消耗资源或加载缓慢，希望能够在使用的时候才创建实例，那么可以采用懒加载的方式，如下：</p>\n<p>LazySingleObject.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 本例是线程不安全的</span><br><span class=\"line\">public class LazySingleObject &#123;</span><br><span class=\"line\">    private static LazySingleObject instance;</span><br><span class=\"line\">    private LazySingleObject() &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static LazySingleObject getInstance() &#123;</span><br><span class=\"line\">        if (instance == null) &#123;</span><br><span class=\"line\">            instance = new LazySingleObject();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如此，只有在调用<code>getInstance()</code>的时候才会创建实例。</p>\n<p>但是这种方式是线程不安全的，假设有两个线程同时调用了<code>getInstance()</code>，可能都会检测到<code>instance == null</code>。所以可以把<code>getInstance()</code>方法使用<code>synchronized</code>修饰，以便保证线程安全。</p>\n<p>但是在实际使用过程中，一旦实例被创建后，<code>getInstance()</code>方法只是返回实例，是不需要同步的，而加锁会影响效率，因此我们考虑不对整个方法加锁，而仅仅只对<code>new</code>实例的过程加锁，如下：</p>\n<p>LazySingleObject.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 双检锁/双重校验锁（DCL，即 double-checked locking）</span><br><span class=\"line\">public class LazySingleObject &#123;</span><br><span class=\"line\">    // 使用volatile修饰单例变量</span><br><span class=\"line\">    private static volatile LazySingleObject instance;</span><br><span class=\"line\">    private LazySingleObject() &#123;&#125;</span><br><span class=\"line\">    public static LazySingleObject getInstance() &#123;</span><br><span class=\"line\">        // 第一次判断，此时是未加锁的</span><br><span class=\"line\">        if (instance == null) &#123;</span><br><span class=\"line\">            synchronized (LazySingleObject.class) &#123;</span><br><span class=\"line\">                // 第二次判断，此时是线程安全的</span><br><span class=\"line\">                if (instance == null) &#123;</span><br><span class=\"line\">                    instance = new LazySingleObject();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可见，只有在实例未创建（<code>instance == null</code>）的时候才同步创建实例对象。在<code>synchronized</code>代码库内部，再次检查实例是否创建，因为第一次检查并不是线程安全的。也因此，这种方式叫做“双检锁/双重校验锁”。这样，一旦实例创建之后，就不再进入同步代码块了，从而效率更高。</p>\n<p>要特别注意的是，单例变量<code>instance</code>要用<code>volatile</code>进行修饰。原因在于编译器出于优化需要会对内存的读写操作重排序，因此LazySingleObject对象初始化时的写操作与写入instance字段的操作可以是无序的。导致的结果就是如果某个线程调用getInstance()可能看到instance字段指向了一个LazySingleObject对象，但看到该对象里的字段值却是默认值，而不是在LazySingleObject构造方法里设置的那些值。而使用<code>volatile</code>字段修饰后，编译器和运行时都会注意到这是个共享变量，因此不会将该变量上的操作和其他内存操作一起重排序，真正保证线程安全。</p>\n<p>以上两种方式可根据场景选择。</p>\n<h2 id=\"登记式-静态内部类\"><a href=\"#登记式-静态内部类\" class=\"headerlink\" title=\"登记式/静态内部类\"></a>登记式/静态内部类</h2><p>如果感觉“双检锁/双重校验锁”这种方式复杂难学，可以采用静态内部类来实现线程安全的懒加载。</p>\n<p>LazyHandlerSingleObject.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class LazyHandlerSingleObject &#123;</span><br><span class=\"line\">    private static class SingleObjectHandler &#123;</span><br><span class=\"line\">        private final static LazyHandlerSingleObject instance = new LazyHandlerSingleObject();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    private static LazyHandlerSingleObject instance;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static LazyHandlerSingleObject getInstance() &#123;</span><br><span class=\"line\">        return SingleObjectHandler.instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们知道，类在使用的时候才会被classloder加载，静态内部类<code>SingleObjectHandler</code>正是利用了这个特点，来懒加载其外部对象<code>LazyHandlerSingleObject</code>的实例。</p>\n<blockquote>\n<p>类嵌套一向是一种比较难以理解的概念，静态内部类是最简单的一种嵌套类，最好把他看作是普通的类，只是碰巧被声明在另一个类内部而已。唯一与普通类不同的是，静态内部类和其外部类可以互相访问所有成员，包括私有成员。</p>\n</blockquote>\n<p>当第一次调用<code>getInstance()</code>方法的时候，<code>SingleObjectHandler</code>才第一次被使用到，从而加载它，自然也就创建了<code>LazyHandlerSingleObject</code>的实例，<code>SingleObjectHandler</code>通过<code>static</code>保证这个实例是唯一的。</p>\n<h2 id=\"枚举\"><a href=\"#枚举\" class=\"headerlink\" title=\"枚举\"></a>枚举</h2><p>这种实现方式还没有被广泛采用，但这是实现单例模式的最佳方法。它更简洁，自动支持序列化机制，绝对防止多次实例化。</p>\n<p>这种方式是《Effective Java》作者 Josh Bloch 提倡的方式，它不仅能避免多线程同步问题，而且还自动支持序列化机制，防止反序列化重新创建新的对象，绝对防止多次实例化。推荐在需要使用单例的时候使用这种方式。</p>\n<p>EnumSingleton.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public enum EnumSingleton &#123;</span><br><span class=\"line\">    INSTANCE;</span><br><span class=\"line\">    public void doSomething() &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>就是这么简单！直接使用<code>EnumSingleton.INSTANCE</code>就可以了，比如<code>EnumSingleton.INSTANCE.doSomething()</code>。Enum类型类似于类，也可以有成员变量和成员方法。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>首先，请尝试使用枚举的方式来实现单例，枚举机制本身对单例有很好的支持。</p>\n<p>如果觉得枚举方式不熟悉，那么：</p>\n<p>通常，比较轻量的单例直接用饿汉式即可；</p>\n<p>重量级的单例对象，最好通过懒加载的方式构建，根据线程安全性的要求选择以上两种懒汉式的方式；当然静态内部类也是一种不错的懒加载方式。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>单例模式（Singleton Pattern）是Java中最简单的设计模式之一，但也是一个很值得玩味儿的设计模式，这是一个创建型的模式。</p>\n<p>单例模式的目的在于，对于一些类，需要保证其仅有一个实例。比如一个Web中的计数器，不用每次刷新在数据库里记录一次，可以用一个单例的对象先缓存起来。但是这个计数器不能有多个实例，否则岂不是不准了。</p>\n<p>具体来说，该设计模式有如下特点或要求：</p>\n<ol>\n<li>单例类只能有一个实例。</li>\n<li>单例类必须自己创建自己的唯一实例。</li>\n<li>单例类必须给所有其他对象提供这一实例。</li>\n</ol>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><h2 id=\"饿汉式\"><a href=\"#饿汉式\" class=\"headerlink\" title=\"饿汉式\"></a>饿汉式</h2><p>我们考虑一下上述的三个要求。</p>\n<p>首先，单例类只能有一个实例。我们知道，一个类的<code>static</code>的成员变量或方法可以看作归属于类本身的，可以被这个类所有的实例共享，可以认为是”独一份儿“的。所以用<code>static</code>关键字修饰这个类的对象，就可以做到。</p>\n<p>然后，单例类必须自己创建自己的唯一实例。那也好办，单例类自己定义一个类型为自己的成员变量，然后设置为<code>static</code>的就可以了。然后把构造方法设置为<code>private</code>的，这样就不能被其他类或对象<code>new</code>了。</p>\n<p>最后，单例类必须给所有其他对象提供这一实例。那就是提供一个get方法可以获取到这个类型为自己的成员变量。</p>\n<p>分析过后，先撸一版代码：</p>\n<p>SingleObject.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SingleObject &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    private final static SingleObject INSTANCE = new SingleObject();</span><br><span class=\"line\"></span><br><span class=\"line\">    private SingleObject() &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static SingleObject getInstance() &#123;</span><br><span class=\"line\">        return instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们搞一个Client检验一下：</p>\n<p>Client.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class Client &#123;</span><br><span class=\"line\">    public static void main(String[] args) &#123;</span><br><span class=\"line\">        System.out.println(SingleObject.getInstance());</span><br><span class=\"line\">        System.out.println(SingleObject.getInstance());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>返回结果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">com.getset.designpatterns.singleton.SingleObject@5e2de80c</span><br><span class=\"line\">com.getset.designpatterns.singleton.SingleObject@5e2de80c</span><br></pre></td></tr></table></figure>\n\n<p>根据对象的hash可以看出，两次调用<code>getInstance()</code>返回的是同一个对象。</p>\n<p>这种是比较常用的方式，叫做“饿汉式”，为啥叫这名自己体会哟～ 我们知道，类加载时，static的成员变量会初始化，所以一旦类加载，那么<code>INSTANCE</code>所指向的对象就被创建了。其实这就是个常亮了，所以可以用大写，然后<code>final</code>修饰。</p>\n<h2 id=\"懒汉式\"><a href=\"#懒汉式\" class=\"headerlink\" title=\"懒汉式\"></a>懒汉式</h2><p>在有些情况下，如果单例类本身比较消耗资源或加载缓慢，希望能够在使用的时候才创建实例，那么可以采用懒加载的方式，如下：</p>\n<p>LazySingleObject.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 本例是线程不安全的</span><br><span class=\"line\">public class LazySingleObject &#123;</span><br><span class=\"line\">    private static LazySingleObject instance;</span><br><span class=\"line\">    private LazySingleObject() &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static LazySingleObject getInstance() &#123;</span><br><span class=\"line\">        if (instance == null) &#123;</span><br><span class=\"line\">            instance = new LazySingleObject();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如此，只有在调用<code>getInstance()</code>的时候才会创建实例。</p>\n<p>但是这种方式是线程不安全的，假设有两个线程同时调用了<code>getInstance()</code>，可能都会检测到<code>instance == null</code>。所以可以把<code>getInstance()</code>方法使用<code>synchronized</code>修饰，以便保证线程安全。</p>\n<p>但是在实际使用过程中，一旦实例被创建后，<code>getInstance()</code>方法只是返回实例，是不需要同步的，而加锁会影响效率，因此我们考虑不对整个方法加锁，而仅仅只对<code>new</code>实例的过程加锁，如下：</p>\n<p>LazySingleObject.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 双检锁/双重校验锁（DCL，即 double-checked locking）</span><br><span class=\"line\">public class LazySingleObject &#123;</span><br><span class=\"line\">    // 使用volatile修饰单例变量</span><br><span class=\"line\">    private static volatile LazySingleObject instance;</span><br><span class=\"line\">    private LazySingleObject() &#123;&#125;</span><br><span class=\"line\">    public static LazySingleObject getInstance() &#123;</span><br><span class=\"line\">        // 第一次判断，此时是未加锁的</span><br><span class=\"line\">        if (instance == null) &#123;</span><br><span class=\"line\">            synchronized (LazySingleObject.class) &#123;</span><br><span class=\"line\">                // 第二次判断，此时是线程安全的</span><br><span class=\"line\">                if (instance == null) &#123;</span><br><span class=\"line\">                    instance = new LazySingleObject();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>可见，只有在实例未创建（<code>instance == null</code>）的时候才同步创建实例对象。在<code>synchronized</code>代码库内部，再次检查实例是否创建，因为第一次检查并不是线程安全的。也因此，这种方式叫做“双检锁/双重校验锁”。这样，一旦实例创建之后，就不再进入同步代码块了，从而效率更高。</p>\n<p>要特别注意的是，单例变量<code>instance</code>要用<code>volatile</code>进行修饰。原因在于编译器出于优化需要会对内存的读写操作重排序，因此LazySingleObject对象初始化时的写操作与写入instance字段的操作可以是无序的。导致的结果就是如果某个线程调用getInstance()可能看到instance字段指向了一个LazySingleObject对象，但看到该对象里的字段值却是默认值，而不是在LazySingleObject构造方法里设置的那些值。而使用<code>volatile</code>字段修饰后，编译器和运行时都会注意到这是个共享变量，因此不会将该变量上的操作和其他内存操作一起重排序，真正保证线程安全。</p>\n<p>以上两种方式可根据场景选择。</p>\n<h2 id=\"登记式-静态内部类\"><a href=\"#登记式-静态内部类\" class=\"headerlink\" title=\"登记式/静态内部类\"></a>登记式/静态内部类</h2><p>如果感觉“双检锁/双重校验锁”这种方式复杂难学，可以采用静态内部类来实现线程安全的懒加载。</p>\n<p>LazyHandlerSingleObject.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class LazyHandlerSingleObject &#123;</span><br><span class=\"line\">    private static class SingleObjectHandler &#123;</span><br><span class=\"line\">        private final static LazyHandlerSingleObject instance = new LazyHandlerSingleObject();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    private static LazyHandlerSingleObject instance;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static LazyHandlerSingleObject getInstance() &#123;</span><br><span class=\"line\">        return SingleObjectHandler.instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们知道，类在使用的时候才会被classloder加载，静态内部类<code>SingleObjectHandler</code>正是利用了这个特点，来懒加载其外部对象<code>LazyHandlerSingleObject</code>的实例。</p>\n<blockquote>\n<p>类嵌套一向是一种比较难以理解的概念，静态内部类是最简单的一种嵌套类，最好把他看作是普通的类，只是碰巧被声明在另一个类内部而已。唯一与普通类不同的是，静态内部类和其外部类可以互相访问所有成员，包括私有成员。</p>\n</blockquote>\n<p>当第一次调用<code>getInstance()</code>方法的时候，<code>SingleObjectHandler</code>才第一次被使用到，从而加载它，自然也就创建了<code>LazyHandlerSingleObject</code>的实例，<code>SingleObjectHandler</code>通过<code>static</code>保证这个实例是唯一的。</p>\n<h2 id=\"枚举\"><a href=\"#枚举\" class=\"headerlink\" title=\"枚举\"></a>枚举</h2><p>这种实现方式还没有被广泛采用，但这是实现单例模式的最佳方法。它更简洁，自动支持序列化机制，绝对防止多次实例化。</p>\n<p>这种方式是《Effective Java》作者 Josh Bloch 提倡的方式，它不仅能避免多线程同步问题，而且还自动支持序列化机制，防止反序列化重新创建新的对象，绝对防止多次实例化。推荐在需要使用单例的时候使用这种方式。</p>\n<p>EnumSingleton.java</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public enum EnumSingleton &#123;</span><br><span class=\"line\">    INSTANCE;</span><br><span class=\"line\">    public void doSomething() &#123;</span><br><span class=\"line\">        ...</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>就是这么简单！直接使用<code>EnumSingleton.INSTANCE</code>就可以了，比如<code>EnumSingleton.INSTANCE.doSomething()</code>。Enum类型类似于类，也可以有成员变量和成员方法。</p>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>首先，请尝试使用枚举的方式来实现单例，枚举机制本身对单例有很好的支持。</p>\n<p>如果觉得枚举方式不熟悉，那么：</p>\n<p>通常，比较轻量的单例直接用饿汉式即可；</p>\n<p>重量级的单例对象，最好通过懒加载的方式构建，根据线程安全性的要求选择以上两种懒汉式的方式；当然静态内部类也是一种不错的懒加载方式。</p>\n"},{"uuid":"bbaef9f2-c0ab-11ec-92a1-7557b2313227","title":"策略模式","abbrlink":"72e3b671","_content":"\n策略（Strategy）模式是对算法的一种封装，是把使用算法的责任和算法本身分割开来，委托给不同的对象管理，从而可以实现算法的互换，从而一个类的行为或其算法可以在运行时更改，这种设计模式属于行为型模式。\n\n策略模式在生活中和架构设计中非常常见。\n\n- 比如，商场打折，对于同样一类商品，不同的时间，促销方式和打折力度是不同的，这时候，促销方式和打折力度就是策略，对于这种应用场景来说，策略需要是可以随时变更的。\n- 还有个例子，比如排序，不同的对象，其排序依据不同。对于学生而言，有时候根据身高排序安排坐位，有时候根据成绩排序安排考场，这时候把这两种排序方式独立出来是一种比较好的方法，当需要安排坐位时，就使用“按照身高排序”的策略，当需要安排考场时就使用“按照成绩排序”的策略。从而一旦有新的需求和新的策略，只需要变更另外一个策略（比如“按年龄排序”）就OK了。\n- 再举个例子，说到插卡游戏机，估计不少朋友没见过，80后还是有印象的，游戏机本身不能玩，需要再购买不同的游戏卡插上才能玩，比如魂斗罗、超级玛丽等等。\n\n# 例子\n\n我们用一个简单的计算的例子来阐述这种模式。需求很简单，提供两个数字，给出这两个数字的加减乘除的结果。\n\n在这里，加减乘除就是不同的策略，我们统一用`Operation`抽象。\n\nOperation.java\n\n~~~java\npublic interface Operation {\n    int calculate(int x, int y);\n}\n~~~\n\nAddOperation.java\n\n~~~java\npublic class AddOperation implements Operation {\n    public int calculate(int x, int y) {\n        return x + y;\n    }\n}\n~~~\n\nSubOperation.java\n\n~~~java\npublic class SubOperation implements Operation {\n    public int calculate(int x, int y) {\n        return x - y;\n    }\n}\n~~~\n\nMulOperation.java\n\n~~~java\npublic class MulOperation implements Operation {\n    public int calculate(int x, int y) {\n        return x * y;\n    }\n}\n~~~\n\nDivOperation.java\n\n~~~java\npublic class DivOperation implements Operation {\n    public int calculate(int x, int y) {\n        return x / y;\n    }\n}\n~~~\n\n我们的计算器比较旧，来自上世纪，就像插卡游戏机，需要先设定计算方法，然后才能进行计算。\n\nCalculator.java\n\n~~~java\npublic class Calculator {\n    private Operation operation;\n\n    public Calculator(Operation operation) {\n        this.operation = operation;\n    }\n\n    public void setOperation(Operation operation) {\n        this.operation = operation;\n    }\n\n    public int calculate(int x, int y) {\n        return operation.calculate(x, y);\n    }\n}\n~~~\n\n下面我们用一下这个计算器：\n\nClient.java\n\n```java\npublic class Client {\n    public static void main(String[] args) {\n        int x = 6, y = 3;\n        Calculator calculator = new Calculator(new AddOperation());\n        System.out.println(\"6+3=\" + calculator.calculate(x, y));\n        calculator.setOperation(new SubOperation());\n        System.out.println(\"6-3=\" + calculator.calculate(x, y));\n        calculator.setOperation(new MulOperation());\n        System.out.println(\"6*3=\" + calculator.calculate(x, y));\n        calculator.setOperation(new DivOperation());\n        System.out.println(\"6/3=\" + calculator.calculate(x, y));\n    }\n}\n```\n\n输出如下：\n\n```\n6+3=9\n6-3=3\n6*3=18\n6/3=2\n```\n\n# 总结\n\n策略模式是如何做到随意切换的呢？很显然，仍然是采用了面向接口编程的思路，所有的策略都实现了同样的接口，策略消费者只需要基于接口调用即可，不同的接口实现提供了不同的策略。这也是“历史替换原则”的具体体现。\n\n在具体的开发中，策略模式的例子经常见到：\n\n- 我们在使用SpringMVC开发的时候，前端页面的渲染可能采用不同的技术，比如JSP、Thymeleaf等，对于Spring框架来说，要能够接纳不同的页面渲染技术，因此提供了`ViewResolver`的接口，如果是JSP的渲染方法，那么就使用`InternalResourceViewResolver`；如果是Thymeleaf的渲染方法，就配置使用`ThymeleafViewResolver`。\n- Java中观察`Comparable`和`Comparator`两个接口的应用，也是理解策略模式的好思路。对于`Comparable`来说，其应用于被比较的对象上，从接口方法`int compareTo(T o);`可以看出，是由当前对象调起的与另一个对象的比较；而`Comparator`接口的用于比较的接口方法为`int compare(T o1, T o2);`，不同点在于参数个数，一个`Comparator`是独立于`o1`和`o2`两个被比较对象之外的第三方，因此做到了排序算法与调用算法的解耦，不同的`Comparator`实现就是不同的策略，可见`Comparator`的应用方式是策略模式。\n\n最后总结一下策略模式的使用场景：\n\n1、如果在一个系统里面有许多类，它们之间的区别仅在于它们的行为，那么使用策略模式可以动态地让一个对象在许多行为中选择一种行为。 \n\n2、一个系统需要动态地在几种算法中选择一种。 \n\n3、如果一个对象有很多的行为，如果不用恰当的模式，这些行为就只好使用多重的条件选择语句来实现。","source":"_posts/design-pattern/策略模式.md","raw":"---\nuuid: bbaef9f2-c0ab-11ec-92a1-7557b2313227\ntitle: 策略模式\ntags: 设计模式\ncategories: Java\nabbrlink: 72e3b671\n---\n\n策略（Strategy）模式是对算法的一种封装，是把使用算法的责任和算法本身分割开来，委托给不同的对象管理，从而可以实现算法的互换，从而一个类的行为或其算法可以在运行时更改，这种设计模式属于行为型模式。\n\n策略模式在生活中和架构设计中非常常见。\n\n- 比如，商场打折，对于同样一类商品，不同的时间，促销方式和打折力度是不同的，这时候，促销方式和打折力度就是策略，对于这种应用场景来说，策略需要是可以随时变更的。\n- 还有个例子，比如排序，不同的对象，其排序依据不同。对于学生而言，有时候根据身高排序安排坐位，有时候根据成绩排序安排考场，这时候把这两种排序方式独立出来是一种比较好的方法，当需要安排坐位时，就使用“按照身高排序”的策略，当需要安排考场时就使用“按照成绩排序”的策略。从而一旦有新的需求和新的策略，只需要变更另外一个策略（比如“按年龄排序”）就OK了。\n- 再举个例子，说到插卡游戏机，估计不少朋友没见过，80后还是有印象的，游戏机本身不能玩，需要再购买不同的游戏卡插上才能玩，比如魂斗罗、超级玛丽等等。\n\n# 例子\n\n我们用一个简单的计算的例子来阐述这种模式。需求很简单，提供两个数字，给出这两个数字的加减乘除的结果。\n\n在这里，加减乘除就是不同的策略，我们统一用`Operation`抽象。\n\nOperation.java\n\n~~~java\npublic interface Operation {\n    int calculate(int x, int y);\n}\n~~~\n\nAddOperation.java\n\n~~~java\npublic class AddOperation implements Operation {\n    public int calculate(int x, int y) {\n        return x + y;\n    }\n}\n~~~\n\nSubOperation.java\n\n~~~java\npublic class SubOperation implements Operation {\n    public int calculate(int x, int y) {\n        return x - y;\n    }\n}\n~~~\n\nMulOperation.java\n\n~~~java\npublic class MulOperation implements Operation {\n    public int calculate(int x, int y) {\n        return x * y;\n    }\n}\n~~~\n\nDivOperation.java\n\n~~~java\npublic class DivOperation implements Operation {\n    public int calculate(int x, int y) {\n        return x / y;\n    }\n}\n~~~\n\n我们的计算器比较旧，来自上世纪，就像插卡游戏机，需要先设定计算方法，然后才能进行计算。\n\nCalculator.java\n\n~~~java\npublic class Calculator {\n    private Operation operation;\n\n    public Calculator(Operation operation) {\n        this.operation = operation;\n    }\n\n    public void setOperation(Operation operation) {\n        this.operation = operation;\n    }\n\n    public int calculate(int x, int y) {\n        return operation.calculate(x, y);\n    }\n}\n~~~\n\n下面我们用一下这个计算器：\n\nClient.java\n\n```java\npublic class Client {\n    public static void main(String[] args) {\n        int x = 6, y = 3;\n        Calculator calculator = new Calculator(new AddOperation());\n        System.out.println(\"6+3=\" + calculator.calculate(x, y));\n        calculator.setOperation(new SubOperation());\n        System.out.println(\"6-3=\" + calculator.calculate(x, y));\n        calculator.setOperation(new MulOperation());\n        System.out.println(\"6*3=\" + calculator.calculate(x, y));\n        calculator.setOperation(new DivOperation());\n        System.out.println(\"6/3=\" + calculator.calculate(x, y));\n    }\n}\n```\n\n输出如下：\n\n```\n6+3=9\n6-3=3\n6*3=18\n6/3=2\n```\n\n# 总结\n\n策略模式是如何做到随意切换的呢？很显然，仍然是采用了面向接口编程的思路，所有的策略都实现了同样的接口，策略消费者只需要基于接口调用即可，不同的接口实现提供了不同的策略。这也是“历史替换原则”的具体体现。\n\n在具体的开发中，策略模式的例子经常见到：\n\n- 我们在使用SpringMVC开发的时候，前端页面的渲染可能采用不同的技术，比如JSP、Thymeleaf等，对于Spring框架来说，要能够接纳不同的页面渲染技术，因此提供了`ViewResolver`的接口，如果是JSP的渲染方法，那么就使用`InternalResourceViewResolver`；如果是Thymeleaf的渲染方法，就配置使用`ThymeleafViewResolver`。\n- Java中观察`Comparable`和`Comparator`两个接口的应用，也是理解策略模式的好思路。对于`Comparable`来说，其应用于被比较的对象上，从接口方法`int compareTo(T o);`可以看出，是由当前对象调起的与另一个对象的比较；而`Comparator`接口的用于比较的接口方法为`int compare(T o1, T o2);`，不同点在于参数个数，一个`Comparator`是独立于`o1`和`o2`两个被比较对象之外的第三方，因此做到了排序算法与调用算法的解耦，不同的`Comparator`实现就是不同的策略，可见`Comparator`的应用方式是策略模式。\n\n最后总结一下策略模式的使用场景：\n\n1、如果在一个系统里面有许多类，它们之间的区别仅在于它们的行为，那么使用策略模式可以动态地让一个对象在许多行为中选择一种行为。 \n\n2、一个系统需要动态地在几种算法中选择一种。 \n\n3、如果一个对象有很多的行为，如果不用恰当的模式，这些行为就只好使用多重的条件选择语句来实现。","slug":"design-pattern/策略模式","published":1,"date":"2022-04-20T12:41:20.958Z","updated":"2022-05-04T02:59:46.943Z","_id":"cl2qzftha001b13nocz4ogp73","comments":1,"layout":"post","photos":[],"link":"","content":"<p>策略（Strategy）模式是对算法的一种封装，是把使用算法的责任和算法本身分割开来，委托给不同的对象管理，从而可以实现算法的互换，从而一个类的行为或其算法可以在运行时更改，这种设计模式属于行为型模式。</p>\n<p>策略模式在生活中和架构设计中非常常见。</p>\n<ul>\n<li>比如，商场打折，对于同样一类商品，不同的时间，促销方式和打折力度是不同的，这时候，促销方式和打折力度就是策略，对于这种应用场景来说，策略需要是可以随时变更的。</li>\n<li>还有个例子，比如排序，不同的对象，其排序依据不同。对于学生而言，有时候根据身高排序安排坐位，有时候根据成绩排序安排考场，这时候把这两种排序方式独立出来是一种比较好的方法，当需要安排坐位时，就使用“按照身高排序”的策略，当需要安排考场时就使用“按照成绩排序”的策略。从而一旦有新的需求和新的策略，只需要变更另外一个策略（比如“按年龄排序”）就OK了。</li>\n<li>再举个例子，说到插卡游戏机，估计不少朋友没见过，80后还是有印象的，游戏机本身不能玩，需要再购买不同的游戏卡插上才能玩，比如魂斗罗、超级玛丽等等。</li>\n</ul>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>我们用一个简单的计算的例子来阐述这种模式。需求很简单，提供两个数字，给出这两个数字的加减乘除的结果。</p>\n<p>在这里，加减乘除就是不同的策略，我们统一用<code>Operation</code>抽象。</p>\n<p>Operation.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Operation</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>AddOperation.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AddOperation</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Operation</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>SubOperation.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SubOperation</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Operation</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x - y;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>MulOperation.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MulOperation</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Operation</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x * y;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>DivOperation.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DivOperation</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Operation</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x / y;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们的计算器比较旧，来自上世纪，就像插卡游戏机，需要先设定计算方法，然后才能进行计算。</p>\n<p>Calculator.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Calculator</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Operation operation;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Calculator</span><span class=\"params\">(Operation operation)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.operation = operation;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setOperation</span><span class=\"params\">(Operation operation)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.operation = operation;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> operation.calculate(x, y);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面我们用一下这个计算器：</p>\n<p>Client.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Client</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> <span class=\"number\">6</span>, y = <span class=\"number\">3</span>;</span><br><span class=\"line\">        <span class=\"type\">Calculator</span> <span class=\"variable\">calculator</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Calculator</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">AddOperation</span>());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;6+3=&quot;</span> + calculator.calculate(x, y));</span><br><span class=\"line\">        calculator.setOperation(<span class=\"keyword\">new</span> <span class=\"title class_\">SubOperation</span>());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;6-3=&quot;</span> + calculator.calculate(x, y));</span><br><span class=\"line\">        calculator.setOperation(<span class=\"keyword\">new</span> <span class=\"title class_\">MulOperation</span>());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;6*3=&quot;</span> + calculator.calculate(x, y));</span><br><span class=\"line\">        calculator.setOperation(<span class=\"keyword\">new</span> <span class=\"title class_\">DivOperation</span>());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;6/3=&quot;</span> + calculator.calculate(x, y));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">6+3=9</span><br><span class=\"line\">6-3=3</span><br><span class=\"line\">6*3=18</span><br><span class=\"line\">6/3=2</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>策略模式是如何做到随意切换的呢？很显然，仍然是采用了面向接口编程的思路，所有的策略都实现了同样的接口，策略消费者只需要基于接口调用即可，不同的接口实现提供了不同的策略。这也是“历史替换原则”的具体体现。</p>\n<p>在具体的开发中，策略模式的例子经常见到：</p>\n<ul>\n<li>我们在使用SpringMVC开发的时候，前端页面的渲染可能采用不同的技术，比如JSP、Thymeleaf等，对于Spring框架来说，要能够接纳不同的页面渲染技术，因此提供了<code>ViewResolver</code>的接口，如果是JSP的渲染方法，那么就使用<code>InternalResourceViewResolver</code>；如果是Thymeleaf的渲染方法，就配置使用<code>ThymeleafViewResolver</code>。</li>\n<li>Java中观察<code>Comparable</code>和<code>Comparator</code>两个接口的应用，也是理解策略模式的好思路。对于<code>Comparable</code>来说，其应用于被比较的对象上，从接口方法<code>int compareTo(T o);</code>可以看出，是由当前对象调起的与另一个对象的比较；而<code>Comparator</code>接口的用于比较的接口方法为<code>int compare(T o1, T o2);</code>，不同点在于参数个数，一个<code>Comparator</code>是独立于<code>o1</code>和<code>o2</code>两个被比较对象之外的第三方，因此做到了排序算法与调用算法的解耦，不同的<code>Comparator</code>实现就是不同的策略，可见<code>Comparator</code>的应用方式是策略模式。</li>\n</ul>\n<p>最后总结一下策略模式的使用场景：</p>\n<p>1、如果在一个系统里面有许多类，它们之间的区别仅在于它们的行为，那么使用策略模式可以动态地让一个对象在许多行为中选择一种行为。 </p>\n<p>2、一个系统需要动态地在几种算法中选择一种。 </p>\n<p>3、如果一个对象有很多的行为，如果不用恰当的模式，这些行为就只好使用多重的条件选择语句来实现。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>策略（Strategy）模式是对算法的一种封装，是把使用算法的责任和算法本身分割开来，委托给不同的对象管理，从而可以实现算法的互换，从而一个类的行为或其算法可以在运行时更改，这种设计模式属于行为型模式。</p>\n<p>策略模式在生活中和架构设计中非常常见。</p>\n<ul>\n<li>比如，商场打折，对于同样一类商品，不同的时间，促销方式和打折力度是不同的，这时候，促销方式和打折力度就是策略，对于这种应用场景来说，策略需要是可以随时变更的。</li>\n<li>还有个例子，比如排序，不同的对象，其排序依据不同。对于学生而言，有时候根据身高排序安排坐位，有时候根据成绩排序安排考场，这时候把这两种排序方式独立出来是一种比较好的方法，当需要安排坐位时，就使用“按照身高排序”的策略，当需要安排考场时就使用“按照成绩排序”的策略。从而一旦有新的需求和新的策略，只需要变更另外一个策略（比如“按年龄排序”）就OK了。</li>\n<li>再举个例子，说到插卡游戏机，估计不少朋友没见过，80后还是有印象的，游戏机本身不能玩，需要再购买不同的游戏卡插上才能玩，比如魂斗罗、超级玛丽等等。</li>\n</ul>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>我们用一个简单的计算的例子来阐述这种模式。需求很简单，提供两个数字，给出这两个数字的加减乘除的结果。</p>\n<p>在这里，加减乘除就是不同的策略，我们统一用<code>Operation</code>抽象。</p>\n<p>Operation.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Operation</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>AddOperation.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AddOperation</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Operation</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x + y;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>SubOperation.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SubOperation</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Operation</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x - y;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>MulOperation.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MulOperation</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Operation</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x * y;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>DivOperation.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">DivOperation</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Operation</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x / y;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们的计算器比较旧，来自上世纪，就像插卡游戏机，需要先设定计算方法，然后才能进行计算。</p>\n<p>Calculator.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Calculator</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Operation operation;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Calculator</span><span class=\"params\">(Operation operation)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.operation = operation;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setOperation</span><span class=\"params\">(Operation operation)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.operation = operation;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">calculate</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> operation.calculate(x, y);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>下面我们用一下这个计算器：</p>\n<p>Client.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Client</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">x</span> <span class=\"operator\">=</span> <span class=\"number\">6</span>, y = <span class=\"number\">3</span>;</span><br><span class=\"line\">        <span class=\"type\">Calculator</span> <span class=\"variable\">calculator</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Calculator</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">AddOperation</span>());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;6+3=&quot;</span> + calculator.calculate(x, y));</span><br><span class=\"line\">        calculator.setOperation(<span class=\"keyword\">new</span> <span class=\"title class_\">SubOperation</span>());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;6-3=&quot;</span> + calculator.calculate(x, y));</span><br><span class=\"line\">        calculator.setOperation(<span class=\"keyword\">new</span> <span class=\"title class_\">MulOperation</span>());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;6*3=&quot;</span> + calculator.calculate(x, y));</span><br><span class=\"line\">        calculator.setOperation(<span class=\"keyword\">new</span> <span class=\"title class_\">DivOperation</span>());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;6/3=&quot;</span> + calculator.calculate(x, y));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>输出如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">6+3=9</span><br><span class=\"line\">6-3=3</span><br><span class=\"line\">6*3=18</span><br><span class=\"line\">6/3=2</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>策略模式是如何做到随意切换的呢？很显然，仍然是采用了面向接口编程的思路，所有的策略都实现了同样的接口，策略消费者只需要基于接口调用即可，不同的接口实现提供了不同的策略。这也是“历史替换原则”的具体体现。</p>\n<p>在具体的开发中，策略模式的例子经常见到：</p>\n<ul>\n<li>我们在使用SpringMVC开发的时候，前端页面的渲染可能采用不同的技术，比如JSP、Thymeleaf等，对于Spring框架来说，要能够接纳不同的页面渲染技术，因此提供了<code>ViewResolver</code>的接口，如果是JSP的渲染方法，那么就使用<code>InternalResourceViewResolver</code>；如果是Thymeleaf的渲染方法，就配置使用<code>ThymeleafViewResolver</code>。</li>\n<li>Java中观察<code>Comparable</code>和<code>Comparator</code>两个接口的应用，也是理解策略模式的好思路。对于<code>Comparable</code>来说，其应用于被比较的对象上，从接口方法<code>int compareTo(T o);</code>可以看出，是由当前对象调起的与另一个对象的比较；而<code>Comparator</code>接口的用于比较的接口方法为<code>int compare(T o1, T o2);</code>，不同点在于参数个数，一个<code>Comparator</code>是独立于<code>o1</code>和<code>o2</code>两个被比较对象之外的第三方，因此做到了排序算法与调用算法的解耦，不同的<code>Comparator</code>实现就是不同的策略，可见<code>Comparator</code>的应用方式是策略模式。</li>\n</ul>\n<p>最后总结一下策略模式的使用场景：</p>\n<p>1、如果在一个系统里面有许多类，它们之间的区别仅在于它们的行为，那么使用策略模式可以动态地让一个对象在许多行为中选择一种行为。 </p>\n<p>2、一个系统需要动态地在几种算法中选择一种。 </p>\n<p>3、如果一个对象有很多的行为，如果不用恰当的模式，这些行为就只好使用多重的条件选择语句来实现。</p>\n"},{"uuid":"bbaef9f3-c0ab-11ec-92a1-7557b2313227","title":"访问者模式","abbrlink":"64b51ed9","_content":"\n\n在访问者模式（Visitor Pattern）中，通过一个访问者类，来封装对数据结构中不同类型元素的执行算法。通过这种方式，元素的执行算法可以随着访问者改变而改变。这种类型的设计模式属于行为型模式。\n\n# 例子\n\n我们假设有一些形状，包括三角形、矩形和圆形这三种不同的几何形状。我们知道不同的形状其参数是不同的：\n\n- 三角形：三条边的长度确定一个三角形；\n- 矩形：长和宽确定一个矩形；\n- 圆形就一个参数——半径。\n\n那么任务来了，我们把一系列类型和参数不同的形状用`ArrayList`来管理，然后依次遍历，并计算出它们的周长。\n\n## 一种计算任务\n\n这个任务非常简单，由于用`ArrayList`来管理，因此需要各个不同形状抽象出统一的接口`Shape`。这个接口定义一个共同的方法`getPerimeter`，然后这三种形状都实现这个方法就OK了嘛。其代码如下：\n\nShape.java\n\n~~~java\npublic interface Shape {\n    double getPerimeter();\n}\n~~~\n\nTriangle.java（三个属性：三条边的长度）\n\n~~~java\npublic class Triangle implements Shape {\n    private double edgeA;\n    private double edgeB;\n    private double edgeC;\n\n    public Triangle(double edgeA, double edgeB, double edgeC) {\n        this.edgeA = edgeA;\n        this.edgeB = edgeB;\n        this.edgeC = edgeC;\n    }\n    \n    // 省略 getter setter\n    public double getPerimeter() {\n        return edgeA + edgeB + edgeC;\n    }\n}\n~~~\n\nRectangle.java（两个属性：长和宽）\n\n~~~java\npublic class Rectangle implements Shape {\n    private double length;\n    private double width;\n\n    public Rectangle(double length, double width) {\n        this.length = length;\n        this.width = width;\n    }\n\t\n    // 省略 getter setter\n    public double getPerimeter() {\n        return (length + width) * 2;\n    }\n}\n~~~\n\nCircle.java（一个属性：半径）\n\n```java\npublic class Circle implements Shape {\n    private double radius;\n\n    public Circle(double radius) {\n        this.radius = radius;\n    }\n\n    // 省略 getter setter\n    public void getPerimeter() {\n        return 2 * Math.PI * radius;\n    }\n}\n```\n\n齐活儿~ 写个`Client`交卷了：\n\n~~~java\npublic class Client {\n    public static void main(String[] args) {\n        List<Shape> shapes = new ArrayList<Shape>();\n        shapes.add(new Triangle(1.3, 2.2, 3.1));\n        shapes.add(new Circle(1.2));\n        shapes.add(new Triangle(2.4, 3.3, 4.2));\n        shapes.add(new Ractangle(2.1, 3.2));\n        shapes.add(new Circle(5.6));\n        \n        for (Shape shape : shapes) {\n            System.out.println(shape.getPerimeter());\n        }\n    }\n}\n~~~\n\n这是面向接口编程的最基本用法了吧。不过别忙着高兴，如果这个时候再加一个任务——“求面积”呢？那就在接口里再增加一个`getArea`方法，然后所有的形状都实现了呗~\n\n好吧，也可以，不过任务还远没有结束，如果还要算出能够包住每个形状的最小的圆的直径呢？以及能够置于形状内的最大的圆的直径呢？等等等等。。。\n\n每次提出新的计算任务后，频繁修改接口及其实现类，这显然是不符合“开闭”原则的，而且明显也是不优雅的。况且，天知道将来还会需要计算什么幺蛾子！\n\n## 多种计算任务，策略模式\n\n必须要调整一下设计思路以满足灵活性。\n\n我们曾经遇到过对于同一个对象进行不同运算的设计——比如策略模式，无论是计算周长、面积都是不同的策略，我们将不同的策略作为对象传递给形状，就可以得到该策略相应的结果。比如对于矩形：\n\n~~~java\n// 对于矩形，在Rectangle.java\npublic double accept(Strategy strategy) {\n    return strategy.calculate(this);\n}\n\n// 所有的策略都实现统一的接口 Strategy\npublic interface Strategy {\n    double calculate(Rectangle rect);\n}\n\n// 对于计算周长的策略，在PerimeterStrategy.java\npublic class PerimeterStrategy implements Strategy {\n    public double calculate(Rectangle rect) {\n        return 2 * (rect.getLength() + rect.getWidth());\n    }\n}\n\n// 对于计算面积的策略，在AreaStrategy.java\npublic class AreaStrategy implements Strategy {\n    public double calculate(Rectangle rect) {\n        return rect.getLength() * rect.getWidth();\n    }\n}\n~~~\n\n## 不同类型对象的多种计算任务，访问者模式\n\n上边的例子是针对矩形的，那么三角形和圆形也都实现相应的策略类的话，类的数量就很快增长起来了，似乎也不优雅嘛！ 其实很简单，因为无论是周长策略还是面积策略，各个形状都要实现，那对于同一种策略打个包不就OK了吗：\n\nCalculator.java\n\n```java\npublic interface Calculator {\n    double ofShape(Triangle triangle);\n    double ofShape(Circle circle);\n    double ofShape(Square square);\n}\n```\n\nPerimeter.java（各种形状周长策略的打包）\n\n```java\npublic class Perimeter implements Calculator {\n    public double ofShape(Triangle triangle) {\n        return triangle.getEdgeA() + triangle.getEdgeB() + triangle.getEdgeC();\n    }\n\n    public double ofShape(Circle circle) {\n        return circle.getRadius() * Math.PI * 2;\n    }\n\n    public double ofShape(Square square) {\n        return square.getEdge() * 4;\n    }\n}\n```\n\nArea.java（各种形状面积策略的打包）\n\n```java\npublic class Area implements Calculator {\n    public double ofShape(Triangle triangle) {\n        double a = triangle.getEdgeA(), b = triangle.getEdgeB(), c = triangle.getEdgeC();\n        double p = (a + b + c) / 2;\n        return Math.sqrt(p * (p - a) *  (p - b) * (p - c));\n    }\n\n    public double ofShape(Circle circle) {\n        return Math.PI * circle.getRadius() * circle.getRadius();\n    }\n\n    public double ofShape(Square square) {\n        return Math.pow(square.getEdge(), 2);\n    }\n}\n```\n\n两种策略的打包都实现自`Calculator`接口，以后还有啥计算需求，起个类实现这个接口就可以了。\n\n那对于各个形状，刚才的代码也要稍微调整一下：\n\nShape.java\n\n```java\npublic interface Shape {\n    // double getPerimeter();\n    // 对于不同的计算策略来者不拒\n    double accept(Calculator calculator);\n}\n```\n\nTriangle.java（三个属性：三条边的长度）\n\n~~~java\npublic class Triangle implements Shape {\n    private double edgeA;\n    private double edgeB;\n    private double edgeC;\n\n    public Triangle(double edgeA, double edgeB, double edgeC) {\n        this.edgeA = edgeA;\n        this.edgeB = edgeB;\n        this.edgeC = edgeC;\n    }\n    // 方法接受策略对象为参数，方法内将自身作为参数再传给策略的方法\n    public double accept(Calculator calculator) {\n        return calculator.ofShape(this);\n    }\n}\n~~~\n\n在`accept`方法中，接受策略对象为参数，方法内将自身作为参数再传给策略的具体方法，这种方式叫做“双重分派”，高大上的名字往往不好记也不好理解，哈哈，其实不记也罢，通过这种巧妙的回调方式实现不同策略对不同类型对象的计算任务。\n\n我们再测试一下：\n\nClient.java\n\n~~~java\npublic class Client {\n    public static void main(String[] args) {\n        // 一个含有5个元素的List，包含三种不同的形状\n        List<Shape> shapes = new ArrayList<Shape>();\n        shapes.add(new Triangle(1.3, 2.2, 3.1));\n        shapes.add(new Circle(1.2));\n        shapes.add(new Triangle(2.4, 3.3, 4.2));\n        shapes.add(new Rectangle(2.1, 3.2));\n        shapes.add(new Circle(5.6));\n\n        // 计算周长和面积的不同策略（访问者）\n        Perimeter perimeter = new Perimeter();\n        Area area = new Area();\n\n        // 将周长和面积的计算策略传入（接受不同访问者的访问）\n        for (Shape shape : shapes) {\n            System.out.printf(\"周长 : %5.2f\\t 面积 : %5.2f\\n\", shape.accept(perimeter), shape.accept(area));\n        }\n    }\n}\n~~~\n\n将不同的策略对象传递给各个元素，从而对不同类型的元素进行不同策略的计算。是不是感觉代码优雅了不少呢^_^\n\n测试结果：\n\n~~~\n周长 :  6.60\t 面积 :  1.20\n周长 :  7.54\t 面积 :  4.52\n周长 :  9.90\t 面积 :  3.95\n周长 : 10.60\t 面积 :  6.72\n周长 : 35.19\t 面积 : 98.52\n~~~\n\n# 总结\n\n上边的例子就是应用了访问者模式。为啥叫访问者模式呢？\n\n其实例子中的策略就相当于依次访问各个元素的访问者，每个元素可以接受(`accept`)不同访问者作为参数，从而交由访问者做出不同的操作。\n\n我们也可以看出访问者模式的应用场景具有如下特点：\n\n- 通常用于处理数据结构中不同类型元素的遍历处理问题。这里所说的数据结构比如例子中的列表，或者数组、Map、Stack、Set，甚至复杂的树，重点不在于数据结构，而在于不同类型的元素放到一起，要“因材施教”。\n- 即使对于每种类型的元素，也有不同的“访问方式”，将不同的“访问方式”作为不同的对象传递给元素。“访问者”相当于对各种类型的元素的同一种“访问方式”的打包。\n- 使用到了双重分派，在`accept`方法中，接受策略对象为参数，方法内将自身作为参数再传给策略的具体方法。\n\n所以，这是一个 `m x n` 的问题，多种元素对应多种“访问方式”。\n","source":"_posts/design-pattern/访问者模式.md","raw":"---\nuuid: bbaef9f3-c0ab-11ec-92a1-7557b2313227\ntitle: 访问者模式\ntags: 设计模式\ncategories: Java\nabbrlink: 64b51ed9\n---\n\n\n在访问者模式（Visitor Pattern）中，通过一个访问者类，来封装对数据结构中不同类型元素的执行算法。通过这种方式，元素的执行算法可以随着访问者改变而改变。这种类型的设计模式属于行为型模式。\n\n# 例子\n\n我们假设有一些形状，包括三角形、矩形和圆形这三种不同的几何形状。我们知道不同的形状其参数是不同的：\n\n- 三角形：三条边的长度确定一个三角形；\n- 矩形：长和宽确定一个矩形；\n- 圆形就一个参数——半径。\n\n那么任务来了，我们把一系列类型和参数不同的形状用`ArrayList`来管理，然后依次遍历，并计算出它们的周长。\n\n## 一种计算任务\n\n这个任务非常简单，由于用`ArrayList`来管理，因此需要各个不同形状抽象出统一的接口`Shape`。这个接口定义一个共同的方法`getPerimeter`，然后这三种形状都实现这个方法就OK了嘛。其代码如下：\n\nShape.java\n\n~~~java\npublic interface Shape {\n    double getPerimeter();\n}\n~~~\n\nTriangle.java（三个属性：三条边的长度）\n\n~~~java\npublic class Triangle implements Shape {\n    private double edgeA;\n    private double edgeB;\n    private double edgeC;\n\n    public Triangle(double edgeA, double edgeB, double edgeC) {\n        this.edgeA = edgeA;\n        this.edgeB = edgeB;\n        this.edgeC = edgeC;\n    }\n    \n    // 省略 getter setter\n    public double getPerimeter() {\n        return edgeA + edgeB + edgeC;\n    }\n}\n~~~\n\nRectangle.java（两个属性：长和宽）\n\n~~~java\npublic class Rectangle implements Shape {\n    private double length;\n    private double width;\n\n    public Rectangle(double length, double width) {\n        this.length = length;\n        this.width = width;\n    }\n\t\n    // 省略 getter setter\n    public double getPerimeter() {\n        return (length + width) * 2;\n    }\n}\n~~~\n\nCircle.java（一个属性：半径）\n\n```java\npublic class Circle implements Shape {\n    private double radius;\n\n    public Circle(double radius) {\n        this.radius = radius;\n    }\n\n    // 省略 getter setter\n    public void getPerimeter() {\n        return 2 * Math.PI * radius;\n    }\n}\n```\n\n齐活儿~ 写个`Client`交卷了：\n\n~~~java\npublic class Client {\n    public static void main(String[] args) {\n        List<Shape> shapes = new ArrayList<Shape>();\n        shapes.add(new Triangle(1.3, 2.2, 3.1));\n        shapes.add(new Circle(1.2));\n        shapes.add(new Triangle(2.4, 3.3, 4.2));\n        shapes.add(new Ractangle(2.1, 3.2));\n        shapes.add(new Circle(5.6));\n        \n        for (Shape shape : shapes) {\n            System.out.println(shape.getPerimeter());\n        }\n    }\n}\n~~~\n\n这是面向接口编程的最基本用法了吧。不过别忙着高兴，如果这个时候再加一个任务——“求面积”呢？那就在接口里再增加一个`getArea`方法，然后所有的形状都实现了呗~\n\n好吧，也可以，不过任务还远没有结束，如果还要算出能够包住每个形状的最小的圆的直径呢？以及能够置于形状内的最大的圆的直径呢？等等等等。。。\n\n每次提出新的计算任务后，频繁修改接口及其实现类，这显然是不符合“开闭”原则的，而且明显也是不优雅的。况且，天知道将来还会需要计算什么幺蛾子！\n\n## 多种计算任务，策略模式\n\n必须要调整一下设计思路以满足灵活性。\n\n我们曾经遇到过对于同一个对象进行不同运算的设计——比如策略模式，无论是计算周长、面积都是不同的策略，我们将不同的策略作为对象传递给形状，就可以得到该策略相应的结果。比如对于矩形：\n\n~~~java\n// 对于矩形，在Rectangle.java\npublic double accept(Strategy strategy) {\n    return strategy.calculate(this);\n}\n\n// 所有的策略都实现统一的接口 Strategy\npublic interface Strategy {\n    double calculate(Rectangle rect);\n}\n\n// 对于计算周长的策略，在PerimeterStrategy.java\npublic class PerimeterStrategy implements Strategy {\n    public double calculate(Rectangle rect) {\n        return 2 * (rect.getLength() + rect.getWidth());\n    }\n}\n\n// 对于计算面积的策略，在AreaStrategy.java\npublic class AreaStrategy implements Strategy {\n    public double calculate(Rectangle rect) {\n        return rect.getLength() * rect.getWidth();\n    }\n}\n~~~\n\n## 不同类型对象的多种计算任务，访问者模式\n\n上边的例子是针对矩形的，那么三角形和圆形也都实现相应的策略类的话，类的数量就很快增长起来了，似乎也不优雅嘛！ 其实很简单，因为无论是周长策略还是面积策略，各个形状都要实现，那对于同一种策略打个包不就OK了吗：\n\nCalculator.java\n\n```java\npublic interface Calculator {\n    double ofShape(Triangle triangle);\n    double ofShape(Circle circle);\n    double ofShape(Square square);\n}\n```\n\nPerimeter.java（各种形状周长策略的打包）\n\n```java\npublic class Perimeter implements Calculator {\n    public double ofShape(Triangle triangle) {\n        return triangle.getEdgeA() + triangle.getEdgeB() + triangle.getEdgeC();\n    }\n\n    public double ofShape(Circle circle) {\n        return circle.getRadius() * Math.PI * 2;\n    }\n\n    public double ofShape(Square square) {\n        return square.getEdge() * 4;\n    }\n}\n```\n\nArea.java（各种形状面积策略的打包）\n\n```java\npublic class Area implements Calculator {\n    public double ofShape(Triangle triangle) {\n        double a = triangle.getEdgeA(), b = triangle.getEdgeB(), c = triangle.getEdgeC();\n        double p = (a + b + c) / 2;\n        return Math.sqrt(p * (p - a) *  (p - b) * (p - c));\n    }\n\n    public double ofShape(Circle circle) {\n        return Math.PI * circle.getRadius() * circle.getRadius();\n    }\n\n    public double ofShape(Square square) {\n        return Math.pow(square.getEdge(), 2);\n    }\n}\n```\n\n两种策略的打包都实现自`Calculator`接口，以后还有啥计算需求，起个类实现这个接口就可以了。\n\n那对于各个形状，刚才的代码也要稍微调整一下：\n\nShape.java\n\n```java\npublic interface Shape {\n    // double getPerimeter();\n    // 对于不同的计算策略来者不拒\n    double accept(Calculator calculator);\n}\n```\n\nTriangle.java（三个属性：三条边的长度）\n\n~~~java\npublic class Triangle implements Shape {\n    private double edgeA;\n    private double edgeB;\n    private double edgeC;\n\n    public Triangle(double edgeA, double edgeB, double edgeC) {\n        this.edgeA = edgeA;\n        this.edgeB = edgeB;\n        this.edgeC = edgeC;\n    }\n    // 方法接受策略对象为参数，方法内将自身作为参数再传给策略的方法\n    public double accept(Calculator calculator) {\n        return calculator.ofShape(this);\n    }\n}\n~~~\n\n在`accept`方法中，接受策略对象为参数，方法内将自身作为参数再传给策略的具体方法，这种方式叫做“双重分派”，高大上的名字往往不好记也不好理解，哈哈，其实不记也罢，通过这种巧妙的回调方式实现不同策略对不同类型对象的计算任务。\n\n我们再测试一下：\n\nClient.java\n\n~~~java\npublic class Client {\n    public static void main(String[] args) {\n        // 一个含有5个元素的List，包含三种不同的形状\n        List<Shape> shapes = new ArrayList<Shape>();\n        shapes.add(new Triangle(1.3, 2.2, 3.1));\n        shapes.add(new Circle(1.2));\n        shapes.add(new Triangle(2.4, 3.3, 4.2));\n        shapes.add(new Rectangle(2.1, 3.2));\n        shapes.add(new Circle(5.6));\n\n        // 计算周长和面积的不同策略（访问者）\n        Perimeter perimeter = new Perimeter();\n        Area area = new Area();\n\n        // 将周长和面积的计算策略传入（接受不同访问者的访问）\n        for (Shape shape : shapes) {\n            System.out.printf(\"周长 : %5.2f\\t 面积 : %5.2f\\n\", shape.accept(perimeter), shape.accept(area));\n        }\n    }\n}\n~~~\n\n将不同的策略对象传递给各个元素，从而对不同类型的元素进行不同策略的计算。是不是感觉代码优雅了不少呢^_^\n\n测试结果：\n\n~~~\n周长 :  6.60\t 面积 :  1.20\n周长 :  7.54\t 面积 :  4.52\n周长 :  9.90\t 面积 :  3.95\n周长 : 10.60\t 面积 :  6.72\n周长 : 35.19\t 面积 : 98.52\n~~~\n\n# 总结\n\n上边的例子就是应用了访问者模式。为啥叫访问者模式呢？\n\n其实例子中的策略就相当于依次访问各个元素的访问者，每个元素可以接受(`accept`)不同访问者作为参数，从而交由访问者做出不同的操作。\n\n我们也可以看出访问者模式的应用场景具有如下特点：\n\n- 通常用于处理数据结构中不同类型元素的遍历处理问题。这里所说的数据结构比如例子中的列表，或者数组、Map、Stack、Set，甚至复杂的树，重点不在于数据结构，而在于不同类型的元素放到一起，要“因材施教”。\n- 即使对于每种类型的元素，也有不同的“访问方式”，将不同的“访问方式”作为不同的对象传递给元素。“访问者”相当于对各种类型的元素的同一种“访问方式”的打包。\n- 使用到了双重分派，在`accept`方法中，接受策略对象为参数，方法内将自身作为参数再传给策略的具体方法。\n\n所以，这是一个 `m x n` 的问题，多种元素对应多种“访问方式”。\n","slug":"design-pattern/访问者模式","published":1,"date":"2022-04-20T12:41:20.960Z","updated":"2022-05-04T03:00:51.289Z","_id":"cl2qzfthb001c13nobb2sgl2a","comments":1,"layout":"post","photos":[],"link":"","content":"<p>在访问者模式（Visitor Pattern）中，通过一个访问者类，来封装对数据结构中不同类型元素的执行算法。通过这种方式，元素的执行算法可以随着访问者改变而改变。这种类型的设计模式属于行为型模式。</p>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>我们假设有一些形状，包括三角形、矩形和圆形这三种不同的几何形状。我们知道不同的形状其参数是不同的：</p>\n<ul>\n<li>三角形：三条边的长度确定一个三角形；</li>\n<li>矩形：长和宽确定一个矩形；</li>\n<li>圆形就一个参数——半径。</li>\n</ul>\n<p>那么任务来了，我们把一系列类型和参数不同的形状用<code>ArrayList</code>来管理，然后依次遍历，并计算出它们的周长。</p>\n<h2 id=\"一种计算任务\"><a href=\"#一种计算任务\" class=\"headerlink\" title=\"一种计算任务\"></a>一种计算任务</h2><p>这个任务非常简单，由于用<code>ArrayList</code>来管理，因此需要各个不同形状抽象出统一的接口<code>Shape</code>。这个接口定义一个共同的方法<code>getPerimeter</code>，然后这三种形状都实现这个方法就OK了嘛。其代码如下：</p>\n<p>Shape.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">getPerimeter</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Triangle.java（三个属性：三条边的长度）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Triangle</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeA;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeB;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeC;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Triangle</span><span class=\"params\">(<span class=\"type\">double</span> edgeA, <span class=\"type\">double</span> edgeB, <span class=\"type\">double</span> edgeC)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeA = edgeA;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeB = edgeB;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeC = edgeC;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 省略 getter setter</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">getPerimeter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> edgeA + edgeB + edgeC;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Rectangle.java（两个属性：长和宽）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Rectangle</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> length;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> width;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Rectangle</span><span class=\"params\">(<span class=\"type\">double</span> length, <span class=\"type\">double</span> width)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.length = length;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.width = width;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">// 省略 getter setter</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">getPerimeter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (length + width) * <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Circle.java（一个属性：半径）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Circle</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> radius;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Circle</span><span class=\"params\">(<span class=\"type\">double</span> radius)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.radius = radius;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 省略 getter setter</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">getPerimeter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">2</span> * Math.PI * radius;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>齐活儿~ 写个<code>Client</code>交卷了：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Client</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        List&lt;Shape&gt; shapes = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;Shape&gt;();</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Triangle</span>(<span class=\"number\">1.3</span>, <span class=\"number\">2.2</span>, <span class=\"number\">3.1</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Circle</span>(<span class=\"number\">1.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Triangle</span>(<span class=\"number\">2.4</span>, <span class=\"number\">3.3</span>, <span class=\"number\">4.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Ractangle</span>(<span class=\"number\">2.1</span>, <span class=\"number\">3.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Circle</span>(<span class=\"number\">5.6</span>));</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Shape shape : shapes) &#123;</span><br><span class=\"line\">            System.out.println(shape.getPerimeter());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这是面向接口编程的最基本用法了吧。不过别忙着高兴，如果这个时候再加一个任务——“求面积”呢？那就在接口里再增加一个<code>getArea</code>方法，然后所有的形状都实现了呗~</p>\n<p>好吧，也可以，不过任务还远没有结束，如果还要算出能够包住每个形状的最小的圆的直径呢？以及能够置于形状内的最大的圆的直径呢？等等等等。。。</p>\n<p>每次提出新的计算任务后，频繁修改接口及其实现类，这显然是不符合“开闭”原则的，而且明显也是不优雅的。况且，天知道将来还会需要计算什么幺蛾子！</p>\n<h2 id=\"多种计算任务，策略模式\"><a href=\"#多种计算任务，策略模式\" class=\"headerlink\" title=\"多种计算任务，策略模式\"></a>多种计算任务，策略模式</h2><p>必须要调整一下设计思路以满足灵活性。</p>\n<p>我们曾经遇到过对于同一个对象进行不同运算的设计——比如策略模式，无论是计算周长、面积都是不同的策略，我们将不同的策略作为对象传递给形状，就可以得到该策略相应的结果。比如对于矩形：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 对于矩形，在Rectangle.java</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">accept</span><span class=\"params\">(Strategy strategy)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> strategy.calculate(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 所有的策略都实现统一的接口 Strategy</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Strategy</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">calculate</span><span class=\"params\">(Rectangle rect)</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对于计算周长的策略，在PerimeterStrategy.java</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PerimeterStrategy</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Strategy</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">calculate</span><span class=\"params\">(Rectangle rect)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">2</span> * (rect.getLength() + rect.getWidth());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对于计算面积的策略，在AreaStrategy.java</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AreaStrategy</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Strategy</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">calculate</span><span class=\"params\">(Rectangle rect)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> rect.getLength() * rect.getWidth();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"不同类型对象的多种计算任务，访问者模式\"><a href=\"#不同类型对象的多种计算任务，访问者模式\" class=\"headerlink\" title=\"不同类型对象的多种计算任务，访问者模式\"></a>不同类型对象的多种计算任务，访问者模式</h2><p>上边的例子是针对矩形的，那么三角形和圆形也都实现相应的策略类的话，类的数量就很快增长起来了，似乎也不优雅嘛！ 其实很简单，因为无论是周长策略还是面积策略，各个形状都要实现，那对于同一种策略打个包不就OK了吗：</p>\n<p>Calculator.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Calculator</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Triangle triangle)</span>;</span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Circle circle)</span>;</span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Square square)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Perimeter.java（各种形状周长策略的打包）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Perimeter</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Calculator</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Triangle triangle)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> triangle.getEdgeA() + triangle.getEdgeB() + triangle.getEdgeC();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Circle circle)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> circle.getRadius() * Math.PI * <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Square square)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> square.getEdge() * <span class=\"number\">4</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Area.java（各种形状面积策略的打包）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Area</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Calculator</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Triangle triangle)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">double</span> <span class=\"variable\">a</span> <span class=\"operator\">=</span> triangle.getEdgeA(), b = triangle.getEdgeB(), c = triangle.getEdgeC();</span><br><span class=\"line\">        <span class=\"type\">double</span> <span class=\"variable\">p</span> <span class=\"operator\">=</span> (a + b + c) / <span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Math.sqrt(p * (p - a) *  (p - b) * (p - c));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Circle circle)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Math.PI * circle.getRadius() * circle.getRadius();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Square square)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Math.pow(square.getEdge(), <span class=\"number\">2</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>两种策略的打包都实现自<code>Calculator</code>接口，以后还有啥计算需求，起个类实现这个接口就可以了。</p>\n<p>那对于各个形状，刚才的代码也要稍微调整一下：</p>\n<p>Shape.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// double getPerimeter();</span></span><br><span class=\"line\">    <span class=\"comment\">// 对于不同的计算策略来者不拒</span></span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">accept</span><span class=\"params\">(Calculator calculator)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Triangle.java（三个属性：三条边的长度）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Triangle</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeA;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeB;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeC;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Triangle</span><span class=\"params\">(<span class=\"type\">double</span> edgeA, <span class=\"type\">double</span> edgeB, <span class=\"type\">double</span> edgeC)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeA = edgeA;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeB = edgeB;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeC = edgeC;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 方法接受策略对象为参数，方法内将自身作为参数再传给策略的方法</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">accept</span><span class=\"params\">(Calculator calculator)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> calculator.ofShape(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在<code>accept</code>方法中，接受策略对象为参数，方法内将自身作为参数再传给策略的具体方法，这种方式叫做“双重分派”，高大上的名字往往不好记也不好理解，哈哈，其实不记也罢，通过这种巧妙的回调方式实现不同策略对不同类型对象的计算任务。</p>\n<p>我们再测试一下：</p>\n<p>Client.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Client</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 一个含有5个元素的List，包含三种不同的形状</span></span><br><span class=\"line\">        List&lt;Shape&gt; shapes = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;Shape&gt;();</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Triangle</span>(<span class=\"number\">1.3</span>, <span class=\"number\">2.2</span>, <span class=\"number\">3.1</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Circle</span>(<span class=\"number\">1.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Triangle</span>(<span class=\"number\">2.4</span>, <span class=\"number\">3.3</span>, <span class=\"number\">4.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Rectangle</span>(<span class=\"number\">2.1</span>, <span class=\"number\">3.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Circle</span>(<span class=\"number\">5.6</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 计算周长和面积的不同策略（访问者）</span></span><br><span class=\"line\">        <span class=\"type\">Perimeter</span> <span class=\"variable\">perimeter</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Perimeter</span>();</span><br><span class=\"line\">        <span class=\"type\">Area</span> <span class=\"variable\">area</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Area</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 将周长和面积的计算策略传入（接受不同访问者的访问）</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Shape shape : shapes) &#123;</span><br><span class=\"line\">            System.out.printf(<span class=\"string\">&quot;周长 : %5.2f\\t 面积 : %5.2f\\n&quot;</span>, shape.accept(perimeter), shape.accept(area));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将不同的策略对象传递给各个元素，从而对不同类型的元素进行不同策略的计算。是不是感觉代码优雅了不少呢^_^</p>\n<p>测试结果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">周长 :  6.60\t 面积 :  1.20</span><br><span class=\"line\">周长 :  7.54\t 面积 :  4.52</span><br><span class=\"line\">周长 :  9.90\t 面积 :  3.95</span><br><span class=\"line\">周长 : 10.60\t 面积 :  6.72</span><br><span class=\"line\">周长 : 35.19\t 面积 : 98.52</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>上边的例子就是应用了访问者模式。为啥叫访问者模式呢？</p>\n<p>其实例子中的策略就相当于依次访问各个元素的访问者，每个元素可以接受(<code>accept</code>)不同访问者作为参数，从而交由访问者做出不同的操作。</p>\n<p>我们也可以看出访问者模式的应用场景具有如下特点：</p>\n<ul>\n<li>通常用于处理数据结构中不同类型元素的遍历处理问题。这里所说的数据结构比如例子中的列表，或者数组、Map、Stack、Set，甚至复杂的树，重点不在于数据结构，而在于不同类型的元素放到一起，要“因材施教”。</li>\n<li>即使对于每种类型的元素，也有不同的“访问方式”，将不同的“访问方式”作为不同的对象传递给元素。“访问者”相当于对各种类型的元素的同一种“访问方式”的打包。</li>\n<li>使用到了双重分派，在<code>accept</code>方法中，接受策略对象为参数，方法内将自身作为参数再传给策略的具体方法。</li>\n</ul>\n<p>所以，这是一个 <code>m x n</code> 的问题，多种元素对应多种“访问方式”。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>在访问者模式（Visitor Pattern）中，通过一个访问者类，来封装对数据结构中不同类型元素的执行算法。通过这种方式，元素的执行算法可以随着访问者改变而改变。这种类型的设计模式属于行为型模式。</p>\n<h1 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h1><p>我们假设有一些形状，包括三角形、矩形和圆形这三种不同的几何形状。我们知道不同的形状其参数是不同的：</p>\n<ul>\n<li>三角形：三条边的长度确定一个三角形；</li>\n<li>矩形：长和宽确定一个矩形；</li>\n<li>圆形就一个参数——半径。</li>\n</ul>\n<p>那么任务来了，我们把一系列类型和参数不同的形状用<code>ArrayList</code>来管理，然后依次遍历，并计算出它们的周长。</p>\n<h2 id=\"一种计算任务\"><a href=\"#一种计算任务\" class=\"headerlink\" title=\"一种计算任务\"></a>一种计算任务</h2><p>这个任务非常简单，由于用<code>ArrayList</code>来管理，因此需要各个不同形状抽象出统一的接口<code>Shape</code>。这个接口定义一个共同的方法<code>getPerimeter</code>，然后这三种形状都实现这个方法就OK了嘛。其代码如下：</p>\n<p>Shape.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">getPerimeter</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Triangle.java（三个属性：三条边的长度）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Triangle</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeA;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeB;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeC;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Triangle</span><span class=\"params\">(<span class=\"type\">double</span> edgeA, <span class=\"type\">double</span> edgeB, <span class=\"type\">double</span> edgeC)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeA = edgeA;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeB = edgeB;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeC = edgeC;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 省略 getter setter</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">getPerimeter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> edgeA + edgeB + edgeC;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Rectangle.java（两个属性：长和宽）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Rectangle</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> length;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> width;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Rectangle</span><span class=\"params\">(<span class=\"type\">double</span> length, <span class=\"type\">double</span> width)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.length = length;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.width = width;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">    <span class=\"comment\">// 省略 getter setter</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">getPerimeter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (length + width) * <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Circle.java（一个属性：半径）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Circle</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> radius;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Circle</span><span class=\"params\">(<span class=\"type\">double</span> radius)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.radius = radius;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 省略 getter setter</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">getPerimeter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">2</span> * Math.PI * radius;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>齐活儿~ 写个<code>Client</code>交卷了：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Client</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        List&lt;Shape&gt; shapes = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;Shape&gt;();</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Triangle</span>(<span class=\"number\">1.3</span>, <span class=\"number\">2.2</span>, <span class=\"number\">3.1</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Circle</span>(<span class=\"number\">1.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Triangle</span>(<span class=\"number\">2.4</span>, <span class=\"number\">3.3</span>, <span class=\"number\">4.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Ractangle</span>(<span class=\"number\">2.1</span>, <span class=\"number\">3.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Circle</span>(<span class=\"number\">5.6</span>));</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Shape shape : shapes) &#123;</span><br><span class=\"line\">            System.out.println(shape.getPerimeter());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这是面向接口编程的最基本用法了吧。不过别忙着高兴，如果这个时候再加一个任务——“求面积”呢？那就在接口里再增加一个<code>getArea</code>方法，然后所有的形状都实现了呗~</p>\n<p>好吧，也可以，不过任务还远没有结束，如果还要算出能够包住每个形状的最小的圆的直径呢？以及能够置于形状内的最大的圆的直径呢？等等等等。。。</p>\n<p>每次提出新的计算任务后，频繁修改接口及其实现类，这显然是不符合“开闭”原则的，而且明显也是不优雅的。况且，天知道将来还会需要计算什么幺蛾子！</p>\n<h2 id=\"多种计算任务，策略模式\"><a href=\"#多种计算任务，策略模式\" class=\"headerlink\" title=\"多种计算任务，策略模式\"></a>多种计算任务，策略模式</h2><p>必须要调整一下设计思路以满足灵活性。</p>\n<p>我们曾经遇到过对于同一个对象进行不同运算的设计——比如策略模式，无论是计算周长、面积都是不同的策略，我们将不同的策略作为对象传递给形状，就可以得到该策略相应的结果。比如对于矩形：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 对于矩形，在Rectangle.java</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">accept</span><span class=\"params\">(Strategy strategy)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> strategy.calculate(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 所有的策略都实现统一的接口 Strategy</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Strategy</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">calculate</span><span class=\"params\">(Rectangle rect)</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对于计算周长的策略，在PerimeterStrategy.java</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">PerimeterStrategy</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Strategy</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">calculate</span><span class=\"params\">(Rectangle rect)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">2</span> * (rect.getLength() + rect.getWidth());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对于计算面积的策略，在AreaStrategy.java</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AreaStrategy</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Strategy</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">calculate</span><span class=\"params\">(Rectangle rect)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> rect.getLength() * rect.getWidth();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"不同类型对象的多种计算任务，访问者模式\"><a href=\"#不同类型对象的多种计算任务，访问者模式\" class=\"headerlink\" title=\"不同类型对象的多种计算任务，访问者模式\"></a>不同类型对象的多种计算任务，访问者模式</h2><p>上边的例子是针对矩形的，那么三角形和圆形也都实现相应的策略类的话，类的数量就很快增长起来了，似乎也不优雅嘛！ 其实很简单，因为无论是周长策略还是面积策略，各个形状都要实现，那对于同一种策略打个包不就OK了吗：</p>\n<p>Calculator.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Calculator</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Triangle triangle)</span>;</span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Circle circle)</span>;</span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Square square)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Perimeter.java（各种形状周长策略的打包）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Perimeter</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Calculator</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Triangle triangle)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> triangle.getEdgeA() + triangle.getEdgeB() + triangle.getEdgeC();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Circle circle)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> circle.getRadius() * Math.PI * <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Square square)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> square.getEdge() * <span class=\"number\">4</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Area.java（各种形状面积策略的打包）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Area</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Calculator</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Triangle triangle)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">double</span> <span class=\"variable\">a</span> <span class=\"operator\">=</span> triangle.getEdgeA(), b = triangle.getEdgeB(), c = triangle.getEdgeC();</span><br><span class=\"line\">        <span class=\"type\">double</span> <span class=\"variable\">p</span> <span class=\"operator\">=</span> (a + b + c) / <span class=\"number\">2</span>;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Math.sqrt(p * (p - a) *  (p - b) * (p - c));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Circle circle)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Math.PI * circle.getRadius() * circle.getRadius();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">ofShape</span><span class=\"params\">(Square square)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Math.pow(square.getEdge(), <span class=\"number\">2</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>两种策略的打包都实现自<code>Calculator</code>接口，以后还有啥计算需求，起个类实现这个接口就可以了。</p>\n<p>那对于各个形状，刚才的代码也要稍微调整一下：</p>\n<p>Shape.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// double getPerimeter();</span></span><br><span class=\"line\">    <span class=\"comment\">// 对于不同的计算策略来者不拒</span></span><br><span class=\"line\">    <span class=\"type\">double</span> <span class=\"title function_\">accept</span><span class=\"params\">(Calculator calculator)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Triangle.java（三个属性：三条边的长度）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Triangle</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Shape</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeA;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeB;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">double</span> edgeC;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Triangle</span><span class=\"params\">(<span class=\"type\">double</span> edgeA, <span class=\"type\">double</span> edgeB, <span class=\"type\">double</span> edgeC)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeA = edgeA;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeB = edgeB;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.edgeC = edgeC;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 方法接受策略对象为参数，方法内将自身作为参数再传给策略的方法</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">accept</span><span class=\"params\">(Calculator calculator)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> calculator.ofShape(<span class=\"built_in\">this</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在<code>accept</code>方法中，接受策略对象为参数，方法内将自身作为参数再传给策略的具体方法，这种方式叫做“双重分派”，高大上的名字往往不好记也不好理解，哈哈，其实不记也罢，通过这种巧妙的回调方式实现不同策略对不同类型对象的计算任务。</p>\n<p>我们再测试一下：</p>\n<p>Client.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Client</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 一个含有5个元素的List，包含三种不同的形状</span></span><br><span class=\"line\">        List&lt;Shape&gt; shapes = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;Shape&gt;();</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Triangle</span>(<span class=\"number\">1.3</span>, <span class=\"number\">2.2</span>, <span class=\"number\">3.1</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Circle</span>(<span class=\"number\">1.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Triangle</span>(<span class=\"number\">2.4</span>, <span class=\"number\">3.3</span>, <span class=\"number\">4.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Rectangle</span>(<span class=\"number\">2.1</span>, <span class=\"number\">3.2</span>));</span><br><span class=\"line\">        shapes.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Circle</span>(<span class=\"number\">5.6</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 计算周长和面积的不同策略（访问者）</span></span><br><span class=\"line\">        <span class=\"type\">Perimeter</span> <span class=\"variable\">perimeter</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Perimeter</span>();</span><br><span class=\"line\">        <span class=\"type\">Area</span> <span class=\"variable\">area</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Area</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 将周长和面积的计算策略传入（接受不同访问者的访问）</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (Shape shape : shapes) &#123;</span><br><span class=\"line\">            System.out.printf(<span class=\"string\">&quot;周长 : %5.2f\\t 面积 : %5.2f\\n&quot;</span>, shape.accept(perimeter), shape.accept(area));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>将不同的策略对象传递给各个元素，从而对不同类型的元素进行不同策略的计算。是不是感觉代码优雅了不少呢^_^</p>\n<p>测试结果：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">周长 :  6.60\t 面积 :  1.20</span><br><span class=\"line\">周长 :  7.54\t 面积 :  4.52</span><br><span class=\"line\">周长 :  9.90\t 面积 :  3.95</span><br><span class=\"line\">周长 : 10.60\t 面积 :  6.72</span><br><span class=\"line\">周长 : 35.19\t 面积 : 98.52</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><p>上边的例子就是应用了访问者模式。为啥叫访问者模式呢？</p>\n<p>其实例子中的策略就相当于依次访问各个元素的访问者，每个元素可以接受(<code>accept</code>)不同访问者作为参数，从而交由访问者做出不同的操作。</p>\n<p>我们也可以看出访问者模式的应用场景具有如下特点：</p>\n<ul>\n<li>通常用于处理数据结构中不同类型元素的遍历处理问题。这里所说的数据结构比如例子中的列表，或者数组、Map、Stack、Set，甚至复杂的树，重点不在于数据结构，而在于不同类型的元素放到一起，要“因材施教”。</li>\n<li>即使对于每种类型的元素，也有不同的“访问方式”，将不同的“访问方式”作为不同的对象传递给元素。“访问者”相当于对各种类型的元素的同一种“访问方式”的打包。</li>\n<li>使用到了双重分派，在<code>accept</code>方法中，接受策略对象为参数，方法内将自身作为参数再传给策略的具体方法。</li>\n</ul>\n<p>所以，这是一个 <code>m x n</code> 的问题，多种元素对应多种“访问方式”。</p>\n"},{"uuid":"bbaef9f4-c0ab-11ec-92a1-7557b2313227","title":"Docker 命令大全","abbrlink":"2bb85992","date":"2022-03-19T07:03:50.000Z","_content":"\n# Docker 命令大全\n\n[菜鸟教程链接](https://www.runoob.com/docker/docker-command-manual.html)\n\ncnblog最佳实践：\n\n> https://www.cnblogs.com/aaronlinv/p/15130730.html\n\n### 容器生命周期管理\n\n- [run](https://www.runoob.com/docker/docker-run-command.html)\n- [start/stop/restart](https://www.runoob.com/docker/docker-start-stop-restart-command.html)\n- [kill](https://www.runoob.com/docker/docker-kill-command.html)\n- [rm](https://www.runoob.com/docker/docker-rm-command.html)\n- [pause/unpause](https://www.runoob.com/docker/docker-pause-unpause-command.html)\n- [create](https://www.runoob.com/docker/docker-create-command.html)\n- [exec](https://www.runoob.com/docker/docker-exec-command.html)\n\n### 容器操作\n\n- [ps](https://www.runoob.com/docker/docker-ps-command.html)\n- [inspect](https://www.runoob.com/docker/docker-inspect-command.html)\n- [top](https://www.runoob.com/docker/docker-top-command.html)\n- [attach](https://www.runoob.com/docker/docker-attach-command.html)\n- [events](https://www.runoob.com/docker/docker-events-command.html)\n- [logs](https://www.runoob.com/docker/docker-logs-command.html)\n- [wait](https://www.runoob.com/docker/docker-wait-command.html)\n- [export](https://www.runoob.com/docker/docker-export-command.html)\n- [port](https://www.runoob.com/docker/docker-port-command.html)\n\n### 容器rootfs命令\n\n- [commit](https://www.runoob.com/docker/docker-commit-command.html)\n- [cp](https://www.runoob.com/docker/docker-cp-command.html)\n- [diff](https://www.runoob.com/docker/docker-diff-command.html)\n\n### 镜像仓库\n\n- [login](https://www.runoob.com/docker/docker-login-command.html)\n- [pull](https://www.runoob.com/docker/docker-pull-command.html)\n- [push](https://www.runoob.com/docker/docker-push-command.html)\n- [search](https://www.runoob.com/docker/docker-search-command.html)\n\n### 本地镜像管理\n\n- [images](https://www.runoob.com/docker/docker-images-command.html)\n- [rmi](https://www.runoob.com/docker/docker-rmi-command.html)\n- [tag](https://www.runoob.com/docker/docker-tag-command.html)\n- [build](https://www.runoob.com/docker/docker-build-command.html)\n- [history](https://www.runoob.com/docker/docker-history-command.html)\n- [save](https://www.runoob.com/docker/docker-save-command.html)\n- [load](https://www.runoob.com/docker/docker-load-command.html)\n- [import](https://www.runoob.com/docker/docker-import-command.html)\n\n### info|version\n\n- [info](https://www.runoob.com/docker/docker-info-command.html)\n- [version](https://www.runoob.com/docker/docker-version-command.html)\n\n","source":"_posts/docker/docker-commands.md","raw":"---\nuuid: bbaef9f4-c0ab-11ec-92a1-7557b2313227\ntitle: Docker 命令大全\ntags: Docker\ncategories: Docker\nabbrlink: 2bb85992\ndate: 2022-03-19 15:03:50\n---\n\n# Docker 命令大全\n\n[菜鸟教程链接](https://www.runoob.com/docker/docker-command-manual.html)\n\ncnblog最佳实践：\n\n> https://www.cnblogs.com/aaronlinv/p/15130730.html\n\n### 容器生命周期管理\n\n- [run](https://www.runoob.com/docker/docker-run-command.html)\n- [start/stop/restart](https://www.runoob.com/docker/docker-start-stop-restart-command.html)\n- [kill](https://www.runoob.com/docker/docker-kill-command.html)\n- [rm](https://www.runoob.com/docker/docker-rm-command.html)\n- [pause/unpause](https://www.runoob.com/docker/docker-pause-unpause-command.html)\n- [create](https://www.runoob.com/docker/docker-create-command.html)\n- [exec](https://www.runoob.com/docker/docker-exec-command.html)\n\n### 容器操作\n\n- [ps](https://www.runoob.com/docker/docker-ps-command.html)\n- [inspect](https://www.runoob.com/docker/docker-inspect-command.html)\n- [top](https://www.runoob.com/docker/docker-top-command.html)\n- [attach](https://www.runoob.com/docker/docker-attach-command.html)\n- [events](https://www.runoob.com/docker/docker-events-command.html)\n- [logs](https://www.runoob.com/docker/docker-logs-command.html)\n- [wait](https://www.runoob.com/docker/docker-wait-command.html)\n- [export](https://www.runoob.com/docker/docker-export-command.html)\n- [port](https://www.runoob.com/docker/docker-port-command.html)\n\n### 容器rootfs命令\n\n- [commit](https://www.runoob.com/docker/docker-commit-command.html)\n- [cp](https://www.runoob.com/docker/docker-cp-command.html)\n- [diff](https://www.runoob.com/docker/docker-diff-command.html)\n\n### 镜像仓库\n\n- [login](https://www.runoob.com/docker/docker-login-command.html)\n- [pull](https://www.runoob.com/docker/docker-pull-command.html)\n- [push](https://www.runoob.com/docker/docker-push-command.html)\n- [search](https://www.runoob.com/docker/docker-search-command.html)\n\n### 本地镜像管理\n\n- [images](https://www.runoob.com/docker/docker-images-command.html)\n- [rmi](https://www.runoob.com/docker/docker-rmi-command.html)\n- [tag](https://www.runoob.com/docker/docker-tag-command.html)\n- [build](https://www.runoob.com/docker/docker-build-command.html)\n- [history](https://www.runoob.com/docker/docker-history-command.html)\n- [save](https://www.runoob.com/docker/docker-save-command.html)\n- [load](https://www.runoob.com/docker/docker-load-command.html)\n- [import](https://www.runoob.com/docker/docker-import-command.html)\n\n### info|version\n\n- [info](https://www.runoob.com/docker/docker-info-command.html)\n- [version](https://www.runoob.com/docker/docker-version-command.html)\n\n","slug":"docker/docker-commands","published":1,"updated":"2022-05-04T03:01:52.435Z","_id":"cl2qzfthc001g13no1q5w3jmn","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Docker-命令大全\"><a href=\"#Docker-命令大全\" class=\"headerlink\" title=\"Docker 命令大全\"></a>Docker 命令大全</h1><p><a href=\"https://www.runoob.com/docker/docker-command-manual.html\">菜鸟教程链接</a></p>\n<p>cnblog最佳实践：</p>\n<blockquote>\n<p><a href=\"https://www.cnblogs.com/aaronlinv/p/15130730.html\">https://www.cnblogs.com/aaronlinv/p/15130730.html</a></p>\n</blockquote>\n<h3 id=\"容器生命周期管理\"><a href=\"#容器生命周期管理\" class=\"headerlink\" title=\"容器生命周期管理\"></a>容器生命周期管理</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-run-command.html\">run</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-start-stop-restart-command.html\">start/stop/restart</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-kill-command.html\">kill</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-rm-command.html\">rm</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-pause-unpause-command.html\">pause/unpause</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-create-command.html\">create</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-exec-command.html\">exec</a></li>\n</ul>\n<h3 id=\"容器操作\"><a href=\"#容器操作\" class=\"headerlink\" title=\"容器操作\"></a>容器操作</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-ps-command.html\">ps</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-inspect-command.html\">inspect</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-top-command.html\">top</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-attach-command.html\">attach</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-events-command.html\">events</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-logs-command.html\">logs</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-wait-command.html\">wait</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-export-command.html\">export</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-port-command.html\">port</a></li>\n</ul>\n<h3 id=\"容器rootfs命令\"><a href=\"#容器rootfs命令\" class=\"headerlink\" title=\"容器rootfs命令\"></a>容器rootfs命令</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-commit-command.html\">commit</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-cp-command.html\">cp</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-diff-command.html\">diff</a></li>\n</ul>\n<h3 id=\"镜像仓库\"><a href=\"#镜像仓库\" class=\"headerlink\" title=\"镜像仓库\"></a>镜像仓库</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-login-command.html\">login</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-pull-command.html\">pull</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-push-command.html\">push</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-search-command.html\">search</a></li>\n</ul>\n<h3 id=\"本地镜像管理\"><a href=\"#本地镜像管理\" class=\"headerlink\" title=\"本地镜像管理\"></a>本地镜像管理</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-images-command.html\">images</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-rmi-command.html\">rmi</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-tag-command.html\">tag</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-build-command.html\">build</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-history-command.html\">history</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-save-command.html\">save</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-load-command.html\">load</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-import-command.html\">import</a></li>\n</ul>\n<h3 id=\"info-version\"><a href=\"#info-version\" class=\"headerlink\" title=\"info|version\"></a>info|version</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-info-command.html\">info</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-version-command.html\">version</a></li>\n</ul>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Docker-命令大全\"><a href=\"#Docker-命令大全\" class=\"headerlink\" title=\"Docker 命令大全\"></a>Docker 命令大全</h1><p><a href=\"https://www.runoob.com/docker/docker-command-manual.html\">菜鸟教程链接</a></p>\n<p>cnblog最佳实践：</p>\n<blockquote>\n<p><a href=\"https://www.cnblogs.com/aaronlinv/p/15130730.html\">https://www.cnblogs.com/aaronlinv/p/15130730.html</a></p>\n</blockquote>\n<h3 id=\"容器生命周期管理\"><a href=\"#容器生命周期管理\" class=\"headerlink\" title=\"容器生命周期管理\"></a>容器生命周期管理</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-run-command.html\">run</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-start-stop-restart-command.html\">start/stop/restart</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-kill-command.html\">kill</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-rm-command.html\">rm</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-pause-unpause-command.html\">pause/unpause</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-create-command.html\">create</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-exec-command.html\">exec</a></li>\n</ul>\n<h3 id=\"容器操作\"><a href=\"#容器操作\" class=\"headerlink\" title=\"容器操作\"></a>容器操作</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-ps-command.html\">ps</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-inspect-command.html\">inspect</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-top-command.html\">top</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-attach-command.html\">attach</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-events-command.html\">events</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-logs-command.html\">logs</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-wait-command.html\">wait</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-export-command.html\">export</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-port-command.html\">port</a></li>\n</ul>\n<h3 id=\"容器rootfs命令\"><a href=\"#容器rootfs命令\" class=\"headerlink\" title=\"容器rootfs命令\"></a>容器rootfs命令</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-commit-command.html\">commit</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-cp-command.html\">cp</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-diff-command.html\">diff</a></li>\n</ul>\n<h3 id=\"镜像仓库\"><a href=\"#镜像仓库\" class=\"headerlink\" title=\"镜像仓库\"></a>镜像仓库</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-login-command.html\">login</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-pull-command.html\">pull</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-push-command.html\">push</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-search-command.html\">search</a></li>\n</ul>\n<h3 id=\"本地镜像管理\"><a href=\"#本地镜像管理\" class=\"headerlink\" title=\"本地镜像管理\"></a>本地镜像管理</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-images-command.html\">images</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-rmi-command.html\">rmi</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-tag-command.html\">tag</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-build-command.html\">build</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-history-command.html\">history</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-save-command.html\">save</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-load-command.html\">load</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-import-command.html\">import</a></li>\n</ul>\n<h3 id=\"info-version\"><a href=\"#info-version\" class=\"headerlink\" title=\"info|version\"></a>info|version</h3><ul>\n<li><a href=\"https://www.runoob.com/docker/docker-info-command.html\">info</a></li>\n<li><a href=\"https://www.runoob.com/docker/docker-version-command.html\">version</a></li>\n</ul>\n"},{"uuid":"bbaef9f5-c0ab-11ec-92a1-7557b2313227","title":"Dockerfile常用命令","abbrlink":"1cedfdb9","date":"2022-03-19T07:07:59.000Z","_content":"\n## dockerfile 的命令\n[菜鸟教程链接](https://www.runoob.com/docker/docker-dockerfile.html)\n\n- FROM- 镜像从那里来\n- MAINTAINER- 镜像维护者信息\n- RUN- 构建镜像执行的命令，每一次RUN都会构建一层\n- CMD- 容器启动的命令，如果有多个则以最后一个为准，也可以为ENTRYPOINT提供参数\n- VOLUME- 定义数据卷，如果没有定义则使用默认\n- USER- 指定后续执行的用户组和用户\n- WORKDIR- 切换当前执行的工作目录\n- HEALTHCHECH- 健康检测指令\n- ARG- 变量属性值，但不在容器内部起作用\n- EXPOSE- 暴露端口\n- ENV- 变量属性值，容器内部也会起作用\n- ADD- 添加文件，如果是压缩文件也解压\n- COPY- 添加文件，以复制的形式\n- ENTRYPOINT- 容器进入时执行的命令\n\n### dockerfile实践\n> https://www.cnblogs.com/aaronlinv/p/15213211.html\n\n### docker compose实践\n> https://www.cnblogs.com/aaronlinv/p/15270704.html\n","source":"_posts/docker/dockerfile-commands.md","raw":"---\nuuid: bbaef9f5-c0ab-11ec-92a1-7557b2313227\ntitle: Dockerfile常用命令\ntags:\n  - Dockerfile\ncategories: Docker\nabbrlink: 1cedfdb9\ndate: 2022-03-19 15:07:59\n---\n\n## dockerfile 的命令\n[菜鸟教程链接](https://www.runoob.com/docker/docker-dockerfile.html)\n\n- FROM- 镜像从那里来\n- MAINTAINER- 镜像维护者信息\n- RUN- 构建镜像执行的命令，每一次RUN都会构建一层\n- CMD- 容器启动的命令，如果有多个则以最后一个为准，也可以为ENTRYPOINT提供参数\n- VOLUME- 定义数据卷，如果没有定义则使用默认\n- USER- 指定后续执行的用户组和用户\n- WORKDIR- 切换当前执行的工作目录\n- HEALTHCHECH- 健康检测指令\n- ARG- 变量属性值，但不在容器内部起作用\n- EXPOSE- 暴露端口\n- ENV- 变量属性值，容器内部也会起作用\n- ADD- 添加文件，如果是压缩文件也解压\n- COPY- 添加文件，以复制的形式\n- ENTRYPOINT- 容器进入时执行的命令\n\n### dockerfile实践\n> https://www.cnblogs.com/aaronlinv/p/15213211.html\n\n### docker compose实践\n> https://www.cnblogs.com/aaronlinv/p/15270704.html\n","slug":"docker/dockerfile-commands","published":1,"updated":"2022-05-04T03:02:04.765Z","_id":"cl2qzfthd001i13no2h5yfzgu","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"dockerfile-的命令\"><a href=\"#dockerfile-的命令\" class=\"headerlink\" title=\"dockerfile 的命令\"></a>dockerfile 的命令</h2><p><a href=\"https://www.runoob.com/docker/docker-dockerfile.html\">菜鸟教程链接</a></p>\n<ul>\n<li>FROM- 镜像从那里来</li>\n<li>MAINTAINER- 镜像维护者信息</li>\n<li>RUN- 构建镜像执行的命令，每一次RUN都会构建一层</li>\n<li>CMD- 容器启动的命令，如果有多个则以最后一个为准，也可以为ENTRYPOINT提供参数</li>\n<li>VOLUME- 定义数据卷，如果没有定义则使用默认</li>\n<li>USER- 指定后续执行的用户组和用户</li>\n<li>WORKDIR- 切换当前执行的工作目录</li>\n<li>HEALTHCHECH- 健康检测指令</li>\n<li>ARG- 变量属性值，但不在容器内部起作用</li>\n<li>EXPOSE- 暴露端口</li>\n<li>ENV- 变量属性值，容器内部也会起作用</li>\n<li>ADD- 添加文件，如果是压缩文件也解压</li>\n<li>COPY- 添加文件，以复制的形式</li>\n<li>ENTRYPOINT- 容器进入时执行的命令</li>\n</ul>\n<h3 id=\"dockerfile实践\"><a href=\"#dockerfile实践\" class=\"headerlink\" title=\"dockerfile实践\"></a>dockerfile实践</h3><blockquote>\n<p><a href=\"https://www.cnblogs.com/aaronlinv/p/15213211.html\">https://www.cnblogs.com/aaronlinv/p/15213211.html</a></p>\n</blockquote>\n<h3 id=\"docker-compose实践\"><a href=\"#docker-compose实践\" class=\"headerlink\" title=\"docker compose实践\"></a>docker compose实践</h3><blockquote>\n<p><a href=\"https://www.cnblogs.com/aaronlinv/p/15270704.html\">https://www.cnblogs.com/aaronlinv/p/15270704.html</a></p>\n</blockquote>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"dockerfile-的命令\"><a href=\"#dockerfile-的命令\" class=\"headerlink\" title=\"dockerfile 的命令\"></a>dockerfile 的命令</h2><p><a href=\"https://www.runoob.com/docker/docker-dockerfile.html\">菜鸟教程链接</a></p>\n<ul>\n<li>FROM- 镜像从那里来</li>\n<li>MAINTAINER- 镜像维护者信息</li>\n<li>RUN- 构建镜像执行的命令，每一次RUN都会构建一层</li>\n<li>CMD- 容器启动的命令，如果有多个则以最后一个为准，也可以为ENTRYPOINT提供参数</li>\n<li>VOLUME- 定义数据卷，如果没有定义则使用默认</li>\n<li>USER- 指定后续执行的用户组和用户</li>\n<li>WORKDIR- 切换当前执行的工作目录</li>\n<li>HEALTHCHECH- 健康检测指令</li>\n<li>ARG- 变量属性值，但不在容器内部起作用</li>\n<li>EXPOSE- 暴露端口</li>\n<li>ENV- 变量属性值，容器内部也会起作用</li>\n<li>ADD- 添加文件，如果是压缩文件也解压</li>\n<li>COPY- 添加文件，以复制的形式</li>\n<li>ENTRYPOINT- 容器进入时执行的命令</li>\n</ul>\n<h3 id=\"dockerfile实践\"><a href=\"#dockerfile实践\" class=\"headerlink\" title=\"dockerfile实践\"></a>dockerfile实践</h3><blockquote>\n<p><a href=\"https://www.cnblogs.com/aaronlinv/p/15213211.html\">https://www.cnblogs.com/aaronlinv/p/15213211.html</a></p>\n</blockquote>\n<h3 id=\"docker-compose实践\"><a href=\"#docker-compose实践\" class=\"headerlink\" title=\"docker compose实践\"></a>docker compose实践</h3><blockquote>\n<p><a href=\"https://www.cnblogs.com/aaronlinv/p/15270704.html\">https://www.cnblogs.com/aaronlinv/p/15270704.html</a></p>\n</blockquote>\n"},{"uuid":"bbaef9f6-c0ab-11ec-92a1-7557b2313227","title":"gauge安装","abbrlink":"331f5a89","_content":"\n## gauge安装\n\n[Gauge](https://docs.gauge.org/overview.html?os=macos&language=python&ide=vscode) is a free and open source framework for writing and running acceptance tests. Some of the key features of Gauge that makes it unique include:\n\n- Simple, flexible and rich syntax based on Markdown.\n- Consistent cross platform/language support for writing test code.\n- A modular architecture with plugins support\n- Extensible through plugins and hackable.\n- Supports data driven execution and external data sources\n- Helps you create maintainable test suites\n- Great support for VS Code\n\nGauge是一种轻量级的跨平台测试自动化工具，可以以业务语言编写测试用例。\n\n本篇环境是以macOs、vscode为基本版本，python作为基本插件\n\n### 1、安装Gauge\n\n~~~\nbrew install gauge\n~~~\n\n~~~\ngauge --version\n\nGauge version: 1.4.1\nPlugins\n-------\nhtml-report (4.1.2)\njs (2.3.17)\npython (0.3.17)\nscreenshot (0.1.0)\n~~~\n\n### 2、安装相关插件\n\n~~~\ngauge install python -f gauge-python.zip\ngauge install html-report -f html-report.zip\ngauge install screenshot -f screenshot.zip\n~~~\n\n可以使用`gauge --help`查看相关命令\n\n### 3、安装python\n\n这里可以自行百度\n\n### 4、安装VScode\n\n安装完VScode之后，在插件栏依次安装如下插件\n\n~~~\npython 插件\ngauge 插件\n~~~\n","source":"_posts/gauge/1.安装.md","raw":"---\nuuid: bbaef9f6-c0ab-11ec-92a1-7557b2313227\ntitle: gauge安装\ntags: gauge\ncategories: BDD\nabbrlink: 331f5a89\n---\n\n## gauge安装\n\n[Gauge](https://docs.gauge.org/overview.html?os=macos&language=python&ide=vscode) is a free and open source framework for writing and running acceptance tests. Some of the key features of Gauge that makes it unique include:\n\n- Simple, flexible and rich syntax based on Markdown.\n- Consistent cross platform/language support for writing test code.\n- A modular architecture with plugins support\n- Extensible through plugins and hackable.\n- Supports data driven execution and external data sources\n- Helps you create maintainable test suites\n- Great support for VS Code\n\nGauge是一种轻量级的跨平台测试自动化工具，可以以业务语言编写测试用例。\n\n本篇环境是以macOs、vscode为基本版本，python作为基本插件\n\n### 1、安装Gauge\n\n~~~\nbrew install gauge\n~~~\n\n~~~\ngauge --version\n\nGauge version: 1.4.1\nPlugins\n-------\nhtml-report (4.1.2)\njs (2.3.17)\npython (0.3.17)\nscreenshot (0.1.0)\n~~~\n\n### 2、安装相关插件\n\n~~~\ngauge install python -f gauge-python.zip\ngauge install html-report -f html-report.zip\ngauge install screenshot -f screenshot.zip\n~~~\n\n可以使用`gauge --help`查看相关命令\n\n### 3、安装python\n\n这里可以自行百度\n\n### 4、安装VScode\n\n安装完VScode之后，在插件栏依次安装如下插件\n\n~~~\npython 插件\ngauge 插件\n~~~\n","slug":"gauge/1.安装","published":1,"date":"2022-04-20T12:41:20.822Z","updated":"2022-05-01T04:13:05.195Z","_id":"cl2qzfthe001l13no4cdohagy","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"gauge安装\"><a href=\"#gauge安装\" class=\"headerlink\" title=\"gauge安装\"></a>gauge安装</h2><p><a href=\"https://docs.gauge.org/overview.html?os=macos&language=python&ide=vscode\">Gauge</a> is a free and open source framework for writing and running acceptance tests. Some of the key features of Gauge that makes it unique include:</p>\n<ul>\n<li>Simple, flexible and rich syntax based on Markdown.</li>\n<li>Consistent cross platform/language support for writing test code.</li>\n<li>A modular architecture with plugins support</li>\n<li>Extensible through plugins and hackable.</li>\n<li>Supports data driven execution and external data sources</li>\n<li>Helps you create maintainable test suites</li>\n<li>Great support for VS Code</li>\n</ul>\n<p>Gauge是一种轻量级的跨平台测试自动化工具，可以以业务语言编写测试用例。</p>\n<p>本篇环境是以macOs、vscode为基本版本，python作为基本插件</p>\n<h3 id=\"1、安装Gauge\"><a href=\"#1、安装Gauge\" class=\"headerlink\" title=\"1、安装Gauge\"></a>1、安装Gauge</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install gauge</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gauge --version</span><br><span class=\"line\"></span><br><span class=\"line\">Gauge version: 1.4.1</span><br><span class=\"line\">Plugins</span><br><span class=\"line\">-------</span><br><span class=\"line\">html-report (4.1.2)</span><br><span class=\"line\">js (2.3.17)</span><br><span class=\"line\">python (0.3.17)</span><br><span class=\"line\">screenshot (0.1.0)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、安装相关插件\"><a href=\"#2、安装相关插件\" class=\"headerlink\" title=\"2、安装相关插件\"></a>2、安装相关插件</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gauge install python -f gauge-python.zip</span><br><span class=\"line\">gauge install html-report -f html-report.zip</span><br><span class=\"line\">gauge install screenshot -f screenshot.zip</span><br></pre></td></tr></table></figure>\n\n<p>可以使用<code>gauge --help</code>查看相关命令</p>\n<h3 id=\"3、安装python\"><a href=\"#3、安装python\" class=\"headerlink\" title=\"3、安装python\"></a>3、安装python</h3><p>这里可以自行百度</p>\n<h3 id=\"4、安装VScode\"><a href=\"#4、安装VScode\" class=\"headerlink\" title=\"4、安装VScode\"></a>4、安装VScode</h3><p>安装完VScode之后，在插件栏依次安装如下插件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python 插件</span><br><span class=\"line\">gauge 插件</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"gauge安装\"><a href=\"#gauge安装\" class=\"headerlink\" title=\"gauge安装\"></a>gauge安装</h2><p><a href=\"https://docs.gauge.org/overview.html?os=macos&language=python&ide=vscode\">Gauge</a> is a free and open source framework for writing and running acceptance tests. Some of the key features of Gauge that makes it unique include:</p>\n<ul>\n<li>Simple, flexible and rich syntax based on Markdown.</li>\n<li>Consistent cross platform/language support for writing test code.</li>\n<li>A modular architecture with plugins support</li>\n<li>Extensible through plugins and hackable.</li>\n<li>Supports data driven execution and external data sources</li>\n<li>Helps you create maintainable test suites</li>\n<li>Great support for VS Code</li>\n</ul>\n<p>Gauge是一种轻量级的跨平台测试自动化工具，可以以业务语言编写测试用例。</p>\n<p>本篇环境是以macOs、vscode为基本版本，python作为基本插件</p>\n<h3 id=\"1、安装Gauge\"><a href=\"#1、安装Gauge\" class=\"headerlink\" title=\"1、安装Gauge\"></a>1、安装Gauge</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install gauge</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gauge --version</span><br><span class=\"line\"></span><br><span class=\"line\">Gauge version: 1.4.1</span><br><span class=\"line\">Plugins</span><br><span class=\"line\">-------</span><br><span class=\"line\">html-report (4.1.2)</span><br><span class=\"line\">js (2.3.17)</span><br><span class=\"line\">python (0.3.17)</span><br><span class=\"line\">screenshot (0.1.0)</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2、安装相关插件\"><a href=\"#2、安装相关插件\" class=\"headerlink\" title=\"2、安装相关插件\"></a>2、安装相关插件</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gauge install python -f gauge-python.zip</span><br><span class=\"line\">gauge install html-report -f html-report.zip</span><br><span class=\"line\">gauge install screenshot -f screenshot.zip</span><br></pre></td></tr></table></figure>\n\n<p>可以使用<code>gauge --help</code>查看相关命令</p>\n<h3 id=\"3、安装python\"><a href=\"#3、安装python\" class=\"headerlink\" title=\"3、安装python\"></a>3、安装python</h3><p>这里可以自行百度</p>\n<h3 id=\"4、安装VScode\"><a href=\"#4、安装VScode\" class=\"headerlink\" title=\"4、安装VScode\"></a>4、安装VScode</h3><p>安装完VScode之后，在插件栏依次安装如下插件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python 插件</span><br><span class=\"line\">gauge 插件</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaef9f7-c0ab-11ec-92a1-7557b2313227","title":"gauge创建项目","abbrlink":"8ac1c58d","_content":"\n\n## 创建项目\n\n1、创建文件夹`gauge-python`，然后进入文件夹执行`gauge init python`\n\n~~~\nmkdir gauge-python\ncd gauge-python\ngauge init python\n~~~\n\n可以[参考官方方式](https://docs.gauge.org/getting_started/create-test-project.html?os=macos&language=python&ide=vscode)，按ctrl+shift+p组合键，输入`gauge`关键字，选择`Create a new Gauge Project`\n\n2、运行测试\n\n进入specs文件下example.spec\n\n![image-20211201165203860](https://raw.githubusercontent.com/xzyup/image/master/202203191645453.png)\n\n点击Run Spec即可运行测试\n\n也可以在命令行执行`gauge run specs` 或 `gauge run --tags 'single word' specs`\n","source":"_posts/gauge/2.创建项目.md","raw":"---\nuuid: bbaef9f7-c0ab-11ec-92a1-7557b2313227\ntitle: gauge创建项目\ntags: gauge\ncategories: BDD\nabbrlink: 8ac1c58d\n---\n\n\n## 创建项目\n\n1、创建文件夹`gauge-python`，然后进入文件夹执行`gauge init python`\n\n~~~\nmkdir gauge-python\ncd gauge-python\ngauge init python\n~~~\n\n可以[参考官方方式](https://docs.gauge.org/getting_started/create-test-project.html?os=macos&language=python&ide=vscode)，按ctrl+shift+p组合键，输入`gauge`关键字，选择`Create a new Gauge Project`\n\n2、运行测试\n\n进入specs文件下example.spec\n\n![image-20211201165203860](https://raw.githubusercontent.com/xzyup/image/master/202203191645453.png)\n\n点击Run Spec即可运行测试\n\n也可以在命令行执行`gauge run specs` 或 `gauge run --tags 'single word' specs`\n","slug":"gauge/2.创建项目","published":1,"date":"2022-04-20T12:41:20.830Z","updated":"2022-05-04T03:02:27.783Z","_id":"cl2qzfthf001o13no7u9u8q2j","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h2><p>1、创建文件夹<code>gauge-python</code>，然后进入文件夹执行<code>gauge init python</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir gauge-python</span><br><span class=\"line\">cd gauge-python</span><br><span class=\"line\">gauge init python</span><br></pre></td></tr></table></figure>\n\n<p>可以<a href=\"https://docs.gauge.org/getting_started/create-test-project.html?os=macos&language=python&ide=vscode\">参考官方方式</a>，按ctrl+shift+p组合键，输入<code>gauge</code>关键字，选择<code>Create a new Gauge Project</code></p>\n<p>2、运行测试</p>\n<p>进入specs文件下example.spec</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191645453.png\" alt=\"image-20211201165203860\"></p>\n<p>点击Run Spec即可运行测试</p>\n<p>也可以在命令行执行<code>gauge run specs</code> 或 <code>gauge run --tags &#39;single word&#39; specs</code></p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h2><p>1、创建文件夹<code>gauge-python</code>，然后进入文件夹执行<code>gauge init python</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir gauge-python</span><br><span class=\"line\">cd gauge-python</span><br><span class=\"line\">gauge init python</span><br></pre></td></tr></table></figure>\n\n<p>可以<a href=\"https://docs.gauge.org/getting_started/create-test-project.html?os=macos&language=python&ide=vscode\">参考官方方式</a>，按ctrl+shift+p组合键，输入<code>gauge</code>关键字，选择<code>Create a new Gauge Project</code></p>\n<p>2、运行测试</p>\n<p>进入specs文件下example.spec</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191645453.png\" alt=\"image-20211201165203860\"></p>\n<p>点击Run Spec即可运行测试</p>\n<p>也可以在命令行执行<code>gauge run specs</code> 或 <code>gauge run --tags &#39;single word&#39; specs</code></p>\n"},{"uuid":"bbaef9f8-c0ab-11ec-92a1-7557b2313227","title":"gauge语法","abbrlink":"c05a77b1","_content":"\n# Gauge语法\n\n## Specifications（spec）\n\n它们是业务层测试用例，也可以做为您的功能文档。它们是用业务语言编写，通常spec或者specification描述了被测应用的特定特征。\n\n- 它们编写在.spec后缀的文件内。Gauge也支持.md文件格式。\n- Specification文件的标记是基于markdown语法。\n\n~~~markdown\n# Specification Heading\n\nThis is an executable specification file. This file follows markdown syntax.\nEvery heading in this file denotes a scenario. Every bulleted point denotes a step.\n\nTo execute this specification, run\n\n    gauge run specs\n\n\n* Vowels in English language are \"aeiou\".\n\n## Vowel counts in single word\n\ntags: single word\n\n* The word \"gauge\" has \"3\" vowels.\n~~~\n\n### specification标题\n\nSpec文件必须以spec标题开始，且一个spec文件只能包含一个spec标题。\n它是以< H1 >的markdown语法编写，可以使用以下两种形式：\n\n> # Specification Heading\n\n> Specification Heading \n>\n> ===================\n\n- 每个spec必须包含一个或者多个Scenarios；\n- 每个spec可以使用Tags标记。\n\n### Scenarios（场景）\n\n每个场景代表特定spec中的单个流。Spec必须包含至少一个scenario。\n一个场景在场景标题或者场景名后开始。场景标题以< H2>的markdown语法编写，可以使用以下两种形式:\n\n> ## Vowel counts in single word\n\n> Vowel counts in single word\n>\n> ------------------------------------------\n\n- 一个场景包含一个或者更多步骤在scenario名的下面\n- 可以使用标签来标记场景\n\n示例\n\n~~~markdown\n## Vowel counts in single word\n\ntags: single word\n\n* The word \"gauge\" has \"3\" vowels.\n~~~\n\n### Steps（步骤）\n\nsteps是您的spec内的可执行组件，它们被写为无序列表项（项目符号）。\n\n它们写在spec中作为：\n\n- 上下文步骤\n- tear down步骤\n- 在scenario中的步骤或者concept中的步骤\n  每一个步骤都有一个使用编程语言的底层代码实现。当spec内的步骤执行时被执行。\n  参阅不同语言下的步骤实现。\n\n示例\n\n~~~markdown\n* Vowels in English language are \"aeiou\".\n* The word \"gauge\" has \"3\" vowels.\n~~~\n\n以引号表示的值是作为语言特定结构传递到基础步骤实现的参数。\n注意：下面的字符是为参数保留的，它们不可以使用在step内。\n\n- \"\n\n- <\n\n- >\n\n### 参数\n\n可以定义步骤以将值作为参数 ，以便可以使用不同的参数值来重新使用。\n\n~~~\n* Check \"product 1\" exists\n* Check \"product 2\" exists\n~~~\n\n在代码里的底层步骤实现里，必须和步骤传递来的参数数量一致。\n传递给步骤的参数是下列类型：\n\n#### 简单参数\n\n它们是以双引号引入到步骤里的值。\n\n~~~\n* Create a “gauge-java” project\n* Write “100” line specification\n~~~\n\n备注：\n重命名参数将不会改变方法中的用法。根据设计，重命名的参数被认为是一个新的参数。因此，必须手动修改旧参数（如果有的话）的使用以解决相应的编译问题。\n\n#### 动态参数\n\n动态参数作为值的占位符。\n**语法**：< dynamic_param >\n动态参数主要使用在当数据驱动引用表列的值被执行时，或者将值传递给concepts时。\n\n示例\n\nexample.cpt\n\n~~~markdown\n# A sample concept that takes a <parameter>\n\n* And used the <parameter> in a step.\n~~~\n\n上述concept可以被调用，并且可以在调用时将值传递给针对< parameter>的concept.\n\n~~~\n* A sample concept that takes a \"dummy value\"\n~~~\n\n#### 表格参数\n\n表格参数可以在以下两种方式使用\n\n- 当要针对多组数据执行spec中的场景或者多个场景时，可以使用数据驱动执行\n- 表或者内联表可以作为参数传递给步骤\n\n##### 数据表的值在内联表内\n\n数据表内的动态值也可以参考传递给步骤的表格参数\n\n示例\n\n~~~markdown\ncreate projects\n================\n|id| name |\n|--| ---- |\n|1 | john |\n|2 | mike |\n\nFirst scenario\n---------------\n* Create the following projects\n    |project name| username |\n    |------------|----------|\n    | Gauge java | <name>   |\n    | Gauge ruby | <name>   |\n\n~~~\n\n在上述的示例，表格参数使用数据表格内的动态值。\n\nStep_impl.py\n\n~~~python\n@step(\"Create the following projects <table>\")\ndef assert_words_vowel_count(table):\n     # 获取table的行数据\n    for item in table:\n        print(item)\n        # 获取每行column的值\n        for index in range(len(item)):\n            print(item[index])\n~~~\n\n#### 特殊参数\n\n特殊参数提供了将更大更丰富的数据作为参数传递到步骤的能力。\n\n- 它们在步骤中以尖括号 -<> 输入\n- 它们包含两个由冒号分割的部分 :\n\n> < prefix:value>\n\n**Prefix**：定义特殊参数的类型，比如：file，table\n**Value**：定义特殊参数的值\n有两种特殊类型：\n\n- [File](https://docs.gauge.org/writing-specifications.html?os=macos&language=python&ide=vscode)\n- CSV\n\n##### 特殊参数:文件\n\n这是通过读取文件然后将文件内容作为字符串参数传给底层步骤。\n**语法**：< file:[value]> [value]是指文件的路径\n\n[value]可以是相对或者绝对路径。相对路径相对于GAUGE_PROJECT_ROOT来解析。\n\n**文件的路径可以是相对Gague项目路径的相对路径或者文件的绝对路径。**\n\n示例\n\nemail.txt是绝对路径文件,/work/content.txt是相对路径文件\n\n~~~markdown\n* Verify email text is <file:email.txt>\n* Check if <file:/work/content.txt> is visible\n~~~\n\n##### 特殊参数:CSV\n\n表格通常用于从外部csv文件读取再传递表格值给steps。步骤中的参数文本包含前缀表和csv文件的路径。\n**语法**：< table:[value]> [value]是指csv文件的路径。\n\n示例\n\n~~~markdown\n* Step that takes a table <table:data.csv>\n* Check if the following users exist <table:/Users/john/work/users.csv>\n~~~\n\n###### 简单的csv文件\n\n~~~markdown\nId,Name\n1,The Way to Go On\n2,Ivo Jay Balbaert\n~~~\n\n第一行被视为表头，后面的行视为列的值。\n\n### 标签\n\nTags用于将标签与sepc或者scenarios关联。标签用前缀Tags:和逗号分割值写成。\n\n- Spec和scenarios可以单独标记\n- 只能将一组标签添加到单个spec或者scenario中\n\n它们有助于基于使用标签的标签来过滤spec或者scenario。\n\n**示例**\n\n在下面的例子里`Login specification`和`Successful login scenario`场景都有标签。\n\n~~~markdown\nLogin specifications\n======================\nTags: login, admin, user-test\n\nSuccessful login scenario\n-------------------------\nTags: login-success, admin\n~~~\n\n应用在spec的标签自动应用在哪个场景。可以通过 `gauge run --tags 'test' test.spec`指定运行哪个场景。\n\n### Concepts\n\nConcepts提供将步骤中的重复使用的逻辑组组合到一个单元中的能力。它通过组合步骤来提供更高层次的业务意图抽象。\n它们在项目中specs文件夹的.cpt格式文件内被定义。它们也可以保存在specs文件夹的子目录内。\n\n- Concepts在spec的使用就象其他步骤一样，将适当的参数传递给它们。\n- Concepts下的所有步骤都按照定义的顺序执行。\n\n**备注**：一个.cpt文件可以包含多个concept定义\n\n#### concept定义\n\n使用concept定义在sepcs文件夹内创建一个.cpt文件。Concept定义包含两部分：\n\n##### Concept标题\n\nconcept标题定义concept的名字和它将使用的参数。它写成markdown `H1`格式。\n\n- 所有的参数被定义在角括号`<>`\n- 一个concept的定义必须包含concept标题\n\n~~~markdown\n# Concept name with <param0> and <param1>\n~~~\n\n##### 步骤\n\nconcept里的步骤紧跟concept标题。它们以常用的步骤结构定义。\n\n- 所有从concept标题使用的参数在`<>`内\n- 固定的静态参数用`\"\"`括起来\n- concept定义也可以调用其他concept\n\n~~~markdown\n# Login as user <username> and create project <project_name>\n\n* Login as user <username> and \"password\"\n* Navigate to project page\n* Create a project <project_name>\n~~~\n\n在上面的示例：\n\n- 第一行是concept标题\n- 下面三行是在concept中的抽象\n\n### 上下文\n\n上下文或者上下文步骤是在任何场景之前被定义在spec的步骤。\n它们允许您指定必须用来执行spec步骤的条件集合。上下文步骤可以用来在执行场景前初始化数据。它们也可以完成setup或者tear down功能。\n\n- 任何常规步骤可以作为上下文\n- 上下文在执行场景前被执行\n\n~~~markdown\nDelete project\n================\nThese are context steps\n\n* User is logged in as \"mike\"\n* Navigate to the project page\n\nDelete single project\n----------------------\n* Delete the \"example\" project\n* Ensure \"example\" project has been deleted\n\nDelete multiple projects\n-------------------------\n* Delete all the projects in the list\n* Ensure project list is empty\n~~~\n\n在上面的示例spec中，`User is logged in as Mike` 和 `Navigate to the project page`是上下文步骤，它们在任意场景前被定义。这些步骤在每个场景`Delete single project`和`Delete multiple projects`执行之前被执行。\nSpec执行过程应该是:\n\n1. 上下文执行\n2. `Delete single project`场景执行\n3. 上下文执行\n4. `Delete multiple projects`场景执行\n\n### Tear Down步骤\n\nTear Down步骤在最后一个场景后被定义在spec内的步骤。它们允许你在每个场景执行后指定一系列清理步骤。它们被用来完成tear down功能。\n\n- 任何常规的步骤可以作为tear down步骤\n- tear down步骤在每个spec内的场景执行后被执行\n\n#### 语法\n\n`___`:三个或者更多的连续下划线指示tear down的开始。编写在tear down内（在三个或者更多联系的下划线之后）的步骤将被认为是tear down步骤。\n\n~~~markdown\n___________________\n* Tear down step 1\n* Tear down step 2\n* Tear down step 3\n~~~\n\n完整示例\n\n~~~markdown\nDelete project\n================\nThese are context steps\n\n* User is logged in as \"mike\"\n* Navigate to the project page\n\nDelete single project\n----------------------\n* Delete the \"example\" project\n* Ensure \"example\" project has been deleted\n\nDelete multiple projects\n-------------------------\n* Delete all the projects in the list\n* Ensure project list is empty\n_________________________________\nThese are teardown steps\n\n* Logout user \"mike\"\n* Delete user \"mike\"\n~~~\n\n在上述示例spec中，`Logout user \"mike\"`和 `Delete user \"mike\"`是tear down步骤，它们在三个或者更多连续下划线后被定义。\nSpec执行过程应该是:\n\n1. 上下文执行\n2. `Delete single project`场景执行\n3. Tear down步骤执行\n4. 上下文执行\n5. `Delete multiple projects`场景执行\n6. Tear down步骤执行\n","source":"_posts/gauge/3.语法.md","raw":"---\nuuid: bbaef9f8-c0ab-11ec-92a1-7557b2313227\ntitle: gauge语法\ntags: gauge\ncategories: BDD\nabbrlink: c05a77b1\n---\n\n# Gauge语法\n\n## Specifications（spec）\n\n它们是业务层测试用例，也可以做为您的功能文档。它们是用业务语言编写，通常spec或者specification描述了被测应用的特定特征。\n\n- 它们编写在.spec后缀的文件内。Gauge也支持.md文件格式。\n- Specification文件的标记是基于markdown语法。\n\n~~~markdown\n# Specification Heading\n\nThis is an executable specification file. This file follows markdown syntax.\nEvery heading in this file denotes a scenario. Every bulleted point denotes a step.\n\nTo execute this specification, run\n\n    gauge run specs\n\n\n* Vowels in English language are \"aeiou\".\n\n## Vowel counts in single word\n\ntags: single word\n\n* The word \"gauge\" has \"3\" vowels.\n~~~\n\n### specification标题\n\nSpec文件必须以spec标题开始，且一个spec文件只能包含一个spec标题。\n它是以< H1 >的markdown语法编写，可以使用以下两种形式：\n\n> # Specification Heading\n\n> Specification Heading \n>\n> ===================\n\n- 每个spec必须包含一个或者多个Scenarios；\n- 每个spec可以使用Tags标记。\n\n### Scenarios（场景）\n\n每个场景代表特定spec中的单个流。Spec必须包含至少一个scenario。\n一个场景在场景标题或者场景名后开始。场景标题以< H2>的markdown语法编写，可以使用以下两种形式:\n\n> ## Vowel counts in single word\n\n> Vowel counts in single word\n>\n> ------------------------------------------\n\n- 一个场景包含一个或者更多步骤在scenario名的下面\n- 可以使用标签来标记场景\n\n示例\n\n~~~markdown\n## Vowel counts in single word\n\ntags: single word\n\n* The word \"gauge\" has \"3\" vowels.\n~~~\n\n### Steps（步骤）\n\nsteps是您的spec内的可执行组件，它们被写为无序列表项（项目符号）。\n\n它们写在spec中作为：\n\n- 上下文步骤\n- tear down步骤\n- 在scenario中的步骤或者concept中的步骤\n  每一个步骤都有一个使用编程语言的底层代码实现。当spec内的步骤执行时被执行。\n  参阅不同语言下的步骤实现。\n\n示例\n\n~~~markdown\n* Vowels in English language are \"aeiou\".\n* The word \"gauge\" has \"3\" vowels.\n~~~\n\n以引号表示的值是作为语言特定结构传递到基础步骤实现的参数。\n注意：下面的字符是为参数保留的，它们不可以使用在step内。\n\n- \"\n\n- <\n\n- >\n\n### 参数\n\n可以定义步骤以将值作为参数 ，以便可以使用不同的参数值来重新使用。\n\n~~~\n* Check \"product 1\" exists\n* Check \"product 2\" exists\n~~~\n\n在代码里的底层步骤实现里，必须和步骤传递来的参数数量一致。\n传递给步骤的参数是下列类型：\n\n#### 简单参数\n\n它们是以双引号引入到步骤里的值。\n\n~~~\n* Create a “gauge-java” project\n* Write “100” line specification\n~~~\n\n备注：\n重命名参数将不会改变方法中的用法。根据设计，重命名的参数被认为是一个新的参数。因此，必须手动修改旧参数（如果有的话）的使用以解决相应的编译问题。\n\n#### 动态参数\n\n动态参数作为值的占位符。\n**语法**：< dynamic_param >\n动态参数主要使用在当数据驱动引用表列的值被执行时，或者将值传递给concepts时。\n\n示例\n\nexample.cpt\n\n~~~markdown\n# A sample concept that takes a <parameter>\n\n* And used the <parameter> in a step.\n~~~\n\n上述concept可以被调用，并且可以在调用时将值传递给针对< parameter>的concept.\n\n~~~\n* A sample concept that takes a \"dummy value\"\n~~~\n\n#### 表格参数\n\n表格参数可以在以下两种方式使用\n\n- 当要针对多组数据执行spec中的场景或者多个场景时，可以使用数据驱动执行\n- 表或者内联表可以作为参数传递给步骤\n\n##### 数据表的值在内联表内\n\n数据表内的动态值也可以参考传递给步骤的表格参数\n\n示例\n\n~~~markdown\ncreate projects\n================\n|id| name |\n|--| ---- |\n|1 | john |\n|2 | mike |\n\nFirst scenario\n---------------\n* Create the following projects\n    |project name| username |\n    |------------|----------|\n    | Gauge java | <name>   |\n    | Gauge ruby | <name>   |\n\n~~~\n\n在上述的示例，表格参数使用数据表格内的动态值。\n\nStep_impl.py\n\n~~~python\n@step(\"Create the following projects <table>\")\ndef assert_words_vowel_count(table):\n     # 获取table的行数据\n    for item in table:\n        print(item)\n        # 获取每行column的值\n        for index in range(len(item)):\n            print(item[index])\n~~~\n\n#### 特殊参数\n\n特殊参数提供了将更大更丰富的数据作为参数传递到步骤的能力。\n\n- 它们在步骤中以尖括号 -<> 输入\n- 它们包含两个由冒号分割的部分 :\n\n> < prefix:value>\n\n**Prefix**：定义特殊参数的类型，比如：file，table\n**Value**：定义特殊参数的值\n有两种特殊类型：\n\n- [File](https://docs.gauge.org/writing-specifications.html?os=macos&language=python&ide=vscode)\n- CSV\n\n##### 特殊参数:文件\n\n这是通过读取文件然后将文件内容作为字符串参数传给底层步骤。\n**语法**：< file:[value]> [value]是指文件的路径\n\n[value]可以是相对或者绝对路径。相对路径相对于GAUGE_PROJECT_ROOT来解析。\n\n**文件的路径可以是相对Gague项目路径的相对路径或者文件的绝对路径。**\n\n示例\n\nemail.txt是绝对路径文件,/work/content.txt是相对路径文件\n\n~~~markdown\n* Verify email text is <file:email.txt>\n* Check if <file:/work/content.txt> is visible\n~~~\n\n##### 特殊参数:CSV\n\n表格通常用于从外部csv文件读取再传递表格值给steps。步骤中的参数文本包含前缀表和csv文件的路径。\n**语法**：< table:[value]> [value]是指csv文件的路径。\n\n示例\n\n~~~markdown\n* Step that takes a table <table:data.csv>\n* Check if the following users exist <table:/Users/john/work/users.csv>\n~~~\n\n###### 简单的csv文件\n\n~~~markdown\nId,Name\n1,The Way to Go On\n2,Ivo Jay Balbaert\n~~~\n\n第一行被视为表头，后面的行视为列的值。\n\n### 标签\n\nTags用于将标签与sepc或者scenarios关联。标签用前缀Tags:和逗号分割值写成。\n\n- Spec和scenarios可以单独标记\n- 只能将一组标签添加到单个spec或者scenario中\n\n它们有助于基于使用标签的标签来过滤spec或者scenario。\n\n**示例**\n\n在下面的例子里`Login specification`和`Successful login scenario`场景都有标签。\n\n~~~markdown\nLogin specifications\n======================\nTags: login, admin, user-test\n\nSuccessful login scenario\n-------------------------\nTags: login-success, admin\n~~~\n\n应用在spec的标签自动应用在哪个场景。可以通过 `gauge run --tags 'test' test.spec`指定运行哪个场景。\n\n### Concepts\n\nConcepts提供将步骤中的重复使用的逻辑组组合到一个单元中的能力。它通过组合步骤来提供更高层次的业务意图抽象。\n它们在项目中specs文件夹的.cpt格式文件内被定义。它们也可以保存在specs文件夹的子目录内。\n\n- Concepts在spec的使用就象其他步骤一样，将适当的参数传递给它们。\n- Concepts下的所有步骤都按照定义的顺序执行。\n\n**备注**：一个.cpt文件可以包含多个concept定义\n\n#### concept定义\n\n使用concept定义在sepcs文件夹内创建一个.cpt文件。Concept定义包含两部分：\n\n##### Concept标题\n\nconcept标题定义concept的名字和它将使用的参数。它写成markdown `H1`格式。\n\n- 所有的参数被定义在角括号`<>`\n- 一个concept的定义必须包含concept标题\n\n~~~markdown\n# Concept name with <param0> and <param1>\n~~~\n\n##### 步骤\n\nconcept里的步骤紧跟concept标题。它们以常用的步骤结构定义。\n\n- 所有从concept标题使用的参数在`<>`内\n- 固定的静态参数用`\"\"`括起来\n- concept定义也可以调用其他concept\n\n~~~markdown\n# Login as user <username> and create project <project_name>\n\n* Login as user <username> and \"password\"\n* Navigate to project page\n* Create a project <project_name>\n~~~\n\n在上面的示例：\n\n- 第一行是concept标题\n- 下面三行是在concept中的抽象\n\n### 上下文\n\n上下文或者上下文步骤是在任何场景之前被定义在spec的步骤。\n它们允许您指定必须用来执行spec步骤的条件集合。上下文步骤可以用来在执行场景前初始化数据。它们也可以完成setup或者tear down功能。\n\n- 任何常规步骤可以作为上下文\n- 上下文在执行场景前被执行\n\n~~~markdown\nDelete project\n================\nThese are context steps\n\n* User is logged in as \"mike\"\n* Navigate to the project page\n\nDelete single project\n----------------------\n* Delete the \"example\" project\n* Ensure \"example\" project has been deleted\n\nDelete multiple projects\n-------------------------\n* Delete all the projects in the list\n* Ensure project list is empty\n~~~\n\n在上面的示例spec中，`User is logged in as Mike` 和 `Navigate to the project page`是上下文步骤，它们在任意场景前被定义。这些步骤在每个场景`Delete single project`和`Delete multiple projects`执行之前被执行。\nSpec执行过程应该是:\n\n1. 上下文执行\n2. `Delete single project`场景执行\n3. 上下文执行\n4. `Delete multiple projects`场景执行\n\n### Tear Down步骤\n\nTear Down步骤在最后一个场景后被定义在spec内的步骤。它们允许你在每个场景执行后指定一系列清理步骤。它们被用来完成tear down功能。\n\n- 任何常规的步骤可以作为tear down步骤\n- tear down步骤在每个spec内的场景执行后被执行\n\n#### 语法\n\n`___`:三个或者更多的连续下划线指示tear down的开始。编写在tear down内（在三个或者更多联系的下划线之后）的步骤将被认为是tear down步骤。\n\n~~~markdown\n___________________\n* Tear down step 1\n* Tear down step 2\n* Tear down step 3\n~~~\n\n完整示例\n\n~~~markdown\nDelete project\n================\nThese are context steps\n\n* User is logged in as \"mike\"\n* Navigate to the project page\n\nDelete single project\n----------------------\n* Delete the \"example\" project\n* Ensure \"example\" project has been deleted\n\nDelete multiple projects\n-------------------------\n* Delete all the projects in the list\n* Ensure project list is empty\n_________________________________\nThese are teardown steps\n\n* Logout user \"mike\"\n* Delete user \"mike\"\n~~~\n\n在上述示例spec中，`Logout user \"mike\"`和 `Delete user \"mike\"`是tear down步骤，它们在三个或者更多连续下划线后被定义。\nSpec执行过程应该是:\n\n1. 上下文执行\n2. `Delete single project`场景执行\n3. Tear down步骤执行\n4. 上下文执行\n5. `Delete multiple projects`场景执行\n6. Tear down步骤执行\n","slug":"gauge/3.语法","published":1,"date":"2022-04-20T12:41:20.824Z","updated":"2022-05-04T03:02:42.590Z","_id":"cl2qzfthf001q13noagd2en4c","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Gauge语法\"><a href=\"#Gauge语法\" class=\"headerlink\" title=\"Gauge语法\"></a>Gauge语法</h1><h2 id=\"Specifications（spec）\"><a href=\"#Specifications（spec）\" class=\"headerlink\" title=\"Specifications（spec）\"></a>Specifications（spec）</h2><p>它们是业务层测试用例，也可以做为您的功能文档。它们是用业务语言编写，通常spec或者specification描述了被测应用的特定特征。</p>\n<ul>\n<li>它们编写在.spec后缀的文件内。Gauge也支持.md文件格式。</li>\n<li>Specification文件的标记是基于markdown语法。</li>\n</ul>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># Specification Heading</span></span><br><span class=\"line\"></span><br><span class=\"line\">This is an executable specification file. This file follows markdown syntax.</span><br><span class=\"line\">Every heading in this file denotes a scenario. Every bulleted point denotes a step.</span><br><span class=\"line\"></span><br><span class=\"line\">To execute this specification, run</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"code\">    gauge run specs</span></span><br><span class=\"line\"><span class=\"code\"></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> Vowels in English language are &quot;aeiou&quot;.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## Vowel counts in single word</span></span><br><span class=\"line\"></span><br><span class=\"line\">tags: single word</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> The word &quot;gauge&quot; has &quot;3&quot; vowels.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"specification标题\"><a href=\"#specification标题\" class=\"headerlink\" title=\"specification标题\"></a>specification标题</h3><p>Spec文件必须以spec标题开始，且一个spec文件只能包含一个spec标题。<br>它是以&lt; H1 &gt;的markdown语法编写，可以使用以下两种形式：</p>\n<blockquote>\n<h1 id=\"Specification-Heading\"><a href=\"#Specification-Heading\" class=\"headerlink\" title=\"Specification Heading\"></a>Specification Heading</h1></blockquote>\n<blockquote>\n<p>Specification Heading </p>\n<p>===================</p>\n</blockquote>\n<ul>\n<li>每个spec必须包含一个或者多个Scenarios；</li>\n<li>每个spec可以使用Tags标记。</li>\n</ul>\n<h3 id=\"Scenarios（场景）\"><a href=\"#Scenarios（场景）\" class=\"headerlink\" title=\"Scenarios（场景）\"></a>Scenarios（场景）</h3><p>每个场景代表特定spec中的单个流。Spec必须包含至少一个scenario。<br>一个场景在场景标题或者场景名后开始。场景标题以&lt; H2&gt;的markdown语法编写，可以使用以下两种形式:</p>\n<blockquote>\n<h2 id=\"Vowel-counts-in-single-word\"><a href=\"#Vowel-counts-in-single-word\" class=\"headerlink\" title=\"Vowel counts in single word\"></a>Vowel counts in single word</h2></blockquote>\n<blockquote>\n<p>Vowel counts in single word</p>\n<hr>\n</blockquote>\n<ul>\n<li>一个场景包含一个或者更多步骤在scenario名的下面</li>\n<li>可以使用标签来标记场景</li>\n</ul>\n<p>示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">## Vowel counts in single word</span></span><br><span class=\"line\"></span><br><span class=\"line\">tags: single word</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> The word &quot;gauge&quot; has &quot;3&quot; vowels.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Steps（步骤）\"><a href=\"#Steps（步骤）\" class=\"headerlink\" title=\"Steps（步骤）\"></a>Steps（步骤）</h3><p>steps是您的spec内的可执行组件，它们被写为无序列表项（项目符号）。</p>\n<p>它们写在spec中作为：</p>\n<ul>\n<li>上下文步骤</li>\n<li>tear down步骤</li>\n<li>在scenario中的步骤或者concept中的步骤<br>每一个步骤都有一个使用编程语言的底层代码实现。当spec内的步骤执行时被执行。<br>参阅不同语言下的步骤实现。</li>\n</ul>\n<p>示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> Vowels in English language are &quot;aeiou&quot;.</span><br><span class=\"line\"><span class=\"bullet\">*</span> The word &quot;gauge&quot; has &quot;3&quot; vowels.</span><br></pre></td></tr></table></figure>\n\n<p>以引号表示的值是作为语言特定结构传递到基础步骤实现的参数。<br>注意：下面的字符是为参数保留的，它们不可以使用在step内。</p>\n<ul>\n<li><p>“</p>\n</li>\n<li><p>&lt;</p>\n</li>\n<li><blockquote>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h3><p>可以定义步骤以将值作为参数 ，以便可以使用不同的参数值来重新使用。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* Check &quot;product 1&quot; exists</span><br><span class=\"line\">* Check &quot;product 2&quot; exists</span><br></pre></td></tr></table></figure>\n\n<p>在代码里的底层步骤实现里，必须和步骤传递来的参数数量一致。<br>传递给步骤的参数是下列类型：</p>\n<h4 id=\"简单参数\"><a href=\"#简单参数\" class=\"headerlink\" title=\"简单参数\"></a>简单参数</h4><p>它们是以双引号引入到步骤里的值。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* Create a “gauge-java” project</span><br><span class=\"line\">* Write “100” line specification</span><br></pre></td></tr></table></figure>\n\n<p>备注：<br>重命名参数将不会改变方法中的用法。根据设计，重命名的参数被认为是一个新的参数。因此，必须手动修改旧参数（如果有的话）的使用以解决相应的编译问题。</p>\n<h4 id=\"动态参数\"><a href=\"#动态参数\" class=\"headerlink\" title=\"动态参数\"></a>动态参数</h4><p>动态参数作为值的占位符。<br><strong>语法</strong>：&lt; dynamic_param &gt;<br>动态参数主要使用在当数据驱动引用表列的值被执行时，或者将值传递给concepts时。</p>\n<p>示例</p>\n<p>example.cpt</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># A sample concept that takes a <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">parameter</span>&gt;</span></span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> And used the <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">parameter</span>&gt;</span></span> in a step.</span><br></pre></td></tr></table></figure>\n\n<p>上述concept可以被调用，并且可以在调用时将值传递给针对&lt; parameter&gt;的concept.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* A sample concept that takes a &quot;dummy value&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"表格参数\"><a href=\"#表格参数\" class=\"headerlink\" title=\"表格参数\"></a>表格参数</h4><p>表格参数可以在以下两种方式使用</p>\n<ul>\n<li>当要针对多组数据执行spec中的场景或者多个场景时，可以使用数据驱动执行</li>\n<li>表或者内联表可以作为参数传递给步骤</li>\n</ul>\n<h5 id=\"数据表的值在内联表内\"><a href=\"#数据表的值在内联表内\" class=\"headerlink\" title=\"数据表的值在内联表内\"></a>数据表的值在内联表内</h5><p>数据表内的动态值也可以参考传递给步骤的表格参数</p>\n<p>示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">create projects</span></span><br><span class=\"line\"><span class=\"section\">================</span></span><br><span class=\"line\">|id| name |</span><br><span class=\"line\">|--| ---- |</span><br><span class=\"line\">|1 | john |</span><br><span class=\"line\">|2 | mike |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">First scenario</span></span><br><span class=\"line\"><span class=\"section\">---------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Create the following projects</span><br><span class=\"line\"><span class=\"code\">    |project name| username |</span></span><br><span class=\"line\"><span class=\"code\">    |------------|----------|</span></span><br><span class=\"line\"><span class=\"code\">    | Gauge java | &lt;name&gt;   |</span></span><br><span class=\"line\"><span class=\"code\">    | Gauge ruby | &lt;name&gt;   |</span></span><br><span class=\"line\"><span class=\"code\"></span></span><br></pre></td></tr></table></figure>\n\n<p>在上述的示例，表格参数使用数据表格内的动态值。</p>\n<p>Step_impl.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@step(<span class=\"params\"><span class=\"string\">&quot;Create the following projects &lt;table&gt;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">assert_words_vowel_count</span>(<span class=\"params\">table</span>):</span><br><span class=\"line\">     <span class=\"comment\"># 获取table的行数据</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> table:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(item)</span><br><span class=\"line\">        <span class=\"comment\"># 获取每行column的值</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> index <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(item)):</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(item[index])</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"特殊参数\"><a href=\"#特殊参数\" class=\"headerlink\" title=\"特殊参数\"></a>特殊参数</h4><p>特殊参数提供了将更大更丰富的数据作为参数传递到步骤的能力。</p>\n<ul>\n<li>它们在步骤中以尖括号 -&lt;&gt; 输入</li>\n<li>它们包含两个由冒号分割的部分 :</li>\n</ul>\n<blockquote>\n<p>&lt; prefix:value&gt;</p>\n</blockquote>\n<p><strong>Prefix</strong>：定义特殊参数的类型，比如：file，table<br><strong>Value</strong>：定义特殊参数的值<br>有两种特殊类型：</p>\n<ul>\n<li><a href=\"https://docs.gauge.org/writing-specifications.html?os=macos&language=python&ide=vscode\">File</a></li>\n<li>CSV</li>\n</ul>\n<h5 id=\"特殊参数-文件\"><a href=\"#特殊参数-文件\" class=\"headerlink\" title=\"特殊参数:文件\"></a>特殊参数:文件</h5><p>这是通过读取文件然后将文件内容作为字符串参数传给底层步骤。<br><strong>语法</strong>：&lt; file:[value]&gt; [value]是指文件的路径</p>\n<p>[value]可以是相对或者绝对路径。相对路径相对于GAUGE_PROJECT_ROOT来解析。</p>\n<p><strong>文件的路径可以是相对Gague项目路径的相对路径或者文件的绝对路径。</strong></p>\n<p>示例</p>\n<p>email.txt是绝对路径文件,/work/content.txt是相对路径文件</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> Verify email text is <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">file:email.txt</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Check if <span class=\"language-xml\">&lt;file:/work/content.txt&gt;</span> is visible</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"特殊参数-CSV\"><a href=\"#特殊参数-CSV\" class=\"headerlink\" title=\"特殊参数:CSV\"></a>特殊参数:CSV</h5><p>表格通常用于从外部csv文件读取再传递表格值给steps。步骤中的参数文本包含前缀表和csv文件的路径。<br><strong>语法</strong>：&lt; table:[value]&gt; [value]是指csv文件的路径。</p>\n<p>示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> Step that takes a table <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">table:data.csv</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Check if the following users exist <span class=\"language-xml\">&lt;table:/Users/john/work/users.csv&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"简单的csv文件\"><a href=\"#简单的csv文件\" class=\"headerlink\" title=\"简单的csv文件\"></a>简单的csv文件</h6><figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Id,Name</span><br><span class=\"line\">1,The Way to Go On</span><br><span class=\"line\">2,Ivo Jay Balbaert</span><br></pre></td></tr></table></figure>\n\n<p>第一行被视为表头，后面的行视为列的值。</p>\n<h3 id=\"标签\"><a href=\"#标签\" class=\"headerlink\" title=\"标签\"></a>标签</h3><p>Tags用于将标签与sepc或者scenarios关联。标签用前缀Tags:和逗号分割值写成。</p>\n<ul>\n<li>Spec和scenarios可以单独标记</li>\n<li>只能将一组标签添加到单个spec或者scenario中</li>\n</ul>\n<p>它们有助于基于使用标签的标签来过滤spec或者scenario。</p>\n<p><strong>示例</strong></p>\n<p>在下面的例子里<code>Login specification</code>和<code>Successful login scenario</code>场景都有标签。</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Login specifications</span></span><br><span class=\"line\"><span class=\"section\">======================</span></span><br><span class=\"line\">Tags: login, admin, user-test</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Successful login scenario</span></span><br><span class=\"line\"><span class=\"section\">-------------------------</span></span><br><span class=\"line\">Tags: login-success, admin</span><br></pre></td></tr></table></figure>\n\n<p>应用在spec的标签自动应用在哪个场景。可以通过 <code>gauge run --tags &#39;test&#39; test.spec</code>指定运行哪个场景。</p>\n<h3 id=\"Concepts\"><a href=\"#Concepts\" class=\"headerlink\" title=\"Concepts\"></a>Concepts</h3><p>Concepts提供将步骤中的重复使用的逻辑组组合到一个单元中的能力。它通过组合步骤来提供更高层次的业务意图抽象。<br>它们在项目中specs文件夹的.cpt格式文件内被定义。它们也可以保存在specs文件夹的子目录内。</p>\n<ul>\n<li>Concepts在spec的使用就象其他步骤一样，将适当的参数传递给它们。</li>\n<li>Concepts下的所有步骤都按照定义的顺序执行。</li>\n</ul>\n<p><strong>备注</strong>：一个.cpt文件可以包含多个concept定义</p>\n<h4 id=\"concept定义\"><a href=\"#concept定义\" class=\"headerlink\" title=\"concept定义\"></a>concept定义</h4><p>使用concept定义在sepcs文件夹内创建一个.cpt文件。Concept定义包含两部分：</p>\n<h5 id=\"Concept标题\"><a href=\"#Concept标题\" class=\"headerlink\" title=\"Concept标题\"></a>Concept标题</h5><p>concept标题定义concept的名字和它将使用的参数。它写成markdown <code>H1</code>格式。</p>\n<ul>\n<li>所有的参数被定义在角括号<code>&lt;&gt;</code></li>\n<li>一个concept的定义必须包含concept标题</li>\n</ul>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># Concept name with <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">param0</span>&gt;</span></span> and <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">param1</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h5><p>concept里的步骤紧跟concept标题。它们以常用的步骤结构定义。</p>\n<ul>\n<li>所有从concept标题使用的参数在<code>&lt;&gt;</code>内</li>\n<li>固定的静态参数用<code>&quot;&quot;</code>括起来</li>\n<li>concept定义也可以调用其他concept</li>\n</ul>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># Login as user <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">username</span>&gt;</span></span> and create project <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">project_name</span>&gt;</span></span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> Login as user <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">username</span>&gt;</span></span> and &quot;password&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Navigate to project page</span><br><span class=\"line\"><span class=\"bullet\">*</span> Create a project <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">project_name</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>在上面的示例：</p>\n<ul>\n<li>第一行是concept标题</li>\n<li>下面三行是在concept中的抽象</li>\n</ul>\n<h3 id=\"上下文\"><a href=\"#上下文\" class=\"headerlink\" title=\"上下文\"></a>上下文</h3><p>上下文或者上下文步骤是在任何场景之前被定义在spec的步骤。<br>它们允许您指定必须用来执行spec步骤的条件集合。上下文步骤可以用来在执行场景前初始化数据。它们也可以完成setup或者tear down功能。</p>\n<ul>\n<li>任何常规步骤可以作为上下文</li>\n<li>上下文在执行场景前被执行</li>\n</ul>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Delete project</span></span><br><span class=\"line\"><span class=\"section\">================</span></span><br><span class=\"line\">These are context steps</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> User is logged in as &quot;mike&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Navigate to the project page</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Delete single project</span></span><br><span class=\"line\"><span class=\"section\">----------------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Delete the &quot;example&quot; project</span><br><span class=\"line\"><span class=\"bullet\">*</span> Ensure &quot;example&quot; project has been deleted</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Delete multiple projects</span></span><br><span class=\"line\"><span class=\"section\">-------------------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Delete all the projects in the list</span><br><span class=\"line\"><span class=\"bullet\">*</span> Ensure project list is empty</span><br></pre></td></tr></table></figure>\n\n<p>在上面的示例spec中，<code>User is logged in as Mike</code> 和 <code>Navigate to the project page</code>是上下文步骤，它们在任意场景前被定义。这些步骤在每个场景<code>Delete single project</code>和<code>Delete multiple projects</code>执行之前被执行。<br>Spec执行过程应该是:</p>\n<ol>\n<li>上下文执行</li>\n<li><code>Delete single project</code>场景执行</li>\n<li>上下文执行</li>\n<li><code>Delete multiple projects</code>场景执行</li>\n</ol>\n<h3 id=\"Tear-Down步骤\"><a href=\"#Tear-Down步骤\" class=\"headerlink\" title=\"Tear Down步骤\"></a>Tear Down步骤</h3><p>Tear Down步骤在最后一个场景后被定义在spec内的步骤。它们允许你在每个场景执行后指定一系列清理步骤。它们被用来完成tear down功能。</p>\n<ul>\n<li>任何常规的步骤可以作为tear down步骤</li>\n<li>tear down步骤在每个spec内的场景执行后被执行</li>\n</ul>\n<h4 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h4><p><code>___</code>:三个或者更多的连续下划线指示tear down的开始。编写在tear down内（在三个或者更多联系的下划线之后）的步骤将被认为是tear down步骤。</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">__<span class=\"emphasis\">_</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">* Tear down step 1</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">* Tear down step 2</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">* Tear down step 3</span></span></span><br></pre></td></tr></table></figure>\n\n<p>完整示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Delete project</span></span><br><span class=\"line\"><span class=\"section\">================</span></span><br><span class=\"line\">These are context steps</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> User is logged in as &quot;mike&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Navigate to the project page</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Delete single project</span></span><br><span class=\"line\"><span class=\"section\">----------------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Delete the &quot;example&quot; project</span><br><span class=\"line\"><span class=\"bullet\">*</span> Ensure &quot;example&quot; project has been deleted</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Delete multiple projects</span></span><br><span class=\"line\"><span class=\"section\">-------------------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Delete all the projects in the list</span><br><span class=\"line\"><span class=\"bullet\">*</span> Ensure project list is empty</span><br><span class=\"line\"><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"emphasis\">_</span></span><br><span class=\"line\"><span class=\"emphasis\">These are teardown steps</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">* Logout user &quot;mike&quot;</span></span><br><span class=\"line\"><span class=\"emphasis\">* Delete user &quot;mike&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>在上述示例spec中，<code>Logout user &quot;mike&quot;</code>和 <code>Delete user &quot;mike&quot;</code>是tear down步骤，它们在三个或者更多连续下划线后被定义。<br>Spec执行过程应该是:</p>\n<ol>\n<li>上下文执行</li>\n<li><code>Delete single project</code>场景执行</li>\n<li>Tear down步骤执行</li>\n<li>上下文执行</li>\n<li><code>Delete multiple projects</code>场景执行</li>\n<li>Tear down步骤执行</li>\n</ol>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Gauge语法\"><a href=\"#Gauge语法\" class=\"headerlink\" title=\"Gauge语法\"></a>Gauge语法</h1><h2 id=\"Specifications（spec）\"><a href=\"#Specifications（spec）\" class=\"headerlink\" title=\"Specifications（spec）\"></a>Specifications（spec）</h2><p>它们是业务层测试用例，也可以做为您的功能文档。它们是用业务语言编写，通常spec或者specification描述了被测应用的特定特征。</p>\n<ul>\n<li>它们编写在.spec后缀的文件内。Gauge也支持.md文件格式。</li>\n<li>Specification文件的标记是基于markdown语法。</li>\n</ul>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># Specification Heading</span></span><br><span class=\"line\"></span><br><span class=\"line\">This is an executable specification file. This file follows markdown syntax.</span><br><span class=\"line\">Every heading in this file denotes a scenario. Every bulleted point denotes a step.</span><br><span class=\"line\"></span><br><span class=\"line\">To execute this specification, run</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"code\">    gauge run specs</span></span><br><span class=\"line\"><span class=\"code\"></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> Vowels in English language are &quot;aeiou&quot;.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">## Vowel counts in single word</span></span><br><span class=\"line\"></span><br><span class=\"line\">tags: single word</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> The word &quot;gauge&quot; has &quot;3&quot; vowels.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"specification标题\"><a href=\"#specification标题\" class=\"headerlink\" title=\"specification标题\"></a>specification标题</h3><p>Spec文件必须以spec标题开始，且一个spec文件只能包含一个spec标题。<br>它是以&lt; H1 &gt;的markdown语法编写，可以使用以下两种形式：</p>\n<blockquote>\n<h1 id=\"Specification-Heading\"><a href=\"#Specification-Heading\" class=\"headerlink\" title=\"Specification Heading\"></a>Specification Heading</h1></blockquote>\n<blockquote>\n<p>Specification Heading </p>\n<p>===================</p>\n</blockquote>\n<ul>\n<li>每个spec必须包含一个或者多个Scenarios；</li>\n<li>每个spec可以使用Tags标记。</li>\n</ul>\n<h3 id=\"Scenarios（场景）\"><a href=\"#Scenarios（场景）\" class=\"headerlink\" title=\"Scenarios（场景）\"></a>Scenarios（场景）</h3><p>每个场景代表特定spec中的单个流。Spec必须包含至少一个scenario。<br>一个场景在场景标题或者场景名后开始。场景标题以&lt; H2&gt;的markdown语法编写，可以使用以下两种形式:</p>\n<blockquote>\n<h2 id=\"Vowel-counts-in-single-word\"><a href=\"#Vowel-counts-in-single-word\" class=\"headerlink\" title=\"Vowel counts in single word\"></a>Vowel counts in single word</h2></blockquote>\n<blockquote>\n<p>Vowel counts in single word</p>\n<hr>\n</blockquote>\n<ul>\n<li>一个场景包含一个或者更多步骤在scenario名的下面</li>\n<li>可以使用标签来标记场景</li>\n</ul>\n<p>示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">## Vowel counts in single word</span></span><br><span class=\"line\"></span><br><span class=\"line\">tags: single word</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> The word &quot;gauge&quot; has &quot;3&quot; vowels.</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Steps（步骤）\"><a href=\"#Steps（步骤）\" class=\"headerlink\" title=\"Steps（步骤）\"></a>Steps（步骤）</h3><p>steps是您的spec内的可执行组件，它们被写为无序列表项（项目符号）。</p>\n<p>它们写在spec中作为：</p>\n<ul>\n<li>上下文步骤</li>\n<li>tear down步骤</li>\n<li>在scenario中的步骤或者concept中的步骤<br>每一个步骤都有一个使用编程语言的底层代码实现。当spec内的步骤执行时被执行。<br>参阅不同语言下的步骤实现。</li>\n</ul>\n<p>示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> Vowels in English language are &quot;aeiou&quot;.</span><br><span class=\"line\"><span class=\"bullet\">*</span> The word &quot;gauge&quot; has &quot;3&quot; vowels.</span><br></pre></td></tr></table></figure>\n\n<p>以引号表示的值是作为语言特定结构传递到基础步骤实现的参数。<br>注意：下面的字符是为参数保留的，它们不可以使用在step内。</p>\n<ul>\n<li><p>“</p>\n</li>\n<li><p>&lt;</p>\n</li>\n<li><blockquote>\n</blockquote>\n</li>\n</ul>\n<h3 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h3><p>可以定义步骤以将值作为参数 ，以便可以使用不同的参数值来重新使用。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* Check &quot;product 1&quot; exists</span><br><span class=\"line\">* Check &quot;product 2&quot; exists</span><br></pre></td></tr></table></figure>\n\n<p>在代码里的底层步骤实现里，必须和步骤传递来的参数数量一致。<br>传递给步骤的参数是下列类型：</p>\n<h4 id=\"简单参数\"><a href=\"#简单参数\" class=\"headerlink\" title=\"简单参数\"></a>简单参数</h4><p>它们是以双引号引入到步骤里的值。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* Create a “gauge-java” project</span><br><span class=\"line\">* Write “100” line specification</span><br></pre></td></tr></table></figure>\n\n<p>备注：<br>重命名参数将不会改变方法中的用法。根据设计，重命名的参数被认为是一个新的参数。因此，必须手动修改旧参数（如果有的话）的使用以解决相应的编译问题。</p>\n<h4 id=\"动态参数\"><a href=\"#动态参数\" class=\"headerlink\" title=\"动态参数\"></a>动态参数</h4><p>动态参数作为值的占位符。<br><strong>语法</strong>：&lt; dynamic_param &gt;<br>动态参数主要使用在当数据驱动引用表列的值被执行时，或者将值传递给concepts时。</p>\n<p>示例</p>\n<p>example.cpt</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># A sample concept that takes a <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">parameter</span>&gt;</span></span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> And used the <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">parameter</span>&gt;</span></span> in a step.</span><br></pre></td></tr></table></figure>\n\n<p>上述concept可以被调用，并且可以在调用时将值传递给针对&lt; parameter&gt;的concept.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* A sample concept that takes a &quot;dummy value&quot;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"表格参数\"><a href=\"#表格参数\" class=\"headerlink\" title=\"表格参数\"></a>表格参数</h4><p>表格参数可以在以下两种方式使用</p>\n<ul>\n<li>当要针对多组数据执行spec中的场景或者多个场景时，可以使用数据驱动执行</li>\n<li>表或者内联表可以作为参数传递给步骤</li>\n</ul>\n<h5 id=\"数据表的值在内联表内\"><a href=\"#数据表的值在内联表内\" class=\"headerlink\" title=\"数据表的值在内联表内\"></a>数据表的值在内联表内</h5><p>数据表内的动态值也可以参考传递给步骤的表格参数</p>\n<p>示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">create projects</span></span><br><span class=\"line\"><span class=\"section\">================</span></span><br><span class=\"line\">|id| name |</span><br><span class=\"line\">|--| ---- |</span><br><span class=\"line\">|1 | john |</span><br><span class=\"line\">|2 | mike |</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">First scenario</span></span><br><span class=\"line\"><span class=\"section\">---------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Create the following projects</span><br><span class=\"line\"><span class=\"code\">    |project name| username |</span></span><br><span class=\"line\"><span class=\"code\">    |------------|----------|</span></span><br><span class=\"line\"><span class=\"code\">    | Gauge java | &lt;name&gt;   |</span></span><br><span class=\"line\"><span class=\"code\">    | Gauge ruby | &lt;name&gt;   |</span></span><br><span class=\"line\"><span class=\"code\"></span></span><br></pre></td></tr></table></figure>\n\n<p>在上述的示例，表格参数使用数据表格内的动态值。</p>\n<p>Step_impl.py</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@step(<span class=\"params\"><span class=\"string\">&quot;Create the following projects &lt;table&gt;&quot;</span></span>)</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">assert_words_vowel_count</span>(<span class=\"params\">table</span>):</span><br><span class=\"line\">     <span class=\"comment\"># 获取table的行数据</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span> item <span class=\"keyword\">in</span> table:</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(item)</span><br><span class=\"line\">        <span class=\"comment\"># 获取每行column的值</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> index <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"built_in\">len</span>(item)):</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(item[index])</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"特殊参数\"><a href=\"#特殊参数\" class=\"headerlink\" title=\"特殊参数\"></a>特殊参数</h4><p>特殊参数提供了将更大更丰富的数据作为参数传递到步骤的能力。</p>\n<ul>\n<li>它们在步骤中以尖括号 -&lt;&gt; 输入</li>\n<li>它们包含两个由冒号分割的部分 :</li>\n</ul>\n<blockquote>\n<p>&lt; prefix:value&gt;</p>\n</blockquote>\n<p><strong>Prefix</strong>：定义特殊参数的类型，比如：file，table<br><strong>Value</strong>：定义特殊参数的值<br>有两种特殊类型：</p>\n<ul>\n<li><a href=\"https://docs.gauge.org/writing-specifications.html?os=macos&language=python&ide=vscode\">File</a></li>\n<li>CSV</li>\n</ul>\n<h5 id=\"特殊参数-文件\"><a href=\"#特殊参数-文件\" class=\"headerlink\" title=\"特殊参数:文件\"></a>特殊参数:文件</h5><p>这是通过读取文件然后将文件内容作为字符串参数传给底层步骤。<br><strong>语法</strong>：&lt; file:[value]&gt; [value]是指文件的路径</p>\n<p>[value]可以是相对或者绝对路径。相对路径相对于GAUGE_PROJECT_ROOT来解析。</p>\n<p><strong>文件的路径可以是相对Gague项目路径的相对路径或者文件的绝对路径。</strong></p>\n<p>示例</p>\n<p>email.txt是绝对路径文件,/work/content.txt是相对路径文件</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> Verify email text is <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">file:email.txt</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Check if <span class=\"language-xml\">&lt;file:/work/content.txt&gt;</span> is visible</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"特殊参数-CSV\"><a href=\"#特殊参数-CSV\" class=\"headerlink\" title=\"特殊参数:CSV\"></a>特殊参数:CSV</h5><p>表格通常用于从外部csv文件读取再传递表格值给steps。步骤中的参数文本包含前缀表和csv文件的路径。<br><strong>语法</strong>：&lt; table:[value]&gt; [value]是指csv文件的路径。</p>\n<p>示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> Step that takes a table <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">table:data.csv</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Check if the following users exist <span class=\"language-xml\">&lt;table:/Users/john/work/users.csv&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h6 id=\"简单的csv文件\"><a href=\"#简单的csv文件\" class=\"headerlink\" title=\"简单的csv文件\"></a>简单的csv文件</h6><figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Id,Name</span><br><span class=\"line\">1,The Way to Go On</span><br><span class=\"line\">2,Ivo Jay Balbaert</span><br></pre></td></tr></table></figure>\n\n<p>第一行被视为表头，后面的行视为列的值。</p>\n<h3 id=\"标签\"><a href=\"#标签\" class=\"headerlink\" title=\"标签\"></a>标签</h3><p>Tags用于将标签与sepc或者scenarios关联。标签用前缀Tags:和逗号分割值写成。</p>\n<ul>\n<li>Spec和scenarios可以单独标记</li>\n<li>只能将一组标签添加到单个spec或者scenario中</li>\n</ul>\n<p>它们有助于基于使用标签的标签来过滤spec或者scenario。</p>\n<p><strong>示例</strong></p>\n<p>在下面的例子里<code>Login specification</code>和<code>Successful login scenario</code>场景都有标签。</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Login specifications</span></span><br><span class=\"line\"><span class=\"section\">======================</span></span><br><span class=\"line\">Tags: login, admin, user-test</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Successful login scenario</span></span><br><span class=\"line\"><span class=\"section\">-------------------------</span></span><br><span class=\"line\">Tags: login-success, admin</span><br></pre></td></tr></table></figure>\n\n<p>应用在spec的标签自动应用在哪个场景。可以通过 <code>gauge run --tags &#39;test&#39; test.spec</code>指定运行哪个场景。</p>\n<h3 id=\"Concepts\"><a href=\"#Concepts\" class=\"headerlink\" title=\"Concepts\"></a>Concepts</h3><p>Concepts提供将步骤中的重复使用的逻辑组组合到一个单元中的能力。它通过组合步骤来提供更高层次的业务意图抽象。<br>它们在项目中specs文件夹的.cpt格式文件内被定义。它们也可以保存在specs文件夹的子目录内。</p>\n<ul>\n<li>Concepts在spec的使用就象其他步骤一样，将适当的参数传递给它们。</li>\n<li>Concepts下的所有步骤都按照定义的顺序执行。</li>\n</ul>\n<p><strong>备注</strong>：一个.cpt文件可以包含多个concept定义</p>\n<h4 id=\"concept定义\"><a href=\"#concept定义\" class=\"headerlink\" title=\"concept定义\"></a>concept定义</h4><p>使用concept定义在sepcs文件夹内创建一个.cpt文件。Concept定义包含两部分：</p>\n<h5 id=\"Concept标题\"><a href=\"#Concept标题\" class=\"headerlink\" title=\"Concept标题\"></a>Concept标题</h5><p>concept标题定义concept的名字和它将使用的参数。它写成markdown <code>H1</code>格式。</p>\n<ul>\n<li>所有的参数被定义在角括号<code>&lt;&gt;</code></li>\n<li>一个concept的定义必须包含concept标题</li>\n</ul>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># Concept name with <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">param0</span>&gt;</span></span> and <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">param1</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h5><p>concept里的步骤紧跟concept标题。它们以常用的步骤结构定义。</p>\n<ul>\n<li>所有从concept标题使用的参数在<code>&lt;&gt;</code>内</li>\n<li>固定的静态参数用<code>&quot;&quot;</code>括起来</li>\n<li>concept定义也可以调用其他concept</li>\n</ul>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\"># Login as user <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">username</span>&gt;</span></span> and create project <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">project_name</span>&gt;</span></span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> Login as user <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">username</span>&gt;</span></span> and &quot;password&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Navigate to project page</span><br><span class=\"line\"><span class=\"bullet\">*</span> Create a project <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">project_name</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>在上面的示例：</p>\n<ul>\n<li>第一行是concept标题</li>\n<li>下面三行是在concept中的抽象</li>\n</ul>\n<h3 id=\"上下文\"><a href=\"#上下文\" class=\"headerlink\" title=\"上下文\"></a>上下文</h3><p>上下文或者上下文步骤是在任何场景之前被定义在spec的步骤。<br>它们允许您指定必须用来执行spec步骤的条件集合。上下文步骤可以用来在执行场景前初始化数据。它们也可以完成setup或者tear down功能。</p>\n<ul>\n<li>任何常规步骤可以作为上下文</li>\n<li>上下文在执行场景前被执行</li>\n</ul>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Delete project</span></span><br><span class=\"line\"><span class=\"section\">================</span></span><br><span class=\"line\">These are context steps</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> User is logged in as &quot;mike&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Navigate to the project page</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Delete single project</span></span><br><span class=\"line\"><span class=\"section\">----------------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Delete the &quot;example&quot; project</span><br><span class=\"line\"><span class=\"bullet\">*</span> Ensure &quot;example&quot; project has been deleted</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Delete multiple projects</span></span><br><span class=\"line\"><span class=\"section\">-------------------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Delete all the projects in the list</span><br><span class=\"line\"><span class=\"bullet\">*</span> Ensure project list is empty</span><br></pre></td></tr></table></figure>\n\n<p>在上面的示例spec中，<code>User is logged in as Mike</code> 和 <code>Navigate to the project page</code>是上下文步骤，它们在任意场景前被定义。这些步骤在每个场景<code>Delete single project</code>和<code>Delete multiple projects</code>执行之前被执行。<br>Spec执行过程应该是:</p>\n<ol>\n<li>上下文执行</li>\n<li><code>Delete single project</code>场景执行</li>\n<li>上下文执行</li>\n<li><code>Delete multiple projects</code>场景执行</li>\n</ol>\n<h3 id=\"Tear-Down步骤\"><a href=\"#Tear-Down步骤\" class=\"headerlink\" title=\"Tear Down步骤\"></a>Tear Down步骤</h3><p>Tear Down步骤在最后一个场景后被定义在spec内的步骤。它们允许你在每个场景执行后指定一系列清理步骤。它们被用来完成tear down功能。</p>\n<ul>\n<li>任何常规的步骤可以作为tear down步骤</li>\n<li>tear down步骤在每个spec内的场景执行后被执行</li>\n</ul>\n<h4 id=\"语法\"><a href=\"#语法\" class=\"headerlink\" title=\"语法\"></a>语法</h4><p><code>___</code>:三个或者更多的连续下划线指示tear down的开始。编写在tear down内（在三个或者更多联系的下划线之后）的步骤将被认为是tear down步骤。</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">__<span class=\"emphasis\">_</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">* Tear down step 1</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">* Tear down step 2</span></span></span><br><span class=\"line\"><span class=\"emphasis\"><span class=\"strong\">* Tear down step 3</span></span></span><br></pre></td></tr></table></figure>\n\n<p>完整示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Delete project</span></span><br><span class=\"line\"><span class=\"section\">================</span></span><br><span class=\"line\">These are context steps</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> User is logged in as &quot;mike&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Navigate to the project page</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Delete single project</span></span><br><span class=\"line\"><span class=\"section\">----------------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Delete the &quot;example&quot; project</span><br><span class=\"line\"><span class=\"bullet\">*</span> Ensure &quot;example&quot; project has been deleted</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Delete multiple projects</span></span><br><span class=\"line\"><span class=\"section\">-------------------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Delete all the projects in the list</span><br><span class=\"line\"><span class=\"bullet\">*</span> Ensure project list is empty</span><br><span class=\"line\"><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"strong\">____</span><span class=\"emphasis\">_</span></span><br><span class=\"line\"><span class=\"emphasis\">These are teardown steps</span></span><br><span class=\"line\"><span class=\"emphasis\"></span></span><br><span class=\"line\"><span class=\"emphasis\">* Logout user &quot;mike&quot;</span></span><br><span class=\"line\"><span class=\"emphasis\">* Delete user &quot;mike&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>在上述示例spec中，<code>Logout user &quot;mike&quot;</code>和 <code>Delete user &quot;mike&quot;</code>是tear down步骤，它们在三个或者更多连续下划线后被定义。<br>Spec执行过程应该是:</p>\n<ol>\n<li>上下文执行</li>\n<li><code>Delete single project</code>场景执行</li>\n<li>Tear down步骤执行</li>\n<li>上下文执行</li>\n<li><code>Delete multiple projects</code>场景执行</li>\n<li>Tear down步骤执行</li>\n</ol>\n"},{"uuid":"bbaef9f9-c0ab-11ec-92a1-7557b2313227","title":"Git命令清单","abbrlink":"a9a6c8b0","date":"2022-03-19T06:26:20.000Z","_content":"\n# Git命令清单\n\n一般来说，日常使用只要记住下图6个命令，就可以了。但是熟练使用，恐怕要记住60～100个命令。\n\n![imagesgit.png](https://raw.githubusercontent.com/xzyup/image/master/202203191455284.png)\n\n下面是常用 的Git 命令清单。几个专用名词的译名如下：\n\n- Workspace：工作区\n- Index / Stage：暂存区\n- Repository：仓库区（或本地仓库）\n- Remote：远程仓库\n\n#### 一、新建代码库\n\n~~~bash\n# 在当前目录新建一个Git代码库\n$ git init\n\n# 新建一个目录，将其初始化为Git代码库\n$ git init [project-name]\n\n# 下载一个项目和它的整个代码历史\n$ git clone [url]\n~~~\n\n#### 二、配置\n\nGit的设置文件为`.gitconfig`，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）。\n\n~~~bash\n# 显示当前的Git配置\n$ git config --list\n\n# 编辑Git配置文件\n$ git config -e [--global]\n\n# 设置提交代码时的用户信息\n$ git config [--global] user.name \"[name]\"\n$ git config [--global] user.email \"[email address]\"\n~~~\n\n#### 三、增加/删除文件\n\n~~~bash\n# 添加指定文件到暂存区\n$ git add [file1] [file2] ...\n\n# 添加指定目录到暂存区，包括子目录\n$ git add [dir]\n\n# 添加当前目录的所有文件到暂存区\n$ git add .\n\n# 添加每个变化前，都会要求确认\n# 对于同一个文件的多处变化，可以实现分次提交\n$ git add -p\n\n# 删除工作区文件，并且将这次删除放入暂存区\n$ git rm [file1] [file2] ...\n\n# 停止追踪指定文件，但该文件会保留在工作区\n$ git rm --cached [file]\n\n# 改名文件，并且将这个改名放入暂存区\n$ git mv [file-original] [file-renamed]\n~~~\n\n#### 四、代码提交\n\n~~~bash\n# 提交暂存区到仓库区\n$ git commit -m [message]\n\n# 提交暂存区的指定文件到仓库区\n$ git commit [file1] [file2] ... -m [message]\n\n# 提交工作区自上次commit之后的变化，直接到仓库区\n$ git commit -a\n\n# 提交时显示所有diff信息\n$ git commit -v\n\n# 使用一次新的commit，替代上一次提交\n# 如果代码没有任何新变化，则用来改写上一次commit的提交信息\n$ git commit --amend -m [message]\n\n# 重做上一次commit，并包括指定文件的新变化\n$ git commit --amend [file1] [file2] ...\n~~~\n\n#### 五、分支\n\n~~~bash\n# 列出所有本地分支\n$ git branch\n\n# 列出所有远程分支\n$ git branch -r\n\n# 列出所有本地分支和远程分支\n$ git branch -a\n\n# 新建一个分支，但依然停留在当前分支\n$ git branch [branch-name]\n\n# 新建一个分支，并切换到该分支\n$ git checkout -b [branch]\n\n# 新建一个分支，指向指定commit\n$ git branch [branch] [commit]\n\n# 新建一个分支，与指定的远程分支建立追踪关系\n$ git branch --track [branch] [remote-branch]\n\n# 切换到指定分支，并更新工作区\n$ git checkout [branch-name]\n\n# 切换到上一个分支\n$ git checkout -\n\n# 建立追踪关系，在现有分支与指定的远程分支之间\n$ git branch --set-upstream [branch] [remote-branch]\n\n# 合并指定分支到当前分支\n$ git merge [branch]\n\n# 选择一个commit，合并进当前分支\n$ git cherry-pick [commit]\n\n# 删除分支\n$ git branch -d [branch-name]\n\n# 删除远程分支\n$ git push origin --delete [branch-name]\n$ git branch -dr [remote/branch]\n~~~\n\n#### 六、标签\n\n~~~bash\n# 列出所有tag\n$ git tag\n\n# 新建一个tag在当前commit\n$ git tag [tag]\n\n# 新建一个tag在指定commit\n$ git tag [tag] [commit]\n\n# 删除本地tag\n$ git tag -d [tag]\n\n# 删除远程tag\n$ git push origin :refs/tags/[tagName]\n\n# 查看tag信息\n$ git show [tag]\n\n# 提交指定tag\n$ git push [remote] [tag]\n\n# 提交所有tag\n$ git push [remote] --tags\n\n# 新建一个分支，指向某个tag\n$ git checkout -b [branch] [tag]\n~~~\n\n#### 七、查看信息\n\n~~~bash\n# 显示有变更的文件\n$ git status\n\n# 显示当前分支的版本历史\n$ git log\n\n# 显示commit历史，以及每次commit发生变更的文件\n$ git log --stat\n\n# 搜索提交历史，根据关键词\n$ git log -S [keyword]\n\n# 显示某个commit之后的所有变动，每个commit占据一行\n$ git log [tag] HEAD --pretty=format:%s\n\n# 显示某个commit之后的所有变动，其\"提交说明\"必须符合搜索条件\n$ git log [tag] HEAD --grep feature\n\n# 显示某个文件的版本历史，包括文件改名\n$ git log --follow [file]\n$ git whatchanged [file]\n\n# 显示指定文件相关的每一次diff\n$ git log -p [file]\n\n# 显示过去5次提交\n$ git log -5 --pretty --oneline\n\n# 显示所有提交过的用户，按提交次数排序\n$ git shortlog -sn\n\n# 显示指定文件是什么人在什么时间修改过\n$ git blame [file]\n\n# 显示暂存区和工作区的差异\n$ git diff\n\n# 显示暂存区和上一个commit的差异\n$ git diff --cached [file]\n\n# 显示工作区与当前分支最新commit之间的差异\n$ git diff HEAD\n\n# 显示两次提交之间的差异\n$ git diff [first-branch]...[second-branch]\n\n# 显示今天你写了多少行代码\n$ git diff --shortstat \"@{0 day ago}\"\n\n# 显示某次提交的元数据和内容变化\n$ git show [commit]\n\n# 显示某次提交发生变化的文件\n$ git show --name-only [commit]\n\n# 显示某次提交时，某个文件的内容\n$ git show [commit]:[filename]\n\n# 显示当前分支的最近几次提交\n$ git reflog\n~~~\n\n#### 八、远程同步\n\n~~~bash\n# 下载远程仓库的所有变动\n$ git fetch [remote]\n\n# 显示所有远程仓库\n$ git remote -v\n\n# 显示某个远程仓库的信息\n$ git remote show [remote]\n\n# 增加一个新的远程仓库，并命名\n$ git remote add [shortname] [url]\n\n# 取回远程仓库的变化，并与本地分支合并\n$ git pull [remote] [branch]\n\n# 上传本地指定分支到远程仓库\n$ git push [remote] [branch]\n\n# 强行推送当前分支到远程仓库，即使有冲突\n$ git push [remote] --force\n\n# 推送所有分支到远程仓库\n$ git push [remote] --all\n~~~\n\n#### 九、撤销\n\n~~~bash\n# 恢复暂存区的指定文件到工作区\n$ git checkout [file]\n\n# 恢复某个commit的指定文件到暂存区和工作区\n$ git checkout [commit] [file]\n\n# 恢复暂存区的所有文件到工作区\n$ git checkout .\n\n# 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变\n$ git reset [file]\n\n# 重置暂存区与工作区，与上一次commit保持一致\n$ git reset --hard\n\n# 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变\n$ git reset [commit]\n\n# 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致\n$ git reset --hard [commit]\n\n# 重置当前HEAD为指定commit，但保持暂存区和工作区不变\n$ git reset --keep [commit]\n\n# 新建一个commit，用来撤销指定commit\n# 后者的所有变化都将被前者抵消，并且应用到当前分支\n$ git revert [commit]\n\n# 暂时将未提交的变化移除，稍后再移入\n$ git stash\n$ git stash pop\n~~~\n\n#### 十、其他\n\n~~~bash\n# 生成一个可供发布的压缩包\n$ git archive\n~~~\n\n","source":"_posts/git/git-commands.md","raw":"---\nuuid: bbaef9f9-c0ab-11ec-92a1-7557b2313227\ntitle: Git命令清单\ntags: Git\ncategories: Git\nabbrlink: a9a6c8b0\ndate: 2022-03-19 14:26:20\n---\n\n# Git命令清单\n\n一般来说，日常使用只要记住下图6个命令，就可以了。但是熟练使用，恐怕要记住60～100个命令。\n\n![imagesgit.png](https://raw.githubusercontent.com/xzyup/image/master/202203191455284.png)\n\n下面是常用 的Git 命令清单。几个专用名词的译名如下：\n\n- Workspace：工作区\n- Index / Stage：暂存区\n- Repository：仓库区（或本地仓库）\n- Remote：远程仓库\n\n#### 一、新建代码库\n\n~~~bash\n# 在当前目录新建一个Git代码库\n$ git init\n\n# 新建一个目录，将其初始化为Git代码库\n$ git init [project-name]\n\n# 下载一个项目和它的整个代码历史\n$ git clone [url]\n~~~\n\n#### 二、配置\n\nGit的设置文件为`.gitconfig`，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）。\n\n~~~bash\n# 显示当前的Git配置\n$ git config --list\n\n# 编辑Git配置文件\n$ git config -e [--global]\n\n# 设置提交代码时的用户信息\n$ git config [--global] user.name \"[name]\"\n$ git config [--global] user.email \"[email address]\"\n~~~\n\n#### 三、增加/删除文件\n\n~~~bash\n# 添加指定文件到暂存区\n$ git add [file1] [file2] ...\n\n# 添加指定目录到暂存区，包括子目录\n$ git add [dir]\n\n# 添加当前目录的所有文件到暂存区\n$ git add .\n\n# 添加每个变化前，都会要求确认\n# 对于同一个文件的多处变化，可以实现分次提交\n$ git add -p\n\n# 删除工作区文件，并且将这次删除放入暂存区\n$ git rm [file1] [file2] ...\n\n# 停止追踪指定文件，但该文件会保留在工作区\n$ git rm --cached [file]\n\n# 改名文件，并且将这个改名放入暂存区\n$ git mv [file-original] [file-renamed]\n~~~\n\n#### 四、代码提交\n\n~~~bash\n# 提交暂存区到仓库区\n$ git commit -m [message]\n\n# 提交暂存区的指定文件到仓库区\n$ git commit [file1] [file2] ... -m [message]\n\n# 提交工作区自上次commit之后的变化，直接到仓库区\n$ git commit -a\n\n# 提交时显示所有diff信息\n$ git commit -v\n\n# 使用一次新的commit，替代上一次提交\n# 如果代码没有任何新变化，则用来改写上一次commit的提交信息\n$ git commit --amend -m [message]\n\n# 重做上一次commit，并包括指定文件的新变化\n$ git commit --amend [file1] [file2] ...\n~~~\n\n#### 五、分支\n\n~~~bash\n# 列出所有本地分支\n$ git branch\n\n# 列出所有远程分支\n$ git branch -r\n\n# 列出所有本地分支和远程分支\n$ git branch -a\n\n# 新建一个分支，但依然停留在当前分支\n$ git branch [branch-name]\n\n# 新建一个分支，并切换到该分支\n$ git checkout -b [branch]\n\n# 新建一个分支，指向指定commit\n$ git branch [branch] [commit]\n\n# 新建一个分支，与指定的远程分支建立追踪关系\n$ git branch --track [branch] [remote-branch]\n\n# 切换到指定分支，并更新工作区\n$ git checkout [branch-name]\n\n# 切换到上一个分支\n$ git checkout -\n\n# 建立追踪关系，在现有分支与指定的远程分支之间\n$ git branch --set-upstream [branch] [remote-branch]\n\n# 合并指定分支到当前分支\n$ git merge [branch]\n\n# 选择一个commit，合并进当前分支\n$ git cherry-pick [commit]\n\n# 删除分支\n$ git branch -d [branch-name]\n\n# 删除远程分支\n$ git push origin --delete [branch-name]\n$ git branch -dr [remote/branch]\n~~~\n\n#### 六、标签\n\n~~~bash\n# 列出所有tag\n$ git tag\n\n# 新建一个tag在当前commit\n$ git tag [tag]\n\n# 新建一个tag在指定commit\n$ git tag [tag] [commit]\n\n# 删除本地tag\n$ git tag -d [tag]\n\n# 删除远程tag\n$ git push origin :refs/tags/[tagName]\n\n# 查看tag信息\n$ git show [tag]\n\n# 提交指定tag\n$ git push [remote] [tag]\n\n# 提交所有tag\n$ git push [remote] --tags\n\n# 新建一个分支，指向某个tag\n$ git checkout -b [branch] [tag]\n~~~\n\n#### 七、查看信息\n\n~~~bash\n# 显示有变更的文件\n$ git status\n\n# 显示当前分支的版本历史\n$ git log\n\n# 显示commit历史，以及每次commit发生变更的文件\n$ git log --stat\n\n# 搜索提交历史，根据关键词\n$ git log -S [keyword]\n\n# 显示某个commit之后的所有变动，每个commit占据一行\n$ git log [tag] HEAD --pretty=format:%s\n\n# 显示某个commit之后的所有变动，其\"提交说明\"必须符合搜索条件\n$ git log [tag] HEAD --grep feature\n\n# 显示某个文件的版本历史，包括文件改名\n$ git log --follow [file]\n$ git whatchanged [file]\n\n# 显示指定文件相关的每一次diff\n$ git log -p [file]\n\n# 显示过去5次提交\n$ git log -5 --pretty --oneline\n\n# 显示所有提交过的用户，按提交次数排序\n$ git shortlog -sn\n\n# 显示指定文件是什么人在什么时间修改过\n$ git blame [file]\n\n# 显示暂存区和工作区的差异\n$ git diff\n\n# 显示暂存区和上一个commit的差异\n$ git diff --cached [file]\n\n# 显示工作区与当前分支最新commit之间的差异\n$ git diff HEAD\n\n# 显示两次提交之间的差异\n$ git diff [first-branch]...[second-branch]\n\n# 显示今天你写了多少行代码\n$ git diff --shortstat \"@{0 day ago}\"\n\n# 显示某次提交的元数据和内容变化\n$ git show [commit]\n\n# 显示某次提交发生变化的文件\n$ git show --name-only [commit]\n\n# 显示某次提交时，某个文件的内容\n$ git show [commit]:[filename]\n\n# 显示当前分支的最近几次提交\n$ git reflog\n~~~\n\n#### 八、远程同步\n\n~~~bash\n# 下载远程仓库的所有变动\n$ git fetch [remote]\n\n# 显示所有远程仓库\n$ git remote -v\n\n# 显示某个远程仓库的信息\n$ git remote show [remote]\n\n# 增加一个新的远程仓库，并命名\n$ git remote add [shortname] [url]\n\n# 取回远程仓库的变化，并与本地分支合并\n$ git pull [remote] [branch]\n\n# 上传本地指定分支到远程仓库\n$ git push [remote] [branch]\n\n# 强行推送当前分支到远程仓库，即使有冲突\n$ git push [remote] --force\n\n# 推送所有分支到远程仓库\n$ git push [remote] --all\n~~~\n\n#### 九、撤销\n\n~~~bash\n# 恢复暂存区的指定文件到工作区\n$ git checkout [file]\n\n# 恢复某个commit的指定文件到暂存区和工作区\n$ git checkout [commit] [file]\n\n# 恢复暂存区的所有文件到工作区\n$ git checkout .\n\n# 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变\n$ git reset [file]\n\n# 重置暂存区与工作区，与上一次commit保持一致\n$ git reset --hard\n\n# 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变\n$ git reset [commit]\n\n# 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致\n$ git reset --hard [commit]\n\n# 重置当前HEAD为指定commit，但保持暂存区和工作区不变\n$ git reset --keep [commit]\n\n# 新建一个commit，用来撤销指定commit\n# 后者的所有变化都将被前者抵消，并且应用到当前分支\n$ git revert [commit]\n\n# 暂时将未提交的变化移除，稍后再移入\n$ git stash\n$ git stash pop\n~~~\n\n#### 十、其他\n\n~~~bash\n# 生成一个可供发布的压缩包\n$ git archive\n~~~\n\n","slug":"git/git-commands","published":1,"updated":"2022-05-04T03:03:20.931Z","_id":"cl2qzfthg001u13no611o7rrc","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Git命令清单\"><a href=\"#Git命令清单\" class=\"headerlink\" title=\"Git命令清单\"></a>Git命令清单</h1><p>一般来说，日常使用只要记住下图6个命令，就可以了。但是熟练使用，恐怕要记住60～100个命令。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191455284.png\" alt=\"imagesgit.png\"></p>\n<p>下面是常用 的Git 命令清单。几个专用名词的译名如下：</p>\n<ul>\n<li>Workspace：工作区</li>\n<li>Index / Stage：暂存区</li>\n<li>Repository：仓库区（或本地仓库）</li>\n<li>Remote：远程仓库</li>\n</ul>\n<h4 id=\"一、新建代码库\"><a href=\"#一、新建代码库\" class=\"headerlink\" title=\"一、新建代码库\"></a>一、新建代码库</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 在当前目录新建一个Git代码库</span></span><br><span class=\"line\">$ git init</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个目录，将其初始化为Git代码库</span></span><br><span class=\"line\">$ git init [project-name]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 下载一个项目和它的整个代码历史</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> [url]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"二、配置\"><a href=\"#二、配置\" class=\"headerlink\" title=\"二、配置\"></a>二、配置</h4><p>Git的设置文件为<code>.gitconfig</code>，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 显示当前的Git配置</span></span><br><span class=\"line\">$ git config --list</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编辑Git配置文件</span></span><br><span class=\"line\">$ git config -e [--global]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置提交代码时的用户信息</span></span><br><span class=\"line\">$ git config [--global] user.name <span class=\"string\">&quot;[name]&quot;</span></span><br><span class=\"line\">$ git config [--global] user.email <span class=\"string\">&quot;[email address]&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"三、增加-删除文件\"><a href=\"#三、增加-删除文件\" class=\"headerlink\" title=\"三、增加/删除文件\"></a>三、增加/删除文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 添加指定文件到暂存区</span></span><br><span class=\"line\">$ git add [file1] [file2] ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加指定目录到暂存区，包括子目录</span></span><br><span class=\"line\">$ git add [<span class=\"built_in\">dir</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加当前目录的所有文件到暂存区</span></span><br><span class=\"line\">$ git add .</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加每个变化前，都会要求确认</span></span><br><span class=\"line\"><span class=\"comment\"># 对于同一个文件的多处变化，可以实现分次提交</span></span><br><span class=\"line\">$ git add -p</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除工作区文件，并且将这次删除放入暂存区</span></span><br><span class=\"line\">$ git <span class=\"built_in\">rm</span> [file1] [file2] ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 停止追踪指定文件，但该文件会保留在工作区</span></span><br><span class=\"line\">$ git <span class=\"built_in\">rm</span> --cached [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 改名文件，并且将这个改名放入暂存区</span></span><br><span class=\"line\">$ git <span class=\"built_in\">mv</span> [file-original] [file-renamed]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"四、代码提交\"><a href=\"#四、代码提交\" class=\"headerlink\" title=\"四、代码提交\"></a>四、代码提交</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 提交暂存区到仓库区</span></span><br><span class=\"line\">$ git commit -m [message]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提交暂存区的指定文件到仓库区</span></span><br><span class=\"line\">$ git commit [file1] [file2] ... -m [message]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提交工作区自上次commit之后的变化，直接到仓库区</span></span><br><span class=\"line\">$ git commit -a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提交时显示所有diff信息</span></span><br><span class=\"line\">$ git commit -v</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用一次新的commit，替代上一次提交</span></span><br><span class=\"line\"><span class=\"comment\"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span></span><br><span class=\"line\">$ git commit --amend -m [message]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重做上一次commit，并包括指定文件的新变化</span></span><br><span class=\"line\">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"五、分支\"><a href=\"#五、分支\" class=\"headerlink\" title=\"五、分支\"></a>五、分支</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 列出所有本地分支</span></span><br><span class=\"line\">$ git branch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 列出所有远程分支</span></span><br><span class=\"line\">$ git branch -r</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 列出所有本地分支和远程分支</span></span><br><span class=\"line\">$ git branch -a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个分支，但依然停留在当前分支</span></span><br><span class=\"line\">$ git branch [branch-name]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个分支，并切换到该分支</span></span><br><span class=\"line\">$ git checkout -b [branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个分支，指向指定commit</span></span><br><span class=\"line\">$ git branch [branch] [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个分支，与指定的远程分支建立追踪关系</span></span><br><span class=\"line\">$ git branch --track [branch] [remote-branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 切换到指定分支，并更新工作区</span></span><br><span class=\"line\">$ git checkout [branch-name]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 切换到上一个分支</span></span><br><span class=\"line\">$ git checkout -</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 建立追踪关系，在现有分支与指定的远程分支之间</span></span><br><span class=\"line\">$ git branch --set-upstream [branch] [remote-branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 合并指定分支到当前分支</span></span><br><span class=\"line\">$ git merge [branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 选择一个commit，合并进当前分支</span></span><br><span class=\"line\">$ git cherry-pick [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除分支</span></span><br><span class=\"line\">$ git branch -d [branch-name]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除远程分支</span></span><br><span class=\"line\">$ git push origin --delete [branch-name]</span><br><span class=\"line\">$ git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"六、标签\"><a href=\"#六、标签\" class=\"headerlink\" title=\"六、标签\"></a>六、标签</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 列出所有tag</span></span><br><span class=\"line\">$ git tag</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个tag在当前commit</span></span><br><span class=\"line\">$ git tag [tag]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个tag在指定commit</span></span><br><span class=\"line\">$ git tag [tag] [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除本地tag</span></span><br><span class=\"line\">$ git tag -d [tag]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除远程tag</span></span><br><span class=\"line\">$ git push origin :refs/tags/[tagName]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看tag信息</span></span><br><span class=\"line\">$ git show [tag]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提交指定tag</span></span><br><span class=\"line\">$ git push [remote] [tag]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提交所有tag</span></span><br><span class=\"line\">$ git push [remote] --tags</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个分支，指向某个tag</span></span><br><span class=\"line\">$ git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"七、查看信息\"><a href=\"#七、查看信息\" class=\"headerlink\" title=\"七、查看信息\"></a>七、查看信息</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 显示有变更的文件</span></span><br><span class=\"line\">$ git status</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示当前分支的版本历史</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示commit历史，以及每次commit发生变更的文件</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> --<span class=\"built_in\">stat</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 搜索提交历史，根据关键词</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> -S [keyword]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某个commit之后的所有变动，每个commit占据一行</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> [tag] HEAD --pretty=format:%s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某个commit之后的所有变动，其&quot;提交说明&quot;必须符合搜索条件</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> [tag] HEAD --grep feature</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某个文件的版本历史，包括文件改名</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> --follow [file]</span><br><span class=\"line\">$ git whatchanged [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示指定文件相关的每一次diff</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> -p [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示过去5次提交</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> -5 --pretty --oneline</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示所有提交过的用户，按提交次数排序</span></span><br><span class=\"line\">$ git shortlog -sn</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示指定文件是什么人在什么时间修改过</span></span><br><span class=\"line\">$ git blame [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示暂存区和工作区的差异</span></span><br><span class=\"line\">$ git diff</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示暂存区和上一个commit的差异</span></span><br><span class=\"line\">$ git diff --cached [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示工作区与当前分支最新commit之间的差异</span></span><br><span class=\"line\">$ git diff HEAD</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示两次提交之间的差异</span></span><br><span class=\"line\">$ git diff [first-branch]...[second-branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示今天你写了多少行代码</span></span><br><span class=\"line\">$ git diff --shortstat <span class=\"string\">&quot;@&#123;0 day ago&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某次提交的元数据和内容变化</span></span><br><span class=\"line\">$ git show [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某次提交发生变化的文件</span></span><br><span class=\"line\">$ git show --name-only [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某次提交时，某个文件的内容</span></span><br><span class=\"line\">$ git show [commit]:[filename]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示当前分支的最近几次提交</span></span><br><span class=\"line\">$ git reflog</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"八、远程同步\"><a href=\"#八、远程同步\" class=\"headerlink\" title=\"八、远程同步\"></a>八、远程同步</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 下载远程仓库的所有变动</span></span><br><span class=\"line\">$ git fetch [remote]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示所有远程仓库</span></span><br><span class=\"line\">$ git remote -v</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某个远程仓库的信息</span></span><br><span class=\"line\">$ git remote show [remote]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 增加一个新的远程仓库，并命名</span></span><br><span class=\"line\">$ git remote add [shortname] [url]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 取回远程仓库的变化，并与本地分支合并</span></span><br><span class=\"line\">$ git pull [remote] [branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 上传本地指定分支到远程仓库</span></span><br><span class=\"line\">$ git push [remote] [branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 强行推送当前分支到远程仓库，即使有冲突</span></span><br><span class=\"line\">$ git push [remote] --force</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 推送所有分支到远程仓库</span></span><br><span class=\"line\">$ git push [remote] --all</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"九、撤销\"><a href=\"#九、撤销\" class=\"headerlink\" title=\"九、撤销\"></a>九、撤销</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 恢复暂存区的指定文件到工作区</span></span><br><span class=\"line\">$ git checkout [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 恢复某个commit的指定文件到暂存区和工作区</span></span><br><span class=\"line\">$ git checkout [commit] [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 恢复暂存区的所有文件到工作区</span></span><br><span class=\"line\">$ git checkout .</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</span></span><br><span class=\"line\">$ git reset [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重置暂存区与工作区，与上一次commit保持一致</span></span><br><span class=\"line\">$ git reset --hard</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</span></span><br><span class=\"line\">$ git reset [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</span></span><br><span class=\"line\">$ git reset --hard [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重置当前HEAD为指定commit，但保持暂存区和工作区不变</span></span><br><span class=\"line\">$ git reset --keep [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个commit，用来撤销指定commit</span></span><br><span class=\"line\"><span class=\"comment\"># 后者的所有变化都将被前者抵消，并且应用到当前分支</span></span><br><span class=\"line\">$ git revert [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 暂时将未提交的变化移除，稍后再移入</span></span><br><span class=\"line\">$ git stash</span><br><span class=\"line\">$ git stash pop</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"十、其他\"><a href=\"#十、其他\" class=\"headerlink\" title=\"十、其他\"></a>十、其他</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 生成一个可供发布的压缩包</span></span><br><span class=\"line\">$ git archive</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Git命令清单\"><a href=\"#Git命令清单\" class=\"headerlink\" title=\"Git命令清单\"></a>Git命令清单</h1><p>一般来说，日常使用只要记住下图6个命令，就可以了。但是熟练使用，恐怕要记住60～100个命令。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191455284.png\" alt=\"imagesgit.png\"></p>\n<p>下面是常用 的Git 命令清单。几个专用名词的译名如下：</p>\n<ul>\n<li>Workspace：工作区</li>\n<li>Index / Stage：暂存区</li>\n<li>Repository：仓库区（或本地仓库）</li>\n<li>Remote：远程仓库</li>\n</ul>\n<h4 id=\"一、新建代码库\"><a href=\"#一、新建代码库\" class=\"headerlink\" title=\"一、新建代码库\"></a>一、新建代码库</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 在当前目录新建一个Git代码库</span></span><br><span class=\"line\">$ git init</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个目录，将其初始化为Git代码库</span></span><br><span class=\"line\">$ git init [project-name]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 下载一个项目和它的整个代码历史</span></span><br><span class=\"line\">$ git <span class=\"built_in\">clone</span> [url]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"二、配置\"><a href=\"#二、配置\" class=\"headerlink\" title=\"二、配置\"></a>二、配置</h4><p>Git的设置文件为<code>.gitconfig</code>，它可以在用户主目录下（全局配置），也可以在项目目录下（项目配置）。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 显示当前的Git配置</span></span><br><span class=\"line\">$ git config --list</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 编辑Git配置文件</span></span><br><span class=\"line\">$ git config -e [--global]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 设置提交代码时的用户信息</span></span><br><span class=\"line\">$ git config [--global] user.name <span class=\"string\">&quot;[name]&quot;</span></span><br><span class=\"line\">$ git config [--global] user.email <span class=\"string\">&quot;[email address]&quot;</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"三、增加-删除文件\"><a href=\"#三、增加-删除文件\" class=\"headerlink\" title=\"三、增加/删除文件\"></a>三、增加/删除文件</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 添加指定文件到暂存区</span></span><br><span class=\"line\">$ git add [file1] [file2] ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加指定目录到暂存区，包括子目录</span></span><br><span class=\"line\">$ git add [<span class=\"built_in\">dir</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加当前目录的所有文件到暂存区</span></span><br><span class=\"line\">$ git add .</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 添加每个变化前，都会要求确认</span></span><br><span class=\"line\"><span class=\"comment\"># 对于同一个文件的多处变化，可以实现分次提交</span></span><br><span class=\"line\">$ git add -p</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除工作区文件，并且将这次删除放入暂存区</span></span><br><span class=\"line\">$ git <span class=\"built_in\">rm</span> [file1] [file2] ...</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 停止追踪指定文件，但该文件会保留在工作区</span></span><br><span class=\"line\">$ git <span class=\"built_in\">rm</span> --cached [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 改名文件，并且将这个改名放入暂存区</span></span><br><span class=\"line\">$ git <span class=\"built_in\">mv</span> [file-original] [file-renamed]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"四、代码提交\"><a href=\"#四、代码提交\" class=\"headerlink\" title=\"四、代码提交\"></a>四、代码提交</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 提交暂存区到仓库区</span></span><br><span class=\"line\">$ git commit -m [message]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提交暂存区的指定文件到仓库区</span></span><br><span class=\"line\">$ git commit [file1] [file2] ... -m [message]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提交工作区自上次commit之后的变化，直接到仓库区</span></span><br><span class=\"line\">$ git commit -a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提交时显示所有diff信息</span></span><br><span class=\"line\">$ git commit -v</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用一次新的commit，替代上一次提交</span></span><br><span class=\"line\"><span class=\"comment\"># 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span></span><br><span class=\"line\">$ git commit --amend -m [message]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重做上一次commit，并包括指定文件的新变化</span></span><br><span class=\"line\">$ git commit --amend [file1] [file2] ...</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"五、分支\"><a href=\"#五、分支\" class=\"headerlink\" title=\"五、分支\"></a>五、分支</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 列出所有本地分支</span></span><br><span class=\"line\">$ git branch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 列出所有远程分支</span></span><br><span class=\"line\">$ git branch -r</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 列出所有本地分支和远程分支</span></span><br><span class=\"line\">$ git branch -a</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个分支，但依然停留在当前分支</span></span><br><span class=\"line\">$ git branch [branch-name]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个分支，并切换到该分支</span></span><br><span class=\"line\">$ git checkout -b [branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个分支，指向指定commit</span></span><br><span class=\"line\">$ git branch [branch] [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个分支，与指定的远程分支建立追踪关系</span></span><br><span class=\"line\">$ git branch --track [branch] [remote-branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 切换到指定分支，并更新工作区</span></span><br><span class=\"line\">$ git checkout [branch-name]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 切换到上一个分支</span></span><br><span class=\"line\">$ git checkout -</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 建立追踪关系，在现有分支与指定的远程分支之间</span></span><br><span class=\"line\">$ git branch --set-upstream [branch] [remote-branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 合并指定分支到当前分支</span></span><br><span class=\"line\">$ git merge [branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 选择一个commit，合并进当前分支</span></span><br><span class=\"line\">$ git cherry-pick [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除分支</span></span><br><span class=\"line\">$ git branch -d [branch-name]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除远程分支</span></span><br><span class=\"line\">$ git push origin --delete [branch-name]</span><br><span class=\"line\">$ git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"六、标签\"><a href=\"#六、标签\" class=\"headerlink\" title=\"六、标签\"></a>六、标签</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 列出所有tag</span></span><br><span class=\"line\">$ git tag</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个tag在当前commit</span></span><br><span class=\"line\">$ git tag [tag]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个tag在指定commit</span></span><br><span class=\"line\">$ git tag [tag] [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除本地tag</span></span><br><span class=\"line\">$ git tag -d [tag]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 删除远程tag</span></span><br><span class=\"line\">$ git push origin :refs/tags/[tagName]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看tag信息</span></span><br><span class=\"line\">$ git show [tag]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提交指定tag</span></span><br><span class=\"line\">$ git push [remote] [tag]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 提交所有tag</span></span><br><span class=\"line\">$ git push [remote] --tags</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个分支，指向某个tag</span></span><br><span class=\"line\">$ git checkout -b [branch] [tag]</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"七、查看信息\"><a href=\"#七、查看信息\" class=\"headerlink\" title=\"七、查看信息\"></a>七、查看信息</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 显示有变更的文件</span></span><br><span class=\"line\">$ git status</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示当前分支的版本历史</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示commit历史，以及每次commit发生变更的文件</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> --<span class=\"built_in\">stat</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 搜索提交历史，根据关键词</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> -S [keyword]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某个commit之后的所有变动，每个commit占据一行</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> [tag] HEAD --pretty=format:%s</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某个commit之后的所有变动，其&quot;提交说明&quot;必须符合搜索条件</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> [tag] HEAD --grep feature</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某个文件的版本历史，包括文件改名</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> --follow [file]</span><br><span class=\"line\">$ git whatchanged [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示指定文件相关的每一次diff</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> -p [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示过去5次提交</span></span><br><span class=\"line\">$ git <span class=\"built_in\">log</span> -5 --pretty --oneline</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示所有提交过的用户，按提交次数排序</span></span><br><span class=\"line\">$ git shortlog -sn</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示指定文件是什么人在什么时间修改过</span></span><br><span class=\"line\">$ git blame [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示暂存区和工作区的差异</span></span><br><span class=\"line\">$ git diff</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示暂存区和上一个commit的差异</span></span><br><span class=\"line\">$ git diff --cached [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示工作区与当前分支最新commit之间的差异</span></span><br><span class=\"line\">$ git diff HEAD</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示两次提交之间的差异</span></span><br><span class=\"line\">$ git diff [first-branch]...[second-branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示今天你写了多少行代码</span></span><br><span class=\"line\">$ git diff --shortstat <span class=\"string\">&quot;@&#123;0 day ago&#125;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某次提交的元数据和内容变化</span></span><br><span class=\"line\">$ git show [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某次提交发生变化的文件</span></span><br><span class=\"line\">$ git show --name-only [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某次提交时，某个文件的内容</span></span><br><span class=\"line\">$ git show [commit]:[filename]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示当前分支的最近几次提交</span></span><br><span class=\"line\">$ git reflog</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"八、远程同步\"><a href=\"#八、远程同步\" class=\"headerlink\" title=\"八、远程同步\"></a>八、远程同步</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 下载远程仓库的所有变动</span></span><br><span class=\"line\">$ git fetch [remote]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示所有远程仓库</span></span><br><span class=\"line\">$ git remote -v</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 显示某个远程仓库的信息</span></span><br><span class=\"line\">$ git remote show [remote]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 增加一个新的远程仓库，并命名</span></span><br><span class=\"line\">$ git remote add [shortname] [url]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 取回远程仓库的变化，并与本地分支合并</span></span><br><span class=\"line\">$ git pull [remote] [branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 上传本地指定分支到远程仓库</span></span><br><span class=\"line\">$ git push [remote] [branch]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 强行推送当前分支到远程仓库，即使有冲突</span></span><br><span class=\"line\">$ git push [remote] --force</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 推送所有分支到远程仓库</span></span><br><span class=\"line\">$ git push [remote] --all</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"九、撤销\"><a href=\"#九、撤销\" class=\"headerlink\" title=\"九、撤销\"></a>九、撤销</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 恢复暂存区的指定文件到工作区</span></span><br><span class=\"line\">$ git checkout [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 恢复某个commit的指定文件到暂存区和工作区</span></span><br><span class=\"line\">$ git checkout [commit] [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 恢复暂存区的所有文件到工作区</span></span><br><span class=\"line\">$ git checkout .</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</span></span><br><span class=\"line\">$ git reset [file]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重置暂存区与工作区，与上一次commit保持一致</span></span><br><span class=\"line\">$ git reset --hard</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</span></span><br><span class=\"line\">$ git reset [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</span></span><br><span class=\"line\">$ git reset --hard [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 重置当前HEAD为指定commit，但保持暂存区和工作区不变</span></span><br><span class=\"line\">$ git reset --keep [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 新建一个commit，用来撤销指定commit</span></span><br><span class=\"line\"><span class=\"comment\"># 后者的所有变化都将被前者抵消，并且应用到当前分支</span></span><br><span class=\"line\">$ git revert [commit]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 暂时将未提交的变化移除，稍后再移入</span></span><br><span class=\"line\">$ git stash</span><br><span class=\"line\">$ git stash pop</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"十、其他\"><a href=\"#十、其他\" class=\"headerlink\" title=\"十、其他\"></a>十、其他</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 生成一个可供发布的压缩包</span></span><br><span class=\"line\">$ git archive</span><br></pre></td></tr></table></figure>\n\n"},{"uuid":"bbaef9fa-c0ab-11ec-92a1-7557b2313227","title":"Go相关资料","abbrlink":"be1df389","_content":"\n学习脑图：\n\n> https://github.com/jiujuan/go-collection/blob/master/golang/golang-developer-roadmap.md\n\nGolang从入门到跑路\n\n> https://github.com/jiujuan/go-collection\n\n相关开源库等\n\n> https://www.topgoer.cn/\n","source":"_posts/go/相关资料.md","raw":"---\nuuid: bbaef9fa-c0ab-11ec-92a1-7557b2313227\ntitle: Go相关资料\ntags: Go\ncategories: Go\nabbrlink: be1df389\n---\n\n学习脑图：\n\n> https://github.com/jiujuan/go-collection/blob/master/golang/golang-developer-roadmap.md\n\nGolang从入门到跑路\n\n> https://github.com/jiujuan/go-collection\n\n相关开源库等\n\n> https://www.topgoer.cn/\n","slug":"go/相关资料","published":1,"date":"2022-04-20T12:41:20.780Z","updated":"2022-05-04T03:03:33.564Z","_id":"cl2qzfthh001w13nofsu6b1fa","comments":1,"layout":"post","photos":[],"link":"","content":"<p>学习脑图：</p>\n<blockquote>\n<p><a href=\"https://github.com/jiujuan/go-collection/blob/master/golang/golang-developer-roadmap.md\">https://github.com/jiujuan/go-collection/blob/master/golang/golang-developer-roadmap.md</a></p>\n</blockquote>\n<p>Golang从入门到跑路</p>\n<blockquote>\n<p><a href=\"https://github.com/jiujuan/go-collection\">https://github.com/jiujuan/go-collection</a></p>\n</blockquote>\n<p>相关开源库等</p>\n<blockquote>\n<p><a href=\"https://www.topgoer.cn/\">https://www.topgoer.cn/</a></p>\n</blockquote>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>学习脑图：</p>\n<blockquote>\n<p><a href=\"https://github.com/jiujuan/go-collection/blob/master/golang/golang-developer-roadmap.md\">https://github.com/jiujuan/go-collection/blob/master/golang/golang-developer-roadmap.md</a></p>\n</blockquote>\n<p>Golang从入门到跑路</p>\n<blockquote>\n<p><a href=\"https://github.com/jiujuan/go-collection\">https://github.com/jiujuan/go-collection</a></p>\n</blockquote>\n<p>相关开源库等</p>\n<blockquote>\n<p><a href=\"https://www.topgoer.cn/\">https://www.topgoer.cn/</a></p>\n</blockquote>\n"},{"uuid":"bbaef9fc-c0ab-11ec-92a1-7557b2313227","title":"Guava CharMatcher","abbrlink":"383fc378","_content":"\nCharMatcher提供了各种方法来处理各种JAVA char类型值。\n\n## 类声明\n\n以下是com.google.common.base.CharMatcher类的声明：\n\n```java\n@GwtCompatible(emulated=true)\npublic final class CharMatcher extends Object\n```\n\n## 字体\n\n| S.N. | 字段及说明                                                   |\n| ---- | :----------------------------------------------------------- |\n| 1    | **static CharMatcher ANY**  \t\t\t匹配任意字符。       |\n| 2    | **static CharMatcher ASCII**  \t\t\t确定字符是否为ASCII码，这意味着它的代码点低于128。 |\n| 3    | **static CharMatcher BREAKING_WHITESPACE**  \t确定一个字符是否是一个破空白（即，一个空格可以解释为格式目的词之间休息）。 |\n| 4    | **static CharMatcher DIGIT**  \t\t\t确定一个字符是否是根据Unicode数字。 |\n| 5    | **static CharMatcher INVISIBLE**  \t\t\t确定一个字符是否是看不见的;也就是说，如果它的Unicode类是任何SPACE_SEPARATOR，LINE_SEPARATOR，PARAGRAPH_SEPARATOR，控制，FORMAT，SURROGATE和PRIVATE_USE根据ICU4J。 |\n| 6    | **static CharMatcher JAVA_DIGIT**  \t\t\t确定一个字符是否是按照Java的定义一个数字。 |\n| 7    | **static CharMatcher JAVA_ISO_CONTROL**  \t\t\t确定一个字符是否是所指定的Character.isISOControl(char)ISO控制字符。 |\n| 8    | **static CharMatcher JAVA_LETTER**  \t\t\t确定一个字符是否是按照Java的定义的字母。 |\n| 9    | **static CharMatcher JAVA_LETTER_OR_DIGIT**  \t\t\t确定一个字符是否是按照Java的定义，一个字母或数字。 |\n| 10   | **static CharMatcher JAVA_LOWER_CASE**  \t\t\t确定一个字符是否是按照Java定义的小写。 |\n| 11   | **static CharMatcher JAVA_UPPER_CASE**  \t\t\t确定一个字符是否是按照Java定义的大写。 |\n| 12   | **static CharMatcher NONE**  \t\t\t匹配任何字符。      |\n| 13   | **static CharMatcher SINGLE_WIDTH**  \t\t\t确定一个字符是否是单宽度（不是双倍宽度）。 |\n| 14   | **static CharMatcher WHITESPACE**  \t\t\t决定根据最新的Unicode标准是否字符是空白，如图所示这里。 |\n\n## 构造函数\n\n| S.N. | 构造函数 & 描述                                              |\n| ---- | ------------------------------------------------------------ |\n| 1    | **protected CharMatcher()**  \t\t\t构造方法，供子类使用。 |\n\n## 类方法\n\n| S.N. | 方法 & 描述                                                  |\n| ---- | ------------------------------------------------------------ |\n| 1    | **CharMatcher and(CharMatcher other)**  \t\t\t返回一个匹配器，匹配两种匹配器和其他任何字符。 |\n| 2    | **static CharMatcher anyOf(CharSequence sequence)**  \t\t\t返回一个字符匹配匹配任何字符出现在给定的字符序列。 |\n| 3    | **boolean apply(Character character)**  \t\t\t不推荐使用。只有提供满足谓词接口;用匹配（字符）代替。 |\n| 4    | **String collapseFrom(CharSequence sequence, char replacement)**  \t\t\t返回输入字符序列的字符串拷贝，每个组连续的字符匹配此匹配由单一的替换字符替换。 |\n| 5    | **int countIn(CharSequence sequence)**  \t\t\t返回一个字符序列中发现匹配的字符的数目。 |\n| 6    | **static CharMatcher forPredicate(Predicate<? super Character> predicate)**  \t\t\t返回与相同的行为给定的基于字符的谓词匹配，但运行在原始的字符，而不是实例。 |\n| 7    | **int indexIn(CharSequence sequence)**  \t\t\t返回第一个匹配字符的索引中的一个字符序列，或-1，如果没有匹配的字符存在。 |\n| 8    | **int indexIn(CharSequence sequence, int start)**  \t\t\t返回第一个匹配字符的索引中的一个字符序列，从给定位置开始，或-1，如果没有字符的位置之后匹配。 |\n| 9    | **static CharMatcher inRange(char startInclusive, char endInclusive)**  \t\t\t返回一个字符匹配匹配给定范围内的任何字符（两个端点也包括在内）。 |\n| 10   | **static CharMatcher is(char match)**  \t\t\t返回一个字符匹配匹配只有一个指定的字符。 |\n| 11   | **static CharMatcher isNot(char match)**  \t\t\t返回一个字符匹配匹配除了指定的任何字符。 |\n| 12   | **int lastIndexIn(CharSequence sequence)**  \t\t\t返回最后一个匹配字符的索引中的字符序列，或-1，如果没有匹配的字符存在。 |\n| 13   | **abstract boolean matches(char c)**  \t\t\t确定给定字符一个true或false值。 |\n| 14   | **boolean matchesAllOf(CharSequence sequence)**  \t\t\t确定给定字符一个true或false值。 |\n| 15   | **boolean matchesAnyOf(CharSequence sequence)**  \t\t\t返回true如果字符序列包含至少一个匹配的字符。 |\n| 16   | **boolean matchesNoneOf(CharSequence sequence)**  \t\t\t返回true，如果一个字符序列中没有匹配的字符。 |\n| 17   | **CharMatcher negate()**  \t\t\t返回一个匹配器，不受此匹配匹配任何字符。 |\n| 18   | **static CharMatcher noneOf(CharSequence sequence)**  \t\t\t返回一个字符匹配器匹配不存在于给定的字符序列的任何字符。 |\n| 19   | **CharMatcher or(CharMatcher other)**  \t\t\t返回一个匹配器，匹配任何匹配或其他任何字符。 |\n| 20   | **CharMatcher precomputed()**  \t\t\t返回一个字符匹配功能上等同于这一个，但它可能会快于原来的查询;您的里程可能会有所不同。 |\n| 21   | **String removeFrom(CharSequence sequence)**  \t\t\t返回包含的字符序列的所有非匹配的字符，为了一个字符串。 |\n| 22   | **String replaceFrom(CharSequence sequence, char replacement)**  \t\t\t返回输入字符序列的字符串副本，其中每个字符匹配该匹配器由一个给定的替换字符替换。 |\n| 23   | **String replaceFrom(CharSequence sequence, CharSequence replacement)**  \t\t\t返回输入字符序列的字符串副本，其中每个字符匹配该匹配器由一个给定的替换序列替换。 |\n| 24   | **String retainFrom(CharSequence sequence)**  \t\t\t返回包含的字符序列的所有字符匹配，为了一个字符串。 |\n| 25   | **String toString()**  \t\t\t返回此CharMatcher，如CharMatcher.or（WHITESPACE，JAVA_DIGIT）的字符串表示。 |\n| 26   | **String trimAndCollapseFrom(CharSequence sequence, char replacement)**  \t\t\t折叠匹配字符完全一样collapseFrom一组如collapseFrom(java.lang.CharSequence, char) 做的一样，不同之处在于，无需更换一组被移除的匹配字符在开始或该序列的结束。 |\n| 27   | **String trimFrom(CharSequence sequence)**  \t\t\t返回输入字符序列省略了所有匹配器从一开始，并从该串的末尾匹配字符的字符串。 |\n| 28   | **String trimLeadingFrom(CharSequence sequence)**  \t\t\t返回输入字符序列，它省略了所有这些匹配的字符串开始处匹配字符的字符串。 |\n| 29   | **String trimTrailingFrom(CharSequence sequence)**  \t\t\t返回输入字符序列，它省略了所有这些匹配的字符串的结尾匹配字符的字符串。 |\n\nIn olden times, our `StringUtil` class grew unchecked, and had many methods like these:\n\n- `allAscii`\n- `collapse`\n- `collapseControlChars`\n- `collapseWhitespace`\n- `lastIndexNotOf`\n- `numSharedChars`\n- `removeChars`\n- `removeCrLf`\n- `retainAllChars`\n- `strip`\n- `stripAndCollapse`\n- `stripNonDigits`\n\nThey represent a partial cross product of two notions:\n\n1. what constitutes a \"matching\" character?\n2. what to do with those \"matching\" characters?\n\nTo simplify this morass, we developed `CharMatcher`.\n\nIntuitively, you can think of a `CharMatcher` as representing a particular class of characters, like digits or whitespace. Practically speaking, a `CharMatcher` is just a boolean predicate on characters -- indeed, `CharMatcher` implements [`Predicate<Character>`] -- but because it is so common to refer to \"all whitespace characters\" or \"all lowercase letters,\" Guava provides this specialized syntax and API for characters.\n\nBut the utility of a `CharMatcher` is in the *operations* it lets you perform on occurrences of the specified class of characters: trimming, collapsing, removing, retaining, and much more. An object of type `CharMatcher` represents notion 1: what constitutes a matching character? It then provides many operations answering notion 2: what to do with those matching characters? The result is that API complexity increases linearly for quadratically increasing flexibility and power. Yay!\n\n```java\nString noControl = CharMatcher.javaIsoControl().removeFrom(string); // remove control characters\nString theDigits = CharMatcher.digit().retainFrom(string); // only the digits\nString spaced = CharMatcher.whitespace().trimAndCollapseFrom(string, ' ');\n  // trim whitespace at ends, and replace/collapse whitespace into single spaces\nString noDigits = CharMatcher.javaDigit().replaceFrom(string, \"*\"); // star out all digits\nString lowerAndDigit = CharMatcher.javaDigit().or(CharMatcher.javaLowerCase()).retainFrom(string);\n  // eliminate all characters that aren't digits or lowercase\n```\n\n**Note:** `CharMatcher` deals only with `char` values; it does not understand supplementary Unicode code points in the range 0x10000 to 0x10FFFF. Such logical characters are encoded into a `String` using surrogate pairs, and a `CharMatcher` treats these just as two separate characters.\n\n### Obtaining CharMatchers\n\nMany needs can be satisfied by the provided `CharMatcher` factory methods:\n\n- [`any()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#any--)\n- [`none()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#none--)\n- [`whitespace()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#whitespace--)\n- [`breakingWhitespace()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#breakingWhitespace--)\n- [`invisible()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#invisible--)\n- [`digit()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#digit--)\n- [`javaLetter()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLetter--)\n- [`javaDigit()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaDigit--)\n- [`javaLetterOrDigit()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLetterOrDigit--)\n- [`javaIsoControl()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaIsoControl--)\n- [`javaLowerCase()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLowerCase--)\n- [`javaUpperCase()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaUpperCase--)\n- [`ascii()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#ascii--)\n- [`singleWidth()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#singleWidth--)\n\nOther common ways to obtain a `CharMatcher` include:\n\n| Method                                                       | Description                                                  |\n| ------------------------------------------------------------ | ------------------------------------------------------------ |\n| [`anyOf(CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#anyOf-java.lang.CharSequence-) | Specify all the characters you wish matched. For example, `CharMatcher.anyOf(\"aeiou\")` matches lowercase English vowels. |\n| [`is(char)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#is-char-) | Specify exactly one character to match.                      |\n| [`inRange(char, char)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#inRange-char-char-) | Specify a range of characters to match, e.g. `CharMatcher.inRange('a', 'z')`. |\n\nAdditionally, `CharMatcher` has [`negate()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#negate--), [`and(CharMatcher)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#and-com.google.common.base.CharMatcher-), and [`or(CharMatcher)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#or-com.google.common.base.CharMatcher-). These provide simple boolean operations on `CharMatcher`.\n\n### Using CharMatchers\n\n`CharMatcher` provides a [wide variety](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#method_summary) of methods to operate on occurrences of the specified characters in any `CharSequence`. There are more methods provided than we can list here, but some of the most commonly used are:\n\n| Method                                                       | Description                                                  |\n| ------------------------------------------------------------ | ------------------------------------------------------------ |\n| [`collapseFrom(CharSequence, char)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#collapseFrom-java.lang.CharSequence-char-) | Replace each group of consecutive matched characters with the specified character. For example, `WHITESPACE.collapseFrom(string, ' ')` collapses whitespaces down to a single space. |\n| [`matchesAllOf(CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#matchesAllOf-java.lang.CharSequence-) | Test if this matcher matches all characters in the sequence. For example, `ASCII.matchesAllOf(string)` tests if all characters in the string are ASCII. |\n| [`removeFrom(CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#removeFrom-java.lang.CharSequence-) | Removes matching characters from the sequence.               |\n| [`retainFrom(CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#retainFrom-java.lang.CharSequence-) | Removes all non-matching characters from the sequence.       |\n| [`trimFrom(CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#trimFrom-java.lang.CharSequence-) | Removes leading and trailing matching characters.            |\n| [`replaceFrom(CharSequence, CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#replaceFrom-java.lang.CharSequence-java.lang.CharSequence-) | Replace matching characters with a given sequence.           |\n\n(Note: all of these methods return a `String`, except for `matchesAllOf`, which returns a `boolean`.)\n\n例子\n\n~~~java\n@Test\nvoid testCharMatcher() {\n  // 统计字符串中字符的个数\n  assertEquals(3, CharMatcher.is('#').countIn(\"#hello#world#\"));\n  // 保留某些字符\n  assertEquals(\"bc\", CharMatcher.inRange('b', 'c').retainFrom(\"abcdefg\"));\n}\n~~~\n","source":"_posts/guava/CharMatcher.md","raw":"---\nuuid: bbaef9fc-c0ab-11ec-92a1-7557b2313227\ntitle: Guava CharMatcher\ncategories: Java\ntags:\n  - guava\nabbrlink: 383fc378\n---\n\nCharMatcher提供了各种方法来处理各种JAVA char类型值。\n\n## 类声明\n\n以下是com.google.common.base.CharMatcher类的声明：\n\n```java\n@GwtCompatible(emulated=true)\npublic final class CharMatcher extends Object\n```\n\n## 字体\n\n| S.N. | 字段及说明                                                   |\n| ---- | :----------------------------------------------------------- |\n| 1    | **static CharMatcher ANY**  \t\t\t匹配任意字符。       |\n| 2    | **static CharMatcher ASCII**  \t\t\t确定字符是否为ASCII码，这意味着它的代码点低于128。 |\n| 3    | **static CharMatcher BREAKING_WHITESPACE**  \t确定一个字符是否是一个破空白（即，一个空格可以解释为格式目的词之间休息）。 |\n| 4    | **static CharMatcher DIGIT**  \t\t\t确定一个字符是否是根据Unicode数字。 |\n| 5    | **static CharMatcher INVISIBLE**  \t\t\t确定一个字符是否是看不见的;也就是说，如果它的Unicode类是任何SPACE_SEPARATOR，LINE_SEPARATOR，PARAGRAPH_SEPARATOR，控制，FORMAT，SURROGATE和PRIVATE_USE根据ICU4J。 |\n| 6    | **static CharMatcher JAVA_DIGIT**  \t\t\t确定一个字符是否是按照Java的定义一个数字。 |\n| 7    | **static CharMatcher JAVA_ISO_CONTROL**  \t\t\t确定一个字符是否是所指定的Character.isISOControl(char)ISO控制字符。 |\n| 8    | **static CharMatcher JAVA_LETTER**  \t\t\t确定一个字符是否是按照Java的定义的字母。 |\n| 9    | **static CharMatcher JAVA_LETTER_OR_DIGIT**  \t\t\t确定一个字符是否是按照Java的定义，一个字母或数字。 |\n| 10   | **static CharMatcher JAVA_LOWER_CASE**  \t\t\t确定一个字符是否是按照Java定义的小写。 |\n| 11   | **static CharMatcher JAVA_UPPER_CASE**  \t\t\t确定一个字符是否是按照Java定义的大写。 |\n| 12   | **static CharMatcher NONE**  \t\t\t匹配任何字符。      |\n| 13   | **static CharMatcher SINGLE_WIDTH**  \t\t\t确定一个字符是否是单宽度（不是双倍宽度）。 |\n| 14   | **static CharMatcher WHITESPACE**  \t\t\t决定根据最新的Unicode标准是否字符是空白，如图所示这里。 |\n\n## 构造函数\n\n| S.N. | 构造函数 & 描述                                              |\n| ---- | ------------------------------------------------------------ |\n| 1    | **protected CharMatcher()**  \t\t\t构造方法，供子类使用。 |\n\n## 类方法\n\n| S.N. | 方法 & 描述                                                  |\n| ---- | ------------------------------------------------------------ |\n| 1    | **CharMatcher and(CharMatcher other)**  \t\t\t返回一个匹配器，匹配两种匹配器和其他任何字符。 |\n| 2    | **static CharMatcher anyOf(CharSequence sequence)**  \t\t\t返回一个字符匹配匹配任何字符出现在给定的字符序列。 |\n| 3    | **boolean apply(Character character)**  \t\t\t不推荐使用。只有提供满足谓词接口;用匹配（字符）代替。 |\n| 4    | **String collapseFrom(CharSequence sequence, char replacement)**  \t\t\t返回输入字符序列的字符串拷贝，每个组连续的字符匹配此匹配由单一的替换字符替换。 |\n| 5    | **int countIn(CharSequence sequence)**  \t\t\t返回一个字符序列中发现匹配的字符的数目。 |\n| 6    | **static CharMatcher forPredicate(Predicate<? super Character> predicate)**  \t\t\t返回与相同的行为给定的基于字符的谓词匹配，但运行在原始的字符，而不是实例。 |\n| 7    | **int indexIn(CharSequence sequence)**  \t\t\t返回第一个匹配字符的索引中的一个字符序列，或-1，如果没有匹配的字符存在。 |\n| 8    | **int indexIn(CharSequence sequence, int start)**  \t\t\t返回第一个匹配字符的索引中的一个字符序列，从给定位置开始，或-1，如果没有字符的位置之后匹配。 |\n| 9    | **static CharMatcher inRange(char startInclusive, char endInclusive)**  \t\t\t返回一个字符匹配匹配给定范围内的任何字符（两个端点也包括在内）。 |\n| 10   | **static CharMatcher is(char match)**  \t\t\t返回一个字符匹配匹配只有一个指定的字符。 |\n| 11   | **static CharMatcher isNot(char match)**  \t\t\t返回一个字符匹配匹配除了指定的任何字符。 |\n| 12   | **int lastIndexIn(CharSequence sequence)**  \t\t\t返回最后一个匹配字符的索引中的字符序列，或-1，如果没有匹配的字符存在。 |\n| 13   | **abstract boolean matches(char c)**  \t\t\t确定给定字符一个true或false值。 |\n| 14   | **boolean matchesAllOf(CharSequence sequence)**  \t\t\t确定给定字符一个true或false值。 |\n| 15   | **boolean matchesAnyOf(CharSequence sequence)**  \t\t\t返回true如果字符序列包含至少一个匹配的字符。 |\n| 16   | **boolean matchesNoneOf(CharSequence sequence)**  \t\t\t返回true，如果一个字符序列中没有匹配的字符。 |\n| 17   | **CharMatcher negate()**  \t\t\t返回一个匹配器，不受此匹配匹配任何字符。 |\n| 18   | **static CharMatcher noneOf(CharSequence sequence)**  \t\t\t返回一个字符匹配器匹配不存在于给定的字符序列的任何字符。 |\n| 19   | **CharMatcher or(CharMatcher other)**  \t\t\t返回一个匹配器，匹配任何匹配或其他任何字符。 |\n| 20   | **CharMatcher precomputed()**  \t\t\t返回一个字符匹配功能上等同于这一个，但它可能会快于原来的查询;您的里程可能会有所不同。 |\n| 21   | **String removeFrom(CharSequence sequence)**  \t\t\t返回包含的字符序列的所有非匹配的字符，为了一个字符串。 |\n| 22   | **String replaceFrom(CharSequence sequence, char replacement)**  \t\t\t返回输入字符序列的字符串副本，其中每个字符匹配该匹配器由一个给定的替换字符替换。 |\n| 23   | **String replaceFrom(CharSequence sequence, CharSequence replacement)**  \t\t\t返回输入字符序列的字符串副本，其中每个字符匹配该匹配器由一个给定的替换序列替换。 |\n| 24   | **String retainFrom(CharSequence sequence)**  \t\t\t返回包含的字符序列的所有字符匹配，为了一个字符串。 |\n| 25   | **String toString()**  \t\t\t返回此CharMatcher，如CharMatcher.or（WHITESPACE，JAVA_DIGIT）的字符串表示。 |\n| 26   | **String trimAndCollapseFrom(CharSequence sequence, char replacement)**  \t\t\t折叠匹配字符完全一样collapseFrom一组如collapseFrom(java.lang.CharSequence, char) 做的一样，不同之处在于，无需更换一组被移除的匹配字符在开始或该序列的结束。 |\n| 27   | **String trimFrom(CharSequence sequence)**  \t\t\t返回输入字符序列省略了所有匹配器从一开始，并从该串的末尾匹配字符的字符串。 |\n| 28   | **String trimLeadingFrom(CharSequence sequence)**  \t\t\t返回输入字符序列，它省略了所有这些匹配的字符串开始处匹配字符的字符串。 |\n| 29   | **String trimTrailingFrom(CharSequence sequence)**  \t\t\t返回输入字符序列，它省略了所有这些匹配的字符串的结尾匹配字符的字符串。 |\n\nIn olden times, our `StringUtil` class grew unchecked, and had many methods like these:\n\n- `allAscii`\n- `collapse`\n- `collapseControlChars`\n- `collapseWhitespace`\n- `lastIndexNotOf`\n- `numSharedChars`\n- `removeChars`\n- `removeCrLf`\n- `retainAllChars`\n- `strip`\n- `stripAndCollapse`\n- `stripNonDigits`\n\nThey represent a partial cross product of two notions:\n\n1. what constitutes a \"matching\" character?\n2. what to do with those \"matching\" characters?\n\nTo simplify this morass, we developed `CharMatcher`.\n\nIntuitively, you can think of a `CharMatcher` as representing a particular class of characters, like digits or whitespace. Practically speaking, a `CharMatcher` is just a boolean predicate on characters -- indeed, `CharMatcher` implements [`Predicate<Character>`] -- but because it is so common to refer to \"all whitespace characters\" or \"all lowercase letters,\" Guava provides this specialized syntax and API for characters.\n\nBut the utility of a `CharMatcher` is in the *operations* it lets you perform on occurrences of the specified class of characters: trimming, collapsing, removing, retaining, and much more. An object of type `CharMatcher` represents notion 1: what constitutes a matching character? It then provides many operations answering notion 2: what to do with those matching characters? The result is that API complexity increases linearly for quadratically increasing flexibility and power. Yay!\n\n```java\nString noControl = CharMatcher.javaIsoControl().removeFrom(string); // remove control characters\nString theDigits = CharMatcher.digit().retainFrom(string); // only the digits\nString spaced = CharMatcher.whitespace().trimAndCollapseFrom(string, ' ');\n  // trim whitespace at ends, and replace/collapse whitespace into single spaces\nString noDigits = CharMatcher.javaDigit().replaceFrom(string, \"*\"); // star out all digits\nString lowerAndDigit = CharMatcher.javaDigit().or(CharMatcher.javaLowerCase()).retainFrom(string);\n  // eliminate all characters that aren't digits or lowercase\n```\n\n**Note:** `CharMatcher` deals only with `char` values; it does not understand supplementary Unicode code points in the range 0x10000 to 0x10FFFF. Such logical characters are encoded into a `String` using surrogate pairs, and a `CharMatcher` treats these just as two separate characters.\n\n### Obtaining CharMatchers\n\nMany needs can be satisfied by the provided `CharMatcher` factory methods:\n\n- [`any()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#any--)\n- [`none()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#none--)\n- [`whitespace()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#whitespace--)\n- [`breakingWhitespace()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#breakingWhitespace--)\n- [`invisible()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#invisible--)\n- [`digit()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#digit--)\n- [`javaLetter()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLetter--)\n- [`javaDigit()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaDigit--)\n- [`javaLetterOrDigit()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLetterOrDigit--)\n- [`javaIsoControl()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaIsoControl--)\n- [`javaLowerCase()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLowerCase--)\n- [`javaUpperCase()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaUpperCase--)\n- [`ascii()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#ascii--)\n- [`singleWidth()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#singleWidth--)\n\nOther common ways to obtain a `CharMatcher` include:\n\n| Method                                                       | Description                                                  |\n| ------------------------------------------------------------ | ------------------------------------------------------------ |\n| [`anyOf(CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#anyOf-java.lang.CharSequence-) | Specify all the characters you wish matched. For example, `CharMatcher.anyOf(\"aeiou\")` matches lowercase English vowels. |\n| [`is(char)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#is-char-) | Specify exactly one character to match.                      |\n| [`inRange(char, char)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#inRange-char-char-) | Specify a range of characters to match, e.g. `CharMatcher.inRange('a', 'z')`. |\n\nAdditionally, `CharMatcher` has [`negate()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#negate--), [`and(CharMatcher)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#and-com.google.common.base.CharMatcher-), and [`or(CharMatcher)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#or-com.google.common.base.CharMatcher-). These provide simple boolean operations on `CharMatcher`.\n\n### Using CharMatchers\n\n`CharMatcher` provides a [wide variety](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#method_summary) of methods to operate on occurrences of the specified characters in any `CharSequence`. There are more methods provided than we can list here, but some of the most commonly used are:\n\n| Method                                                       | Description                                                  |\n| ------------------------------------------------------------ | ------------------------------------------------------------ |\n| [`collapseFrom(CharSequence, char)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#collapseFrom-java.lang.CharSequence-char-) | Replace each group of consecutive matched characters with the specified character. For example, `WHITESPACE.collapseFrom(string, ' ')` collapses whitespaces down to a single space. |\n| [`matchesAllOf(CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#matchesAllOf-java.lang.CharSequence-) | Test if this matcher matches all characters in the sequence. For example, `ASCII.matchesAllOf(string)` tests if all characters in the string are ASCII. |\n| [`removeFrom(CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#removeFrom-java.lang.CharSequence-) | Removes matching characters from the sequence.               |\n| [`retainFrom(CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#retainFrom-java.lang.CharSequence-) | Removes all non-matching characters from the sequence.       |\n| [`trimFrom(CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#trimFrom-java.lang.CharSequence-) | Removes leading and trailing matching characters.            |\n| [`replaceFrom(CharSequence, CharSequence)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#replaceFrom-java.lang.CharSequence-java.lang.CharSequence-) | Replace matching characters with a given sequence.           |\n\n(Note: all of these methods return a `String`, except for `matchesAllOf`, which returns a `boolean`.)\n\n例子\n\n~~~java\n@Test\nvoid testCharMatcher() {\n  // 统计字符串中字符的个数\n  assertEquals(3, CharMatcher.is('#').countIn(\"#hello#world#\"));\n  // 保留某些字符\n  assertEquals(\"bc\", CharMatcher.inRange('b', 'c').retainFrom(\"abcdefg\"));\n}\n~~~\n","slug":"guava/CharMatcher","published":1,"date":"2022-04-20T12:41:20.873Z","updated":"2022-05-04T03:11:45.027Z","_id":"cl2qzfthi002013nocfhihapj","comments":1,"layout":"post","photos":[],"link":"","content":"<p>CharMatcher提供了各种方法来处理各种JAVA char类型值。</p>\n<h2 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h2><p>以下是com.google.common.base.CharMatcher类的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible(emulated=true)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CharMatcher</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Object</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"字体\"><a href=\"#字体\" class=\"headerlink\" title=\"字体\"></a>字体</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th align=\"left\">字段及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td align=\"left\"><strong>static CharMatcher ANY</strong>              匹配任意字符。</td>\n</tr>\n<tr>\n<td>2</td>\n<td align=\"left\"><strong>static CharMatcher ASCII</strong>              确定字符是否为ASCII码，这意味着它的代码点低于128。</td>\n</tr>\n<tr>\n<td>3</td>\n<td align=\"left\"><strong>static CharMatcher BREAKING_WHITESPACE</strong>      确定一个字符是否是一个破空白（即，一个空格可以解释为格式目的词之间休息）。</td>\n</tr>\n<tr>\n<td>4</td>\n<td align=\"left\"><strong>static CharMatcher DIGIT</strong>              确定一个字符是否是根据Unicode数字。</td>\n</tr>\n<tr>\n<td>5</td>\n<td align=\"left\"><strong>static CharMatcher INVISIBLE</strong>              确定一个字符是否是看不见的;也就是说，如果它的Unicode类是任何SPACE_SEPARATOR，LINE_SEPARATOR，PARAGRAPH_SEPARATOR，控制，FORMAT，SURROGATE和PRIVATE_USE根据ICU4J。</td>\n</tr>\n<tr>\n<td>6</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_DIGIT</strong>              确定一个字符是否是按照Java的定义一个数字。</td>\n</tr>\n<tr>\n<td>7</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_ISO_CONTROL</strong>              确定一个字符是否是所指定的Character.isISOControl(char)ISO控制字符。</td>\n</tr>\n<tr>\n<td>8</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_LETTER</strong>              确定一个字符是否是按照Java的定义的字母。</td>\n</tr>\n<tr>\n<td>9</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_LETTER_OR_DIGIT</strong>              确定一个字符是否是按照Java的定义，一个字母或数字。</td>\n</tr>\n<tr>\n<td>10</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_LOWER_CASE</strong>              确定一个字符是否是按照Java定义的小写。</td>\n</tr>\n<tr>\n<td>11</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_UPPER_CASE</strong>              确定一个字符是否是按照Java定义的大写。</td>\n</tr>\n<tr>\n<td>12</td>\n<td align=\"left\"><strong>static CharMatcher NONE</strong>              匹配任何字符。</td>\n</tr>\n<tr>\n<td>13</td>\n<td align=\"left\"><strong>static CharMatcher SINGLE_WIDTH</strong>              确定一个字符是否是单宽度（不是双倍宽度）。</td>\n</tr>\n<tr>\n<td>14</td>\n<td align=\"left\"><strong>static CharMatcher WHITESPACE</strong>              决定根据最新的Unicode标准是否字符是空白，如图所示这里。</td>\n</tr>\n</tbody></table>\n<h2 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>构造函数 &amp; 描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>protected CharMatcher()</strong>              构造方法，供子类使用。</td>\n</tr>\n</tbody></table>\n<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法 &amp; 描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>CharMatcher and(CharMatcher other)</strong>              返回一个匹配器，匹配两种匹配器和其他任何字符。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>static CharMatcher anyOf(CharSequence sequence)</strong>              返回一个字符匹配匹配任何字符出现在给定的字符序列。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>boolean apply(Character character)</strong>              不推荐使用。只有提供满足谓词接口;用匹配（字符）代替。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>String collapseFrom(CharSequence sequence, char replacement)</strong>              返回输入字符序列的字符串拷贝，每个组连续的字符匹配此匹配由单一的替换字符替换。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>int countIn(CharSequence sequence)</strong>              返回一个字符序列中发现匹配的字符的数目。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>static CharMatcher forPredicate(Predicate&lt;? super Character&gt; predicate)</strong>              返回与相同的行为给定的基于字符的谓词匹配，但运行在原始的字符，而不是实例。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>int indexIn(CharSequence sequence)</strong>              返回第一个匹配字符的索引中的一个字符序列，或-1，如果没有匹配的字符存在。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>int indexIn(CharSequence sequence, int start)</strong>              返回第一个匹配字符的索引中的一个字符序列，从给定位置开始，或-1，如果没有字符的位置之后匹配。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>static CharMatcher inRange(char startInclusive, char endInclusive)</strong>              返回一个字符匹配匹配给定范围内的任何字符（两个端点也包括在内）。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>static CharMatcher is(char match)</strong>              返回一个字符匹配匹配只有一个指定的字符。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>static CharMatcher isNot(char match)</strong>              返回一个字符匹配匹配除了指定的任何字符。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>int lastIndexIn(CharSequence sequence)</strong>              返回最后一个匹配字符的索引中的字符序列，或-1，如果没有匹配的字符存在。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>abstract boolean matches(char c)</strong>              确定给定字符一个true或false值。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>boolean matchesAllOf(CharSequence sequence)</strong>              确定给定字符一个true或false值。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>boolean matchesAnyOf(CharSequence sequence)</strong>              返回true如果字符序列包含至少一个匹配的字符。</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong>boolean matchesNoneOf(CharSequence sequence)</strong>              返回true，如果一个字符序列中没有匹配的字符。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong>CharMatcher negate()</strong>              返回一个匹配器，不受此匹配匹配任何字符。</td>\n</tr>\n<tr>\n<td>18</td>\n<td><strong>static CharMatcher noneOf(CharSequence sequence)</strong>              返回一个字符匹配器匹配不存在于给定的字符序列的任何字符。</td>\n</tr>\n<tr>\n<td>19</td>\n<td><strong>CharMatcher or(CharMatcher other)</strong>              返回一个匹配器，匹配任何匹配或其他任何字符。</td>\n</tr>\n<tr>\n<td>20</td>\n<td><strong>CharMatcher precomputed()</strong>              返回一个字符匹配功能上等同于这一个，但它可能会快于原来的查询;您的里程可能会有所不同。</td>\n</tr>\n<tr>\n<td>21</td>\n<td><strong>String removeFrom(CharSequence sequence)</strong>              返回包含的字符序列的所有非匹配的字符，为了一个字符串。</td>\n</tr>\n<tr>\n<td>22</td>\n<td><strong>String replaceFrom(CharSequence sequence, char replacement)</strong>              返回输入字符序列的字符串副本，其中每个字符匹配该匹配器由一个给定的替换字符替换。</td>\n</tr>\n<tr>\n<td>23</td>\n<td><strong>String replaceFrom(CharSequence sequence, CharSequence replacement)</strong>              返回输入字符序列的字符串副本，其中每个字符匹配该匹配器由一个给定的替换序列替换。</td>\n</tr>\n<tr>\n<td>24</td>\n<td><strong>String retainFrom(CharSequence sequence)</strong>              返回包含的字符序列的所有字符匹配，为了一个字符串。</td>\n</tr>\n<tr>\n<td>25</td>\n<td><strong>String toString()</strong>              返回此CharMatcher，如CharMatcher.or（WHITESPACE，JAVA_DIGIT）的字符串表示。</td>\n</tr>\n<tr>\n<td>26</td>\n<td><strong>String trimAndCollapseFrom(CharSequence sequence, char replacement)</strong>              折叠匹配字符完全一样collapseFrom一组如collapseFrom(java.lang.CharSequence, char) 做的一样，不同之处在于，无需更换一组被移除的匹配字符在开始或该序列的结束。</td>\n</tr>\n<tr>\n<td>27</td>\n<td><strong>String trimFrom(CharSequence sequence)</strong>              返回输入字符序列省略了所有匹配器从一开始，并从该串的末尾匹配字符的字符串。</td>\n</tr>\n<tr>\n<td>28</td>\n<td><strong>String trimLeadingFrom(CharSequence sequence)</strong>              返回输入字符序列，它省略了所有这些匹配的字符串开始处匹配字符的字符串。</td>\n</tr>\n<tr>\n<td>29</td>\n<td><strong>String trimTrailingFrom(CharSequence sequence)</strong>              返回输入字符序列，它省略了所有这些匹配的字符串的结尾匹配字符的字符串。</td>\n</tr>\n</tbody></table>\n<p>In olden times, our <code>StringUtil</code> class grew unchecked, and had many methods like these:</p>\n<ul>\n<li><code>allAscii</code></li>\n<li><code>collapse</code></li>\n<li><code>collapseControlChars</code></li>\n<li><code>collapseWhitespace</code></li>\n<li><code>lastIndexNotOf</code></li>\n<li><code>numSharedChars</code></li>\n<li><code>removeChars</code></li>\n<li><code>removeCrLf</code></li>\n<li><code>retainAllChars</code></li>\n<li><code>strip</code></li>\n<li><code>stripAndCollapse</code></li>\n<li><code>stripNonDigits</code></li>\n</ul>\n<p>They represent a partial cross product of two notions:</p>\n<ol>\n<li>what constitutes a “matching” character?</li>\n<li>what to do with those “matching” characters?</li>\n</ol>\n<p>To simplify this morass, we developed <code>CharMatcher</code>.</p>\n<p>Intuitively, you can think of a <code>CharMatcher</code> as representing a particular class of characters, like digits or whitespace. Practically speaking, a <code>CharMatcher</code> is just a boolean predicate on characters – indeed, <code>CharMatcher</code> implements [<code>Predicate&lt;Character&gt;</code>] – but because it is so common to refer to “all whitespace characters” or “all lowercase letters,” Guava provides this specialized syntax and API for characters.</p>\n<p>But the utility of a <code>CharMatcher</code> is in the <em>operations</em> it lets you perform on occurrences of the specified class of characters: trimming, collapsing, removing, retaining, and much more. An object of type <code>CharMatcher</code> represents notion 1: what constitutes a matching character? It then provides many operations answering notion 2: what to do with those matching characters? The result is that API complexity increases linearly for quadratically increasing flexibility and power. Yay!</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">noControl</span> <span class=\"operator\">=</span> CharMatcher.javaIsoControl().removeFrom(string); <span class=\"comment\">// remove control characters</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">theDigits</span> <span class=\"operator\">=</span> CharMatcher.digit().retainFrom(string); <span class=\"comment\">// only the digits</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">spaced</span> <span class=\"operator\">=</span> CharMatcher.whitespace().trimAndCollapseFrom(string, <span class=\"string\">&#x27; &#x27;</span>);</span><br><span class=\"line\">  <span class=\"comment\">// trim whitespace at ends, and replace/collapse whitespace into single spaces</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">noDigits</span> <span class=\"operator\">=</span> CharMatcher.javaDigit().replaceFrom(string, <span class=\"string\">&quot;*&quot;</span>); <span class=\"comment\">// star out all digits</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">lowerAndDigit</span> <span class=\"operator\">=</span> CharMatcher.javaDigit().or(CharMatcher.javaLowerCase()).retainFrom(string);</span><br><span class=\"line\">  <span class=\"comment\">// eliminate all characters that aren&#x27;t digits or lowercase</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Note:</strong> <code>CharMatcher</code> deals only with <code>char</code> values; it does not understand supplementary Unicode code points in the range 0x10000 to 0x10FFFF. Such logical characters are encoded into a <code>String</code> using surrogate pairs, and a <code>CharMatcher</code> treats these just as two separate characters.</p>\n<h3 id=\"Obtaining-CharMatchers\"><a href=\"#Obtaining-CharMatchers\" class=\"headerlink\" title=\"Obtaining CharMatchers\"></a>Obtaining CharMatchers</h3><p>Many needs can be satisfied by the provided <code>CharMatcher</code> factory methods:</p>\n<ul>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#any--\"><code>any()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#none--\"><code>none()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#whitespace--\"><code>whitespace()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#breakingWhitespace--\"><code>breakingWhitespace()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#invisible--\"><code>invisible()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#digit--\"><code>digit()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLetter--\"><code>javaLetter()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaDigit--\"><code>javaDigit()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLetterOrDigit--\"><code>javaLetterOrDigit()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaIsoControl--\"><code>javaIsoControl()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLowerCase--\"><code>javaLowerCase()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaUpperCase--\"><code>javaUpperCase()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#ascii--\"><code>ascii()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#singleWidth--\"><code>singleWidth()</code></a></li>\n</ul>\n<p>Other common ways to obtain a <code>CharMatcher</code> include:</p>\n<table>\n<thead>\n<tr>\n<th>Method</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#anyOf-java.lang.CharSequence-\"><code>anyOf(CharSequence)</code></a></td>\n<td>Specify all the characters you wish matched. For example, <code>CharMatcher.anyOf(&quot;aeiou&quot;)</code> matches lowercase English vowels.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#is-char-\"><code>is(char)</code></a></td>\n<td>Specify exactly one character to match.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#inRange-char-char-\"><code>inRange(char, char)</code></a></td>\n<td>Specify a range of characters to match, e.g. <code>CharMatcher.inRange(&#39;a&#39;, &#39;z&#39;)</code>.</td>\n</tr>\n</tbody></table>\n<p>Additionally, <code>CharMatcher</code> has <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#negate--\"><code>negate()</code></a>, <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#and-com.google.common.base.CharMatcher-\"><code>and(CharMatcher)</code></a>, and <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#or-com.google.common.base.CharMatcher-\"><code>or(CharMatcher)</code></a>. These provide simple boolean operations on <code>CharMatcher</code>.</p>\n<h3 id=\"Using-CharMatchers\"><a href=\"#Using-CharMatchers\" class=\"headerlink\" title=\"Using CharMatchers\"></a>Using CharMatchers</h3><p><code>CharMatcher</code> provides a <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#method_summary\">wide variety</a> of methods to operate on occurrences of the specified characters in any <code>CharSequence</code>. There are more methods provided than we can list here, but some of the most commonly used are:</p>\n<table>\n<thead>\n<tr>\n<th>Method</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#collapseFrom-java.lang.CharSequence-char-\"><code>collapseFrom(CharSequence, char)</code></a></td>\n<td>Replace each group of consecutive matched characters with the specified character. For example, <code>WHITESPACE.collapseFrom(string, &#39; &#39;)</code> collapses whitespaces down to a single space.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#matchesAllOf-java.lang.CharSequence-\"><code>matchesAllOf(CharSequence)</code></a></td>\n<td>Test if this matcher matches all characters in the sequence. For example, <code>ASCII.matchesAllOf(string)</code> tests if all characters in the string are ASCII.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#removeFrom-java.lang.CharSequence-\"><code>removeFrom(CharSequence)</code></a></td>\n<td>Removes matching characters from the sequence.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#retainFrom-java.lang.CharSequence-\"><code>retainFrom(CharSequence)</code></a></td>\n<td>Removes all non-matching characters from the sequence.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#trimFrom-java.lang.CharSequence-\"><code>trimFrom(CharSequence)</code></a></td>\n<td>Removes leading and trailing matching characters.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#replaceFrom-java.lang.CharSequence-java.lang.CharSequence-\"><code>replaceFrom(CharSequence, CharSequence)</code></a></td>\n<td>Replace matching characters with a given sequence.</td>\n</tr>\n</tbody></table>\n<p>(Note: all of these methods return a <code>String</code>, except for <code>matchesAllOf</code>, which returns a <code>boolean</code>.)</p>\n<p>例子</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testCharMatcher</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 统计字符串中字符的个数</span></span><br><span class=\"line\">  assertEquals(<span class=\"number\">3</span>, CharMatcher.is(<span class=\"string\">&#x27;#&#x27;</span>).countIn(<span class=\"string\">&quot;#hello#world#&quot;</span>));</span><br><span class=\"line\">  <span class=\"comment\">// 保留某些字符</span></span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;bc&quot;</span>, CharMatcher.inRange(<span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>).retainFrom(<span class=\"string\">&quot;abcdefg&quot;</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>CharMatcher提供了各种方法来处理各种JAVA char类型值。</p>\n<h2 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h2><p>以下是com.google.common.base.CharMatcher类的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible(emulated=true)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CharMatcher</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Object</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"字体\"><a href=\"#字体\" class=\"headerlink\" title=\"字体\"></a>字体</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th align=\"left\">字段及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td align=\"left\"><strong>static CharMatcher ANY</strong>              匹配任意字符。</td>\n</tr>\n<tr>\n<td>2</td>\n<td align=\"left\"><strong>static CharMatcher ASCII</strong>              确定字符是否为ASCII码，这意味着它的代码点低于128。</td>\n</tr>\n<tr>\n<td>3</td>\n<td align=\"left\"><strong>static CharMatcher BREAKING_WHITESPACE</strong>      确定一个字符是否是一个破空白（即，一个空格可以解释为格式目的词之间休息）。</td>\n</tr>\n<tr>\n<td>4</td>\n<td align=\"left\"><strong>static CharMatcher DIGIT</strong>              确定一个字符是否是根据Unicode数字。</td>\n</tr>\n<tr>\n<td>5</td>\n<td align=\"left\"><strong>static CharMatcher INVISIBLE</strong>              确定一个字符是否是看不见的;也就是说，如果它的Unicode类是任何SPACE_SEPARATOR，LINE_SEPARATOR，PARAGRAPH_SEPARATOR，控制，FORMAT，SURROGATE和PRIVATE_USE根据ICU4J。</td>\n</tr>\n<tr>\n<td>6</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_DIGIT</strong>              确定一个字符是否是按照Java的定义一个数字。</td>\n</tr>\n<tr>\n<td>7</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_ISO_CONTROL</strong>              确定一个字符是否是所指定的Character.isISOControl(char)ISO控制字符。</td>\n</tr>\n<tr>\n<td>8</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_LETTER</strong>              确定一个字符是否是按照Java的定义的字母。</td>\n</tr>\n<tr>\n<td>9</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_LETTER_OR_DIGIT</strong>              确定一个字符是否是按照Java的定义，一个字母或数字。</td>\n</tr>\n<tr>\n<td>10</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_LOWER_CASE</strong>              确定一个字符是否是按照Java定义的小写。</td>\n</tr>\n<tr>\n<td>11</td>\n<td align=\"left\"><strong>static CharMatcher JAVA_UPPER_CASE</strong>              确定一个字符是否是按照Java定义的大写。</td>\n</tr>\n<tr>\n<td>12</td>\n<td align=\"left\"><strong>static CharMatcher NONE</strong>              匹配任何字符。</td>\n</tr>\n<tr>\n<td>13</td>\n<td align=\"left\"><strong>static CharMatcher SINGLE_WIDTH</strong>              确定一个字符是否是单宽度（不是双倍宽度）。</td>\n</tr>\n<tr>\n<td>14</td>\n<td align=\"left\"><strong>static CharMatcher WHITESPACE</strong>              决定根据最新的Unicode标准是否字符是空白，如图所示这里。</td>\n</tr>\n</tbody></table>\n<h2 id=\"构造函数\"><a href=\"#构造函数\" class=\"headerlink\" title=\"构造函数\"></a>构造函数</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>构造函数 &amp; 描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>protected CharMatcher()</strong>              构造方法，供子类使用。</td>\n</tr>\n</tbody></table>\n<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法 &amp; 描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>CharMatcher and(CharMatcher other)</strong>              返回一个匹配器，匹配两种匹配器和其他任何字符。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>static CharMatcher anyOf(CharSequence sequence)</strong>              返回一个字符匹配匹配任何字符出现在给定的字符序列。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>boolean apply(Character character)</strong>              不推荐使用。只有提供满足谓词接口;用匹配（字符）代替。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>String collapseFrom(CharSequence sequence, char replacement)</strong>              返回输入字符序列的字符串拷贝，每个组连续的字符匹配此匹配由单一的替换字符替换。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>int countIn(CharSequence sequence)</strong>              返回一个字符序列中发现匹配的字符的数目。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>static CharMatcher forPredicate(Predicate&lt;? super Character&gt; predicate)</strong>              返回与相同的行为给定的基于字符的谓词匹配，但运行在原始的字符，而不是实例。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>int indexIn(CharSequence sequence)</strong>              返回第一个匹配字符的索引中的一个字符序列，或-1，如果没有匹配的字符存在。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>int indexIn(CharSequence sequence, int start)</strong>              返回第一个匹配字符的索引中的一个字符序列，从给定位置开始，或-1，如果没有字符的位置之后匹配。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>static CharMatcher inRange(char startInclusive, char endInclusive)</strong>              返回一个字符匹配匹配给定范围内的任何字符（两个端点也包括在内）。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>static CharMatcher is(char match)</strong>              返回一个字符匹配匹配只有一个指定的字符。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>static CharMatcher isNot(char match)</strong>              返回一个字符匹配匹配除了指定的任何字符。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>int lastIndexIn(CharSequence sequence)</strong>              返回最后一个匹配字符的索引中的字符序列，或-1，如果没有匹配的字符存在。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>abstract boolean matches(char c)</strong>              确定给定字符一个true或false值。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>boolean matchesAllOf(CharSequence sequence)</strong>              确定给定字符一个true或false值。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>boolean matchesAnyOf(CharSequence sequence)</strong>              返回true如果字符序列包含至少一个匹配的字符。</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong>boolean matchesNoneOf(CharSequence sequence)</strong>              返回true，如果一个字符序列中没有匹配的字符。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong>CharMatcher negate()</strong>              返回一个匹配器，不受此匹配匹配任何字符。</td>\n</tr>\n<tr>\n<td>18</td>\n<td><strong>static CharMatcher noneOf(CharSequence sequence)</strong>              返回一个字符匹配器匹配不存在于给定的字符序列的任何字符。</td>\n</tr>\n<tr>\n<td>19</td>\n<td><strong>CharMatcher or(CharMatcher other)</strong>              返回一个匹配器，匹配任何匹配或其他任何字符。</td>\n</tr>\n<tr>\n<td>20</td>\n<td><strong>CharMatcher precomputed()</strong>              返回一个字符匹配功能上等同于这一个，但它可能会快于原来的查询;您的里程可能会有所不同。</td>\n</tr>\n<tr>\n<td>21</td>\n<td><strong>String removeFrom(CharSequence sequence)</strong>              返回包含的字符序列的所有非匹配的字符，为了一个字符串。</td>\n</tr>\n<tr>\n<td>22</td>\n<td><strong>String replaceFrom(CharSequence sequence, char replacement)</strong>              返回输入字符序列的字符串副本，其中每个字符匹配该匹配器由一个给定的替换字符替换。</td>\n</tr>\n<tr>\n<td>23</td>\n<td><strong>String replaceFrom(CharSequence sequence, CharSequence replacement)</strong>              返回输入字符序列的字符串副本，其中每个字符匹配该匹配器由一个给定的替换序列替换。</td>\n</tr>\n<tr>\n<td>24</td>\n<td><strong>String retainFrom(CharSequence sequence)</strong>              返回包含的字符序列的所有字符匹配，为了一个字符串。</td>\n</tr>\n<tr>\n<td>25</td>\n<td><strong>String toString()</strong>              返回此CharMatcher，如CharMatcher.or（WHITESPACE，JAVA_DIGIT）的字符串表示。</td>\n</tr>\n<tr>\n<td>26</td>\n<td><strong>String trimAndCollapseFrom(CharSequence sequence, char replacement)</strong>              折叠匹配字符完全一样collapseFrom一组如collapseFrom(java.lang.CharSequence, char) 做的一样，不同之处在于，无需更换一组被移除的匹配字符在开始或该序列的结束。</td>\n</tr>\n<tr>\n<td>27</td>\n<td><strong>String trimFrom(CharSequence sequence)</strong>              返回输入字符序列省略了所有匹配器从一开始，并从该串的末尾匹配字符的字符串。</td>\n</tr>\n<tr>\n<td>28</td>\n<td><strong>String trimLeadingFrom(CharSequence sequence)</strong>              返回输入字符序列，它省略了所有这些匹配的字符串开始处匹配字符的字符串。</td>\n</tr>\n<tr>\n<td>29</td>\n<td><strong>String trimTrailingFrom(CharSequence sequence)</strong>              返回输入字符序列，它省略了所有这些匹配的字符串的结尾匹配字符的字符串。</td>\n</tr>\n</tbody></table>\n<p>In olden times, our <code>StringUtil</code> class grew unchecked, and had many methods like these:</p>\n<ul>\n<li><code>allAscii</code></li>\n<li><code>collapse</code></li>\n<li><code>collapseControlChars</code></li>\n<li><code>collapseWhitespace</code></li>\n<li><code>lastIndexNotOf</code></li>\n<li><code>numSharedChars</code></li>\n<li><code>removeChars</code></li>\n<li><code>removeCrLf</code></li>\n<li><code>retainAllChars</code></li>\n<li><code>strip</code></li>\n<li><code>stripAndCollapse</code></li>\n<li><code>stripNonDigits</code></li>\n</ul>\n<p>They represent a partial cross product of two notions:</p>\n<ol>\n<li>what constitutes a “matching” character?</li>\n<li>what to do with those “matching” characters?</li>\n</ol>\n<p>To simplify this morass, we developed <code>CharMatcher</code>.</p>\n<p>Intuitively, you can think of a <code>CharMatcher</code> as representing a particular class of characters, like digits or whitespace. Practically speaking, a <code>CharMatcher</code> is just a boolean predicate on characters – indeed, <code>CharMatcher</code> implements [<code>Predicate&lt;Character&gt;</code>] – but because it is so common to refer to “all whitespace characters” or “all lowercase letters,” Guava provides this specialized syntax and API for characters.</p>\n<p>But the utility of a <code>CharMatcher</code> is in the <em>operations</em> it lets you perform on occurrences of the specified class of characters: trimming, collapsing, removing, retaining, and much more. An object of type <code>CharMatcher</code> represents notion 1: what constitutes a matching character? It then provides many operations answering notion 2: what to do with those matching characters? The result is that API complexity increases linearly for quadratically increasing flexibility and power. Yay!</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">noControl</span> <span class=\"operator\">=</span> CharMatcher.javaIsoControl().removeFrom(string); <span class=\"comment\">// remove control characters</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">theDigits</span> <span class=\"operator\">=</span> CharMatcher.digit().retainFrom(string); <span class=\"comment\">// only the digits</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">spaced</span> <span class=\"operator\">=</span> CharMatcher.whitespace().trimAndCollapseFrom(string, <span class=\"string\">&#x27; &#x27;</span>);</span><br><span class=\"line\">  <span class=\"comment\">// trim whitespace at ends, and replace/collapse whitespace into single spaces</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">noDigits</span> <span class=\"operator\">=</span> CharMatcher.javaDigit().replaceFrom(string, <span class=\"string\">&quot;*&quot;</span>); <span class=\"comment\">// star out all digits</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">lowerAndDigit</span> <span class=\"operator\">=</span> CharMatcher.javaDigit().or(CharMatcher.javaLowerCase()).retainFrom(string);</span><br><span class=\"line\">  <span class=\"comment\">// eliminate all characters that aren&#x27;t digits or lowercase</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>Note:</strong> <code>CharMatcher</code> deals only with <code>char</code> values; it does not understand supplementary Unicode code points in the range 0x10000 to 0x10FFFF. Such logical characters are encoded into a <code>String</code> using surrogate pairs, and a <code>CharMatcher</code> treats these just as two separate characters.</p>\n<h3 id=\"Obtaining-CharMatchers\"><a href=\"#Obtaining-CharMatchers\" class=\"headerlink\" title=\"Obtaining CharMatchers\"></a>Obtaining CharMatchers</h3><p>Many needs can be satisfied by the provided <code>CharMatcher</code> factory methods:</p>\n<ul>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#any--\"><code>any()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#none--\"><code>none()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#whitespace--\"><code>whitespace()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#breakingWhitespace--\"><code>breakingWhitespace()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#invisible--\"><code>invisible()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#digit--\"><code>digit()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLetter--\"><code>javaLetter()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaDigit--\"><code>javaDigit()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLetterOrDigit--\"><code>javaLetterOrDigit()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaIsoControl--\"><code>javaIsoControl()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaLowerCase--\"><code>javaLowerCase()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#javaUpperCase--\"><code>javaUpperCase()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#ascii--\"><code>ascii()</code></a></li>\n<li><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#singleWidth--\"><code>singleWidth()</code></a></li>\n</ul>\n<p>Other common ways to obtain a <code>CharMatcher</code> include:</p>\n<table>\n<thead>\n<tr>\n<th>Method</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#anyOf-java.lang.CharSequence-\"><code>anyOf(CharSequence)</code></a></td>\n<td>Specify all the characters you wish matched. For example, <code>CharMatcher.anyOf(&quot;aeiou&quot;)</code> matches lowercase English vowels.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#is-char-\"><code>is(char)</code></a></td>\n<td>Specify exactly one character to match.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#inRange-char-char-\"><code>inRange(char, char)</code></a></td>\n<td>Specify a range of characters to match, e.g. <code>CharMatcher.inRange(&#39;a&#39;, &#39;z&#39;)</code>.</td>\n</tr>\n</tbody></table>\n<p>Additionally, <code>CharMatcher</code> has <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#negate--\"><code>negate()</code></a>, <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#and-com.google.common.base.CharMatcher-\"><code>and(CharMatcher)</code></a>, and <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#or-com.google.common.base.CharMatcher-\"><code>or(CharMatcher)</code></a>. These provide simple boolean operations on <code>CharMatcher</code>.</p>\n<h3 id=\"Using-CharMatchers\"><a href=\"#Using-CharMatchers\" class=\"headerlink\" title=\"Using CharMatchers\"></a>Using CharMatchers</h3><p><code>CharMatcher</code> provides a <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#method_summary\">wide variety</a> of methods to operate on occurrences of the specified characters in any <code>CharSequence</code>. There are more methods provided than we can list here, but some of the most commonly used are:</p>\n<table>\n<thead>\n<tr>\n<th>Method</th>\n<th>Description</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#collapseFrom-java.lang.CharSequence-char-\"><code>collapseFrom(CharSequence, char)</code></a></td>\n<td>Replace each group of consecutive matched characters with the specified character. For example, <code>WHITESPACE.collapseFrom(string, &#39; &#39;)</code> collapses whitespaces down to a single space.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#matchesAllOf-java.lang.CharSequence-\"><code>matchesAllOf(CharSequence)</code></a></td>\n<td>Test if this matcher matches all characters in the sequence. For example, <code>ASCII.matchesAllOf(string)</code> tests if all characters in the string are ASCII.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#removeFrom-java.lang.CharSequence-\"><code>removeFrom(CharSequence)</code></a></td>\n<td>Removes matching characters from the sequence.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#retainFrom-java.lang.CharSequence-\"><code>retainFrom(CharSequence)</code></a></td>\n<td>Removes all non-matching characters from the sequence.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#trimFrom-java.lang.CharSequence-\"><code>trimFrom(CharSequence)</code></a></td>\n<td>Removes leading and trailing matching characters.</td>\n</tr>\n<tr>\n<td><a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/CharMatcher.html#replaceFrom-java.lang.CharSequence-java.lang.CharSequence-\"><code>replaceFrom(CharSequence, CharSequence)</code></a></td>\n<td>Replace matching characters with a given sequence.</td>\n</tr>\n</tbody></table>\n<p>(Note: all of these methods return a <code>String</code>, except for <code>matchesAllOf</code>, which returns a <code>boolean</code>.)</p>\n<p>例子</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testCharMatcher</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 统计字符串中字符的个数</span></span><br><span class=\"line\">  assertEquals(<span class=\"number\">3</span>, CharMatcher.is(<span class=\"string\">&#x27;#&#x27;</span>).countIn(<span class=\"string\">&quot;#hello#world#&quot;</span>));</span><br><span class=\"line\">  <span class=\"comment\">// 保留某些字符</span></span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;bc&quot;</span>, CharMatcher.inRange(<span class=\"string\">&#x27;b&#x27;</span>, <span class=\"string\">&#x27;c&#x27;</span>).retainFrom(<span class=\"string\">&quot;abcdefg&quot;</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaef9fd-c0ab-11ec-92a1-7557b2313227","title":"Guava Functions","abbrlink":"9a47c4e","_content":"\n\n# Functions\n\n类方法\n\n| S.N  | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | static toStringFunction() 返回object -> tostring             |\n| 2    | static identity() 输入和输出一样的值                         |\n| 3    | static <K, V> Function<K, V> forMap(Map<K, V> map) 返回FunctionForMapNoDefault,能够获取map的值 |\n| 4    | static <K, V> Function<K, V> forMap(Map<K, ? extends V> map, @Nullable V defaultValue) 能够获取defualt值的function |\n| 5    | static <A, B, C> Function<A, C> compose(Function<B, C> g, Function<A, ? extends B> f) 组合functions,返回<A,C> 输入是A, 返回值是C |\n| 6    | static <T> Function<T, Boolean> forPredicate(Predicate<T> predicate) ，输入值是，返回值是bool值 |\n| 7    | static <E> Function<Object, E> constant(@Nullable E value)  返回常量值 |\n| 8    | static <T> Function<Object, T> forSupplier(Supplier<T> supplier) |\n\n","source":"_posts/guava/Functions.md","raw":"---\nuuid: bbaef9fd-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Functions\ncategories: Java\ntags:\n  - guava\nabbrlink: 9a47c4e\n---\n\n\n# Functions\n\n类方法\n\n| S.N  | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | static toStringFunction() 返回object -> tostring             |\n| 2    | static identity() 输入和输出一样的值                         |\n| 3    | static <K, V> Function<K, V> forMap(Map<K, V> map) 返回FunctionForMapNoDefault,能够获取map的值 |\n| 4    | static <K, V> Function<K, V> forMap(Map<K, ? extends V> map, @Nullable V defaultValue) 能够获取defualt值的function |\n| 5    | static <A, B, C> Function<A, C> compose(Function<B, C> g, Function<A, ? extends B> f) 组合functions,返回<A,C> 输入是A, 返回值是C |\n| 6    | static <T> Function<T, Boolean> forPredicate(Predicate<T> predicate) ，输入值是，返回值是bool值 |\n| 7    | static <E> Function<Object, E> constant(@Nullable E value)  返回常量值 |\n| 8    | static <T> Function<Object, T> forSupplier(Supplier<T> supplier) |\n\n","slug":"guava/Functions","published":1,"date":"2022-04-20T12:41:20.861Z","updated":"2022-05-04T03:11:57.773Z","_id":"cl2qzfthk002113no26ve3bcd","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Functions\"><a href=\"#Functions\" class=\"headerlink\" title=\"Functions\"></a>Functions</h1><p>类方法</p>\n<table>\n<thead>\n<tr>\n<th>S.N</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>static toStringFunction() 返回object -&gt; tostring</td>\n</tr>\n<tr>\n<td>2</td>\n<td>static identity() 输入和输出一样的值</td>\n</tr>\n<tr>\n<td>3</td>\n<td>static &lt;K, V&gt; Function&lt;K, V&gt; forMap(Map&lt;K, V&gt; map) 返回FunctionForMapNoDefault,能够获取map的值</td>\n</tr>\n<tr>\n<td>4</td>\n<td>static &lt;K, V&gt; Function&lt;K, V&gt; forMap(Map&lt;K, ? extends V&gt; map, @Nullable V defaultValue) 能够获取defualt值的function</td>\n</tr>\n<tr>\n<td>5</td>\n<td>static &lt;A, B, C&gt; Function&lt;A, C&gt; compose(Function&lt;B, C&gt; g, Function&lt;A, ? extends B&gt; f) 组合functions,返回&lt;A,C&gt; 输入是A, 返回值是C</td>\n</tr>\n<tr>\n<td>6</td>\n<td>static <T> Function&lt;T, Boolean&gt; forPredicate(Predicate<T> predicate) ，输入值是，返回值是bool值</td>\n</tr>\n<tr>\n<td>7</td>\n<td>static <E> Function&lt;Object, E&gt; constant(@Nullable E value)  返回常量值</td>\n</tr>\n<tr>\n<td>8</td>\n<td>static <T> Function&lt;Object, T&gt; forSupplier(Supplier<T> supplier)</td>\n</tr>\n</tbody></table>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Functions\"><a href=\"#Functions\" class=\"headerlink\" title=\"Functions\"></a>Functions</h1><p>类方法</p>\n<table>\n<thead>\n<tr>\n<th>S.N</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>static toStringFunction() 返回object -&gt; tostring</td>\n</tr>\n<tr>\n<td>2</td>\n<td>static identity() 输入和输出一样的值</td>\n</tr>\n<tr>\n<td>3</td>\n<td>static &lt;K, V&gt; Function&lt;K, V&gt; forMap(Map&lt;K, V&gt; map) 返回FunctionForMapNoDefault,能够获取map的值</td>\n</tr>\n<tr>\n<td>4</td>\n<td>static &lt;K, V&gt; Function&lt;K, V&gt; forMap(Map&lt;K, ? extends V&gt; map, @Nullable V defaultValue) 能够获取defualt值的function</td>\n</tr>\n<tr>\n<td>5</td>\n<td>static &lt;A, B, C&gt; Function&lt;A, C&gt; compose(Function&lt;B, C&gt; g, Function&lt;A, ? extends B&gt; f) 组合functions,返回&lt;A,C&gt; 输入是A, 返回值是C</td>\n</tr>\n<tr>\n<td>6</td>\n<td>static <T> Function&lt;T, Boolean&gt; forPredicate(Predicate<T> predicate) ，输入值是，返回值是bool值</td>\n</tr>\n<tr>\n<td>7</td>\n<td>static <E> Function&lt;Object, E&gt; constant(@Nullable E value)  返回常量值</td>\n</tr>\n<tr>\n<td>8</td>\n<td>static <T> Function&lt;Object, T&gt; forSupplier(Supplier<T> supplier)</td>\n</tr>\n</tbody></table>\n"},{"uuid":"bbaef9fb-c0ab-11ec-92a1-7557b2313227","title":"Guava CaseFormat","abbrlink":"995f4974","_content":"\n## 枚举常量\n\n| S.N. | 枚举常量和说明                                               |\n| ---- | ------------------------------------------------------------ |\n| 1    | **LOWER_CAMEL**  \t\t\tJava变量的命名规则，如“lowerCamel”。 |\n| 2    | **LOWER_HYPHEN**  \t\t\t连字符连接变量的命名规则，如“lower-hyphen”。 |\n| 3    | **LOWER_UNDERSCORE**  \t\t\tC ++变量命名规则，如“lower_underscore”。 |\n| 4    | **UPPER_CAMEL**  \t\t\tJava和C++类的命名规则，如“UpperCamel”。 |\n| 5    | **UPPER_UNDERSCORE**  \t\t\tJava和C++常量的命名规则，如“UPPER_UNDERSCORE”。 |\n\n## 方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **Converter<String,String> converterTo(CaseFormat targetFormat)**  \t\t\t返回一个转换，从这个格式转换targetFormat字符串。 |\n| 2    | **String to(CaseFormat format, String str)**  \t\t\t从这一格式指定格式的指定字符串 str 转换。 |\n| 3    | **static CaseFormat valueOf(String name)**  \t\t\t返回此类型具有指定名称的枚举常量。 |\n| 4    | **static CaseFormat[] values()**  \t\t\t返回一个包含该枚举类型的常量数组中的顺序被声明。 |\n\n## 例子\n\n```java\n// test-world\nSystem.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_HYPHEN, \"test_world\"));\n// test_world\nSystem.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_UNDERSCORE, \"test_world\"));\n// testWorld\nSystem.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_CAMEL, \"test_world\"));\n// TestWorld\nSystem.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.UPPER_CAMEL, \"test_world\"));\n// TEST_WORLD\nSystem.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.UPPER_UNDERSCORE, \"test_world\"));\n```\n","source":"_posts/guava/CaseFormat.md","raw":"---\nuuid: bbaef9fb-c0ab-11ec-92a1-7557b2313227\ntitle: Guava CaseFormat\ncategories: Java\ntags:\n  - guava\nabbrlink: 995f4974\n---\n\n## 枚举常量\n\n| S.N. | 枚举常量和说明                                               |\n| ---- | ------------------------------------------------------------ |\n| 1    | **LOWER_CAMEL**  \t\t\tJava变量的命名规则，如“lowerCamel”。 |\n| 2    | **LOWER_HYPHEN**  \t\t\t连字符连接变量的命名规则，如“lower-hyphen”。 |\n| 3    | **LOWER_UNDERSCORE**  \t\t\tC ++变量命名规则，如“lower_underscore”。 |\n| 4    | **UPPER_CAMEL**  \t\t\tJava和C++类的命名规则，如“UpperCamel”。 |\n| 5    | **UPPER_UNDERSCORE**  \t\t\tJava和C++常量的命名规则，如“UPPER_UNDERSCORE”。 |\n\n## 方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **Converter<String,String> converterTo(CaseFormat targetFormat)**  \t\t\t返回一个转换，从这个格式转换targetFormat字符串。 |\n| 2    | **String to(CaseFormat format, String str)**  \t\t\t从这一格式指定格式的指定字符串 str 转换。 |\n| 3    | **static CaseFormat valueOf(String name)**  \t\t\t返回此类型具有指定名称的枚举常量。 |\n| 4    | **static CaseFormat[] values()**  \t\t\t返回一个包含该枚举类型的常量数组中的顺序被声明。 |\n\n## 例子\n\n```java\n// test-world\nSystem.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_HYPHEN, \"test_world\"));\n// test_world\nSystem.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_UNDERSCORE, \"test_world\"));\n// testWorld\nSystem.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_CAMEL, \"test_world\"));\n// TestWorld\nSystem.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.UPPER_CAMEL, \"test_world\"));\n// TEST_WORLD\nSystem.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.UPPER_UNDERSCORE, \"test_world\"));\n```\n","slug":"guava/CaseFormat","published":1,"date":"2022-04-20T12:41:20.866Z","updated":"2022-05-04T03:07:17.118Z","_id":"cl2qzfthm002613noaz89fn27","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"枚举常量\"><a href=\"#枚举常量\" class=\"headerlink\" title=\"枚举常量\"></a>枚举常量</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>枚举常量和说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>LOWER_CAMEL</strong>              Java变量的命名规则，如“lowerCamel”。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>LOWER_HYPHEN</strong>              连字符连接变量的命名规则，如“lower-hyphen”。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>LOWER_UNDERSCORE</strong>              C ++变量命名规则，如“lower_underscore”。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>UPPER_CAMEL</strong>              Java和C++类的命名规则，如“UpperCamel”。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>UPPER_UNDERSCORE</strong>              Java和C++常量的命名规则，如“UPPER_UNDERSCORE”。</td>\n</tr>\n</tbody></table>\n<h2 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>Converter&lt;String,String&gt; converterTo(CaseFormat targetFormat)</strong>              返回一个转换，从这个格式转换targetFormat字符串。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>String to(CaseFormat format, String str)</strong>              从这一格式指定格式的指定字符串 str 转换。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>static CaseFormat valueOf(String name)</strong>              返回此类型具有指定名称的枚举常量。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>static CaseFormat[] values()</strong>              返回一个包含该枚举类型的常量数组中的顺序被声明。</td>\n</tr>\n</tbody></table>\n<h2 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// test-world</span></span><br><span class=\"line\">System.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_HYPHEN, <span class=\"string\">&quot;test_world&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// test_world</span></span><br><span class=\"line\">System.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_UNDERSCORE, <span class=\"string\">&quot;test_world&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// testWorld</span></span><br><span class=\"line\">System.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_CAMEL, <span class=\"string\">&quot;test_world&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// TestWorld</span></span><br><span class=\"line\">System.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.UPPER_CAMEL, <span class=\"string\">&quot;test_world&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// TEST_WORLD</span></span><br><span class=\"line\">System.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.UPPER_UNDERSCORE, <span class=\"string\">&quot;test_world&quot;</span>));</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"枚举常量\"><a href=\"#枚举常量\" class=\"headerlink\" title=\"枚举常量\"></a>枚举常量</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>枚举常量和说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>LOWER_CAMEL</strong>              Java变量的命名规则，如“lowerCamel”。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>LOWER_HYPHEN</strong>              连字符连接变量的命名规则，如“lower-hyphen”。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>LOWER_UNDERSCORE</strong>              C ++变量命名规则，如“lower_underscore”。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>UPPER_CAMEL</strong>              Java和C++类的命名规则，如“UpperCamel”。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>UPPER_UNDERSCORE</strong>              Java和C++常量的命名规则，如“UPPER_UNDERSCORE”。</td>\n</tr>\n</tbody></table>\n<h2 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>Converter&lt;String,String&gt; converterTo(CaseFormat targetFormat)</strong>              返回一个转换，从这个格式转换targetFormat字符串。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>String to(CaseFormat format, String str)</strong>              从这一格式指定格式的指定字符串 str 转换。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>static CaseFormat valueOf(String name)</strong>              返回此类型具有指定名称的枚举常量。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>static CaseFormat[] values()</strong>              返回一个包含该枚举类型的常量数组中的顺序被声明。</td>\n</tr>\n</tbody></table>\n<h2 id=\"例子\"><a href=\"#例子\" class=\"headerlink\" title=\"例子\"></a>例子</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// test-world</span></span><br><span class=\"line\">System.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_HYPHEN, <span class=\"string\">&quot;test_world&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// test_world</span></span><br><span class=\"line\">System.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_UNDERSCORE, <span class=\"string\">&quot;test_world&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// testWorld</span></span><br><span class=\"line\">System.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.LOWER_CAMEL, <span class=\"string\">&quot;test_world&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// TestWorld</span></span><br><span class=\"line\">System.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.UPPER_CAMEL, <span class=\"string\">&quot;test_world&quot;</span>));</span><br><span class=\"line\"><span class=\"comment\">// TEST_WORLD</span></span><br><span class=\"line\">System.out.println(CaseFormat.LOWER_UNDERSCORE.to(CaseFormat.UPPER_UNDERSCORE, <span class=\"string\">&quot;test_world&quot;</span>));</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaef9fe-c0ab-11ec-92a1-7557b2313227","title":"Guava Joiner","abbrlink":"c97c32ce","_content":"\n# Joiner常见用法\n\n## Join list\n\n~~~java\n@Test\nvoid testJoinerList() {\n  List<String> list = List.of(\"java\", \"python\", \"golang\");\n  String join = Joiner.on(\"#\").join(list);\n  assertEquals(\"java#python#golang\", join);\n}\n~~~\n\n## Join list skip null\n\n~~~java\n@Test\nvoid testJoinerListSkipNull() {\n  List<Object> list = new ArrayList<>();\n  list.add(\"java\");\n  list.add(\"python\");\n  list.add(\"golang\");\n  list.add(null);\n  String join = Joiner.on(\"#\").skipNulls().join(list);\n  assertEquals(\"java#python#golang\", join);\n}\n~~~\n\n## Join list use default null\n\n~~~java\n@Test\nvoid testJoinerListUseForNull() {\n  List<Object> list = new ArrayList<>();\n  list.add(\"java\");\n  list.add(\"python\");\n  list.add(\"golang\");\n  list.add(null);\n  String join = Joiner.on(\"#\").useForNull(\"default\").join(list);\n  assertEquals(\"java#python#golang#default\", join);\n}\n~~~\n\n## Join map\n\n~~~java\n@Test\nvoid testJoinerMap() {\n  Map<String, String> map = Map.of(\"k1\", \"v1\", \"k2\", \"v2\", \"k3\", \"v3\");\n  String join = Joiner.on(\"&\").withKeyValueSeparator(\"=\").join(map);\n  assertTrue(join.contains(\"=\"));\n}\n~~~\n\nJoin appender\n\n~~~java\n@Test\nvoid testJoinerAppender() {\n  List<String> list = List.of(\"java\", \"python\", \"golang\");\n  StringBuilder builder = new StringBuilder();\n  StringBuilder join = Joiner.on(\"#\").appendTo(builder, list);\n  assertSame(builder, join);\n}\n~~~\n","source":"_posts/guava/Joiner.md","raw":"---\nuuid: bbaef9fe-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Joiner\ncategories: Java\ntags:\n  - guava\nabbrlink: c97c32ce\n---\n\n# Joiner常见用法\n\n## Join list\n\n~~~java\n@Test\nvoid testJoinerList() {\n  List<String> list = List.of(\"java\", \"python\", \"golang\");\n  String join = Joiner.on(\"#\").join(list);\n  assertEquals(\"java#python#golang\", join);\n}\n~~~\n\n## Join list skip null\n\n~~~java\n@Test\nvoid testJoinerListSkipNull() {\n  List<Object> list = new ArrayList<>();\n  list.add(\"java\");\n  list.add(\"python\");\n  list.add(\"golang\");\n  list.add(null);\n  String join = Joiner.on(\"#\").skipNulls().join(list);\n  assertEquals(\"java#python#golang\", join);\n}\n~~~\n\n## Join list use default null\n\n~~~java\n@Test\nvoid testJoinerListUseForNull() {\n  List<Object> list = new ArrayList<>();\n  list.add(\"java\");\n  list.add(\"python\");\n  list.add(\"golang\");\n  list.add(null);\n  String join = Joiner.on(\"#\").useForNull(\"default\").join(list);\n  assertEquals(\"java#python#golang#default\", join);\n}\n~~~\n\n## Join map\n\n~~~java\n@Test\nvoid testJoinerMap() {\n  Map<String, String> map = Map.of(\"k1\", \"v1\", \"k2\", \"v2\", \"k3\", \"v3\");\n  String join = Joiner.on(\"&\").withKeyValueSeparator(\"=\").join(map);\n  assertTrue(join.contains(\"=\"));\n}\n~~~\n\nJoin appender\n\n~~~java\n@Test\nvoid testJoinerAppender() {\n  List<String> list = List.of(\"java\", \"python\", \"golang\");\n  StringBuilder builder = new StringBuilder();\n  StringBuilder join = Joiner.on(\"#\").appendTo(builder, list);\n  assertSame(builder, join);\n}\n~~~\n","slug":"guava/Joiner","published":1,"date":"2022-04-20T12:41:20.840Z","updated":"2022-05-04T03:12:11.714Z","_id":"cl2qzfthm002713noc60o9eko","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Joiner常见用法\"><a href=\"#Joiner常见用法\" class=\"headerlink\" title=\"Joiner常见用法\"></a>Joiner常见用法</h1><h2 id=\"Join-list\"><a href=\"#Join-list\" class=\"headerlink\" title=\"Join list\"></a>Join list</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testJoinerList</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  List&lt;String&gt; list = List.of(<span class=\"string\">&quot;java&quot;</span>, <span class=\"string\">&quot;python&quot;</span>, <span class=\"string\">&quot;golang&quot;</span>);</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">join</span> <span class=\"operator\">=</span> Joiner.on(<span class=\"string\">&quot;#&quot;</span>).join(list);</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;java#python#golang&quot;</span>, join);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Join-list-skip-null\"><a href=\"#Join-list-skip-null\" class=\"headerlink\" title=\"Join list skip null\"></a>Join list skip null</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testJoinerListSkipNull</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  List&lt;Object&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;java&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;python&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;golang&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">join</span> <span class=\"operator\">=</span> Joiner.on(<span class=\"string\">&quot;#&quot;</span>).skipNulls().join(list);</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;java#python#golang&quot;</span>, join);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Join-list-use-default-null\"><a href=\"#Join-list-use-default-null\" class=\"headerlink\" title=\"Join list use default null\"></a>Join list use default null</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testJoinerListUseForNull</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  List&lt;Object&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;java&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;python&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;golang&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">join</span> <span class=\"operator\">=</span> Joiner.on(<span class=\"string\">&quot;#&quot;</span>).useForNull(<span class=\"string\">&quot;default&quot;</span>).join(list);</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;java#python#golang#default&quot;</span>, join);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Join-map\"><a href=\"#Join-map\" class=\"headerlink\" title=\"Join map\"></a>Join map</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testJoinerMap</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  Map&lt;String, String&gt; map = Map.of(<span class=\"string\">&quot;k1&quot;</span>, <span class=\"string\">&quot;v1&quot;</span>, <span class=\"string\">&quot;k2&quot;</span>, <span class=\"string\">&quot;v2&quot;</span>, <span class=\"string\">&quot;k3&quot;</span>, <span class=\"string\">&quot;v3&quot;</span>);</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">join</span> <span class=\"operator\">=</span> Joiner.on(<span class=\"string\">&quot;&amp;&quot;</span>).withKeyValueSeparator(<span class=\"string\">&quot;=&quot;</span>).join(map);</span><br><span class=\"line\">  assertTrue(join.contains(<span class=\"string\">&quot;=&quot;</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Join appender</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testJoinerAppender</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  List&lt;String&gt; list = List.of(<span class=\"string\">&quot;java&quot;</span>, <span class=\"string\">&quot;python&quot;</span>, <span class=\"string\">&quot;golang&quot;</span>);</span><br><span class=\"line\">  <span class=\"type\">StringBuilder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuilder</span>();</span><br><span class=\"line\">  <span class=\"type\">StringBuilder</span> <span class=\"variable\">join</span> <span class=\"operator\">=</span> Joiner.on(<span class=\"string\">&quot;#&quot;</span>).appendTo(builder, list);</span><br><span class=\"line\">  assertSame(builder, join);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Joiner常见用法\"><a href=\"#Joiner常见用法\" class=\"headerlink\" title=\"Joiner常见用法\"></a>Joiner常见用法</h1><h2 id=\"Join-list\"><a href=\"#Join-list\" class=\"headerlink\" title=\"Join list\"></a>Join list</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testJoinerList</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  List&lt;String&gt; list = List.of(<span class=\"string\">&quot;java&quot;</span>, <span class=\"string\">&quot;python&quot;</span>, <span class=\"string\">&quot;golang&quot;</span>);</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">join</span> <span class=\"operator\">=</span> Joiner.on(<span class=\"string\">&quot;#&quot;</span>).join(list);</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;java#python#golang&quot;</span>, join);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Join-list-skip-null\"><a href=\"#Join-list-skip-null\" class=\"headerlink\" title=\"Join list skip null\"></a>Join list skip null</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testJoinerListSkipNull</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  List&lt;Object&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;java&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;python&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;golang&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">join</span> <span class=\"operator\">=</span> Joiner.on(<span class=\"string\">&quot;#&quot;</span>).skipNulls().join(list);</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;java#python#golang&quot;</span>, join);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Join-list-use-default-null\"><a href=\"#Join-list-use-default-null\" class=\"headerlink\" title=\"Join list use default null\"></a>Join list use default null</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testJoinerListUseForNull</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  List&lt;Object&gt; list = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;();</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;java&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;python&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"string\">&quot;golang&quot;</span>);</span><br><span class=\"line\">  list.add(<span class=\"literal\">null</span>);</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">join</span> <span class=\"operator\">=</span> Joiner.on(<span class=\"string\">&quot;#&quot;</span>).useForNull(<span class=\"string\">&quot;default&quot;</span>).join(list);</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;java#python#golang#default&quot;</span>, join);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Join-map\"><a href=\"#Join-map\" class=\"headerlink\" title=\"Join map\"></a>Join map</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testJoinerMap</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  Map&lt;String, String&gt; map = Map.of(<span class=\"string\">&quot;k1&quot;</span>, <span class=\"string\">&quot;v1&quot;</span>, <span class=\"string\">&quot;k2&quot;</span>, <span class=\"string\">&quot;v2&quot;</span>, <span class=\"string\">&quot;k3&quot;</span>, <span class=\"string\">&quot;v3&quot;</span>);</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">join</span> <span class=\"operator\">=</span> Joiner.on(<span class=\"string\">&quot;&amp;&quot;</span>).withKeyValueSeparator(<span class=\"string\">&quot;=&quot;</span>).join(map);</span><br><span class=\"line\">  assertTrue(join.contains(<span class=\"string\">&quot;=&quot;</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Join appender</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testJoinerAppender</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  List&lt;String&gt; list = List.of(<span class=\"string\">&quot;java&quot;</span>, <span class=\"string\">&quot;python&quot;</span>, <span class=\"string\">&quot;golang&quot;</span>);</span><br><span class=\"line\">  <span class=\"type\">StringBuilder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuilder</span>();</span><br><span class=\"line\">  <span class=\"type\">StringBuilder</span> <span class=\"variable\">join</span> <span class=\"operator\">=</span> Joiner.on(<span class=\"string\">&quot;#&quot;</span>).appendTo(builder, list);</span><br><span class=\"line\">  assertSame(builder, join);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf2100-c0ab-11ec-92a1-7557b2313227","title":"Guava Objects","abbrlink":"4bcb4612","_content":"\n# Objects\n\n该类主要提供了处理Object相关的工具方法。\n\n## equals\n\nWhen your object fields can be `null`, implementing `Object.equals` can be a pain, because you have to check separately for `null`. Using [`Objects.equal`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/Objects.html#equal-java.lang.Object-java.lang.Object-) lets you perform `equals` checks in a null-sensitive way, without risking a `NullPointerException`.\n\n```java\nObjects.equal(\"a\", \"a\"); // returns true\nObjects.equal(null, \"a\"); // returns false\nObjects.equal(\"a\", null); // returns false\nObjects.equal(null, null); // returns true\n```\n\n*Note*: The newly introduced `Objects` class in JDK 7 provides the equivalent [`Objects.equals`](http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#equals(java.lang.Object, java.lang.Object)) method.\n\n## hashCode\n\nHashing all the fields of an `Object` should be simpler. Guava's [`Objects.hashCode(Object...)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/Objects.html#hashCode-java.lang.Object...-) creates a sensible, order-sensitive hash for the specified sequence of fields. Use `Objects.hashCode(field1, field2, ..., fieldn)` instead of building the hash by hand.\n\n*Note*: The newly introduced `Objects` class in JDK 7 provides the equivalent [`Objects.hash(Object...)`](http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#hash(java.lang.Object...)).\n\n底层调用了`Arrays.hashCode`方法\n\n## toString\n\nA good `toString` method can be invaluable in debugging, but is a pain to write. Use [`MoreObjects.toStringHelper()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/MoreObjects.html#toStringHelper-java.lang.Object-) to easily create a useful `toString`. Some simple examples include:\n\n```java\n   // Returns \"ClassName{x=1}\"\n   MoreObjects.toStringHelper(this)\n       .add(\"x\", 1)\n       .toString();\n\n   // Returns \"MyObject{x=1}\"\n   MoreObjects.toStringHelper(\"MyObject\")\n       .add(\"x\", 1)\n       .toString();\n```\n\n## compare/compareTo\n\nImplementing a `Comparator`, or implementing the `Comparable` interface directly, can be a pain. Consider:\n\n```java\nclass Person implements Comparable<Person> {\n  private String lastName;\n  private String firstName;\n  private int zipCode;\n\n  public int compareTo(Person other) {\n    int cmp = lastName.compareTo(other.lastName);\n    if (cmp != 0) {\n      return cmp;\n    }\n    cmp = firstName.compareTo(other.firstName);\n    if (cmp != 0) {\n      return cmp;\n    }\n    return Integer.compare(zipCode, other.zipCode);\n  }\n}\n```\n\nThis code is easily messed up, tricky to scan for bugs, and unpleasantly verbose. We should be able to do better.\n\nFor this purpose, Guava provides [`ComparisonChain`](https://guava.dev/releases/snapshot/api/docs/com/google/common/collect/ComparisonChain.html).\n\n`ComparisonChain` performs a \"lazy\" comparison: it only performs comparisons until it finds a nonzero result, after which it ignores further input.\n\n```java\n   public int compareTo(Foo that) {\n     return ComparisonChain.start()\n         .compare(this.aString, that.aString)\n         .compare(this.anInt, that.anInt)\n         .compare(this.anEnum, that.anEnum, Ordering.natural().nullsLast())\n         .result();\n   }\n```\n\nThis fluent idiom is much more readable, less prone to accidental typos, and smart enough not to do more work than it must. Additional comparison utilities can be found in Guava's \"fluent Comparator\" class [`Ordering`](https://guava.dev/releases/snapshot/api/docs/com/google/common/collect/Ordering.html), explained [here](https://github.com/google/guava/wiki/OrderingExplained).\n","source":"_posts/guava/Objects&MoreObjects.md","raw":"---\nuuid: bbaf2100-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Objects\ncategories: Java\ntags:\n  - guava\nabbrlink: 4bcb4612\n---\n\n# Objects\n\n该类主要提供了处理Object相关的工具方法。\n\n## equals\n\nWhen your object fields can be `null`, implementing `Object.equals` can be a pain, because you have to check separately for `null`. Using [`Objects.equal`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/Objects.html#equal-java.lang.Object-java.lang.Object-) lets you perform `equals` checks in a null-sensitive way, without risking a `NullPointerException`.\n\n```java\nObjects.equal(\"a\", \"a\"); // returns true\nObjects.equal(null, \"a\"); // returns false\nObjects.equal(\"a\", null); // returns false\nObjects.equal(null, null); // returns true\n```\n\n*Note*: The newly introduced `Objects` class in JDK 7 provides the equivalent [`Objects.equals`](http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#equals(java.lang.Object, java.lang.Object)) method.\n\n## hashCode\n\nHashing all the fields of an `Object` should be simpler. Guava's [`Objects.hashCode(Object...)`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/Objects.html#hashCode-java.lang.Object...-) creates a sensible, order-sensitive hash for the specified sequence of fields. Use `Objects.hashCode(field1, field2, ..., fieldn)` instead of building the hash by hand.\n\n*Note*: The newly introduced `Objects` class in JDK 7 provides the equivalent [`Objects.hash(Object...)`](http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#hash(java.lang.Object...)).\n\n底层调用了`Arrays.hashCode`方法\n\n## toString\n\nA good `toString` method can be invaluable in debugging, but is a pain to write. Use [`MoreObjects.toStringHelper()`](https://guava.dev/releases/snapshot/api/docs/com/google/common/base/MoreObjects.html#toStringHelper-java.lang.Object-) to easily create a useful `toString`. Some simple examples include:\n\n```java\n   // Returns \"ClassName{x=1}\"\n   MoreObjects.toStringHelper(this)\n       .add(\"x\", 1)\n       .toString();\n\n   // Returns \"MyObject{x=1}\"\n   MoreObjects.toStringHelper(\"MyObject\")\n       .add(\"x\", 1)\n       .toString();\n```\n\n## compare/compareTo\n\nImplementing a `Comparator`, or implementing the `Comparable` interface directly, can be a pain. Consider:\n\n```java\nclass Person implements Comparable<Person> {\n  private String lastName;\n  private String firstName;\n  private int zipCode;\n\n  public int compareTo(Person other) {\n    int cmp = lastName.compareTo(other.lastName);\n    if (cmp != 0) {\n      return cmp;\n    }\n    cmp = firstName.compareTo(other.firstName);\n    if (cmp != 0) {\n      return cmp;\n    }\n    return Integer.compare(zipCode, other.zipCode);\n  }\n}\n```\n\nThis code is easily messed up, tricky to scan for bugs, and unpleasantly verbose. We should be able to do better.\n\nFor this purpose, Guava provides [`ComparisonChain`](https://guava.dev/releases/snapshot/api/docs/com/google/common/collect/ComparisonChain.html).\n\n`ComparisonChain` performs a \"lazy\" comparison: it only performs comparisons until it finds a nonzero result, after which it ignores further input.\n\n```java\n   public int compareTo(Foo that) {\n     return ComparisonChain.start()\n         .compare(this.aString, that.aString)\n         .compare(this.anInt, that.anInt)\n         .compare(this.anEnum, that.anEnum, Ordering.natural().nullsLast())\n         .result();\n   }\n```\n\nThis fluent idiom is much more readable, less prone to accidental typos, and smart enough not to do more work than it must. Additional comparison utilities can be found in Guava's \"fluent Comparator\" class [`Ordering`](https://guava.dev/releases/snapshot/api/docs/com/google/common/collect/Ordering.html), explained [here](https://github.com/google/guava/wiki/OrderingExplained).\n","slug":"guava/Objects&MoreObjects","published":1,"date":"2022-04-20T12:41:20.878Z","updated":"2022-05-04T03:14:08.662Z","_id":"cl2qzfthn002c13no10505wdd","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Objects\"><a href=\"#Objects\" class=\"headerlink\" title=\"Objects\"></a>Objects</h1><p>该类主要提供了处理Object相关的工具方法。</p>\n<h2 id=\"equals\"><a href=\"#equals\" class=\"headerlink\" title=\"equals\"></a>equals</h2><p>When your object fields can be <code>null</code>, implementing <code>Object.equals</code> can be a pain, because you have to check separately for <code>null</code>. Using <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/Objects.html#equal-java.lang.Object-java.lang.Object-\"><code>Objects.equal</code></a> lets you perform <code>equals</code> checks in a null-sensitive way, without risking a <code>NullPointerException</code>.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Objects.equal(<span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;a&quot;</span>); <span class=\"comment\">// returns true</span></span><br><span class=\"line\">Objects.equal(<span class=\"literal\">null</span>, <span class=\"string\">&quot;a&quot;</span>); <span class=\"comment\">// returns false</span></span><br><span class=\"line\">Objects.equal(<span class=\"string\">&quot;a&quot;</span>, <span class=\"literal\">null</span>); <span class=\"comment\">// returns false</span></span><br><span class=\"line\">Objects.equal(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>); <span class=\"comment\">// returns true</span></span><br></pre></td></tr></table></figure>\n\n<p><em>Note</em>: The newly introduced <code>Objects</code> class in JDK 7 provides the equivalent [<code>Objects.equals</code>](<a href=\"http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#equals\">http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#equals</a>(java.lang.Object, java.lang.Object)) method.</p>\n<h2 id=\"hashCode\"><a href=\"#hashCode\" class=\"headerlink\" title=\"hashCode\"></a>hashCode</h2><p>Hashing all the fields of an <code>Object</code> should be simpler. Guava’s <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/Objects.html#hashCode-java.lang.Object...-\"><code>Objects.hashCode(Object...)</code></a> creates a sensible, order-sensitive hash for the specified sequence of fields. Use <code>Objects.hashCode(field1, field2, ..., fieldn)</code> instead of building the hash by hand.</p>\n<p><em>Note</em>: The newly introduced <code>Objects</code> class in JDK 7 provides the equivalent <a href=\"http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#hash(java.lang.Object...)\"><code>Objects.hash(Object...)</code></a>.</p>\n<p>底层调用了<code>Arrays.hashCode</code>方法</p>\n<h2 id=\"toString-NaN\"><a href=\"#toString-NaN\" class=\"headerlink\" title=\"toString\"></a>toString</h2><p>A good <code>toString</code> method can be invaluable in debugging, but is a pain to write. Use <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/MoreObjects.html#toStringHelper-java.lang.Object-\"><code>MoreObjects.toStringHelper()</code></a> to easily create a useful <code>toString</code>. Some simple examples include:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Returns &quot;ClassName&#123;x=1&#125;&quot;</span></span><br><span class=\"line\">MoreObjects.toStringHelper(<span class=\"built_in\">this</span>)</span><br><span class=\"line\">    .add(<span class=\"string\">&quot;x&quot;</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">    .toString();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Returns &quot;MyObject&#123;x=1&#125;&quot;</span></span><br><span class=\"line\">MoreObjects.toStringHelper(<span class=\"string\">&quot;MyObject&quot;</span>)</span><br><span class=\"line\">    .add(<span class=\"string\">&quot;x&quot;</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">    .toString();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"compare-compareTo\"><a href=\"#compare-compareTo\" class=\"headerlink\" title=\"compare/compareTo\"></a>compare/compareTo</h2><p>Implementing a <code>Comparator</code>, or implementing the <code>Comparable</code> interface directly, can be a pain. Consider:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Comparable</span>&lt;Person&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> String lastName;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> String firstName;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"type\">int</span> zipCode;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">compareTo</span><span class=\"params\">(Person other)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">cmp</span> <span class=\"operator\">=</span> lastName.compareTo(other.lastName);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cmp != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> cmp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cmp = firstName.compareTo(other.firstName);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cmp != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> cmp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Integer.compare(zipCode, other.zipCode);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>This code is easily messed up, tricky to scan for bugs, and unpleasantly verbose. We should be able to do better.</p>\n<p>For this purpose, Guava provides <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/collect/ComparisonChain.html\"><code>ComparisonChain</code></a>.</p>\n<p><code>ComparisonChain</code> performs a “lazy” comparison: it only performs comparisons until it finds a nonzero result, after which it ignores further input.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">compareTo</span><span class=\"params\">(Foo that)</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ComparisonChain.start()</span><br><span class=\"line\">      .compare(<span class=\"built_in\">this</span>.aString, that.aString)</span><br><span class=\"line\">      .compare(<span class=\"built_in\">this</span>.anInt, that.anInt)</span><br><span class=\"line\">      .compare(<span class=\"built_in\">this</span>.anEnum, that.anEnum, Ordering.natural().nullsLast())</span><br><span class=\"line\">      .result();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>This fluent idiom is much more readable, less prone to accidental typos, and smart enough not to do more work than it must. Additional comparison utilities can be found in Guava’s “fluent Comparator” class <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/collect/Ordering.html\"><code>Ordering</code></a>, explained <a href=\"https://github.com/google/guava/wiki/OrderingExplained\">here</a>.</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Objects\"><a href=\"#Objects\" class=\"headerlink\" title=\"Objects\"></a>Objects</h1><p>该类主要提供了处理Object相关的工具方法。</p>\n<h2 id=\"equals\"><a href=\"#equals\" class=\"headerlink\" title=\"equals\"></a>equals</h2><p>When your object fields can be <code>null</code>, implementing <code>Object.equals</code> can be a pain, because you have to check separately for <code>null</code>. Using <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/Objects.html#equal-java.lang.Object-java.lang.Object-\"><code>Objects.equal</code></a> lets you perform <code>equals</code> checks in a null-sensitive way, without risking a <code>NullPointerException</code>.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Objects.equal(<span class=\"string\">&quot;a&quot;</span>, <span class=\"string\">&quot;a&quot;</span>); <span class=\"comment\">// returns true</span></span><br><span class=\"line\">Objects.equal(<span class=\"literal\">null</span>, <span class=\"string\">&quot;a&quot;</span>); <span class=\"comment\">// returns false</span></span><br><span class=\"line\">Objects.equal(<span class=\"string\">&quot;a&quot;</span>, <span class=\"literal\">null</span>); <span class=\"comment\">// returns false</span></span><br><span class=\"line\">Objects.equal(<span class=\"literal\">null</span>, <span class=\"literal\">null</span>); <span class=\"comment\">// returns true</span></span><br></pre></td></tr></table></figure>\n\n<p><em>Note</em>: The newly introduced <code>Objects</code> class in JDK 7 provides the equivalent [<code>Objects.equals</code>](<a href=\"http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#equals\">http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#equals</a>(java.lang.Object, java.lang.Object)) method.</p>\n<h2 id=\"hashCode\"><a href=\"#hashCode\" class=\"headerlink\" title=\"hashCode\"></a>hashCode</h2><p>Hashing all the fields of an <code>Object</code> should be simpler. Guava’s <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/Objects.html#hashCode-java.lang.Object...-\"><code>Objects.hashCode(Object...)</code></a> creates a sensible, order-sensitive hash for the specified sequence of fields. Use <code>Objects.hashCode(field1, field2, ..., fieldn)</code> instead of building the hash by hand.</p>\n<p><em>Note</em>: The newly introduced <code>Objects</code> class in JDK 7 provides the equivalent <a href=\"http://docs.oracle.com/javase/7/docs/api/java/util/Objects.html#hash(java.lang.Object...)\"><code>Objects.hash(Object...)</code></a>.</p>\n<p>底层调用了<code>Arrays.hashCode</code>方法</p>\n<h2 id=\"toString-NaN\"><a href=\"#toString-NaN\" class=\"headerlink\" title=\"toString\"></a>toString</h2><p>A good <code>toString</code> method can be invaluable in debugging, but is a pain to write. Use <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/base/MoreObjects.html#toStringHelper-java.lang.Object-\"><code>MoreObjects.toStringHelper()</code></a> to easily create a useful <code>toString</code>. Some simple examples include:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Returns &quot;ClassName&#123;x=1&#125;&quot;</span></span><br><span class=\"line\">MoreObjects.toStringHelper(<span class=\"built_in\">this</span>)</span><br><span class=\"line\">    .add(<span class=\"string\">&quot;x&quot;</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">    .toString();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Returns &quot;MyObject&#123;x=1&#125;&quot;</span></span><br><span class=\"line\">MoreObjects.toStringHelper(<span class=\"string\">&quot;MyObject&quot;</span>)</span><br><span class=\"line\">    .add(<span class=\"string\">&quot;x&quot;</span>, <span class=\"number\">1</span>)</span><br><span class=\"line\">    .toString();</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"compare-compareTo\"><a href=\"#compare-compareTo\" class=\"headerlink\" title=\"compare/compareTo\"></a>compare/compareTo</h2><p>Implementing a <code>Comparator</code>, or implementing the <code>Comparable</code> interface directly, can be a pain. Consider:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Person</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Comparable</span>&lt;Person&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> String lastName;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> String firstName;</span><br><span class=\"line\">  <span class=\"keyword\">private</span> <span class=\"type\">int</span> zipCode;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">compareTo</span><span class=\"params\">(Person other)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">cmp</span> <span class=\"operator\">=</span> lastName.compareTo(other.lastName);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cmp != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> cmp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    cmp = firstName.compareTo(other.firstName);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (cmp != <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> cmp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> Integer.compare(zipCode, other.zipCode);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>This code is easily messed up, tricky to scan for bugs, and unpleasantly verbose. We should be able to do better.</p>\n<p>For this purpose, Guava provides <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/collect/ComparisonChain.html\"><code>ComparisonChain</code></a>.</p>\n<p><code>ComparisonChain</code> performs a “lazy” comparison: it only performs comparisons until it finds a nonzero result, after which it ignores further input.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">compareTo</span><span class=\"params\">(Foo that)</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> ComparisonChain.start()</span><br><span class=\"line\">      .compare(<span class=\"built_in\">this</span>.aString, that.aString)</span><br><span class=\"line\">      .compare(<span class=\"built_in\">this</span>.anInt, that.anInt)</span><br><span class=\"line\">      .compare(<span class=\"built_in\">this</span>.anEnum, that.anEnum, Ordering.natural().nullsLast())</span><br><span class=\"line\">      .result();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>This fluent idiom is much more readable, less prone to accidental typos, and smart enough not to do more work than it must. Additional comparison utilities can be found in Guava’s “fluent Comparator” class <a href=\"https://guava.dev/releases/snapshot/api/docs/com/google/common/collect/Ordering.html\"><code>Ordering</code></a>, explained <a href=\"https://github.com/google/guava/wiki/OrderingExplained\">here</a>.</p>\n"},{"uuid":"bbaf2101-c0ab-11ec-92a1-7557b2313227","title":"Guava Optional","abbrlink":"4a0a9230","_content":"\n\n# Guava Optional类\n\nOptional用于包含非空对象的不可变对象。 Optional对象，用于不存在值表示null。这个类有各种实用的方法，以方便代码来处理为可用或不可用，而不是检查null值。\n\n## 类声明\n\n以下是com.google.common.base.Optional<T>类的声明：\n\n```java\n@GwtCompatible(serializable=true)\npublic abstract class Optional<T> extends Object implements Serializable\n```\n\n## 类方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **static <T> Optional<T> absent()**  \t\t\t返回没有包含的参考Optional的实例。 |\n| 2    | **abstract Set<T> asSet()**  \t\t\t返回一个不可变的单集的唯一元素所包含的实例(如果存在);否则为一个空的不可变的集合。 |\n| 3    | **abstract boolean equals(Object object)**  \t\t\t返回true如果对象是一个Optional实例，无论是包含引用彼此相等或两者都不存在。 |\n| 4    | **static <T> Optional<T> fromNullable(T nullableReference)**  \t\t\t如果nullableReference非空，返回一个包含引用Optional实例;否则返回absent()。 |\n| 5    | **abstract T get()**  \t\t\t返回所包含的实例，它必须存在。 |\n| 6    | **abstract int hashCode()**  \t\t\t返回此实例的哈希码。 |\n| 7    | **abstract boolean isPresent()**  \t\t\t返回true，如果这支架包含一个(非空)的实例。 |\n| 8    | **static <T> Optional<T> of(T reference)**  \t\t\t返回包含给定的非空引用Optional实例。 |\n| 9    | **abstract Optional<T> or(Optional<? extends T> secondChoice)**  \t\t\t返回此Optional，如果它有一个值存在; 否则返回secondChoice。 |\n| 10   | **abstract T or(Supplier<? extends T> supplier)**  \t\t\t返回所包含的实例(如果存在); 否则supplier.get()。 |\n| 11   | **abstract T or(T defaultValue)**  \t\t\t返回所包含的实例(如果存在);否则为默认值。 |\n| 12   | **abstract T orNull()**  \t\t\t返回所包含的实例(如果存在);否则返回null。 |\n| 13   | **static <T> Iterable<T> presentInstances(Iterable<? extends Optional<? extends T>> optionals)**  \t\t\t从提供的optionals返回每个实例的存在的值，从而跳过absent()。 |\n| 14   | **abstract String toString()**  \t\t\t返回此实例的字符串表示。 |\n| 15   | **abstract <V> Optional<V> transform(Function<? super T,V> function)**  \t\t\t如果实例存在，则它被转换给定的功能;否则absent()被返回。 |\n\n## 继承的方法\n\n这个类继承了以下类的方法：\n\n- java.lang.Object\n\n## Optional示例：\n\n使用所选择的编辑器，创建下面的java程序，比如 C:/> Guava\n\nGuavaTester.java\n\n```java\nimport com.google.common.base.Optional;\n\npublic class GuavaTester {\n   public static void main(String args[]){\n      GuavaTester guavaTester = new GuavaTester();\n\n      Integer value1 =  null;\n      Integer value2 =  new Integer(10);\n      //Optional.fromNullable - allows passed parameter to be null.\n      Optional<Integer> a = Optional.fromNullable(value1);\n      //Optional.of - throws NullPointerException if passed parameter is null\n      Optional<Integer> b = Optional.of(value2);\t\t\n\n      System.out.println(guavaTester.sum(a,b));\n   }\n\n   public Integer sum(Optional<Integer> a, Optional<Integer> b){\n      //Optional.isPresent - checks the value is present or not\n      System.out.println(\"First parameter is present: \" + a.isPresent());\n\n      System.out.println(\"Second parameter is present: \" + b.isPresent());\n\n      //Optional.or - returns the value if present otherwise returns\n      //the default value passed.\n      Integer value1 = a.or(new Integer(0));\t\n\n      //Optional.get - gets the value, value should be present\n      Integer value2 = b.get();\n\n      return value1 + value2;\n   }\t\n}\n```\n","source":"_posts/guava/Optional.md","raw":"---\nuuid: bbaf2101-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Optional\ncategories: Java\ntags:\n  - guava\nabbrlink: 4a0a9230\n---\n\n\n# Guava Optional类\n\nOptional用于包含非空对象的不可变对象。 Optional对象，用于不存在值表示null。这个类有各种实用的方法，以方便代码来处理为可用或不可用，而不是检查null值。\n\n## 类声明\n\n以下是com.google.common.base.Optional<T>类的声明：\n\n```java\n@GwtCompatible(serializable=true)\npublic abstract class Optional<T> extends Object implements Serializable\n```\n\n## 类方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **static <T> Optional<T> absent()**  \t\t\t返回没有包含的参考Optional的实例。 |\n| 2    | **abstract Set<T> asSet()**  \t\t\t返回一个不可变的单集的唯一元素所包含的实例(如果存在);否则为一个空的不可变的集合。 |\n| 3    | **abstract boolean equals(Object object)**  \t\t\t返回true如果对象是一个Optional实例，无论是包含引用彼此相等或两者都不存在。 |\n| 4    | **static <T> Optional<T> fromNullable(T nullableReference)**  \t\t\t如果nullableReference非空，返回一个包含引用Optional实例;否则返回absent()。 |\n| 5    | **abstract T get()**  \t\t\t返回所包含的实例，它必须存在。 |\n| 6    | **abstract int hashCode()**  \t\t\t返回此实例的哈希码。 |\n| 7    | **abstract boolean isPresent()**  \t\t\t返回true，如果这支架包含一个(非空)的实例。 |\n| 8    | **static <T> Optional<T> of(T reference)**  \t\t\t返回包含给定的非空引用Optional实例。 |\n| 9    | **abstract Optional<T> or(Optional<? extends T> secondChoice)**  \t\t\t返回此Optional，如果它有一个值存在; 否则返回secondChoice。 |\n| 10   | **abstract T or(Supplier<? extends T> supplier)**  \t\t\t返回所包含的实例(如果存在); 否则supplier.get()。 |\n| 11   | **abstract T or(T defaultValue)**  \t\t\t返回所包含的实例(如果存在);否则为默认值。 |\n| 12   | **abstract T orNull()**  \t\t\t返回所包含的实例(如果存在);否则返回null。 |\n| 13   | **static <T> Iterable<T> presentInstances(Iterable<? extends Optional<? extends T>> optionals)**  \t\t\t从提供的optionals返回每个实例的存在的值，从而跳过absent()。 |\n| 14   | **abstract String toString()**  \t\t\t返回此实例的字符串表示。 |\n| 15   | **abstract <V> Optional<V> transform(Function<? super T,V> function)**  \t\t\t如果实例存在，则它被转换给定的功能;否则absent()被返回。 |\n\n## 继承的方法\n\n这个类继承了以下类的方法：\n\n- java.lang.Object\n\n## Optional示例：\n\n使用所选择的编辑器，创建下面的java程序，比如 C:/> Guava\n\nGuavaTester.java\n\n```java\nimport com.google.common.base.Optional;\n\npublic class GuavaTester {\n   public static void main(String args[]){\n      GuavaTester guavaTester = new GuavaTester();\n\n      Integer value1 =  null;\n      Integer value2 =  new Integer(10);\n      //Optional.fromNullable - allows passed parameter to be null.\n      Optional<Integer> a = Optional.fromNullable(value1);\n      //Optional.of - throws NullPointerException if passed parameter is null\n      Optional<Integer> b = Optional.of(value2);\t\t\n\n      System.out.println(guavaTester.sum(a,b));\n   }\n\n   public Integer sum(Optional<Integer> a, Optional<Integer> b){\n      //Optional.isPresent - checks the value is present or not\n      System.out.println(\"First parameter is present: \" + a.isPresent());\n\n      System.out.println(\"Second parameter is present: \" + b.isPresent());\n\n      //Optional.or - returns the value if present otherwise returns\n      //the default value passed.\n      Integer value1 = a.or(new Integer(0));\t\n\n      //Optional.get - gets the value, value should be present\n      Integer value2 = b.get();\n\n      return value1 + value2;\n   }\t\n}\n```\n","slug":"guava/Optional","published":1,"date":"2022-04-20T12:41:20.855Z","updated":"2022-05-04T03:14:48.556Z","_id":"cl2qzftho002e13no7zyo2n7u","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Guava-Optional类\"><a href=\"#Guava-Optional类\" class=\"headerlink\" title=\"Guava Optional类\"></a>Guava Optional类</h1><p>Optional用于包含非空对象的不可变对象。 Optional对象，用于不存在值表示null。这个类有各种实用的方法，以方便代码来处理为可用或不可用，而不是检查null值。</p>\n<h2 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h2><p>以下是com.google.common.base.Optional<T>类的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible(serializable=true)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Optional</span>&lt;T&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Object</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>static <T> Optional<T> absent()</strong>              返回没有包含的参考Optional的实例。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>abstract Set<T> asSet()</strong>              返回一个不可变的单集的唯一元素所包含的实例(如果存在);否则为一个空的不可变的集合。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>abstract boolean equals(Object object)</strong>              返回true如果对象是一个Optional实例，无论是包含引用彼此相等或两者都不存在。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>static <T> Optional<T> fromNullable(T nullableReference)</strong>              如果nullableReference非空，返回一个包含引用Optional实例;否则返回absent()。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>abstract T get()</strong>              返回所包含的实例，它必须存在。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>abstract int hashCode()</strong>              返回此实例的哈希码。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>abstract boolean isPresent()</strong>              返回true，如果这支架包含一个(非空)的实例。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>static <T> Optional<T> of(T reference)</strong>              返回包含给定的非空引用Optional实例。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>abstract Optional<T> or(Optional&lt;? extends T&gt; secondChoice)</strong>              返回此Optional，如果它有一个值存在; 否则返回secondChoice。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>abstract T or(Supplier&lt;? extends T&gt; supplier)</strong>              返回所包含的实例(如果存在); 否则supplier.get()。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>abstract T or(T defaultValue)</strong>              返回所包含的实例(如果存在);否则为默认值。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>abstract T orNull()</strong>              返回所包含的实例(如果存在);否则返回null。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>static <T> Iterable<T> presentInstances(Iterable&lt;? extends Optional&lt;? extends T&gt;&gt; optionals)</strong>              从提供的optionals返回每个实例的存在的值，从而跳过absent()。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>abstract String toString()</strong>              返回此实例的字符串表示。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>abstract <V> Optional<V> transform(Function&lt;? super T,V&gt; function)</strong>              如果实例存在，则它被转换给定的功能;否则absent()被返回。</td>\n</tr>\n</tbody></table>\n<h2 id=\"继承的方法\"><a href=\"#继承的方法\" class=\"headerlink\" title=\"继承的方法\"></a>继承的方法</h2><p>这个类继承了以下类的方法：</p>\n<ul>\n<li>java.lang.Object</li>\n</ul>\n<h2 id=\"Optional示例：\"><a href=\"#Optional示例：\" class=\"headerlink\" title=\"Optional示例：\"></a>Optional示例：</h2><p>使用所选择的编辑器，创建下面的java程序，比如 C:/&gt; Guava</p>\n<p>GuavaTester.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.base.Optional;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"type\">GuavaTester</span> <span class=\"variable\">guavaTester</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">GuavaTester</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"type\">Integer</span> <span class=\"variable\">value1</span> <span class=\"operator\">=</span>  <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"type\">Integer</span> <span class=\"variable\">value2</span> <span class=\"operator\">=</span>  <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">10</span>);</span><br><span class=\"line\">      <span class=\"comment\">//Optional.fromNullable - allows passed parameter to be null.</span></span><br><span class=\"line\">      Optional&lt;Integer&gt; a = Optional.fromNullable(value1);</span><br><span class=\"line\">      <span class=\"comment\">//Optional.of - throws NullPointerException if passed parameter is null</span></span><br><span class=\"line\">      Optional&lt;Integer&gt; b = Optional.of(value2);\t\t</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(guavaTester.sum(a,b));</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> Integer <span class=\"title function_\">sum</span><span class=\"params\">(Optional&lt;Integer&gt; a, Optional&lt;Integer&gt; b)</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//Optional.isPresent - checks the value is present or not</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;First parameter is present: &quot;</span> + a.isPresent());</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Second parameter is present: &quot;</span> + b.isPresent());</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//Optional.or - returns the value if present otherwise returns</span></span><br><span class=\"line\">      <span class=\"comment\">//the default value passed.</span></span><br><span class=\"line\">      <span class=\"type\">Integer</span> <span class=\"variable\">value1</span> <span class=\"operator\">=</span> a.or(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">0</span>));\t</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//Optional.get - gets the value, value should be present</span></span><br><span class=\"line\">      <span class=\"type\">Integer</span> <span class=\"variable\">value2</span> <span class=\"operator\">=</span> b.get();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> value1 + value2;</span><br><span class=\"line\">   &#125;\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Guava-Optional类\"><a href=\"#Guava-Optional类\" class=\"headerlink\" title=\"Guava Optional类\"></a>Guava Optional类</h1><p>Optional用于包含非空对象的不可变对象。 Optional对象，用于不存在值表示null。这个类有各种实用的方法，以方便代码来处理为可用或不可用，而不是检查null值。</p>\n<h2 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h2><p>以下是com.google.common.base.Optional<T>类的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible(serializable=true)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Optional</span>&lt;T&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Object</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Serializable</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>static <T> Optional<T> absent()</strong>              返回没有包含的参考Optional的实例。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>abstract Set<T> asSet()</strong>              返回一个不可变的单集的唯一元素所包含的实例(如果存在);否则为一个空的不可变的集合。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>abstract boolean equals(Object object)</strong>              返回true如果对象是一个Optional实例，无论是包含引用彼此相等或两者都不存在。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>static <T> Optional<T> fromNullable(T nullableReference)</strong>              如果nullableReference非空，返回一个包含引用Optional实例;否则返回absent()。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>abstract T get()</strong>              返回所包含的实例，它必须存在。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>abstract int hashCode()</strong>              返回此实例的哈希码。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>abstract boolean isPresent()</strong>              返回true，如果这支架包含一个(非空)的实例。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>static <T> Optional<T> of(T reference)</strong>              返回包含给定的非空引用Optional实例。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>abstract Optional<T> or(Optional&lt;? extends T&gt; secondChoice)</strong>              返回此Optional，如果它有一个值存在; 否则返回secondChoice。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>abstract T or(Supplier&lt;? extends T&gt; supplier)</strong>              返回所包含的实例(如果存在); 否则supplier.get()。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>abstract T or(T defaultValue)</strong>              返回所包含的实例(如果存在);否则为默认值。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>abstract T orNull()</strong>              返回所包含的实例(如果存在);否则返回null。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>static <T> Iterable<T> presentInstances(Iterable&lt;? extends Optional&lt;? extends T&gt;&gt; optionals)</strong>              从提供的optionals返回每个实例的存在的值，从而跳过absent()。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>abstract String toString()</strong>              返回此实例的字符串表示。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>abstract <V> Optional<V> transform(Function&lt;? super T,V&gt; function)</strong>              如果实例存在，则它被转换给定的功能;否则absent()被返回。</td>\n</tr>\n</tbody></table>\n<h2 id=\"继承的方法\"><a href=\"#继承的方法\" class=\"headerlink\" title=\"继承的方法\"></a>继承的方法</h2><p>这个类继承了以下类的方法：</p>\n<ul>\n<li>java.lang.Object</li>\n</ul>\n<h2 id=\"Optional示例：\"><a href=\"#Optional示例：\" class=\"headerlink\" title=\"Optional示例：\"></a>Optional示例：</h2><p>使用所选择的编辑器，创建下面的java程序，比如 C:/&gt; Guava</p>\n<p>GuavaTester.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.base.Optional;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"type\">GuavaTester</span> <span class=\"variable\">guavaTester</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">GuavaTester</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"type\">Integer</span> <span class=\"variable\">value1</span> <span class=\"operator\">=</span>  <span class=\"literal\">null</span>;</span><br><span class=\"line\">      <span class=\"type\">Integer</span> <span class=\"variable\">value2</span> <span class=\"operator\">=</span>  <span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">10</span>);</span><br><span class=\"line\">      <span class=\"comment\">//Optional.fromNullable - allows passed parameter to be null.</span></span><br><span class=\"line\">      Optional&lt;Integer&gt; a = Optional.fromNullable(value1);</span><br><span class=\"line\">      <span class=\"comment\">//Optional.of - throws NullPointerException if passed parameter is null</span></span><br><span class=\"line\">      Optional&lt;Integer&gt; b = Optional.of(value2);\t\t</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(guavaTester.sum(a,b));</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> Integer <span class=\"title function_\">sum</span><span class=\"params\">(Optional&lt;Integer&gt; a, Optional&lt;Integer&gt; b)</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//Optional.isPresent - checks the value is present or not</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;First parameter is present: &quot;</span> + a.isPresent());</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Second parameter is present: &quot;</span> + b.isPresent());</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//Optional.or - returns the value if present otherwise returns</span></span><br><span class=\"line\">      <span class=\"comment\">//the default value passed.</span></span><br><span class=\"line\">      <span class=\"type\">Integer</span> <span class=\"variable\">value1</span> <span class=\"operator\">=</span> a.or(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">0</span>));\t</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//Optional.get - gets the value, value should be present</span></span><br><span class=\"line\">      <span class=\"type\">Integer</span> <span class=\"variable\">value2</span> <span class=\"operator\">=</span> b.get();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">return</span> value1 + value2;</span><br><span class=\"line\">   &#125;\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf2102-c0ab-11ec-92a1-7557b2313227","title":"Guava Ordering","abbrlink":"acc53003","_content":"\n# Guava Ordering类\n\nOrdering(排序)可以被看作是一个丰富的比较具有增强功能的链接，多个实用方法，多类型排序功能等。\n\n## \t类声明\n\n以下是com.google.common.collect.Ordering<T>类的声明：\n\n```java\n@GwtCompatible\npublic abstract class Ordering<T> extends Object implements Comparator<T>\n```\n\n## \t类方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **static Ordering<Object> allEqual()**  \t返回一个排序，它把所有的值相等，说明“没有顺序。”通过这个顺序以任何稳定的排序算法的结果，在改变没有顺序元素。 |\n| 2    | **static Ordering<Object> arbitrary()**  \t返回一个任意顺序对所有对象，其中compare(a, b) == 0 意味着a == b（身份平等）。 |\n| 3    | **int binarySearch(List<? extends T> sortedList, T key)**  \t搜索排序列表使用键的二进制搜索算法。 |\n| 4    | **abstract int compare(T left, T right)**  比较两个参数的顺序。 |\n| 5    | **<U extends T> Ordering<U> compound(Comparator<? super U> secondaryComparator)**  \t\t\t返回首先使用排序这一点，但它排序中的“tie”，然后委托给secondaryComparator事件。 |\n| 6    | **static <T> Ordering<T> compound(Iterable<? extends Comparator<? super T>> comparators)**  \t\t\t返回一个排序它尝试每个给定的比较器，以便直到一个非零结果找到，返回该结果，并返回零仅当所有比较器返回零。 |\n| 7    | **static <T> Ordering<T> explicit(List<T> valuesInOrder)**  返回根据它们出现的定列表中的顺序比较对象进行排序。 |\n| 8    | **static <T> Ordering<T> explicit(T leastValue, T... remainingValuesInOrder)**  返回根据它们所赋予本方法的顺序进行比较的对象进行排序。 |\n| 9    | **static <T> Ordering<T> from(Comparator<T> comparator)**  返回基于现有的比较实例进行排序。 |\n| 10   | **<E extends T> List<E> greatestOf(Iterable<E> iterable, int k)**  \t返回根据这个顺序给出迭代，为了从最大到最小的k个最大的元素。 |\n| 11   | **<E extends T> List<E> greatestOf(Iterator<E> iterator, int k)**  返回从给定的迭代器按照这个顺序，从最大到最小k个最大的元素。 |\n| 12   | **<E extends T> ImmutableList<E> immutableSortedCopy(Iterable<E> elements)**  \t\t\t返回包含的元素排序这种排序的不可变列表。 |\n| 13   | **boolean isOrdered(Iterable<? extends T> iterable)**  返回true如果在迭代后的第一个的每个元素是大于或等于在它之前，根据该排序的元素。 |\n| 14   | **boolean isStrictlyOrdered(Iterable<? extends T> iterable)**  返回true如果在迭代后的第一个的每个元素是严格比在它之前，根据该排序的元素更大。 |\n| 15   | **<E extends T> List<E> leastOf(Iterable<E> iterable, int k)**  \t返回根据这个顺序给出迭代，从而从低到最大的k个最低的元素。 |\n| 16   | **<E extends T> List<E> leastOf(Iterator<E> elements, int k)**  \t返回第k从给定的迭代器，按照这个顺序从最低到最大至少元素。 |\n| 17   | **<S extends T> Ordering<Iterable<S>> lexicographical()**  \t返回一个新的排序它通过比较对应元素两两直到非零结果发现排序迭代;规定“字典顺序”。 |\n| 18   | **<E extends T> E max(E a, E b)**  \t返回两个值按照这个顺序的较大值。 |\n| 19   | **<E extends T> E max(E a, E b, E c, E... rest)**  返回指定的值，根据这个顺序是最大的。 |\n| 20   | **<E extends T> E max(Iterable<E> iterable)**  \t返回指定的值，根据这个顺序是最大的。 |\n| 21   | **<E extends T> E max(Iterator<E> iterator)**  \t返回指定的值，根据这个顺序是最大的。 |\n| 22   | **<E extends T> E min(E a, E b)**  \t返回两个值按照这个顺序的较小者。 |\n| 23   | **<E extends T> E min(E a, E b, E c, E... rest)**  返回最少指定的值，根据这个顺序。 |\n| 24   | **<E extends T> E min(Iterable<E> iterable)**  返回最少指定的值，根据这个顺序。 |\n| 25   | **<E extends T> E min(Iterator<E> iterator)**  返回最少指定的值，根据这个顺序。 |\n| 26   | **static <C extends Comparable> Ordering<C> natural()**  返回使用值的自然顺序排序序列化。 |\n| 27   | **<S extends T> Ordering<S> nullsFirst()**  返回对待null小于所有其他值，并使用此来比较非空值排序。 |\n| 28   | **<S extends T> Ordering<S> nullsLast()**  返回对待null作为大于所有其他值，并使用这个顺序来比较非空值排序。 |\n| 29   | **<F> Ordering<F> onResultOf(Function<F,? extends T> function)**  \t返回一个新的排序在F上，首先应用功能给它们，然后比较使用此这些结果的顺序元素。 |\n| 30   | **<S extends T> Ordering<S> reverse()**  \t返回相反顺序; 顺序相当于Collections.reverseOrder（Comparator）。 |\n| 31   | **<E extends T> List<E> sortedCopy(Iterable<E> elements)**  返回包含的元素排序此排序可变列表;使用这个只有在结果列表可能需要进一步修改，或可能包含null。 |\n| 32   | **static Ordering<Object> usingToString()**  返回由它们的字符串表示的自然顺序，toString()比较对象进行排序。 |\n\n## \t方法继承\n\n这个类从以下类继承的方法：\n\n- java.lang.Object\n\n## \tOrdering 示例\n\n使用所选择的编辑器，创建下面的java程序比如 C:/> Guava\n\nGuavaTester.java\n\n```java\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport com.google.common.collect.Ordering;\n\npublic class GuavaTester {\n   public static void main(String args[]){\n      List<Integer> numbers = new ArrayList<Integer>();\n      numbers.add(new Integer(5));\n      numbers.add(new Integer(2));\n      numbers.add(new Integer(15));\n      numbers.add(new Integer(51));\n      numbers.add(new Integer(53));\n      numbers.add(new Integer(35));\n      numbers.add(new Integer(45));\n      numbers.add(new Integer(32));\n      numbers.add(new Integer(43));\n      numbers.add(new Integer(16));\n\n      Ordering ordering = Ordering.natural();\n      System.out.println(\"Input List: \");\n      System.out.println(numbers);\t\t\n         \n      Collections.sort(numbers,ordering );\n      System.out.println(\"Sorted List: \");\n      System.out.println(numbers);\n         \n      System.out.println(\"======================\");\n      System.out.println(\"List is sorted: \" + ordering.isOrdered(numbers));\n      System.out.println(\"Minimum: \" + ordering.min(numbers));\n      System.out.println(\"Maximum: \" + ordering.max(numbers));\n         \n      Collections.sort(numbers,ordering.reverse());\n      System.out.println(\"Reverse: \" + numbers);\n\n      numbers.add(null);\n      System.out.println(\"Null added to Sorted List: \");\n      System.out.println(numbers);\t\t\n\n      Collections.sort(numbers,ordering.nullsFirst());\n      System.out.println(\"Null first Sorted List: \");\n      System.out.println(numbers);\n      System.out.println(\"======================\");\n\n      List<String> names = new ArrayList<String>();\n      names.add(\"Ram\");\n      names.add(\"Shyam\");\n      names.add(\"Mohan\");\n      names.add(\"Sohan\");\n      names.add(\"Ramesh\");\n      names.add(\"Suresh\");\n      names.add(\"Naresh\");\n      names.add(\"Mahesh\");\n      names.add(null);\n      names.add(\"Vikas\");\n      names.add(\"Deepak\");\n\n      System.out.println(\"Another List: \");\n      System.out.println(names);\n\n\t  Collections.sort(names,ordering.nullsFirst().reverse());\n      System.out.println(\"Null first then reverse sorted list: \");\n      System.out.println(names);\n   }\n}\n```\n","source":"_posts/guava/Ordering.md","raw":"---\nuuid: bbaf2102-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Ordering\ncategories: Java\ntags:\n  - guava\nabbrlink: acc53003\n---\n\n# Guava Ordering类\n\nOrdering(排序)可以被看作是一个丰富的比较具有增强功能的链接，多个实用方法，多类型排序功能等。\n\n## \t类声明\n\n以下是com.google.common.collect.Ordering<T>类的声明：\n\n```java\n@GwtCompatible\npublic abstract class Ordering<T> extends Object implements Comparator<T>\n```\n\n## \t类方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **static Ordering<Object> allEqual()**  \t返回一个排序，它把所有的值相等，说明“没有顺序。”通过这个顺序以任何稳定的排序算法的结果，在改变没有顺序元素。 |\n| 2    | **static Ordering<Object> arbitrary()**  \t返回一个任意顺序对所有对象，其中compare(a, b) == 0 意味着a == b（身份平等）。 |\n| 3    | **int binarySearch(List<? extends T> sortedList, T key)**  \t搜索排序列表使用键的二进制搜索算法。 |\n| 4    | **abstract int compare(T left, T right)**  比较两个参数的顺序。 |\n| 5    | **<U extends T> Ordering<U> compound(Comparator<? super U> secondaryComparator)**  \t\t\t返回首先使用排序这一点，但它排序中的“tie”，然后委托给secondaryComparator事件。 |\n| 6    | **static <T> Ordering<T> compound(Iterable<? extends Comparator<? super T>> comparators)**  \t\t\t返回一个排序它尝试每个给定的比较器，以便直到一个非零结果找到，返回该结果，并返回零仅当所有比较器返回零。 |\n| 7    | **static <T> Ordering<T> explicit(List<T> valuesInOrder)**  返回根据它们出现的定列表中的顺序比较对象进行排序。 |\n| 8    | **static <T> Ordering<T> explicit(T leastValue, T... remainingValuesInOrder)**  返回根据它们所赋予本方法的顺序进行比较的对象进行排序。 |\n| 9    | **static <T> Ordering<T> from(Comparator<T> comparator)**  返回基于现有的比较实例进行排序。 |\n| 10   | **<E extends T> List<E> greatestOf(Iterable<E> iterable, int k)**  \t返回根据这个顺序给出迭代，为了从最大到最小的k个最大的元素。 |\n| 11   | **<E extends T> List<E> greatestOf(Iterator<E> iterator, int k)**  返回从给定的迭代器按照这个顺序，从最大到最小k个最大的元素。 |\n| 12   | **<E extends T> ImmutableList<E> immutableSortedCopy(Iterable<E> elements)**  \t\t\t返回包含的元素排序这种排序的不可变列表。 |\n| 13   | **boolean isOrdered(Iterable<? extends T> iterable)**  返回true如果在迭代后的第一个的每个元素是大于或等于在它之前，根据该排序的元素。 |\n| 14   | **boolean isStrictlyOrdered(Iterable<? extends T> iterable)**  返回true如果在迭代后的第一个的每个元素是严格比在它之前，根据该排序的元素更大。 |\n| 15   | **<E extends T> List<E> leastOf(Iterable<E> iterable, int k)**  \t返回根据这个顺序给出迭代，从而从低到最大的k个最低的元素。 |\n| 16   | **<E extends T> List<E> leastOf(Iterator<E> elements, int k)**  \t返回第k从给定的迭代器，按照这个顺序从最低到最大至少元素。 |\n| 17   | **<S extends T> Ordering<Iterable<S>> lexicographical()**  \t返回一个新的排序它通过比较对应元素两两直到非零结果发现排序迭代;规定“字典顺序”。 |\n| 18   | **<E extends T> E max(E a, E b)**  \t返回两个值按照这个顺序的较大值。 |\n| 19   | **<E extends T> E max(E a, E b, E c, E... rest)**  返回指定的值，根据这个顺序是最大的。 |\n| 20   | **<E extends T> E max(Iterable<E> iterable)**  \t返回指定的值，根据这个顺序是最大的。 |\n| 21   | **<E extends T> E max(Iterator<E> iterator)**  \t返回指定的值，根据这个顺序是最大的。 |\n| 22   | **<E extends T> E min(E a, E b)**  \t返回两个值按照这个顺序的较小者。 |\n| 23   | **<E extends T> E min(E a, E b, E c, E... rest)**  返回最少指定的值，根据这个顺序。 |\n| 24   | **<E extends T> E min(Iterable<E> iterable)**  返回最少指定的值，根据这个顺序。 |\n| 25   | **<E extends T> E min(Iterator<E> iterator)**  返回最少指定的值，根据这个顺序。 |\n| 26   | **static <C extends Comparable> Ordering<C> natural()**  返回使用值的自然顺序排序序列化。 |\n| 27   | **<S extends T> Ordering<S> nullsFirst()**  返回对待null小于所有其他值，并使用此来比较非空值排序。 |\n| 28   | **<S extends T> Ordering<S> nullsLast()**  返回对待null作为大于所有其他值，并使用这个顺序来比较非空值排序。 |\n| 29   | **<F> Ordering<F> onResultOf(Function<F,? extends T> function)**  \t返回一个新的排序在F上，首先应用功能给它们，然后比较使用此这些结果的顺序元素。 |\n| 30   | **<S extends T> Ordering<S> reverse()**  \t返回相反顺序; 顺序相当于Collections.reverseOrder（Comparator）。 |\n| 31   | **<E extends T> List<E> sortedCopy(Iterable<E> elements)**  返回包含的元素排序此排序可变列表;使用这个只有在结果列表可能需要进一步修改，或可能包含null。 |\n| 32   | **static Ordering<Object> usingToString()**  返回由它们的字符串表示的自然顺序，toString()比较对象进行排序。 |\n\n## \t方法继承\n\n这个类从以下类继承的方法：\n\n- java.lang.Object\n\n## \tOrdering 示例\n\n使用所选择的编辑器，创建下面的java程序比如 C:/> Guava\n\nGuavaTester.java\n\n```java\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport com.google.common.collect.Ordering;\n\npublic class GuavaTester {\n   public static void main(String args[]){\n      List<Integer> numbers = new ArrayList<Integer>();\n      numbers.add(new Integer(5));\n      numbers.add(new Integer(2));\n      numbers.add(new Integer(15));\n      numbers.add(new Integer(51));\n      numbers.add(new Integer(53));\n      numbers.add(new Integer(35));\n      numbers.add(new Integer(45));\n      numbers.add(new Integer(32));\n      numbers.add(new Integer(43));\n      numbers.add(new Integer(16));\n\n      Ordering ordering = Ordering.natural();\n      System.out.println(\"Input List: \");\n      System.out.println(numbers);\t\t\n         \n      Collections.sort(numbers,ordering );\n      System.out.println(\"Sorted List: \");\n      System.out.println(numbers);\n         \n      System.out.println(\"======================\");\n      System.out.println(\"List is sorted: \" + ordering.isOrdered(numbers));\n      System.out.println(\"Minimum: \" + ordering.min(numbers));\n      System.out.println(\"Maximum: \" + ordering.max(numbers));\n         \n      Collections.sort(numbers,ordering.reverse());\n      System.out.println(\"Reverse: \" + numbers);\n\n      numbers.add(null);\n      System.out.println(\"Null added to Sorted List: \");\n      System.out.println(numbers);\t\t\n\n      Collections.sort(numbers,ordering.nullsFirst());\n      System.out.println(\"Null first Sorted List: \");\n      System.out.println(numbers);\n      System.out.println(\"======================\");\n\n      List<String> names = new ArrayList<String>();\n      names.add(\"Ram\");\n      names.add(\"Shyam\");\n      names.add(\"Mohan\");\n      names.add(\"Sohan\");\n      names.add(\"Ramesh\");\n      names.add(\"Suresh\");\n      names.add(\"Naresh\");\n      names.add(\"Mahesh\");\n      names.add(null);\n      names.add(\"Vikas\");\n      names.add(\"Deepak\");\n\n      System.out.println(\"Another List: \");\n      System.out.println(names);\n\n\t  Collections.sort(names,ordering.nullsFirst().reverse());\n      System.out.println(\"Null first then reverse sorted list: \");\n      System.out.println(names);\n   }\n}\n```\n","slug":"guava/Ordering","published":1,"date":"2022-04-20T12:41:20.857Z","updated":"2022-05-04T03:16:12.970Z","_id":"cl2qzfthp002j13no5ut6h85x","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Guava-Ordering类\"><a href=\"#Guava-Ordering类\" class=\"headerlink\" title=\"Guava Ordering类\"></a>Guava Ordering类</h1><p>Ordering(排序)可以被看作是一个丰富的比较具有增强功能的链接，多个实用方法，多类型排序功能等。</p>\n<h2 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h2><p>以下是com.google.common.collect.Ordering<T>类的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Ordering</span>&lt;T&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Object</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Comparator</span>&lt;T&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>static Ordering<Object> allEqual()</strong>      返回一个排序，它把所有的值相等，说明“没有顺序。”通过这个顺序以任何稳定的排序算法的结果，在改变没有顺序元素。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>static Ordering<Object> arbitrary()</strong>      返回一个任意顺序对所有对象，其中compare(a, b) == 0 意味着a == b（身份平等）。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>int binarySearch(List&lt;? extends T&gt; sortedList, T key)</strong>      搜索排序列表使用键的二进制搜索算法。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>abstract int compare(T left, T right)</strong>  比较两个参数的顺序。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong><U extends T> Ordering<U> compound(Comparator&lt;? super U&gt; secondaryComparator)</strong>              返回首先使用排序这一点，但它排序中的“tie”，然后委托给secondaryComparator事件。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>static <T> Ordering<T> compound(Iterable&lt;? extends Comparator&lt;? super T&gt;&gt; comparators)</strong>              返回一个排序它尝试每个给定的比较器，以便直到一个非零结果找到，返回该结果，并返回零仅当所有比较器返回零。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>static <T> Ordering<T> explicit(List<T> valuesInOrder)</strong>  返回根据它们出现的定列表中的顺序比较对象进行排序。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>static <T> Ordering<T> explicit(T leastValue, T… remainingValuesInOrder)</strong>  返回根据它们所赋予本方法的顺序进行比较的对象进行排序。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>static <T> Ordering<T> from(Comparator<T> comparator)</strong>  返回基于现有的比较实例进行排序。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong><E extends T> List<E> greatestOf(Iterable<E> iterable, int k)</strong>      返回根据这个顺序给出迭代，为了从最大到最小的k个最大的元素。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong><E extends T> List<E> greatestOf(Iterator<E> iterator, int k)</strong>  返回从给定的迭代器按照这个顺序，从最大到最小k个最大的元素。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong><E extends T> ImmutableList<E> immutableSortedCopy(Iterable<E> elements)</strong>              返回包含的元素排序这种排序的不可变列表。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>boolean isOrdered(Iterable&lt;? extends T&gt; iterable)</strong>  返回true如果在迭代后的第一个的每个元素是大于或等于在它之前，根据该排序的元素。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>boolean isStrictlyOrdered(Iterable&lt;? extends T&gt; iterable)</strong>  返回true如果在迭代后的第一个的每个元素是严格比在它之前，根据该排序的元素更大。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong><E extends T> List<E> leastOf(Iterable<E> iterable, int k)</strong>      返回根据这个顺序给出迭代，从而从低到最大的k个最低的元素。</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong><E extends T> List<E> leastOf(Iterator<E> elements, int k)</strong>      返回第k从给定的迭代器，按照这个顺序从最低到最大至少元素。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong><S extends T> Ordering&lt;Iterable<S>&gt; lexicographical()</strong>      返回一个新的排序它通过比较对应元素两两直到非零结果发现排序迭代;规定“字典顺序”。</td>\n</tr>\n<tr>\n<td>18</td>\n<td><strong><E extends T> E max(E a, E b)</strong>      返回两个值按照这个顺序的较大值。</td>\n</tr>\n<tr>\n<td>19</td>\n<td><strong><E extends T> E max(E a, E b, E c, E… rest)</strong>  返回指定的值，根据这个顺序是最大的。</td>\n</tr>\n<tr>\n<td>20</td>\n<td><strong><E extends T> E max(Iterable<E> iterable)</strong>      返回指定的值，根据这个顺序是最大的。</td>\n</tr>\n<tr>\n<td>21</td>\n<td><strong><E extends T> E max(Iterator<E> iterator)</strong>      返回指定的值，根据这个顺序是最大的。</td>\n</tr>\n<tr>\n<td>22</td>\n<td><strong><E extends T> E min(E a, E b)</strong>      返回两个值按照这个顺序的较小者。</td>\n</tr>\n<tr>\n<td>23</td>\n<td><strong><E extends T> E min(E a, E b, E c, E… rest)</strong>  返回最少指定的值，根据这个顺序。</td>\n</tr>\n<tr>\n<td>24</td>\n<td><strong><E extends T> E min(Iterable<E> iterable)</strong>  返回最少指定的值，根据这个顺序。</td>\n</tr>\n<tr>\n<td>25</td>\n<td><strong><E extends T> E min(Iterator<E> iterator)</strong>  返回最少指定的值，根据这个顺序。</td>\n</tr>\n<tr>\n<td>26</td>\n<td><strong>static <C extends Comparable> Ordering<C> natural()</strong>  返回使用值的自然顺序排序序列化。</td>\n</tr>\n<tr>\n<td>27</td>\n<td><strong><S extends T> Ordering<S> nullsFirst()</strong>  返回对待null小于所有其他值，并使用此来比较非空值排序。</td>\n</tr>\n<tr>\n<td>28</td>\n<td><strong><S extends T> Ordering<S> nullsLast()</strong>  返回对待null作为大于所有其他值，并使用这个顺序来比较非空值排序。</td>\n</tr>\n<tr>\n<td>29</td>\n<td><strong><F> Ordering<F> onResultOf(Function&lt;F,? extends T&gt; function)</strong>      返回一个新的排序在F上，首先应用功能给它们，然后比较使用此这些结果的顺序元素。</td>\n</tr>\n<tr>\n<td>30</td>\n<td><strong><S extends T> Ordering<S> reverse()</strong>      返回相反顺序; 顺序相当于Collections.reverseOrder（Comparator）。</td>\n</tr>\n<tr>\n<td>31</td>\n<td><strong><E extends T> List<E> sortedCopy(Iterable<E> elements)</strong>  返回包含的元素排序此排序可变列表;使用这个只有在结果列表可能需要进一步修改，或可能包含null。</td>\n</tr>\n<tr>\n<td>32</td>\n<td><strong>static Ordering<Object> usingToString()</strong>  返回由它们的字符串表示的自然顺序，toString()比较对象进行排序。</td>\n</tr>\n</tbody></table>\n<h2 id=\"方法继承\"><a href=\"#方法继承\" class=\"headerlink\" title=\"方法继承\"></a>方法继承</h2><p>这个类从以下类继承的方法：</p>\n<ul>\n<li>java.lang.Object</li>\n</ul>\n<h2 id=\"Ordering-示例\"><a href=\"#Ordering-示例\" class=\"headerlink\" title=\"Ordering 示例\"></a>Ordering 示例</h2><p>使用所选择的编辑器，创建下面的java程序比如 C:/&gt; Guava</p>\n<p>GuavaTester.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.Ordering;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      List&lt;Integer&gt; numbers = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;Integer&gt;();</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">5</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">2</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">15</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">51</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">53</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">35</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">45</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">32</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">43</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">16</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"type\">Ordering</span> <span class=\"variable\">ordering</span> <span class=\"operator\">=</span> Ordering.natural();</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Input List: &quot;</span>);</span><br><span class=\"line\">      System.out.println(numbers);\t\t</span><br><span class=\"line\">         </span><br><span class=\"line\">      Collections.sort(numbers,ordering );</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Sorted List: &quot;</span>);</span><br><span class=\"line\">      System.out.println(numbers);</span><br><span class=\"line\">         </span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;======================&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;List is sorted: &quot;</span> + ordering.isOrdered(numbers));</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Minimum: &quot;</span> + ordering.min(numbers));</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Maximum: &quot;</span> + ordering.max(numbers));</span><br><span class=\"line\">         </span><br><span class=\"line\">      Collections.sort(numbers,ordering.reverse());</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Reverse: &quot;</span> + numbers);</span><br><span class=\"line\"></span><br><span class=\"line\">      numbers.add(<span class=\"literal\">null</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Null added to Sorted List: &quot;</span>);</span><br><span class=\"line\">      System.out.println(numbers);\t\t</span><br><span class=\"line\"></span><br><span class=\"line\">      Collections.sort(numbers,ordering.nullsFirst());</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Null first Sorted List: &quot;</span>);</span><br><span class=\"line\">      System.out.println(numbers);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;======================&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      List&lt;String&gt; names = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;String&gt;();</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Ram&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Shyam&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Mohan&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Sohan&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Ramesh&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Suresh&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Naresh&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Mahesh&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"literal\">null</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Vikas&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Deepak&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Another List: &quot;</span>);</span><br><span class=\"line\">      System.out.println(names);</span><br><span class=\"line\"></span><br><span class=\"line\">\t  Collections.sort(names,ordering.nullsFirst().reverse());</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Null first then reverse sorted list: &quot;</span>);</span><br><span class=\"line\">      System.out.println(names);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Guava-Ordering类\"><a href=\"#Guava-Ordering类\" class=\"headerlink\" title=\"Guava Ordering类\"></a>Guava Ordering类</h1><p>Ordering(排序)可以被看作是一个丰富的比较具有增强功能的链接，多个实用方法，多类型排序功能等。</p>\n<h2 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h2><p>以下是com.google.common.collect.Ordering<T>类的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">abstract</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Ordering</span>&lt;T&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Object</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Comparator</span>&lt;T&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>static Ordering<Object> allEqual()</strong>      返回一个排序，它把所有的值相等，说明“没有顺序。”通过这个顺序以任何稳定的排序算法的结果，在改变没有顺序元素。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>static Ordering<Object> arbitrary()</strong>      返回一个任意顺序对所有对象，其中compare(a, b) == 0 意味着a == b（身份平等）。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>int binarySearch(List&lt;? extends T&gt; sortedList, T key)</strong>      搜索排序列表使用键的二进制搜索算法。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>abstract int compare(T left, T right)</strong>  比较两个参数的顺序。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong><U extends T> Ordering<U> compound(Comparator&lt;? super U&gt; secondaryComparator)</strong>              返回首先使用排序这一点，但它排序中的“tie”，然后委托给secondaryComparator事件。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>static <T> Ordering<T> compound(Iterable&lt;? extends Comparator&lt;? super T&gt;&gt; comparators)</strong>              返回一个排序它尝试每个给定的比较器，以便直到一个非零结果找到，返回该结果，并返回零仅当所有比较器返回零。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>static <T> Ordering<T> explicit(List<T> valuesInOrder)</strong>  返回根据它们出现的定列表中的顺序比较对象进行排序。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>static <T> Ordering<T> explicit(T leastValue, T… remainingValuesInOrder)</strong>  返回根据它们所赋予本方法的顺序进行比较的对象进行排序。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>static <T> Ordering<T> from(Comparator<T> comparator)</strong>  返回基于现有的比较实例进行排序。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong><E extends T> List<E> greatestOf(Iterable<E> iterable, int k)</strong>      返回根据这个顺序给出迭代，为了从最大到最小的k个最大的元素。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong><E extends T> List<E> greatestOf(Iterator<E> iterator, int k)</strong>  返回从给定的迭代器按照这个顺序，从最大到最小k个最大的元素。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong><E extends T> ImmutableList<E> immutableSortedCopy(Iterable<E> elements)</strong>              返回包含的元素排序这种排序的不可变列表。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>boolean isOrdered(Iterable&lt;? extends T&gt; iterable)</strong>  返回true如果在迭代后的第一个的每个元素是大于或等于在它之前，根据该排序的元素。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>boolean isStrictlyOrdered(Iterable&lt;? extends T&gt; iterable)</strong>  返回true如果在迭代后的第一个的每个元素是严格比在它之前，根据该排序的元素更大。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong><E extends T> List<E> leastOf(Iterable<E> iterable, int k)</strong>      返回根据这个顺序给出迭代，从而从低到最大的k个最低的元素。</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong><E extends T> List<E> leastOf(Iterator<E> elements, int k)</strong>      返回第k从给定的迭代器，按照这个顺序从最低到最大至少元素。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong><S extends T> Ordering&lt;Iterable<S>&gt; lexicographical()</strong>      返回一个新的排序它通过比较对应元素两两直到非零结果发现排序迭代;规定“字典顺序”。</td>\n</tr>\n<tr>\n<td>18</td>\n<td><strong><E extends T> E max(E a, E b)</strong>      返回两个值按照这个顺序的较大值。</td>\n</tr>\n<tr>\n<td>19</td>\n<td><strong><E extends T> E max(E a, E b, E c, E… rest)</strong>  返回指定的值，根据这个顺序是最大的。</td>\n</tr>\n<tr>\n<td>20</td>\n<td><strong><E extends T> E max(Iterable<E> iterable)</strong>      返回指定的值，根据这个顺序是最大的。</td>\n</tr>\n<tr>\n<td>21</td>\n<td><strong><E extends T> E max(Iterator<E> iterator)</strong>      返回指定的值，根据这个顺序是最大的。</td>\n</tr>\n<tr>\n<td>22</td>\n<td><strong><E extends T> E min(E a, E b)</strong>      返回两个值按照这个顺序的较小者。</td>\n</tr>\n<tr>\n<td>23</td>\n<td><strong><E extends T> E min(E a, E b, E c, E… rest)</strong>  返回最少指定的值，根据这个顺序。</td>\n</tr>\n<tr>\n<td>24</td>\n<td><strong><E extends T> E min(Iterable<E> iterable)</strong>  返回最少指定的值，根据这个顺序。</td>\n</tr>\n<tr>\n<td>25</td>\n<td><strong><E extends T> E min(Iterator<E> iterator)</strong>  返回最少指定的值，根据这个顺序。</td>\n</tr>\n<tr>\n<td>26</td>\n<td><strong>static <C extends Comparable> Ordering<C> natural()</strong>  返回使用值的自然顺序排序序列化。</td>\n</tr>\n<tr>\n<td>27</td>\n<td><strong><S extends T> Ordering<S> nullsFirst()</strong>  返回对待null小于所有其他值，并使用此来比较非空值排序。</td>\n</tr>\n<tr>\n<td>28</td>\n<td><strong><S extends T> Ordering<S> nullsLast()</strong>  返回对待null作为大于所有其他值，并使用这个顺序来比较非空值排序。</td>\n</tr>\n<tr>\n<td>29</td>\n<td><strong><F> Ordering<F> onResultOf(Function&lt;F,? extends T&gt; function)</strong>      返回一个新的排序在F上，首先应用功能给它们，然后比较使用此这些结果的顺序元素。</td>\n</tr>\n<tr>\n<td>30</td>\n<td><strong><S extends T> Ordering<S> reverse()</strong>      返回相反顺序; 顺序相当于Collections.reverseOrder（Comparator）。</td>\n</tr>\n<tr>\n<td>31</td>\n<td><strong><E extends T> List<E> sortedCopy(Iterable<E> elements)</strong>  返回包含的元素排序此排序可变列表;使用这个只有在结果列表可能需要进一步修改，或可能包含null。</td>\n</tr>\n<tr>\n<td>32</td>\n<td><strong>static Ordering<Object> usingToString()</strong>  返回由它们的字符串表示的自然顺序，toString()比较对象进行排序。</td>\n</tr>\n</tbody></table>\n<h2 id=\"方法继承\"><a href=\"#方法继承\" class=\"headerlink\" title=\"方法继承\"></a>方法继承</h2><p>这个类从以下类继承的方法：</p>\n<ul>\n<li>java.lang.Object</li>\n</ul>\n<h2 id=\"Ordering-示例\"><a href=\"#Ordering-示例\" class=\"headerlink\" title=\"Ordering 示例\"></a>Ordering 示例</h2><p>使用所选择的编辑器，创建下面的java程序比如 C:/&gt; Guava</p>\n<p>GuavaTester.java</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.ArrayList;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collections;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.Ordering;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      List&lt;Integer&gt; numbers = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;Integer&gt;();</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">5</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">2</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">15</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">51</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">53</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">35</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">45</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">32</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">43</span>));</span><br><span class=\"line\">      numbers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">16</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"type\">Ordering</span> <span class=\"variable\">ordering</span> <span class=\"operator\">=</span> Ordering.natural();</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Input List: &quot;</span>);</span><br><span class=\"line\">      System.out.println(numbers);\t\t</span><br><span class=\"line\">         </span><br><span class=\"line\">      Collections.sort(numbers,ordering );</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Sorted List: &quot;</span>);</span><br><span class=\"line\">      System.out.println(numbers);</span><br><span class=\"line\">         </span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;======================&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;List is sorted: &quot;</span> + ordering.isOrdered(numbers));</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Minimum: &quot;</span> + ordering.min(numbers));</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Maximum: &quot;</span> + ordering.max(numbers));</span><br><span class=\"line\">         </span><br><span class=\"line\">      Collections.sort(numbers,ordering.reverse());</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Reverse: &quot;</span> + numbers);</span><br><span class=\"line\"></span><br><span class=\"line\">      numbers.add(<span class=\"literal\">null</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Null added to Sorted List: &quot;</span>);</span><br><span class=\"line\">      System.out.println(numbers);\t\t</span><br><span class=\"line\"></span><br><span class=\"line\">      Collections.sort(numbers,ordering.nullsFirst());</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Null first Sorted List: &quot;</span>);</span><br><span class=\"line\">      System.out.println(numbers);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;======================&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      List&lt;String&gt; names = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;String&gt;();</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Ram&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Shyam&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Mohan&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Sohan&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Ramesh&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Suresh&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Naresh&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Mahesh&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"literal\">null</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Vikas&quot;</span>);</span><br><span class=\"line\">      names.add(<span class=\"string\">&quot;Deepak&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Another List: &quot;</span>);</span><br><span class=\"line\">      System.out.println(names);</span><br><span class=\"line\"></span><br><span class=\"line\">\t  Collections.sort(names,ordering.nullsFirst().reverse());</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Null first then reverse sorted list: &quot;</span>);</span><br><span class=\"line\">      System.out.println(names);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf2103-c0ab-11ec-92a1-7557b2313227","title":"Guava Preconditions","abbrlink":"492d887f","_content":"\n## Preconditions\n\n[Preconditions](https://www.yiibai.com/guava/guava_preconditions_class.html)提供静态方法来检查方法或构造函数，被调用是否给定适当的参数。它检查的先决条件。其方法失败抛出IllegalArgumentException。\n\nPreconditions主要提供了四类检查\n\n- checkArgument\n  - static void checkArgument(boolean expression)\n  - static void checkArgument(boolean expression, String errorMessageTemplate, Object... errorMessageArgs)\n\n- checkState\n  - public static void checkState(boolean expression) \n  - public static void checkState(\n        boolean expression,\n        @Nullable String errorMessageTemplate,\n        @Nullable Object @Nullable ... errorMessageArgs)\n\n- checkNotNull\n  - public static <T extends @NonNull Object> T checkNotNull(\n        T reference, @Nullable Object errorMessage)\n  - public static <T extends @NonNull Object> T checkNotNull(\n        T reference,\n        @Nullable String errorMessageTemplate,\n        @Nullable Object @Nullable ... errorMessageArgs) \n\n- checkElementIndex\n  - public static int checkElementIndex(int index, int size)\n\n相关的用法比较简单，可自行查看源码后使用。\n\n不过这里所做的检查都抛的是基本异常类型，可能大多数不符合业务异常，所以使用可能不会太多。\n","source":"_posts/guava/Preconditions.md","raw":"---\nuuid: bbaf2103-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Preconditions\ncategories: Java\ntags:\n  - guava\nabbrlink: 492d887f\n---\n\n## Preconditions\n\n[Preconditions](https://www.yiibai.com/guava/guava_preconditions_class.html)提供静态方法来检查方法或构造函数，被调用是否给定适当的参数。它检查的先决条件。其方法失败抛出IllegalArgumentException。\n\nPreconditions主要提供了四类检查\n\n- checkArgument\n  - static void checkArgument(boolean expression)\n  - static void checkArgument(boolean expression, String errorMessageTemplate, Object... errorMessageArgs)\n\n- checkState\n  - public static void checkState(boolean expression) \n  - public static void checkState(\n        boolean expression,\n        @Nullable String errorMessageTemplate,\n        @Nullable Object @Nullable ... errorMessageArgs)\n\n- checkNotNull\n  - public static <T extends @NonNull Object> T checkNotNull(\n        T reference, @Nullable Object errorMessage)\n  - public static <T extends @NonNull Object> T checkNotNull(\n        T reference,\n        @Nullable String errorMessageTemplate,\n        @Nullable Object @Nullable ... errorMessageArgs) \n\n- checkElementIndex\n  - public static int checkElementIndex(int index, int size)\n\n相关的用法比较简单，可自行查看源码后使用。\n\n不过这里所做的检查都抛的是基本异常类型，可能大多数不符合业务异常，所以使用可能不会太多。\n","slug":"guava/Preconditions","published":1,"date":"2022-04-20T12:41:20.875Z","updated":"2022-05-04T03:16:25.786Z","_id":"cl2qzfthq002l13no4nupbdoo","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Preconditions\"><a href=\"#Preconditions\" class=\"headerlink\" title=\"Preconditions\"></a>Preconditions</h2><p><a href=\"https://www.yiibai.com/guava/guava_preconditions_class.html\">Preconditions</a>提供静态方法来检查方法或构造函数，被调用是否给定适当的参数。它检查的先决条件。其方法失败抛出IllegalArgumentException。</p>\n<p>Preconditions主要提供了四类检查</p>\n<ul>\n<li><p>checkArgument</p>\n<ul>\n<li>static void checkArgument(boolean expression)</li>\n<li>static void checkArgument(boolean expression, String errorMessageTemplate, Object… errorMessageArgs)</li>\n</ul>\n</li>\n<li><p>checkState</p>\n<ul>\n<li>public static void checkState(boolean expression) </li>\n<li>public static void checkState(<pre><code>boolean expression,\n@Nullable String errorMessageTemplate,\n@Nullable Object @Nullable ... errorMessageArgs)\n</code></pre>\n</li>\n</ul>\n</li>\n<li><p>checkNotNull</p>\n<ul>\n<li>public static &lt;T extends @NonNull Object&gt; T checkNotNull(<pre><code>T reference, @Nullable Object errorMessage)\n</code></pre>\n</li>\n<li>public static &lt;T extends @NonNull Object&gt; T checkNotNull(<pre><code>T reference,\n@Nullable String errorMessageTemplate,\n@Nullable Object @Nullable ... errorMessageArgs) \n</code></pre>\n</li>\n</ul>\n</li>\n<li><p>checkElementIndex</p>\n<ul>\n<li>public static int checkElementIndex(int index, int size)</li>\n</ul>\n</li>\n</ul>\n<p>相关的用法比较简单，可自行查看源码后使用。</p>\n<p>不过这里所做的检查都抛的是基本异常类型，可能大多数不符合业务异常，所以使用可能不会太多。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"Preconditions\"><a href=\"#Preconditions\" class=\"headerlink\" title=\"Preconditions\"></a>Preconditions</h2><p><a href=\"https://www.yiibai.com/guava/guava_preconditions_class.html\">Preconditions</a>提供静态方法来检查方法或构造函数，被调用是否给定适当的参数。它检查的先决条件。其方法失败抛出IllegalArgumentException。</p>\n<p>Preconditions主要提供了四类检查</p>\n<ul>\n<li><p>checkArgument</p>\n<ul>\n<li>static void checkArgument(boolean expression)</li>\n<li>static void checkArgument(boolean expression, String errorMessageTemplate, Object… errorMessageArgs)</li>\n</ul>\n</li>\n<li><p>checkState</p>\n<ul>\n<li>public static void checkState(boolean expression) </li>\n<li>public static void checkState(<pre><code>boolean expression,\n@Nullable String errorMessageTemplate,\n@Nullable Object @Nullable ... errorMessageArgs)\n</code></pre>\n</li>\n</ul>\n</li>\n<li><p>checkNotNull</p>\n<ul>\n<li>public static &lt;T extends @NonNull Object&gt; T checkNotNull(<pre><code>T reference, @Nullable Object errorMessage)\n</code></pre>\n</li>\n<li>public static &lt;T extends @NonNull Object&gt; T checkNotNull(<pre><code>T reference,\n@Nullable String errorMessageTemplate,\n@Nullable Object @Nullable ... errorMessageArgs) \n</code></pre>\n</li>\n</ul>\n</li>\n<li><p>checkElementIndex</p>\n<ul>\n<li>public static int checkElementIndex(int index, int size)</li>\n</ul>\n</li>\n</ul>\n<p>相关的用法比较简单，可自行查看源码后使用。</p>\n<p>不过这里所做的检查都抛的是基本异常类型，可能大多数不符合业务异常，所以使用可能不会太多。</p>\n"},{"uuid":"bbaf2104-c0ab-11ec-92a1-7557b2313227","title":"Guava Predicates","abbrlink":"447154f8","_content":"\n## 类方法\n\n| S.N  | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | public static <T> Predicate<T> alwaysTrue()                  |\n| 2    | public static <T> Predicate<T> alwaysFalse()                 |\n| 3    | public static <T> Predicate<T> isNull()                      |\n| 4    | public static <T> Predicate<T> notNull()                     |\n| 5    | public static <T> Predicate<T> and(Iterable<? extends Predicate<? super T>> components) |\n| 6    | public static <T> Predicate<T> and(Predicate<? super T>... components) |\n| 7    | public static <T> Predicate<T> and(Predicate<? super T> first, Predicate<? super T> second) |\n| 8    | public static <T> Predicate<T> or(Iterable<? extends Predicate<? super T>> components) |\n| 9    | public static <T> Predicate<T> or(Predicate<? super T>... components) |\n| 10   | public static <T> Predicate<T> or(Predicate<? super T> first, Predicate<? super T> second) |\n| 11   | public static <T> Predicate<T> equalTo(@Nullable T target)   |\n| 12   | public static Predicate<Object> instanceOf(Class<?> clazz)   |\n| 13   | public static Predicate<Class<?>> subtypeOf(Class<?> clazz)  |\n| 14   | public static <T> Predicate<T> in(Collection<? extends T> target) |\n| 15   | public static <A, B> Predicate<A> compose(Predicate<B> predicate, Function<A, ? extends B> function) |\n| 16   | public static Predicate<CharSequence> containsPattern(String pattern) |\n| 17   | public static Predicate<CharSequence> contains(Pattern pattern) |\n","source":"_posts/guava/Predicates.md","raw":"---\nuuid: bbaf2104-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Predicates\ncategories: Java\ntags:\n  - guava\nabbrlink: 447154f8\n---\n\n## 类方法\n\n| S.N  | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | public static <T> Predicate<T> alwaysTrue()                  |\n| 2    | public static <T> Predicate<T> alwaysFalse()                 |\n| 3    | public static <T> Predicate<T> isNull()                      |\n| 4    | public static <T> Predicate<T> notNull()                     |\n| 5    | public static <T> Predicate<T> and(Iterable<? extends Predicate<? super T>> components) |\n| 6    | public static <T> Predicate<T> and(Predicate<? super T>... components) |\n| 7    | public static <T> Predicate<T> and(Predicate<? super T> first, Predicate<? super T> second) |\n| 8    | public static <T> Predicate<T> or(Iterable<? extends Predicate<? super T>> components) |\n| 9    | public static <T> Predicate<T> or(Predicate<? super T>... components) |\n| 10   | public static <T> Predicate<T> or(Predicate<? super T> first, Predicate<? super T> second) |\n| 11   | public static <T> Predicate<T> equalTo(@Nullable T target)   |\n| 12   | public static Predicate<Object> instanceOf(Class<?> clazz)   |\n| 13   | public static Predicate<Class<?>> subtypeOf(Class<?> clazz)  |\n| 14   | public static <T> Predicate<T> in(Collection<? extends T> target) |\n| 15   | public static <A, B> Predicate<A> compose(Predicate<B> predicate, Function<A, ? extends B> function) |\n| 16   | public static Predicate<CharSequence> containsPattern(String pattern) |\n| 17   | public static Predicate<CharSequence> contains(Pattern pattern) |\n","slug":"guava/Predicates","published":1,"date":"2022-04-20T12:41:20.869Z","updated":"2022-05-04T03:16:37.994Z","_id":"cl2qzfthr002q13no539w89c9","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>public static <T> Predicate<T> alwaysTrue()</td>\n</tr>\n<tr>\n<td>2</td>\n<td>public static <T> Predicate<T> alwaysFalse()</td>\n</tr>\n<tr>\n<td>3</td>\n<td>public static <T> Predicate<T> isNull()</td>\n</tr>\n<tr>\n<td>4</td>\n<td>public static <T> Predicate<T> notNull()</td>\n</tr>\n<tr>\n<td>5</td>\n<td>public static <T> Predicate<T> and(Iterable&lt;? extends Predicate&lt;? super T&gt;&gt; components)</td>\n</tr>\n<tr>\n<td>6</td>\n<td>public static <T> Predicate<T> and(Predicate&lt;? super T&gt;… components)</td>\n</tr>\n<tr>\n<td>7</td>\n<td>public static <T> Predicate<T> and(Predicate&lt;? super T&gt; first, Predicate&lt;? super T&gt; second)</td>\n</tr>\n<tr>\n<td>8</td>\n<td>public static <T> Predicate<T> or(Iterable&lt;? extends Predicate&lt;? super T&gt;&gt; components)</td>\n</tr>\n<tr>\n<td>9</td>\n<td>public static <T> Predicate<T> or(Predicate&lt;? super T&gt;… components)</td>\n</tr>\n<tr>\n<td>10</td>\n<td>public static <T> Predicate<T> or(Predicate&lt;? super T&gt; first, Predicate&lt;? super T&gt; second)</td>\n</tr>\n<tr>\n<td>11</td>\n<td>public static <T> Predicate<T> equalTo(@Nullable T target)</td>\n</tr>\n<tr>\n<td>12</td>\n<td>public static Predicate<Object> instanceOf(Class&lt;?&gt; clazz)</td>\n</tr>\n<tr>\n<td>13</td>\n<td>public static Predicate&lt;Class<?>> subtypeOf(Class<?> clazz)</td>\n</tr>\n<tr>\n<td>14</td>\n<td>public static <T> Predicate<T> in(Collection&lt;? extends T&gt; target)</td>\n</tr>\n<tr>\n<td>15</td>\n<td>public static &lt;A, B&gt; Predicate<A> compose(Predicate<B> predicate, Function&lt;A, ? extends B&gt; function)</td>\n</tr>\n<tr>\n<td>16</td>\n<td>public static Predicate<CharSequence> containsPattern(String pattern)</td>\n</tr>\n<tr>\n<td>17</td>\n<td>public static Predicate<CharSequence> contains(Pattern pattern)</td>\n</tr>\n</tbody></table>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>public static <T> Predicate<T> alwaysTrue()</td>\n</tr>\n<tr>\n<td>2</td>\n<td>public static <T> Predicate<T> alwaysFalse()</td>\n</tr>\n<tr>\n<td>3</td>\n<td>public static <T> Predicate<T> isNull()</td>\n</tr>\n<tr>\n<td>4</td>\n<td>public static <T> Predicate<T> notNull()</td>\n</tr>\n<tr>\n<td>5</td>\n<td>public static <T> Predicate<T> and(Iterable&lt;? extends Predicate&lt;? super T&gt;&gt; components)</td>\n</tr>\n<tr>\n<td>6</td>\n<td>public static <T> Predicate<T> and(Predicate&lt;? super T&gt;… components)</td>\n</tr>\n<tr>\n<td>7</td>\n<td>public static <T> Predicate<T> and(Predicate&lt;? super T&gt; first, Predicate&lt;? super T&gt; second)</td>\n</tr>\n<tr>\n<td>8</td>\n<td>public static <T> Predicate<T> or(Iterable&lt;? extends Predicate&lt;? super T&gt;&gt; components)</td>\n</tr>\n<tr>\n<td>9</td>\n<td>public static <T> Predicate<T> or(Predicate&lt;? super T&gt;… components)</td>\n</tr>\n<tr>\n<td>10</td>\n<td>public static <T> Predicate<T> or(Predicate&lt;? super T&gt; first, Predicate&lt;? super T&gt; second)</td>\n</tr>\n<tr>\n<td>11</td>\n<td>public static <T> Predicate<T> equalTo(@Nullable T target)</td>\n</tr>\n<tr>\n<td>12</td>\n<td>public static Predicate<Object> instanceOf(Class&lt;?&gt; clazz)</td>\n</tr>\n<tr>\n<td>13</td>\n<td>public static Predicate&lt;Class<?>> subtypeOf(Class<?> clazz)</td>\n</tr>\n<tr>\n<td>14</td>\n<td>public static <T> Predicate<T> in(Collection&lt;? extends T&gt; target)</td>\n</tr>\n<tr>\n<td>15</td>\n<td>public static &lt;A, B&gt; Predicate<A> compose(Predicate<B> predicate, Function&lt;A, ? extends B&gt; function)</td>\n</tr>\n<tr>\n<td>16</td>\n<td>public static Predicate<CharSequence> containsPattern(String pattern)</td>\n</tr>\n<tr>\n<td>17</td>\n<td>public static Predicate<CharSequence> contains(Pattern pattern)</td>\n</tr>\n</tbody></table>\n"},{"uuid":"bbaf2105-c0ab-11ec-92a1-7557b2313227","title":"Guava Range","abbrlink":"1bba3e9b","_content":"\nRange 表示一个间隔或一个序列。它被用于获取一组数字/串在一个特定范围之内。\n\n## 类声明\n\n以下是com.google.common.collect.Range<C>类的声明：\n\n```java\n@GwtCompatible\npublic final class Range<C extends Comparable> extends Object implements Predicate<C>, Serializable\n```\n\n## 方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **static <C extends Comparable<?>> Range<C> all()**  \t\t\t返回包含C型的每一个值范围 |\n| 2    | **boolean apply(C input)Deprecated.**   \t\t\t只有提供满足谓词接口;使用包含(C)来代替。 |\n| 3    | **static <C extends Comparable<?>> Range<C> atLeast(C endpoint)**  \t\t\t返回包含大于或等于终点(endpoint)的所有值的范围内。 |\n| 4    | **static <C extends Comparable<?>> Range<C> atMost(C endpoint)**  \t\t\t返回包含的所有值小于或等于终点的范围内。 |\n| 5    | **Range<C> canonical(DiscreteDomain<C> domain)**  \t\t\t返回此范围内，在给定域中的规范形式。 |\n| 6    | **static <C extends Comparable<?>> Range<C> closed(C lower, C upper)**  \t\t\t返回包含大于所有值或等于降低且小于或等于上限的范围内。 |\n| 7    | **static <C extends Comparable<?>> Range<C> closedOpen(C lower, C upper)**  \t\t\t返回包含大于或等于下限和所有值严格大于上限以下的范围内。 |\n| 8    | **boolean contains(C value)**  \t\t\t返回true，如果值是这个范围的范围之内。 |\n| 9    | **boolean containsAll(Iterable<? extends C> values)**  \t\t\t如果值每一个元素都包含在这个范围内，则返回 true。 |\n| 10   | **static <C extends Comparable<?>> Range<C> downTo(C endpoint, BoundType boundType)**  \t\t\t返回的范围内的给定的端点，它可以是包容性（闭合）或专用（开），没有上限。 |\n| 11   | **static <C extends Comparable<?>> Range<C> encloseAll(Iterable<C> values)**  \t\t\t返回包含所有给定值的最小范围内。 |\n| 12   | **boolean encloses(Range<C> other)**  \t\t\t返回true，如果其他的边界不在该范围的边界之外延伸。 |\n| 13   | **boolean equals(Object object)**  \t\t\t返回true，如果对象是具有相同端点和绑定类型，这个范围内的范围。 |\n| 14   | **static <C extends Comparable<?>> Range<C> greaterThan(C endpoint)**  \t\t\t返回一个包含所有值严格大于端点的范围内。 |\n| 15   | **int hashCode()**  \t\t\t返回此范围内的哈希码。       |\n| 16   | **boolean hasLowerBound()**  \t\t\t如果此范围内具有更低的终点返回true。 |\n| 17   | **boolean hasUpperBound()**  \t\t\t如果此范围内有上端点返回true。 |\n| 18   | **Range<C> intersection(Range<C> connectedRange)**  \t\t\t返回由两者范围和connectedRange封闭，如果这样的范围存在的最大范围。 |\n| 19   | **boolean isConnected(Range<C> other)**  \t\t\t如果存在这是由两者此范围和其他封闭（可能为空）的范围，则返回true。 |\n| 20   | **boolean isEmpty()**  \t\t\t返回true，如果这个范围是形式 [v..v)  或 (v..v]. |\n| 21   | **static <C extends Comparable<?>> Range<C> lessThan(C endpoint)**  \t\t\t返回一个包含所有值严格小于端点的范围内。 |\n| 22   | **BoundType lowerBoundType()**  \t\t\t返回类型这个范围的下限：如果范围包括它的下端点BoundType.CLOSED，如果没有BoundType.OPEN。 |\n| 23   | **C lowerEndpoint()**  \t\t\t返回该范围的较低端点。    |\n| 24   | **static <C extends Comparable<?>> Range<C> open(C lower, C upper)**  \t\t\t返回一个包含所有值严格大于下限和严格比上端更小一个范围。 |\n| 25   | **static <C extends Comparable<?>> Range<C> openClosed(C lower, C upper)**  \t\t\t返回包含所有值严格低于更大且小于或等于上限的范围内。 |\n| 26   | **static <C extends Comparable<?>> Range<C> range(C lower, BoundType lowerType, C upper, BoundType upperType)**  \t\t\t返回包含任何值由下到上，每个端点可以是包容性（关闭）或专用（开）的范围。 |\n| 27   | **static <C extends Comparable<?>> Range<C> singleton(C value)**  \t\t\t返回包含只在给定范围内的值。 |\n| 28   | **Range<C> span(Range<C> other)**  \t\t\t返回最小的范围包围两者这个范围和other等。 |\n| 29   | **String toString()**  \t\t\t返回该范围内的字符串表示，如“[3..5）”（其他实例列在类文档）。 |\n| 30   | **BoundType upperBoundType()**  \t\t\t返回类型此范围的上限：如果范围包括其上的端点返回BoundType.CLOSED，如果没有返回BoundType.OPEN。 |\n| 31   | **C upperEndpoint()**  \t\t\t返回此范围的上限端点。    |\n| 32   | **static <C extends Comparable<?>> Range<C> upTo(C endpoint, BoundType boundType)**  \t\t\t返回一个范围，没有下限到给定的端点，它可以是包容性（闭合）或专用（开）。 |\n\n## Range 例子\n\n```java\npublic class GuavaTester {\n\n   public static void main(String args[]){\n      GuavaTester tester = new GuavaTester();\n      tester.testRange();\n   }\n\n   private void testRange(){\n\n      //create a range [a,b] = { x | a <= x <= b}\n      Range<Integer> range1 = Range.closed(0, 9);\n      System.out.print(\"[0,9] : \");\n      printRange(range1);\t\t\n      System.out.println(\"5 is present: \" + range1.contains(5));\n      System.out.println(\"(1,2,3) is present: \" + range1.containsAll(Ints.asList(1, 2, 3)));\n      System.out.println(\"Lower Bound: \" + range1.lowerEndpoint());\n      System.out.println(\"Upper Bound: \" + range1.upperEndpoint());\n\n      //create a range (a,b) = { x | a < x < b}\n      Range<Integer> range2 = Range.open(0, 9);\n      System.out.print(\"(0,9) : \");\n      printRange(range2);\n\n      //create a range (a,b] = { x | a < x <= b}\n      Range<Integer> range3 = Range.openClosed(0, 9);\n      System.out.print(\"(0,9] : \");\n      printRange(range3);\n\n      //create a range [a,b) = { x | a <= x < b}\n      Range<Integer> range4 = Range.closedOpen(0, 9);\n      System.out.print(\"[0,9) : \");\n      printRange(range4);\n\n      //create an open ended range (9, infinity\n      Range<Integer> range5 = Range.greaterThan(9);\n      System.out.println(\"(9,infinity) : \");\n      System.out.println(\"Lower Bound: \" + range5.lowerEndpoint());\n      System.out.println(\"Upper Bound present: \" + range5.hasUpperBound());\n\n      Range<Integer> range6 = Range.closed(3, 5);\t\n      printRange(range6);\n\n      //check a subrange [3,5] in [0,9]\n      System.out.println(\"[0,9] encloses [3,5]:\" + range1.encloses(range6));\n\n      Range<Integer> range7 = Range.closed(9, 20);\t\n      printRange(range7);\n      //check ranges to be connected\t\t\n      System.out.println(\"[0,9] is connected [9,20]:\" + range1.isConnected(range7));\n\n      Range<Integer> range8 = Range.closed(5, 15);\t\n\n      //intersection\n      printRange(range1.intersection(range8));\n\n      //span\n      printRange(range1.span(range8));\n   }\n\n   private void printRange(Range<Integer> range){\t\t\n      System.out.print(\"[ \");\n      for(int grade : ContiguousSet.create(range, DiscreteDomain.integers())) {\n         System.out.print(grade +\" \");\n      }\n      System.out.println(\"]\");\n   }\n}\n```\n","source":"_posts/guava/Range.md","raw":"---\nuuid: bbaf2105-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Range\ncategories: Java\ntags:\n  - guava\nabbrlink: 1bba3e9b\n---\n\nRange 表示一个间隔或一个序列。它被用于获取一组数字/串在一个特定范围之内。\n\n## 类声明\n\n以下是com.google.common.collect.Range<C>类的声明：\n\n```java\n@GwtCompatible\npublic final class Range<C extends Comparable> extends Object implements Predicate<C>, Serializable\n```\n\n## 方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **static <C extends Comparable<?>> Range<C> all()**  \t\t\t返回包含C型的每一个值范围 |\n| 2    | **boolean apply(C input)Deprecated.**   \t\t\t只有提供满足谓词接口;使用包含(C)来代替。 |\n| 3    | **static <C extends Comparable<?>> Range<C> atLeast(C endpoint)**  \t\t\t返回包含大于或等于终点(endpoint)的所有值的范围内。 |\n| 4    | **static <C extends Comparable<?>> Range<C> atMost(C endpoint)**  \t\t\t返回包含的所有值小于或等于终点的范围内。 |\n| 5    | **Range<C> canonical(DiscreteDomain<C> domain)**  \t\t\t返回此范围内，在给定域中的规范形式。 |\n| 6    | **static <C extends Comparable<?>> Range<C> closed(C lower, C upper)**  \t\t\t返回包含大于所有值或等于降低且小于或等于上限的范围内。 |\n| 7    | **static <C extends Comparable<?>> Range<C> closedOpen(C lower, C upper)**  \t\t\t返回包含大于或等于下限和所有值严格大于上限以下的范围内。 |\n| 8    | **boolean contains(C value)**  \t\t\t返回true，如果值是这个范围的范围之内。 |\n| 9    | **boolean containsAll(Iterable<? extends C> values)**  \t\t\t如果值每一个元素都包含在这个范围内，则返回 true。 |\n| 10   | **static <C extends Comparable<?>> Range<C> downTo(C endpoint, BoundType boundType)**  \t\t\t返回的范围内的给定的端点，它可以是包容性（闭合）或专用（开），没有上限。 |\n| 11   | **static <C extends Comparable<?>> Range<C> encloseAll(Iterable<C> values)**  \t\t\t返回包含所有给定值的最小范围内。 |\n| 12   | **boolean encloses(Range<C> other)**  \t\t\t返回true，如果其他的边界不在该范围的边界之外延伸。 |\n| 13   | **boolean equals(Object object)**  \t\t\t返回true，如果对象是具有相同端点和绑定类型，这个范围内的范围。 |\n| 14   | **static <C extends Comparable<?>> Range<C> greaterThan(C endpoint)**  \t\t\t返回一个包含所有值严格大于端点的范围内。 |\n| 15   | **int hashCode()**  \t\t\t返回此范围内的哈希码。       |\n| 16   | **boolean hasLowerBound()**  \t\t\t如果此范围内具有更低的终点返回true。 |\n| 17   | **boolean hasUpperBound()**  \t\t\t如果此范围内有上端点返回true。 |\n| 18   | **Range<C> intersection(Range<C> connectedRange)**  \t\t\t返回由两者范围和connectedRange封闭，如果这样的范围存在的最大范围。 |\n| 19   | **boolean isConnected(Range<C> other)**  \t\t\t如果存在这是由两者此范围和其他封闭（可能为空）的范围，则返回true。 |\n| 20   | **boolean isEmpty()**  \t\t\t返回true，如果这个范围是形式 [v..v)  或 (v..v]. |\n| 21   | **static <C extends Comparable<?>> Range<C> lessThan(C endpoint)**  \t\t\t返回一个包含所有值严格小于端点的范围内。 |\n| 22   | **BoundType lowerBoundType()**  \t\t\t返回类型这个范围的下限：如果范围包括它的下端点BoundType.CLOSED，如果没有BoundType.OPEN。 |\n| 23   | **C lowerEndpoint()**  \t\t\t返回该范围的较低端点。    |\n| 24   | **static <C extends Comparable<?>> Range<C> open(C lower, C upper)**  \t\t\t返回一个包含所有值严格大于下限和严格比上端更小一个范围。 |\n| 25   | **static <C extends Comparable<?>> Range<C> openClosed(C lower, C upper)**  \t\t\t返回包含所有值严格低于更大且小于或等于上限的范围内。 |\n| 26   | **static <C extends Comparable<?>> Range<C> range(C lower, BoundType lowerType, C upper, BoundType upperType)**  \t\t\t返回包含任何值由下到上，每个端点可以是包容性（关闭）或专用（开）的范围。 |\n| 27   | **static <C extends Comparable<?>> Range<C> singleton(C value)**  \t\t\t返回包含只在给定范围内的值。 |\n| 28   | **Range<C> span(Range<C> other)**  \t\t\t返回最小的范围包围两者这个范围和other等。 |\n| 29   | **String toString()**  \t\t\t返回该范围内的字符串表示，如“[3..5）”（其他实例列在类文档）。 |\n| 30   | **BoundType upperBoundType()**  \t\t\t返回类型此范围的上限：如果范围包括其上的端点返回BoundType.CLOSED，如果没有返回BoundType.OPEN。 |\n| 31   | **C upperEndpoint()**  \t\t\t返回此范围的上限端点。    |\n| 32   | **static <C extends Comparable<?>> Range<C> upTo(C endpoint, BoundType boundType)**  \t\t\t返回一个范围，没有下限到给定的端点，它可以是包容性（闭合）或专用（开）。 |\n\n## Range 例子\n\n```java\npublic class GuavaTester {\n\n   public static void main(String args[]){\n      GuavaTester tester = new GuavaTester();\n      tester.testRange();\n   }\n\n   private void testRange(){\n\n      //create a range [a,b] = { x | a <= x <= b}\n      Range<Integer> range1 = Range.closed(0, 9);\n      System.out.print(\"[0,9] : \");\n      printRange(range1);\t\t\n      System.out.println(\"5 is present: \" + range1.contains(5));\n      System.out.println(\"(1,2,3) is present: \" + range1.containsAll(Ints.asList(1, 2, 3)));\n      System.out.println(\"Lower Bound: \" + range1.lowerEndpoint());\n      System.out.println(\"Upper Bound: \" + range1.upperEndpoint());\n\n      //create a range (a,b) = { x | a < x < b}\n      Range<Integer> range2 = Range.open(0, 9);\n      System.out.print(\"(0,9) : \");\n      printRange(range2);\n\n      //create a range (a,b] = { x | a < x <= b}\n      Range<Integer> range3 = Range.openClosed(0, 9);\n      System.out.print(\"(0,9] : \");\n      printRange(range3);\n\n      //create a range [a,b) = { x | a <= x < b}\n      Range<Integer> range4 = Range.closedOpen(0, 9);\n      System.out.print(\"[0,9) : \");\n      printRange(range4);\n\n      //create an open ended range (9, infinity\n      Range<Integer> range5 = Range.greaterThan(9);\n      System.out.println(\"(9,infinity) : \");\n      System.out.println(\"Lower Bound: \" + range5.lowerEndpoint());\n      System.out.println(\"Upper Bound present: \" + range5.hasUpperBound());\n\n      Range<Integer> range6 = Range.closed(3, 5);\t\n      printRange(range6);\n\n      //check a subrange [3,5] in [0,9]\n      System.out.println(\"[0,9] encloses [3,5]:\" + range1.encloses(range6));\n\n      Range<Integer> range7 = Range.closed(9, 20);\t\n      printRange(range7);\n      //check ranges to be connected\t\t\n      System.out.println(\"[0,9] is connected [9,20]:\" + range1.isConnected(range7));\n\n      Range<Integer> range8 = Range.closed(5, 15);\t\n\n      //intersection\n      printRange(range1.intersection(range8));\n\n      //span\n      printRange(range1.span(range8));\n   }\n\n   private void printRange(Range<Integer> range){\t\t\n      System.out.print(\"[ \");\n      for(int grade : ContiguousSet.create(range, DiscreteDomain.integers())) {\n         System.out.print(grade +\" \");\n      }\n      System.out.println(\"]\");\n   }\n}\n```\n","slug":"guava/Range","published":1,"date":"2022-04-20T12:41:20.837Z","updated":"2022-05-04T03:17:19.372Z","_id":"cl2qzfths002s13no010y0z6t","comments":1,"layout":"post","photos":[],"link":"","content":"<p>Range 表示一个间隔或一个序列。它被用于获取一组数字/串在一个特定范围之内。</p>\n<h2 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h2><p>以下是com.google.common.collect.Range<C>类的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Range</span>&lt;C <span class=\"keyword\">extends</span> <span class=\"title class_\">Comparable</span>&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Object</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Predicate</span>&lt;C&gt;, Serializable</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> all()</strong>              返回包含C型的每一个值范围</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>boolean apply(C input)Deprecated.</strong>               只有提供满足谓词接口;使用包含(C)来代替。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> atLeast(C endpoint)</strong>              返回包含大于或等于终点(endpoint)的所有值的范围内。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> atMost(C endpoint)</strong>              返回包含的所有值小于或等于终点的范围内。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>Range<C> canonical(DiscreteDomain<C> domain)</strong>              返回此范围内，在给定域中的规范形式。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> closed(C lower, C upper)</strong>              返回包含大于所有值或等于降低且小于或等于上限的范围内。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> closedOpen(C lower, C upper)</strong>              返回包含大于或等于下限和所有值严格大于上限以下的范围内。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>boolean contains(C value)</strong>              返回true，如果值是这个范围的范围之内。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>boolean containsAll(Iterable&lt;? extends C&gt; values)</strong>              如果值每一个元素都包含在这个范围内，则返回 true。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> downTo(C endpoint, BoundType boundType)</strong>              返回的范围内的给定的端点，它可以是包容性（闭合）或专用（开），没有上限。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> encloseAll(Iterable<C> values)</strong>              返回包含所有给定值的最小范围内。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>boolean encloses(Range<C> other)</strong>              返回true，如果其他的边界不在该范围的边界之外延伸。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>boolean equals(Object object)</strong>              返回true，如果对象是具有相同端点和绑定类型，这个范围内的范围。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> greaterThan(C endpoint)</strong>              返回一个包含所有值严格大于端点的范围内。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>int hashCode()</strong>              返回此范围内的哈希码。</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong>boolean hasLowerBound()</strong>              如果此范围内具有更低的终点返回true。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong>boolean hasUpperBound()</strong>              如果此范围内有上端点返回true。</td>\n</tr>\n<tr>\n<td>18</td>\n<td><strong>Range<C> intersection(Range<C> connectedRange)</strong>              返回由两者范围和connectedRange封闭，如果这样的范围存在的最大范围。</td>\n</tr>\n<tr>\n<td>19</td>\n<td><strong>boolean isConnected(Range<C> other)</strong>              如果存在这是由两者此范围和其他封闭（可能为空）的范围，则返回true。</td>\n</tr>\n<tr>\n<td>20</td>\n<td><strong>boolean isEmpty()</strong>              返回true，如果这个范围是形式 [v..v)  或 (v..v].</td>\n</tr>\n<tr>\n<td>21</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> lessThan(C endpoint)</strong>              返回一个包含所有值严格小于端点的范围内。</td>\n</tr>\n<tr>\n<td>22</td>\n<td><strong>BoundType lowerBoundType()</strong>              返回类型这个范围的下限：如果范围包括它的下端点BoundType.CLOSED，如果没有BoundType.OPEN。</td>\n</tr>\n<tr>\n<td>23</td>\n<td><strong>C lowerEndpoint()</strong>              返回该范围的较低端点。</td>\n</tr>\n<tr>\n<td>24</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> open(C lower, C upper)</strong>              返回一个包含所有值严格大于下限和严格比上端更小一个范围。</td>\n</tr>\n<tr>\n<td>25</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> openClosed(C lower, C upper)</strong>              返回包含所有值严格低于更大且小于或等于上限的范围内。</td>\n</tr>\n<tr>\n<td>26</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> range(C lower, BoundType lowerType, C upper, BoundType upperType)</strong>              返回包含任何值由下到上，每个端点可以是包容性（关闭）或专用（开）的范围。</td>\n</tr>\n<tr>\n<td>27</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> singleton(C value)</strong>              返回包含只在给定范围内的值。</td>\n</tr>\n<tr>\n<td>28</td>\n<td><strong>Range<C> span(Range<C> other)</strong>              返回最小的范围包围两者这个范围和other等。</td>\n</tr>\n<tr>\n<td>29</td>\n<td><strong>String toString()</strong>              返回该范围内的字符串表示，如“[3..5）”（其他实例列在类文档）。</td>\n</tr>\n<tr>\n<td>30</td>\n<td><strong>BoundType upperBoundType()</strong>              返回类型此范围的上限：如果范围包括其上的端点返回BoundType.CLOSED，如果没有返回BoundType.OPEN。</td>\n</tr>\n<tr>\n<td>31</td>\n<td><strong>C upperEndpoint()</strong>              返回此范围的上限端点。</td>\n</tr>\n<tr>\n<td>32</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> upTo(C endpoint, BoundType boundType)</strong>              返回一个范围，没有下限到给定的端点，它可以是包容性（闭合）或专用（开）。</td>\n</tr>\n</tbody></table>\n<h2 id=\"Range-例子\"><a href=\"#Range-例子\" class=\"headerlink\" title=\"Range 例子\"></a>Range 例子</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"type\">GuavaTester</span> <span class=\"variable\">tester</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">GuavaTester</span>();</span><br><span class=\"line\">      tester.testRange();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testRange</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//create a range [a,b] = &#123; x | a &lt;= x &lt;= b&#125;</span></span><br><span class=\"line\">      Range&lt;Integer&gt; range1 = Range.closed(<span class=\"number\">0</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;[0,9] : &quot;</span>);</span><br><span class=\"line\">      printRange(range1);\t\t</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;5 is present: &quot;</span> + range1.contains(<span class=\"number\">5</span>));</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;(1,2,3) is present: &quot;</span> + range1.containsAll(Ints.asList(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)));</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Lower Bound: &quot;</span> + range1.lowerEndpoint());</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Upper Bound: &quot;</span> + range1.upperEndpoint());</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//create a range (a,b) = &#123; x | a &lt; x &lt; b&#125;</span></span><br><span class=\"line\">      Range&lt;Integer&gt; range2 = Range.open(<span class=\"number\">0</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;(0,9) : &quot;</span>);</span><br><span class=\"line\">      printRange(range2);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//create a range (a,b] = &#123; x | a &lt; x &lt;= b&#125;</span></span><br><span class=\"line\">      Range&lt;Integer&gt; range3 = Range.openClosed(<span class=\"number\">0</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;(0,9] : &quot;</span>);</span><br><span class=\"line\">      printRange(range3);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//create a range [a,b) = &#123; x | a &lt;= x &lt; b&#125;</span></span><br><span class=\"line\">      Range&lt;Integer&gt; range4 = Range.closedOpen(<span class=\"number\">0</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;[0,9) : &quot;</span>);</span><br><span class=\"line\">      printRange(range4);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//create an open ended range (9, infinity</span></span><br><span class=\"line\">      Range&lt;Integer&gt; range5 = Range.greaterThan(<span class=\"number\">9</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;(9,infinity) : &quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Lower Bound: &quot;</span> + range5.lowerEndpoint());</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Upper Bound present: &quot;</span> + range5.hasUpperBound());</span><br><span class=\"line\"></span><br><span class=\"line\">      Range&lt;Integer&gt; range6 = Range.closed(<span class=\"number\">3</span>, <span class=\"number\">5</span>);\t</span><br><span class=\"line\">      printRange(range6);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//check a subrange [3,5] in [0,9]</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;[0,9] encloses [3,5]:&quot;</span> + range1.encloses(range6));</span><br><span class=\"line\"></span><br><span class=\"line\">      Range&lt;Integer&gt; range7 = Range.closed(<span class=\"number\">9</span>, <span class=\"number\">20</span>);\t</span><br><span class=\"line\">      printRange(range7);</span><br><span class=\"line\">      <span class=\"comment\">//check ranges to be connected\t\t</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;[0,9] is connected [9,20]:&quot;</span> + range1.isConnected(range7));</span><br><span class=\"line\"></span><br><span class=\"line\">      Range&lt;Integer&gt; range8 = Range.closed(<span class=\"number\">5</span>, <span class=\"number\">15</span>);\t</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//intersection</span></span><br><span class=\"line\">      printRange(range1.intersection(range8));</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//span</span></span><br><span class=\"line\">      printRange(range1.span(range8));</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">printRange</span><span class=\"params\">(Range&lt;Integer&gt; range)</span>&#123;\t\t</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;[ &quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"type\">int</span> grade : ContiguousSet.create(range, DiscreteDomain.integers())) &#123;</span><br><span class=\"line\">         System.out.print(grade +<span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;]&quot;</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>Range 表示一个间隔或一个序列。它被用于获取一组数字/串在一个特定范围之内。</p>\n<h2 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h2><p>以下是com.google.common.collect.Range<C>类的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Range</span>&lt;C <span class=\"keyword\">extends</span> <span class=\"title class_\">Comparable</span>&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Object</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Predicate</span>&lt;C&gt;, Serializable</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> all()</strong>              返回包含C型的每一个值范围</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>boolean apply(C input)Deprecated.</strong>               只有提供满足谓词接口;使用包含(C)来代替。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> atLeast(C endpoint)</strong>              返回包含大于或等于终点(endpoint)的所有值的范围内。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> atMost(C endpoint)</strong>              返回包含的所有值小于或等于终点的范围内。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>Range<C> canonical(DiscreteDomain<C> domain)</strong>              返回此范围内，在给定域中的规范形式。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> closed(C lower, C upper)</strong>              返回包含大于所有值或等于降低且小于或等于上限的范围内。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> closedOpen(C lower, C upper)</strong>              返回包含大于或等于下限和所有值严格大于上限以下的范围内。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>boolean contains(C value)</strong>              返回true，如果值是这个范围的范围之内。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>boolean containsAll(Iterable&lt;? extends C&gt; values)</strong>              如果值每一个元素都包含在这个范围内，则返回 true。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> downTo(C endpoint, BoundType boundType)</strong>              返回的范围内的给定的端点，它可以是包容性（闭合）或专用（开），没有上限。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> encloseAll(Iterable<C> values)</strong>              返回包含所有给定值的最小范围内。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>boolean encloses(Range<C> other)</strong>              返回true，如果其他的边界不在该范围的边界之外延伸。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>boolean equals(Object object)</strong>              返回true，如果对象是具有相同端点和绑定类型，这个范围内的范围。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> greaterThan(C endpoint)</strong>              返回一个包含所有值严格大于端点的范围内。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>int hashCode()</strong>              返回此范围内的哈希码。</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong>boolean hasLowerBound()</strong>              如果此范围内具有更低的终点返回true。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong>boolean hasUpperBound()</strong>              如果此范围内有上端点返回true。</td>\n</tr>\n<tr>\n<td>18</td>\n<td><strong>Range<C> intersection(Range<C> connectedRange)</strong>              返回由两者范围和connectedRange封闭，如果这样的范围存在的最大范围。</td>\n</tr>\n<tr>\n<td>19</td>\n<td><strong>boolean isConnected(Range<C> other)</strong>              如果存在这是由两者此范围和其他封闭（可能为空）的范围，则返回true。</td>\n</tr>\n<tr>\n<td>20</td>\n<td><strong>boolean isEmpty()</strong>              返回true，如果这个范围是形式 [v..v)  或 (v..v].</td>\n</tr>\n<tr>\n<td>21</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> lessThan(C endpoint)</strong>              返回一个包含所有值严格小于端点的范围内。</td>\n</tr>\n<tr>\n<td>22</td>\n<td><strong>BoundType lowerBoundType()</strong>              返回类型这个范围的下限：如果范围包括它的下端点BoundType.CLOSED，如果没有BoundType.OPEN。</td>\n</tr>\n<tr>\n<td>23</td>\n<td><strong>C lowerEndpoint()</strong>              返回该范围的较低端点。</td>\n</tr>\n<tr>\n<td>24</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> open(C lower, C upper)</strong>              返回一个包含所有值严格大于下限和严格比上端更小一个范围。</td>\n</tr>\n<tr>\n<td>25</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> openClosed(C lower, C upper)</strong>              返回包含所有值严格低于更大且小于或等于上限的范围内。</td>\n</tr>\n<tr>\n<td>26</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> range(C lower, BoundType lowerType, C upper, BoundType upperType)</strong>              返回包含任何值由下到上，每个端点可以是包容性（关闭）或专用（开）的范围。</td>\n</tr>\n<tr>\n<td>27</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> singleton(C value)</strong>              返回包含只在给定范围内的值。</td>\n</tr>\n<tr>\n<td>28</td>\n<td><strong>Range<C> span(Range<C> other)</strong>              返回最小的范围包围两者这个范围和other等。</td>\n</tr>\n<tr>\n<td>29</td>\n<td><strong>String toString()</strong>              返回该范围内的字符串表示，如“[3..5）”（其他实例列在类文档）。</td>\n</tr>\n<tr>\n<td>30</td>\n<td><strong>BoundType upperBoundType()</strong>              返回类型此范围的上限：如果范围包括其上的端点返回BoundType.CLOSED，如果没有返回BoundType.OPEN。</td>\n</tr>\n<tr>\n<td>31</td>\n<td><strong>C upperEndpoint()</strong>              返回此范围的上限端点。</td>\n</tr>\n<tr>\n<td>32</td>\n<td><strong>static &lt;C extends Comparable&lt;?&gt;&gt; Range<C> upTo(C endpoint, BoundType boundType)</strong>              返回一个范围，没有下限到给定的端点，它可以是包容性（闭合）或专用（开）。</td>\n</tr>\n</tbody></table>\n<h2 id=\"Range-例子\"><a href=\"#Range-例子\" class=\"headerlink\" title=\"Range 例子\"></a>Range 例子</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"type\">GuavaTester</span> <span class=\"variable\">tester</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">GuavaTester</span>();</span><br><span class=\"line\">      tester.testRange();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">testRange</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//create a range [a,b] = &#123; x | a &lt;= x &lt;= b&#125;</span></span><br><span class=\"line\">      Range&lt;Integer&gt; range1 = Range.closed(<span class=\"number\">0</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;[0,9] : &quot;</span>);</span><br><span class=\"line\">      printRange(range1);\t\t</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;5 is present: &quot;</span> + range1.contains(<span class=\"number\">5</span>));</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;(1,2,3) is present: &quot;</span> + range1.containsAll(Ints.asList(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>)));</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Lower Bound: &quot;</span> + range1.lowerEndpoint());</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Upper Bound: &quot;</span> + range1.upperEndpoint());</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//create a range (a,b) = &#123; x | a &lt; x &lt; b&#125;</span></span><br><span class=\"line\">      Range&lt;Integer&gt; range2 = Range.open(<span class=\"number\">0</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;(0,9) : &quot;</span>);</span><br><span class=\"line\">      printRange(range2);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//create a range (a,b] = &#123; x | a &lt; x &lt;= b&#125;</span></span><br><span class=\"line\">      Range&lt;Integer&gt; range3 = Range.openClosed(<span class=\"number\">0</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;(0,9] : &quot;</span>);</span><br><span class=\"line\">      printRange(range3);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//create a range [a,b) = &#123; x | a &lt;= x &lt; b&#125;</span></span><br><span class=\"line\">      Range&lt;Integer&gt; range4 = Range.closedOpen(<span class=\"number\">0</span>, <span class=\"number\">9</span>);</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;[0,9) : &quot;</span>);</span><br><span class=\"line\">      printRange(range4);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//create an open ended range (9, infinity</span></span><br><span class=\"line\">      Range&lt;Integer&gt; range5 = Range.greaterThan(<span class=\"number\">9</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;(9,infinity) : &quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Lower Bound: &quot;</span> + range5.lowerEndpoint());</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Upper Bound present: &quot;</span> + range5.hasUpperBound());</span><br><span class=\"line\"></span><br><span class=\"line\">      Range&lt;Integer&gt; range6 = Range.closed(<span class=\"number\">3</span>, <span class=\"number\">5</span>);\t</span><br><span class=\"line\">      printRange(range6);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//check a subrange [3,5] in [0,9]</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;[0,9] encloses [3,5]:&quot;</span> + range1.encloses(range6));</span><br><span class=\"line\"></span><br><span class=\"line\">      Range&lt;Integer&gt; range7 = Range.closed(<span class=\"number\">9</span>, <span class=\"number\">20</span>);\t</span><br><span class=\"line\">      printRange(range7);</span><br><span class=\"line\">      <span class=\"comment\">//check ranges to be connected\t\t</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;[0,9] is connected [9,20]:&quot;</span> + range1.isConnected(range7));</span><br><span class=\"line\"></span><br><span class=\"line\">      Range&lt;Integer&gt; range8 = Range.closed(<span class=\"number\">5</span>, <span class=\"number\">15</span>);\t</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//intersection</span></span><br><span class=\"line\">      printRange(range1.intersection(range8));</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//span</span></span><br><span class=\"line\">      printRange(range1.span(range8));</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">printRange</span><span class=\"params\">(Range&lt;Integer&gt; range)</span>&#123;\t\t</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;[ &quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(<span class=\"type\">int</span> grade : ContiguousSet.create(range, DiscreteDomain.integers())) &#123;</span><br><span class=\"line\">         System.out.print(grade +<span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;]&quot;</span>);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf2106-c0ab-11ec-92a1-7557b2313227","title":"Guava Splitter","abbrlink":"865138fd","_content":"\n# Splitter常见用法\n\n## 基本用法\n\n~~~java\n@Test\nvoid testSplitter() {\n  String str = \"java#python#golang#default\";\n  List<String> list = Splitter.on(\"#\").splitToList(str);\n  assertEquals(4, list.size());\n}\n~~~\n\n## Omit empty strings\n\n~~~java\n@Test\nvoid testSplitterOmitEmptyStrings() {\n  String str = \"java#python#golang#\";\n  List<String> list = Splitter.on(\"#\").omitEmptyStrings().splitToList(str);\n  assertEquals(3, list.size());\n}\n~~~\n\n## Splitter limit\n\n~~~java\n@Test\nvoid testSplitterLimit() {\n  String str = \"java#python#golang#\";\n  List<String> list = Splitter.on(\"#\").limit(2).splitToList(str);\n  assertEquals(2, list.size());\n  assertEquals(\"python#golang#\", list.get(1));\n}\n~~~\n\n## Splitter map\n\n~~~java\n@Test\nvoid testSplitterMap() {\n  String str = \"k1=v1&k2=v2&k3=v3\";\n  Map<String,String> map = Splitter.on(\"&\").withKeyValueSeparator(\"=\").split(str);\n  assertEquals(3, map.size());\n  assertEquals(\"v1\", map.get(\"k1\"));\n}\n~~~\n\nSplitter fixed length\n\n~~~java\n@Test\nvoid testSplitterFixedLength() {\n  String str = \"aaaabbbbccccdddd\";\n  List<String> list = Splitter.fixedLength(4).splitToList(str);\n  assertEquals(4, list.size());\n  assertEquals(\"aaaa\", list.get(0));\n  assertEquals(\"dddd\", list.get(3));\n}\n~~~\n","source":"_posts/guava/Splitter.md","raw":"---\nuuid: bbaf2106-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Splitter\ncategories: Java\ntags:\n  - guava\nabbrlink: 865138fd\n---\n\n# Splitter常见用法\n\n## 基本用法\n\n~~~java\n@Test\nvoid testSplitter() {\n  String str = \"java#python#golang#default\";\n  List<String> list = Splitter.on(\"#\").splitToList(str);\n  assertEquals(4, list.size());\n}\n~~~\n\n## Omit empty strings\n\n~~~java\n@Test\nvoid testSplitterOmitEmptyStrings() {\n  String str = \"java#python#golang#\";\n  List<String> list = Splitter.on(\"#\").omitEmptyStrings().splitToList(str);\n  assertEquals(3, list.size());\n}\n~~~\n\n## Splitter limit\n\n~~~java\n@Test\nvoid testSplitterLimit() {\n  String str = \"java#python#golang#\";\n  List<String> list = Splitter.on(\"#\").limit(2).splitToList(str);\n  assertEquals(2, list.size());\n  assertEquals(\"python#golang#\", list.get(1));\n}\n~~~\n\n## Splitter map\n\n~~~java\n@Test\nvoid testSplitterMap() {\n  String str = \"k1=v1&k2=v2&k3=v3\";\n  Map<String,String> map = Splitter.on(\"&\").withKeyValueSeparator(\"=\").split(str);\n  assertEquals(3, map.size());\n  assertEquals(\"v1\", map.get(\"k1\"));\n}\n~~~\n\nSplitter fixed length\n\n~~~java\n@Test\nvoid testSplitterFixedLength() {\n  String str = \"aaaabbbbccccdddd\";\n  List<String> list = Splitter.fixedLength(4).splitToList(str);\n  assertEquals(4, list.size());\n  assertEquals(\"aaaa\", list.get(0));\n  assertEquals(\"dddd\", list.get(3));\n}\n~~~\n","slug":"guava/Splitter","published":1,"date":"2022-04-20T12:41:20.859Z","updated":"2022-05-04T03:17:33.870Z","_id":"cl2qzftht002x13nodfnj9dnn","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Splitter常见用法\"><a href=\"#Splitter常见用法\" class=\"headerlink\" title=\"Splitter常见用法\"></a>Splitter常见用法</h1><h2 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testSplitter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;java#python#golang#default&quot;</span>;</span><br><span class=\"line\">  List&lt;String&gt; list = Splitter.on(<span class=\"string\">&quot;#&quot;</span>).splitToList(str);</span><br><span class=\"line\">  assertEquals(<span class=\"number\">4</span>, list.size());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Omit-empty-strings\"><a href=\"#Omit-empty-strings\" class=\"headerlink\" title=\"Omit empty strings\"></a>Omit empty strings</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testSplitterOmitEmptyStrings</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;java#python#golang#&quot;</span>;</span><br><span class=\"line\">  List&lt;String&gt; list = Splitter.on(<span class=\"string\">&quot;#&quot;</span>).omitEmptyStrings().splitToList(str);</span><br><span class=\"line\">  assertEquals(<span class=\"number\">3</span>, list.size());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Splitter-limit\"><a href=\"#Splitter-limit\" class=\"headerlink\" title=\"Splitter limit\"></a>Splitter limit</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testSplitterLimit</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;java#python#golang#&quot;</span>;</span><br><span class=\"line\">  List&lt;String&gt; list = Splitter.on(<span class=\"string\">&quot;#&quot;</span>).limit(<span class=\"number\">2</span>).splitToList(str);</span><br><span class=\"line\">  assertEquals(<span class=\"number\">2</span>, list.size());</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;python#golang#&quot;</span>, list.get(<span class=\"number\">1</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Splitter-map\"><a href=\"#Splitter-map\" class=\"headerlink\" title=\"Splitter map\"></a>Splitter map</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testSplitterMap</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;k1=v1&amp;k2=v2&amp;k3=v3&quot;</span>;</span><br><span class=\"line\">  Map&lt;String,String&gt; map = Splitter.on(<span class=\"string\">&quot;&amp;&quot;</span>).withKeyValueSeparator(<span class=\"string\">&quot;=&quot;</span>).split(str);</span><br><span class=\"line\">  assertEquals(<span class=\"number\">3</span>, map.size());</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;v1&quot;</span>, map.get(<span class=\"string\">&quot;k1&quot;</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Splitter fixed length</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testSplitterFixedLength</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;aaaabbbbccccdddd&quot;</span>;</span><br><span class=\"line\">  List&lt;String&gt; list = Splitter.fixedLength(<span class=\"number\">4</span>).splitToList(str);</span><br><span class=\"line\">  assertEquals(<span class=\"number\">4</span>, list.size());</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;aaaa&quot;</span>, list.get(<span class=\"number\">0</span>));</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;dddd&quot;</span>, list.get(<span class=\"number\">3</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Splitter常见用法\"><a href=\"#Splitter常见用法\" class=\"headerlink\" title=\"Splitter常见用法\"></a>Splitter常见用法</h1><h2 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testSplitter</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;java#python#golang#default&quot;</span>;</span><br><span class=\"line\">  List&lt;String&gt; list = Splitter.on(<span class=\"string\">&quot;#&quot;</span>).splitToList(str);</span><br><span class=\"line\">  assertEquals(<span class=\"number\">4</span>, list.size());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Omit-empty-strings\"><a href=\"#Omit-empty-strings\" class=\"headerlink\" title=\"Omit empty strings\"></a>Omit empty strings</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testSplitterOmitEmptyStrings</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;java#python#golang#&quot;</span>;</span><br><span class=\"line\">  List&lt;String&gt; list = Splitter.on(<span class=\"string\">&quot;#&quot;</span>).omitEmptyStrings().splitToList(str);</span><br><span class=\"line\">  assertEquals(<span class=\"number\">3</span>, list.size());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Splitter-limit\"><a href=\"#Splitter-limit\" class=\"headerlink\" title=\"Splitter limit\"></a>Splitter limit</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testSplitterLimit</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;java#python#golang#&quot;</span>;</span><br><span class=\"line\">  List&lt;String&gt; list = Splitter.on(<span class=\"string\">&quot;#&quot;</span>).limit(<span class=\"number\">2</span>).splitToList(str);</span><br><span class=\"line\">  assertEquals(<span class=\"number\">2</span>, list.size());</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;python#golang#&quot;</span>, list.get(<span class=\"number\">1</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Splitter-map\"><a href=\"#Splitter-map\" class=\"headerlink\" title=\"Splitter map\"></a>Splitter map</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testSplitterMap</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;k1=v1&amp;k2=v2&amp;k3=v3&quot;</span>;</span><br><span class=\"line\">  Map&lt;String,String&gt; map = Splitter.on(<span class=\"string\">&quot;&amp;&quot;</span>).withKeyValueSeparator(<span class=\"string\">&quot;=&quot;</span>).split(str);</span><br><span class=\"line\">  assertEquals(<span class=\"number\">3</span>, map.size());</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;v1&quot;</span>, map.get(<span class=\"string\">&quot;k1&quot;</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>Splitter fixed length</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> <span class=\"title function_\">testSplitterFixedLength</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;aaaabbbbccccdddd&quot;</span>;</span><br><span class=\"line\">  List&lt;String&gt; list = Splitter.fixedLength(<span class=\"number\">4</span>).splitToList(str);</span><br><span class=\"line\">  assertEquals(<span class=\"number\">4</span>, list.size());</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;aaaa&quot;</span>, list.get(<span class=\"number\">0</span>));</span><br><span class=\"line\">  assertEquals(<span class=\"string\">&quot;dddd&quot;</span>, list.get(<span class=\"number\">3</span>));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf2107-c0ab-11ec-92a1-7557b2313227","title":"Guava Strings","abbrlink":"4d4be014","_content":"\n# Strings\n\n字符串相关处理工具\n\n## 类方法\n\n| S.N  | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | public static String nullToEmpty(@Nullable String string)    |\n| 2    | public static @Nullable String emptyToNull(@Nullable String string) |\n| 3    | public static boolean isNullOrEmpty(@Nullable String string) |\n| 4    | public static String padStart(String string, int minLength, char padChar) |\n| 5    | public static String padEnd(String string, int minLength, char padChar) |\n| 6    | public static String repeat(String string, int count)        |\n| 7    | public static String commonPrefix(CharSequence a, CharSequence b) |\n| 8    | public static String commonSuffix(CharSequence a, CharSequence b) |\n| 9    | public static String lenientFormat(@Nullable String template, @Nullable Object @Nullable ... args) |\n","source":"_posts/guava/Strings.md","raw":"---\nuuid: bbaf2107-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Strings\ncategories: Java\ntags:\n  - guava\nabbrlink: 4d4be014\n---\n\n# Strings\n\n字符串相关处理工具\n\n## 类方法\n\n| S.N  | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | public static String nullToEmpty(@Nullable String string)    |\n| 2    | public static @Nullable String emptyToNull(@Nullable String string) |\n| 3    | public static boolean isNullOrEmpty(@Nullable String string) |\n| 4    | public static String padStart(String string, int minLength, char padChar) |\n| 5    | public static String padEnd(String string, int minLength, char padChar) |\n| 6    | public static String repeat(String string, int count)        |\n| 7    | public static String commonPrefix(CharSequence a, CharSequence b) |\n| 8    | public static String commonSuffix(CharSequence a, CharSequence b) |\n| 9    | public static String lenientFormat(@Nullable String template, @Nullable Object @Nullable ... args) |\n","slug":"guava/Strings","published":1,"date":"2022-04-20T12:41:20.842Z","updated":"2022-05-04T03:17:48.528Z","_id":"cl2qzfthu002z13no2wy0df2m","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Strings\"><a href=\"#Strings\" class=\"headerlink\" title=\"Strings\"></a>Strings</h1><p>字符串相关处理工具</p>\n<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>public static String nullToEmpty(@Nullable String string)</td>\n</tr>\n<tr>\n<td>2</td>\n<td>public static @Nullable String emptyToNull(@Nullable String string)</td>\n</tr>\n<tr>\n<td>3</td>\n<td>public static boolean isNullOrEmpty(@Nullable String string)</td>\n</tr>\n<tr>\n<td>4</td>\n<td>public static String padStart(String string, int minLength, char padChar)</td>\n</tr>\n<tr>\n<td>5</td>\n<td>public static String padEnd(String string, int minLength, char padChar)</td>\n</tr>\n<tr>\n<td>6</td>\n<td>public static String repeat(String string, int count)</td>\n</tr>\n<tr>\n<td>7</td>\n<td>public static String commonPrefix(CharSequence a, CharSequence b)</td>\n</tr>\n<tr>\n<td>8</td>\n<td>public static String commonSuffix(CharSequence a, CharSequence b)</td>\n</tr>\n<tr>\n<td>9</td>\n<td>public static String lenientFormat(@Nullable String template, @Nullable Object @Nullable … args)</td>\n</tr>\n</tbody></table>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Strings\"><a href=\"#Strings\" class=\"headerlink\" title=\"Strings\"></a>Strings</h1><p>字符串相关处理工具</p>\n<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>public static String nullToEmpty(@Nullable String string)</td>\n</tr>\n<tr>\n<td>2</td>\n<td>public static @Nullable String emptyToNull(@Nullable String string)</td>\n</tr>\n<tr>\n<td>3</td>\n<td>public static boolean isNullOrEmpty(@Nullable String string)</td>\n</tr>\n<tr>\n<td>4</td>\n<td>public static String padStart(String string, int minLength, char padChar)</td>\n</tr>\n<tr>\n<td>5</td>\n<td>public static String padEnd(String string, int minLength, char padChar)</td>\n</tr>\n<tr>\n<td>6</td>\n<td>public static String repeat(String string, int count)</td>\n</tr>\n<tr>\n<td>7</td>\n<td>public static String commonPrefix(CharSequence a, CharSequence b)</td>\n</tr>\n<tr>\n<td>8</td>\n<td>public static String commonSuffix(CharSequence a, CharSequence b)</td>\n</tr>\n<tr>\n<td>9</td>\n<td>public static String lenientFormat(@Nullable String template, @Nullable Object @Nullable … args)</td>\n</tr>\n</tbody></table>\n"},{"uuid":"bbaf2108-c0ab-11ec-92a1-7557b2313227","title":"Guava Suppliers","abbrlink":"e620e81e","_content":"\n## 类方法\n\n| S.N  | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | static <F, T> Supplier<T> compose(Function<? super F, T> function, Supplier<F> supplier) |\n| 2    | static <T> Supplier<T> memoize(Supplier<T> delegate)         |\n| 3    | static <T> Supplier<T> memoizeWithExpiration                 |\n| 4    | static <T> Supplier<T> ofInstance(@Nullable T instance)      |\n| 5    | static <T> Supplier<T> synchronizedSupplier(Supplier<T> delegate) |\n| 6    | static <T> Function<Supplier<T>, T> supplierFunction()       |\n","source":"_posts/guava/Suppliers.md","raw":"---\nuuid: bbaf2108-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Suppliers\ncategories: Java\ntags:\n  - guava\nabbrlink: e620e81e\n---\n\n## 类方法\n\n| S.N  | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | static <F, T> Supplier<T> compose(Function<? super F, T> function, Supplier<F> supplier) |\n| 2    | static <T> Supplier<T> memoize(Supplier<T> delegate)         |\n| 3    | static <T> Supplier<T> memoizeWithExpiration                 |\n| 4    | static <T> Supplier<T> ofInstance(@Nullable T instance)      |\n| 5    | static <T> Supplier<T> synchronizedSupplier(Supplier<T> delegate) |\n| 6    | static <T> Function<Supplier<T>, T> supplierFunction()       |\n","slug":"guava/Suppliers","published":1,"date":"2022-04-20T12:41:20.864Z","updated":"2022-05-04T03:17:55.473Z","_id":"cl2qzfthv003413no8lqqarrq","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>static &lt;F, T&gt; Supplier<T> compose(Function&lt;? super F, T&gt; function, Supplier<F> supplier)</td>\n</tr>\n<tr>\n<td>2</td>\n<td>static <T> Supplier<T> memoize(Supplier<T> delegate)</td>\n</tr>\n<tr>\n<td>3</td>\n<td>static <T> Supplier<T> memoizeWithExpiration</td>\n</tr>\n<tr>\n<td>4</td>\n<td>static <T> Supplier<T> ofInstance(@Nullable T instance)</td>\n</tr>\n<tr>\n<td>5</td>\n<td>static <T> Supplier<T> synchronizedSupplier(Supplier<T> delegate)</td>\n</tr>\n<tr>\n<td>6</td>\n<td>static <T> Function&lt;Supplier<T>, T&gt; supplierFunction()</td>\n</tr>\n</tbody></table>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td>static &lt;F, T&gt; Supplier<T> compose(Function&lt;? super F, T&gt; function, Supplier<F> supplier)</td>\n</tr>\n<tr>\n<td>2</td>\n<td>static <T> Supplier<T> memoize(Supplier<T> delegate)</td>\n</tr>\n<tr>\n<td>3</td>\n<td>static <T> Supplier<T> memoizeWithExpiration</td>\n</tr>\n<tr>\n<td>4</td>\n<td>static <T> Supplier<T> ofInstance(@Nullable T instance)</td>\n</tr>\n<tr>\n<td>5</td>\n<td>static <T> Supplier<T> synchronizedSupplier(Supplier<T> delegate)</td>\n</tr>\n<tr>\n<td>6</td>\n<td>static <T> Function&lt;Supplier<T>, T&gt; supplierFunction()</td>\n</tr>\n</tbody></table>\n"},{"uuid":"bbaf2109-c0ab-11ec-92a1-7557b2313227","title":"Guava Throwables","abbrlink":"43913d08","_content":"\n# Guava Throwables类\n\nThrowable类提供了相关的Throwable接口的实用方法。\n\n## \t类声明\n\n以下是com.google.common.base.Throwables类的声明：\n\n```java\npublic final class Throwables extends Object\n```\n\n## \t类方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **static List<Throwable> getCausalChain(Throwable throwable)**  \t\t\t获取一个Throwable的原因链的列表。 |\n| 2    | **static Throwable getRootCause(Throwable throwable)**  \t\t\t返回抛出的最里面的原因。 |\n| 3    | **static String getStackTraceAsString(Throwable throwable)**  \t\t\t返回包含toString()的结果字符串，随后完整抛出，递归的堆栈跟踪。 |\n| 4    | **static RuntimeException propagate(Throwable throwable)**  \t\t\t传播抛出原样如果RuntimeException或Error是一个实例，否则作为最后的报告，把它包装在一个RuntimeException，然后传播。 |\n| 5    | **static <X extends Throwable> void propagateIfInstanceOf(Throwable throwable, Class<X> declaredType)**  \t\t\t传播抛出对象完全按原样，当且仅当它是declaredType的一个实例。 |\n| 6    | **static void propagateIfPossible(Throwable throwable)**  \t\t\t传播抛出对象完全按原样，当且仅当它是RuntimeException或Error的一个实例。 |\n| 7    | **static <X extends Throwable> void propagateIfPossible(Throwable throwable, Class<X> declaredType)**  \t\t\t传播抛出对象完全按原样，当且仅当它是RuntimeException，错误或的declaredType的一个实例。 |\n| 8    | **static <X1 extends Throwable,X2 extends Throwable>void propagateIfPossible(Throwable throwable, Class<X1> declaredType1, Class<X2> declaredType2)**  \t\t\t传播抛出对象完全按原样，当且仅当它是RuntimeException，Error，declaredType1或declaredType2的一个实例。 |\n\n## 继承的方法\n\n这个类继承了以下类方法：\n\n- java.lang.Object\n\n## Throwables示例\n\n创建使用所选择的任何编辑器下面的java程序，比如 **C:/> Guava**\n\n*GuavaTester.java*\n\n```java\nimport java.io.IOException;\n\nimport com.google.common.base.Objects;\nimport com.google.common.base.Throwables;\n\npublic class GuavaTester {\n   public static void main(String args[]){\n      GuavaTester tester = new GuavaTester();\n      try {\n         tester.showcaseThrowables();\n      } catch (InvalidInputException e) {\n         //get the root cause\n         System.out.println(Throwables.getRootCause(e));\n      }catch (Exception e) {\n         //get the stack trace in string format\n         System.out.println(Throwables.getStackTraceAsString(e));\t\t\t\t\n      }\n\n      try {\n         tester.showcaseThrowables1();\t\t\t\n      }catch (Exception e) {\n         System.out.println(Throwables.getStackTraceAsString(e));\t\t\t\t\n      }\n   }\n\n   public void showcaseThrowables() throws InvalidInputException{\n      try {\n         sqrt(-3.0);\t\t\t\n      } catch (Throwable e) {\n         //check the type of exception and throw it\n         Throwables.propagateIfInstanceOf(e, InvalidInputException.class);\t\t\n         Throwables.propagate(e);\n      }\t\n   }\n\n   public void showcaseThrowables1(){\n      try {\t\t\t\n         int[] data = {1,2,3}; \n         getValue(data, 4);\t\t\t\n      } catch (Throwable e) {        \n         Throwables.propagateIfInstanceOf(e, IndexOutOfBoundsException.class);\t\t\n         Throwables.propagate(e);\n      }\t\n   }\n\n   public double sqrt(double input) throws InvalidInputException{\n      if(input < 0) throw new InvalidInputException();\n      return Math.sqrt(input);\n   }\n\n   public double getValue(int[] list, int index) throws IndexOutOfBoundsException {\n      return list[index];\n   }\n\n   public void dummyIO() throws IOException {\n      throw new IOException();\n   }\n}\n\nclass InvalidInputException extends Exception {\n}\n```\n","source":"_posts/guava/Throwables.md","raw":"---\nuuid: bbaf2109-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Throwables\ncategories: Java\ntags:\n  - guava\nabbrlink: 43913d08\n---\n\n# Guava Throwables类\n\nThrowable类提供了相关的Throwable接口的实用方法。\n\n## \t类声明\n\n以下是com.google.common.base.Throwables类的声明：\n\n```java\npublic final class Throwables extends Object\n```\n\n## \t类方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **static List<Throwable> getCausalChain(Throwable throwable)**  \t\t\t获取一个Throwable的原因链的列表。 |\n| 2    | **static Throwable getRootCause(Throwable throwable)**  \t\t\t返回抛出的最里面的原因。 |\n| 3    | **static String getStackTraceAsString(Throwable throwable)**  \t\t\t返回包含toString()的结果字符串，随后完整抛出，递归的堆栈跟踪。 |\n| 4    | **static RuntimeException propagate(Throwable throwable)**  \t\t\t传播抛出原样如果RuntimeException或Error是一个实例，否则作为最后的报告，把它包装在一个RuntimeException，然后传播。 |\n| 5    | **static <X extends Throwable> void propagateIfInstanceOf(Throwable throwable, Class<X> declaredType)**  \t\t\t传播抛出对象完全按原样，当且仅当它是declaredType的一个实例。 |\n| 6    | **static void propagateIfPossible(Throwable throwable)**  \t\t\t传播抛出对象完全按原样，当且仅当它是RuntimeException或Error的一个实例。 |\n| 7    | **static <X extends Throwable> void propagateIfPossible(Throwable throwable, Class<X> declaredType)**  \t\t\t传播抛出对象完全按原样，当且仅当它是RuntimeException，错误或的declaredType的一个实例。 |\n| 8    | **static <X1 extends Throwable,X2 extends Throwable>void propagateIfPossible(Throwable throwable, Class<X1> declaredType1, Class<X2> declaredType2)**  \t\t\t传播抛出对象完全按原样，当且仅当它是RuntimeException，Error，declaredType1或declaredType2的一个实例。 |\n\n## 继承的方法\n\n这个类继承了以下类方法：\n\n- java.lang.Object\n\n## Throwables示例\n\n创建使用所选择的任何编辑器下面的java程序，比如 **C:/> Guava**\n\n*GuavaTester.java*\n\n```java\nimport java.io.IOException;\n\nimport com.google.common.base.Objects;\nimport com.google.common.base.Throwables;\n\npublic class GuavaTester {\n   public static void main(String args[]){\n      GuavaTester tester = new GuavaTester();\n      try {\n         tester.showcaseThrowables();\n      } catch (InvalidInputException e) {\n         //get the root cause\n         System.out.println(Throwables.getRootCause(e));\n      }catch (Exception e) {\n         //get the stack trace in string format\n         System.out.println(Throwables.getStackTraceAsString(e));\t\t\t\t\n      }\n\n      try {\n         tester.showcaseThrowables1();\t\t\t\n      }catch (Exception e) {\n         System.out.println(Throwables.getStackTraceAsString(e));\t\t\t\t\n      }\n   }\n\n   public void showcaseThrowables() throws InvalidInputException{\n      try {\n         sqrt(-3.0);\t\t\t\n      } catch (Throwable e) {\n         //check the type of exception and throw it\n         Throwables.propagateIfInstanceOf(e, InvalidInputException.class);\t\t\n         Throwables.propagate(e);\n      }\t\n   }\n\n   public void showcaseThrowables1(){\n      try {\t\t\t\n         int[] data = {1,2,3}; \n         getValue(data, 4);\t\t\t\n      } catch (Throwable e) {        \n         Throwables.propagateIfInstanceOf(e, IndexOutOfBoundsException.class);\t\t\n         Throwables.propagate(e);\n      }\t\n   }\n\n   public double sqrt(double input) throws InvalidInputException{\n      if(input < 0) throw new InvalidInputException();\n      return Math.sqrt(input);\n   }\n\n   public double getValue(int[] list, int index) throws IndexOutOfBoundsException {\n      return list[index];\n   }\n\n   public void dummyIO() throws IOException {\n      throw new IOException();\n   }\n}\n\nclass InvalidInputException extends Exception {\n}\n```\n","slug":"guava/Throwables","published":1,"date":"2022-04-20T12:41:20.871Z","updated":"2022-05-04T03:18:09.898Z","_id":"cl2qzfthw003613no8yus3vnm","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Guava-Throwables类\"><a href=\"#Guava-Throwables类\" class=\"headerlink\" title=\"Guava Throwables类\"></a>Guava Throwables类</h1><p>Throwable类提供了相关的Throwable接口的实用方法。</p>\n<h2 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h2><p>以下是com.google.common.base.Throwables类的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Throwables</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Object</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>static List<Throwable> getCausalChain(Throwable throwable)</strong>              获取一个Throwable的原因链的列表。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>static Throwable getRootCause(Throwable throwable)</strong>              返回抛出的最里面的原因。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>static String getStackTraceAsString(Throwable throwable)</strong>              返回包含toString()的结果字符串，随后完整抛出，递归的堆栈跟踪。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>static RuntimeException propagate(Throwable throwable)</strong>              传播抛出原样如果RuntimeException或Error是一个实例，否则作为最后的报告，把它包装在一个RuntimeException，然后传播。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>static <X extends Throwable> void propagateIfInstanceOf(Throwable throwable, Class<X> declaredType)</strong>              传播抛出对象完全按原样，当且仅当它是declaredType的一个实例。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>static void propagateIfPossible(Throwable throwable)</strong>              传播抛出对象完全按原样，当且仅当它是RuntimeException或Error的一个实例。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>static <X extends Throwable> void propagateIfPossible(Throwable throwable, Class<X> declaredType)</strong>              传播抛出对象完全按原样，当且仅当它是RuntimeException，错误或的declaredType的一个实例。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>static &lt;X1 extends Throwable,X2 extends Throwable&gt;void propagateIfPossible(Throwable throwable, Class<X1> declaredType1, Class<X2> declaredType2)</strong>              传播抛出对象完全按原样，当且仅当它是RuntimeException，Error，declaredType1或declaredType2的一个实例。</td>\n</tr>\n</tbody></table>\n<h2 id=\"继承的方法\"><a href=\"#继承的方法\" class=\"headerlink\" title=\"继承的方法\"></a>继承的方法</h2><p>这个类继承了以下类方法：</p>\n<ul>\n<li>java.lang.Object</li>\n</ul>\n<h2 id=\"Throwables示例\"><a href=\"#Throwables示例\" class=\"headerlink\" title=\"Throwables示例\"></a>Throwables示例</h2><p>创建使用所选择的任何编辑器下面的java程序，比如 <strong>C:/&gt; Guava</strong></p>\n<p><em>GuavaTester.java</em></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.base.Objects;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.base.Throwables;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"type\">GuavaTester</span> <span class=\"variable\">tester</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">GuavaTester</span>();</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">         tester.showcaseThrowables();</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (InvalidInputException e) &#123;</span><br><span class=\"line\">         <span class=\"comment\">//get the root cause</span></span><br><span class=\"line\">         System.out.println(Throwables.getRootCause(e));</span><br><span class=\"line\">      &#125;<span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">         <span class=\"comment\">//get the stack trace in string format</span></span><br><span class=\"line\">         System.out.println(Throwables.getStackTraceAsString(e));\t\t\t\t</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">         tester.showcaseThrowables1();\t\t\t</span><br><span class=\"line\">      &#125;<span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">         System.out.println(Throwables.getStackTraceAsString(e));\t\t\t\t</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">showcaseThrowables</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InvalidInputException&#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">         sqrt(-<span class=\"number\">3.0</span>);\t\t\t</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (Throwable e) &#123;</span><br><span class=\"line\">         <span class=\"comment\">//check the type of exception and throw it</span></span><br><span class=\"line\">         Throwables.propagateIfInstanceOf(e, InvalidInputException.class);\t\t</span><br><span class=\"line\">         Throwables.propagate(e);</span><br><span class=\"line\">      &#125;\t</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">showcaseThrowables1</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;\t\t\t</span><br><span class=\"line\">         <span class=\"type\">int</span>[] data = &#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>&#125;; </span><br><span class=\"line\">         getValue(data, <span class=\"number\">4</span>);\t\t\t</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (Throwable e) &#123;        </span><br><span class=\"line\">         Throwables.propagateIfInstanceOf(e, IndexOutOfBoundsException.class);\t\t</span><br><span class=\"line\">         Throwables.propagate(e);</span><br><span class=\"line\">      &#125;\t</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">sqrt</span><span class=\"params\">(<span class=\"type\">double</span> input)</span> <span class=\"keyword\">throws</span> InvalidInputException&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(input &lt; <span class=\"number\">0</span>) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InvalidInputException</span>();</span><br><span class=\"line\">      <span class=\"keyword\">return</span> Math.sqrt(input);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">getValue</span><span class=\"params\">(<span class=\"type\">int</span>[] list, <span class=\"type\">int</span> index)</span> <span class=\"keyword\">throws</span> IndexOutOfBoundsException &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> list[index];</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">dummyIO</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IOException</span>();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">InvalidInputException</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Exception</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Guava-Throwables类\"><a href=\"#Guava-Throwables类\" class=\"headerlink\" title=\"Guava Throwables类\"></a>Guava Throwables类</h1><p>Throwable类提供了相关的Throwable接口的实用方法。</p>\n<h2 id=\"类声明\"><a href=\"#类声明\" class=\"headerlink\" title=\"类声明\"></a>类声明</h2><p>以下是com.google.common.base.Throwables类的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Throwables</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Object</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"类方法\"><a href=\"#类方法\" class=\"headerlink\" title=\"类方法\"></a>类方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>static List<Throwable> getCausalChain(Throwable throwable)</strong>              获取一个Throwable的原因链的列表。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>static Throwable getRootCause(Throwable throwable)</strong>              返回抛出的最里面的原因。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>static String getStackTraceAsString(Throwable throwable)</strong>              返回包含toString()的结果字符串，随后完整抛出，递归的堆栈跟踪。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>static RuntimeException propagate(Throwable throwable)</strong>              传播抛出原样如果RuntimeException或Error是一个实例，否则作为最后的报告，把它包装在一个RuntimeException，然后传播。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>static <X extends Throwable> void propagateIfInstanceOf(Throwable throwable, Class<X> declaredType)</strong>              传播抛出对象完全按原样，当且仅当它是declaredType的一个实例。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>static void propagateIfPossible(Throwable throwable)</strong>              传播抛出对象完全按原样，当且仅当它是RuntimeException或Error的一个实例。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>static <X extends Throwable> void propagateIfPossible(Throwable throwable, Class<X> declaredType)</strong>              传播抛出对象完全按原样，当且仅当它是RuntimeException，错误或的declaredType的一个实例。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>static &lt;X1 extends Throwable,X2 extends Throwable&gt;void propagateIfPossible(Throwable throwable, Class<X1> declaredType1, Class<X2> declaredType2)</strong>              传播抛出对象完全按原样，当且仅当它是RuntimeException，Error，declaredType1或declaredType2的一个实例。</td>\n</tr>\n</tbody></table>\n<h2 id=\"继承的方法\"><a href=\"#继承的方法\" class=\"headerlink\" title=\"继承的方法\"></a>继承的方法</h2><p>这个类继承了以下类方法：</p>\n<ul>\n<li>java.lang.Object</li>\n</ul>\n<h2 id=\"Throwables示例\"><a href=\"#Throwables示例\" class=\"headerlink\" title=\"Throwables示例\"></a>Throwables示例</h2><p>创建使用所选择的任何编辑器下面的java程序，比如 <strong>C:/&gt; Guava</strong></p>\n<p><em>GuavaTester.java</em></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.base.Objects;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.base.Throwables;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"type\">GuavaTester</span> <span class=\"variable\">tester</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">GuavaTester</span>();</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">         tester.showcaseThrowables();</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (InvalidInputException e) &#123;</span><br><span class=\"line\">         <span class=\"comment\">//get the root cause</span></span><br><span class=\"line\">         System.out.println(Throwables.getRootCause(e));</span><br><span class=\"line\">      &#125;<span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">         <span class=\"comment\">//get the stack trace in string format</span></span><br><span class=\"line\">         System.out.println(Throwables.getStackTraceAsString(e));\t\t\t\t</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">         tester.showcaseThrowables1();\t\t\t</span><br><span class=\"line\">      &#125;<span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">         System.out.println(Throwables.getStackTraceAsString(e));\t\t\t\t</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">showcaseThrowables</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> InvalidInputException&#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">         sqrt(-<span class=\"number\">3.0</span>);\t\t\t</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (Throwable e) &#123;</span><br><span class=\"line\">         <span class=\"comment\">//check the type of exception and throw it</span></span><br><span class=\"line\">         Throwables.propagateIfInstanceOf(e, InvalidInputException.class);\t\t</span><br><span class=\"line\">         Throwables.propagate(e);</span><br><span class=\"line\">      &#125;\t</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">showcaseThrowables1</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">      <span class=\"keyword\">try</span> &#123;\t\t\t</span><br><span class=\"line\">         <span class=\"type\">int</span>[] data = &#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>&#125;; </span><br><span class=\"line\">         getValue(data, <span class=\"number\">4</span>);\t\t\t</span><br><span class=\"line\">      &#125; <span class=\"keyword\">catch</span> (Throwable e) &#123;        </span><br><span class=\"line\">         Throwables.propagateIfInstanceOf(e, IndexOutOfBoundsException.class);\t\t</span><br><span class=\"line\">         Throwables.propagate(e);</span><br><span class=\"line\">      &#125;\t</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">sqrt</span><span class=\"params\">(<span class=\"type\">double</span> input)</span> <span class=\"keyword\">throws</span> InvalidInputException&#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span>(input &lt; <span class=\"number\">0</span>) <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InvalidInputException</span>();</span><br><span class=\"line\">      <span class=\"keyword\">return</span> Math.sqrt(input);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"type\">double</span> <span class=\"title function_\">getValue</span><span class=\"params\">(<span class=\"type\">int</span>[] list, <span class=\"type\">int</span> index)</span> <span class=\"keyword\">throws</span> IndexOutOfBoundsException &#123;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> list[index];</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">dummyIO</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">      <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IOException</span>();</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">InvalidInputException</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Exception</span> &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf210b-c0ab-11ec-92a1-7557b2313227","title":"SPI之autoservice","abbrlink":"da2c766e","_content":"\n\n之前提到SPI需要在/META-INF/service路径下，以对应api为文件名具体实现类为内容的文件，这样做比较麻烦。我们可以利用Google Auto Service是如何利用Annotation Processor来帮助实现SPI的。\n\n具体实现如下：\n\n引入依赖\n\n```xml\n<dependency>\n  <groupId>com.google.auto.service</groupId>\n  <artifactId>auto-service</artifactId>\n  <version>1.0</version>\n  <optional>true</optional>\n</dependency>\n```\n\n```java\n@AutoService(StandardService.class)\npublic class CStandardServiceImpl implements StandardService {\n    @Override\n    public void offerService() {\n        System.out.println(\"c service\");\n    }\n}\n```\n\n我们分析下其中的具体实现。\n\n首先看一下auto-service-annotation库，只有一个AutoService注解定义，其value值即为SPI的服务接口类，如下所示：\n\n```java\n\n/**\n * An annotation for service providers as described in {@link java.util.ServiceLoader}. The\n * annotation processor generates the configuration files that allow the annotated class to be\n * loaded with {@link java.util.ServiceLoader#load(Class)}.\n *\n * <p>The annotated class must conform to the service provider specification. Specifically, it must:\n *\n * <ul>\n *   <li>be a non-inner, non-anonymous, concrete class\n *   <li>have a publicly accessible no-arg constructor\n *   <li>implement the interface type returned by {@code value()}\n * </ul>\n */\n@Documented\n@Retention(CLASS)\n@Target(TYPE)\npublic @interface AutoService {\n  /** Returns the interfaces implemented by this service provider. */\n  Class<?>[] value();\n}\n\n```\n\n可以看出，其注解仅保留于源码级别，用于编译时Annotation Processor的源码分析，并利用分析结果进行META-INF/services下的服务文件生成。\n\n 仅接着，就要正式看一下auto-service的具体实现了，核心代码主要就是AutoServiceProcessor.java以及熟悉的META-INF/services/javax.annotation.processing.Processor服务文件。看过上节的人可能就要说了这是SPI，然而实际并非如此，这实际上是Annotation Processor的实现格式。\n\n Annotation Processor的代码实现核心包括一个实现Processor接口的类（一般继承AbstractProcessor抽象类）和一个Processor服务文件（内容就是实现类，例如AutoService的实现类com.google.auto.service.processor.AutoServiceProcessor）。虽然和SPI类似，甚至在实现方式上可以看成是Processor接口的SPI服务，但是SPI属于运行时，Annotation Processor属于编译时行为，两者还是有本质区别的。\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191602916.png)\n\n如上引用一个比较经典的图，Javac的Annotation Processing实际上是一个循环的过程，在每一轮（Round）结束后，编译器会判断是否有新的代码生成，如有则进入下一轮分析新代码并调用注解处理器，如无代码生成，此时会再进行最后一轮，通知Annotation Processor处理结束，大家需要特别注意这最后一轮的概念。\n\n接下来就看看AutoServiceProcessor是如何实现的：\n\n1. getSupportedAnnotationType：该方法返回值表示了注解处理器所处理的注解类型，AutoServiceProvider当然就是AutoService注解；除了覆写该方法外，还可以通过@SupportedAnnotationTypes注解来替代。\n\n   ~~~java\n   @Override\n   public ImmutableSet<String> getSupportedAnnotationTypes() {\n       return ImmutableSet.of(AutoService.class.getName());\n   }\n   ~~~\n\n2. getSupportedSourceVersion：该方法返回值表示了注解处理器所支持的最新JDK版本，同样也可使用@SupportedSourceVersion来替代。 \n\n   ```java\n   @Override\n   public SourceVersion getSupportedSourceVersion() {\n       return SourceVersion.latestSupported();\n   }\n   ```\n\n3. 此外在AutoServiceProcessor类上还有一个不容忽视的注解@SupportedOptions，它也一样有一个相同的方法getSupportedOptions，该注解表示所支持的javac编译参数选项，在javac中可以通过-Akey[=value]这种方式指定该参数选项，但是实际上如果不指定@SupportedOptions，而传入了该参数，javac编译器会提示警告信息：\n   AutoServiceProcessor提供了debug和verify两个选项，debug选项传入时（-Adebug），会开启Debug日志，如下所示：\n\n   ```java\n   private void log(String msg) {\n       if (processingEnv.getOptions().containsKey(\"debug\")) {\n           processingEnv.getMessager().printMessage(Kind.NOTE, msg);\n       }\n   }\n   ```\n\n    而verify则表示是否强制检查@AutoService的标注类和@AutoService的value所对应的服务接口是否实现关系。\n\n4. 还有一个比较重要的成员变量processingEnv，它在AbstractProcessor的init方法中传入，实际上就是编译期上下文工具级，除了上述示例中getOptions方法获取编译选项、getMessager方法获取消息对象用于消息打印（如下所示）外；此外还有一个getFiler方法获取Filer对象，用于生成源文件、class文件和辅助文件，可以说是Annotation Processor的核心，后续生成服务文件时将会用到，此外还有getTypeUtils和getElementUtils等代码工具类。\n\n5. 最为核心的就是process方法（如下所示），其返回值表示该注解的处理是否继续传给后续的注册处理器，入参annotations和我们之前所定义的getSupportedAnnotationTypes相对应，RoundEnvironment就表示每一轮注解处理的上下文环境（看一下直接的注解处理流程图就明白了），代码实现很清晰，AutoService先收集每一轮的代码信息，判断其标签并缓存待生成的服务文件信息，直到最后一轮没有新代码生成时，开始生成或更新服务配置文件。\n\n   ```java\n   private boolean processImpl(Set<? extends TypeElement> annotations, RoundEnvironment roundEnv) {\n       if (roundEnv.processingOver()) {\n           generateConfigFiles();\n       } else {\n           processAnnotations(annotations, roundEnv);\n       }\n       return true;\n   }\n   ```\n\n6. 而processAnnotations是如何收集信息的呢？也很简单，就是找到每一轮的所有AutoService标注的类文件，并获取各个类文件中@AutoService里面标注的服务接口，将服务接口名和服务实现类名称缓存值Multimap中\n\n7. 最后，根据Multimap中的信息，生成META-INF/services下服务文件，而生成的核心方法就是使用Filer，具体逻辑带大家简单看一下，首先是检查是否已有META-INF/services/下对应的服务文件，如果有则将其内容读取并缓存值列表中(allServices)：\n\n\n\n总的说来AutoService实现还是很简单的，利用Annotation Processor机制为各个SPI服务以及Annotation Processor生成META-INF/services文件下的服务文件，但是确实是理解Annotation Processor机制的比较好的入门方式。目前还没有涉及到代码的生成，接下来的章节就将看看如何在注解处理器中生成代码。\n","source":"_posts/java/spi之autoservice.md","raw":"---\nuuid: bbaf210b-c0ab-11ec-92a1-7557b2313227\ntitle: SPI之autoservice\ncategories: Java\ntags:\n  - spi\nabbrlink: da2c766e\n---\n\n\n之前提到SPI需要在/META-INF/service路径下，以对应api为文件名具体实现类为内容的文件，这样做比较麻烦。我们可以利用Google Auto Service是如何利用Annotation Processor来帮助实现SPI的。\n\n具体实现如下：\n\n引入依赖\n\n```xml\n<dependency>\n  <groupId>com.google.auto.service</groupId>\n  <artifactId>auto-service</artifactId>\n  <version>1.0</version>\n  <optional>true</optional>\n</dependency>\n```\n\n```java\n@AutoService(StandardService.class)\npublic class CStandardServiceImpl implements StandardService {\n    @Override\n    public void offerService() {\n        System.out.println(\"c service\");\n    }\n}\n```\n\n我们分析下其中的具体实现。\n\n首先看一下auto-service-annotation库，只有一个AutoService注解定义，其value值即为SPI的服务接口类，如下所示：\n\n```java\n\n/**\n * An annotation for service providers as described in {@link java.util.ServiceLoader}. The\n * annotation processor generates the configuration files that allow the annotated class to be\n * loaded with {@link java.util.ServiceLoader#load(Class)}.\n *\n * <p>The annotated class must conform to the service provider specification. Specifically, it must:\n *\n * <ul>\n *   <li>be a non-inner, non-anonymous, concrete class\n *   <li>have a publicly accessible no-arg constructor\n *   <li>implement the interface type returned by {@code value()}\n * </ul>\n */\n@Documented\n@Retention(CLASS)\n@Target(TYPE)\npublic @interface AutoService {\n  /** Returns the interfaces implemented by this service provider. */\n  Class<?>[] value();\n}\n\n```\n\n可以看出，其注解仅保留于源码级别，用于编译时Annotation Processor的源码分析，并利用分析结果进行META-INF/services下的服务文件生成。\n\n 仅接着，就要正式看一下auto-service的具体实现了，核心代码主要就是AutoServiceProcessor.java以及熟悉的META-INF/services/javax.annotation.processing.Processor服务文件。看过上节的人可能就要说了这是SPI，然而实际并非如此，这实际上是Annotation Processor的实现格式。\n\n Annotation Processor的代码实现核心包括一个实现Processor接口的类（一般继承AbstractProcessor抽象类）和一个Processor服务文件（内容就是实现类，例如AutoService的实现类com.google.auto.service.processor.AutoServiceProcessor）。虽然和SPI类似，甚至在实现方式上可以看成是Processor接口的SPI服务，但是SPI属于运行时，Annotation Processor属于编译时行为，两者还是有本质区别的。\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191602916.png)\n\n如上引用一个比较经典的图，Javac的Annotation Processing实际上是一个循环的过程，在每一轮（Round）结束后，编译器会判断是否有新的代码生成，如有则进入下一轮分析新代码并调用注解处理器，如无代码生成，此时会再进行最后一轮，通知Annotation Processor处理结束，大家需要特别注意这最后一轮的概念。\n\n接下来就看看AutoServiceProcessor是如何实现的：\n\n1. getSupportedAnnotationType：该方法返回值表示了注解处理器所处理的注解类型，AutoServiceProvider当然就是AutoService注解；除了覆写该方法外，还可以通过@SupportedAnnotationTypes注解来替代。\n\n   ~~~java\n   @Override\n   public ImmutableSet<String> getSupportedAnnotationTypes() {\n       return ImmutableSet.of(AutoService.class.getName());\n   }\n   ~~~\n\n2. getSupportedSourceVersion：该方法返回值表示了注解处理器所支持的最新JDK版本，同样也可使用@SupportedSourceVersion来替代。 \n\n   ```java\n   @Override\n   public SourceVersion getSupportedSourceVersion() {\n       return SourceVersion.latestSupported();\n   }\n   ```\n\n3. 此外在AutoServiceProcessor类上还有一个不容忽视的注解@SupportedOptions，它也一样有一个相同的方法getSupportedOptions，该注解表示所支持的javac编译参数选项，在javac中可以通过-Akey[=value]这种方式指定该参数选项，但是实际上如果不指定@SupportedOptions，而传入了该参数，javac编译器会提示警告信息：\n   AutoServiceProcessor提供了debug和verify两个选项，debug选项传入时（-Adebug），会开启Debug日志，如下所示：\n\n   ```java\n   private void log(String msg) {\n       if (processingEnv.getOptions().containsKey(\"debug\")) {\n           processingEnv.getMessager().printMessage(Kind.NOTE, msg);\n       }\n   }\n   ```\n\n    而verify则表示是否强制检查@AutoService的标注类和@AutoService的value所对应的服务接口是否实现关系。\n\n4. 还有一个比较重要的成员变量processingEnv，它在AbstractProcessor的init方法中传入，实际上就是编译期上下文工具级，除了上述示例中getOptions方法获取编译选项、getMessager方法获取消息对象用于消息打印（如下所示）外；此外还有一个getFiler方法获取Filer对象，用于生成源文件、class文件和辅助文件，可以说是Annotation Processor的核心，后续生成服务文件时将会用到，此外还有getTypeUtils和getElementUtils等代码工具类。\n\n5. 最为核心的就是process方法（如下所示），其返回值表示该注解的处理是否继续传给后续的注册处理器，入参annotations和我们之前所定义的getSupportedAnnotationTypes相对应，RoundEnvironment就表示每一轮注解处理的上下文环境（看一下直接的注解处理流程图就明白了），代码实现很清晰，AutoService先收集每一轮的代码信息，判断其标签并缓存待生成的服务文件信息，直到最后一轮没有新代码生成时，开始生成或更新服务配置文件。\n\n   ```java\n   private boolean processImpl(Set<? extends TypeElement> annotations, RoundEnvironment roundEnv) {\n       if (roundEnv.processingOver()) {\n           generateConfigFiles();\n       } else {\n           processAnnotations(annotations, roundEnv);\n       }\n       return true;\n   }\n   ```\n\n6. 而processAnnotations是如何收集信息的呢？也很简单，就是找到每一轮的所有AutoService标注的类文件，并获取各个类文件中@AutoService里面标注的服务接口，将服务接口名和服务实现类名称缓存值Multimap中\n\n7. 最后，根据Multimap中的信息，生成META-INF/services下服务文件，而生成的核心方法就是使用Filer，具体逻辑带大家简单看一下，首先是检查是否已有META-INF/services/下对应的服务文件，如果有则将其内容读取并缓存值列表中(allServices)：\n\n\n\n总的说来AutoService实现还是很简单的，利用Annotation Processor机制为各个SPI服务以及Annotation Processor生成META-INF/services文件下的服务文件，但是确实是理解Annotation Processor机制的比较好的入门方式。目前还没有涉及到代码的生成，接下来的章节就将看看如何在注解处理器中生成代码。\n","slug":"java/spi之autoservice","published":1,"date":"2022-04-20T12:41:20.816Z","updated":"2022-05-04T03:19:30.087Z","_id":"cl2qzfthx003b13no1xkj8sgn","comments":1,"layout":"post","photos":[],"link":"","content":"<p>之前提到SPI需要在/META-INF/service路径下，以对应api为文件名具体实现类为内容的文件，这样做比较麻烦。我们可以利用Google Auto Service是如何利用Annotation Processor来帮助实现SPI的。</p>\n<p>具体实现如下：</p>\n<p>引入依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.google.auto.service<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>auto-service<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@AutoService(StandardService.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CStandardServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">StandardService</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">offerService</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;c service&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们分析下其中的具体实现。</p>\n<p>首先看一下auto-service-annotation库，只有一个AutoService注解定义，其value值即为SPI的服务接口类，如下所示：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * An annotation for service providers as described in &#123;<span class=\"doctag\">@link</span> java.util.ServiceLoader&#125;. The</span></span><br><span class=\"line\"><span class=\"comment\"> * annotation processor generates the configuration files that allow the annotated class to be</span></span><br><span class=\"line\"><span class=\"comment\"> * loaded with &#123;<span class=\"doctag\">@link</span> java.util.ServiceLoader#load(Class)&#125;.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;p&gt;The annotated class must conform to the service provider specification. Specifically, it must:</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;ul&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> *   &lt;li&gt;be a non-inner, non-anonymous, concrete class</span></span><br><span class=\"line\"><span class=\"comment\"> *   &lt;li&gt;have a publicly accessible no-arg constructor</span></span><br><span class=\"line\"><span class=\"comment\"> *   &lt;li&gt;implement the interface type returned by &#123;<span class=\"doctag\">@code</span> value()&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(CLASS)</span></span><br><span class=\"line\"><span class=\"meta\">@Target(TYPE)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> AutoService &#123;</span><br><span class=\"line\">  <span class=\"comment\">/** Returns the interfaces implemented by this service provider. */</span></span><br><span class=\"line\">  Class&lt;?&gt;[] value();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>可以看出，其注解仅保留于源码级别，用于编译时Annotation Processor的源码分析，并利用分析结果进行META-INF/services下的服务文件生成。</p>\n<p> 仅接着，就要正式看一下auto-service的具体实现了，核心代码主要就是AutoServiceProcessor.java以及熟悉的META-INF/services/javax.annotation.processing.Processor服务文件。看过上节的人可能就要说了这是SPI，然而实际并非如此，这实际上是Annotation Processor的实现格式。</p>\n<p> Annotation Processor的代码实现核心包括一个实现Processor接口的类（一般继承AbstractProcessor抽象类）和一个Processor服务文件（内容就是实现类，例如AutoService的实现类com.google.auto.service.processor.AutoServiceProcessor）。虽然和SPI类似，甚至在实现方式上可以看成是Processor接口的SPI服务，但是SPI属于运行时，Annotation Processor属于编译时行为，两者还是有本质区别的。<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191602916.png\"></p>\n<p>如上引用一个比较经典的图，Javac的Annotation Processing实际上是一个循环的过程，在每一轮（Round）结束后，编译器会判断是否有新的代码生成，如有则进入下一轮分析新代码并调用注解处理器，如无代码生成，此时会再进行最后一轮，通知Annotation Processor处理结束，大家需要特别注意这最后一轮的概念。</p>\n<p>接下来就看看AutoServiceProcessor是如何实现的：</p>\n<ol>\n<li><p>getSupportedAnnotationType：该方法返回值表示了注解处理器所处理的注解类型，AutoServiceProvider当然就是AutoService注解；除了覆写该方法外，还可以通过@SupportedAnnotationTypes注解来替代。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ImmutableSet&lt;String&gt; <span class=\"title function_\">getSupportedAnnotationTypes</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ImmutableSet.of(AutoService.class.getName());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>getSupportedSourceVersion：该方法返回值表示了注解处理器所支持的最新JDK版本，同样也可使用@SupportedSourceVersion来替代。 </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> SourceVersion <span class=\"title function_\">getSupportedSourceVersion</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> SourceVersion.latestSupported();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>此外在AutoServiceProcessor类上还有一个不容忽视的注解@SupportedOptions，它也一样有一个相同的方法getSupportedOptions，该注解表示所支持的javac编译参数选项，在javac中可以通过-Akey[=value]这种方式指定该参数选项，但是实际上如果不指定@SupportedOptions，而传入了该参数，javac编译器会提示警告信息：<br>AutoServiceProcessor提供了debug和verify两个选项，debug选项传入时（-Adebug），会开启Debug日志，如下所示：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">log</span><span class=\"params\">(String msg)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (processingEnv.getOptions().containsKey(<span class=\"string\">&quot;debug&quot;</span>)) &#123;</span><br><span class=\"line\">        processingEnv.getMessager().printMessage(Kind.NOTE, msg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> 而verify则表示是否强制检查@AutoService的标注类和@AutoService的value所对应的服务接口是否实现关系。</p>\n</li>\n<li><p>还有一个比较重要的成员变量processingEnv，它在AbstractProcessor的init方法中传入，实际上就是编译期上下文工具级，除了上述示例中getOptions方法获取编译选项、getMessager方法获取消息对象用于消息打印（如下所示）外；此外还有一个getFiler方法获取Filer对象，用于生成源文件、class文件和辅助文件，可以说是Annotation Processor的核心，后续生成服务文件时将会用到，此外还有getTypeUtils和getElementUtils等代码工具类。</p>\n</li>\n<li><p>最为核心的就是process方法（如下所示），其返回值表示该注解的处理是否继续传给后续的注册处理器，入参annotations和我们之前所定义的getSupportedAnnotationTypes相对应，RoundEnvironment就表示每一轮注解处理的上下文环境（看一下直接的注解处理流程图就明白了），代码实现很清晰，AutoService先收集每一轮的代码信息，判断其标签并缓存待生成的服务文件信息，直到最后一轮没有新代码生成时，开始生成或更新服务配置文件。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">processImpl</span><span class=\"params\">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (roundEnv.processingOver()) &#123;</span><br><span class=\"line\">        generateConfigFiles();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        processAnnotations(annotations, roundEnv);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>而processAnnotations是如何收集信息的呢？也很简单，就是找到每一轮的所有AutoService标注的类文件，并获取各个类文件中@AutoService里面标注的服务接口，将服务接口名和服务实现类名称缓存值Multimap中</p>\n</li>\n<li><p>最后，根据Multimap中的信息，生成META-INF/services下服务文件，而生成的核心方法就是使用Filer，具体逻辑带大家简单看一下，首先是检查是否已有META-INF/services/下对应的服务文件，如果有则将其内容读取并缓存值列表中(allServices)：</p>\n</li>\n</ol>\n<p>总的说来AutoService实现还是很简单的，利用Annotation Processor机制为各个SPI服务以及Annotation Processor生成META-INF/services文件下的服务文件，但是确实是理解Annotation Processor机制的比较好的入门方式。目前还没有涉及到代码的生成，接下来的章节就将看看如何在注解处理器中生成代码。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>之前提到SPI需要在/META-INF/service路径下，以对应api为文件名具体实现类为内容的文件，这样做比较麻烦。我们可以利用Google Auto Service是如何利用Annotation Processor来帮助实现SPI的。</p>\n<p>具体实现如下：</p>\n<p>引入依赖</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.google.auto.service<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>auto-service<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">optional</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">optional</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@AutoService(StandardService.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">CStandardServiceImpl</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">StandardService</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">offerService</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;c service&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们分析下其中的具体实现。</p>\n<p>首先看一下auto-service-annotation库，只有一个AutoService注解定义，其value值即为SPI的服务接口类，如下所示：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * An annotation for service providers as described in &#123;<span class=\"doctag\">@link</span> java.util.ServiceLoader&#125;. The</span></span><br><span class=\"line\"><span class=\"comment\"> * annotation processor generates the configuration files that allow the annotated class to be</span></span><br><span class=\"line\"><span class=\"comment\"> * loaded with &#123;<span class=\"doctag\">@link</span> java.util.ServiceLoader#load(Class)&#125;.</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;p&gt;The annotated class must conform to the service provider specification. Specifically, it must:</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;ul&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> *   &lt;li&gt;be a non-inner, non-anonymous, concrete class</span></span><br><span class=\"line\"><span class=\"comment\"> *   &lt;li&gt;have a publicly accessible no-arg constructor</span></span><br><span class=\"line\"><span class=\"comment\"> *   &lt;li&gt;implement the interface type returned by &#123;<span class=\"doctag\">@code</span> value()&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> * &lt;/ul&gt;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(CLASS)</span></span><br><span class=\"line\"><span class=\"meta\">@Target(TYPE)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> AutoService &#123;</span><br><span class=\"line\">  <span class=\"comment\">/** Returns the interfaces implemented by this service provider. */</span></span><br><span class=\"line\">  Class&lt;?&gt;[] value();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>可以看出，其注解仅保留于源码级别，用于编译时Annotation Processor的源码分析，并利用分析结果进行META-INF/services下的服务文件生成。</p>\n<p> 仅接着，就要正式看一下auto-service的具体实现了，核心代码主要就是AutoServiceProcessor.java以及熟悉的META-INF/services/javax.annotation.processing.Processor服务文件。看过上节的人可能就要说了这是SPI，然而实际并非如此，这实际上是Annotation Processor的实现格式。</p>\n<p> Annotation Processor的代码实现核心包括一个实现Processor接口的类（一般继承AbstractProcessor抽象类）和一个Processor服务文件（内容就是实现类，例如AutoService的实现类com.google.auto.service.processor.AutoServiceProcessor）。虽然和SPI类似，甚至在实现方式上可以看成是Processor接口的SPI服务，但是SPI属于运行时，Annotation Processor属于编译时行为，两者还是有本质区别的。<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191602916.png\"></p>\n<p>如上引用一个比较经典的图，Javac的Annotation Processing实际上是一个循环的过程，在每一轮（Round）结束后，编译器会判断是否有新的代码生成，如有则进入下一轮分析新代码并调用注解处理器，如无代码生成，此时会再进行最后一轮，通知Annotation Processor处理结束，大家需要特别注意这最后一轮的概念。</p>\n<p>接下来就看看AutoServiceProcessor是如何实现的：</p>\n<ol>\n<li><p>getSupportedAnnotationType：该方法返回值表示了注解处理器所处理的注解类型，AutoServiceProvider当然就是AutoService注解；除了覆写该方法外，还可以通过@SupportedAnnotationTypes注解来替代。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ImmutableSet&lt;String&gt; <span class=\"title function_\">getSupportedAnnotationTypes</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ImmutableSet.of(AutoService.class.getName());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>getSupportedSourceVersion：该方法返回值表示了注解处理器所支持的最新JDK版本，同样也可使用@SupportedSourceVersion来替代。 </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> SourceVersion <span class=\"title function_\">getSupportedSourceVersion</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> SourceVersion.latestSupported();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>此外在AutoServiceProcessor类上还有一个不容忽视的注解@SupportedOptions，它也一样有一个相同的方法getSupportedOptions，该注解表示所支持的javac编译参数选项，在javac中可以通过-Akey[=value]这种方式指定该参数选项，但是实际上如果不指定@SupportedOptions，而传入了该参数，javac编译器会提示警告信息：<br>AutoServiceProcessor提供了debug和verify两个选项，debug选项传入时（-Adebug），会开启Debug日志，如下所示：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">log</span><span class=\"params\">(String msg)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (processingEnv.getOptions().containsKey(<span class=\"string\">&quot;debug&quot;</span>)) &#123;</span><br><span class=\"line\">        processingEnv.getMessager().printMessage(Kind.NOTE, msg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> 而verify则表示是否强制检查@AutoService的标注类和@AutoService的value所对应的服务接口是否实现关系。</p>\n</li>\n<li><p>还有一个比较重要的成员变量processingEnv，它在AbstractProcessor的init方法中传入，实际上就是编译期上下文工具级，除了上述示例中getOptions方法获取编译选项、getMessager方法获取消息对象用于消息打印（如下所示）外；此外还有一个getFiler方法获取Filer对象，用于生成源文件、class文件和辅助文件，可以说是Annotation Processor的核心，后续生成服务文件时将会用到，此外还有getTypeUtils和getElementUtils等代码工具类。</p>\n</li>\n<li><p>最为核心的就是process方法（如下所示），其返回值表示该注解的处理是否继续传给后续的注册处理器，入参annotations和我们之前所定义的getSupportedAnnotationTypes相对应，RoundEnvironment就表示每一轮注解处理的上下文环境（看一下直接的注解处理流程图就明白了），代码实现很清晰，AutoService先收集每一轮的代码信息，判断其标签并缓存待生成的服务文件信息，直到最后一轮没有新代码生成时，开始生成或更新服务配置文件。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">processImpl</span><span class=\"params\">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (roundEnv.processingOver()) &#123;</span><br><span class=\"line\">        generateConfigFiles();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        processAnnotations(annotations, roundEnv);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>而processAnnotations是如何收集信息的呢？也很简单，就是找到每一轮的所有AutoService标注的类文件，并获取各个类文件中@AutoService里面标注的服务接口，将服务接口名和服务实现类名称缓存值Multimap中</p>\n</li>\n<li><p>最后，根据Multimap中的信息，生成META-INF/services下服务文件，而生成的核心方法就是使用Filer，具体逻辑带大家简单看一下，首先是检查是否已有META-INF/services/下对应的服务文件，如果有则将其内容读取并缓存值列表中(allServices)：</p>\n</li>\n</ol>\n<p>总的说来AutoService实现还是很简单的，利用Annotation Processor机制为各个SPI服务以及Annotation Processor生成META-INF/services文件下的服务文件，但是确实是理解Annotation Processor机制的比较好的入门方式。目前还没有涉及到代码的生成，接下来的章节就将看看如何在注解处理器中生成代码。</p>\n"},{"uuid":"bbaf210c-c0ab-11ec-92a1-7557b2313227","title":"定时任务选型","abbrlink":"c04e3f54","_content":"\n简单写了一篇文章总结一下定时任务的一些概念以及一些常见的定时任务技术选型。\n\n## 为什么需要定时任务？\n\n我们来看一下几个非常常见的业务场景：\n\n1. 某系统凌晨要进行数据备份。\n2. 某电商平台，用户下单半个小时未支付的情况下需要自动取消订单。\n3. 某媒体聚合平台，每 10 分钟动态抓取某某网站的数据为自己所用。\n4. 某博客平台，支持定时发送文章。\n5. 某基金平台，每晚定时计算用户当日收益情况并推送给用户最新的数据。\n6. ......\n\n这些场景往往都要求我们在某个特定的时间去做某个事情。\n\n## 单机定时任务技术选型\n\n### Timer\n\n`java.util.Timer`是 JDK 1.3 开始就已经支持的一种定时任务的实现方式。\n\n`Timer` 内部使用一个叫做 `TaskQueue` 的类存放定时任务，它是一个基于最小堆实现的优先级队列。`TaskQueue` 会按照任务距离下一次执行时间的大小将任务排序，保证在堆顶的任务最先执行。这样在需要执行任务时，每次只需要取出堆顶的任务运行即可！\n\n`Timer` 使用起来比较简单，通过下面的方式我们就能创建一个 1s 之后执行的定时任务。\n\n~~~java\n// 示例代码：\nTimerTask task = new TimerTask() {\n    public void run() {\n        System.out.println(\"当前时间: \" + new Date() + \"n\" +\n                \"线程名称: \" + Thread.currentThread().getName());\n    }\n};\nSystem.out.println(\"当前时间: \" + new Date() + \"n\" +\n        \"线程名称: \" + Thread.currentThread().getName());\nTimer timer = new Timer(\"Timer\");\nlong delay = 1000L;\ntimer.schedule(task, delay);\n\n\n//输出：\n当前时间: Fri May 28 15:18:47 CST 2021n线程名称: main\n当前时间: Fri May 28 15:18:48 CST 2021n线程名称: Timer\n~~~\n\n不过其缺陷较多，比如一个 `Timer` 一个线程，这就导致 `Timer` 的任务的执行只能串行执行，一个任务执行时间过长的话会影响其他任务（性能非常差），再比如发生异常时任务直接停止（`Timer` 只捕获了 `InterruptedException` ）。\n\n`Timer` 类上的有一段注释是这样写的：\n\n~~~java\n\n * This class does not offer real-time guarantees: it schedules\n * tasks using the <tt>Object.wait(long)</tt> method.\n *Java 5.0 introduced the {@code java.util.concurrent} package and\n * one of the concurrency utilities therein is the {@link\n * java.util.concurrent.ScheduledThreadPoolExecutor\n * ScheduledThreadPoolExecutor} which is a thread pool for repeatedly\n * executing tasks at a given rate or delay.  It is effectively a more\n * versatile replacement for the {@code Timer}/{@code TimerTask}\n * combination, as it allows multiple service threads, accepts various\n * time units, and doesn't require subclassing {@code TimerTask} (just\n * implement {@code Runnable}).  Configuring {@code\n * ScheduledThreadPoolExecutor} with one thread makes it equivalent to\n * {@code Timer}.\n~~~\n\n大概的意思就是：`ScheduledThreadPoolExecutor` 支持多线程执行定时任务并且功能更强大，是 `Timer` 的替代品。\n\n### ScheduledExecutorService\n\n`ScheduledExecutorService` 是一个接口，有多个实现类，比较常用的是 `ScheduledThreadPoolExecutor` 。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191603417.png)\n\n`ScheduledThreadPoolExecutor` 本身就是一个线程池，支持任务并发执行。并且，其内部使用 `DelayQueue` 作为任务队列.\n\n~~~java\n// 示例代码：\nTimerTask repeatedTask = new TimerTask() {\n    @SneakyThrows\n    public void run() {\n        System.out.println(\"当前时间: \" + new Date() + \"n\" +\n                \"线程名称: \" + Thread.currentThread().getName());\n    }\n};\nSystem.out.println(\"当前时间: \" + new Date() + \"n\" +\n        \"线程名称: \" + Thread.currentThread().getName());\nScheduledExecutorService executor = Executors.newScheduledThreadPool(3);\nlong delay  = 1000L;\nlong period = 1000L;\nexecutor.scheduleAtFixedRate(repeatedTask, delay, period, TimeUnit.MILLISECONDS);\nThread.sleep(delay + period * 5);\nexecutor.shutdown();\n//输出：\n当前时间: Fri May 28 15:40:46 CST 2021n线程名称: main\n当前时间: Fri May 28 15:40:47 CST 2021n线程名称: pool-1-thread-1\n当前时间: Fri May 28 15:40:48 CST 2021n线程名称: pool-1-thread-1\n当前时间: Fri May 28 15:40:49 CST 2021n线程名称: pool-1-thread-2\n当前时间: Fri May 28 15:40:50 CST 2021n线程名称: pool-1-thread-2\n当前时间: Fri May 28 15:40:51 CST 2021n线程名称: pool-1-thread-2\n当前时间: Fri May 28 15:40:52 CST 2021n线程名称: pool-1-thread-2\n~~~\n\n不论是使用 `Timer` 还是 `ScheduledExecutorService` 都无法使用 Cron 表达式指定任务执行的具体时间。\n\n### Spring Task\n\n我们直接通过 Spring 提供的 `@Scheduled` 注解即可定义定时任务，非常方便！\n\n~~~java\n/**\n * cron：使用Cron表达式。 每分钟的1，2秒运行\n */\n@Scheduled(cron = \"1-2 * * * * ? \")\npublic void reportCurrentTimeWithCronExpression() {\n  log.info(\"Cron Expression: The time is now {}\", dateFormat.format(new Date()));\n}\n~~~\n\n并且，Spring Task 还是支持 **Cron 表达式** 的。Cron 表达式主要用于定时作业(定时任务)系统定义执行时间或执行频率的表达式，非常厉害，你可以通过 Cron 表达式进行设置定时任务每天或者每个月什么时候执行等等操作。咱们要学习定时任务的话，Cron 表达式是一定是要重点关注的。推荐一个在线 Cron 表达式生成器：http://cron.qqe2.com/ 。\n\n但是，Spring 自带的定时调度只支持单机，并且提供的功能比较单一。\n\nSpring Task 底层是基于 JDK 的 `ScheduledThreadPoolExecutor` 线程池来实现的。\n\n**优缺点总结：**\n\n- 优点：简单，轻量，支持 Cron 表达式\n- 缺点 ：功能单一\n\n### 时间轮\n\nKafka、Dubbo、ZooKeeper、Netty 、Caffeine 、Akka 中都有对时间轮的实现。\n\n时间轮简单来说就是一个环形的队列（底层一般基于数组实现），队列中的每一个元素（时间格）都可以存放一个定时任务列表。\n\n时间轮中的每个时间格代表了时间轮的基本时间跨度或者说时间精度，假如时间一秒走一个时间格的话，那么这个时间轮的最高精度就是 1 秒（也就是说 3 s 和 3.9s 会在同一个时间格中）。\n\n下图是一个有 12 个时间格的时间轮，转完一圈需要 12 s。当我们需要新建一个 3s 后执行的定时任务，只需要将定时任务放在下标为 3 的时间格中即可。当我们需要新建一个 9s 后执行的定时任务，只需要将定时任务放在下标为 9 的时间格中即可。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191604963.png)\n\n那当我们需要创建一个 13s 后执行的定时任务怎么办呢？这个时候可以引入一叫做 **圈数/轮数** 的概念，也就是说这个任务还是放在下标为 3 的时间格中， 不过它的圈数为 2 。\n\n除了增加圈数这种方法之外，还有一种 **多层次时间轮** （类似手表），Kafka 采用的就是这种方案。\n\n针对下图的时间轮，举一个例子便于大家理解。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191604537.png)\n\n上图的时间轮，第 1 层的时间精度为 1 ，第 2 层的时间精度为 20 ，第 3 层的时间精度为 400。假如我们需要添加一个 350s 后执行的任务 A 的话（当前时间是 0s），这个任务会被放在第 2 层（因为第二层的时间跨度为 20*20=400>350）的第 350/20=17 个时间格子。\n\n当第一层转了 17 圈之后，时间过去了 340s ，第 2 层的指针此时来到第 17 个时间格子。此时，第 2 层第 17 个格子的任务会被移动到第 1 层。\n\n任务 A 当前是 10s 之后执行，因此它会被移动到第 1 层的第 10 个时间格子。\n\n这里在层与层之间的移动也叫做时间轮的升降级。参考手表来理解就好！\n\n**时间轮比较适合任务数量比较多的定时任务场景，它的任务写入和执行的时间复杂度都是 0（1）。**\n\n## 分布式定时任务技术选型\n\n上面提到的一些定时任务的解决方案都是在单机下执行的，适用于比较简单的定时任务场景比如每天凌晨备份一次数据。\n\n如果我们需要一些高级特性比如支持任务在分布式场景下的分片和高可用的话，我们就需要用到分布式任务调度框架了。\n\n通常情况下，一个定时任务的执行往往涉及到下面这些角色：\n\n- **任务** ：首先肯定是要执行的任务，这个任务就是具体的业务逻辑比如定时发送文章。\n- **调度器** ：其次是调度中心，调度中心主要负责任务管理，会分配任务给执行器。\n- **执行器** ：最后就是执行器，执行器接收调度器分派的任务并执行。\n\n### Quartz\n\n一个很火的开源任务调度框架，完全由`Java`写成。`Quartz` 可以说是 Java 定时任务领域的老大哥或者说参考标准，其他的任务调度框架基本都是基于 `Quartz` 开发的，比如当当网的`elastic-job`就是基于`quartz`二次开发之后的分布式调度解决方案。\n\n使用 `Quartz` 可以很方便地与 `Spring` 集成，并且支持动态添加任务和集群。但是，`Quartz` 使用起来也比较麻烦，API 繁琐。\n\n并且，`Quzrtz` 并没有内置 UI 管理控制台，不过你可以使用 quartzui 这个开源项目来解决这个问题。\n\n另外，`Quartz` 虽然也支持分布式任务。但是，它是在数据库层面，通过数据库的锁机制做的，有非常多的弊端比如系统侵入性严重、节点负载不均衡。有点伪分布式的味道。\n\n**优缺点总结：**\n\n- 优点：可以与 `Spring` 集成，并且支持动态添加任务和集群。\n- 缺点 ：分布式支持不友好，没有内置 UI 管理控制台、使用麻烦（相比于其他同类型框架来说）\n\n### Elastic-Job\n\n`Elastic-Job` 是当当网开源的一个基于`Quartz`和`ZooKeeper`的分布式调度解决方案，由两个相互独立的子项目 `Elastic-Job-Lite` 和 `Elastic-Job-Cloud` 组成，一般我们只要使用 `Elastic-Job-Lite` 就好。\n\n`ElasticJob` 支持任务在分布式场景下的分片和高可用、任务可视化管理等功能。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191604600.png)\n\nElasticJob-Lite 的架构设计如下图所示：\n\n![imageselasticJob.png](https://raw.githubusercontent.com/xzyup/image/master/202203191604416.png)\n\n从上图可以看出，`Elastic-Job` 没有调度中心这一概念，而是使用 `ZooKeeper` 作为注册中心，注册中心负责协调分配任务到不同的节点上。\n\nElastic-Job 中的定时调度都是由执行器自行触发，这种设计也被称为去中心化设计（调度和处理都是执行器单独完成）。\n\n~~~java\n@Component\n@ElasticJobConf(name = \"dayJob\", cron = \"0/10 * * * * ?\", shardingTotalCount = 2,\n        shardingItemParameters = \"0=AAAA,1=BBBB\", description = \"简单任务\", failover = true)\npublic class TestJob implements SimpleJob {\n    @Override\n    public void execute(ShardingContext shardingContext) {\n        log.info(\"TestJob任务名：【{}】, 片数：【{}】, param=【{}】\", shardingContext.getJobName(), shardingContext.getShardingTotalCount(),\n                shardingContext.getShardingParameter());\n    }\n}\n~~~\n\n**优缺点总结：**\n\n- 优点 ：可以与 `Spring` 集成、支持分布式、支持集群、性能不错\n- 缺点 ：依赖了额外的中间件比如 Zookeeper（复杂度增加，可靠性降低、维护成本变高）\n\n### XXL-JOB\n\n`XXL-JOB` 于 2015 年开源，是一款优秀的轻量级分布式任务调度框架，支持任务可视化管理、弹性扩容缩容、任务失败重试和告警、任务分片等功能。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191605412.png)\n\n根据 `XXL-JOB` 官网介绍，其解决了很多 `Quartz` 的不足。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191605529.png)\n\n`XXL-JOB` 的架构设计如下图所示：\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191605002.png)\n\n从上图可以看出，`XXL-JOB` 由 **调度中心** 和 **执行器** 两大部分组成。调度中心主要负责任务管理、执行器管理以及日志管理。执行器主要是接收调度信号并处理。另外，调度中心进行任务调度时，是通过自研 RPC 来实现的。\n\n不同于 `Elastic-Job` 的去中心化设计， `XXL-JOB` 的这种设计也被称为中心化设计（调度中心调度多个执行器执行任务）。\n\n和 `Quzrtz` 类似 `XXL-JOB` 也是基于数据库锁调度任务，存在性能瓶颈。不过，一般在任务量不是特别大的情况下，没有什么影响的，可以满足绝大部分公司的要求。\n\n不要被 `XXL-JOB` 的架构图给吓着了，实际上，我们要用 `XXL-JOB` 的话，只需要重写 `IJobHandler` 自定义任务执行逻辑就可以了，非常易用！\n\n~~~java\n@JobHandler(value=\"myApiJobHandler\")\n@Component\npublic class MyApiJobHandler extends IJobHandler {\n\n    @Override\n    public ReturnT<String> execute(String param) throws Exception {\n        //......\n        return ReturnT.SUCCESS;\n    }\n}\n~~~\n\n还可以直接基于注解定义任务。\n\n~~~java\n@XxlJob(\"myAnnotationJobHandler\")\npublic ReturnT<String> myAnnotationJobHandler(String param) throws Exception {\n  //......\n  return ReturnT.SUCCESS;\n}\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191605193.png)\n\n**优缺点总结：**\n\n- 优点：开箱即用（学习成本比较低）、与 Spring 集成、支持分布式、支持集群、内置了 UI 管理控制台。\n- 缺点：不支持动态添加任务（如果一定想要动态创建任务也是支持的，参见：xxl-job issue277）。\n\n### PowerJob\n\n非常值得关注的一个分布式任务调度框架，分布式任务调度领域的新星。目前，已经有很多公司接入比如 OPPO、京东、中通、思科。\n\n这个框架的诞生也挺有意思的，PowerJob 的作者当时在阿里巴巴实习过，阿里巴巴那会使用的是内部自研的 SchedulerX（阿里云付费产品）。实习期满之后，PowerJob 的作者离开了阿里巴巴。想着说自研一个 SchedulerX，防止哪天 SchedulerX 满足不了需求，于是 PowerJob 就诞生了。\n\n更多关于 PowerJob 的故事，小伙伴们可以去看看 PowerJob 作者的视频 《我和我的任务调度中间件》。简单点概括就是：“游戏没啥意思了，我要扛起了新一代分布式任务调度与计算框架的大旗！”。\n\n由于 SchedulerX 属于人民币产品，这里就不过多介绍。PowerJob 官方也对比过其和 QuartZ、XXL-JOB 以及 SchedulerX。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191605537.png)\n\n## 总结\n\n这篇文章中，主要介绍了：\n\n- **定时任务的相关概念** ：为什么需要定时任务、定时任务中的核心角色、分布式定时任务。\n- **定时任务的技术选型** ：XXL-JOB 2015 年推出，已经经过了很多年的考验。XXL-JOB 轻量级，并且使用起来非常简单。虽然存在性能瓶颈，但是，在绝大多数情况下，对于企业的基本需求来说是没有影响的。PowerJob 属于分布式任务调度领域里的新星，其稳定性还有待继续考察。ElasticJob 由于在架构设计上是基于 Zookeeper ，而 XXL-JOB 是基于数据库，性能方面的话，ElasticJob 略胜一筹。\n","source":"_posts/job/常见定时任务类型.md","raw":"---\nuuid: bbaf210c-c0ab-11ec-92a1-7557b2313227\ntitle: 定时任务选型\ntags:\n  - 定时任务\nabbrlink: c04e3f54\n---\n\n简单写了一篇文章总结一下定时任务的一些概念以及一些常见的定时任务技术选型。\n\n## 为什么需要定时任务？\n\n我们来看一下几个非常常见的业务场景：\n\n1. 某系统凌晨要进行数据备份。\n2. 某电商平台，用户下单半个小时未支付的情况下需要自动取消订单。\n3. 某媒体聚合平台，每 10 分钟动态抓取某某网站的数据为自己所用。\n4. 某博客平台，支持定时发送文章。\n5. 某基金平台，每晚定时计算用户当日收益情况并推送给用户最新的数据。\n6. ......\n\n这些场景往往都要求我们在某个特定的时间去做某个事情。\n\n## 单机定时任务技术选型\n\n### Timer\n\n`java.util.Timer`是 JDK 1.3 开始就已经支持的一种定时任务的实现方式。\n\n`Timer` 内部使用一个叫做 `TaskQueue` 的类存放定时任务，它是一个基于最小堆实现的优先级队列。`TaskQueue` 会按照任务距离下一次执行时间的大小将任务排序，保证在堆顶的任务最先执行。这样在需要执行任务时，每次只需要取出堆顶的任务运行即可！\n\n`Timer` 使用起来比较简单，通过下面的方式我们就能创建一个 1s 之后执行的定时任务。\n\n~~~java\n// 示例代码：\nTimerTask task = new TimerTask() {\n    public void run() {\n        System.out.println(\"当前时间: \" + new Date() + \"n\" +\n                \"线程名称: \" + Thread.currentThread().getName());\n    }\n};\nSystem.out.println(\"当前时间: \" + new Date() + \"n\" +\n        \"线程名称: \" + Thread.currentThread().getName());\nTimer timer = new Timer(\"Timer\");\nlong delay = 1000L;\ntimer.schedule(task, delay);\n\n\n//输出：\n当前时间: Fri May 28 15:18:47 CST 2021n线程名称: main\n当前时间: Fri May 28 15:18:48 CST 2021n线程名称: Timer\n~~~\n\n不过其缺陷较多，比如一个 `Timer` 一个线程，这就导致 `Timer` 的任务的执行只能串行执行，一个任务执行时间过长的话会影响其他任务（性能非常差），再比如发生异常时任务直接停止（`Timer` 只捕获了 `InterruptedException` ）。\n\n`Timer` 类上的有一段注释是这样写的：\n\n~~~java\n\n * This class does not offer real-time guarantees: it schedules\n * tasks using the <tt>Object.wait(long)</tt> method.\n *Java 5.0 introduced the {@code java.util.concurrent} package and\n * one of the concurrency utilities therein is the {@link\n * java.util.concurrent.ScheduledThreadPoolExecutor\n * ScheduledThreadPoolExecutor} which is a thread pool for repeatedly\n * executing tasks at a given rate or delay.  It is effectively a more\n * versatile replacement for the {@code Timer}/{@code TimerTask}\n * combination, as it allows multiple service threads, accepts various\n * time units, and doesn't require subclassing {@code TimerTask} (just\n * implement {@code Runnable}).  Configuring {@code\n * ScheduledThreadPoolExecutor} with one thread makes it equivalent to\n * {@code Timer}.\n~~~\n\n大概的意思就是：`ScheduledThreadPoolExecutor` 支持多线程执行定时任务并且功能更强大，是 `Timer` 的替代品。\n\n### ScheduledExecutorService\n\n`ScheduledExecutorService` 是一个接口，有多个实现类，比较常用的是 `ScheduledThreadPoolExecutor` 。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191603417.png)\n\n`ScheduledThreadPoolExecutor` 本身就是一个线程池，支持任务并发执行。并且，其内部使用 `DelayQueue` 作为任务队列.\n\n~~~java\n// 示例代码：\nTimerTask repeatedTask = new TimerTask() {\n    @SneakyThrows\n    public void run() {\n        System.out.println(\"当前时间: \" + new Date() + \"n\" +\n                \"线程名称: \" + Thread.currentThread().getName());\n    }\n};\nSystem.out.println(\"当前时间: \" + new Date() + \"n\" +\n        \"线程名称: \" + Thread.currentThread().getName());\nScheduledExecutorService executor = Executors.newScheduledThreadPool(3);\nlong delay  = 1000L;\nlong period = 1000L;\nexecutor.scheduleAtFixedRate(repeatedTask, delay, period, TimeUnit.MILLISECONDS);\nThread.sleep(delay + period * 5);\nexecutor.shutdown();\n//输出：\n当前时间: Fri May 28 15:40:46 CST 2021n线程名称: main\n当前时间: Fri May 28 15:40:47 CST 2021n线程名称: pool-1-thread-1\n当前时间: Fri May 28 15:40:48 CST 2021n线程名称: pool-1-thread-1\n当前时间: Fri May 28 15:40:49 CST 2021n线程名称: pool-1-thread-2\n当前时间: Fri May 28 15:40:50 CST 2021n线程名称: pool-1-thread-2\n当前时间: Fri May 28 15:40:51 CST 2021n线程名称: pool-1-thread-2\n当前时间: Fri May 28 15:40:52 CST 2021n线程名称: pool-1-thread-2\n~~~\n\n不论是使用 `Timer` 还是 `ScheduledExecutorService` 都无法使用 Cron 表达式指定任务执行的具体时间。\n\n### Spring Task\n\n我们直接通过 Spring 提供的 `@Scheduled` 注解即可定义定时任务，非常方便！\n\n~~~java\n/**\n * cron：使用Cron表达式。 每分钟的1，2秒运行\n */\n@Scheduled(cron = \"1-2 * * * * ? \")\npublic void reportCurrentTimeWithCronExpression() {\n  log.info(\"Cron Expression: The time is now {}\", dateFormat.format(new Date()));\n}\n~~~\n\n并且，Spring Task 还是支持 **Cron 表达式** 的。Cron 表达式主要用于定时作业(定时任务)系统定义执行时间或执行频率的表达式，非常厉害，你可以通过 Cron 表达式进行设置定时任务每天或者每个月什么时候执行等等操作。咱们要学习定时任务的话，Cron 表达式是一定是要重点关注的。推荐一个在线 Cron 表达式生成器：http://cron.qqe2.com/ 。\n\n但是，Spring 自带的定时调度只支持单机，并且提供的功能比较单一。\n\nSpring Task 底层是基于 JDK 的 `ScheduledThreadPoolExecutor` 线程池来实现的。\n\n**优缺点总结：**\n\n- 优点：简单，轻量，支持 Cron 表达式\n- 缺点 ：功能单一\n\n### 时间轮\n\nKafka、Dubbo、ZooKeeper、Netty 、Caffeine 、Akka 中都有对时间轮的实现。\n\n时间轮简单来说就是一个环形的队列（底层一般基于数组实现），队列中的每一个元素（时间格）都可以存放一个定时任务列表。\n\n时间轮中的每个时间格代表了时间轮的基本时间跨度或者说时间精度，假如时间一秒走一个时间格的话，那么这个时间轮的最高精度就是 1 秒（也就是说 3 s 和 3.9s 会在同一个时间格中）。\n\n下图是一个有 12 个时间格的时间轮，转完一圈需要 12 s。当我们需要新建一个 3s 后执行的定时任务，只需要将定时任务放在下标为 3 的时间格中即可。当我们需要新建一个 9s 后执行的定时任务，只需要将定时任务放在下标为 9 的时间格中即可。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191604963.png)\n\n那当我们需要创建一个 13s 后执行的定时任务怎么办呢？这个时候可以引入一叫做 **圈数/轮数** 的概念，也就是说这个任务还是放在下标为 3 的时间格中， 不过它的圈数为 2 。\n\n除了增加圈数这种方法之外，还有一种 **多层次时间轮** （类似手表），Kafka 采用的就是这种方案。\n\n针对下图的时间轮，举一个例子便于大家理解。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191604537.png)\n\n上图的时间轮，第 1 层的时间精度为 1 ，第 2 层的时间精度为 20 ，第 3 层的时间精度为 400。假如我们需要添加一个 350s 后执行的任务 A 的话（当前时间是 0s），这个任务会被放在第 2 层（因为第二层的时间跨度为 20*20=400>350）的第 350/20=17 个时间格子。\n\n当第一层转了 17 圈之后，时间过去了 340s ，第 2 层的指针此时来到第 17 个时间格子。此时，第 2 层第 17 个格子的任务会被移动到第 1 层。\n\n任务 A 当前是 10s 之后执行，因此它会被移动到第 1 层的第 10 个时间格子。\n\n这里在层与层之间的移动也叫做时间轮的升降级。参考手表来理解就好！\n\n**时间轮比较适合任务数量比较多的定时任务场景，它的任务写入和执行的时间复杂度都是 0（1）。**\n\n## 分布式定时任务技术选型\n\n上面提到的一些定时任务的解决方案都是在单机下执行的，适用于比较简单的定时任务场景比如每天凌晨备份一次数据。\n\n如果我们需要一些高级特性比如支持任务在分布式场景下的分片和高可用的话，我们就需要用到分布式任务调度框架了。\n\n通常情况下，一个定时任务的执行往往涉及到下面这些角色：\n\n- **任务** ：首先肯定是要执行的任务，这个任务就是具体的业务逻辑比如定时发送文章。\n- **调度器** ：其次是调度中心，调度中心主要负责任务管理，会分配任务给执行器。\n- **执行器** ：最后就是执行器，执行器接收调度器分派的任务并执行。\n\n### Quartz\n\n一个很火的开源任务调度框架，完全由`Java`写成。`Quartz` 可以说是 Java 定时任务领域的老大哥或者说参考标准，其他的任务调度框架基本都是基于 `Quartz` 开发的，比如当当网的`elastic-job`就是基于`quartz`二次开发之后的分布式调度解决方案。\n\n使用 `Quartz` 可以很方便地与 `Spring` 集成，并且支持动态添加任务和集群。但是，`Quartz` 使用起来也比较麻烦，API 繁琐。\n\n并且，`Quzrtz` 并没有内置 UI 管理控制台，不过你可以使用 quartzui 这个开源项目来解决这个问题。\n\n另外，`Quartz` 虽然也支持分布式任务。但是，它是在数据库层面，通过数据库的锁机制做的，有非常多的弊端比如系统侵入性严重、节点负载不均衡。有点伪分布式的味道。\n\n**优缺点总结：**\n\n- 优点：可以与 `Spring` 集成，并且支持动态添加任务和集群。\n- 缺点 ：分布式支持不友好，没有内置 UI 管理控制台、使用麻烦（相比于其他同类型框架来说）\n\n### Elastic-Job\n\n`Elastic-Job` 是当当网开源的一个基于`Quartz`和`ZooKeeper`的分布式调度解决方案，由两个相互独立的子项目 `Elastic-Job-Lite` 和 `Elastic-Job-Cloud` 组成，一般我们只要使用 `Elastic-Job-Lite` 就好。\n\n`ElasticJob` 支持任务在分布式场景下的分片和高可用、任务可视化管理等功能。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191604600.png)\n\nElasticJob-Lite 的架构设计如下图所示：\n\n![imageselasticJob.png](https://raw.githubusercontent.com/xzyup/image/master/202203191604416.png)\n\n从上图可以看出，`Elastic-Job` 没有调度中心这一概念，而是使用 `ZooKeeper` 作为注册中心，注册中心负责协调分配任务到不同的节点上。\n\nElastic-Job 中的定时调度都是由执行器自行触发，这种设计也被称为去中心化设计（调度和处理都是执行器单独完成）。\n\n~~~java\n@Component\n@ElasticJobConf(name = \"dayJob\", cron = \"0/10 * * * * ?\", shardingTotalCount = 2,\n        shardingItemParameters = \"0=AAAA,1=BBBB\", description = \"简单任务\", failover = true)\npublic class TestJob implements SimpleJob {\n    @Override\n    public void execute(ShardingContext shardingContext) {\n        log.info(\"TestJob任务名：【{}】, 片数：【{}】, param=【{}】\", shardingContext.getJobName(), shardingContext.getShardingTotalCount(),\n                shardingContext.getShardingParameter());\n    }\n}\n~~~\n\n**优缺点总结：**\n\n- 优点 ：可以与 `Spring` 集成、支持分布式、支持集群、性能不错\n- 缺点 ：依赖了额外的中间件比如 Zookeeper（复杂度增加，可靠性降低、维护成本变高）\n\n### XXL-JOB\n\n`XXL-JOB` 于 2015 年开源，是一款优秀的轻量级分布式任务调度框架，支持任务可视化管理、弹性扩容缩容、任务失败重试和告警、任务分片等功能。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191605412.png)\n\n根据 `XXL-JOB` 官网介绍，其解决了很多 `Quartz` 的不足。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191605529.png)\n\n`XXL-JOB` 的架构设计如下图所示：\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191605002.png)\n\n从上图可以看出，`XXL-JOB` 由 **调度中心** 和 **执行器** 两大部分组成。调度中心主要负责任务管理、执行器管理以及日志管理。执行器主要是接收调度信号并处理。另外，调度中心进行任务调度时，是通过自研 RPC 来实现的。\n\n不同于 `Elastic-Job` 的去中心化设计， `XXL-JOB` 的这种设计也被称为中心化设计（调度中心调度多个执行器执行任务）。\n\n和 `Quzrtz` 类似 `XXL-JOB` 也是基于数据库锁调度任务，存在性能瓶颈。不过，一般在任务量不是特别大的情况下，没有什么影响的，可以满足绝大部分公司的要求。\n\n不要被 `XXL-JOB` 的架构图给吓着了，实际上，我们要用 `XXL-JOB` 的话，只需要重写 `IJobHandler` 自定义任务执行逻辑就可以了，非常易用！\n\n~~~java\n@JobHandler(value=\"myApiJobHandler\")\n@Component\npublic class MyApiJobHandler extends IJobHandler {\n\n    @Override\n    public ReturnT<String> execute(String param) throws Exception {\n        //......\n        return ReturnT.SUCCESS;\n    }\n}\n~~~\n\n还可以直接基于注解定义任务。\n\n~~~java\n@XxlJob(\"myAnnotationJobHandler\")\npublic ReturnT<String> myAnnotationJobHandler(String param) throws Exception {\n  //......\n  return ReturnT.SUCCESS;\n}\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191605193.png)\n\n**优缺点总结：**\n\n- 优点：开箱即用（学习成本比较低）、与 Spring 集成、支持分布式、支持集群、内置了 UI 管理控制台。\n- 缺点：不支持动态添加任务（如果一定想要动态创建任务也是支持的，参见：xxl-job issue277）。\n\n### PowerJob\n\n非常值得关注的一个分布式任务调度框架，分布式任务调度领域的新星。目前，已经有很多公司接入比如 OPPO、京东、中通、思科。\n\n这个框架的诞生也挺有意思的，PowerJob 的作者当时在阿里巴巴实习过，阿里巴巴那会使用的是内部自研的 SchedulerX（阿里云付费产品）。实习期满之后，PowerJob 的作者离开了阿里巴巴。想着说自研一个 SchedulerX，防止哪天 SchedulerX 满足不了需求，于是 PowerJob 就诞生了。\n\n更多关于 PowerJob 的故事，小伙伴们可以去看看 PowerJob 作者的视频 《我和我的任务调度中间件》。简单点概括就是：“游戏没啥意思了，我要扛起了新一代分布式任务调度与计算框架的大旗！”。\n\n由于 SchedulerX 属于人民币产品，这里就不过多介绍。PowerJob 官方也对比过其和 QuartZ、XXL-JOB 以及 SchedulerX。\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191605537.png)\n\n## 总结\n\n这篇文章中，主要介绍了：\n\n- **定时任务的相关概念** ：为什么需要定时任务、定时任务中的核心角色、分布式定时任务。\n- **定时任务的技术选型** ：XXL-JOB 2015 年推出，已经经过了很多年的考验。XXL-JOB 轻量级，并且使用起来非常简单。虽然存在性能瓶颈，但是，在绝大多数情况下，对于企业的基本需求来说是没有影响的。PowerJob 属于分布式任务调度领域里的新星，其稳定性还有待继续考察。ElasticJob 由于在架构设计上是基于 Zookeeper ，而 XXL-JOB 是基于数据库，性能方面的话，ElasticJob 略胜一筹。\n","slug":"job/常见定时任务类型","published":1,"date":"2022-04-20T12:41:20.798Z","updated":"2022-05-04T03:19:52.900Z","_id":"cl2qzfthy003d13nodhgofhex","comments":1,"layout":"post","photos":[],"link":"","content":"<p>简单写了一篇文章总结一下定时任务的一些概念以及一些常见的定时任务技术选型。</p>\n<h2 id=\"为什么需要定时任务？\"><a href=\"#为什么需要定时任务？\" class=\"headerlink\" title=\"为什么需要定时任务？\"></a>为什么需要定时任务？</h2><p>我们来看一下几个非常常见的业务场景：</p>\n<ol>\n<li>某系统凌晨要进行数据备份。</li>\n<li>某电商平台，用户下单半个小时未支付的情况下需要自动取消订单。</li>\n<li>某媒体聚合平台，每 10 分钟动态抓取某某网站的数据为自己所用。</li>\n<li>某博客平台，支持定时发送文章。</li>\n<li>某基金平台，每晚定时计算用户当日收益情况并推送给用户最新的数据。</li>\n<li>……</li>\n</ol>\n<p>这些场景往往都要求我们在某个特定的时间去做某个事情。</p>\n<h2 id=\"单机定时任务技术选型\"><a href=\"#单机定时任务技术选型\" class=\"headerlink\" title=\"单机定时任务技术选型\"></a>单机定时任务技术选型</h2><h3 id=\"Timer\"><a href=\"#Timer\" class=\"headerlink\" title=\"Timer\"></a>Timer</h3><p><code>java.util.Timer</code>是 JDK 1.3 开始就已经支持的一种定时任务的实现方式。</p>\n<p><code>Timer</code> 内部使用一个叫做 <code>TaskQueue</code> 的类存放定时任务，它是一个基于最小堆实现的优先级队列。<code>TaskQueue</code> 会按照任务距离下一次执行时间的大小将任务排序，保证在堆顶的任务最先执行。这样在需要执行任务时，每次只需要取出堆顶的任务运行即可！</p>\n<p><code>Timer</code> 使用起来比较简单，通过下面的方式我们就能创建一个 1s 之后执行的定时任务。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 示例代码：</span></span><br><span class=\"line\"><span class=\"type\">TimerTask</span> <span class=\"variable\">task</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TimerTask</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;当前时间: &quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>() + <span class=\"string\">&quot;n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;当前时间: &quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>() + <span class=\"string\">&quot;n&quot;</span> +</span><br><span class=\"line\">        <span class=\"string\">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class=\"line\"><span class=\"type\">Timer</span> <span class=\"variable\">timer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Timer</span>(<span class=\"string\">&quot;Timer&quot;</span>);</span><br><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">delay</span> <span class=\"operator\">=</span> <span class=\"number\">1000L</span>;</span><br><span class=\"line\">timer.schedule(task, delay);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//输出：</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">18</span>:<span class=\"number\">47</span> CST 2021n线程名称: main</span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">18</span>:<span class=\"number\">48</span> CST 2021n线程名称: Timer</span><br></pre></td></tr></table></figure>\n\n<p>不过其缺陷较多，比如一个 <code>Timer</code> 一个线程，这就导致 <code>Timer</code> 的任务的执行只能串行执行，一个任务执行时间过长的话会影响其他任务（性能非常差），再比如发生异常时任务直接停止（<code>Timer</code> 只捕获了 <code>InterruptedException</code> ）。</p>\n<p><code>Timer</code> 类上的有一段注释是这样写的：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">* This <span class=\"keyword\">class</span> <span class=\"title class_\">does</span> not offer real-time guarantees: it schedules</span><br><span class=\"line\">* tasks using the &lt;tt&gt;Object.wait(<span class=\"type\">long</span>)&lt;/tt&gt; method.</span><br><span class=\"line\">*Java <span class=\"number\">5.0</span> introduced the &#123;<span class=\"meta\">@code</span> java.util.concurrent&#125; <span class=\"keyword\">package</span> and</span><br><span class=\"line\">* one of the concurrency utilities therein is the &#123;<span class=\"meta\">@link</span></span><br><span class=\"line\">* java.util.concurrent.ScheduledThreadPoolExecutor</span><br><span class=\"line\">* ScheduledThreadPoolExecutor&#125; which is a thread pool <span class=\"keyword\">for</span> repeatedly</span><br><span class=\"line\">* executing tasks at a given rate or delay.  It is effectively a more</span><br><span class=\"line\">* versatile replacement <span class=\"keyword\">for</span> the &#123;<span class=\"meta\">@code</span> Timer&#125;/&#123;<span class=\"meta\">@code</span> TimerTask&#125;</span><br><span class=\"line\">* combination, as it allows multiple service threads, accepts various</span><br><span class=\"line\">* time units, and doesn<span class=\"string\">&#x27;t require subclassing &#123;@code TimerTask&#125; (just</span></span><br><span class=\"line\"><span class=\"string\">* implement &#123;@code Runnable&#125;).  Configuring &#123;@code</span></span><br><span class=\"line\"><span class=\"string\">* ScheduledThreadPoolExecutor&#125; with one thread makes it equivalent to</span></span><br><span class=\"line\"><span class=\"string\">* &#123;@code Timer&#125;.</span></span><br></pre></td></tr></table></figure>\n\n<p>大概的意思就是：<code>ScheduledThreadPoolExecutor</code> 支持多线程执行定时任务并且功能更强大，是 <code>Timer</code> 的替代品。</p>\n<h3 id=\"ScheduledExecutorService\"><a href=\"#ScheduledExecutorService\" class=\"headerlink\" title=\"ScheduledExecutorService\"></a>ScheduledExecutorService</h3><p><code>ScheduledExecutorService</code> 是一个接口，有多个实现类，比较常用的是 <code>ScheduledThreadPoolExecutor</code> 。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191603417.png\"></p>\n<p><code>ScheduledThreadPoolExecutor</code> 本身就是一个线程池，支持任务并发执行。并且，其内部使用 <code>DelayQueue</code> 作为任务队列.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 示例代码：</span></span><br><span class=\"line\"><span class=\"type\">TimerTask</span> <span class=\"variable\">repeatedTask</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TimerTask</span>() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@SneakyThrows</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;当前时间: &quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>() + <span class=\"string\">&quot;n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;当前时间: &quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>() + <span class=\"string\">&quot;n&quot;</span> +</span><br><span class=\"line\">        <span class=\"string\">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class=\"line\"><span class=\"type\">ScheduledExecutorService</span> <span class=\"variable\">executor</span> <span class=\"operator\">=</span> Executors.newScheduledThreadPool(<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">delay</span>  <span class=\"operator\">=</span> <span class=\"number\">1000L</span>;</span><br><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">period</span> <span class=\"operator\">=</span> <span class=\"number\">1000L</span>;</span><br><span class=\"line\">executor.scheduleAtFixedRate(repeatedTask, delay, period, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">Thread.sleep(delay + period * <span class=\"number\">5</span>);</span><br><span class=\"line\">executor.shutdown();</span><br><span class=\"line\"><span class=\"comment\">//输出：</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">46</span> CST 2021n线程名称: main</span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">47</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">1</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">48</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">1</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">49</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">2</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">50</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">2</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">51</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">2</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">52</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n<p>不论是使用 <code>Timer</code> 还是 <code>ScheduledExecutorService</code> 都无法使用 Cron 表达式指定任务执行的具体时间。</p>\n<h3 id=\"Spring-Task\"><a href=\"#Spring-Task\" class=\"headerlink\" title=\"Spring Task\"></a>Spring Task</h3><p>我们直接通过 Spring 提供的 <code>@Scheduled</code> 注解即可定义定时任务，非常方便！</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * cron：使用Cron表达式。 每分钟的1，2秒运行</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Scheduled(cron = &quot;1-2 * * * * ? &quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">reportCurrentTimeWithCronExpression</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  log.info(<span class=\"string\">&quot;Cron Expression: The time is now &#123;&#125;&quot;</span>, dateFormat.format(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>并且，Spring Task 还是支持 <strong>Cron 表达式</strong> 的。Cron 表达式主要用于定时作业(定时任务)系统定义执行时间或执行频率的表达式，非常厉害，你可以通过 Cron 表达式进行设置定时任务每天或者每个月什么时候执行等等操作。咱们要学习定时任务的话，Cron 表达式是一定是要重点关注的。推荐一个在线 Cron 表达式生成器：<a href=\"http://cron.qqe2.com/\">http://cron.qqe2.com/</a> 。</p>\n<p>但是，Spring 自带的定时调度只支持单机，并且提供的功能比较单一。</p>\n<p>Spring Task 底层是基于 JDK 的 <code>ScheduledThreadPoolExecutor</code> 线程池来实现的。</p>\n<p><strong>优缺点总结：</strong></p>\n<ul>\n<li>优点：简单，轻量，支持 Cron 表达式</li>\n<li>缺点 ：功能单一</li>\n</ul>\n<h3 id=\"时间轮\"><a href=\"#时间轮\" class=\"headerlink\" title=\"时间轮\"></a>时间轮</h3><p>Kafka、Dubbo、ZooKeeper、Netty 、Caffeine 、Akka 中都有对时间轮的实现。</p>\n<p>时间轮简单来说就是一个环形的队列（底层一般基于数组实现），队列中的每一个元素（时间格）都可以存放一个定时任务列表。</p>\n<p>时间轮中的每个时间格代表了时间轮的基本时间跨度或者说时间精度，假如时间一秒走一个时间格的话，那么这个时间轮的最高精度就是 1 秒（也就是说 3 s 和 3.9s 会在同一个时间格中）。</p>\n<p>下图是一个有 12 个时间格的时间轮，转完一圈需要 12 s。当我们需要新建一个 3s 后执行的定时任务，只需要将定时任务放在下标为 3 的时间格中即可。当我们需要新建一个 9s 后执行的定时任务，只需要将定时任务放在下标为 9 的时间格中即可。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191604963.png\"></p>\n<p>那当我们需要创建一个 13s 后执行的定时任务怎么办呢？这个时候可以引入一叫做 <strong>圈数/轮数</strong> 的概念，也就是说这个任务还是放在下标为 3 的时间格中， 不过它的圈数为 2 。</p>\n<p>除了增加圈数这种方法之外，还有一种 <strong>多层次时间轮</strong> （类似手表），Kafka 采用的就是这种方案。</p>\n<p>针对下图的时间轮，举一个例子便于大家理解。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191604537.png\"></p>\n<p>上图的时间轮，第 1 层的时间精度为 1 ，第 2 层的时间精度为 20 ，第 3 层的时间精度为 400。假如我们需要添加一个 350s 后执行的任务 A 的话（当前时间是 0s），这个任务会被放在第 2 层（因为第二层的时间跨度为 20*20=400&gt;350）的第 350/20=17 个时间格子。</p>\n<p>当第一层转了 17 圈之后，时间过去了 340s ，第 2 层的指针此时来到第 17 个时间格子。此时，第 2 层第 17 个格子的任务会被移动到第 1 层。</p>\n<p>任务 A 当前是 10s 之后执行，因此它会被移动到第 1 层的第 10 个时间格子。</p>\n<p>这里在层与层之间的移动也叫做时间轮的升降级。参考手表来理解就好！</p>\n<p><strong>时间轮比较适合任务数量比较多的定时任务场景，它的任务写入和执行的时间复杂度都是 0（1）。</strong></p>\n<h2 id=\"分布式定时任务技术选型\"><a href=\"#分布式定时任务技术选型\" class=\"headerlink\" title=\"分布式定时任务技术选型\"></a>分布式定时任务技术选型</h2><p>上面提到的一些定时任务的解决方案都是在单机下执行的，适用于比较简单的定时任务场景比如每天凌晨备份一次数据。</p>\n<p>如果我们需要一些高级特性比如支持任务在分布式场景下的分片和高可用的话，我们就需要用到分布式任务调度框架了。</p>\n<p>通常情况下，一个定时任务的执行往往涉及到下面这些角色：</p>\n<ul>\n<li><strong>任务</strong> ：首先肯定是要执行的任务，这个任务就是具体的业务逻辑比如定时发送文章。</li>\n<li><strong>调度器</strong> ：其次是调度中心，调度中心主要负责任务管理，会分配任务给执行器。</li>\n<li><strong>执行器</strong> ：最后就是执行器，执行器接收调度器分派的任务并执行。</li>\n</ul>\n<h3 id=\"Quartz\"><a href=\"#Quartz\" class=\"headerlink\" title=\"Quartz\"></a>Quartz</h3><p>一个很火的开源任务调度框架，完全由<code>Java</code>写成。<code>Quartz</code> 可以说是 Java 定时任务领域的老大哥或者说参考标准，其他的任务调度框架基本都是基于 <code>Quartz</code> 开发的，比如当当网的<code>elastic-job</code>就是基于<code>quartz</code>二次开发之后的分布式调度解决方案。</p>\n<p>使用 <code>Quartz</code> 可以很方便地与 <code>Spring</code> 集成，并且支持动态添加任务和集群。但是，<code>Quartz</code> 使用起来也比较麻烦，API 繁琐。</p>\n<p>并且，<code>Quzrtz</code> 并没有内置 UI 管理控制台，不过你可以使用 quartzui 这个开源项目来解决这个问题。</p>\n<p>另外，<code>Quartz</code> 虽然也支持分布式任务。但是，它是在数据库层面，通过数据库的锁机制做的，有非常多的弊端比如系统侵入性严重、节点负载不均衡。有点伪分布式的味道。</p>\n<p><strong>优缺点总结：</strong></p>\n<ul>\n<li>优点：可以与 <code>Spring</code> 集成，并且支持动态添加任务和集群。</li>\n<li>缺点 ：分布式支持不友好，没有内置 UI 管理控制台、使用麻烦（相比于其他同类型框架来说）</li>\n</ul>\n<h3 id=\"Elastic-Job\"><a href=\"#Elastic-Job\" class=\"headerlink\" title=\"Elastic-Job\"></a>Elastic-Job</h3><p><code>Elastic-Job</code> 是当当网开源的一个基于<code>Quartz</code>和<code>ZooKeeper</code>的分布式调度解决方案，由两个相互独立的子项目 <code>Elastic-Job-Lite</code> 和 <code>Elastic-Job-Cloud</code> 组成，一般我们只要使用 <code>Elastic-Job-Lite</code> 就好。</p>\n<p><code>ElasticJob</code> 支持任务在分布式场景下的分片和高可用、任务可视化管理等功能。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191604600.png\"></p>\n<p>ElasticJob-Lite 的架构设计如下图所示：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191604416.png\" alt=\"imageselasticJob.png\"></p>\n<p>从上图可以看出，<code>Elastic-Job</code> 没有调度中心这一概念，而是使用 <code>ZooKeeper</code> 作为注册中心，注册中心负责协调分配任务到不同的节点上。</p>\n<p>Elastic-Job 中的定时调度都是由执行器自行触发，这种设计也被称为去中心化设计（调度和处理都是执行器单独完成）。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@ElasticJobConf(name = &quot;dayJob&quot;, cron = &quot;0/10 * * * * ?&quot;, shardingTotalCount = 2,</span></span><br><span class=\"line\"><span class=\"meta\">        shardingItemParameters = &quot;0=AAAA,1=BBBB&quot;, description = &quot;简单任务&quot;, failover = true)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestJob</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">SimpleJob</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">execute</span><span class=\"params\">(ShardingContext shardingContext)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;TestJob任务名：【&#123;&#125;】, 片数：【&#123;&#125;】, param=【&#123;&#125;】&quot;</span>, shardingContext.getJobName(), shardingContext.getShardingTotalCount(),</span><br><span class=\"line\">                shardingContext.getShardingParameter());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>优缺点总结：</strong></p>\n<ul>\n<li>优点 ：可以与 <code>Spring</code> 集成、支持分布式、支持集群、性能不错</li>\n<li>缺点 ：依赖了额外的中间件比如 Zookeeper（复杂度增加，可靠性降低、维护成本变高）</li>\n</ul>\n<h3 id=\"XXL-JOB\"><a href=\"#XXL-JOB\" class=\"headerlink\" title=\"XXL-JOB\"></a>XXL-JOB</h3><p><code>XXL-JOB</code> 于 2015 年开源，是一款优秀的轻量级分布式任务调度框架，支持任务可视化管理、弹性扩容缩容、任务失败重试和告警、任务分片等功能。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191605412.png\"></p>\n<p>根据 <code>XXL-JOB</code> 官网介绍，其解决了很多 <code>Quartz</code> 的不足。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191605529.png\"></p>\n<p><code>XXL-JOB</code> 的架构设计如下图所示：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191605002.png\"></p>\n<p>从上图可以看出，<code>XXL-JOB</code> 由 <strong>调度中心</strong> 和 <strong>执行器</strong> 两大部分组成。调度中心主要负责任务管理、执行器管理以及日志管理。执行器主要是接收调度信号并处理。另外，调度中心进行任务调度时，是通过自研 RPC 来实现的。</p>\n<p>不同于 <code>Elastic-Job</code> 的去中心化设计， <code>XXL-JOB</code> 的这种设计也被称为中心化设计（调度中心调度多个执行器执行任务）。</p>\n<p>和 <code>Quzrtz</code> 类似 <code>XXL-JOB</code> 也是基于数据库锁调度任务，存在性能瓶颈。不过，一般在任务量不是特别大的情况下，没有什么影响的，可以满足绝大部分公司的要求。</p>\n<p>不要被 <code>XXL-JOB</code> 的架构图给吓着了，实际上，我们要用 <code>XXL-JOB</code> 的话，只需要重写 <code>IJobHandler</code> 自定义任务执行逻辑就可以了，非常易用！</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@JobHandler(value=&quot;myApiJobHandler&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyApiJobHandler</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">IJobHandler</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ReturnT&lt;String&gt; <span class=\"title function_\">execute</span><span class=\"params\">(String param)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">//......</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ReturnT.SUCCESS;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>还可以直接基于注解定义任务。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@XxlJob(&quot;myAnnotationJobHandler&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ReturnT&lt;String&gt; <span class=\"title function_\">myAnnotationJobHandler</span><span class=\"params\">(String param)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">  <span class=\"comment\">//......</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> ReturnT.SUCCESS;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191605193.png\"></p>\n<p><strong>优缺点总结：</strong></p>\n<ul>\n<li>优点：开箱即用（学习成本比较低）、与 Spring 集成、支持分布式、支持集群、内置了 UI 管理控制台。</li>\n<li>缺点：不支持动态添加任务（如果一定想要动态创建任务也是支持的，参见：xxl-job issue277）。</li>\n</ul>\n<h3 id=\"PowerJob\"><a href=\"#PowerJob\" class=\"headerlink\" title=\"PowerJob\"></a>PowerJob</h3><p>非常值得关注的一个分布式任务调度框架，分布式任务调度领域的新星。目前，已经有很多公司接入比如 OPPO、京东、中通、思科。</p>\n<p>这个框架的诞生也挺有意思的，PowerJob 的作者当时在阿里巴巴实习过，阿里巴巴那会使用的是内部自研的 SchedulerX（阿里云付费产品）。实习期满之后，PowerJob 的作者离开了阿里巴巴。想着说自研一个 SchedulerX，防止哪天 SchedulerX 满足不了需求，于是 PowerJob 就诞生了。</p>\n<p>更多关于 PowerJob 的故事，小伙伴们可以去看看 PowerJob 作者的视频 《我和我的任务调度中间件》。简单点概括就是：“游戏没啥意思了，我要扛起了新一代分布式任务调度与计算框架的大旗！”。</p>\n<p>由于 SchedulerX 属于人民币产品，这里就不过多介绍。PowerJob 官方也对比过其和 QuartZ、XXL-JOB 以及 SchedulerX。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191605537.png\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>这篇文章中，主要介绍了：</p>\n<ul>\n<li><strong>定时任务的相关概念</strong> ：为什么需要定时任务、定时任务中的核心角色、分布式定时任务。</li>\n<li><strong>定时任务的技术选型</strong> ：XXL-JOB 2015 年推出，已经经过了很多年的考验。XXL-JOB 轻量级，并且使用起来非常简单。虽然存在性能瓶颈，但是，在绝大多数情况下，对于企业的基本需求来说是没有影响的。PowerJob 属于分布式任务调度领域里的新星，其稳定性还有待继续考察。ElasticJob 由于在架构设计上是基于 Zookeeper ，而 XXL-JOB 是基于数据库，性能方面的话，ElasticJob 略胜一筹。</li>\n</ul>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>简单写了一篇文章总结一下定时任务的一些概念以及一些常见的定时任务技术选型。</p>\n<h2 id=\"为什么需要定时任务？\"><a href=\"#为什么需要定时任务？\" class=\"headerlink\" title=\"为什么需要定时任务？\"></a>为什么需要定时任务？</h2><p>我们来看一下几个非常常见的业务场景：</p>\n<ol>\n<li>某系统凌晨要进行数据备份。</li>\n<li>某电商平台，用户下单半个小时未支付的情况下需要自动取消订单。</li>\n<li>某媒体聚合平台，每 10 分钟动态抓取某某网站的数据为自己所用。</li>\n<li>某博客平台，支持定时发送文章。</li>\n<li>某基金平台，每晚定时计算用户当日收益情况并推送给用户最新的数据。</li>\n<li>……</li>\n</ol>\n<p>这些场景往往都要求我们在某个特定的时间去做某个事情。</p>\n<h2 id=\"单机定时任务技术选型\"><a href=\"#单机定时任务技术选型\" class=\"headerlink\" title=\"单机定时任务技术选型\"></a>单机定时任务技术选型</h2><h3 id=\"Timer\"><a href=\"#Timer\" class=\"headerlink\" title=\"Timer\"></a>Timer</h3><p><code>java.util.Timer</code>是 JDK 1.3 开始就已经支持的一种定时任务的实现方式。</p>\n<p><code>Timer</code> 内部使用一个叫做 <code>TaskQueue</code> 的类存放定时任务，它是一个基于最小堆实现的优先级队列。<code>TaskQueue</code> 会按照任务距离下一次执行时间的大小将任务排序，保证在堆顶的任务最先执行。这样在需要执行任务时，每次只需要取出堆顶的任务运行即可！</p>\n<p><code>Timer</code> 使用起来比较简单，通过下面的方式我们就能创建一个 1s 之后执行的定时任务。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 示例代码：</span></span><br><span class=\"line\"><span class=\"type\">TimerTask</span> <span class=\"variable\">task</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TimerTask</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;当前时间: &quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>() + <span class=\"string\">&quot;n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;当前时间: &quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>() + <span class=\"string\">&quot;n&quot;</span> +</span><br><span class=\"line\">        <span class=\"string\">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class=\"line\"><span class=\"type\">Timer</span> <span class=\"variable\">timer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Timer</span>(<span class=\"string\">&quot;Timer&quot;</span>);</span><br><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">delay</span> <span class=\"operator\">=</span> <span class=\"number\">1000L</span>;</span><br><span class=\"line\">timer.schedule(task, delay);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//输出：</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">18</span>:<span class=\"number\">47</span> CST 2021n线程名称: main</span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">18</span>:<span class=\"number\">48</span> CST 2021n线程名称: Timer</span><br></pre></td></tr></table></figure>\n\n<p>不过其缺陷较多，比如一个 <code>Timer</code> 一个线程，这就导致 <code>Timer</code> 的任务的执行只能串行执行，一个任务执行时间过长的话会影响其他任务（性能非常差），再比如发生异常时任务直接停止（<code>Timer</code> 只捕获了 <code>InterruptedException</code> ）。</p>\n<p><code>Timer</code> 类上的有一段注释是这样写的：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">* This <span class=\"keyword\">class</span> <span class=\"title class_\">does</span> not offer real-time guarantees: it schedules</span><br><span class=\"line\">* tasks using the &lt;tt&gt;Object.wait(<span class=\"type\">long</span>)&lt;/tt&gt; method.</span><br><span class=\"line\">*Java <span class=\"number\">5.0</span> introduced the &#123;<span class=\"meta\">@code</span> java.util.concurrent&#125; <span class=\"keyword\">package</span> and</span><br><span class=\"line\">* one of the concurrency utilities therein is the &#123;<span class=\"meta\">@link</span></span><br><span class=\"line\">* java.util.concurrent.ScheduledThreadPoolExecutor</span><br><span class=\"line\">* ScheduledThreadPoolExecutor&#125; which is a thread pool <span class=\"keyword\">for</span> repeatedly</span><br><span class=\"line\">* executing tasks at a given rate or delay.  It is effectively a more</span><br><span class=\"line\">* versatile replacement <span class=\"keyword\">for</span> the &#123;<span class=\"meta\">@code</span> Timer&#125;/&#123;<span class=\"meta\">@code</span> TimerTask&#125;</span><br><span class=\"line\">* combination, as it allows multiple service threads, accepts various</span><br><span class=\"line\">* time units, and doesn<span class=\"string\">&#x27;t require subclassing &#123;@code TimerTask&#125; (just</span></span><br><span class=\"line\"><span class=\"string\">* implement &#123;@code Runnable&#125;).  Configuring &#123;@code</span></span><br><span class=\"line\"><span class=\"string\">* ScheduledThreadPoolExecutor&#125; with one thread makes it equivalent to</span></span><br><span class=\"line\"><span class=\"string\">* &#123;@code Timer&#125;.</span></span><br></pre></td></tr></table></figure>\n\n<p>大概的意思就是：<code>ScheduledThreadPoolExecutor</code> 支持多线程执行定时任务并且功能更强大，是 <code>Timer</code> 的替代品。</p>\n<h3 id=\"ScheduledExecutorService\"><a href=\"#ScheduledExecutorService\" class=\"headerlink\" title=\"ScheduledExecutorService\"></a>ScheduledExecutorService</h3><p><code>ScheduledExecutorService</code> 是一个接口，有多个实现类，比较常用的是 <code>ScheduledThreadPoolExecutor</code> 。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191603417.png\"></p>\n<p><code>ScheduledThreadPoolExecutor</code> 本身就是一个线程池，支持任务并发执行。并且，其内部使用 <code>DelayQueue</code> 作为任务队列.</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 示例代码：</span></span><br><span class=\"line\"><span class=\"type\">TimerTask</span> <span class=\"variable\">repeatedTask</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TimerTask</span>() &#123;</span><br><span class=\"line\">    <span class=\"meta\">@SneakyThrows</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;当前时间: &quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>() + <span class=\"string\">&quot;n&quot;</span> +</span><br><span class=\"line\">                <span class=\"string\">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">System.out.println(<span class=\"string\">&quot;当前时间: &quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>() + <span class=\"string\">&quot;n&quot;</span> +</span><br><span class=\"line\">        <span class=\"string\">&quot;线程名称: &quot;</span> + Thread.currentThread().getName());</span><br><span class=\"line\"><span class=\"type\">ScheduledExecutorService</span> <span class=\"variable\">executor</span> <span class=\"operator\">=</span> Executors.newScheduledThreadPool(<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">delay</span>  <span class=\"operator\">=</span> <span class=\"number\">1000L</span>;</span><br><span class=\"line\"><span class=\"type\">long</span> <span class=\"variable\">period</span> <span class=\"operator\">=</span> <span class=\"number\">1000L</span>;</span><br><span class=\"line\">executor.scheduleAtFixedRate(repeatedTask, delay, period, TimeUnit.MILLISECONDS);</span><br><span class=\"line\">Thread.sleep(delay + period * <span class=\"number\">5</span>);</span><br><span class=\"line\">executor.shutdown();</span><br><span class=\"line\"><span class=\"comment\">//输出：</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">46</span> CST 2021n线程名称: main</span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">47</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">1</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">48</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">1</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">49</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">2</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">50</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">2</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">51</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">2</span></span><br><span class=\"line\">当前时间: Fri May <span class=\"number\">28</span> <span class=\"number\">15</span>:<span class=\"number\">40</span>:<span class=\"number\">52</span> CST 2021n线程名称: pool-<span class=\"number\">1</span>-thread-<span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n\n<p>不论是使用 <code>Timer</code> 还是 <code>ScheduledExecutorService</code> 都无法使用 Cron 表达式指定任务执行的具体时间。</p>\n<h3 id=\"Spring-Task\"><a href=\"#Spring-Task\" class=\"headerlink\" title=\"Spring Task\"></a>Spring Task</h3><p>我们直接通过 Spring 提供的 <code>@Scheduled</code> 注解即可定义定时任务，非常方便！</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * cron：使用Cron表达式。 每分钟的1，2秒运行</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Scheduled(cron = &quot;1-2 * * * * ? &quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">reportCurrentTimeWithCronExpression</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">  log.info(<span class=\"string\">&quot;Cron Expression: The time is now &#123;&#125;&quot;</span>, dateFormat.format(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>并且，Spring Task 还是支持 <strong>Cron 表达式</strong> 的。Cron 表达式主要用于定时作业(定时任务)系统定义执行时间或执行频率的表达式，非常厉害，你可以通过 Cron 表达式进行设置定时任务每天或者每个月什么时候执行等等操作。咱们要学习定时任务的话，Cron 表达式是一定是要重点关注的。推荐一个在线 Cron 表达式生成器：<a href=\"http://cron.qqe2.com/\">http://cron.qqe2.com/</a> 。</p>\n<p>但是，Spring 自带的定时调度只支持单机，并且提供的功能比较单一。</p>\n<p>Spring Task 底层是基于 JDK 的 <code>ScheduledThreadPoolExecutor</code> 线程池来实现的。</p>\n<p><strong>优缺点总结：</strong></p>\n<ul>\n<li>优点：简单，轻量，支持 Cron 表达式</li>\n<li>缺点 ：功能单一</li>\n</ul>\n<h3 id=\"时间轮\"><a href=\"#时间轮\" class=\"headerlink\" title=\"时间轮\"></a>时间轮</h3><p>Kafka、Dubbo、ZooKeeper、Netty 、Caffeine 、Akka 中都有对时间轮的实现。</p>\n<p>时间轮简单来说就是一个环形的队列（底层一般基于数组实现），队列中的每一个元素（时间格）都可以存放一个定时任务列表。</p>\n<p>时间轮中的每个时间格代表了时间轮的基本时间跨度或者说时间精度，假如时间一秒走一个时间格的话，那么这个时间轮的最高精度就是 1 秒（也就是说 3 s 和 3.9s 会在同一个时间格中）。</p>\n<p>下图是一个有 12 个时间格的时间轮，转完一圈需要 12 s。当我们需要新建一个 3s 后执行的定时任务，只需要将定时任务放在下标为 3 的时间格中即可。当我们需要新建一个 9s 后执行的定时任务，只需要将定时任务放在下标为 9 的时间格中即可。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191604963.png\"></p>\n<p>那当我们需要创建一个 13s 后执行的定时任务怎么办呢？这个时候可以引入一叫做 <strong>圈数/轮数</strong> 的概念，也就是说这个任务还是放在下标为 3 的时间格中， 不过它的圈数为 2 。</p>\n<p>除了增加圈数这种方法之外，还有一种 <strong>多层次时间轮</strong> （类似手表），Kafka 采用的就是这种方案。</p>\n<p>针对下图的时间轮，举一个例子便于大家理解。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191604537.png\"></p>\n<p>上图的时间轮，第 1 层的时间精度为 1 ，第 2 层的时间精度为 20 ，第 3 层的时间精度为 400。假如我们需要添加一个 350s 后执行的任务 A 的话（当前时间是 0s），这个任务会被放在第 2 层（因为第二层的时间跨度为 20*20=400&gt;350）的第 350/20=17 个时间格子。</p>\n<p>当第一层转了 17 圈之后，时间过去了 340s ，第 2 层的指针此时来到第 17 个时间格子。此时，第 2 层第 17 个格子的任务会被移动到第 1 层。</p>\n<p>任务 A 当前是 10s 之后执行，因此它会被移动到第 1 层的第 10 个时间格子。</p>\n<p>这里在层与层之间的移动也叫做时间轮的升降级。参考手表来理解就好！</p>\n<p><strong>时间轮比较适合任务数量比较多的定时任务场景，它的任务写入和执行的时间复杂度都是 0（1）。</strong></p>\n<h2 id=\"分布式定时任务技术选型\"><a href=\"#分布式定时任务技术选型\" class=\"headerlink\" title=\"分布式定时任务技术选型\"></a>分布式定时任务技术选型</h2><p>上面提到的一些定时任务的解决方案都是在单机下执行的，适用于比较简单的定时任务场景比如每天凌晨备份一次数据。</p>\n<p>如果我们需要一些高级特性比如支持任务在分布式场景下的分片和高可用的话，我们就需要用到分布式任务调度框架了。</p>\n<p>通常情况下，一个定时任务的执行往往涉及到下面这些角色：</p>\n<ul>\n<li><strong>任务</strong> ：首先肯定是要执行的任务，这个任务就是具体的业务逻辑比如定时发送文章。</li>\n<li><strong>调度器</strong> ：其次是调度中心，调度中心主要负责任务管理，会分配任务给执行器。</li>\n<li><strong>执行器</strong> ：最后就是执行器，执行器接收调度器分派的任务并执行。</li>\n</ul>\n<h3 id=\"Quartz\"><a href=\"#Quartz\" class=\"headerlink\" title=\"Quartz\"></a>Quartz</h3><p>一个很火的开源任务调度框架，完全由<code>Java</code>写成。<code>Quartz</code> 可以说是 Java 定时任务领域的老大哥或者说参考标准，其他的任务调度框架基本都是基于 <code>Quartz</code> 开发的，比如当当网的<code>elastic-job</code>就是基于<code>quartz</code>二次开发之后的分布式调度解决方案。</p>\n<p>使用 <code>Quartz</code> 可以很方便地与 <code>Spring</code> 集成，并且支持动态添加任务和集群。但是，<code>Quartz</code> 使用起来也比较麻烦，API 繁琐。</p>\n<p>并且，<code>Quzrtz</code> 并没有内置 UI 管理控制台，不过你可以使用 quartzui 这个开源项目来解决这个问题。</p>\n<p>另外，<code>Quartz</code> 虽然也支持分布式任务。但是，它是在数据库层面，通过数据库的锁机制做的，有非常多的弊端比如系统侵入性严重、节点负载不均衡。有点伪分布式的味道。</p>\n<p><strong>优缺点总结：</strong></p>\n<ul>\n<li>优点：可以与 <code>Spring</code> 集成，并且支持动态添加任务和集群。</li>\n<li>缺点 ：分布式支持不友好，没有内置 UI 管理控制台、使用麻烦（相比于其他同类型框架来说）</li>\n</ul>\n<h3 id=\"Elastic-Job\"><a href=\"#Elastic-Job\" class=\"headerlink\" title=\"Elastic-Job\"></a>Elastic-Job</h3><p><code>Elastic-Job</code> 是当当网开源的一个基于<code>Quartz</code>和<code>ZooKeeper</code>的分布式调度解决方案，由两个相互独立的子项目 <code>Elastic-Job-Lite</code> 和 <code>Elastic-Job-Cloud</code> 组成，一般我们只要使用 <code>Elastic-Job-Lite</code> 就好。</p>\n<p><code>ElasticJob</code> 支持任务在分布式场景下的分片和高可用、任务可视化管理等功能。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191604600.png\"></p>\n<p>ElasticJob-Lite 的架构设计如下图所示：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191604416.png\" alt=\"imageselasticJob.png\"></p>\n<p>从上图可以看出，<code>Elastic-Job</code> 没有调度中心这一概念，而是使用 <code>ZooKeeper</code> 作为注册中心，注册中心负责协调分配任务到不同的节点上。</p>\n<p>Elastic-Job 中的定时调度都是由执行器自行触发，这种设计也被称为去中心化设计（调度和处理都是执行器单独完成）。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@ElasticJobConf(name = &quot;dayJob&quot;, cron = &quot;0/10 * * * * ?&quot;, shardingTotalCount = 2,</span></span><br><span class=\"line\"><span class=\"meta\">        shardingItemParameters = &quot;0=AAAA,1=BBBB&quot;, description = &quot;简单任务&quot;, failover = true)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestJob</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">SimpleJob</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">execute</span><span class=\"params\">(ShardingContext shardingContext)</span> &#123;</span><br><span class=\"line\">        log.info(<span class=\"string\">&quot;TestJob任务名：【&#123;&#125;】, 片数：【&#123;&#125;】, param=【&#123;&#125;】&quot;</span>, shardingContext.getJobName(), shardingContext.getShardingTotalCount(),</span><br><span class=\"line\">                shardingContext.getShardingParameter());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>优缺点总结：</strong></p>\n<ul>\n<li>优点 ：可以与 <code>Spring</code> 集成、支持分布式、支持集群、性能不错</li>\n<li>缺点 ：依赖了额外的中间件比如 Zookeeper（复杂度增加，可靠性降低、维护成本变高）</li>\n</ul>\n<h3 id=\"XXL-JOB\"><a href=\"#XXL-JOB\" class=\"headerlink\" title=\"XXL-JOB\"></a>XXL-JOB</h3><p><code>XXL-JOB</code> 于 2015 年开源，是一款优秀的轻量级分布式任务调度框架，支持任务可视化管理、弹性扩容缩容、任务失败重试和告警、任务分片等功能。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191605412.png\"></p>\n<p>根据 <code>XXL-JOB</code> 官网介绍，其解决了很多 <code>Quartz</code> 的不足。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191605529.png\"></p>\n<p><code>XXL-JOB</code> 的架构设计如下图所示：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191605002.png\"></p>\n<p>从上图可以看出，<code>XXL-JOB</code> 由 <strong>调度中心</strong> 和 <strong>执行器</strong> 两大部分组成。调度中心主要负责任务管理、执行器管理以及日志管理。执行器主要是接收调度信号并处理。另外，调度中心进行任务调度时，是通过自研 RPC 来实现的。</p>\n<p>不同于 <code>Elastic-Job</code> 的去中心化设计， <code>XXL-JOB</code> 的这种设计也被称为中心化设计（调度中心调度多个执行器执行任务）。</p>\n<p>和 <code>Quzrtz</code> 类似 <code>XXL-JOB</code> 也是基于数据库锁调度任务，存在性能瓶颈。不过，一般在任务量不是特别大的情况下，没有什么影响的，可以满足绝大部分公司的要求。</p>\n<p>不要被 <code>XXL-JOB</code> 的架构图给吓着了，实际上，我们要用 <code>XXL-JOB</code> 的话，只需要重写 <code>IJobHandler</code> 自定义任务执行逻辑就可以了，非常易用！</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@JobHandler(value=&quot;myApiJobHandler&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyApiJobHandler</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">IJobHandler</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> ReturnT&lt;String&gt; <span class=\"title function_\">execute</span><span class=\"params\">(String param)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">//......</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> ReturnT.SUCCESS;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>还可以直接基于注解定义任务。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@XxlJob(&quot;myAnnotationJobHandler&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ReturnT&lt;String&gt; <span class=\"title function_\">myAnnotationJobHandler</span><span class=\"params\">(String param)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">  <span class=\"comment\">//......</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> ReturnT.SUCCESS;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191605193.png\"></p>\n<p><strong>优缺点总结：</strong></p>\n<ul>\n<li>优点：开箱即用（学习成本比较低）、与 Spring 集成、支持分布式、支持集群、内置了 UI 管理控制台。</li>\n<li>缺点：不支持动态添加任务（如果一定想要动态创建任务也是支持的，参见：xxl-job issue277）。</li>\n</ul>\n<h3 id=\"PowerJob\"><a href=\"#PowerJob\" class=\"headerlink\" title=\"PowerJob\"></a>PowerJob</h3><p>非常值得关注的一个分布式任务调度框架，分布式任务调度领域的新星。目前，已经有很多公司接入比如 OPPO、京东、中通、思科。</p>\n<p>这个框架的诞生也挺有意思的，PowerJob 的作者当时在阿里巴巴实习过，阿里巴巴那会使用的是内部自研的 SchedulerX（阿里云付费产品）。实习期满之后，PowerJob 的作者离开了阿里巴巴。想着说自研一个 SchedulerX，防止哪天 SchedulerX 满足不了需求，于是 PowerJob 就诞生了。</p>\n<p>更多关于 PowerJob 的故事，小伙伴们可以去看看 PowerJob 作者的视频 《我和我的任务调度中间件》。简单点概括就是：“游戏没啥意思了，我要扛起了新一代分布式任务调度与计算框架的大旗！”。</p>\n<p>由于 SchedulerX 属于人民币产品，这里就不过多介绍。PowerJob 官方也对比过其和 QuartZ、XXL-JOB 以及 SchedulerX。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191605537.png\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>这篇文章中，主要介绍了：</p>\n<ul>\n<li><strong>定时任务的相关概念</strong> ：为什么需要定时任务、定时任务中的核心角色、分布式定时任务。</li>\n<li><strong>定时任务的技术选型</strong> ：XXL-JOB 2015 年推出，已经经过了很多年的考验。XXL-JOB 轻量级，并且使用起来非常简单。虽然存在性能瓶颈，但是，在绝大多数情况下，对于企业的基本需求来说是没有影响的。PowerJob 属于分布式任务调度领域里的新星，其稳定性还有待继续考察。ElasticJob 由于在架构设计上是基于 Zookeeper ，而 XXL-JOB 是基于数据库，性能方面的话，ElasticJob 略胜一筹。</li>\n</ul>\n"},{"uuid":"bbaf210a-c0ab-11ec-92a1-7557b2313227","title":"SPI机制","abbrlink":"f13620b0","_content":"\n# Java中SPI机制\n\n# 1 SPI是什么\n\nSPI全称Service Provider Interface，是Java提供的一套用来被第三方实现或者扩展的API，它可以用来启用框架扩展和替换组件。\n\n整体机制图如下：\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191602301.png)\n\nJava SPI 实际上是“**基于接口的编程＋策略模式＋配置文件**”组合实现的动态加载机制。\n\n系统设计的各个抽象，往往有很多不同的实现方案，在面向的对象的设计里，一般推荐模块之间基于接口编程，模块之间不对实现类进行硬编码。一旦代码里涉及具体的实现类，就违反了可拔插的原则，如果需要替换一种实现，就需要修改代码。为了实现在模块装配的时候能不在程序里动态指明，这就需要一种服务发现机制。\n Java SPI就是提供这样的一个机制：为某个接口寻找服务实现的机制。有点类似IOC的思想，就是将装配的控制权移到程序之外，在模块化设计中这个机制尤其重要。所以SPI的核心思想就是**解耦**。\n\n# 2 使用场景\n\n概括地说，适用于：**调用者根据实际使用需要，启用、扩展、或者替换框架的实现策略**\n\n比较常见的例子：\n\n- 数据库驱动加载接口实现类的加载\n   JDBC加载不同类型数据库的驱动\n- 日志门面接口实现类加载\n   SLF4J加载不同提供商的日志实现类\n- Spring\n   Spring中大量使用了SPI,比如：对servlet3.0规范对ServletContainerInitializer的实现、自动类型转换Type Conversion SPI(Converter SPI、Formatter SPI)等\n- Dubbo\n   Dubbo中也大量使用SPI的方式实现框架的扩展, 不过它对Java提供的原生SPI做了封装，允许用户扩展实现Filter接口\n\n# 3 使用介绍\n\n要使用Java SPI，需要遵循如下约定：\n\n- 1、当服务提供者提供了接口的一种具体实现后，在jar包的META-INF/services目录下创建一个以“接口全限定名”为命名的文件，内容为实现类的全限定名；\n- 2、接口实现类所在的jar包放在主程序的classpath中；\n- 3、主程序通过java.util.ServiceLoder动态装载实现模块，它通过扫描META-INF/services目录下的配置文件找到实现类的全限定名，把类加载到JVM；\n- 4、SPI的实现类必须携带一个不带参数的构造方法；\n\n## 示例代码\n\n## song-parser 项目\n\nsong-parser 项目定义了通用的歌曲解析接口，并不提供具体的解析实现。在 song-parser 项目定义了下面两个关键的接口和类：Parser 接口、ParserManager 类。\n\n- Parser 接口\n\n  定义了抽象的解析方法，传入歌曲的数据，返回歌曲的信息。\n\n  ```java\n  public interface Parser {\n      Song parse(byte[] data) throws Exception;\n  }\n  ```\n\n- ParseManager 类\n\n  主要包括两个三个部分：\n\n  `loadInitialParsers()` 用于程序启动时初始化所有的歌曲解析器。\n\n  `ParserManager.registerParser()`用于歌曲解析器的注册。\n\n  `ParserManager.getSong()`提供了获取歌曲信息的方法。\n\n  ```java\n  public class ParserManager {\n  \n      private final static CopyOnWriteArrayList<ParserInfo> registeredParsers = new CopyOnWriteArrayList<>();\n  \n      static {\n          loadInitialParsers();\n          System.out.println(\"SongParser initialized\");\n      }\n  \n      private static void loadInitialParsers() {\n          ServiceLoader<Parser> loadedParsers = ServiceLoader.load(Parser.class);\n          Iterator<Parser> driversIterator = loadedParsers.iterator();\n          try{\n              while(driversIterator.hasNext()) {\n                  driversIterator.next();\n              }\n          } catch(Throwable t) {\n              // Do nothing\n          }\n      }\n  \n      public static synchronized void registerParser(Parser parser) {\n          registeredParsers.add(new ParserInfo(parser));\n      }\n  \n      public static Song getSong(byte[] data) {\n          for (ParserInfo parserInfo : registeredParsers) {\n              try {\n                  Song song = parserInfo.parser.parse(data);\n                  if (song != null) {\n                      return song;\n                  }\n              } catch (Exception e) {\n                  //wrong parser, ignored it.\n              }\n          }\n          throw new ParserNotFoundException(\"10001\", \"Can not find corresponding data:\" + new String(data));\n      }\n  }\n  ```\n\n  其实上面的几个方法对应了 Service Provider Framework 的四个概念：\n\n  - **Service Interface 服务接口**，这里对应 Song 接口。\n  - **Provider Registration API 用户注册接口**，这里对应 ParserManager.registerParser() 方法。\n  - **Service Access API 获取服务实例方法**，这里对应 ParserManager.getSong() 方法。\n  - **Service Provider Interface 创建服务实现的接口**，这里对应 Parser 接口。\n\n  所有借助 Java SPI 机制实现的框架，除了 **Service Interface 服务接口**不是必须的之外，其他三个都是必须要有的。\n\n  这里我们用 mp3 歌曲解析器为例，来看看到底是如何实现的插件式的歌曲解析的。\n\n  在 song-parse-mp3 项目中有两个类和一个描述文件，分别是：Parser 文件、Parser 类和 Mp3Parser 类。\n\n  - Parser 文件\n\n    该文件位于`/resources/META-INF/services`目录下，包含如下地址：`com.xiaohei.demo.Parser`，表示歌曲解析的具体实现类。\n\n  - Parser 类\n\n    在 Parser 类中，其调用 ParserManager.registerParser() 类将解析器注册到一个 List 集合中。\n\n    ```java\n    public class Parser extends Mp3Parser implements com.chenshuyi.demo.Parser {\n        static\n        {\n            try\n            {\n                ParserManager.registerParser(new Parser());\n            }\n            catch (Exception e)\n            {\n                throw new RuntimeException(\"Can't register parser!\");\n            }\n        }\n    }\n    ```\n\n  - Mp3Parser 类\n\n    而在 Parser.parse() 方法中，则实现了具体的解析业务逻辑。\n\n    ```java\n    public class Mp3Parser implements Parser {\n    \n        public final byte[] FORMAT = \"MP3\".getBytes();\n    \n        public final int FORMAT_LENGTH = FORMAT.length;\n    \n        @Override\n        public Song parse(byte[] data) throws Exception{\n            if (!isDataCompatible(data)) {\n                throw new Exception(\"data format is wrong.\");\n            }\n            //parse data by mp3 format type\n            return new Song(\"刘千楚\", \"mp3\", \"《北京东路的日子》\", 220L);\n        }\n    \n        private boolean isDataCompatible(byte[] data) {\n            byte[] format = Arrays.copyOfRange(data, 0, FORMAT_LENGTH);\n            return Arrays.equals(format, FORMAT);\n        }\n    }\n    ```\n\n    当我们调用以下语句去获取歌曲信息时，因为 ParserManager.getSong() 是静态方法，所以会先初始化 ParserManager 类。\n\n    ```\n    Song song = ParserManager.getSong(mockSongData(\"MP3\"));\n    ```\n\n    在 ParserManager 类中有下面这段代码：\n\n    ```java\n    static {\n        loadInitialParsers();\n        System.out.println(\"SongParser initialized\");\n    }\n    ```\n\n    在 loadInitialParsers() 方法中，调用了 Java 的 ServiceLoader 类获取 Parser 接口的所有实现。\n\n    ```java\n    private static void loadInitialParsers() {\n        ServiceLoader<Parser> loadedParsers = ServiceLoader.load(Parser.class);\n        Iterator<Parser> driversIterator = loadedParsers.iterator();\n        try{\n            while(driversIterator.hasNext()) {\n                driversIterator.next();\n            }\n        } catch(Throwable t) {\n            // Do nothing\n        }\n    }\n    ```\n\n    当 ParserManager 初始化完成之后，就调用 getSong() 静态方法。\n\n    ```java\n    public static Song getSong(byte[] data) {\n        for (ParserInfo parserInfo : registeredParsers) {\n            try {\n                Song song = parserInfo.parser.parse(data);\n                if (song != null) {\n                    return song;\n                }\n            } catch (Exception e) {\n                //wrong parser, ignored it.\n            }\n        }\n        throw new ParserNotFoundException(\"10001\", \"Can not find corresponding data:\" + new String(data));\n    }\n    ```\n\n    其实 loadInitialParsers() 方法运行之后，是将所有 Parser 接口的所有视线都放到了 ParserManager.registeredParsers 这个 List 中。\n\n    `[参考地址](https://github.com/chenyurong/song-parser-spi-demo)`\n\n# 4 原理解析\n\n首先看ServiceLoader类的签名类的成员变量：\n\n```java\npublic final class ServiceLoader<S> implements Iterable<S>{\nprivate static final String PREFIX = \"META-INF/services/\";\n\n    // 代表被加载的类或者接口\n    private final Class<S> service;\n\n    // 用于定位，加载和实例化providers的类加载器\n    private final ClassLoader loader;\n\n    // 创建ServiceLoader时采用的访问控制上下文\n    private final AccessControlContext acc;\n\n    // 缓存providers，按实例化的顺序排列\n    private LinkedHashMap<String,S> providers = new LinkedHashMap<>();\n\n    // 懒查找迭代器\n    private LazyIterator lookupIterator;\n  \n    ......\n}\n```\n\n参考具体ServiceLoader具体源码，代码量不多，加上注释一共587行，梳理了一下，实现的流程如下：\n\n- 1 应用程序调用ServiceLoader.load方法\n   ServiceLoader.load方法内先创建一个新的ServiceLoader，并实例化该类中的成员变量，包括：\n\n  - loader(ClassLoader类型，类加载器)\n  - acc(AccessControlContext类型，访问控制器)\n  - providers(LinkedHashMap<String,S>类型，用于缓存加载成功的类)\n  - lookupIterator(实现迭代器功能)\n\n- 2 应用程序通过迭代器接口获取对象实例\n   ServiceLoader先判断成员变量providers对象中(LinkedHashMap<String,S>类型)是否有缓存实例对象，如果有缓存，直接返回。\n   如果没有缓存，执行类的装载，实现如下：\n\n- (1) 读取META-INF/services/下的配置文件，获得所有能被实例化的类的名称，值得注意的是，ServiceLoader**可以跨越jar包获取META-INF下的配置文件**，具体加载配置的实现代码如下：\n\n  ```java\n          try {\n              String fullName = PREFIX + service.getName();\n              if (loader == null)\n                  configs = ClassLoader.getSystemResources(fullName);\n              else\n                  configs = loader.getResources(fullName);\n          } catch (IOException x) {\n              fail(service, \"Error locating configuration files\", x);\n          }\n  ```\n\n  (2) 通过反射方法Class.forName()加载类对象，并用instance()方法将类实例化。\n\n  (3) 把实例化后的类缓存到providers对象中，(LinkedHashMap<String,S>类型）然后返回实例对象。\n","source":"_posts/java/spi.md","raw":"---\nuuid: bbaf210a-c0ab-11ec-92a1-7557b2313227\ntitle: SPI机制\ncategories: Java\ntags:\n  - spi\nabbrlink: f13620b0\n---\n\n# Java中SPI机制\n\n# 1 SPI是什么\n\nSPI全称Service Provider Interface，是Java提供的一套用来被第三方实现或者扩展的API，它可以用来启用框架扩展和替换组件。\n\n整体机制图如下：\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191602301.png)\n\nJava SPI 实际上是“**基于接口的编程＋策略模式＋配置文件**”组合实现的动态加载机制。\n\n系统设计的各个抽象，往往有很多不同的实现方案，在面向的对象的设计里，一般推荐模块之间基于接口编程，模块之间不对实现类进行硬编码。一旦代码里涉及具体的实现类，就违反了可拔插的原则，如果需要替换一种实现，就需要修改代码。为了实现在模块装配的时候能不在程序里动态指明，这就需要一种服务发现机制。\n Java SPI就是提供这样的一个机制：为某个接口寻找服务实现的机制。有点类似IOC的思想，就是将装配的控制权移到程序之外，在模块化设计中这个机制尤其重要。所以SPI的核心思想就是**解耦**。\n\n# 2 使用场景\n\n概括地说，适用于：**调用者根据实际使用需要，启用、扩展、或者替换框架的实现策略**\n\n比较常见的例子：\n\n- 数据库驱动加载接口实现类的加载\n   JDBC加载不同类型数据库的驱动\n- 日志门面接口实现类加载\n   SLF4J加载不同提供商的日志实现类\n- Spring\n   Spring中大量使用了SPI,比如：对servlet3.0规范对ServletContainerInitializer的实现、自动类型转换Type Conversion SPI(Converter SPI、Formatter SPI)等\n- Dubbo\n   Dubbo中也大量使用SPI的方式实现框架的扩展, 不过它对Java提供的原生SPI做了封装，允许用户扩展实现Filter接口\n\n# 3 使用介绍\n\n要使用Java SPI，需要遵循如下约定：\n\n- 1、当服务提供者提供了接口的一种具体实现后，在jar包的META-INF/services目录下创建一个以“接口全限定名”为命名的文件，内容为实现类的全限定名；\n- 2、接口实现类所在的jar包放在主程序的classpath中；\n- 3、主程序通过java.util.ServiceLoder动态装载实现模块，它通过扫描META-INF/services目录下的配置文件找到实现类的全限定名，把类加载到JVM；\n- 4、SPI的实现类必须携带一个不带参数的构造方法；\n\n## 示例代码\n\n## song-parser 项目\n\nsong-parser 项目定义了通用的歌曲解析接口，并不提供具体的解析实现。在 song-parser 项目定义了下面两个关键的接口和类：Parser 接口、ParserManager 类。\n\n- Parser 接口\n\n  定义了抽象的解析方法，传入歌曲的数据，返回歌曲的信息。\n\n  ```java\n  public interface Parser {\n      Song parse(byte[] data) throws Exception;\n  }\n  ```\n\n- ParseManager 类\n\n  主要包括两个三个部分：\n\n  `loadInitialParsers()` 用于程序启动时初始化所有的歌曲解析器。\n\n  `ParserManager.registerParser()`用于歌曲解析器的注册。\n\n  `ParserManager.getSong()`提供了获取歌曲信息的方法。\n\n  ```java\n  public class ParserManager {\n  \n      private final static CopyOnWriteArrayList<ParserInfo> registeredParsers = new CopyOnWriteArrayList<>();\n  \n      static {\n          loadInitialParsers();\n          System.out.println(\"SongParser initialized\");\n      }\n  \n      private static void loadInitialParsers() {\n          ServiceLoader<Parser> loadedParsers = ServiceLoader.load(Parser.class);\n          Iterator<Parser> driversIterator = loadedParsers.iterator();\n          try{\n              while(driversIterator.hasNext()) {\n                  driversIterator.next();\n              }\n          } catch(Throwable t) {\n              // Do nothing\n          }\n      }\n  \n      public static synchronized void registerParser(Parser parser) {\n          registeredParsers.add(new ParserInfo(parser));\n      }\n  \n      public static Song getSong(byte[] data) {\n          for (ParserInfo parserInfo : registeredParsers) {\n              try {\n                  Song song = parserInfo.parser.parse(data);\n                  if (song != null) {\n                      return song;\n                  }\n              } catch (Exception e) {\n                  //wrong parser, ignored it.\n              }\n          }\n          throw new ParserNotFoundException(\"10001\", \"Can not find corresponding data:\" + new String(data));\n      }\n  }\n  ```\n\n  其实上面的几个方法对应了 Service Provider Framework 的四个概念：\n\n  - **Service Interface 服务接口**，这里对应 Song 接口。\n  - **Provider Registration API 用户注册接口**，这里对应 ParserManager.registerParser() 方法。\n  - **Service Access API 获取服务实例方法**，这里对应 ParserManager.getSong() 方法。\n  - **Service Provider Interface 创建服务实现的接口**，这里对应 Parser 接口。\n\n  所有借助 Java SPI 机制实现的框架，除了 **Service Interface 服务接口**不是必须的之外，其他三个都是必须要有的。\n\n  这里我们用 mp3 歌曲解析器为例，来看看到底是如何实现的插件式的歌曲解析的。\n\n  在 song-parse-mp3 项目中有两个类和一个描述文件，分别是：Parser 文件、Parser 类和 Mp3Parser 类。\n\n  - Parser 文件\n\n    该文件位于`/resources/META-INF/services`目录下，包含如下地址：`com.xiaohei.demo.Parser`，表示歌曲解析的具体实现类。\n\n  - Parser 类\n\n    在 Parser 类中，其调用 ParserManager.registerParser() 类将解析器注册到一个 List 集合中。\n\n    ```java\n    public class Parser extends Mp3Parser implements com.chenshuyi.demo.Parser {\n        static\n        {\n            try\n            {\n                ParserManager.registerParser(new Parser());\n            }\n            catch (Exception e)\n            {\n                throw new RuntimeException(\"Can't register parser!\");\n            }\n        }\n    }\n    ```\n\n  - Mp3Parser 类\n\n    而在 Parser.parse() 方法中，则实现了具体的解析业务逻辑。\n\n    ```java\n    public class Mp3Parser implements Parser {\n    \n        public final byte[] FORMAT = \"MP3\".getBytes();\n    \n        public final int FORMAT_LENGTH = FORMAT.length;\n    \n        @Override\n        public Song parse(byte[] data) throws Exception{\n            if (!isDataCompatible(data)) {\n                throw new Exception(\"data format is wrong.\");\n            }\n            //parse data by mp3 format type\n            return new Song(\"刘千楚\", \"mp3\", \"《北京东路的日子》\", 220L);\n        }\n    \n        private boolean isDataCompatible(byte[] data) {\n            byte[] format = Arrays.copyOfRange(data, 0, FORMAT_LENGTH);\n            return Arrays.equals(format, FORMAT);\n        }\n    }\n    ```\n\n    当我们调用以下语句去获取歌曲信息时，因为 ParserManager.getSong() 是静态方法，所以会先初始化 ParserManager 类。\n\n    ```\n    Song song = ParserManager.getSong(mockSongData(\"MP3\"));\n    ```\n\n    在 ParserManager 类中有下面这段代码：\n\n    ```java\n    static {\n        loadInitialParsers();\n        System.out.println(\"SongParser initialized\");\n    }\n    ```\n\n    在 loadInitialParsers() 方法中，调用了 Java 的 ServiceLoader 类获取 Parser 接口的所有实现。\n\n    ```java\n    private static void loadInitialParsers() {\n        ServiceLoader<Parser> loadedParsers = ServiceLoader.load(Parser.class);\n        Iterator<Parser> driversIterator = loadedParsers.iterator();\n        try{\n            while(driversIterator.hasNext()) {\n                driversIterator.next();\n            }\n        } catch(Throwable t) {\n            // Do nothing\n        }\n    }\n    ```\n\n    当 ParserManager 初始化完成之后，就调用 getSong() 静态方法。\n\n    ```java\n    public static Song getSong(byte[] data) {\n        for (ParserInfo parserInfo : registeredParsers) {\n            try {\n                Song song = parserInfo.parser.parse(data);\n                if (song != null) {\n                    return song;\n                }\n            } catch (Exception e) {\n                //wrong parser, ignored it.\n            }\n        }\n        throw new ParserNotFoundException(\"10001\", \"Can not find corresponding data:\" + new String(data));\n    }\n    ```\n\n    其实 loadInitialParsers() 方法运行之后，是将所有 Parser 接口的所有视线都放到了 ParserManager.registeredParsers 这个 List 中。\n\n    `[参考地址](https://github.com/chenyurong/song-parser-spi-demo)`\n\n# 4 原理解析\n\n首先看ServiceLoader类的签名类的成员变量：\n\n```java\npublic final class ServiceLoader<S> implements Iterable<S>{\nprivate static final String PREFIX = \"META-INF/services/\";\n\n    // 代表被加载的类或者接口\n    private final Class<S> service;\n\n    // 用于定位，加载和实例化providers的类加载器\n    private final ClassLoader loader;\n\n    // 创建ServiceLoader时采用的访问控制上下文\n    private final AccessControlContext acc;\n\n    // 缓存providers，按实例化的顺序排列\n    private LinkedHashMap<String,S> providers = new LinkedHashMap<>();\n\n    // 懒查找迭代器\n    private LazyIterator lookupIterator;\n  \n    ......\n}\n```\n\n参考具体ServiceLoader具体源码，代码量不多，加上注释一共587行，梳理了一下，实现的流程如下：\n\n- 1 应用程序调用ServiceLoader.load方法\n   ServiceLoader.load方法内先创建一个新的ServiceLoader，并实例化该类中的成员变量，包括：\n\n  - loader(ClassLoader类型，类加载器)\n  - acc(AccessControlContext类型，访问控制器)\n  - providers(LinkedHashMap<String,S>类型，用于缓存加载成功的类)\n  - lookupIterator(实现迭代器功能)\n\n- 2 应用程序通过迭代器接口获取对象实例\n   ServiceLoader先判断成员变量providers对象中(LinkedHashMap<String,S>类型)是否有缓存实例对象，如果有缓存，直接返回。\n   如果没有缓存，执行类的装载，实现如下：\n\n- (1) 读取META-INF/services/下的配置文件，获得所有能被实例化的类的名称，值得注意的是，ServiceLoader**可以跨越jar包获取META-INF下的配置文件**，具体加载配置的实现代码如下：\n\n  ```java\n          try {\n              String fullName = PREFIX + service.getName();\n              if (loader == null)\n                  configs = ClassLoader.getSystemResources(fullName);\n              else\n                  configs = loader.getResources(fullName);\n          } catch (IOException x) {\n              fail(service, \"Error locating configuration files\", x);\n          }\n  ```\n\n  (2) 通过反射方法Class.forName()加载类对象，并用instance()方法将类实例化。\n\n  (3) 把实例化后的类缓存到providers对象中，(LinkedHashMap<String,S>类型）然后返回实例对象。\n","slug":"java/spi","published":1,"date":"2022-04-20T12:41:20.814Z","updated":"2022-05-04T03:18:42.288Z","_id":"cl2qzfthz003i13no7s967749","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Java中SPI机制\"><a href=\"#Java中SPI机制\" class=\"headerlink\" title=\"Java中SPI机制\"></a>Java中SPI机制</h1><h1 id=\"1-SPI是什么\"><a href=\"#1-SPI是什么\" class=\"headerlink\" title=\"1 SPI是什么\"></a>1 SPI是什么</h1><p>SPI全称Service Provider Interface，是Java提供的一套用来被第三方实现或者扩展的API，它可以用来启用框架扩展和替换组件。</p>\n<p>整体机制图如下：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191602301.png\"></p>\n<p>Java SPI 实际上是“<strong>基于接口的编程＋策略模式＋配置文件</strong>”组合实现的动态加载机制。</p>\n<p>系统设计的各个抽象，往往有很多不同的实现方案，在面向的对象的设计里，一般推荐模块之间基于接口编程，模块之间不对实现类进行硬编码。一旦代码里涉及具体的实现类，就违反了可拔插的原则，如果需要替换一种实现，就需要修改代码。为了实现在模块装配的时候能不在程序里动态指明，这就需要一种服务发现机制。<br> Java SPI就是提供这样的一个机制：为某个接口寻找服务实现的机制。有点类似IOC的思想，就是将装配的控制权移到程序之外，在模块化设计中这个机制尤其重要。所以SPI的核心思想就是<strong>解耦</strong>。</p>\n<h1 id=\"2-使用场景\"><a href=\"#2-使用场景\" class=\"headerlink\" title=\"2 使用场景\"></a>2 使用场景</h1><p>概括地说，适用于：<strong>调用者根据实际使用需要，启用、扩展、或者替换框架的实现策略</strong></p>\n<p>比较常见的例子：</p>\n<ul>\n<li>数据库驱动加载接口实现类的加载<br> JDBC加载不同类型数据库的驱动</li>\n<li>日志门面接口实现类加载<br> SLF4J加载不同提供商的日志实现类</li>\n<li>Spring<br> Spring中大量使用了SPI,比如：对servlet3.0规范对ServletContainerInitializer的实现、自动类型转换Type Conversion SPI(Converter SPI、Formatter SPI)等</li>\n<li>Dubbo<br> Dubbo中也大量使用SPI的方式实现框架的扩展, 不过它对Java提供的原生SPI做了封装，允许用户扩展实现Filter接口</li>\n</ul>\n<h1 id=\"3-使用介绍\"><a href=\"#3-使用介绍\" class=\"headerlink\" title=\"3 使用介绍\"></a>3 使用介绍</h1><p>要使用Java SPI，需要遵循如下约定：</p>\n<ul>\n<li>1、当服务提供者提供了接口的一种具体实现后，在jar包的META-INF/services目录下创建一个以“接口全限定名”为命名的文件，内容为实现类的全限定名；</li>\n<li>2、接口实现类所在的jar包放在主程序的classpath中；</li>\n<li>3、主程序通过java.util.ServiceLoder动态装载实现模块，它通过扫描META-INF/services目录下的配置文件找到实现类的全限定名，把类加载到JVM；</li>\n<li>4、SPI的实现类必须携带一个不带参数的构造方法；</li>\n</ul>\n<h2 id=\"示例代码\"><a href=\"#示例代码\" class=\"headerlink\" title=\"示例代码\"></a>示例代码</h2><h2 id=\"song-parser-项目\"><a href=\"#song-parser-项目\" class=\"headerlink\" title=\"song-parser 项目\"></a>song-parser 项目</h2><p>song-parser 项目定义了通用的歌曲解析接口，并不提供具体的解析实现。在 song-parser 项目定义了下面两个关键的接口和类：Parser 接口、ParserManager 类。</p>\n<ul>\n<li><p>Parser 接口</p>\n<p>定义了抽象的解析方法，传入歌曲的数据，返回歌曲的信息。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Parser</span> &#123;</span><br><span class=\"line\">    Song <span class=\"title function_\">parse</span><span class=\"params\">(<span class=\"type\">byte</span>[] data)</span> <span class=\"keyword\">throws</span> Exception;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>ParseManager 类</p>\n<p>主要包括两个三个部分：</p>\n<p><code>loadInitialParsers()</code> 用于程序启动时初始化所有的歌曲解析器。</p>\n<p><code>ParserManager.registerParser()</code>用于歌曲解析器的注册。</p>\n<p><code>ParserManager.getSong()</code>提供了获取歌曲信息的方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ParserManager</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> CopyOnWriteArrayList&lt;ParserInfo&gt; registeredParsers = <span class=\"keyword\">new</span> <span class=\"title class_\">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        loadInitialParsers();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;SongParser initialized&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">loadInitialParsers</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        ServiceLoader&lt;Parser&gt; loadedParsers = ServiceLoader.load(Parser.class);</span><br><span class=\"line\">        Iterator&lt;Parser&gt; driversIterator = loadedParsers.iterator();</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(driversIterator.hasNext()) &#123;</span><br><span class=\"line\">                driversIterator.next();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span>(Throwable t) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Do nothing</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">registerParser</span><span class=\"params\">(Parser parser)</span> &#123;</span><br><span class=\"line\">        registeredParsers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">ParserInfo</span>(parser));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Song <span class=\"title function_\">getSong</span><span class=\"params\">(<span class=\"type\">byte</span>[] data)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (ParserInfo parserInfo : registeredParsers) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">Song</span> <span class=\"variable\">song</span> <span class=\"operator\">=</span> parserInfo.parser.parse(data);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (song != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> song;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//wrong parser, ignored it.</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ParserNotFoundException</span>(<span class=\"string\">&quot;10001&quot;</span>, <span class=\"string\">&quot;Can not find corresponding data:&quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(data));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>其实上面的几个方法对应了 Service Provider Framework 的四个概念：</p>\n<ul>\n<li><strong>Service Interface 服务接口</strong>，这里对应 Song 接口。</li>\n<li><strong>Provider Registration API 用户注册接口</strong>，这里对应 ParserManager.registerParser() 方法。</li>\n<li><strong>Service Access API 获取服务实例方法</strong>，这里对应 ParserManager.getSong() 方法。</li>\n<li><strong>Service Provider Interface 创建服务实现的接口</strong>，这里对应 Parser 接口。</li>\n</ul>\n<p>所有借助 Java SPI 机制实现的框架，除了 <strong>Service Interface 服务接口</strong>不是必须的之外，其他三个都是必须要有的。</p>\n<p>这里我们用 mp3 歌曲解析器为例，来看看到底是如何实现的插件式的歌曲解析的。</p>\n<p>在 song-parse-mp3 项目中有两个类和一个描述文件，分别是：Parser 文件、Parser 类和 Mp3Parser 类。</p>\n<ul>\n<li><p>Parser 文件</p>\n<p>该文件位于<code>/resources/META-INF/services</code>目录下，包含如下地址：<code>com.xiaohei.demo.Parser</code>，表示歌曲解析的具体实现类。</p>\n</li>\n<li><p>Parser 类</p>\n<p>在 Parser 类中，其调用 ParserManager.registerParser() 类将解析器注册到一个 List 集合中。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Parser</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Mp3Parser</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">com</span>.chenshuyi.demo.Parser &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ParserManager.registerParser(<span class=\"keyword\">new</span> <span class=\"title class_\">Parser</span>());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">catch</span> (Exception e)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;Can&#x27;t register parser!&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>Mp3Parser 类</p>\n<p>而在 Parser.parse() 方法中，则实现了具体的解析业务逻辑。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Mp3Parser</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Parser</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">byte</span>[] FORMAT = <span class=\"string\">&quot;MP3&quot;</span>.getBytes();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">FORMAT_LENGTH</span> <span class=\"operator\">=</span> FORMAT.length;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Song <span class=\"title function_\">parse</span><span class=\"params\">(<span class=\"type\">byte</span>[] data)</span> <span class=\"keyword\">throws</span> Exception&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!isDataCompatible(data)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Exception</span>(<span class=\"string\">&quot;data format is wrong.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//parse data by mp3 format type</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Song</span>(<span class=\"string\">&quot;刘千楚&quot;</span>, <span class=\"string\">&quot;mp3&quot;</span>, <span class=\"string\">&quot;《北京东路的日子》&quot;</span>, <span class=\"number\">220L</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isDataCompatible</span><span class=\"params\">(<span class=\"type\">byte</span>[] data)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">byte</span>[] format = Arrays.copyOfRange(data, <span class=\"number\">0</span>, FORMAT_LENGTH);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Arrays.equals(format, FORMAT);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当我们调用以下语句去获取歌曲信息时，因为 ParserManager.getSong() 是静态方法，所以会先初始化 ParserManager 类。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Song song = ParserManager.getSong(mockSongData(&quot;MP3&quot;));</span><br></pre></td></tr></table></figure>\n\n<p>在 ParserManager 类中有下面这段代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">    loadInitialParsers();</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;SongParser initialized&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在 loadInitialParsers() 方法中，调用了 Java 的 ServiceLoader 类获取 Parser 接口的所有实现。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">loadInitialParsers</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    ServiceLoader&lt;Parser&gt; loadedParsers = ServiceLoader.load(Parser.class);</span><br><span class=\"line\">    Iterator&lt;Parser&gt; driversIterator = loadedParsers.iterator();</span><br><span class=\"line\">    <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(driversIterator.hasNext()) &#123;</span><br><span class=\"line\">            driversIterator.next();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span>(Throwable t) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Do nothing</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当 ParserManager 初始化完成之后，就调用 getSong() 静态方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Song <span class=\"title function_\">getSong</span><span class=\"params\">(<span class=\"type\">byte</span>[] data)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (ParserInfo parserInfo : registeredParsers) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Song</span> <span class=\"variable\">song</span> <span class=\"operator\">=</span> parserInfo.parser.parse(data);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (song != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> song;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//wrong parser, ignored it.</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ParserNotFoundException</span>(<span class=\"string\">&quot;10001&quot;</span>, <span class=\"string\">&quot;Can not find corresponding data:&quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(data));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>其实 loadInitialParsers() 方法运行之后，是将所有 Parser 接口的所有视线都放到了 ParserManager.registeredParsers 这个 List 中。</p>\n<p><code>[参考地址](https://github.com/chenyurong/song-parser-spi-demo)</code></p>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"4-原理解析\"><a href=\"#4-原理解析\" class=\"headerlink\" title=\"4 原理解析\"></a>4 原理解析</h1><p>首先看ServiceLoader类的签名类的成员变量：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ServiceLoader</span>&lt;S&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Iterable</span>&lt;S&gt;&#123;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;META-INF/services/&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 代表被加载的类或者接口</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Class&lt;S&gt; service;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 用于定位，加载和实例化providers的类加载器</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ClassLoader loader;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建ServiceLoader时采用的访问控制上下文</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> AccessControlContext acc;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 缓存providers，按实例化的顺序排列</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LinkedHashMap&lt;String,S&gt; providers = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 懒查找迭代器</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LazyIterator lookupIterator;</span><br><span class=\"line\">  </span><br><span class=\"line\">    ......</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>参考具体ServiceLoader具体源码，代码量不多，加上注释一共587行，梳理了一下，实现的流程如下：</p>\n<ul>\n<li><p>1 应用程序调用ServiceLoader.load方法<br> ServiceLoader.load方法内先创建一个新的ServiceLoader，并实例化该类中的成员变量，包括：</p>\n<ul>\n<li>loader(ClassLoader类型，类加载器)</li>\n<li>acc(AccessControlContext类型，访问控制器)</li>\n<li>providers(LinkedHashMap&lt;String,S&gt;类型，用于缓存加载成功的类)</li>\n<li>lookupIterator(实现迭代器功能)</li>\n</ul>\n</li>\n<li><p>2 应用程序通过迭代器接口获取对象实例<br> ServiceLoader先判断成员变量providers对象中(LinkedHashMap&lt;String,S&gt;类型)是否有缓存实例对象，如果有缓存，直接返回。<br> 如果没有缓存，执行类的装载，实现如下：</p>\n</li>\n<li><p>(1) 读取META-INF/services/下的配置文件，获得所有能被实例化的类的名称，值得注意的是，ServiceLoader<strong>可以跨越jar包获取META-INF下的配置文件</strong>，具体加载配置的实现代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">fullName</span> <span class=\"operator\">=</span> PREFIX + service.getName();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (loader == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        configs = ClassLoader.getSystemResources(fullName);</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        configs = loader.getResources(fullName);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (IOException x) &#123;</span><br><span class=\"line\">    fail(service, <span class=\"string\">&quot;Error locating configuration files&quot;</span>, x);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>(2) 通过反射方法Class.forName()加载类对象，并用instance()方法将类实例化。</p>\n<p>(3) 把实例化后的类缓存到providers对象中，(LinkedHashMap&lt;String,S&gt;类型）然后返回实例对象。</p>\n</li>\n</ul>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Java中SPI机制\"><a href=\"#Java中SPI机制\" class=\"headerlink\" title=\"Java中SPI机制\"></a>Java中SPI机制</h1><h1 id=\"1-SPI是什么\"><a href=\"#1-SPI是什么\" class=\"headerlink\" title=\"1 SPI是什么\"></a>1 SPI是什么</h1><p>SPI全称Service Provider Interface，是Java提供的一套用来被第三方实现或者扩展的API，它可以用来启用框架扩展和替换组件。</p>\n<p>整体机制图如下：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191602301.png\"></p>\n<p>Java SPI 实际上是“<strong>基于接口的编程＋策略模式＋配置文件</strong>”组合实现的动态加载机制。</p>\n<p>系统设计的各个抽象，往往有很多不同的实现方案，在面向的对象的设计里，一般推荐模块之间基于接口编程，模块之间不对实现类进行硬编码。一旦代码里涉及具体的实现类，就违反了可拔插的原则，如果需要替换一种实现，就需要修改代码。为了实现在模块装配的时候能不在程序里动态指明，这就需要一种服务发现机制。<br> Java SPI就是提供这样的一个机制：为某个接口寻找服务实现的机制。有点类似IOC的思想，就是将装配的控制权移到程序之外，在模块化设计中这个机制尤其重要。所以SPI的核心思想就是<strong>解耦</strong>。</p>\n<h1 id=\"2-使用场景\"><a href=\"#2-使用场景\" class=\"headerlink\" title=\"2 使用场景\"></a>2 使用场景</h1><p>概括地说，适用于：<strong>调用者根据实际使用需要，启用、扩展、或者替换框架的实现策略</strong></p>\n<p>比较常见的例子：</p>\n<ul>\n<li>数据库驱动加载接口实现类的加载<br> JDBC加载不同类型数据库的驱动</li>\n<li>日志门面接口实现类加载<br> SLF4J加载不同提供商的日志实现类</li>\n<li>Spring<br> Spring中大量使用了SPI,比如：对servlet3.0规范对ServletContainerInitializer的实现、自动类型转换Type Conversion SPI(Converter SPI、Formatter SPI)等</li>\n<li>Dubbo<br> Dubbo中也大量使用SPI的方式实现框架的扩展, 不过它对Java提供的原生SPI做了封装，允许用户扩展实现Filter接口</li>\n</ul>\n<h1 id=\"3-使用介绍\"><a href=\"#3-使用介绍\" class=\"headerlink\" title=\"3 使用介绍\"></a>3 使用介绍</h1><p>要使用Java SPI，需要遵循如下约定：</p>\n<ul>\n<li>1、当服务提供者提供了接口的一种具体实现后，在jar包的META-INF/services目录下创建一个以“接口全限定名”为命名的文件，内容为实现类的全限定名；</li>\n<li>2、接口实现类所在的jar包放在主程序的classpath中；</li>\n<li>3、主程序通过java.util.ServiceLoder动态装载实现模块，它通过扫描META-INF/services目录下的配置文件找到实现类的全限定名，把类加载到JVM；</li>\n<li>4、SPI的实现类必须携带一个不带参数的构造方法；</li>\n</ul>\n<h2 id=\"示例代码\"><a href=\"#示例代码\" class=\"headerlink\" title=\"示例代码\"></a>示例代码</h2><h2 id=\"song-parser-项目\"><a href=\"#song-parser-项目\" class=\"headerlink\" title=\"song-parser 项目\"></a>song-parser 项目</h2><p>song-parser 项目定义了通用的歌曲解析接口，并不提供具体的解析实现。在 song-parser 项目定义了下面两个关键的接口和类：Parser 接口、ParserManager 类。</p>\n<ul>\n<li><p>Parser 接口</p>\n<p>定义了抽象的解析方法，传入歌曲的数据，返回歌曲的信息。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Parser</span> &#123;</span><br><span class=\"line\">    Song <span class=\"title function_\">parse</span><span class=\"params\">(<span class=\"type\">byte</span>[] data)</span> <span class=\"keyword\">throws</span> Exception;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>ParseManager 类</p>\n<p>主要包括两个三个部分：</p>\n<p><code>loadInitialParsers()</code> 用于程序启动时初始化所有的歌曲解析器。</p>\n<p><code>ParserManager.registerParser()</code>用于歌曲解析器的注册。</p>\n<p><code>ParserManager.getSong()</code>提供了获取歌曲信息的方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ParserManager</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> CopyOnWriteArrayList&lt;ParserInfo&gt; registeredParsers = <span class=\"keyword\">new</span> <span class=\"title class_\">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        loadInitialParsers();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;SongParser initialized&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">loadInitialParsers</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        ServiceLoader&lt;Parser&gt; loadedParsers = ServiceLoader.load(Parser.class);</span><br><span class=\"line\">        Iterator&lt;Parser&gt; driversIterator = loadedParsers.iterator();</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(driversIterator.hasNext()) &#123;</span><br><span class=\"line\">                driversIterator.next();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span>(Throwable t) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// Do nothing</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">registerParser</span><span class=\"params\">(Parser parser)</span> &#123;</span><br><span class=\"line\">        registeredParsers.add(<span class=\"keyword\">new</span> <span class=\"title class_\">ParserInfo</span>(parser));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Song <span class=\"title function_\">getSong</span><span class=\"params\">(<span class=\"type\">byte</span>[] data)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (ParserInfo parserInfo : registeredParsers) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">Song</span> <span class=\"variable\">song</span> <span class=\"operator\">=</span> parserInfo.parser.parse(data);</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (song != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> song;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                <span class=\"comment\">//wrong parser, ignored it.</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ParserNotFoundException</span>(<span class=\"string\">&quot;10001&quot;</span>, <span class=\"string\">&quot;Can not find corresponding data:&quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(data));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>其实上面的几个方法对应了 Service Provider Framework 的四个概念：</p>\n<ul>\n<li><strong>Service Interface 服务接口</strong>，这里对应 Song 接口。</li>\n<li><strong>Provider Registration API 用户注册接口</strong>，这里对应 ParserManager.registerParser() 方法。</li>\n<li><strong>Service Access API 获取服务实例方法</strong>，这里对应 ParserManager.getSong() 方法。</li>\n<li><strong>Service Provider Interface 创建服务实现的接口</strong>，这里对应 Parser 接口。</li>\n</ul>\n<p>所有借助 Java SPI 机制实现的框架，除了 <strong>Service Interface 服务接口</strong>不是必须的之外，其他三个都是必须要有的。</p>\n<p>这里我们用 mp3 歌曲解析器为例，来看看到底是如何实现的插件式的歌曲解析的。</p>\n<p>在 song-parse-mp3 项目中有两个类和一个描述文件，分别是：Parser 文件、Parser 类和 Mp3Parser 类。</p>\n<ul>\n<li><p>Parser 文件</p>\n<p>该文件位于<code>/resources/META-INF/services</code>目录下，包含如下地址：<code>com.xiaohei.demo.Parser</code>，表示歌曲解析的具体实现类。</p>\n</li>\n<li><p>Parser 类</p>\n<p>在 Parser 类中，其调用 ParserManager.registerParser() 类将解析器注册到一个 List 集合中。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Parser</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Mp3Parser</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">com</span>.chenshuyi.demo.Parser &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span></span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            ParserManager.registerParser(<span class=\"keyword\">new</span> <span class=\"title class_\">Parser</span>());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">catch</span> (Exception e)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RuntimeException</span>(<span class=\"string\">&quot;Can&#x27;t register parser!&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>Mp3Parser 类</p>\n<p>而在 Parser.parse() 方法中，则实现了具体的解析业务逻辑。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Mp3Parser</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Parser</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">byte</span>[] FORMAT = <span class=\"string\">&quot;MP3&quot;</span>.getBytes();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">FORMAT_LENGTH</span> <span class=\"operator\">=</span> FORMAT.length;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Song <span class=\"title function_\">parse</span><span class=\"params\">(<span class=\"type\">byte</span>[] data)</span> <span class=\"keyword\">throws</span> Exception&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!isDataCompatible(data)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Exception</span>(<span class=\"string\">&quot;data format is wrong.&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">//parse data by mp3 format type</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Song</span>(<span class=\"string\">&quot;刘千楚&quot;</span>, <span class=\"string\">&quot;mp3&quot;</span>, <span class=\"string\">&quot;《北京东路的日子》&quot;</span>, <span class=\"number\">220L</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isDataCompatible</span><span class=\"params\">(<span class=\"type\">byte</span>[] data)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">byte</span>[] format = Arrays.copyOfRange(data, <span class=\"number\">0</span>, FORMAT_LENGTH);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Arrays.equals(format, FORMAT);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当我们调用以下语句去获取歌曲信息时，因为 ParserManager.getSong() 是静态方法，所以会先初始化 ParserManager 类。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Song song = ParserManager.getSong(mockSongData(&quot;MP3&quot;));</span><br></pre></td></tr></table></figure>\n\n<p>在 ParserManager 类中有下面这段代码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">    loadInitialParsers();</span><br><span class=\"line\">    System.out.println(<span class=\"string\">&quot;SongParser initialized&quot;</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在 loadInitialParsers() 方法中，调用了 Java 的 ServiceLoader 类获取 Parser 接口的所有实现。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">loadInitialParsers</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    ServiceLoader&lt;Parser&gt; loadedParsers = ServiceLoader.load(Parser.class);</span><br><span class=\"line\">    Iterator&lt;Parser&gt; driversIterator = loadedParsers.iterator();</span><br><span class=\"line\">    <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(driversIterator.hasNext()) &#123;</span><br><span class=\"line\">            driversIterator.next();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span>(Throwable t) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Do nothing</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>当 ParserManager 初始化完成之后，就调用 getSong() 静态方法。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Song <span class=\"title function_\">getSong</span><span class=\"params\">(<span class=\"type\">byte</span>[] data)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (ParserInfo parserInfo : registeredParsers) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"type\">Song</span> <span class=\"variable\">song</span> <span class=\"operator\">=</span> parserInfo.parser.parse(data);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (song != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> song;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//wrong parser, ignored it.</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ParserNotFoundException</span>(<span class=\"string\">&quot;10001&quot;</span>, <span class=\"string\">&quot;Can not find corresponding data:&quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(data));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>其实 loadInitialParsers() 方法运行之后，是将所有 Parser 接口的所有视线都放到了 ParserManager.registeredParsers 这个 List 中。</p>\n<p><code>[参考地址](https://github.com/chenyurong/song-parser-spi-demo)</code></p>\n</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"4-原理解析\"><a href=\"#4-原理解析\" class=\"headerlink\" title=\"4 原理解析\"></a>4 原理解析</h1><p>首先看ServiceLoader类的签名类的成员变量：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">final</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ServiceLoader</span>&lt;S&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">Iterable</span>&lt;S&gt;&#123;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">PREFIX</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;META-INF/services/&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 代表被加载的类或者接口</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Class&lt;S&gt; service;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 用于定位，加载和实例化providers的类加载器</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> ClassLoader loader;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 创建ServiceLoader时采用的访问控制上下文</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> AccessControlContext acc;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 缓存providers，按实例化的顺序排列</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LinkedHashMap&lt;String,S&gt; providers = <span class=\"keyword\">new</span> <span class=\"title class_\">LinkedHashMap</span>&lt;&gt;();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 懒查找迭代器</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> LazyIterator lookupIterator;</span><br><span class=\"line\">  </span><br><span class=\"line\">    ......</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>参考具体ServiceLoader具体源码，代码量不多，加上注释一共587行，梳理了一下，实现的流程如下：</p>\n<ul>\n<li><p>1 应用程序调用ServiceLoader.load方法<br> ServiceLoader.load方法内先创建一个新的ServiceLoader，并实例化该类中的成员变量，包括：</p>\n<ul>\n<li>loader(ClassLoader类型，类加载器)</li>\n<li>acc(AccessControlContext类型，访问控制器)</li>\n<li>providers(LinkedHashMap&lt;String,S&gt;类型，用于缓存加载成功的类)</li>\n<li>lookupIterator(实现迭代器功能)</li>\n</ul>\n</li>\n<li><p>2 应用程序通过迭代器接口获取对象实例<br> ServiceLoader先判断成员变量providers对象中(LinkedHashMap&lt;String,S&gt;类型)是否有缓存实例对象，如果有缓存，直接返回。<br> 如果没有缓存，执行类的装载，实现如下：</p>\n</li>\n<li><p>(1) 读取META-INF/services/下的配置文件，获得所有能被实例化的类的名称，值得注意的是，ServiceLoader<strong>可以跨越jar包获取META-INF下的配置文件</strong>，具体加载配置的实现代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">fullName</span> <span class=\"operator\">=</span> PREFIX + service.getName();</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (loader == <span class=\"literal\">null</span>)</span><br><span class=\"line\">        configs = ClassLoader.getSystemResources(fullName);</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        configs = loader.getResources(fullName);</span><br><span class=\"line\">&#125; <span class=\"keyword\">catch</span> (IOException x) &#123;</span><br><span class=\"line\">    fail(service, <span class=\"string\">&quot;Error locating configuration files&quot;</span>, x);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>(2) 通过反射方法Class.forName()加载类对象，并用instance()方法将类实例化。</p>\n<p>(3) 把实例化后的类缓存到providers对象中，(LinkedHashMap&lt;String,S&gt;类型）然后返回实例对象。</p>\n</li>\n</ul>\n"},{"uuid":"bbaf210d-c0ab-11ec-92a1-7557b2313227","title":"chmod","abbrlink":"e97af36","_content":"\nchmod a+r *：用户自己使用此命令，柯给所有用户添加可读的权限\n\n超级用户给其他用户设置权限：sudo chmod a+rx /home/user  使所有人可以访问，读取文件，bu no Write\n\n指令名称 : chmod\n使用权限 : 所有使用者\n使用方式 : chmod [-cfvR] [--help] [--version] mode file...\n说明 : Linux/Unix 的档案调用权限分为三级 : 档案拥有者、群组、其他。利用 chmod 可以藉以控制档案如何被他人所调用。\n参数 :\nmode : 权限设定字串，格式如下 : [ugoa...][[+-=][rwxX]...][,...]，其中\nu 表示该档案的拥有者，g 表示与该档案的拥有者属于同一个群体(group)者，o 表示其他以外的人，a 表示这三者皆是。\n\\+ 表示增加权限、- 表示取消权限、= 表示唯一设定权限。\nr 表示可读取，w 表示可写入，x 表示可执行，X 表示只有当该档案是个子目录或者该档案已经被设定过为可执行。\n-c : 若该档案权限确实已经更改，才显示其更改动作\n-f : 若该档案权限无法被更改也不要显示错误讯息\n-v : 显示权限变更的详细资料\n-R : 对目前目录下的所有档案与子目录进行相同的权限变更(即以递回的方式逐个变更)\n--help : 显示辅助说明\n--version : 显示版本\n范例 :将档案 file1.txt 设为所有人皆可读取 :\nchmod ugo+r file1.txt \n将档案 file1.txt 设为所有人皆可读取 :\nchmod a+r file1.txt \n将档案 file1.txt 与 file2.txt 设为该档案拥有者，与其所属同一个群体者可写入，但其他以外的人则不可写入 :\nchmod ug+w,o-w file1.txt file2.txt \n将 ex1.py 设定为只有该档案拥有者可以执行 :\nchmod u+x ex1.py \n将目前目录下的所有档案与子目录皆设为任何人可读取 :\nchmod -R a+r * \n此外chmod也可以用数字来表示权限如 chmod 777 file\n语法为：chmod abc file\n其中a,b,c各为一个数字，分别表示User、Group、及Other的权限。\nr=4，w=2，x=1\n若要rwx属性则4+2+1=7；\n若要rw-属性则4+2=6；\n若要r-x属性则4+1=7。\n范例：\nchmod a=rwx file \n和\nchmod 777 file \n效果相同\nchmod ug=rwx,o=x file \n和\nchmod 771 file \n效果相同\n若用chmod 4755 filename可使此程序具有root的权限\n","source":"_posts/linux/chmod.md","raw":"---\nuuid: bbaf210d-c0ab-11ec-92a1-7557b2313227\ntitle: chmod\ncategories: Linux\ntags:\n  - linux\nabbrlink: e97af36\n---\n\nchmod a+r *：用户自己使用此命令，柯给所有用户添加可读的权限\n\n超级用户给其他用户设置权限：sudo chmod a+rx /home/user  使所有人可以访问，读取文件，bu no Write\n\n指令名称 : chmod\n使用权限 : 所有使用者\n使用方式 : chmod [-cfvR] [--help] [--version] mode file...\n说明 : Linux/Unix 的档案调用权限分为三级 : 档案拥有者、群组、其他。利用 chmod 可以藉以控制档案如何被他人所调用。\n参数 :\nmode : 权限设定字串，格式如下 : [ugoa...][[+-=][rwxX]...][,...]，其中\nu 表示该档案的拥有者，g 表示与该档案的拥有者属于同一个群体(group)者，o 表示其他以外的人，a 表示这三者皆是。\n\\+ 表示增加权限、- 表示取消权限、= 表示唯一设定权限。\nr 表示可读取，w 表示可写入，x 表示可执行，X 表示只有当该档案是个子目录或者该档案已经被设定过为可执行。\n-c : 若该档案权限确实已经更改，才显示其更改动作\n-f : 若该档案权限无法被更改也不要显示错误讯息\n-v : 显示权限变更的详细资料\n-R : 对目前目录下的所有档案与子目录进行相同的权限变更(即以递回的方式逐个变更)\n--help : 显示辅助说明\n--version : 显示版本\n范例 :将档案 file1.txt 设为所有人皆可读取 :\nchmod ugo+r file1.txt \n将档案 file1.txt 设为所有人皆可读取 :\nchmod a+r file1.txt \n将档案 file1.txt 与 file2.txt 设为该档案拥有者，与其所属同一个群体者可写入，但其他以外的人则不可写入 :\nchmod ug+w,o-w file1.txt file2.txt \n将 ex1.py 设定为只有该档案拥有者可以执行 :\nchmod u+x ex1.py \n将目前目录下的所有档案与子目录皆设为任何人可读取 :\nchmod -R a+r * \n此外chmod也可以用数字来表示权限如 chmod 777 file\n语法为：chmod abc file\n其中a,b,c各为一个数字，分别表示User、Group、及Other的权限。\nr=4，w=2，x=1\n若要rwx属性则4+2+1=7；\n若要rw-属性则4+2=6；\n若要r-x属性则4+1=7。\n范例：\nchmod a=rwx file \n和\nchmod 777 file \n效果相同\nchmod ug=rwx,o=x file \n和\nchmod 771 file \n效果相同\n若用chmod 4755 filename可使此程序具有root的权限\n","slug":"linux/chmod","published":1,"date":"2022-04-20T12:41:20.888Z","updated":"2022-05-04T03:20:24.083Z","_id":"cl2qzfthz003k13nob57mapd6","comments":1,"layout":"post","photos":[],"link":"","content":"<p>chmod a+r *：用户自己使用此命令，柯给所有用户添加可读的权限</p>\n<p>超级用户给其他用户设置权限：sudo chmod a+rx /home/user  使所有人可以访问，读取文件，bu no Write</p>\n<p>指令名称 : chmod<br>使用权限 : 所有使用者<br>使用方式 : chmod [-cfvR] [–help] [–version] mode file…<br>说明 : Linux/Unix 的档案调用权限分为三级 : 档案拥有者、群组、其他。利用 chmod 可以藉以控制档案如何被他人所调用。<br>参数 :<br>mode : 权限设定字串，格式如下 : [ugoa…][[+-=][rwxX]…][,…]，其中<br>u 表示该档案的拥有者，g 表示与该档案的拥有者属于同一个群体(group)者，o 表示其他以外的人，a 表示这三者皆是。<br>+ 表示增加权限、- 表示取消权限、= 表示唯一设定权限。<br>r 表示可读取，w 表示可写入，x 表示可执行，X 表示只有当该档案是个子目录或者该档案已经被设定过为可执行。<br>-c : 若该档案权限确实已经更改，才显示其更改动作<br>-f : 若该档案权限无法被更改也不要显示错误讯息<br>-v : 显示权限变更的详细资料<br>-R : 对目前目录下的所有档案与子目录进行相同的权限变更(即以递回的方式逐个变更)<br>–help : 显示辅助说明<br>–version : 显示版本<br>范例 :将档案 file1.txt 设为所有人皆可读取 :<br>chmod ugo+r file1.txt<br>将档案 file1.txt 设为所有人皆可读取 :<br>chmod a+r file1.txt<br>将档案 file1.txt 与 file2.txt 设为该档案拥有者，与其所属同一个群体者可写入，但其他以外的人则不可写入 :<br>chmod ug+w,o-w file1.txt file2.txt<br>将 ex1.py 设定为只有该档案拥有者可以执行 :<br>chmod u+x ex1.py<br>将目前目录下的所有档案与子目录皆设为任何人可读取 :<br>chmod -R a+r *<br>此外chmod也可以用数字来表示权限如 chmod 777 file<br>语法为：chmod abc file<br>其中a,b,c各为一个数字，分别表示User、Group、及Other的权限。<br>r=4，w=2，x=1<br>若要rwx属性则4+2+1=7；<br>若要rw-属性则4+2=6；<br>若要r-x属性则4+1=7。<br>范例：<br>chmod a=rwx file<br>和<br>chmod 777 file<br>效果相同<br>chmod ug=rwx,o=x file<br>和<br>chmod 771 file<br>效果相同<br>若用chmod 4755 filename可使此程序具有root的权限</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>chmod a+r *：用户自己使用此命令，柯给所有用户添加可读的权限</p>\n<p>超级用户给其他用户设置权限：sudo chmod a+rx /home/user  使所有人可以访问，读取文件，bu no Write</p>\n<p>指令名称 : chmod<br>使用权限 : 所有使用者<br>使用方式 : chmod [-cfvR] [–help] [–version] mode file…<br>说明 : Linux/Unix 的档案调用权限分为三级 : 档案拥有者、群组、其他。利用 chmod 可以藉以控制档案如何被他人所调用。<br>参数 :<br>mode : 权限设定字串，格式如下 : [ugoa…][[+-=][rwxX]…][,…]，其中<br>u 表示该档案的拥有者，g 表示与该档案的拥有者属于同一个群体(group)者，o 表示其他以外的人，a 表示这三者皆是。<br>+ 表示增加权限、- 表示取消权限、= 表示唯一设定权限。<br>r 表示可读取，w 表示可写入，x 表示可执行，X 表示只有当该档案是个子目录或者该档案已经被设定过为可执行。<br>-c : 若该档案权限确实已经更改，才显示其更改动作<br>-f : 若该档案权限无法被更改也不要显示错误讯息<br>-v : 显示权限变更的详细资料<br>-R : 对目前目录下的所有档案与子目录进行相同的权限变更(即以递回的方式逐个变更)<br>–help : 显示辅助说明<br>–version : 显示版本<br>范例 :将档案 file1.txt 设为所有人皆可读取 :<br>chmod ugo+r file1.txt<br>将档案 file1.txt 设为所有人皆可读取 :<br>chmod a+r file1.txt<br>将档案 file1.txt 与 file2.txt 设为该档案拥有者，与其所属同一个群体者可写入，但其他以外的人则不可写入 :<br>chmod ug+w,o-w file1.txt file2.txt<br>将 ex1.py 设定为只有该档案拥有者可以执行 :<br>chmod u+x ex1.py<br>将目前目录下的所有档案与子目录皆设为任何人可读取 :<br>chmod -R a+r *<br>此外chmod也可以用数字来表示权限如 chmod 777 file<br>语法为：chmod abc file<br>其中a,b,c各为一个数字，分别表示User、Group、及Other的权限。<br>r=4，w=2，x=1<br>若要rwx属性则4+2+1=7；<br>若要rw-属性则4+2=6；<br>若要r-x属性则4+1=7。<br>范例：<br>chmod a=rwx file<br>和<br>chmod 777 file<br>效果相同<br>chmod ug=rwx,o=x file<br>和<br>chmod 771 file<br>效果相同<br>若用chmod 4755 filename可使此程序具有root的权限</p>\n"},{"uuid":"bbaf210e-c0ab-11ec-92a1-7557b2313227","title":"linux bin目录说明","abbrlink":"cccfdef8","_content":"\n## **/bin,/sbin,/usr/sbin,/usr/bin 目录**\n\n   这些目录都是存放命令的，首先区别下/sbin和/[bin](https://so.csdn.net/so/search?q=bin&spm=1001.2101.3001.7020)：\n\n  从命令功能来看，/sbin 下的命令属于基本的系统命令，如shutdown，reboot，用于启动系统，修复系统，/bin下存放一些普通的基本命令，如ls,[chmod](https://so.csdn.net/so/search?q=chmod&spm=1001.2101.3001.7020)等，这些命令在Linux系统里的配置文件脚本里经常用到。\n\n  从[用户权限](https://so.csdn.net/so/search?q=用户权限&spm=1001.2101.3001.7020)的角度看，/sbin目录下的命令通常只有管理员才可以运行，/bin下的命令管理员和一般的用户都可以使用。\n\n  从可运行时间角度看，/sbin,/bin能够在挂载其他文件系统前就可以使用。\n\n  而/usr/bin,/usr/sbin与/sbin /bin目录的区别在于：\n\n  /bin,/sbin目录是在系统启动后挂载到根文件系统中的，所以/sbin,/bin目录必须和根文件系统在同一分区；\n\n  /usr/bin,usr/sbin可以和根文件系统不在一个分区。\n\n  /usr/sbin存放的一些非必须的系统命令；/usr/bin存放一些用户命令，如led(控制LED灯的)。\n\n  转下一位网友的解读，个人认为诠释得很到位：\n\n  **/bin**是系统的一些指令。bin为binary的简写主要放置一些系统的必备执行档例如:cat、cp、chmod df、dmesg、gzip、kill、ls、mkdir、more、mount、rm、su、tar等。\n  **/sbin**一般是指超级用户指令**。**主要放置一些系统管理的必备程式例如:cfdisk、dhcpcd、dump、e2fsck、fdisk、halt、ifconfig、ifup、 ifdown、init、insmod、lilo、lsmod、mke2fs、modprobe、quotacheck、reboot、rmmod、 runlevel、shutdown等。\n  **/usr/bin**　是你在后期安装的一些软件的运行脚本。主要放置一些应用软体工具的必备执行档例如c++、g++、gcc、chdrv、diff、dig、du、eject、elm、free、gnome*、 gzip、htpasswd、kfm、ktop、last、less、locale、m4、make、man、mcopy、ncftp、 newaliases、nslookup passwd、quota、smb*、wget等。\n\n  **/usr/sbin**  放置一些用户安装的系统管理的必备程式例如:dhcpd、httpd、imap、in.*d、inetd、lpd、named、netconfig、nmbd、samba、sendmail、squid、swap、tcpd、tcpdump等。\n  如果新装的系统，运行一些很正常的诸如：shutdown，fdisk的命令时，悍然提示：bash:command not found。那么\n  首先就要考虑root 的$PATH里是否已经包含了这些环境变量。\n  可以查看PATH，如果是：PATH=$PATH:$HOME/bin则需要添加成如下：\n  PATH=$PATH:$HOME/bin:/sbin:/usr/bin:/usr/sbin\n","source":"_posts/linux/linux目录.md","raw":"---\nuuid: bbaf210e-c0ab-11ec-92a1-7557b2313227\ntitle: linux bin目录说明\ncategories: Linux\ntags:\n  - linux\nabbrlink: cccfdef8\n---\n\n## **/bin,/sbin,/usr/sbin,/usr/bin 目录**\n\n   这些目录都是存放命令的，首先区别下/sbin和/[bin](https://so.csdn.net/so/search?q=bin&spm=1001.2101.3001.7020)：\n\n  从命令功能来看，/sbin 下的命令属于基本的系统命令，如shutdown，reboot，用于启动系统，修复系统，/bin下存放一些普通的基本命令，如ls,[chmod](https://so.csdn.net/so/search?q=chmod&spm=1001.2101.3001.7020)等，这些命令在Linux系统里的配置文件脚本里经常用到。\n\n  从[用户权限](https://so.csdn.net/so/search?q=用户权限&spm=1001.2101.3001.7020)的角度看，/sbin目录下的命令通常只有管理员才可以运行，/bin下的命令管理员和一般的用户都可以使用。\n\n  从可运行时间角度看，/sbin,/bin能够在挂载其他文件系统前就可以使用。\n\n  而/usr/bin,/usr/sbin与/sbin /bin目录的区别在于：\n\n  /bin,/sbin目录是在系统启动后挂载到根文件系统中的，所以/sbin,/bin目录必须和根文件系统在同一分区；\n\n  /usr/bin,usr/sbin可以和根文件系统不在一个分区。\n\n  /usr/sbin存放的一些非必须的系统命令；/usr/bin存放一些用户命令，如led(控制LED灯的)。\n\n  转下一位网友的解读，个人认为诠释得很到位：\n\n  **/bin**是系统的一些指令。bin为binary的简写主要放置一些系统的必备执行档例如:cat、cp、chmod df、dmesg、gzip、kill、ls、mkdir、more、mount、rm、su、tar等。\n  **/sbin**一般是指超级用户指令**。**主要放置一些系统管理的必备程式例如:cfdisk、dhcpcd、dump、e2fsck、fdisk、halt、ifconfig、ifup、 ifdown、init、insmod、lilo、lsmod、mke2fs、modprobe、quotacheck、reboot、rmmod、 runlevel、shutdown等。\n  **/usr/bin**　是你在后期安装的一些软件的运行脚本。主要放置一些应用软体工具的必备执行档例如c++、g++、gcc、chdrv、diff、dig、du、eject、elm、free、gnome*、 gzip、htpasswd、kfm、ktop、last、less、locale、m4、make、man、mcopy、ncftp、 newaliases、nslookup passwd、quota、smb*、wget等。\n\n  **/usr/sbin**  放置一些用户安装的系统管理的必备程式例如:dhcpd、httpd、imap、in.*d、inetd、lpd、named、netconfig、nmbd、samba、sendmail、squid、swap、tcpd、tcpdump等。\n  如果新装的系统，运行一些很正常的诸如：shutdown，fdisk的命令时，悍然提示：bash:command not found。那么\n  首先就要考虑root 的$PATH里是否已经包含了这些环境变量。\n  可以查看PATH，如果是：PATH=$PATH:$HOME/bin则需要添加成如下：\n  PATH=$PATH:$HOME/bin:/sbin:/usr/bin:/usr/sbin\n","slug":"linux/linux目录","published":1,"date":"2022-04-20T12:41:20.893Z","updated":"2022-05-04T03:20:32.673Z","_id":"cl2qzfti1003o13no4n2y0blc","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"bin-sbin-usr-sbin-usr-bin-目录\"><a href=\"#bin-sbin-usr-sbin-usr-bin-目录\" class=\"headerlink\" title=\"/bin,/sbin,/usr/sbin,/usr/bin 目录\"></a><strong>/bin,/sbin,/usr/sbin,/usr/bin 目录</strong></h2><p>   这些目录都是存放命令的，首先区别下/sbin和/<a href=\"https://so.csdn.net/so/search?q=bin&spm=1001.2101.3001.7020\">bin</a>：</p>\n<p>  从命令功能来看，/sbin 下的命令属于基本的系统命令，如shutdown，reboot，用于启动系统，修复系统，/bin下存放一些普通的基本命令，如ls,<a href=\"https://so.csdn.net/so/search?q=chmod&spm=1001.2101.3001.7020\">chmod</a>等，这些命令在Linux系统里的配置文件脚本里经常用到。</p>\n<p>  从<a href=\"https://so.csdn.net/so/search?q=%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90&spm=1001.2101.3001.7020\">用户权限</a>的角度看，/sbin目录下的命令通常只有管理员才可以运行，/bin下的命令管理员和一般的用户都可以使用。</p>\n<p>  从可运行时间角度看，/sbin,/bin能够在挂载其他文件系统前就可以使用。</p>\n<p>  而/usr/bin,/usr/sbin与/sbin /bin目录的区别在于：</p>\n<p>  /bin,/sbin目录是在系统启动后挂载到根文件系统中的，所以/sbin,/bin目录必须和根文件系统在同一分区；</p>\n<p>  /usr/bin,usr/sbin可以和根文件系统不在一个分区。</p>\n<p>  /usr/sbin存放的一些非必须的系统命令；/usr/bin存放一些用户命令，如led(控制LED灯的)。</p>\n<p>  转下一位网友的解读，个人认为诠释得很到位：</p>\n<p>  <strong>/bin</strong>是系统的一些指令。bin为binary的简写主要放置一些系统的必备执行档例如:cat、cp、chmod df、dmesg、gzip、kill、ls、mkdir、more、mount、rm、su、tar等。<br>  <strong>/sbin</strong>一般是指超级用户指令<strong>。</strong>主要放置一些系统管理的必备程式例如:cfdisk、dhcpcd、dump、e2fsck、fdisk、halt、ifconfig、ifup、 ifdown、init、insmod、lilo、lsmod、mke2fs、modprobe、quotacheck、reboot、rmmod、 runlevel、shutdown等。<br>  <strong>/usr/bin</strong>　是你在后期安装的一些软件的运行脚本。主要放置一些应用软体工具的必备执行档例如c++、g++、gcc、chdrv、diff、dig、du、eject、elm、free、gnome<em>、 gzip、htpasswd、kfm、ktop、last、less、locale、m4、make、man、mcopy、ncftp、 newaliases、nslookup passwd、quota、smb</em>、wget等。</p>\n<p>  <strong>/usr/sbin</strong>  放置一些用户安装的系统管理的必备程式例如:dhcpd、httpd、imap、in.*d、inetd、lpd、named、netconfig、nmbd、samba、sendmail、squid、swap、tcpd、tcpdump等。<br>  如果新装的系统，运行一些很正常的诸如：shutdown，fdisk的命令时，悍然提示：bash:command not found。那么<br>  首先就要考虑root 的$PATH里是否已经包含了这些环境变量。<br>  可以查看PATH，如果是：PATH=$PATH:$HOME/bin则需要添加成如下：<br>  PATH=$PATH:$HOME/bin:/sbin:/usr/bin:/usr/sbin</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"bin-sbin-usr-sbin-usr-bin-目录\"><a href=\"#bin-sbin-usr-sbin-usr-bin-目录\" class=\"headerlink\" title=\"/bin,/sbin,/usr/sbin,/usr/bin 目录\"></a><strong>/bin,/sbin,/usr/sbin,/usr/bin 目录</strong></h2><p>   这些目录都是存放命令的，首先区别下/sbin和/<a href=\"https://so.csdn.net/so/search?q=bin&spm=1001.2101.3001.7020\">bin</a>：</p>\n<p>  从命令功能来看，/sbin 下的命令属于基本的系统命令，如shutdown，reboot，用于启动系统，修复系统，/bin下存放一些普通的基本命令，如ls,<a href=\"https://so.csdn.net/so/search?q=chmod&spm=1001.2101.3001.7020\">chmod</a>等，这些命令在Linux系统里的配置文件脚本里经常用到。</p>\n<p>  从<a href=\"https://so.csdn.net/so/search?q=%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90&spm=1001.2101.3001.7020\">用户权限</a>的角度看，/sbin目录下的命令通常只有管理员才可以运行，/bin下的命令管理员和一般的用户都可以使用。</p>\n<p>  从可运行时间角度看，/sbin,/bin能够在挂载其他文件系统前就可以使用。</p>\n<p>  而/usr/bin,/usr/sbin与/sbin /bin目录的区别在于：</p>\n<p>  /bin,/sbin目录是在系统启动后挂载到根文件系统中的，所以/sbin,/bin目录必须和根文件系统在同一分区；</p>\n<p>  /usr/bin,usr/sbin可以和根文件系统不在一个分区。</p>\n<p>  /usr/sbin存放的一些非必须的系统命令；/usr/bin存放一些用户命令，如led(控制LED灯的)。</p>\n<p>  转下一位网友的解读，个人认为诠释得很到位：</p>\n<p>  <strong>/bin</strong>是系统的一些指令。bin为binary的简写主要放置一些系统的必备执行档例如:cat、cp、chmod df、dmesg、gzip、kill、ls、mkdir、more、mount、rm、su、tar等。<br>  <strong>/sbin</strong>一般是指超级用户指令<strong>。</strong>主要放置一些系统管理的必备程式例如:cfdisk、dhcpcd、dump、e2fsck、fdisk、halt、ifconfig、ifup、 ifdown、init、insmod、lilo、lsmod、mke2fs、modprobe、quotacheck、reboot、rmmod、 runlevel、shutdown等。<br>  <strong>/usr/bin</strong>　是你在后期安装的一些软件的运行脚本。主要放置一些应用软体工具的必备执行档例如c++、g++、gcc、chdrv、diff、dig、du、eject、elm、free、gnome<em>、 gzip、htpasswd、kfm、ktop、last、less、locale、m4、make、man、mcopy、ncftp、 newaliases、nslookup passwd、quota、smb</em>、wget等。</p>\n<p>  <strong>/usr/sbin</strong>  放置一些用户安装的系统管理的必备程式例如:dhcpd、httpd、imap、in.*d、inetd、lpd、named、netconfig、nmbd、samba、sendmail、squid、swap、tcpd、tcpdump等。<br>  如果新装的系统，运行一些很正常的诸如：shutdown，fdisk的命令时，悍然提示：bash:command not found。那么<br>  首先就要考虑root 的$PATH里是否已经包含了这些环境变量。<br>  可以查看PATH，如果是：PATH=$PATH:$HOME/bin则需要添加成如下：<br>  PATH=$PATH:$HOME/bin:/sbin:/usr/bin:/usr/sbin</p>\n"},{"uuid":"bbaf210f-c0ab-11ec-92a1-7557b2313227","title":"linux scp","abbrlink":"326eed25","_content":"\n在终端里面输入命令【sudo su】，然后输入当前用户的用户密码，就可以获取临时的root权限\n\n在终端里面输入命令【su】，然后输入当前用户的用户密码，就可以获取临时的root权限\n\n可以在想要在终端输入的命令前面添加，【sudo】来达到使用root权限进行执行该命令\n\n```bash\nscp /home/space/music/1.mp3 root@www.runoob.com:/home/root/others/music \nscp /home/space/music/1.mp3 root@www.runoob.com:/home/root/others/music/001.mp3 \nscp /home/space/music/1.mp3 www.runoob.com:/home/root/others/music \nscp /home/space/music/1.mp3 www.runoob.com:/home/root/others/music/001.mp3 \n```\n\n","source":"_posts/linux/scp.md","raw":"---\nuuid: bbaf210f-c0ab-11ec-92a1-7557b2313227\ntitle: linux scp\ncategories: Linux\ntags:\n  - linux\nabbrlink: 326eed25\n---\n\n在终端里面输入命令【sudo su】，然后输入当前用户的用户密码，就可以获取临时的root权限\n\n在终端里面输入命令【su】，然后输入当前用户的用户密码，就可以获取临时的root权限\n\n可以在想要在终端输入的命令前面添加，【sudo】来达到使用root权限进行执行该命令\n\n```bash\nscp /home/space/music/1.mp3 root@www.runoob.com:/home/root/others/music \nscp /home/space/music/1.mp3 root@www.runoob.com:/home/root/others/music/001.mp3 \nscp /home/space/music/1.mp3 www.runoob.com:/home/root/others/music \nscp /home/space/music/1.mp3 www.runoob.com:/home/root/others/music/001.mp3 \n```\n\n","slug":"linux/scp","published":1,"date":"2022-04-20T12:41:20.884Z","updated":"2022-05-04T03:20:48.264Z","_id":"cl2qzfti1003r13nohdxc0ner","comments":1,"layout":"post","photos":[],"link":"","content":"<p>在终端里面输入命令【sudo su】，然后输入当前用户的用户密码，就可以获取临时的root权限</p>\n<p>在终端里面输入命令【su】，然后输入当前用户的用户密码，就可以获取临时的root权限</p>\n<p>可以在想要在终端输入的命令前面添加，【sudo】来达到使用root权限进行执行该命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp /home/space/music/1.mp3 root@www.runoob.com:/home/root/others/music </span><br><span class=\"line\">scp /home/space/music/1.mp3 root@www.runoob.com:/home/root/others/music/001.mp3 </span><br><span class=\"line\">scp /home/space/music/1.mp3 www.runoob.com:/home/root/others/music </span><br><span class=\"line\">scp /home/space/music/1.mp3 www.runoob.com:/home/root/others/music/001.mp3 </span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>在终端里面输入命令【sudo su】，然后输入当前用户的用户密码，就可以获取临时的root权限</p>\n<p>在终端里面输入命令【su】，然后输入当前用户的用户密码，就可以获取临时的root权限</p>\n<p>可以在想要在终端输入的命令前面添加，【sudo】来达到使用root权限进行执行该命令</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp /home/space/music/1.mp3 root@www.runoob.com:/home/root/others/music </span><br><span class=\"line\">scp /home/space/music/1.mp3 root@www.runoob.com:/home/root/others/music/001.mp3 </span><br><span class=\"line\">scp /home/space/music/1.mp3 www.runoob.com:/home/root/others/music </span><br><span class=\"line\">scp /home/space/music/1.mp3 www.runoob.com:/home/root/others/music/001.mp3 </span><br></pre></td></tr></table></figure>\n\n"},{"uuid":"bbaf2110-c0ab-11ec-92a1-7557b2313227","title":"shell 脚本三种执行方式","abbrlink":"e96baa13","_content":"\n# 执行shell脚本三种方法的区别：（sh、exec、source）\n\n#### 1. sh 方式\n\n使用$ sh script.sh执行脚本时，当前shell是父进程，生成一个子shell进程，在子shell中执行脚本。脚本执行完毕，退出子shell，回到当前shell。\n ./script.sh与 sh script.sh等效。\n\n#### 2. source方式\n\n使用$ source script.sh方式，在当前上下文中执行脚本，不会生成新的进程。脚本执行完毕，回到当前shell。\n source方式也叫点命令。\n . script.sh与 source script.sh等效。\n\n#### 3. exec方式\n\n使用exec command方式，会用command进程替换当前shell进程，并且保持PID不变。执行完毕，直接退出，不回到之前的shell环境。\n\n二、测试验证\n vi loop.sh\n\n```bash\n#!/bin/sh\nwhile [ 1 = 1 ]; do \n    echo $$\n    sleep 1\ndone\n```\n\n显示当前进程\n\n```bash\necho $$\n6770\n```\n\nsh的方式：执行loop.sh打印执行进程\n\n```css\nsh loop.sh \n13736\n13736\n```\n\nsource方式：执行loop.sh打印执行进程\n\n```bash\nsource loop.sh\n6770\n6770\n```\n\nexec方式：执行loop.sh打印执行进程\n\n```bash\nexec ./loop.sh\n6770\n6770\n```\n\n按下ctrl+C\n\n```bash\nConnection closing...Socket close.\nConnection closed by foreign host.\nDisconnected from remote host.\nType `help' to learn how to use Xshell prompt.\n[~]$ \n```\n\n#### 结论：\n\n**sh方式：父进程是6770，执行loop.sh时的子进程是13736。执行完毕后回到父进程shell。\nsource方式：父进程和子进程都是6770（执行时没有新的进程），执行完毕会回到父进程shell。\nexec方式：进程PID没有改变都是6770，执行完毕（ctrl+C强制关闭）时直接退出了shell。脚本执行时替换了父进程的shell,执行完毕后直接退出，没有回到之前的shell。**\n\n","source":"_posts/linux/shell执行的三种方式.md","raw":"---\nuuid: bbaf2110-c0ab-11ec-92a1-7557b2313227\ntitle: shell 脚本三种执行方式\ncategories: Linux\ntags:\n  - linux\n  - shell\nabbrlink: e96baa13\n---\n\n# 执行shell脚本三种方法的区别：（sh、exec、source）\n\n#### 1. sh 方式\n\n使用$ sh script.sh执行脚本时，当前shell是父进程，生成一个子shell进程，在子shell中执行脚本。脚本执行完毕，退出子shell，回到当前shell。\n ./script.sh与 sh script.sh等效。\n\n#### 2. source方式\n\n使用$ source script.sh方式，在当前上下文中执行脚本，不会生成新的进程。脚本执行完毕，回到当前shell。\n source方式也叫点命令。\n . script.sh与 source script.sh等效。\n\n#### 3. exec方式\n\n使用exec command方式，会用command进程替换当前shell进程，并且保持PID不变。执行完毕，直接退出，不回到之前的shell环境。\n\n二、测试验证\n vi loop.sh\n\n```bash\n#!/bin/sh\nwhile [ 1 = 1 ]; do \n    echo $$\n    sleep 1\ndone\n```\n\n显示当前进程\n\n```bash\necho $$\n6770\n```\n\nsh的方式：执行loop.sh打印执行进程\n\n```css\nsh loop.sh \n13736\n13736\n```\n\nsource方式：执行loop.sh打印执行进程\n\n```bash\nsource loop.sh\n6770\n6770\n```\n\nexec方式：执行loop.sh打印执行进程\n\n```bash\nexec ./loop.sh\n6770\n6770\n```\n\n按下ctrl+C\n\n```bash\nConnection closing...Socket close.\nConnection closed by foreign host.\nDisconnected from remote host.\nType `help' to learn how to use Xshell prompt.\n[~]$ \n```\n\n#### 结论：\n\n**sh方式：父进程是6770，执行loop.sh时的子进程是13736。执行完毕后回到父进程shell。\nsource方式：父进程和子进程都是6770（执行时没有新的进程），执行完毕会回到父进程shell。\nexec方式：进程PID没有改变都是6770，执行完毕（ctrl+C强制关闭）时直接退出了shell。脚本执行时替换了父进程的shell,执行完毕后直接退出，没有回到之前的shell。**\n\n","slug":"linux/shell执行的三种方式","published":1,"date":"2022-04-20T12:41:20.894Z","updated":"2022-05-04T03:21:16.966Z","_id":"cl2qzfti2003v13no1pqa6154","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"执行shell脚本三种方法的区别：（sh、exec、source）\"><a href=\"#执行shell脚本三种方法的区别：（sh、exec、source）\" class=\"headerlink\" title=\"执行shell脚本三种方法的区别：（sh、exec、source）\"></a>执行shell脚本三种方法的区别：（sh、exec、source）</h1><h4 id=\"1-sh-方式\"><a href=\"#1-sh-方式\" class=\"headerlink\" title=\"1. sh 方式\"></a>1. sh 方式</h4><p>使用$ sh script.sh执行脚本时，当前shell是父进程，生成一个子shell进程，在子shell中执行脚本。脚本执行完毕，退出子shell，回到当前shell。<br> ./script.sh与 sh script.sh等效。</p>\n<h4 id=\"2-source方式\"><a href=\"#2-source方式\" class=\"headerlink\" title=\"2. source方式\"></a>2. source方式</h4><p>使用$ source script.sh方式，在当前上下文中执行脚本，不会生成新的进程。脚本执行完毕，回到当前shell。<br> source方式也叫点命令。<br> . script.sh与 source script.sh等效。</p>\n<h4 id=\"3-exec方式\"><a href=\"#3-exec方式\" class=\"headerlink\" title=\"3. exec方式\"></a>3. exec方式</h4><p>使用exec command方式，会用command进程替换当前shell进程，并且保持PID不变。执行完毕，直接退出，不回到之前的shell环境。</p>\n<p>二、测试验证<br> vi loop.sh</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> [ 1 = 1 ]; <span class=\"keyword\">do</span> </span><br><span class=\"line\">    <span class=\"built_in\">echo</span> $$</span><br><span class=\"line\">    <span class=\"built_in\">sleep</span> 1</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<p>显示当前进程</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> $$</span><br><span class=\"line\">6770</span><br></pre></td></tr></table></figure>\n\n<p>sh的方式：执行loop.sh打印执行进程</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh loop<span class=\"selector-class\">.sh</span> </span><br><span class=\"line\"><span class=\"number\">13736</span></span><br><span class=\"line\"><span class=\"number\">13736</span></span><br></pre></td></tr></table></figure>\n\n<p>source方式：执行loop.sh打印执行进程</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> loop.sh</span><br><span class=\"line\">6770</span><br><span class=\"line\">6770</span><br></pre></td></tr></table></figure>\n\n<p>exec方式：执行loop.sh打印执行进程</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">exec</span> ./loop.sh</span><br><span class=\"line\">6770</span><br><span class=\"line\">6770</span><br></pre></td></tr></table></figure>\n\n<p>按下ctrl+C</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Connection closing...Socket close.</span><br><span class=\"line\">Connection closed by foreign host.</span><br><span class=\"line\">Disconnected from remote host.</span><br><span class=\"line\">Type `<span class=\"built_in\">help</span><span class=\"string\">&#x27; to learn how to use Xshell prompt.</span></span><br><span class=\"line\"><span class=\"string\">[~]$ </span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"结论：\"><a href=\"#结论：\" class=\"headerlink\" title=\"结论：\"></a>结论：</h4><p><strong>sh方式：父进程是6770，执行loop.sh时的子进程是13736。执行完毕后回到父进程shell。<br>source方式：父进程和子进程都是6770（执行时没有新的进程），执行完毕会回到父进程shell。<br>exec方式：进程PID没有改变都是6770，执行完毕（ctrl+C强制关闭）时直接退出了shell。脚本执行时替换了父进程的shell,执行完毕后直接退出，没有回到之前的shell。</strong></p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"执行shell脚本三种方法的区别：（sh、exec、source）\"><a href=\"#执行shell脚本三种方法的区别：（sh、exec、source）\" class=\"headerlink\" title=\"执行shell脚本三种方法的区别：（sh、exec、source）\"></a>执行shell脚本三种方法的区别：（sh、exec、source）</h1><h4 id=\"1-sh-方式\"><a href=\"#1-sh-方式\" class=\"headerlink\" title=\"1. sh 方式\"></a>1. sh 方式</h4><p>使用$ sh script.sh执行脚本时，当前shell是父进程，生成一个子shell进程，在子shell中执行脚本。脚本执行完毕，退出子shell，回到当前shell。<br> ./script.sh与 sh script.sh等效。</p>\n<h4 id=\"2-source方式\"><a href=\"#2-source方式\" class=\"headerlink\" title=\"2. source方式\"></a>2. source方式</h4><p>使用$ source script.sh方式，在当前上下文中执行脚本，不会生成新的进程。脚本执行完毕，回到当前shell。<br> source方式也叫点命令。<br> . script.sh与 source script.sh等效。</p>\n<h4 id=\"3-exec方式\"><a href=\"#3-exec方式\" class=\"headerlink\" title=\"3. exec方式\"></a>3. exec方式</h4><p>使用exec command方式，会用command进程替换当前shell进程，并且保持PID不变。执行完毕，直接退出，不回到之前的shell环境。</p>\n<p>二、测试验证<br> vi loop.sh</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\"><span class=\"keyword\">while</span> [ 1 = 1 ]; <span class=\"keyword\">do</span> </span><br><span class=\"line\">    <span class=\"built_in\">echo</span> $$</span><br><span class=\"line\">    <span class=\"built_in\">sleep</span> 1</span><br><span class=\"line\"><span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<p>显示当前进程</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">echo</span> $$</span><br><span class=\"line\">6770</span><br></pre></td></tr></table></figure>\n\n<p>sh的方式：执行loop.sh打印执行进程</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sh loop<span class=\"selector-class\">.sh</span> </span><br><span class=\"line\"><span class=\"number\">13736</span></span><br><span class=\"line\"><span class=\"number\">13736</span></span><br></pre></td></tr></table></figure>\n\n<p>source方式：执行loop.sh打印执行进程</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">source</span> loop.sh</span><br><span class=\"line\">6770</span><br><span class=\"line\">6770</span><br></pre></td></tr></table></figure>\n\n<p>exec方式：执行loop.sh打印执行进程</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">exec</span> ./loop.sh</span><br><span class=\"line\">6770</span><br><span class=\"line\">6770</span><br></pre></td></tr></table></figure>\n\n<p>按下ctrl+C</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Connection closing...Socket close.</span><br><span class=\"line\">Connection closed by foreign host.</span><br><span class=\"line\">Disconnected from remote host.</span><br><span class=\"line\">Type `<span class=\"built_in\">help</span><span class=\"string\">&#x27; to learn how to use Xshell prompt.</span></span><br><span class=\"line\"><span class=\"string\">[~]$ </span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"结论：\"><a href=\"#结论：\" class=\"headerlink\" title=\"结论：\"></a>结论：</h4><p><strong>sh方式：父进程是6770，执行loop.sh时的子进程是13736。执行完毕后回到父进程shell。<br>source方式：父进程和子进程都是6770（执行时没有新的进程），执行完毕会回到父进程shell。<br>exec方式：进程PID没有改变都是6770，执行完毕（ctrl+C强制关闭）时直接退出了shell。脚本执行时替换了父进程的shell,执行完毕后直接退出，没有回到之前的shell。</strong></p>\n"},{"uuid":"bbaf4810-c0ab-11ec-92a1-7557b2313227","title":"linux 简介","abbrlink":"42b9a7ea","_content":"\n# 基础教程\n\n## 简介\n\nLinux 遵循 GNU 通用公共许可证（GPL），任何个人和机构都可以自由地使用 Linux 的所有底层源代码，也可以自由地修改和再发布。\n\n由于 Linux 是自由软件，任何人都可以创建一个符合自己需求的 Linux 发行版。\n\n分为内核版和发行版\n\n目前主流的 Linux 版本有：\n\n- Debian（及其派生版本Ubuntu、Linux Mint）\n- Fedora（及其相关版本Red Hat Enterprise Linux、CentOS）\n- openSUSE\n- ...\n\n## 安装\n\ncentos 下载地址：\n\n可以去官网下载最新版本：\n\n> https://www.centos.org/download/\n\n通过vmware或者virtualbox进行安装。可参考常用软件安装。\n\n或者菜鸟教程：\n\n> https://www.runoob.com/linux/linux-install.html\n\n## 启动\n\nlinux启动时我们会看到许多启动信息。详见：https://www.runoob.com/linux/linux-system-boot.html\n\nLinux系统的启动过程并不是大家想象中的那么复杂，其过程可以分为5个阶段：\n\n- 内核的引导。\n- 运行 init。\n- 系统初始化。\n- 建立终端 。\n- 用户登录系统。\n\n> init程序的类型：\n>\n> - **SysV:** init, CentOS 5之前, 配置文件： /etc/inittab。\n> - **Upstart:** init,CentOS 6, 配置文件： /etc/inittab, /etc/init/*.conf。\n> - **Systemd：** systemd, CentOS 7,配置文件： /usr/lib/systemd/system、 /etc/systemd/system。\n\n## 连接和目录结构\n\n系统启动完成后，可以进行连接操作。\n\n一般来说，用户的登录方式有三种：\n\n- （1）命令行登录\n- （2）ssh登录\n- （3）图形界面登录\n\n> SSH中 输入用户名和密码 进行连接\n> exit 退出连接\n> su - root 切换root用户\n\n#### 目录结构\n\n树状目录结构：\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191606765.jpg)\n\n以下是对这些目录的解释：\n- **/bin**：\n  bin 是 Binaries (二进制文件) 的缩写, 这个目录存放着最经常使用的命令。\n- **/boot：**\n  这里存放的是启动 Linux 时使用的一些核心文件，包括一些连接文件以及镜像文件。\n- **/dev ：**\n  dev 是 Device(设备) 的缩写, 该目录下存放的是 Linux 的外部设备，在 Linux 中访问设备的方式和访问文件的方式是相同的。\n- **/etc：**\n  etc 是 Etcetera(等等) 的缩写,这个目录用来存放所有的系统管理所需要的配置文件和子目录。\n- **/home**：\n  用户的主目录，在 Linux 中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的，如上图中的 alice、bob 和 eve。\n- **/lib**：\n  lib 是 Library(库) 的缩写这个目录里存放着系统最基本的动态连接共享库，其作用类似于 Windows 里的 DLL 文件。几乎所有的应用程序都需要用到这些共享库。\n- **/lost+found**：\n  这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。\n- **/media**：\n  linux 系统会自动识别一些设备，例如U盘、光驱等等，当识别后，Linux 会把识别的设备挂载到这个目录下。\n- **/mnt**：\n  系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将光驱挂载在 /mnt/ 上，然后进入该目录就可以查看光驱里的内容了。\n- **/opt**：\n  opt 是 optional(可选) 的缩写，这是给主机额外安装软件所摆放的目录。比如你安装一个ORACLE数据库则就可以放到这个目录下。默认是空的。\n- **/proc**：\n  proc 是 Processes(进程) 的缩写，/proc 是一种伪文件系统（也即虚拟文件系统），存储的是当前内核运行状态的一系列特殊文件，这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。\n  这个目录的内容不在硬盘上而是在内存里，我们也可以直接修改里面的某些文件，比如可以通过下面的命令来屏蔽主机的ping命令，使别人无法ping你的机器：\n  ```\n  echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all\n  ```\n- **/root**：\n  该目录为系统管理员，也称作超级权限者的用户主目录。\n- **/sbin**：\n  s 就是 Super User 的意思，是 Superuser Binaries (超级用户的二进制文件) 的缩写，这里存放的是系统管理员使用的系统管理程序。\n- **/selinux**：\n   这个目录是 Redhat/CentOS 所特有的目录，Selinux 是一个安全机制，类似于 windows 的防火墙，但是这套机制比较复杂，这个目录就是存放selinux相关的文件的。\n- **/srv**：\n   该目录存放一些服务启动之后需要提取的数据。\n- **/sys**：\n  这是 Linux2.6 内核的一个很大的变化。该目录下安装了 2.6 内核中新出现的一个文件系统 sysfs 。\n  sysfs 文件系统集成了下面3种文件系统的信息：针对进程信息的 proc 文件系统、针对设备的 devfs 文件系统以及针对伪终端的 devpts 文件系统。\n  该文件系统是内核设备树的一个直观反映。\n  当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中被创建。\n- **/tmp**：\n  tmp 是 temporary(临时) 的缩写这个目录是用来存放一些临时文件的。\n- **/usr**：\n   usr 是 unix shared resources(共享资源) 的缩写，这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于 windows 下的 program files 目录。\n- **/usr/bin：**\n  系统用户使用的应用程序。\n- **/usr/sbin：**\n  超级用户使用的比较高级的管理程序和系统守护程序。\n- **/usr/src：**\n  内核源代码默认的放置目录。\n- **/var**：\n  var 是 variable(变量) 的缩写，这个目录中存放着在不断扩充着的东西，我们习惯将那些经常被修改的目录放在这个目录下。包括各种日志文件。\n- **/run**：\n  是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。如果你的系统上有 /var/run 目录，应该让它指向 run。\n\n## 关机\n\n```shell\nsync 将数据由内存同步到硬盘中。\nshutdown 关机指令，你可以man shutdown 来看一下帮助文档。例如你可以运行如下命令关机：\nshutdown –h 10 ‘This server will shutdown after 10 mins’ 这个命令告诉大家，计算机将在10分钟后关机，并且会显示在登陆用户的当前屏幕中。\nshutdown –h now 立马关机\nshutdown –h 20:25 系统会在今天20:25关机\nshutdown –h +10 十分钟后关机\nshutdown –r now 系统立马重启\nshutdown –r +10 系统十分钟后重启\nreboot 就是重启，等同于 shutdown –r now\nhalt 关闭系统，等同于shutdown –h now 和 poweroff\n关机 init 0 \n重启 init 1\n```\n\n## 帮助命令\n\n1. man\n   ```shell\n   man\n   # Q 退出\n   man ls\n   man man\n   # 数字代表章数，一共9章\n   man 1 ls\n   # 不知道第几章\n   man -a passwd\n   ```\n2. help\n   ```shell\n   # shell自动解释的命令称为内部命令，其他为外部命令\n   # 内部命令\n   help cd\n   # 外部命令\n   ls --help\n   ```\n3. info\n   ```she\n   info ls\n   ```\n\n## 文件管理\n\n##### ### 列出目录\n`ls`命令\n\n- -l 长格式显示文件\n- -a 显示隐藏文件\n- -r 逆序显示\n- -t 按时间顺序显示\n- -R 递归显示\n- -h 显示文件大小\n\n> -rw------- 共10位 第一位 文件类型 后9位 文件权限\n> 第一位 普通文件是- 目录d\n\n### 更换目录\n\n```shell\n# 查看当前用户空间\npwd\n# 切换目录空间\ncd\n# 根目录\ncd / \n# 当前目录\ncd . \n# 上一级目录\ncd ..\n# 返回上一次历史目录\ncd -\n# 清除历史\nclear\ncontrol + l\n```\n\n### 目录和文件的基本操作\n\n对文件的各种操作中，可以使用通配符。\n\n##### 通配符介绍\n\n- *多个字符\n- ?单个字符\n\n### 新建目录\n\n```shell\n# mkdir 可以同时创建多个目录,如果目录存在,会报错\nmkdir a b c\n# 依次创建子目录\nmkdir -p a/c/c\n```\n\n### 删除目录\n\n```shell\n# rmdir 只能删除空白目录\nrmdir a\n# 递归删除, 需要确认\nrm -r a\n# 递归删除, 不需要确认\nrm -rf a\n# rm -rf / a 需注意空格, 不小心会删除根目录\n```\n\n### 复制\n\n```shell\n# cp 源文件名 目标文件名\ncp test test1\n# 复制目录 cp -r\n# cp -v 显示复制的过程\n# cp -p 保留原有文件时间\n# cp -a 保留权限 属主 时间\n```\n\n### 移动\n\n```shell\n# mv 移动或改名\n# mv 源文件 目标文件 \nmv /dir /tmp # 移动目录\nmv file* /\nmv file? /\ncp file* /\n```\n\n### 文本查看\n\n```shell\n# 新建文件\ntouch file\n# wc 统计文件内容信息\nwc -l file  # 查看文件多少行\ncat file\n# 不加数字，默认10行\nhead -5 file\ntail -5 file\nless\nmore\n```\n\n### 打包和压缩\n\n```shell\n# c(包) z(压缩) f(文件)\ntar czf newfile sourcefile\n# 解压缩 -C 指定解压目录\ntar zxf -C /tmp \n```\n\n## 文本编辑\n\nvim四种模式\n- 正常模式\n  按`i`进入插入模式\n- 插入模式\n- 命令模式\n- 可视模式\n","source":"_posts/linux/基础教程.md","raw":"---\nuuid: bbaf4810-c0ab-11ec-92a1-7557b2313227\ntitle: linux 简介\ncategories: Linux\ntags:\n  - linux\nabbrlink: 42b9a7ea\n---\n\n# 基础教程\n\n## 简介\n\nLinux 遵循 GNU 通用公共许可证（GPL），任何个人和机构都可以自由地使用 Linux 的所有底层源代码，也可以自由地修改和再发布。\n\n由于 Linux 是自由软件，任何人都可以创建一个符合自己需求的 Linux 发行版。\n\n分为内核版和发行版\n\n目前主流的 Linux 版本有：\n\n- Debian（及其派生版本Ubuntu、Linux Mint）\n- Fedora（及其相关版本Red Hat Enterprise Linux、CentOS）\n- openSUSE\n- ...\n\n## 安装\n\ncentos 下载地址：\n\n可以去官网下载最新版本：\n\n> https://www.centos.org/download/\n\n通过vmware或者virtualbox进行安装。可参考常用软件安装。\n\n或者菜鸟教程：\n\n> https://www.runoob.com/linux/linux-install.html\n\n## 启动\n\nlinux启动时我们会看到许多启动信息。详见：https://www.runoob.com/linux/linux-system-boot.html\n\nLinux系统的启动过程并不是大家想象中的那么复杂，其过程可以分为5个阶段：\n\n- 内核的引导。\n- 运行 init。\n- 系统初始化。\n- 建立终端 。\n- 用户登录系统。\n\n> init程序的类型：\n>\n> - **SysV:** init, CentOS 5之前, 配置文件： /etc/inittab。\n> - **Upstart:** init,CentOS 6, 配置文件： /etc/inittab, /etc/init/*.conf。\n> - **Systemd：** systemd, CentOS 7,配置文件： /usr/lib/systemd/system、 /etc/systemd/system。\n\n## 连接和目录结构\n\n系统启动完成后，可以进行连接操作。\n\n一般来说，用户的登录方式有三种：\n\n- （1）命令行登录\n- （2）ssh登录\n- （3）图形界面登录\n\n> SSH中 输入用户名和密码 进行连接\n> exit 退出连接\n> su - root 切换root用户\n\n#### 目录结构\n\n树状目录结构：\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191606765.jpg)\n\n以下是对这些目录的解释：\n- **/bin**：\n  bin 是 Binaries (二进制文件) 的缩写, 这个目录存放着最经常使用的命令。\n- **/boot：**\n  这里存放的是启动 Linux 时使用的一些核心文件，包括一些连接文件以及镜像文件。\n- **/dev ：**\n  dev 是 Device(设备) 的缩写, 该目录下存放的是 Linux 的外部设备，在 Linux 中访问设备的方式和访问文件的方式是相同的。\n- **/etc：**\n  etc 是 Etcetera(等等) 的缩写,这个目录用来存放所有的系统管理所需要的配置文件和子目录。\n- **/home**：\n  用户的主目录，在 Linux 中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的，如上图中的 alice、bob 和 eve。\n- **/lib**：\n  lib 是 Library(库) 的缩写这个目录里存放着系统最基本的动态连接共享库，其作用类似于 Windows 里的 DLL 文件。几乎所有的应用程序都需要用到这些共享库。\n- **/lost+found**：\n  这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。\n- **/media**：\n  linux 系统会自动识别一些设备，例如U盘、光驱等等，当识别后，Linux 会把识别的设备挂载到这个目录下。\n- **/mnt**：\n  系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将光驱挂载在 /mnt/ 上，然后进入该目录就可以查看光驱里的内容了。\n- **/opt**：\n  opt 是 optional(可选) 的缩写，这是给主机额外安装软件所摆放的目录。比如你安装一个ORACLE数据库则就可以放到这个目录下。默认是空的。\n- **/proc**：\n  proc 是 Processes(进程) 的缩写，/proc 是一种伪文件系统（也即虚拟文件系统），存储的是当前内核运行状态的一系列特殊文件，这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。\n  这个目录的内容不在硬盘上而是在内存里，我们也可以直接修改里面的某些文件，比如可以通过下面的命令来屏蔽主机的ping命令，使别人无法ping你的机器：\n  ```\n  echo 1 > /proc/sys/net/ipv4/icmp_echo_ignore_all\n  ```\n- **/root**：\n  该目录为系统管理员，也称作超级权限者的用户主目录。\n- **/sbin**：\n  s 就是 Super User 的意思，是 Superuser Binaries (超级用户的二进制文件) 的缩写，这里存放的是系统管理员使用的系统管理程序。\n- **/selinux**：\n   这个目录是 Redhat/CentOS 所特有的目录，Selinux 是一个安全机制，类似于 windows 的防火墙，但是这套机制比较复杂，这个目录就是存放selinux相关的文件的。\n- **/srv**：\n   该目录存放一些服务启动之后需要提取的数据。\n- **/sys**：\n  这是 Linux2.6 内核的一个很大的变化。该目录下安装了 2.6 内核中新出现的一个文件系统 sysfs 。\n  sysfs 文件系统集成了下面3种文件系统的信息：针对进程信息的 proc 文件系统、针对设备的 devfs 文件系统以及针对伪终端的 devpts 文件系统。\n  该文件系统是内核设备树的一个直观反映。\n  当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中被创建。\n- **/tmp**：\n  tmp 是 temporary(临时) 的缩写这个目录是用来存放一些临时文件的。\n- **/usr**：\n   usr 是 unix shared resources(共享资源) 的缩写，这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于 windows 下的 program files 目录。\n- **/usr/bin：**\n  系统用户使用的应用程序。\n- **/usr/sbin：**\n  超级用户使用的比较高级的管理程序和系统守护程序。\n- **/usr/src：**\n  内核源代码默认的放置目录。\n- **/var**：\n  var 是 variable(变量) 的缩写，这个目录中存放着在不断扩充着的东西，我们习惯将那些经常被修改的目录放在这个目录下。包括各种日志文件。\n- **/run**：\n  是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。如果你的系统上有 /var/run 目录，应该让它指向 run。\n\n## 关机\n\n```shell\nsync 将数据由内存同步到硬盘中。\nshutdown 关机指令，你可以man shutdown 来看一下帮助文档。例如你可以运行如下命令关机：\nshutdown –h 10 ‘This server will shutdown after 10 mins’ 这个命令告诉大家，计算机将在10分钟后关机，并且会显示在登陆用户的当前屏幕中。\nshutdown –h now 立马关机\nshutdown –h 20:25 系统会在今天20:25关机\nshutdown –h +10 十分钟后关机\nshutdown –r now 系统立马重启\nshutdown –r +10 系统十分钟后重启\nreboot 就是重启，等同于 shutdown –r now\nhalt 关闭系统，等同于shutdown –h now 和 poweroff\n关机 init 0 \n重启 init 1\n```\n\n## 帮助命令\n\n1. man\n   ```shell\n   man\n   # Q 退出\n   man ls\n   man man\n   # 数字代表章数，一共9章\n   man 1 ls\n   # 不知道第几章\n   man -a passwd\n   ```\n2. help\n   ```shell\n   # shell自动解释的命令称为内部命令，其他为外部命令\n   # 内部命令\n   help cd\n   # 外部命令\n   ls --help\n   ```\n3. info\n   ```she\n   info ls\n   ```\n\n## 文件管理\n\n##### ### 列出目录\n`ls`命令\n\n- -l 长格式显示文件\n- -a 显示隐藏文件\n- -r 逆序显示\n- -t 按时间顺序显示\n- -R 递归显示\n- -h 显示文件大小\n\n> -rw------- 共10位 第一位 文件类型 后9位 文件权限\n> 第一位 普通文件是- 目录d\n\n### 更换目录\n\n```shell\n# 查看当前用户空间\npwd\n# 切换目录空间\ncd\n# 根目录\ncd / \n# 当前目录\ncd . \n# 上一级目录\ncd ..\n# 返回上一次历史目录\ncd -\n# 清除历史\nclear\ncontrol + l\n```\n\n### 目录和文件的基本操作\n\n对文件的各种操作中，可以使用通配符。\n\n##### 通配符介绍\n\n- *多个字符\n- ?单个字符\n\n### 新建目录\n\n```shell\n# mkdir 可以同时创建多个目录,如果目录存在,会报错\nmkdir a b c\n# 依次创建子目录\nmkdir -p a/c/c\n```\n\n### 删除目录\n\n```shell\n# rmdir 只能删除空白目录\nrmdir a\n# 递归删除, 需要确认\nrm -r a\n# 递归删除, 不需要确认\nrm -rf a\n# rm -rf / a 需注意空格, 不小心会删除根目录\n```\n\n### 复制\n\n```shell\n# cp 源文件名 目标文件名\ncp test test1\n# 复制目录 cp -r\n# cp -v 显示复制的过程\n# cp -p 保留原有文件时间\n# cp -a 保留权限 属主 时间\n```\n\n### 移动\n\n```shell\n# mv 移动或改名\n# mv 源文件 目标文件 \nmv /dir /tmp # 移动目录\nmv file* /\nmv file? /\ncp file* /\n```\n\n### 文本查看\n\n```shell\n# 新建文件\ntouch file\n# wc 统计文件内容信息\nwc -l file  # 查看文件多少行\ncat file\n# 不加数字，默认10行\nhead -5 file\ntail -5 file\nless\nmore\n```\n\n### 打包和压缩\n\n```shell\n# c(包) z(压缩) f(文件)\ntar czf newfile sourcefile\n# 解压缩 -C 指定解压目录\ntar zxf -C /tmp \n```\n\n## 文本编辑\n\nvim四种模式\n- 正常模式\n  按`i`进入插入模式\n- 插入模式\n- 命令模式\n- 可视模式\n","slug":"linux/基础教程","published":1,"date":"2022-04-20T12:41:20.886Z","updated":"2022-05-04T03:20:04.360Z","_id":"cl2qzfti3003y13no3h7m90n9","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"基础教程\"><a href=\"#基础教程\" class=\"headerlink\" title=\"基础教程\"></a>基础教程</h1><h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>Linux 遵循 GNU 通用公共许可证（GPL），任何个人和机构都可以自由地使用 Linux 的所有底层源代码，也可以自由地修改和再发布。</p>\n<p>由于 Linux 是自由软件，任何人都可以创建一个符合自己需求的 Linux 发行版。</p>\n<p>分为内核版和发行版</p>\n<p>目前主流的 Linux 版本有：</p>\n<ul>\n<li>Debian（及其派生版本Ubuntu、Linux Mint）</li>\n<li>Fedora（及其相关版本Red Hat Enterprise Linux、CentOS）</li>\n<li>openSUSE</li>\n<li>…</li>\n</ul>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>centos 下载地址：</p>\n<p>可以去官网下载最新版本：</p>\n<blockquote>\n<p><a href=\"https://www.centos.org/download/\">https://www.centos.org/download/</a></p>\n</blockquote>\n<p>通过vmware或者virtualbox进行安装。可参考常用软件安装。</p>\n<p>或者菜鸟教程：</p>\n<blockquote>\n<p><a href=\"https://www.runoob.com/linux/linux-install.html\">https://www.runoob.com/linux/linux-install.html</a></p>\n</blockquote>\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><p>linux启动时我们会看到许多启动信息。详见：<a href=\"https://www.runoob.com/linux/linux-system-boot.html\">https://www.runoob.com/linux/linux-system-boot.html</a></p>\n<p>Linux系统的启动过程并不是大家想象中的那么复杂，其过程可以分为5个阶段：</p>\n<ul>\n<li>内核的引导。</li>\n<li>运行 init。</li>\n<li>系统初始化。</li>\n<li>建立终端 。</li>\n<li>用户登录系统。</li>\n</ul>\n<blockquote>\n<p>init程序的类型：</p>\n<ul>\n<li><strong>SysV:</strong> init, CentOS 5之前, 配置文件： /etc/inittab。</li>\n<li><strong>Upstart:</strong> init,CentOS 6, 配置文件： /etc/inittab, /etc/init/*.conf。</li>\n<li><strong>Systemd：</strong> systemd, CentOS 7,配置文件： /usr/lib/systemd/system、 /etc/systemd/system。</li>\n</ul>\n</blockquote>\n<h2 id=\"连接和目录结构\"><a href=\"#连接和目录结构\" class=\"headerlink\" title=\"连接和目录结构\"></a>连接和目录结构</h2><p>系统启动完成后，可以进行连接操作。</p>\n<p>一般来说，用户的登录方式有三种：</p>\n<ul>\n<li>（1）命令行登录</li>\n<li>（2）ssh登录</li>\n<li>（3）图形界面登录</li>\n</ul>\n<blockquote>\n<p>SSH中 输入用户名和密码 进行连接<br>exit 退出连接<br>su - root 切换root用户</p>\n</blockquote>\n<h4 id=\"目录结构\"><a href=\"#目录结构\" class=\"headerlink\" title=\"目录结构\"></a>目录结构</h4><p>树状目录结构：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191606765.jpg\" alt=\"img\"></p>\n<p>以下是对这些目录的解释：</p>\n<ul>\n<li><strong>/bin</strong>：<br>bin 是 Binaries (二进制文件) 的缩写, 这个目录存放着最经常使用的命令。</li>\n<li><strong>/boot：</strong><br>这里存放的是启动 Linux 时使用的一些核心文件，包括一些连接文件以及镜像文件。</li>\n<li><strong>/dev ：</strong><br>dev 是 Device(设备) 的缩写, 该目录下存放的是 Linux 的外部设备，在 Linux 中访问设备的方式和访问文件的方式是相同的。</li>\n<li><strong>/etc：</strong><br>etc 是 Etcetera(等等) 的缩写,这个目录用来存放所有的系统管理所需要的配置文件和子目录。</li>\n<li><strong>/home</strong>：<br>用户的主目录，在 Linux 中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的，如上图中的 alice、bob 和 eve。</li>\n<li><strong>/lib</strong>：<br>lib 是 Library(库) 的缩写这个目录里存放着系统最基本的动态连接共享库，其作用类似于 Windows 里的 DLL 文件。几乎所有的应用程序都需要用到这些共享库。</li>\n<li><strong>/lost+found</strong>：<br>这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。</li>\n<li><strong>/media</strong>：<br>linux 系统会自动识别一些设备，例如U盘、光驱等等，当识别后，Linux 会把识别的设备挂载到这个目录下。</li>\n<li><strong>/mnt</strong>：<br>系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将光驱挂载在 /mnt/ 上，然后进入该目录就可以查看光驱里的内容了。</li>\n<li><strong>/opt</strong>：<br>opt 是 optional(可选) 的缩写，这是给主机额外安装软件所摆放的目录。比如你安装一个ORACLE数据库则就可以放到这个目录下。默认是空的。</li>\n<li><strong>/proc</strong>：<br>proc 是 Processes(进程) 的缩写，/proc 是一种伪文件系统（也即虚拟文件系统），存储的是当前内核运行状态的一系列特殊文件，这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。<br>这个目录的内容不在硬盘上而是在内存里，我们也可以直接修改里面的某些文件，比如可以通过下面的命令来屏蔽主机的ping命令，使别人无法ping你的机器：<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</span><br></pre></td></tr></table></figure></li>\n<li><strong>/root</strong>：<br>该目录为系统管理员，也称作超级权限者的用户主目录。</li>\n<li><strong>/sbin</strong>：<br>s 就是 Super User 的意思，是 Superuser Binaries (超级用户的二进制文件) 的缩写，这里存放的是系统管理员使用的系统管理程序。</li>\n<li><strong>/selinux</strong>：<br> 这个目录是 Redhat/CentOS 所特有的目录，Selinux 是一个安全机制，类似于 windows 的防火墙，但是这套机制比较复杂，这个目录就是存放selinux相关的文件的。</li>\n<li><strong>/srv</strong>：<br> 该目录存放一些服务启动之后需要提取的数据。</li>\n<li><strong>/sys</strong>：<br>这是 Linux2.6 内核的一个很大的变化。该目录下安装了 2.6 内核中新出现的一个文件系统 sysfs 。<br>sysfs 文件系统集成了下面3种文件系统的信息：针对进程信息的 proc 文件系统、针对设备的 devfs 文件系统以及针对伪终端的 devpts 文件系统。<br>该文件系统是内核设备树的一个直观反映。<br>当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中被创建。</li>\n<li><strong>/tmp</strong>：<br>tmp 是 temporary(临时) 的缩写这个目录是用来存放一些临时文件的。</li>\n<li><strong>/usr</strong>：<br> usr 是 unix shared resources(共享资源) 的缩写，这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于 windows 下的 program files 目录。</li>\n<li><strong>/usr/bin：</strong><br>系统用户使用的应用程序。</li>\n<li><strong>/usr/sbin：</strong><br>超级用户使用的比较高级的管理程序和系统守护程序。</li>\n<li><strong>/usr/src：</strong><br>内核源代码默认的放置目录。</li>\n<li><strong>/var</strong>：<br>var 是 variable(变量) 的缩写，这个目录中存放着在不断扩充着的东西，我们习惯将那些经常被修改的目录放在这个目录下。包括各种日志文件。</li>\n<li><strong>/run</strong>：<br>是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。如果你的系统上有 /var/run 目录，应该让它指向 run。</li>\n</ul>\n<h2 id=\"关机\"><a href=\"#关机\" class=\"headerlink\" title=\"关机\"></a>关机</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sync 将数据由内存同步到硬盘中。</span><br><span class=\"line\">shutdown 关机指令，你可以man shutdown 来看一下帮助文档。例如你可以运行如下命令关机：</span><br><span class=\"line\">shutdown –h 10 ‘This server will shutdown after 10 mins’ 这个命令告诉大家，计算机将在10分钟后关机，并且会显示在登陆用户的当前屏幕中。</span><br><span class=\"line\">shutdown –h now 立马关机</span><br><span class=\"line\">shutdown –h 20:25 系统会在今天20:25关机</span><br><span class=\"line\">shutdown –h +10 十分钟后关机</span><br><span class=\"line\">shutdown –r now 系统立马重启</span><br><span class=\"line\">shutdown –r +10 系统十分钟后重启</span><br><span class=\"line\">reboot 就是重启，等同于 shutdown –r now</span><br><span class=\"line\">halt 关闭系统，等同于shutdown –h now 和 poweroff</span><br><span class=\"line\">关机 init 0 </span><br><span class=\"line\">重启 init 1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"帮助命令\"><a href=\"#帮助命令\" class=\"headerlink\" title=\"帮助命令\"></a>帮助命令</h2><ol>\n<li>man<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">man</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Q 退出</span></span><br><span class=\"line\">man ls</span><br><span class=\"line\">man man</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">数字代表章数，一共9章</span></span><br><span class=\"line\">man 1 ls</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">不知道第几章</span></span><br><span class=\"line\">man -a passwd</span><br></pre></td></tr></table></figure></li>\n<li>help<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">shell自动解释的命令称为内部命令，其他为外部命令</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">内部命令</span></span><br><span class=\"line\">help cd</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">外部命令</span></span><br><span class=\"line\">ls --help</span><br></pre></td></tr></table></figure></li>\n<li>info<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">info ls</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"文件管理\"><a href=\"#文件管理\" class=\"headerlink\" title=\"文件管理\"></a>文件管理</h2><h5 id=\"列出目录\"><a href=\"#列出目录\" class=\"headerlink\" title=\"### 列出目录\"></a>### 列出目录</h5><p><code>ls</code>命令</p>\n<ul>\n<li>-l 长格式显示文件</li>\n<li>-a 显示隐藏文件</li>\n<li>-r 逆序显示</li>\n<li>-t 按时间顺序显示</li>\n<li>-R 递归显示</li>\n<li>-h 显示文件大小</li>\n</ul>\n<blockquote>\n<p>-rw——- 共10位 第一位 文件类型 后9位 文件权限<br>第一位 普通文件是- 目录d</p>\n</blockquote>\n<h3 id=\"更换目录\"><a href=\"#更换目录\" class=\"headerlink\" title=\"更换目录\"></a>更换目录</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">查看当前用户空间</span></span><br><span class=\"line\">pwd</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">切换目录空间</span></span><br><span class=\"line\">cd</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">根目录</span></span><br><span class=\"line\">cd / </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">当前目录</span></span><br><span class=\"line\">cd . </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">上一级目录</span></span><br><span class=\"line\">cd ..</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">返回上一次历史目录</span></span><br><span class=\"line\">cd -</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">清除历史</span></span><br><span class=\"line\">clear</span><br><span class=\"line\">control + l</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"目录和文件的基本操作\"><a href=\"#目录和文件的基本操作\" class=\"headerlink\" title=\"目录和文件的基本操作\"></a>目录和文件的基本操作</h3><p>对文件的各种操作中，可以使用通配符。</p>\n<h5 id=\"通配符介绍\"><a href=\"#通配符介绍\" class=\"headerlink\" title=\"通配符介绍\"></a>通配符介绍</h5><ul>\n<li>*多个字符</li>\n<li>?单个字符</li>\n</ul>\n<h3 id=\"新建目录\"><a href=\"#新建目录\" class=\"headerlink\" title=\"新建目录\"></a>新建目录</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">mkdir</span> 可以同时创建多个目录,如果目录存在,会报错</span></span><br><span class=\"line\">mkdir a b c</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">依次创建子目录</span></span><br><span class=\"line\">mkdir -p a/c/c</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除目录\"><a href=\"#删除目录\" class=\"headerlink\" title=\"删除目录\"></a>删除目录</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">rmdir</span> 只能删除空白目录</span></span><br><span class=\"line\">rmdir a</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">递归删除, 需要确认</span></span><br><span class=\"line\">rm -r a</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">递归删除, 不需要确认</span></span><br><span class=\"line\">rm -rf a</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">rm</span> -rf / a 需注意空格, 不小心会删除根目录</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"复制\"><a href=\"#复制\" class=\"headerlink\" title=\"复制\"></a>复制</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">cp</span> 源文件名 目标文件名</span></span><br><span class=\"line\">cp test test1</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">复制目录 <span class=\"built_in\">cp</span> -r</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">cp</span> -v 显示复制的过程</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">cp</span> -p 保留原有文件时间</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">cp</span> -a 保留权限 属主 时间</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"移动\"><a href=\"#移动\" class=\"headerlink\" title=\"移动\"></a>移动</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">mv</span> 移动或改名</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">mv</span> 源文件 目标文件</span> </span><br><span class=\"line\">mv /dir /tmp # 移动目录</span><br><span class=\"line\">mv file* /</span><br><span class=\"line\">mv file? /</span><br><span class=\"line\">cp file* /</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"文本查看\"><a href=\"#文本查看\" class=\"headerlink\" title=\"文本查看\"></a>文本查看</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">新建文件</span></span><br><span class=\"line\">touch file</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">wc</span> 统计文件内容信息</span></span><br><span class=\"line\">wc -l file  # 查看文件多少行</span><br><span class=\"line\">cat file</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">不加数字，默认10行</span></span><br><span class=\"line\">head -5 file</span><br><span class=\"line\">tail -5 file</span><br><span class=\"line\">less</span><br><span class=\"line\">more</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"打包和压缩\"><a href=\"#打包和压缩\" class=\"headerlink\" title=\"打包和压缩\"></a>打包和压缩</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">c(包) z(压缩) f(文件)</span></span><br><span class=\"line\">tar czf newfile sourcefile</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">解压缩 -C 指定解压目录</span></span><br><span class=\"line\">tar zxf -C /tmp </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"文本编辑\"><a href=\"#文本编辑\" class=\"headerlink\" title=\"文本编辑\"></a>文本编辑</h2><p>vim四种模式</p>\n<ul>\n<li>正常模式<br>按<code>i</code>进入插入模式</li>\n<li>插入模式</li>\n<li>命令模式</li>\n<li>可视模式</li>\n</ul>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"基础教程\"><a href=\"#基础教程\" class=\"headerlink\" title=\"基础教程\"></a>基础教程</h1><h2 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h2><p>Linux 遵循 GNU 通用公共许可证（GPL），任何个人和机构都可以自由地使用 Linux 的所有底层源代码，也可以自由地修改和再发布。</p>\n<p>由于 Linux 是自由软件，任何人都可以创建一个符合自己需求的 Linux 发行版。</p>\n<p>分为内核版和发行版</p>\n<p>目前主流的 Linux 版本有：</p>\n<ul>\n<li>Debian（及其派生版本Ubuntu、Linux Mint）</li>\n<li>Fedora（及其相关版本Red Hat Enterprise Linux、CentOS）</li>\n<li>openSUSE</li>\n<li>…</li>\n</ul>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><p>centos 下载地址：</p>\n<p>可以去官网下载最新版本：</p>\n<blockquote>\n<p><a href=\"https://www.centos.org/download/\">https://www.centos.org/download/</a></p>\n</blockquote>\n<p>通过vmware或者virtualbox进行安装。可参考常用软件安装。</p>\n<p>或者菜鸟教程：</p>\n<blockquote>\n<p><a href=\"https://www.runoob.com/linux/linux-install.html\">https://www.runoob.com/linux/linux-install.html</a></p>\n</blockquote>\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><p>linux启动时我们会看到许多启动信息。详见：<a href=\"https://www.runoob.com/linux/linux-system-boot.html\">https://www.runoob.com/linux/linux-system-boot.html</a></p>\n<p>Linux系统的启动过程并不是大家想象中的那么复杂，其过程可以分为5个阶段：</p>\n<ul>\n<li>内核的引导。</li>\n<li>运行 init。</li>\n<li>系统初始化。</li>\n<li>建立终端 。</li>\n<li>用户登录系统。</li>\n</ul>\n<blockquote>\n<p>init程序的类型：</p>\n<ul>\n<li><strong>SysV:</strong> init, CentOS 5之前, 配置文件： /etc/inittab。</li>\n<li><strong>Upstart:</strong> init,CentOS 6, 配置文件： /etc/inittab, /etc/init/*.conf。</li>\n<li><strong>Systemd：</strong> systemd, CentOS 7,配置文件： /usr/lib/systemd/system、 /etc/systemd/system。</li>\n</ul>\n</blockquote>\n<h2 id=\"连接和目录结构\"><a href=\"#连接和目录结构\" class=\"headerlink\" title=\"连接和目录结构\"></a>连接和目录结构</h2><p>系统启动完成后，可以进行连接操作。</p>\n<p>一般来说，用户的登录方式有三种：</p>\n<ul>\n<li>（1）命令行登录</li>\n<li>（2）ssh登录</li>\n<li>（3）图形界面登录</li>\n</ul>\n<blockquote>\n<p>SSH中 输入用户名和密码 进行连接<br>exit 退出连接<br>su - root 切换root用户</p>\n</blockquote>\n<h4 id=\"目录结构\"><a href=\"#目录结构\" class=\"headerlink\" title=\"目录结构\"></a>目录结构</h4><p>树状目录结构：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191606765.jpg\" alt=\"img\"></p>\n<p>以下是对这些目录的解释：</p>\n<ul>\n<li><strong>/bin</strong>：<br>bin 是 Binaries (二进制文件) 的缩写, 这个目录存放着最经常使用的命令。</li>\n<li><strong>/boot：</strong><br>这里存放的是启动 Linux 时使用的一些核心文件，包括一些连接文件以及镜像文件。</li>\n<li><strong>/dev ：</strong><br>dev 是 Device(设备) 的缩写, 该目录下存放的是 Linux 的外部设备，在 Linux 中访问设备的方式和访问文件的方式是相同的。</li>\n<li><strong>/etc：</strong><br>etc 是 Etcetera(等等) 的缩写,这个目录用来存放所有的系统管理所需要的配置文件和子目录。</li>\n<li><strong>/home</strong>：<br>用户的主目录，在 Linux 中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的，如上图中的 alice、bob 和 eve。</li>\n<li><strong>/lib</strong>：<br>lib 是 Library(库) 的缩写这个目录里存放着系统最基本的动态连接共享库，其作用类似于 Windows 里的 DLL 文件。几乎所有的应用程序都需要用到这些共享库。</li>\n<li><strong>/lost+found</strong>：<br>这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。</li>\n<li><strong>/media</strong>：<br>linux 系统会自动识别一些设备，例如U盘、光驱等等，当识别后，Linux 会把识别的设备挂载到这个目录下。</li>\n<li><strong>/mnt</strong>：<br>系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将光驱挂载在 /mnt/ 上，然后进入该目录就可以查看光驱里的内容了。</li>\n<li><strong>/opt</strong>：<br>opt 是 optional(可选) 的缩写，这是给主机额外安装软件所摆放的目录。比如你安装一个ORACLE数据库则就可以放到这个目录下。默认是空的。</li>\n<li><strong>/proc</strong>：<br>proc 是 Processes(进程) 的缩写，/proc 是一种伪文件系统（也即虚拟文件系统），存储的是当前内核运行状态的一系列特殊文件，这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。<br>这个目录的内容不在硬盘上而是在内存里，我们也可以直接修改里面的某些文件，比如可以通过下面的命令来屏蔽主机的ping命令，使别人无法ping你的机器：<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</span><br></pre></td></tr></table></figure></li>\n<li><strong>/root</strong>：<br>该目录为系统管理员，也称作超级权限者的用户主目录。</li>\n<li><strong>/sbin</strong>：<br>s 就是 Super User 的意思，是 Superuser Binaries (超级用户的二进制文件) 的缩写，这里存放的是系统管理员使用的系统管理程序。</li>\n<li><strong>/selinux</strong>：<br> 这个目录是 Redhat/CentOS 所特有的目录，Selinux 是一个安全机制，类似于 windows 的防火墙，但是这套机制比较复杂，这个目录就是存放selinux相关的文件的。</li>\n<li><strong>/srv</strong>：<br> 该目录存放一些服务启动之后需要提取的数据。</li>\n<li><strong>/sys</strong>：<br>这是 Linux2.6 内核的一个很大的变化。该目录下安装了 2.6 内核中新出现的一个文件系统 sysfs 。<br>sysfs 文件系统集成了下面3种文件系统的信息：针对进程信息的 proc 文件系统、针对设备的 devfs 文件系统以及针对伪终端的 devpts 文件系统。<br>该文件系统是内核设备树的一个直观反映。<br>当一个内核对象被创建的时候，对应的文件和目录也在内核对象子系统中被创建。</li>\n<li><strong>/tmp</strong>：<br>tmp 是 temporary(临时) 的缩写这个目录是用来存放一些临时文件的。</li>\n<li><strong>/usr</strong>：<br> usr 是 unix shared resources(共享资源) 的缩写，这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于 windows 下的 program files 目录。</li>\n<li><strong>/usr/bin：</strong><br>系统用户使用的应用程序。</li>\n<li><strong>/usr/sbin：</strong><br>超级用户使用的比较高级的管理程序和系统守护程序。</li>\n<li><strong>/usr/src：</strong><br>内核源代码默认的放置目录。</li>\n<li><strong>/var</strong>：<br>var 是 variable(变量) 的缩写，这个目录中存放着在不断扩充着的东西，我们习惯将那些经常被修改的目录放在这个目录下。包括各种日志文件。</li>\n<li><strong>/run</strong>：<br>是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。如果你的系统上有 /var/run 目录，应该让它指向 run。</li>\n</ul>\n<h2 id=\"关机\"><a href=\"#关机\" class=\"headerlink\" title=\"关机\"></a>关机</h2><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sync 将数据由内存同步到硬盘中。</span><br><span class=\"line\">shutdown 关机指令，你可以man shutdown 来看一下帮助文档。例如你可以运行如下命令关机：</span><br><span class=\"line\">shutdown –h 10 ‘This server will shutdown after 10 mins’ 这个命令告诉大家，计算机将在10分钟后关机，并且会显示在登陆用户的当前屏幕中。</span><br><span class=\"line\">shutdown –h now 立马关机</span><br><span class=\"line\">shutdown –h 20:25 系统会在今天20:25关机</span><br><span class=\"line\">shutdown –h +10 十分钟后关机</span><br><span class=\"line\">shutdown –r now 系统立马重启</span><br><span class=\"line\">shutdown –r +10 系统十分钟后重启</span><br><span class=\"line\">reboot 就是重启，等同于 shutdown –r now</span><br><span class=\"line\">halt 关闭系统，等同于shutdown –h now 和 poweroff</span><br><span class=\"line\">关机 init 0 </span><br><span class=\"line\">重启 init 1</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"帮助命令\"><a href=\"#帮助命令\" class=\"headerlink\" title=\"帮助命令\"></a>帮助命令</h2><ol>\n<li>man<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">man</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Q 退出</span></span><br><span class=\"line\">man ls</span><br><span class=\"line\">man man</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">数字代表章数，一共9章</span></span><br><span class=\"line\">man 1 ls</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">不知道第几章</span></span><br><span class=\"line\">man -a passwd</span><br></pre></td></tr></table></figure></li>\n<li>help<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">shell自动解释的命令称为内部命令，其他为外部命令</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">内部命令</span></span><br><span class=\"line\">help cd</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">外部命令</span></span><br><span class=\"line\">ls --help</span><br></pre></td></tr></table></figure></li>\n<li>info<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">info ls</span><br></pre></td></tr></table></figure></li>\n</ol>\n<h2 id=\"文件管理\"><a href=\"#文件管理\" class=\"headerlink\" title=\"文件管理\"></a>文件管理</h2><h5 id=\"列出目录\"><a href=\"#列出目录\" class=\"headerlink\" title=\"### 列出目录\"></a>### 列出目录</h5><p><code>ls</code>命令</p>\n<ul>\n<li>-l 长格式显示文件</li>\n<li>-a 显示隐藏文件</li>\n<li>-r 逆序显示</li>\n<li>-t 按时间顺序显示</li>\n<li>-R 递归显示</li>\n<li>-h 显示文件大小</li>\n</ul>\n<blockquote>\n<p>-rw——- 共10位 第一位 文件类型 后9位 文件权限<br>第一位 普通文件是- 目录d</p>\n</blockquote>\n<h3 id=\"更换目录\"><a href=\"#更换目录\" class=\"headerlink\" title=\"更换目录\"></a>更换目录</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">查看当前用户空间</span></span><br><span class=\"line\">pwd</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">切换目录空间</span></span><br><span class=\"line\">cd</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">根目录</span></span><br><span class=\"line\">cd / </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">当前目录</span></span><br><span class=\"line\">cd . </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">上一级目录</span></span><br><span class=\"line\">cd ..</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">返回上一次历史目录</span></span><br><span class=\"line\">cd -</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">清除历史</span></span><br><span class=\"line\">clear</span><br><span class=\"line\">control + l</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"目录和文件的基本操作\"><a href=\"#目录和文件的基本操作\" class=\"headerlink\" title=\"目录和文件的基本操作\"></a>目录和文件的基本操作</h3><p>对文件的各种操作中，可以使用通配符。</p>\n<h5 id=\"通配符介绍\"><a href=\"#通配符介绍\" class=\"headerlink\" title=\"通配符介绍\"></a>通配符介绍</h5><ul>\n<li>*多个字符</li>\n<li>?单个字符</li>\n</ul>\n<h3 id=\"新建目录\"><a href=\"#新建目录\" class=\"headerlink\" title=\"新建目录\"></a>新建目录</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">mkdir</span> 可以同时创建多个目录,如果目录存在,会报错</span></span><br><span class=\"line\">mkdir a b c</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">依次创建子目录</span></span><br><span class=\"line\">mkdir -p a/c/c</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"删除目录\"><a href=\"#删除目录\" class=\"headerlink\" title=\"删除目录\"></a>删除目录</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">rmdir</span> 只能删除空白目录</span></span><br><span class=\"line\">rmdir a</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">递归删除, 需要确认</span></span><br><span class=\"line\">rm -r a</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">递归删除, 不需要确认</span></span><br><span class=\"line\">rm -rf a</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">rm</span> -rf / a 需注意空格, 不小心会删除根目录</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"复制\"><a href=\"#复制\" class=\"headerlink\" title=\"复制\"></a>复制</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">cp</span> 源文件名 目标文件名</span></span><br><span class=\"line\">cp test test1</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">复制目录 <span class=\"built_in\">cp</span> -r</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">cp</span> -v 显示复制的过程</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">cp</span> -p 保留原有文件时间</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">cp</span> -a 保留权限 属主 时间</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"移动\"><a href=\"#移动\" class=\"headerlink\" title=\"移动\"></a>移动</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">mv</span> 移动或改名</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">mv</span> 源文件 目标文件</span> </span><br><span class=\"line\">mv /dir /tmp # 移动目录</span><br><span class=\"line\">mv file* /</span><br><span class=\"line\">mv file? /</span><br><span class=\"line\">cp file* /</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"文本查看\"><a href=\"#文本查看\" class=\"headerlink\" title=\"文本查看\"></a>文本查看</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">新建文件</span></span><br><span class=\"line\">touch file</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\"><span class=\"built_in\">wc</span> 统计文件内容信息</span></span><br><span class=\"line\">wc -l file  # 查看文件多少行</span><br><span class=\"line\">cat file</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">不加数字，默认10行</span></span><br><span class=\"line\">head -5 file</span><br><span class=\"line\">tail -5 file</span><br><span class=\"line\">less</span><br><span class=\"line\">more</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"打包和压缩\"><a href=\"#打包和压缩\" class=\"headerlink\" title=\"打包和压缩\"></a>打包和压缩</h3><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">c(包) z(压缩) f(文件)</span></span><br><span class=\"line\">tar czf newfile sourcefile</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">解压缩 -C 指定解压目录</span></span><br><span class=\"line\">tar zxf -C /tmp </span><br></pre></td></tr></table></figure>\n\n<h2 id=\"文本编辑\"><a href=\"#文本编辑\" class=\"headerlink\" title=\"文本编辑\"></a>文本编辑</h2><p>vim四种模式</p>\n<ul>\n<li>正常模式<br>按<code>i</code>进入插入模式</li>\n<li>插入模式</li>\n<li>命令模式</li>\n<li>可视模式</li>\n</ul>\n"},{"uuid":"bbaf4811-c0ab-11ec-92a1-7557b2313227","title":"linux 文件属性","abbrlink":"1df584b2","_content":"\n# Linux 文件基本属性\n\nLinux 系统是一种典型的多用户系统，不同的用户处于不同的地位，拥有不同的权限。\n\n为了保护系统的安全性，Linux 系统对不同的用户访问同一文件（包括目录文件）的权限做了不同的规定。\n\n在 Linux 中我们通常使用以下两个命令来修改文件或目录的所属用户与权限：\n\n- chown (change owner) ： 修改所属用户与组。\n- chmod (change mode) ： 修改用户的权限。\n\n下图中通过 chown 来授权用户，通过 chmod 为用户设置可以开门的权限。\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191606497.png)\n\n在 Linux 中我们可以使用 **ll** 或者 **ls –l** 命令来显示一个文件的属性以及文件所属的用户和组，如：\n\n```\n[root@www /]# ls -l\ntotal 64\ndr-xr-xr-x   2 root root 4096 Dec 14  2012 bin\ndr-xr-xr-x   4 root root 4096 Apr 19  2012 boot\n……\n```\n\n实例中，**bin** 文件的第一个属性用 **d** 表示。**d** 在 Linux 中代表该文件是一个目录文件。\n\n在 Linux 中第一个字符代表这个文件是目录、文件或链接文件等等。\n\n- 当为 **d** 则是目录\n- 当为 **-** 则是文件；\n- 若是 **l** 则表示为链接文档(link file)；\n- 若是 **b** 则表示为装置文件里面的可供储存的接口设备(可随机存取装置)；\n- 若是 **c** 则表示为装置文件里面的串行端口设备，例如键盘、鼠标(一次性读取装置)。\n\n接下来的字符中，以三个为一组，且均为 **rwx** 的三个参数的组合。其中， **r** 代表可读(read)、 **w** 代表可写(write)、 **x** 代表可执行(execute)。 要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号 **-** 而已。\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191606860.jpg)\n\n每个文件的属性由左边第一部分的 10 个字符来确定（如下图）。\n\n![363003_1227493859FdXT](https://raw.githubusercontent.com/xzyup/image/master/202203191606432.png)\n\n从左至右用 **0-9** 这些数字来表示。\n\n第 **0** 位确定文件类型，第 **1-3** 位确定属主（该文件的所有者）拥有该文件的权限。\n\n第4-6位确定属组（所有者的同组用户）拥有该文件的权限，第7-9位确定其他用户拥有该文件的权限。\n\n\n\n其中，第 **1、4、7** 位表示读权限，如果用 **r** 字符表示，则有读权限，如果用 **-** 字符表示，则没有读权限；\n\n第 **2、5、8** 位表示写权限，如果用 **w** 字符表示，则有写权限，如果用 **-** 字符表示没有写权限；第 **3、6、9** 位表示可执行权限，如果用 **x** 字符表示，则有执行权限，如果用 **-** 字符表示，则没有执行权限。\n\n------\n\n## Linux文件属主和属组\n\n```\n[root@www /]# ls -l\ntotal 64\ndrwxr-xr-x 2 root  root  4096 Feb 15 14:46 cron\ndrwxr-xr-x 3 mysql mysql 4096 Apr 21  2014 mysql\n……\n```\n\n对于文件来说，它都有一个特定的所有者，也就是对该文件具有所有权的用户。\n\n同时，在Linux系统中，用户是按组分类的，一个用户属于一个或多个组。\n\n文件所有者以外的用户又可以分为文件所有者的同组用户和其他用户。\n\n因此，Linux系统按文件所有者、文件所有者同组用户和其他用户来规定了不同的文件访问权限。\n\n在以上实例中，mysql 文件是一个目录文件，属主和属组都为 mysql，属主有可读、可写、可执行的权限；与属主同组的其他用户有可读和可执行的权限；其他用户也有可读和可执行的权限。\n\n对于 root 用户来说，一般情况下，文件的权限对其不起作用。\n\n------\n\n## 更改文件属性\n\n### 1、chgrp：更改文件属组\n\n语法：\n\n```\nchgrp [-R] 属组名 文件名\n```\n\n参数选项\n\n- -R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改。\n\n### 2、chown：更改文件属主，也可以同时更改文件属组\n\n语法：\n\n```\nchown [–R] 属主名 文件名\nchown [-R] 属主名：属组名 文件名\n```\n\n进入 /root 目录（~）将install.log的拥有者改为bin这个账号：\n\n```\n[root@www ~] cd ~\n[root@www ~]# chown bin install.log\n[root@www ~]# ls -l\n-rw-r--r--  1 bin  users 68495 Jun 25 08:53 install.log\n```\n\n将install.log的拥有者与群组改回为root：\n\n```\n[root@www ~]# chown root:root install.log\n[root@www ~]# ls -l\n-rw-r--r--  1 root root 68495 Jun 25 08:53 install.log\n```\n\n### 3、chmod：更改文件9个属性\n\nLinux文件属性有两种设置方法，一种是数字，一种是符号。\n\nLinux 文件的基本权限就有九个，分别是 **owner/group/others(拥有者/组/其他)** 三种身份各有自己的 **read/write/execute** 权限。\n\n先复习一下刚刚上面提到的数据：文件的权限字符为： **-rwxrwxrwx** ， 这九个权限是三个三个一组的！其中，我们可以使用数字来代表各个权限，各权限的分数对照表如下：\n\n- r:4\n- w:2\n- x:1\n\n每种身份(owner/group/others)各自的三个权限(r/w/x)分数是需要累加的，例如当权限为： **-rwxrwx---** 分数则是：\n\n- owner = rwx = 4+2+1 = 7\n- group = rwx = 4+2+1 = 7\n- others= --- = 0+0+0 = 0\n\n所以等一下我们设定权限的变更时，该文件的权限数字就是 **770**。变更权限的指令 chmod 的语法是这样的：\n\n```\n chmod [-R] xyz 文件或目录\n```\n\n选项与参数：\n\n- xyz : 就是刚刚提到的数字类型的权限属性，为 rwx 属性数值的相加。\n- -R : 进行递归(recursive)的持续变更，亦即连同次目录下的所有文件都会变更\n\n举例来说，如果要将 .bashrc 这个文件所有的权限都设定启用，那么命令如下：\n\n```\n[root@www ~]# ls -al .bashrc\n-rw-r--r--  1 root root 395 Jul  4 11:45 .bashrc\n[root@www ~]# chmod 777 .bashrc\n[root@www ~]# ls -al .bashrc\n-rwxrwxrwx  1 root root 395 Jul  4 11:45 .bashrc\n```\n\n那如果要将权限变成 *-rwxr-xr--* 呢？那么权限的分数就成为 [4+2+1][4+0+1][4+0+0]=754。\n\n### 符号类型改变文件权限\n\n还有一个改变权限的方法，从之前的介绍中我们可以发现，基本上就九个权限分别是：\n\n- user：用户\n- group：组\n- others：其他\n\n那么我们就可以使用 **u, g, o** 来代表三种身份的权限。\n\n此外， **a** 则代表 **all**，即全部的身份。读写的权限可以写成 **r, w, x**，也就是可以使用下表的方式来看：\n\n\n\n| chmod | u g o a | +(加入) -(除去) =(设定) | r w x | 文件或目录 |\n| ----- | ------- | ----------------------- | ----- | ---------- |\n|       |         |                         |       |            |\n\n如果我们需要将文件权限设置为 **-rwxr-xr--** ，可以使用 **chmod u=rwx,g=rx,o=r 文件名** 来设定:\n\n```\n#  touch test1    // 创建 test1 文件\n# ls -al test1    // 查看 test1 默认权限\n-rw-r--r-- 1 root root 0 Nov 15 10:32 test1\n# chmod u=rwx,g=rx,o=r  test1    // 修改 test1 权限\n# ls -al test1\n-rwxr-xr-- 1 root root 0 Nov 15 10:32 test1\n```\n\n而如果是要将权限去掉而不改变其他已存在的权限呢？例如要拿掉全部人的可执行权限，则：\n\n```\n#  chmod  a-x test1\n# ls -al test1\n-rw-r--r-- 1 root root 0 Nov 15 10:32 test1\n```\n","source":"_posts/linux/文件基本属性.md","raw":"---\nuuid: bbaf4811-c0ab-11ec-92a1-7557b2313227\ntitle: linux 文件属性\ncategories: Linux\ntags:\n  - linux\nabbrlink: 1df584b2\n---\n\n# Linux 文件基本属性\n\nLinux 系统是一种典型的多用户系统，不同的用户处于不同的地位，拥有不同的权限。\n\n为了保护系统的安全性，Linux 系统对不同的用户访问同一文件（包括目录文件）的权限做了不同的规定。\n\n在 Linux 中我们通常使用以下两个命令来修改文件或目录的所属用户与权限：\n\n- chown (change owner) ： 修改所属用户与组。\n- chmod (change mode) ： 修改用户的权限。\n\n下图中通过 chown 来授权用户，通过 chmod 为用户设置可以开门的权限。\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191606497.png)\n\n在 Linux 中我们可以使用 **ll** 或者 **ls –l** 命令来显示一个文件的属性以及文件所属的用户和组，如：\n\n```\n[root@www /]# ls -l\ntotal 64\ndr-xr-xr-x   2 root root 4096 Dec 14  2012 bin\ndr-xr-xr-x   4 root root 4096 Apr 19  2012 boot\n……\n```\n\n实例中，**bin** 文件的第一个属性用 **d** 表示。**d** 在 Linux 中代表该文件是一个目录文件。\n\n在 Linux 中第一个字符代表这个文件是目录、文件或链接文件等等。\n\n- 当为 **d** 则是目录\n- 当为 **-** 则是文件；\n- 若是 **l** 则表示为链接文档(link file)；\n- 若是 **b** 则表示为装置文件里面的可供储存的接口设备(可随机存取装置)；\n- 若是 **c** 则表示为装置文件里面的串行端口设备，例如键盘、鼠标(一次性读取装置)。\n\n接下来的字符中，以三个为一组，且均为 **rwx** 的三个参数的组合。其中， **r** 代表可读(read)、 **w** 代表可写(write)、 **x** 代表可执行(execute)。 要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号 **-** 而已。\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191606860.jpg)\n\n每个文件的属性由左边第一部分的 10 个字符来确定（如下图）。\n\n![363003_1227493859FdXT](https://raw.githubusercontent.com/xzyup/image/master/202203191606432.png)\n\n从左至右用 **0-9** 这些数字来表示。\n\n第 **0** 位确定文件类型，第 **1-3** 位确定属主（该文件的所有者）拥有该文件的权限。\n\n第4-6位确定属组（所有者的同组用户）拥有该文件的权限，第7-9位确定其他用户拥有该文件的权限。\n\n\n\n其中，第 **1、4、7** 位表示读权限，如果用 **r** 字符表示，则有读权限，如果用 **-** 字符表示，则没有读权限；\n\n第 **2、5、8** 位表示写权限，如果用 **w** 字符表示，则有写权限，如果用 **-** 字符表示没有写权限；第 **3、6、9** 位表示可执行权限，如果用 **x** 字符表示，则有执行权限，如果用 **-** 字符表示，则没有执行权限。\n\n------\n\n## Linux文件属主和属组\n\n```\n[root@www /]# ls -l\ntotal 64\ndrwxr-xr-x 2 root  root  4096 Feb 15 14:46 cron\ndrwxr-xr-x 3 mysql mysql 4096 Apr 21  2014 mysql\n……\n```\n\n对于文件来说，它都有一个特定的所有者，也就是对该文件具有所有权的用户。\n\n同时，在Linux系统中，用户是按组分类的，一个用户属于一个或多个组。\n\n文件所有者以外的用户又可以分为文件所有者的同组用户和其他用户。\n\n因此，Linux系统按文件所有者、文件所有者同组用户和其他用户来规定了不同的文件访问权限。\n\n在以上实例中，mysql 文件是一个目录文件，属主和属组都为 mysql，属主有可读、可写、可执行的权限；与属主同组的其他用户有可读和可执行的权限；其他用户也有可读和可执行的权限。\n\n对于 root 用户来说，一般情况下，文件的权限对其不起作用。\n\n------\n\n## 更改文件属性\n\n### 1、chgrp：更改文件属组\n\n语法：\n\n```\nchgrp [-R] 属组名 文件名\n```\n\n参数选项\n\n- -R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改。\n\n### 2、chown：更改文件属主，也可以同时更改文件属组\n\n语法：\n\n```\nchown [–R] 属主名 文件名\nchown [-R] 属主名：属组名 文件名\n```\n\n进入 /root 目录（~）将install.log的拥有者改为bin这个账号：\n\n```\n[root@www ~] cd ~\n[root@www ~]# chown bin install.log\n[root@www ~]# ls -l\n-rw-r--r--  1 bin  users 68495 Jun 25 08:53 install.log\n```\n\n将install.log的拥有者与群组改回为root：\n\n```\n[root@www ~]# chown root:root install.log\n[root@www ~]# ls -l\n-rw-r--r--  1 root root 68495 Jun 25 08:53 install.log\n```\n\n### 3、chmod：更改文件9个属性\n\nLinux文件属性有两种设置方法，一种是数字，一种是符号。\n\nLinux 文件的基本权限就有九个，分别是 **owner/group/others(拥有者/组/其他)** 三种身份各有自己的 **read/write/execute** 权限。\n\n先复习一下刚刚上面提到的数据：文件的权限字符为： **-rwxrwxrwx** ， 这九个权限是三个三个一组的！其中，我们可以使用数字来代表各个权限，各权限的分数对照表如下：\n\n- r:4\n- w:2\n- x:1\n\n每种身份(owner/group/others)各自的三个权限(r/w/x)分数是需要累加的，例如当权限为： **-rwxrwx---** 分数则是：\n\n- owner = rwx = 4+2+1 = 7\n- group = rwx = 4+2+1 = 7\n- others= --- = 0+0+0 = 0\n\n所以等一下我们设定权限的变更时，该文件的权限数字就是 **770**。变更权限的指令 chmod 的语法是这样的：\n\n```\n chmod [-R] xyz 文件或目录\n```\n\n选项与参数：\n\n- xyz : 就是刚刚提到的数字类型的权限属性，为 rwx 属性数值的相加。\n- -R : 进行递归(recursive)的持续变更，亦即连同次目录下的所有文件都会变更\n\n举例来说，如果要将 .bashrc 这个文件所有的权限都设定启用，那么命令如下：\n\n```\n[root@www ~]# ls -al .bashrc\n-rw-r--r--  1 root root 395 Jul  4 11:45 .bashrc\n[root@www ~]# chmod 777 .bashrc\n[root@www ~]# ls -al .bashrc\n-rwxrwxrwx  1 root root 395 Jul  4 11:45 .bashrc\n```\n\n那如果要将权限变成 *-rwxr-xr--* 呢？那么权限的分数就成为 [4+2+1][4+0+1][4+0+0]=754。\n\n### 符号类型改变文件权限\n\n还有一个改变权限的方法，从之前的介绍中我们可以发现，基本上就九个权限分别是：\n\n- user：用户\n- group：组\n- others：其他\n\n那么我们就可以使用 **u, g, o** 来代表三种身份的权限。\n\n此外， **a** 则代表 **all**，即全部的身份。读写的权限可以写成 **r, w, x**，也就是可以使用下表的方式来看：\n\n\n\n| chmod | u g o a | +(加入) -(除去) =(设定) | r w x | 文件或目录 |\n| ----- | ------- | ----------------------- | ----- | ---------- |\n|       |         |                         |       |            |\n\n如果我们需要将文件权限设置为 **-rwxr-xr--** ，可以使用 **chmod u=rwx,g=rx,o=r 文件名** 来设定:\n\n```\n#  touch test1    // 创建 test1 文件\n# ls -al test1    // 查看 test1 默认权限\n-rw-r--r-- 1 root root 0 Nov 15 10:32 test1\n# chmod u=rwx,g=rx,o=r  test1    // 修改 test1 权限\n# ls -al test1\n-rwxr-xr-- 1 root root 0 Nov 15 10:32 test1\n```\n\n而如果是要将权限去掉而不改变其他已存在的权限呢？例如要拿掉全部人的可执行权限，则：\n\n```\n#  chmod  a-x test1\n# ls -al test1\n-rw-r--r-- 1 root root 0 Nov 15 10:32 test1\n```\n","slug":"linux/文件基本属性","published":1,"date":"2022-04-20T12:41:20.891Z","updated":"2022-05-04T03:20:15.085Z","_id":"cl2qzfti4004213nohmckajc7","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Linux-文件基本属性\"><a href=\"#Linux-文件基本属性\" class=\"headerlink\" title=\"Linux 文件基本属性\"></a>Linux 文件基本属性</h1><p>Linux 系统是一种典型的多用户系统，不同的用户处于不同的地位，拥有不同的权限。</p>\n<p>为了保护系统的安全性，Linux 系统对不同的用户访问同一文件（包括目录文件）的权限做了不同的规定。</p>\n<p>在 Linux 中我们通常使用以下两个命令来修改文件或目录的所属用户与权限：</p>\n<ul>\n<li>chown (change owner) ： 修改所属用户与组。</li>\n<li>chmod (change mode) ： 修改用户的权限。</li>\n</ul>\n<p>下图中通过 chown 来授权用户，通过 chmod 为用户设置可以开门的权限。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191606497.png\" alt=\"img\"></p>\n<p>在 Linux 中我们可以使用 <strong>ll</strong> 或者 <strong>ls –l</strong> 命令来显示一个文件的属性以及文件所属的用户和组，如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@www /]# ls -l</span><br><span class=\"line\">total 64</span><br><span class=\"line\">dr-xr-xr-x   2 root root 4096 Dec 14  2012 bin</span><br><span class=\"line\">dr-xr-xr-x   4 root root 4096 Apr 19  2012 boot</span><br><span class=\"line\">……</span><br></pre></td></tr></table></figure>\n\n<p>实例中，<strong>bin</strong> 文件的第一个属性用 <strong>d</strong> 表示。<strong>d</strong> 在 Linux 中代表该文件是一个目录文件。</p>\n<p>在 Linux 中第一个字符代表这个文件是目录、文件或链接文件等等。</p>\n<ul>\n<li>当为 <strong>d</strong> 则是目录</li>\n<li>当为 <strong>-</strong> 则是文件；</li>\n<li>若是 <strong>l</strong> 则表示为链接文档(link file)；</li>\n<li>若是 <strong>b</strong> 则表示为装置文件里面的可供储存的接口设备(可随机存取装置)；</li>\n<li>若是 <strong>c</strong> 则表示为装置文件里面的串行端口设备，例如键盘、鼠标(一次性读取装置)。</li>\n</ul>\n<p>接下来的字符中，以三个为一组，且均为 <strong>rwx</strong> 的三个参数的组合。其中， <strong>r</strong> 代表可读(read)、 <strong>w</strong> 代表可写(write)、 <strong>x</strong> 代表可执行(execute)。 要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号 <strong>-</strong> 而已。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191606860.jpg\" alt=\"img\"></p>\n<p>每个文件的属性由左边第一部分的 10 个字符来确定（如下图）。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191606432.png\" alt=\"363003_1227493859FdXT\"></p>\n<p>从左至右用 <strong>0-9</strong> 这些数字来表示。</p>\n<p>第 <strong>0</strong> 位确定文件类型，第 <strong>1-3</strong> 位确定属主（该文件的所有者）拥有该文件的权限。</p>\n<p>第4-6位确定属组（所有者的同组用户）拥有该文件的权限，第7-9位确定其他用户拥有该文件的权限。</p>\n<p>其中，第 <strong>1、4、7</strong> 位表示读权限，如果用 <strong>r</strong> 字符表示，则有读权限，如果用 <strong>-</strong> 字符表示，则没有读权限；</p>\n<p>第 <strong>2、5、8</strong> 位表示写权限，如果用 <strong>w</strong> 字符表示，则有写权限，如果用 <strong>-</strong> 字符表示没有写权限；第 <strong>3、6、9</strong> 位表示可执行权限，如果用 <strong>x</strong> 字符表示，则有执行权限，如果用 <strong>-</strong> 字符表示，则没有执行权限。</p>\n<hr>\n<h2 id=\"Linux文件属主和属组\"><a href=\"#Linux文件属主和属组\" class=\"headerlink\" title=\"Linux文件属主和属组\"></a>Linux文件属主和属组</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@www /]# ls -l</span><br><span class=\"line\">total 64</span><br><span class=\"line\">drwxr-xr-x 2 root  root  4096 Feb 15 14:46 cron</span><br><span class=\"line\">drwxr-xr-x 3 mysql mysql 4096 Apr 21  2014 mysql</span><br><span class=\"line\">……</span><br></pre></td></tr></table></figure>\n\n<p>对于文件来说，它都有一个特定的所有者，也就是对该文件具有所有权的用户。</p>\n<p>同时，在Linux系统中，用户是按组分类的，一个用户属于一个或多个组。</p>\n<p>文件所有者以外的用户又可以分为文件所有者的同组用户和其他用户。</p>\n<p>因此，Linux系统按文件所有者、文件所有者同组用户和其他用户来规定了不同的文件访问权限。</p>\n<p>在以上实例中，mysql 文件是一个目录文件，属主和属组都为 mysql，属主有可读、可写、可执行的权限；与属主同组的其他用户有可读和可执行的权限；其他用户也有可读和可执行的权限。</p>\n<p>对于 root 用户来说，一般情况下，文件的权限对其不起作用。</p>\n<hr>\n<h2 id=\"更改文件属性\"><a href=\"#更改文件属性\" class=\"headerlink\" title=\"更改文件属性\"></a>更改文件属性</h2><h3 id=\"1、chgrp：更改文件属组\"><a href=\"#1、chgrp：更改文件属组\" class=\"headerlink\" title=\"1、chgrp：更改文件属组\"></a>1、chgrp：更改文件属组</h3><p>语法：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chgrp [-R] 属组名 文件名</span><br></pre></td></tr></table></figure>\n\n<p>参数选项</p>\n<ul>\n<li>-R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改。</li>\n</ul>\n<h3 id=\"2、chown：更改文件属主，也可以同时更改文件属组\"><a href=\"#2、chown：更改文件属主，也可以同时更改文件属组\" class=\"headerlink\" title=\"2、chown：更改文件属主，也可以同时更改文件属组\"></a>2、chown：更改文件属主，也可以同时更改文件属组</h3><p>语法：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown [–R] 属主名 文件名</span><br><span class=\"line\">chown [-R] 属主名：属组名 文件名</span><br></pre></td></tr></table></figure>\n\n<p>进入 /root 目录（~）将install.log的拥有者改为bin这个账号：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@www ~] cd ~</span><br><span class=\"line\">[root@www ~]# chown bin install.log</span><br><span class=\"line\">[root@www ~]# ls -l</span><br><span class=\"line\">-rw-r--r--  1 bin  users 68495 Jun 25 08:53 install.log</span><br></pre></td></tr></table></figure>\n\n<p>将install.log的拥有者与群组改回为root：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@www ~]# chown root:root install.log</span><br><span class=\"line\">[root@www ~]# ls -l</span><br><span class=\"line\">-rw-r--r--  1 root root 68495 Jun 25 08:53 install.log</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、chmod：更改文件9个属性\"><a href=\"#3、chmod：更改文件9个属性\" class=\"headerlink\" title=\"3、chmod：更改文件9个属性\"></a>3、chmod：更改文件9个属性</h3><p>Linux文件属性有两种设置方法，一种是数字，一种是符号。</p>\n<p>Linux 文件的基本权限就有九个，分别是 <strong>owner/group/others(拥有者/组/其他)</strong> 三种身份各有自己的 <strong>read/write/execute</strong> 权限。</p>\n<p>先复习一下刚刚上面提到的数据：文件的权限字符为： <strong>-rwxrwxrwx</strong> ， 这九个权限是三个三个一组的！其中，我们可以使用数字来代表各个权限，各权限的分数对照表如下：</p>\n<ul>\n<li>r:4</li>\n<li>w:2</li>\n<li>x:1</li>\n</ul>\n<p>每种身份(owner/group/others)各自的三个权限(r/w/x)分数是需要累加的，例如当权限为： <strong>-rwxrwx—</strong> 分数则是：</p>\n<ul>\n<li>owner = rwx = 4+2+1 = 7</li>\n<li>group = rwx = 4+2+1 = 7</li>\n<li>others= — = 0+0+0 = 0</li>\n</ul>\n<p>所以等一下我们设定权限的变更时，该文件的权限数字就是 <strong>770</strong>。变更权限的指令 chmod 的语法是这样的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod [-R] xyz 文件或目录</span><br></pre></td></tr></table></figure>\n\n<p>选项与参数：</p>\n<ul>\n<li>xyz : 就是刚刚提到的数字类型的权限属性，为 rwx 属性数值的相加。</li>\n<li>-R : 进行递归(recursive)的持续变更，亦即连同次目录下的所有文件都会变更</li>\n</ul>\n<p>举例来说，如果要将 .bashrc 这个文件所有的权限都设定启用，那么命令如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@www ~]# ls -al .bashrc</span><br><span class=\"line\">-rw-r--r--  1 root root 395 Jul  4 11:45 .bashrc</span><br><span class=\"line\">[root@www ~]# chmod 777 .bashrc</span><br><span class=\"line\">[root@www ~]# ls -al .bashrc</span><br><span class=\"line\">-rwxrwxrwx  1 root root 395 Jul  4 11:45 .bashrc</span><br></pre></td></tr></table></figure>\n\n<p>那如果要将权限变成 <em>-rwxr-xr–</em> 呢？那么权限的分数就成为 [4+2+1][4+0+1][4+0+0]=754。</p>\n<h3 id=\"符号类型改变文件权限\"><a href=\"#符号类型改变文件权限\" class=\"headerlink\" title=\"符号类型改变文件权限\"></a>符号类型改变文件权限</h3><p>还有一个改变权限的方法，从之前的介绍中我们可以发现，基本上就九个权限分别是：</p>\n<ul>\n<li>user：用户</li>\n<li>group：组</li>\n<li>others：其他</li>\n</ul>\n<p>那么我们就可以使用 <strong>u, g, o</strong> 来代表三种身份的权限。</p>\n<p>此外， <strong>a</strong> 则代表 <strong>all</strong>，即全部的身份。读写的权限可以写成 <strong>r, w, x</strong>，也就是可以使用下表的方式来看：</p>\n<table>\n<thead>\n<tr>\n<th>chmod</th>\n<th>u g o a</th>\n<th>+(加入) -(除去) =(设定)</th>\n<th>r w x</th>\n<th>文件或目录</th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<p>如果我们需要将文件权限设置为 <strong>-rwxr-xr–</strong> ，可以使用 <strong>chmod u=rwx,g=rx,o=r 文件名</strong> 来设定:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#  touch test1    // 创建 test1 文件</span><br><span class=\"line\"># ls -al test1    // 查看 test1 默认权限</span><br><span class=\"line\">-rw-r--r-- 1 root root 0 Nov 15 10:32 test1</span><br><span class=\"line\"># chmod u=rwx,g=rx,o=r  test1    // 修改 test1 权限</span><br><span class=\"line\"># ls -al test1</span><br><span class=\"line\">-rwxr-xr-- 1 root root 0 Nov 15 10:32 test1</span><br></pre></td></tr></table></figure>\n\n<p>而如果是要将权限去掉而不改变其他已存在的权限呢？例如要拿掉全部人的可执行权限，则：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#  chmod  a-x test1</span><br><span class=\"line\"># ls -al test1</span><br><span class=\"line\">-rw-r--r-- 1 root root 0 Nov 15 10:32 test1</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Linux-文件基本属性\"><a href=\"#Linux-文件基本属性\" class=\"headerlink\" title=\"Linux 文件基本属性\"></a>Linux 文件基本属性</h1><p>Linux 系统是一种典型的多用户系统，不同的用户处于不同的地位，拥有不同的权限。</p>\n<p>为了保护系统的安全性，Linux 系统对不同的用户访问同一文件（包括目录文件）的权限做了不同的规定。</p>\n<p>在 Linux 中我们通常使用以下两个命令来修改文件或目录的所属用户与权限：</p>\n<ul>\n<li>chown (change owner) ： 修改所属用户与组。</li>\n<li>chmod (change mode) ： 修改用户的权限。</li>\n</ul>\n<p>下图中通过 chown 来授权用户，通过 chmod 为用户设置可以开门的权限。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191606497.png\" alt=\"img\"></p>\n<p>在 Linux 中我们可以使用 <strong>ll</strong> 或者 <strong>ls –l</strong> 命令来显示一个文件的属性以及文件所属的用户和组，如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@www /]# ls -l</span><br><span class=\"line\">total 64</span><br><span class=\"line\">dr-xr-xr-x   2 root root 4096 Dec 14  2012 bin</span><br><span class=\"line\">dr-xr-xr-x   4 root root 4096 Apr 19  2012 boot</span><br><span class=\"line\">……</span><br></pre></td></tr></table></figure>\n\n<p>实例中，<strong>bin</strong> 文件的第一个属性用 <strong>d</strong> 表示。<strong>d</strong> 在 Linux 中代表该文件是一个目录文件。</p>\n<p>在 Linux 中第一个字符代表这个文件是目录、文件或链接文件等等。</p>\n<ul>\n<li>当为 <strong>d</strong> 则是目录</li>\n<li>当为 <strong>-</strong> 则是文件；</li>\n<li>若是 <strong>l</strong> 则表示为链接文档(link file)；</li>\n<li>若是 <strong>b</strong> 则表示为装置文件里面的可供储存的接口设备(可随机存取装置)；</li>\n<li>若是 <strong>c</strong> 则表示为装置文件里面的串行端口设备，例如键盘、鼠标(一次性读取装置)。</li>\n</ul>\n<p>接下来的字符中，以三个为一组，且均为 <strong>rwx</strong> 的三个参数的组合。其中， <strong>r</strong> 代表可读(read)、 <strong>w</strong> 代表可写(write)、 <strong>x</strong> 代表可执行(execute)。 要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号 <strong>-</strong> 而已。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191606860.jpg\" alt=\"img\"></p>\n<p>每个文件的属性由左边第一部分的 10 个字符来确定（如下图）。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191606432.png\" alt=\"363003_1227493859FdXT\"></p>\n<p>从左至右用 <strong>0-9</strong> 这些数字来表示。</p>\n<p>第 <strong>0</strong> 位确定文件类型，第 <strong>1-3</strong> 位确定属主（该文件的所有者）拥有该文件的权限。</p>\n<p>第4-6位确定属组（所有者的同组用户）拥有该文件的权限，第7-9位确定其他用户拥有该文件的权限。</p>\n<p>其中，第 <strong>1、4、7</strong> 位表示读权限，如果用 <strong>r</strong> 字符表示，则有读权限，如果用 <strong>-</strong> 字符表示，则没有读权限；</p>\n<p>第 <strong>2、5、8</strong> 位表示写权限，如果用 <strong>w</strong> 字符表示，则有写权限，如果用 <strong>-</strong> 字符表示没有写权限；第 <strong>3、6、9</strong> 位表示可执行权限，如果用 <strong>x</strong> 字符表示，则有执行权限，如果用 <strong>-</strong> 字符表示，则没有执行权限。</p>\n<hr>\n<h2 id=\"Linux文件属主和属组\"><a href=\"#Linux文件属主和属组\" class=\"headerlink\" title=\"Linux文件属主和属组\"></a>Linux文件属主和属组</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@www /]# ls -l</span><br><span class=\"line\">total 64</span><br><span class=\"line\">drwxr-xr-x 2 root  root  4096 Feb 15 14:46 cron</span><br><span class=\"line\">drwxr-xr-x 3 mysql mysql 4096 Apr 21  2014 mysql</span><br><span class=\"line\">……</span><br></pre></td></tr></table></figure>\n\n<p>对于文件来说，它都有一个特定的所有者，也就是对该文件具有所有权的用户。</p>\n<p>同时，在Linux系统中，用户是按组分类的，一个用户属于一个或多个组。</p>\n<p>文件所有者以外的用户又可以分为文件所有者的同组用户和其他用户。</p>\n<p>因此，Linux系统按文件所有者、文件所有者同组用户和其他用户来规定了不同的文件访问权限。</p>\n<p>在以上实例中，mysql 文件是一个目录文件，属主和属组都为 mysql，属主有可读、可写、可执行的权限；与属主同组的其他用户有可读和可执行的权限；其他用户也有可读和可执行的权限。</p>\n<p>对于 root 用户来说，一般情况下，文件的权限对其不起作用。</p>\n<hr>\n<h2 id=\"更改文件属性\"><a href=\"#更改文件属性\" class=\"headerlink\" title=\"更改文件属性\"></a>更改文件属性</h2><h3 id=\"1、chgrp：更改文件属组\"><a href=\"#1、chgrp：更改文件属组\" class=\"headerlink\" title=\"1、chgrp：更改文件属组\"></a>1、chgrp：更改文件属组</h3><p>语法：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chgrp [-R] 属组名 文件名</span><br></pre></td></tr></table></figure>\n\n<p>参数选项</p>\n<ul>\n<li>-R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改。</li>\n</ul>\n<h3 id=\"2、chown：更改文件属主，也可以同时更改文件属组\"><a href=\"#2、chown：更改文件属主，也可以同时更改文件属组\" class=\"headerlink\" title=\"2、chown：更改文件属主，也可以同时更改文件属组\"></a>2、chown：更改文件属主，也可以同时更改文件属组</h3><p>语法：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown [–R] 属主名 文件名</span><br><span class=\"line\">chown [-R] 属主名：属组名 文件名</span><br></pre></td></tr></table></figure>\n\n<p>进入 /root 目录（~）将install.log的拥有者改为bin这个账号：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@www ~] cd ~</span><br><span class=\"line\">[root@www ~]# chown bin install.log</span><br><span class=\"line\">[root@www ~]# ls -l</span><br><span class=\"line\">-rw-r--r--  1 bin  users 68495 Jun 25 08:53 install.log</span><br></pre></td></tr></table></figure>\n\n<p>将install.log的拥有者与群组改回为root：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@www ~]# chown root:root install.log</span><br><span class=\"line\">[root@www ~]# ls -l</span><br><span class=\"line\">-rw-r--r--  1 root root 68495 Jun 25 08:53 install.log</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3、chmod：更改文件9个属性\"><a href=\"#3、chmod：更改文件9个属性\" class=\"headerlink\" title=\"3、chmod：更改文件9个属性\"></a>3、chmod：更改文件9个属性</h3><p>Linux文件属性有两种设置方法，一种是数字，一种是符号。</p>\n<p>Linux 文件的基本权限就有九个，分别是 <strong>owner/group/others(拥有者/组/其他)</strong> 三种身份各有自己的 <strong>read/write/execute</strong> 权限。</p>\n<p>先复习一下刚刚上面提到的数据：文件的权限字符为： <strong>-rwxrwxrwx</strong> ， 这九个权限是三个三个一组的！其中，我们可以使用数字来代表各个权限，各权限的分数对照表如下：</p>\n<ul>\n<li>r:4</li>\n<li>w:2</li>\n<li>x:1</li>\n</ul>\n<p>每种身份(owner/group/others)各自的三个权限(r/w/x)分数是需要累加的，例如当权限为： <strong>-rwxrwx—</strong> 分数则是：</p>\n<ul>\n<li>owner = rwx = 4+2+1 = 7</li>\n<li>group = rwx = 4+2+1 = 7</li>\n<li>others= — = 0+0+0 = 0</li>\n</ul>\n<p>所以等一下我们设定权限的变更时，该文件的权限数字就是 <strong>770</strong>。变更权限的指令 chmod 的语法是这样的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod [-R] xyz 文件或目录</span><br></pre></td></tr></table></figure>\n\n<p>选项与参数：</p>\n<ul>\n<li>xyz : 就是刚刚提到的数字类型的权限属性，为 rwx 属性数值的相加。</li>\n<li>-R : 进行递归(recursive)的持续变更，亦即连同次目录下的所有文件都会变更</li>\n</ul>\n<p>举例来说，如果要将 .bashrc 这个文件所有的权限都设定启用，那么命令如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@www ~]# ls -al .bashrc</span><br><span class=\"line\">-rw-r--r--  1 root root 395 Jul  4 11:45 .bashrc</span><br><span class=\"line\">[root@www ~]# chmod 777 .bashrc</span><br><span class=\"line\">[root@www ~]# ls -al .bashrc</span><br><span class=\"line\">-rwxrwxrwx  1 root root 395 Jul  4 11:45 .bashrc</span><br></pre></td></tr></table></figure>\n\n<p>那如果要将权限变成 <em>-rwxr-xr–</em> 呢？那么权限的分数就成为 [4+2+1][4+0+1][4+0+0]=754。</p>\n<h3 id=\"符号类型改变文件权限\"><a href=\"#符号类型改变文件权限\" class=\"headerlink\" title=\"符号类型改变文件权限\"></a>符号类型改变文件权限</h3><p>还有一个改变权限的方法，从之前的介绍中我们可以发现，基本上就九个权限分别是：</p>\n<ul>\n<li>user：用户</li>\n<li>group：组</li>\n<li>others：其他</li>\n</ul>\n<p>那么我们就可以使用 <strong>u, g, o</strong> 来代表三种身份的权限。</p>\n<p>此外， <strong>a</strong> 则代表 <strong>all</strong>，即全部的身份。读写的权限可以写成 <strong>r, w, x</strong>，也就是可以使用下表的方式来看：</p>\n<table>\n<thead>\n<tr>\n<th>chmod</th>\n<th>u g o a</th>\n<th>+(加入) -(除去) =(设定)</th>\n<th>r w x</th>\n<th>文件或目录</th>\n</tr>\n</thead>\n<tbody><tr>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody></table>\n<p>如果我们需要将文件权限设置为 <strong>-rwxr-xr–</strong> ，可以使用 <strong>chmod u=rwx,g=rx,o=r 文件名</strong> 来设定:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#  touch test1    // 创建 test1 文件</span><br><span class=\"line\"># ls -al test1    // 查看 test1 默认权限</span><br><span class=\"line\">-rw-r--r-- 1 root root 0 Nov 15 10:32 test1</span><br><span class=\"line\"># chmod u=rwx,g=rx,o=r  test1    // 修改 test1 权限</span><br><span class=\"line\"># ls -al test1</span><br><span class=\"line\">-rwxr-xr-- 1 root root 0 Nov 15 10:32 test1</span><br></pre></td></tr></table></figure>\n\n<p>而如果是要将权限去掉而不改变其他已存在的权限呢？例如要拿掉全部人的可执行权限，则：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#  chmod  a-x test1</span><br><span class=\"line\"># ls -al test1</span><br><span class=\"line\">-rw-r--r-- 1 root root 0 Nov 15 10:32 test1</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf4812-c0ab-11ec-92a1-7557b2313227","title":"什么是消息队列","abbrlink":"fd42e092","_content":"\n## 前言\n\n> 只有光头才能变强。\n>\n\n公司用到的很多技术，自己之前都没学过(**尬**)，于是只能慢慢补了。这次给大家写写我学习**消息队列**的笔记，希望对大家有帮助。\n\n## 一、什么是消息队列？\n\n消息队列不知道大家看到这个词的时候，会不会觉得它是一个比较**高端**的技术，反正我是觉得它好像是挺牛逼的。\n\n> 消息队列，一般我们会简称它为MQ(Message Queue)，嗯，就是很直白的简写。\n\n我们先不管消息(Message)这个词，来看看队列(Queue)。这一看，队列大家应该都熟悉吧。\n\n> 队列是一种**先进先出**的数据结构。\n\n在Java里边，已经实现了不少的队列了：\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191624238)\n\n那为什么还需要消息队列(MQ)这种**中间件**呢？？？其实这个问题，跟之前我学Redis的时候很像。Redis是一个以`key-value`形式存储的内存数据库，明明我们可以使用类似HashMap这种实现类就可以达到类似的效果了，那还为什么要Redis？《[Redis合集](https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247484609&idx=1&sn=4c053236699fde3c2db1241ab497487b&chksm=ebd745c0dca0ccd682e91938fc30fa947df1385b06d6ae9bb52514967b0736c66684db2f1ac9&token=177635168&lang=zh_CN&scene=21#wechat_redirect)》\n\n- 到这里，大家可以先猜猜为什么要用消息队列(MQ)这种**中间件**，下面会继续补充。\n\n消息队列可以简单理解为：**把要传输的数据放在队列中**。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191624890)\n\n科普：\n\n- 把数据放到消息队列叫做**生产者**\n- 从消息队列里边取数据叫做**消费者**\n\n## 二、为什么要用消息队列？\n\n为什么要用消息队列，也就是在问：用了消息队列有什么好处。我们看看以下的场景\n\n### 2.1 解耦\n\n现在我有一个系统A，系统A可以产生一个`userId`\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191624026)\n\n系统A可以产生一个UserId\n\n然后，现在有系统B和系统C都需要这个`userId`去做相关的操作\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625379)系统A给系统B和系统C传入userId这个值\n\n写成伪代码可能是这样的：\n\n```\npublic class SystemA {\n\n    // 系统B和系统C的依赖\n    SystemB systemB = new SystemB();\n    SystemC systemC = new SystemC();\n\n    // 系统A独有的数据userId\n    private String userId = \"Java3y\";\n\n    public void doSomething() {\n\n        // 系统B和系统C都需要拿着系统A的userId去操作其他的事\n        systemB.SystemBNeed2do(userId);\n        systemC.SystemCNeed2do(userId);\n\n    }\n}\n```\n\n结构图如下：\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625471)结构图\n\nok，一切平安无事度过了几个天。\n\n某一天，系统B的负责人告诉系统A的负责人，现在系统B的`SystemBNeed2do(String userId)`这个接口不再使用了，**让系统A别去调它了**。\n\n于是，系统A的负责人说\"好的，那我就不调用你了。\"，于是就**把调用系统B接口的代码给删掉了**：\n\n```\npublic void doSomething() {\n\n  // 系统A不再调用系统B的接口了\n  //systemB.SystemBNeed2do(userId);\n  systemC.SystemCNeed2do(userId);\n\n}\n```\n\n又过了几天，系统D的负责人接了个需求，也需要用到系统A的userId，于是就跑去跟系统A的负责人说：\"老哥，我要用到你的userId，你调一下我的接口吧\"\n\n于是系统A说：\"没问题的，这就搞\"\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625129)系统A需要调用系统D的接口\n\n然后，系统A的代码如下：\n\n```\npublic class SystemA {\n\n    // 已经不再需要系统B的依赖了\n    // SystemB systemB = new SystemB();\n\n    // 系统C和系统D的依赖\n    SystemC systemC = new SystemC();\n    SystemD systemD = new SystemD();\n\n    // 系统A独有的数据\n    private String userId = \"Java3y\";\n\n    public void doSomething() {\n\n\n        // 已经不再需要系统B的依赖了\n        //systemB.SystemBNeed2do(userId);\n\n        // 系统C和系统D都需要拿着系统A的userId去操作其他的事\n        systemC.SystemCNeed2do(userId);\n        systemD.SystemDNeed2do(userId);\n\n    }\n}\n```\n\n时间飞逝：\n\n- 又过了几天，系统E的负责人过来了，告诉系统A，需要userId。\n- 又过了几天，系统B的负责人过来了，告诉系统A，还是重新掉那个接口吧。\n- 又过了几天，系统F的负责人过来了，告诉系统A，需要userId。\n- ……\n\n于是系统A的负责人，每天都被这给骚扰着，改来改去，改来改去…….\n\n还有另外一个问题，调用系统C的时候，如果系统C挂了，系统A还得想办法处理。如果调用系统D时，由于网络延迟，请求超时了，那系统A是反馈`fail`还是重试？？\n\n最后，系统A的负责人，觉得**隔一段时间就改来改去**，没意思，于是就跑路了。\n\n然后，公司招来一个大佬，大佬经过几天熟悉，上来就说：**将系统A的userId写到消息队列中，这样系统A就不用经常改动了**。为什么呢？下面我们来一起看看：\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625609)系统A将userId写到消息队列中，系统C和系统D从消息队列中拿数据\n\n系统A将userId写到消息队列中，系统C和系统D从消息队列中拿数据。**这样有什么好处**？\n\n- 系统A**只负责**把数据写到队列中，谁想要或不想要这个数据(消息)，**系统A一点都不关心**。\n- 即便现在系统D不想要userId这个数据了，系统B又突然想要userId这个数据了，都跟系统A无关，系统A一点代码都不用改。\n- 系统D拿userId不再经过系统A，而是从消息队列里边拿。**系统D即便挂了或者请求超时，都跟系统A无关，只跟消息队列有关**。\n\n这样一来，系统A与系统B、C、D都**解耦**了。\n\n### 2.2 异步\n\n我们再来看看下面这种情况：系统A还是**直接调用**系统B、C、D\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625109)直接调接口\n\n代码如下：\n\n```\npublic class SystemA {\n\n    SystemB systemB = new SystemB();\n    SystemC systemC = new SystemC();\n    SystemD systemD = new SystemD();\n\n    // 系统A独有的数据\n    private String userId ;\n\n    public void doOrder() {\n\n        // 下订单\n          userId = this.order();\n        // 如果下单成功，则安排其他系统做一些事  \n        systemB.SystemBNeed2do(userId);\n        systemC.SystemCNeed2do(userId);\n        systemD.SystemDNeed2do(userId);\n\n    }\n}\n```\n\n**假设**系统A运算出userId具体的值需要50ms，调用系统B的接口需要300ms，调用系统C的接口需要300ms，调用系统D的接口需要300ms。那么这次请求就需要`50+300+300+300=950ms`\n\n并且我们得知，系统A做的是**主要的业务**，而系统B、C、D是**非主要**的业务。比如系统A处理的是**订单下单**，而系统B是订单下单成功了，那发送一条短信告诉具体的用户此订单已成功，而系统C和系统D也是处理一些小事而已。\n\n那么此时，为了**提高用户体验和吞吐量**，其实可以**异步地**调用系统B、C、D的接口。所以，我们可以弄成是这样的：\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625091)此时才用了100ms\n\n系统A执行完了以后，将userId写到消息队列中，然后就直接返回了(至于其他的操作，则异步处理)。\n\n- 本来整个请求需要用950ms(同步)\n- 现在将调用其他系统接口异步化，从请求到返回只需要100ms(异步)\n\n(例子可能举得不太好，但我觉得说明到点子上就行了，见谅。)\n\n### 2.3削峰/限流\n\n我们再来一个场景，现在我们每个月要搞一次大促，大促期间的并发可能会很高的，比如每秒3000个请求。假设我们现在有两台机器处理请求，并且每台机器只能每次处理1000个请求。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191626012)削峰的场景\n\n那多出来的1000个请求，可能就把我们**整个系统给搞崩了**…所以，有一种办法，我们可以写到消息队列中：\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191626505)写到消息队列中，系统从消息队列中拿到请求\n\n系统B和系统C**根据自己的能够处理的请求数去消息队列中拿数据**，这样即便有每秒有8000个请求，那只是把请求放在消息队列中，去拿消息队列的消息**由系统自己去控制**，这样就不会把整个系统给搞崩。\n\n## 三、使用消息队列有什么问题？\n\n经过我们上面的场景，我们已经可以发现，消息队列能做的事其实还是蛮多的。\n\n说到这里，我们先回到文章的开头，\"明明JDK已经有不少的队列实现了，我们还需要消息队列中间件呢？\"其实很简单，JDK实现的队列种类虽然有很多种，但是都是**简单的内存队列**。为什么我说JDK是简单的内存队列呢？下面我们来看看要实现消息队列(中间件)**可能要考虑什么问题**。\n\n## 3.1高可用\n\n无论是我们使用消息队列来做解耦、异步还是削峰，消息队列**肯定不能是单机**的。试着想一下，如果是单机的消息队列，万一这台机器挂了，那我们整个系统几乎就是不可用了。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191626549)万一单机的队列挂掉了\n\n所以，当我们项目中使用消息队列，都是得`集群/分布式`的。要做`集群/分布式`就必然希望该消息队列能够提供**现成**的支持，而不是自己写代码手动去实现。\n\n### 3.2 数据丢失问题\n\n我们将数据写到消息队列上，系统B和C还没来得及取消息队列的数据，就挂掉了。**如果没有做任何的措施，我们的数据就丢了**。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191626492)数据丢失问题\n\n学过Redis的都知道，Redis可以将数据持久化磁盘上，万一Redis挂了，还能从磁盘从将数据恢复过来。同样地，消息队列中的数据也需要存在别的地方，这样才尽可能减少数据的丢失。\n\n那存在哪呢？\n\n- 磁盘？\n- 数据库？\n- Redis？\n- 分布式文件系统？\n\n同步存储还是异步存储？\n\n### 3.3消费者怎么得到消息队列的数据？\n\n消费者怎么从消息队列里边得到数据？有两种办法：\n\n- 生产者将数据放到消息队列中，消息队列有数据了，**主动叫**消费者去拿(俗称push)\n- 消费者不断去**轮训**消息队列，看看有没有新的数据，如果有就消费(俗称pull)\n\n### 3.4其他\n\n除了这些，我们在**使用的时候**还得考虑各种的问题：\n\n- 消息重复消费了怎么办啊？\n- 我想保证消息是**绝对**有顺序的怎么做？\n- ……..\n\n虽然消息队列给我们带来了那么多的好处，但同时我们发现引入消息队列也会**提高系统的复杂性**。市面上现在已经有不少消息队列轮子了，每种消息队列都有自己的特点，**选取哪种MQ还得好好斟酌**。\n\n## 最后\n\n本文主要讲解了什么是消息队列，消息队列可以为我们带来什么好处，以及一个消息队列可能会涉及到哪些问题。希望给大家带来一定的帮助。\n\n参考资料：\n- Kafka简明教程\n  \n  > https://zhuanlan.zhihu.com/p/37405836\n- 消息队列使用的四种场景介绍，有图有解析，一看就懂\n  \n  > https://zhuanlan.zhihu.com/p/55712984\n- 消息队列设计精要\n  \n  > https://zhuanlan.zhihu.com/p/21479556\n- 消息队列的使用场景是怎样的\n  \n  > https://www.zhihu.com/question/34243607\n","source":"_posts/mq/什么是消息队列.md","raw":"---\nuuid: bbaf4812-c0ab-11ec-92a1-7557b2313227\ntitle: 什么是消息队列\ncategories: MiddleWare\ntags:\n  - MQ\nabbrlink: fd42e092\n---\n\n## 前言\n\n> 只有光头才能变强。\n>\n\n公司用到的很多技术，自己之前都没学过(**尬**)，于是只能慢慢补了。这次给大家写写我学习**消息队列**的笔记，希望对大家有帮助。\n\n## 一、什么是消息队列？\n\n消息队列不知道大家看到这个词的时候，会不会觉得它是一个比较**高端**的技术，反正我是觉得它好像是挺牛逼的。\n\n> 消息队列，一般我们会简称它为MQ(Message Queue)，嗯，就是很直白的简写。\n\n我们先不管消息(Message)这个词，来看看队列(Queue)。这一看，队列大家应该都熟悉吧。\n\n> 队列是一种**先进先出**的数据结构。\n\n在Java里边，已经实现了不少的队列了：\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191624238)\n\n那为什么还需要消息队列(MQ)这种**中间件**呢？？？其实这个问题，跟之前我学Redis的时候很像。Redis是一个以`key-value`形式存储的内存数据库，明明我们可以使用类似HashMap这种实现类就可以达到类似的效果了，那还为什么要Redis？《[Redis合集](https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247484609&idx=1&sn=4c053236699fde3c2db1241ab497487b&chksm=ebd745c0dca0ccd682e91938fc30fa947df1385b06d6ae9bb52514967b0736c66684db2f1ac9&token=177635168&lang=zh_CN&scene=21#wechat_redirect)》\n\n- 到这里，大家可以先猜猜为什么要用消息队列(MQ)这种**中间件**，下面会继续补充。\n\n消息队列可以简单理解为：**把要传输的数据放在队列中**。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191624890)\n\n科普：\n\n- 把数据放到消息队列叫做**生产者**\n- 从消息队列里边取数据叫做**消费者**\n\n## 二、为什么要用消息队列？\n\n为什么要用消息队列，也就是在问：用了消息队列有什么好处。我们看看以下的场景\n\n### 2.1 解耦\n\n现在我有一个系统A，系统A可以产生一个`userId`\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191624026)\n\n系统A可以产生一个UserId\n\n然后，现在有系统B和系统C都需要这个`userId`去做相关的操作\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625379)系统A给系统B和系统C传入userId这个值\n\n写成伪代码可能是这样的：\n\n```\npublic class SystemA {\n\n    // 系统B和系统C的依赖\n    SystemB systemB = new SystemB();\n    SystemC systemC = new SystemC();\n\n    // 系统A独有的数据userId\n    private String userId = \"Java3y\";\n\n    public void doSomething() {\n\n        // 系统B和系统C都需要拿着系统A的userId去操作其他的事\n        systemB.SystemBNeed2do(userId);\n        systemC.SystemCNeed2do(userId);\n\n    }\n}\n```\n\n结构图如下：\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625471)结构图\n\nok，一切平安无事度过了几个天。\n\n某一天，系统B的负责人告诉系统A的负责人，现在系统B的`SystemBNeed2do(String userId)`这个接口不再使用了，**让系统A别去调它了**。\n\n于是，系统A的负责人说\"好的，那我就不调用你了。\"，于是就**把调用系统B接口的代码给删掉了**：\n\n```\npublic void doSomething() {\n\n  // 系统A不再调用系统B的接口了\n  //systemB.SystemBNeed2do(userId);\n  systemC.SystemCNeed2do(userId);\n\n}\n```\n\n又过了几天，系统D的负责人接了个需求，也需要用到系统A的userId，于是就跑去跟系统A的负责人说：\"老哥，我要用到你的userId，你调一下我的接口吧\"\n\n于是系统A说：\"没问题的，这就搞\"\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625129)系统A需要调用系统D的接口\n\n然后，系统A的代码如下：\n\n```\npublic class SystemA {\n\n    // 已经不再需要系统B的依赖了\n    // SystemB systemB = new SystemB();\n\n    // 系统C和系统D的依赖\n    SystemC systemC = new SystemC();\n    SystemD systemD = new SystemD();\n\n    // 系统A独有的数据\n    private String userId = \"Java3y\";\n\n    public void doSomething() {\n\n\n        // 已经不再需要系统B的依赖了\n        //systemB.SystemBNeed2do(userId);\n\n        // 系统C和系统D都需要拿着系统A的userId去操作其他的事\n        systemC.SystemCNeed2do(userId);\n        systemD.SystemDNeed2do(userId);\n\n    }\n}\n```\n\n时间飞逝：\n\n- 又过了几天，系统E的负责人过来了，告诉系统A，需要userId。\n- 又过了几天，系统B的负责人过来了，告诉系统A，还是重新掉那个接口吧。\n- 又过了几天，系统F的负责人过来了，告诉系统A，需要userId。\n- ……\n\n于是系统A的负责人，每天都被这给骚扰着，改来改去，改来改去…….\n\n还有另外一个问题，调用系统C的时候，如果系统C挂了，系统A还得想办法处理。如果调用系统D时，由于网络延迟，请求超时了，那系统A是反馈`fail`还是重试？？\n\n最后，系统A的负责人，觉得**隔一段时间就改来改去**，没意思，于是就跑路了。\n\n然后，公司招来一个大佬，大佬经过几天熟悉，上来就说：**将系统A的userId写到消息队列中，这样系统A就不用经常改动了**。为什么呢？下面我们来一起看看：\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625609)系统A将userId写到消息队列中，系统C和系统D从消息队列中拿数据\n\n系统A将userId写到消息队列中，系统C和系统D从消息队列中拿数据。**这样有什么好处**？\n\n- 系统A**只负责**把数据写到队列中，谁想要或不想要这个数据(消息)，**系统A一点都不关心**。\n- 即便现在系统D不想要userId这个数据了，系统B又突然想要userId这个数据了，都跟系统A无关，系统A一点代码都不用改。\n- 系统D拿userId不再经过系统A，而是从消息队列里边拿。**系统D即便挂了或者请求超时，都跟系统A无关，只跟消息队列有关**。\n\n这样一来，系统A与系统B、C、D都**解耦**了。\n\n### 2.2 异步\n\n我们再来看看下面这种情况：系统A还是**直接调用**系统B、C、D\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625109)直接调接口\n\n代码如下：\n\n```\npublic class SystemA {\n\n    SystemB systemB = new SystemB();\n    SystemC systemC = new SystemC();\n    SystemD systemD = new SystemD();\n\n    // 系统A独有的数据\n    private String userId ;\n\n    public void doOrder() {\n\n        // 下订单\n          userId = this.order();\n        // 如果下单成功，则安排其他系统做一些事  \n        systemB.SystemBNeed2do(userId);\n        systemC.SystemCNeed2do(userId);\n        systemD.SystemDNeed2do(userId);\n\n    }\n}\n```\n\n**假设**系统A运算出userId具体的值需要50ms，调用系统B的接口需要300ms，调用系统C的接口需要300ms，调用系统D的接口需要300ms。那么这次请求就需要`50+300+300+300=950ms`\n\n并且我们得知，系统A做的是**主要的业务**，而系统B、C、D是**非主要**的业务。比如系统A处理的是**订单下单**，而系统B是订单下单成功了，那发送一条短信告诉具体的用户此订单已成功，而系统C和系统D也是处理一些小事而已。\n\n那么此时，为了**提高用户体验和吞吐量**，其实可以**异步地**调用系统B、C、D的接口。所以，我们可以弄成是这样的：\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191625091)此时才用了100ms\n\n系统A执行完了以后，将userId写到消息队列中，然后就直接返回了(至于其他的操作，则异步处理)。\n\n- 本来整个请求需要用950ms(同步)\n- 现在将调用其他系统接口异步化，从请求到返回只需要100ms(异步)\n\n(例子可能举得不太好，但我觉得说明到点子上就行了，见谅。)\n\n### 2.3削峰/限流\n\n我们再来一个场景，现在我们每个月要搞一次大促，大促期间的并发可能会很高的，比如每秒3000个请求。假设我们现在有两台机器处理请求，并且每台机器只能每次处理1000个请求。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191626012)削峰的场景\n\n那多出来的1000个请求，可能就把我们**整个系统给搞崩了**…所以，有一种办法，我们可以写到消息队列中：\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191626505)写到消息队列中，系统从消息队列中拿到请求\n\n系统B和系统C**根据自己的能够处理的请求数去消息队列中拿数据**，这样即便有每秒有8000个请求，那只是把请求放在消息队列中，去拿消息队列的消息**由系统自己去控制**，这样就不会把整个系统给搞崩。\n\n## 三、使用消息队列有什么问题？\n\n经过我们上面的场景，我们已经可以发现，消息队列能做的事其实还是蛮多的。\n\n说到这里，我们先回到文章的开头，\"明明JDK已经有不少的队列实现了，我们还需要消息队列中间件呢？\"其实很简单，JDK实现的队列种类虽然有很多种，但是都是**简单的内存队列**。为什么我说JDK是简单的内存队列呢？下面我们来看看要实现消息队列(中间件)**可能要考虑什么问题**。\n\n## 3.1高可用\n\n无论是我们使用消息队列来做解耦、异步还是削峰，消息队列**肯定不能是单机**的。试着想一下，如果是单机的消息队列，万一这台机器挂了，那我们整个系统几乎就是不可用了。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191626549)万一单机的队列挂掉了\n\n所以，当我们项目中使用消息队列，都是得`集群/分布式`的。要做`集群/分布式`就必然希望该消息队列能够提供**现成**的支持，而不是自己写代码手动去实现。\n\n### 3.2 数据丢失问题\n\n我们将数据写到消息队列上，系统B和C还没来得及取消息队列的数据，就挂掉了。**如果没有做任何的措施，我们的数据就丢了**。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191626492)数据丢失问题\n\n学过Redis的都知道，Redis可以将数据持久化磁盘上，万一Redis挂了，还能从磁盘从将数据恢复过来。同样地，消息队列中的数据也需要存在别的地方，这样才尽可能减少数据的丢失。\n\n那存在哪呢？\n\n- 磁盘？\n- 数据库？\n- Redis？\n- 分布式文件系统？\n\n同步存储还是异步存储？\n\n### 3.3消费者怎么得到消息队列的数据？\n\n消费者怎么从消息队列里边得到数据？有两种办法：\n\n- 生产者将数据放到消息队列中，消息队列有数据了，**主动叫**消费者去拿(俗称push)\n- 消费者不断去**轮训**消息队列，看看有没有新的数据，如果有就消费(俗称pull)\n\n### 3.4其他\n\n除了这些，我们在**使用的时候**还得考虑各种的问题：\n\n- 消息重复消费了怎么办啊？\n- 我想保证消息是**绝对**有顺序的怎么做？\n- ……..\n\n虽然消息队列给我们带来了那么多的好处，但同时我们发现引入消息队列也会**提高系统的复杂性**。市面上现在已经有不少消息队列轮子了，每种消息队列都有自己的特点，**选取哪种MQ还得好好斟酌**。\n\n## 最后\n\n本文主要讲解了什么是消息队列，消息队列可以为我们带来什么好处，以及一个消息队列可能会涉及到哪些问题。希望给大家带来一定的帮助。\n\n参考资料：\n- Kafka简明教程\n  \n  > https://zhuanlan.zhihu.com/p/37405836\n- 消息队列使用的四种场景介绍，有图有解析，一看就懂\n  \n  > https://zhuanlan.zhihu.com/p/55712984\n- 消息队列设计精要\n  \n  > https://zhuanlan.zhihu.com/p/21479556\n- 消息队列的使用场景是怎样的\n  \n  > https://www.zhihu.com/question/34243607\n","slug":"mq/什么是消息队列","published":1,"date":"2022-04-20T12:41:20.787Z","updated":"2022-05-04T03:21:32.149Z","_id":"cl2qzfti5004513no5l8c6rqi","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><blockquote>\n<p>只有光头才能变强。</p>\n</blockquote>\n<p>公司用到的很多技术，自己之前都没学过(<strong>尬</strong>)，于是只能慢慢补了。这次给大家写写我学习<strong>消息队列</strong>的笔记，希望对大家有帮助。</p>\n<h2 id=\"一、什么是消息队列？\"><a href=\"#一、什么是消息队列？\" class=\"headerlink\" title=\"一、什么是消息队列？\"></a>一、什么是消息队列？</h2><p>消息队列不知道大家看到这个词的时候，会不会觉得它是一个比较<strong>高端</strong>的技术，反正我是觉得它好像是挺牛逼的。</p>\n<blockquote>\n<p>消息队列，一般我们会简称它为MQ(Message Queue)，嗯，就是很直白的简写。</p>\n</blockquote>\n<p>我们先不管消息(Message)这个词，来看看队列(Queue)。这一看，队列大家应该都熟悉吧。</p>\n<blockquote>\n<p>队列是一种<strong>先进先出</strong>的数据结构。</p>\n</blockquote>\n<p>在Java里边，已经实现了不少的队列了：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191624238\" alt=\"图片\"></p>\n<p>那为什么还需要消息队列(MQ)这种<strong>中间件</strong>呢？？？其实这个问题，跟之前我学Redis的时候很像。Redis是一个以<code>key-value</code>形式存储的内存数据库，明明我们可以使用类似HashMap这种实现类就可以达到类似的效果了，那还为什么要Redis？《<a href=\"https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247484609&idx=1&sn=4c053236699fde3c2db1241ab497487b&chksm=ebd745c0dca0ccd682e91938fc30fa947df1385b06d6ae9bb52514967b0736c66684db2f1ac9&token=177635168&lang=zh_CN&scene=21#wechat_redirect\">Redis合集</a>》</p>\n<ul>\n<li>到这里，大家可以先猜猜为什么要用消息队列(MQ)这种<strong>中间件</strong>，下面会继续补充。</li>\n</ul>\n<p>消息队列可以简单理解为：<strong>把要传输的数据放在队列中</strong>。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191624890\" alt=\"图片\"></p>\n<p>科普：</p>\n<ul>\n<li>把数据放到消息队列叫做<strong>生产者</strong></li>\n<li>从消息队列里边取数据叫做<strong>消费者</strong></li>\n</ul>\n<h2 id=\"二、为什么要用消息队列？\"><a href=\"#二、为什么要用消息队列？\" class=\"headerlink\" title=\"二、为什么要用消息队列？\"></a>二、为什么要用消息队列？</h2><p>为什么要用消息队列，也就是在问：用了消息队列有什么好处。我们看看以下的场景</p>\n<h3 id=\"2-1-解耦\"><a href=\"#2-1-解耦\" class=\"headerlink\" title=\"2.1 解耦\"></a>2.1 解耦</h3><p>现在我有一个系统A，系统A可以产生一个<code>userId</code></p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191624026\" alt=\"图片\"></p>\n<p>系统A可以产生一个UserId</p>\n<p>然后，现在有系统B和系统C都需要这个<code>userId</code>去做相关的操作</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625379\" alt=\"图片\">系统A给系统B和系统C传入userId这个值</p>\n<p>写成伪代码可能是这样的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SystemA &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // 系统B和系统C的依赖</span><br><span class=\"line\">    SystemB systemB = new SystemB();</span><br><span class=\"line\">    SystemC systemC = new SystemC();</span><br><span class=\"line\"></span><br><span class=\"line\">    // 系统A独有的数据userId</span><br><span class=\"line\">    private String userId = &quot;Java3y&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void doSomething() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        // 系统B和系统C都需要拿着系统A的userId去操作其他的事</span><br><span class=\"line\">        systemB.SystemBNeed2do(userId);</span><br><span class=\"line\">        systemC.SystemCNeed2do(userId);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>结构图如下：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625471\" alt=\"图片\">结构图</p>\n<p>ok，一切平安无事度过了几个天。</p>\n<p>某一天，系统B的负责人告诉系统A的负责人，现在系统B的<code>SystemBNeed2do(String userId)</code>这个接口不再使用了，<strong>让系统A别去调它了</strong>。</p>\n<p>于是，系统A的负责人说”好的，那我就不调用你了。”，于是就<strong>把调用系统B接口的代码给删掉了</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void doSomething() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  // 系统A不再调用系统B的接口了</span><br><span class=\"line\">  //systemB.SystemBNeed2do(userId);</span><br><span class=\"line\">  systemC.SystemCNeed2do(userId);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>又过了几天，系统D的负责人接了个需求，也需要用到系统A的userId，于是就跑去跟系统A的负责人说：”老哥，我要用到你的userId，你调一下我的接口吧”</p>\n<p>于是系统A说：”没问题的，这就搞”</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625129\" alt=\"图片\">系统A需要调用系统D的接口</p>\n<p>然后，系统A的代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SystemA &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // 已经不再需要系统B的依赖了</span><br><span class=\"line\">    // SystemB systemB = new SystemB();</span><br><span class=\"line\"></span><br><span class=\"line\">    // 系统C和系统D的依赖</span><br><span class=\"line\">    SystemC systemC = new SystemC();</span><br><span class=\"line\">    SystemD systemD = new SystemD();</span><br><span class=\"line\"></span><br><span class=\"line\">    // 系统A独有的数据</span><br><span class=\"line\">    private String userId = &quot;Java3y&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void doSomething() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        // 已经不再需要系统B的依赖了</span><br><span class=\"line\">        //systemB.SystemBNeed2do(userId);</span><br><span class=\"line\"></span><br><span class=\"line\">        // 系统C和系统D都需要拿着系统A的userId去操作其他的事</span><br><span class=\"line\">        systemC.SystemCNeed2do(userId);</span><br><span class=\"line\">        systemD.SystemDNeed2do(userId);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>时间飞逝：</p>\n<ul>\n<li>又过了几天，系统E的负责人过来了，告诉系统A，需要userId。</li>\n<li>又过了几天，系统B的负责人过来了，告诉系统A，还是重新掉那个接口吧。</li>\n<li>又过了几天，系统F的负责人过来了，告诉系统A，需要userId。</li>\n<li>……</li>\n</ul>\n<p>于是系统A的负责人，每天都被这给骚扰着，改来改去，改来改去…….</p>\n<p>还有另外一个问题，调用系统C的时候，如果系统C挂了，系统A还得想办法处理。如果调用系统D时，由于网络延迟，请求超时了，那系统A是反馈<code>fail</code>还是重试？？</p>\n<p>最后，系统A的负责人，觉得<strong>隔一段时间就改来改去</strong>，没意思，于是就跑路了。</p>\n<p>然后，公司招来一个大佬，大佬经过几天熟悉，上来就说：<strong>将系统A的userId写到消息队列中，这样系统A就不用经常改动了</strong>。为什么呢？下面我们来一起看看：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625609\" alt=\"图片\">系统A将userId写到消息队列中，系统C和系统D从消息队列中拿数据</p>\n<p>系统A将userId写到消息队列中，系统C和系统D从消息队列中拿数据。<strong>这样有什么好处</strong>？</p>\n<ul>\n<li>系统A<strong>只负责</strong>把数据写到队列中，谁想要或不想要这个数据(消息)，<strong>系统A一点都不关心</strong>。</li>\n<li>即便现在系统D不想要userId这个数据了，系统B又突然想要userId这个数据了，都跟系统A无关，系统A一点代码都不用改。</li>\n<li>系统D拿userId不再经过系统A，而是从消息队列里边拿。<strong>系统D即便挂了或者请求超时，都跟系统A无关，只跟消息队列有关</strong>。</li>\n</ul>\n<p>这样一来，系统A与系统B、C、D都<strong>解耦</strong>了。</p>\n<h3 id=\"2-2-异步\"><a href=\"#2-2-异步\" class=\"headerlink\" title=\"2.2 异步\"></a>2.2 异步</h3><p>我们再来看看下面这种情况：系统A还是<strong>直接调用</strong>系统B、C、D</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625109\" alt=\"图片\">直接调接口</p>\n<p>代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SystemA &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    SystemB systemB = new SystemB();</span><br><span class=\"line\">    SystemC systemC = new SystemC();</span><br><span class=\"line\">    SystemD systemD = new SystemD();</span><br><span class=\"line\"></span><br><span class=\"line\">    // 系统A独有的数据</span><br><span class=\"line\">    private String userId ;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void doOrder() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        // 下订单</span><br><span class=\"line\">          userId = this.order();</span><br><span class=\"line\">        // 如果下单成功，则安排其他系统做一些事  </span><br><span class=\"line\">        systemB.SystemBNeed2do(userId);</span><br><span class=\"line\">        systemC.SystemCNeed2do(userId);</span><br><span class=\"line\">        systemD.SystemDNeed2do(userId);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>假设</strong>系统A运算出userId具体的值需要50ms，调用系统B的接口需要300ms，调用系统C的接口需要300ms，调用系统D的接口需要300ms。那么这次请求就需要<code>50+300+300+300=950ms</code></p>\n<p>并且我们得知，系统A做的是<strong>主要的业务</strong>，而系统B、C、D是<strong>非主要</strong>的业务。比如系统A处理的是<strong>订单下单</strong>，而系统B是订单下单成功了，那发送一条短信告诉具体的用户此订单已成功，而系统C和系统D也是处理一些小事而已。</p>\n<p>那么此时，为了<strong>提高用户体验和吞吐量</strong>，其实可以<strong>异步地</strong>调用系统B、C、D的接口。所以，我们可以弄成是这样的：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625091\" alt=\"图片\">此时才用了100ms</p>\n<p>系统A执行完了以后，将userId写到消息队列中，然后就直接返回了(至于其他的操作，则异步处理)。</p>\n<ul>\n<li>本来整个请求需要用950ms(同步)</li>\n<li>现在将调用其他系统接口异步化，从请求到返回只需要100ms(异步)</li>\n</ul>\n<p>(例子可能举得不太好，但我觉得说明到点子上就行了，见谅。)</p>\n<h3 id=\"2-3削峰-限流\"><a href=\"#2-3削峰-限流\" class=\"headerlink\" title=\"2.3削峰/限流\"></a>2.3削峰/限流</h3><p>我们再来一个场景，现在我们每个月要搞一次大促，大促期间的并发可能会很高的，比如每秒3000个请求。假设我们现在有两台机器处理请求，并且每台机器只能每次处理1000个请求。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191626012\" alt=\"图片\">削峰的场景</p>\n<p>那多出来的1000个请求，可能就把我们<strong>整个系统给搞崩了</strong>…所以，有一种办法，我们可以写到消息队列中：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191626505\" alt=\"图片\">写到消息队列中，系统从消息队列中拿到请求</p>\n<p>系统B和系统C<strong>根据自己的能够处理的请求数去消息队列中拿数据</strong>，这样即便有每秒有8000个请求，那只是把请求放在消息队列中，去拿消息队列的消息<strong>由系统自己去控制</strong>，这样就不会把整个系统给搞崩。</p>\n<h2 id=\"三、使用消息队列有什么问题？\"><a href=\"#三、使用消息队列有什么问题？\" class=\"headerlink\" title=\"三、使用消息队列有什么问题？\"></a>三、使用消息队列有什么问题？</h2><p>经过我们上面的场景，我们已经可以发现，消息队列能做的事其实还是蛮多的。</p>\n<p>说到这里，我们先回到文章的开头，”明明JDK已经有不少的队列实现了，我们还需要消息队列中间件呢？”其实很简单，JDK实现的队列种类虽然有很多种，但是都是<strong>简单的内存队列</strong>。为什么我说JDK是简单的内存队列呢？下面我们来看看要实现消息队列(中间件)<strong>可能要考虑什么问题</strong>。</p>\n<h2 id=\"3-1高可用\"><a href=\"#3-1高可用\" class=\"headerlink\" title=\"3.1高可用\"></a>3.1高可用</h2><p>无论是我们使用消息队列来做解耦、异步还是削峰，消息队列<strong>肯定不能是单机</strong>的。试着想一下，如果是单机的消息队列，万一这台机器挂了，那我们整个系统几乎就是不可用了。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191626549\" alt=\"图片\">万一单机的队列挂掉了</p>\n<p>所以，当我们项目中使用消息队列，都是得<code>集群/分布式</code>的。要做<code>集群/分布式</code>就必然希望该消息队列能够提供<strong>现成</strong>的支持，而不是自己写代码手动去实现。</p>\n<h3 id=\"3-2-数据丢失问题\"><a href=\"#3-2-数据丢失问题\" class=\"headerlink\" title=\"3.2 数据丢失问题\"></a>3.2 数据丢失问题</h3><p>我们将数据写到消息队列上，系统B和C还没来得及取消息队列的数据，就挂掉了。<strong>如果没有做任何的措施，我们的数据就丢了</strong>。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191626492\" alt=\"图片\">数据丢失问题</p>\n<p>学过Redis的都知道，Redis可以将数据持久化磁盘上，万一Redis挂了，还能从磁盘从将数据恢复过来。同样地，消息队列中的数据也需要存在别的地方，这样才尽可能减少数据的丢失。</p>\n<p>那存在哪呢？</p>\n<ul>\n<li>磁盘？</li>\n<li>数据库？</li>\n<li>Redis？</li>\n<li>分布式文件系统？</li>\n</ul>\n<p>同步存储还是异步存储？</p>\n<h3 id=\"3-3消费者怎么得到消息队列的数据？\"><a href=\"#3-3消费者怎么得到消息队列的数据？\" class=\"headerlink\" title=\"3.3消费者怎么得到消息队列的数据？\"></a>3.3消费者怎么得到消息队列的数据？</h3><p>消费者怎么从消息队列里边得到数据？有两种办法：</p>\n<ul>\n<li>生产者将数据放到消息队列中，消息队列有数据了，<strong>主动叫</strong>消费者去拿(俗称push)</li>\n<li>消费者不断去<strong>轮训</strong>消息队列，看看有没有新的数据，如果有就消费(俗称pull)</li>\n</ul>\n<h3 id=\"3-4其他\"><a href=\"#3-4其他\" class=\"headerlink\" title=\"3.4其他\"></a>3.4其他</h3><p>除了这些，我们在<strong>使用的时候</strong>还得考虑各种的问题：</p>\n<ul>\n<li>消息重复消费了怎么办啊？</li>\n<li>我想保证消息是<strong>绝对</strong>有顺序的怎么做？</li>\n<li>……..</li>\n</ul>\n<p>虽然消息队列给我们带来了那么多的好处，但同时我们发现引入消息队列也会<strong>提高系统的复杂性</strong>。市面上现在已经有不少消息队列轮子了，每种消息队列都有自己的特点，<strong>选取哪种MQ还得好好斟酌</strong>。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>本文主要讲解了什么是消息队列，消息队列可以为我们带来什么好处，以及一个消息队列可能会涉及到哪些问题。希望给大家带来一定的帮助。</p>\n<p>参考资料：</p>\n<ul>\n<li>Kafka简明教程<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/37405836\">https://zhuanlan.zhihu.com/p/37405836</a></p>\n</blockquote>\n</li>\n<li>消息队列使用的四种场景介绍，有图有解析，一看就懂<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/55712984\">https://zhuanlan.zhihu.com/p/55712984</a></p>\n</blockquote>\n</li>\n<li>消息队列设计精要<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/21479556\">https://zhuanlan.zhihu.com/p/21479556</a></p>\n</blockquote>\n</li>\n<li>消息队列的使用场景是怎样的<blockquote>\n<p><a href=\"https://www.zhihu.com/question/34243607\">https://www.zhihu.com/question/34243607</a></p>\n</blockquote>\n</li>\n</ul>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><blockquote>\n<p>只有光头才能变强。</p>\n</blockquote>\n<p>公司用到的很多技术，自己之前都没学过(<strong>尬</strong>)，于是只能慢慢补了。这次给大家写写我学习<strong>消息队列</strong>的笔记，希望对大家有帮助。</p>\n<h2 id=\"一、什么是消息队列？\"><a href=\"#一、什么是消息队列？\" class=\"headerlink\" title=\"一、什么是消息队列？\"></a>一、什么是消息队列？</h2><p>消息队列不知道大家看到这个词的时候，会不会觉得它是一个比较<strong>高端</strong>的技术，反正我是觉得它好像是挺牛逼的。</p>\n<blockquote>\n<p>消息队列，一般我们会简称它为MQ(Message Queue)，嗯，就是很直白的简写。</p>\n</blockquote>\n<p>我们先不管消息(Message)这个词，来看看队列(Queue)。这一看，队列大家应该都熟悉吧。</p>\n<blockquote>\n<p>队列是一种<strong>先进先出</strong>的数据结构。</p>\n</blockquote>\n<p>在Java里边，已经实现了不少的队列了：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191624238\" alt=\"图片\"></p>\n<p>那为什么还需要消息队列(MQ)这种<strong>中间件</strong>呢？？？其实这个问题，跟之前我学Redis的时候很像。Redis是一个以<code>key-value</code>形式存储的内存数据库，明明我们可以使用类似HashMap这种实现类就可以达到类似的效果了，那还为什么要Redis？《<a href=\"https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247484609&idx=1&sn=4c053236699fde3c2db1241ab497487b&chksm=ebd745c0dca0ccd682e91938fc30fa947df1385b06d6ae9bb52514967b0736c66684db2f1ac9&token=177635168&lang=zh_CN&scene=21#wechat_redirect\">Redis合集</a>》</p>\n<ul>\n<li>到这里，大家可以先猜猜为什么要用消息队列(MQ)这种<strong>中间件</strong>，下面会继续补充。</li>\n</ul>\n<p>消息队列可以简单理解为：<strong>把要传输的数据放在队列中</strong>。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191624890\" alt=\"图片\"></p>\n<p>科普：</p>\n<ul>\n<li>把数据放到消息队列叫做<strong>生产者</strong></li>\n<li>从消息队列里边取数据叫做<strong>消费者</strong></li>\n</ul>\n<h2 id=\"二、为什么要用消息队列？\"><a href=\"#二、为什么要用消息队列？\" class=\"headerlink\" title=\"二、为什么要用消息队列？\"></a>二、为什么要用消息队列？</h2><p>为什么要用消息队列，也就是在问：用了消息队列有什么好处。我们看看以下的场景</p>\n<h3 id=\"2-1-解耦\"><a href=\"#2-1-解耦\" class=\"headerlink\" title=\"2.1 解耦\"></a>2.1 解耦</h3><p>现在我有一个系统A，系统A可以产生一个<code>userId</code></p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191624026\" alt=\"图片\"></p>\n<p>系统A可以产生一个UserId</p>\n<p>然后，现在有系统B和系统C都需要这个<code>userId</code>去做相关的操作</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625379\" alt=\"图片\">系统A给系统B和系统C传入userId这个值</p>\n<p>写成伪代码可能是这样的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SystemA &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // 系统B和系统C的依赖</span><br><span class=\"line\">    SystemB systemB = new SystemB();</span><br><span class=\"line\">    SystemC systemC = new SystemC();</span><br><span class=\"line\"></span><br><span class=\"line\">    // 系统A独有的数据userId</span><br><span class=\"line\">    private String userId = &quot;Java3y&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void doSomething() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        // 系统B和系统C都需要拿着系统A的userId去操作其他的事</span><br><span class=\"line\">        systemB.SystemBNeed2do(userId);</span><br><span class=\"line\">        systemC.SystemCNeed2do(userId);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>结构图如下：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625471\" alt=\"图片\">结构图</p>\n<p>ok，一切平安无事度过了几个天。</p>\n<p>某一天，系统B的负责人告诉系统A的负责人，现在系统B的<code>SystemBNeed2do(String userId)</code>这个接口不再使用了，<strong>让系统A别去调它了</strong>。</p>\n<p>于是，系统A的负责人说”好的，那我就不调用你了。”，于是就<strong>把调用系统B接口的代码给删掉了</strong>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public void doSomething() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  // 系统A不再调用系统B的接口了</span><br><span class=\"line\">  //systemB.SystemBNeed2do(userId);</span><br><span class=\"line\">  systemC.SystemCNeed2do(userId);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>又过了几天，系统D的负责人接了个需求，也需要用到系统A的userId，于是就跑去跟系统A的负责人说：”老哥，我要用到你的userId，你调一下我的接口吧”</p>\n<p>于是系统A说：”没问题的，这就搞”</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625129\" alt=\"图片\">系统A需要调用系统D的接口</p>\n<p>然后，系统A的代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SystemA &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    // 已经不再需要系统B的依赖了</span><br><span class=\"line\">    // SystemB systemB = new SystemB();</span><br><span class=\"line\"></span><br><span class=\"line\">    // 系统C和系统D的依赖</span><br><span class=\"line\">    SystemC systemC = new SystemC();</span><br><span class=\"line\">    SystemD systemD = new SystemD();</span><br><span class=\"line\"></span><br><span class=\"line\">    // 系统A独有的数据</span><br><span class=\"line\">    private String userId = &quot;Java3y&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void doSomething() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        // 已经不再需要系统B的依赖了</span><br><span class=\"line\">        //systemB.SystemBNeed2do(userId);</span><br><span class=\"line\"></span><br><span class=\"line\">        // 系统C和系统D都需要拿着系统A的userId去操作其他的事</span><br><span class=\"line\">        systemC.SystemCNeed2do(userId);</span><br><span class=\"line\">        systemD.SystemDNeed2do(userId);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>时间飞逝：</p>\n<ul>\n<li>又过了几天，系统E的负责人过来了，告诉系统A，需要userId。</li>\n<li>又过了几天，系统B的负责人过来了，告诉系统A，还是重新掉那个接口吧。</li>\n<li>又过了几天，系统F的负责人过来了，告诉系统A，需要userId。</li>\n<li>……</li>\n</ul>\n<p>于是系统A的负责人，每天都被这给骚扰着，改来改去，改来改去…….</p>\n<p>还有另外一个问题，调用系统C的时候，如果系统C挂了，系统A还得想办法处理。如果调用系统D时，由于网络延迟，请求超时了，那系统A是反馈<code>fail</code>还是重试？？</p>\n<p>最后，系统A的负责人，觉得<strong>隔一段时间就改来改去</strong>，没意思，于是就跑路了。</p>\n<p>然后，公司招来一个大佬，大佬经过几天熟悉，上来就说：<strong>将系统A的userId写到消息队列中，这样系统A就不用经常改动了</strong>。为什么呢？下面我们来一起看看：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625609\" alt=\"图片\">系统A将userId写到消息队列中，系统C和系统D从消息队列中拿数据</p>\n<p>系统A将userId写到消息队列中，系统C和系统D从消息队列中拿数据。<strong>这样有什么好处</strong>？</p>\n<ul>\n<li>系统A<strong>只负责</strong>把数据写到队列中，谁想要或不想要这个数据(消息)，<strong>系统A一点都不关心</strong>。</li>\n<li>即便现在系统D不想要userId这个数据了，系统B又突然想要userId这个数据了，都跟系统A无关，系统A一点代码都不用改。</li>\n<li>系统D拿userId不再经过系统A，而是从消息队列里边拿。<strong>系统D即便挂了或者请求超时，都跟系统A无关，只跟消息队列有关</strong>。</li>\n</ul>\n<p>这样一来，系统A与系统B、C、D都<strong>解耦</strong>了。</p>\n<h3 id=\"2-2-异步\"><a href=\"#2-2-异步\" class=\"headerlink\" title=\"2.2 异步\"></a>2.2 异步</h3><p>我们再来看看下面这种情况：系统A还是<strong>直接调用</strong>系统B、C、D</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625109\" alt=\"图片\">直接调接口</p>\n<p>代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">public class SystemA &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    SystemB systemB = new SystemB();</span><br><span class=\"line\">    SystemC systemC = new SystemC();</span><br><span class=\"line\">    SystemD systemD = new SystemD();</span><br><span class=\"line\"></span><br><span class=\"line\">    // 系统A独有的数据</span><br><span class=\"line\">    private String userId ;</span><br><span class=\"line\"></span><br><span class=\"line\">    public void doOrder() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        // 下订单</span><br><span class=\"line\">          userId = this.order();</span><br><span class=\"line\">        // 如果下单成功，则安排其他系统做一些事  </span><br><span class=\"line\">        systemB.SystemBNeed2do(userId);</span><br><span class=\"line\">        systemC.SystemCNeed2do(userId);</span><br><span class=\"line\">        systemD.SystemDNeed2do(userId);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>假设</strong>系统A运算出userId具体的值需要50ms，调用系统B的接口需要300ms，调用系统C的接口需要300ms，调用系统D的接口需要300ms。那么这次请求就需要<code>50+300+300+300=950ms</code></p>\n<p>并且我们得知，系统A做的是<strong>主要的业务</strong>，而系统B、C、D是<strong>非主要</strong>的业务。比如系统A处理的是<strong>订单下单</strong>，而系统B是订单下单成功了，那发送一条短信告诉具体的用户此订单已成功，而系统C和系统D也是处理一些小事而已。</p>\n<p>那么此时，为了<strong>提高用户体验和吞吐量</strong>，其实可以<strong>异步地</strong>调用系统B、C、D的接口。所以，我们可以弄成是这样的：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191625091\" alt=\"图片\">此时才用了100ms</p>\n<p>系统A执行完了以后，将userId写到消息队列中，然后就直接返回了(至于其他的操作，则异步处理)。</p>\n<ul>\n<li>本来整个请求需要用950ms(同步)</li>\n<li>现在将调用其他系统接口异步化，从请求到返回只需要100ms(异步)</li>\n</ul>\n<p>(例子可能举得不太好，但我觉得说明到点子上就行了，见谅。)</p>\n<h3 id=\"2-3削峰-限流\"><a href=\"#2-3削峰-限流\" class=\"headerlink\" title=\"2.3削峰/限流\"></a>2.3削峰/限流</h3><p>我们再来一个场景，现在我们每个月要搞一次大促，大促期间的并发可能会很高的，比如每秒3000个请求。假设我们现在有两台机器处理请求，并且每台机器只能每次处理1000个请求。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191626012\" alt=\"图片\">削峰的场景</p>\n<p>那多出来的1000个请求，可能就把我们<strong>整个系统给搞崩了</strong>…所以，有一种办法，我们可以写到消息队列中：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191626505\" alt=\"图片\">写到消息队列中，系统从消息队列中拿到请求</p>\n<p>系统B和系统C<strong>根据自己的能够处理的请求数去消息队列中拿数据</strong>，这样即便有每秒有8000个请求，那只是把请求放在消息队列中，去拿消息队列的消息<strong>由系统自己去控制</strong>，这样就不会把整个系统给搞崩。</p>\n<h2 id=\"三、使用消息队列有什么问题？\"><a href=\"#三、使用消息队列有什么问题？\" class=\"headerlink\" title=\"三、使用消息队列有什么问题？\"></a>三、使用消息队列有什么问题？</h2><p>经过我们上面的场景，我们已经可以发现，消息队列能做的事其实还是蛮多的。</p>\n<p>说到这里，我们先回到文章的开头，”明明JDK已经有不少的队列实现了，我们还需要消息队列中间件呢？”其实很简单，JDK实现的队列种类虽然有很多种，但是都是<strong>简单的内存队列</strong>。为什么我说JDK是简单的内存队列呢？下面我们来看看要实现消息队列(中间件)<strong>可能要考虑什么问题</strong>。</p>\n<h2 id=\"3-1高可用\"><a href=\"#3-1高可用\" class=\"headerlink\" title=\"3.1高可用\"></a>3.1高可用</h2><p>无论是我们使用消息队列来做解耦、异步还是削峰，消息队列<strong>肯定不能是单机</strong>的。试着想一下，如果是单机的消息队列，万一这台机器挂了，那我们整个系统几乎就是不可用了。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191626549\" alt=\"图片\">万一单机的队列挂掉了</p>\n<p>所以，当我们项目中使用消息队列，都是得<code>集群/分布式</code>的。要做<code>集群/分布式</code>就必然希望该消息队列能够提供<strong>现成</strong>的支持，而不是自己写代码手动去实现。</p>\n<h3 id=\"3-2-数据丢失问题\"><a href=\"#3-2-数据丢失问题\" class=\"headerlink\" title=\"3.2 数据丢失问题\"></a>3.2 数据丢失问题</h3><p>我们将数据写到消息队列上，系统B和C还没来得及取消息队列的数据，就挂掉了。<strong>如果没有做任何的措施，我们的数据就丢了</strong>。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191626492\" alt=\"图片\">数据丢失问题</p>\n<p>学过Redis的都知道，Redis可以将数据持久化磁盘上，万一Redis挂了，还能从磁盘从将数据恢复过来。同样地，消息队列中的数据也需要存在别的地方，这样才尽可能减少数据的丢失。</p>\n<p>那存在哪呢？</p>\n<ul>\n<li>磁盘？</li>\n<li>数据库？</li>\n<li>Redis？</li>\n<li>分布式文件系统？</li>\n</ul>\n<p>同步存储还是异步存储？</p>\n<h3 id=\"3-3消费者怎么得到消息队列的数据？\"><a href=\"#3-3消费者怎么得到消息队列的数据？\" class=\"headerlink\" title=\"3.3消费者怎么得到消息队列的数据？\"></a>3.3消费者怎么得到消息队列的数据？</h3><p>消费者怎么从消息队列里边得到数据？有两种办法：</p>\n<ul>\n<li>生产者将数据放到消息队列中，消息队列有数据了，<strong>主动叫</strong>消费者去拿(俗称push)</li>\n<li>消费者不断去<strong>轮训</strong>消息队列，看看有没有新的数据，如果有就消费(俗称pull)</li>\n</ul>\n<h3 id=\"3-4其他\"><a href=\"#3-4其他\" class=\"headerlink\" title=\"3.4其他\"></a>3.4其他</h3><p>除了这些，我们在<strong>使用的时候</strong>还得考虑各种的问题：</p>\n<ul>\n<li>消息重复消费了怎么办啊？</li>\n<li>我想保证消息是<strong>绝对</strong>有顺序的怎么做？</li>\n<li>……..</li>\n</ul>\n<p>虽然消息队列给我们带来了那么多的好处，但同时我们发现引入消息队列也会<strong>提高系统的复杂性</strong>。市面上现在已经有不少消息队列轮子了，每种消息队列都有自己的特点，<strong>选取哪种MQ还得好好斟酌</strong>。</p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><p>本文主要讲解了什么是消息队列，消息队列可以为我们带来什么好处，以及一个消息队列可能会涉及到哪些问题。希望给大家带来一定的帮助。</p>\n<p>参考资料：</p>\n<ul>\n<li>Kafka简明教程<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/37405836\">https://zhuanlan.zhihu.com/p/37405836</a></p>\n</blockquote>\n</li>\n<li>消息队列使用的四种场景介绍，有图有解析，一看就懂<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/55712984\">https://zhuanlan.zhihu.com/p/55712984</a></p>\n</blockquote>\n</li>\n<li>消息队列设计精要<blockquote>\n<p><a href=\"https://zhuanlan.zhihu.com/p/21479556\">https://zhuanlan.zhihu.com/p/21479556</a></p>\n</blockquote>\n</li>\n<li>消息队列的使用场景是怎样的<blockquote>\n<p><a href=\"https://www.zhihu.com/question/34243607\">https://www.zhihu.com/question/34243607</a></p>\n</blockquote>\n</li>\n</ul>\n"},{"uuid":"bbaf4813-c0ab-11ec-92a1-7557b2313227","title":"curl get","abbrlink":"3d76e967","_content":"\n# GET Request\n\n## Send a GET Request and Print the Response to Screen\n\n```bash\ncurl https://catonmat.net\n```\n\nYou don't need to specify any arguments to make a GET request. It's curl's default request method. This recipe makes a GET request to `https://catonmat.net` and prints the returned content to screen.\n\n## Send a GET Request and Save the Response to a File\n\n```bash\ncurl -o response.txt https://catonmat.net\n```\n\nIn this recipe, curl makes a GET request to `https://catonmat.net` and uses the `-o response.txt` argument to save the body of the HTTP response to `response.txt` file.\n\n# Save the Response to a File\n\nThese curl recipes show you how to save the response from a curl request to a file. By default, curl prints the response to screen. To make it save the response to a file, use the `-o file` command line option.\n\nSave the Response from a GET Request to a File\n\n```bash\ncurl -o response.txt https://google.com?q=kitties\n```\n\nIn this recipe, curl uses the `-o response.txt` command line option to save the response from a GET request that it makes to `https://google.com?q=kitties` to a file with filename `response.txt`.\n\n## Use the Last Fragment of a URL as the Filename\n\n```bash\ncurl -O https://catonmat.net/ftp/digg.pm\n```\n\n## Use > to store the content\n\n~~~bash\ncurl -s https://domai -XPOST --data \"$JSON_DATA\" --header \"Content-Type: application/json\"  > result.json\n~~~\n\n\n\n# Construct a Query String \n\nThis curl recipe shows you how to construct query strings for your GET requests. This is done via the `-G` command line argument in combination with the `-d` or `--data-urlencode` arguments. The `-G` argument will append the data specified in `-d` and `--data-urlencode` arguments at the end of the request URL, joining all data pieces with the `&` character and separating them from the URL with the `?` character.\n\n### Construct Two Query Arguments\n\n```bash\ncurl -G -d 'q=kitties' -d 'count=20' https://google.com/search\n```\n\nIn this recipe, we let curl construct the query string and the final request URL for us. This recipe uses the `-G` option and the `-d` option twice that creates two query arguments. Curl joins them together like this `q=kitties&count=20` and appends this string at the end of the `https://google.com/search` request URL, and makes a GET request to `https://google.com/search?q=kitties&count=20`. Be careful – if you forget the `-G` argument, then curl will make a POST request instead!\n\n### URL-encode a Query Argument\n\n```bash\ncurl -G --data-urlencode 'comment=this cookbook is awesome' https://catonmat.net\n```\n\nThis recipe uses the `--data-urlencode` argument. It works similar to the `-d` argument but curl also URL-encodes the value. In this recipe, the `comment` gets URL-encoded to `this%20cookbook%20is%20awesome` and the GET request goes to `https://catonmat.net?comment=this%20cookbook%20is%20awesome`.\n\n# Add HTTP Headers\n\nLast updated 1 week ago\n\nThese curl recipes show you how to add custom HTTP headers to curl requests. This is done via the `-H 'Header: Value'` command line argument.\n\n\n## Add a Single Header\n\n```bash\ncurl -H 'Accept-Language: en-US' https://google.com\n```\n\nThis recipe uses the `-H` argument to add `Accept-Language: en-US` header to a GET request to `https://google.com`. This header tells Google to serve the English version of the page.\n\n## Add Two Headers\n\n```bash\ncurl -H 'Accept-Language: en-US' -H 'Secret-Message: xyzzy' https://google.com\n```\n\nThis recipe adds two headers to a GET request to Google. The first header is the same as in the previous recipe and the other one is `Secret-Message: xyzzy`.\n\n## Add an Empty Header\n\n```bash\ncurl -H 'Puppies;' https://google.com\n```\n\nIn this recipe, we add an empty header to a curl request. We pass `Puppies;` (with a semicolon at the end) as an argument to the `-H` option and curl converts it to an empty header `Puppies:` with no value.\n\n\n\n## Use jq\n\n~~~bash\ncurl -s --request POST 'https://$DOMAIN/auth/realms/main/protocol/openid-connect/token' --header 'Content-Type: application/x-www-form-urlencoded' --data-urlencode 'grant_type=client_credentials' --data-urlencode 'client_id=test' | jq -r .access_token)\n~~~\n\n","source":"_posts/network/curl-get-header-etc.md","raw":"---\nuuid: bbaf4813-c0ab-11ec-92a1-7557b2313227\ntitle: curl get\ncategories: Linux\ntags:\n  - curl\nabbrlink: 3d76e967\n---\n\n# GET Request\n\n## Send a GET Request and Print the Response to Screen\n\n```bash\ncurl https://catonmat.net\n```\n\nYou don't need to specify any arguments to make a GET request. It's curl's default request method. This recipe makes a GET request to `https://catonmat.net` and prints the returned content to screen.\n\n## Send a GET Request and Save the Response to a File\n\n```bash\ncurl -o response.txt https://catonmat.net\n```\n\nIn this recipe, curl makes a GET request to `https://catonmat.net` and uses the `-o response.txt` argument to save the body of the HTTP response to `response.txt` file.\n\n# Save the Response to a File\n\nThese curl recipes show you how to save the response from a curl request to a file. By default, curl prints the response to screen. To make it save the response to a file, use the `-o file` command line option.\n\nSave the Response from a GET Request to a File\n\n```bash\ncurl -o response.txt https://google.com?q=kitties\n```\n\nIn this recipe, curl uses the `-o response.txt` command line option to save the response from a GET request that it makes to `https://google.com?q=kitties` to a file with filename `response.txt`.\n\n## Use the Last Fragment of a URL as the Filename\n\n```bash\ncurl -O https://catonmat.net/ftp/digg.pm\n```\n\n## Use > to store the content\n\n~~~bash\ncurl -s https://domai -XPOST --data \"$JSON_DATA\" --header \"Content-Type: application/json\"  > result.json\n~~~\n\n\n\n# Construct a Query String \n\nThis curl recipe shows you how to construct query strings for your GET requests. This is done via the `-G` command line argument in combination with the `-d` or `--data-urlencode` arguments. The `-G` argument will append the data specified in `-d` and `--data-urlencode` arguments at the end of the request URL, joining all data pieces with the `&` character and separating them from the URL with the `?` character.\n\n### Construct Two Query Arguments\n\n```bash\ncurl -G -d 'q=kitties' -d 'count=20' https://google.com/search\n```\n\nIn this recipe, we let curl construct the query string and the final request URL for us. This recipe uses the `-G` option and the `-d` option twice that creates two query arguments. Curl joins them together like this `q=kitties&count=20` and appends this string at the end of the `https://google.com/search` request URL, and makes a GET request to `https://google.com/search?q=kitties&count=20`. Be careful – if you forget the `-G` argument, then curl will make a POST request instead!\n\n### URL-encode a Query Argument\n\n```bash\ncurl -G --data-urlencode 'comment=this cookbook is awesome' https://catonmat.net\n```\n\nThis recipe uses the `--data-urlencode` argument. It works similar to the `-d` argument but curl also URL-encodes the value. In this recipe, the `comment` gets URL-encoded to `this%20cookbook%20is%20awesome` and the GET request goes to `https://catonmat.net?comment=this%20cookbook%20is%20awesome`.\n\n# Add HTTP Headers\n\nLast updated 1 week ago\n\nThese curl recipes show you how to add custom HTTP headers to curl requests. This is done via the `-H 'Header: Value'` command line argument.\n\n\n## Add a Single Header\n\n```bash\ncurl -H 'Accept-Language: en-US' https://google.com\n```\n\nThis recipe uses the `-H` argument to add `Accept-Language: en-US` header to a GET request to `https://google.com`. This header tells Google to serve the English version of the page.\n\n## Add Two Headers\n\n```bash\ncurl -H 'Accept-Language: en-US' -H 'Secret-Message: xyzzy' https://google.com\n```\n\nThis recipe adds two headers to a GET request to Google. The first header is the same as in the previous recipe and the other one is `Secret-Message: xyzzy`.\n\n## Add an Empty Header\n\n```bash\ncurl -H 'Puppies;' https://google.com\n```\n\nIn this recipe, we add an empty header to a curl request. We pass `Puppies;` (with a semicolon at the end) as an argument to the `-H` option and curl converts it to an empty header `Puppies:` with no value.\n\n\n\n## Use jq\n\n~~~bash\ncurl -s --request POST 'https://$DOMAIN/auth/realms/main/protocol/openid-connect/token' --header 'Content-Type: application/x-www-form-urlencoded' --data-urlencode 'grant_type=client_credentials' --data-urlencode 'client_id=test' | jq -r .access_token)\n~~~\n\n","slug":"network/curl-get-header-etc","published":1,"date":"2022-04-20T12:41:20.929Z","updated":"2022-05-04T03:22:02.534Z","_id":"cl2qzfti6004813no9a7k8f86","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"GET-Request\"><a href=\"#GET-Request\" class=\"headerlink\" title=\"GET Request\"></a>GET Request</h1><h2 id=\"Send-a-GET-Request-and-Print-the-Response-to-Screen\"><a href=\"#Send-a-GET-Request-and-Print-the-Response-to-Screen\" class=\"headerlink\" title=\"Send a GET Request and Print the Response to Screen\"></a>Send a GET Request and Print the Response to Screen</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://catonmat.net</span><br></pre></td></tr></table></figure>\n\n<p>You don’t need to specify any arguments to make a GET request. It’s curl’s default request method. This recipe makes a GET request to <code>https://catonmat.net</code> and prints the returned content to screen.</p>\n<h2 id=\"Send-a-GET-Request-and-Save-the-Response-to-a-File\"><a href=\"#Send-a-GET-Request-and-Save-the-Response-to-a-File\" class=\"headerlink\" title=\"Send a GET Request and Save the Response to a File\"></a>Send a GET Request and Save the Response to a File</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o response.txt https://catonmat.net</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, curl makes a GET request to <code>https://catonmat.net</code> and uses the <code>-o response.txt</code> argument to save the body of the HTTP response to <code>response.txt</code> file.</p>\n<h1 id=\"Save-the-Response-to-a-File\"><a href=\"#Save-the-Response-to-a-File\" class=\"headerlink\" title=\"Save the Response to a File\"></a>Save the Response to a File</h1><p>These curl recipes show you how to save the response from a curl request to a file. By default, curl prints the response to screen. To make it save the response to a file, use the <code>-o file</code> command line option.</p>\n<p>Save the Response from a GET Request to a File</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o response.txt https://google.com?q=kitties</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, curl uses the <code>-o response.txt</code> command line option to save the response from a GET request that it makes to <code>https://google.com?q=kitties</code> to a file with filename <code>response.txt</code>.</p>\n<h2 id=\"Use-the-Last-Fragment-of-a-URL-as-the-Filename\"><a href=\"#Use-the-Last-Fragment-of-a-URL-as-the-Filename\" class=\"headerlink\" title=\"Use the Last Fragment of a URL as the Filename\"></a>Use the Last Fragment of a URL as the Filename</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -O https://catonmat.net/ftp/digg.pm</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Use-gt-to-store-the-content\"><a href=\"#Use-gt-to-store-the-content\" class=\"headerlink\" title=\"Use &gt; to store the content\"></a>Use &gt; to store the content</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s https://domai -XPOST --data <span class=\"string\">&quot;<span class=\"variable\">$JSON_DATA</span>&quot;</span> --header <span class=\"string\">&quot;Content-Type: application/json&quot;</span>  &gt; result.json</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"Construct-a-Query-String\"><a href=\"#Construct-a-Query-String\" class=\"headerlink\" title=\"Construct a Query String\"></a>Construct a Query String</h1><p>This curl recipe shows you how to construct query strings for your GET requests. This is done via the <code>-G</code> command line argument in combination with the <code>-d</code> or <code>--data-urlencode</code> arguments. The <code>-G</code> argument will append the data specified in <code>-d</code> and <code>--data-urlencode</code> arguments at the end of the request URL, joining all data pieces with the <code>&amp;</code> character and separating them from the URL with the <code>?</code> character.</p>\n<h3 id=\"Construct-Two-Query-Arguments\"><a href=\"#Construct-Two-Query-Arguments\" class=\"headerlink\" title=\"Construct Two Query Arguments\"></a>Construct Two Query Arguments</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -G -d <span class=\"string\">&#x27;q=kitties&#x27;</span> -d <span class=\"string\">&#x27;count=20&#x27;</span> https://google.com/search</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, we let curl construct the query string and the final request URL for us. This recipe uses the <code>-G</code> option and the <code>-d</code> option twice that creates two query arguments. Curl joins them together like this <code>q=kitties&amp;count=20</code> and appends this string at the end of the <code>https://google.com/search</code> request URL, and makes a GET request to <code>https://google.com/search?q=kitties&amp;count=20</code>. Be careful – if you forget the <code>-G</code> argument, then curl will make a POST request instead!</p>\n<h3 id=\"URL-encode-a-Query-Argument\"><a href=\"#URL-encode-a-Query-Argument\" class=\"headerlink\" title=\"URL-encode a Query Argument\"></a>URL-encode a Query Argument</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -G --data-urlencode <span class=\"string\">&#x27;comment=this cookbook is awesome&#x27;</span> https://catonmat.net</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>--data-urlencode</code> argument. It works similar to the <code>-d</code> argument but curl also URL-encodes the value. In this recipe, the <code>comment</code> gets URL-encoded to <code>this%20cookbook%20is%20awesome</code> and the GET request goes to <code>https://catonmat.net?comment=this%20cookbook%20is%20awesome</code>.</p>\n<h1 id=\"Add-HTTP-Headers\"><a href=\"#Add-HTTP-Headers\" class=\"headerlink\" title=\"Add HTTP Headers\"></a>Add HTTP Headers</h1><p>Last updated 1 week ago</p>\n<p>These curl recipes show you how to add custom HTTP headers to curl requests. This is done via the <code>-H &#39;Header: Value&#39;</code> command line argument.</p>\n<h2 id=\"Add-a-Single-Header\"><a href=\"#Add-a-Single-Header\" class=\"headerlink\" title=\"Add a Single Header\"></a>Add a Single Header</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Accept-Language: en-US&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-H</code> argument to add <code>Accept-Language: en-US</code> header to a GET request to <code>https://google.com</code>. This header tells Google to serve the English version of the page.</p>\n<h2 id=\"Add-Two-Headers\"><a href=\"#Add-Two-Headers\" class=\"headerlink\" title=\"Add Two Headers\"></a>Add Two Headers</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Accept-Language: en-US&#x27;</span> -H <span class=\"string\">&#x27;Secret-Message: xyzzy&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>This recipe adds two headers to a GET request to Google. The first header is the same as in the previous recipe and the other one is <code>Secret-Message: xyzzy</code>.</p>\n<h2 id=\"Add-an-Empty-Header\"><a href=\"#Add-an-Empty-Header\" class=\"headerlink\" title=\"Add an Empty Header\"></a>Add an Empty Header</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Puppies;&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, we add an empty header to a curl request. We pass <code>Puppies;</code> (with a semicolon at the end) as an argument to the <code>-H</code> option and curl converts it to an empty header <code>Puppies:</code> with no value.</p>\n<h2 id=\"Use-jq\"><a href=\"#Use-jq\" class=\"headerlink\" title=\"Use jq\"></a>Use jq</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s --request POST <span class=\"string\">&#x27;https://$DOMAIN/auth/realms/main/protocol/openid-connect/token&#x27;</span> --header <span class=\"string\">&#x27;Content-Type: application/x-www-form-urlencoded&#x27;</span> --data-urlencode <span class=\"string\">&#x27;grant_type=client_credentials&#x27;</span> --data-urlencode <span class=\"string\">&#x27;client_id=test&#x27;</span> | jq -r .access_token)</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"GET-Request\"><a href=\"#GET-Request\" class=\"headerlink\" title=\"GET Request\"></a>GET Request</h1><h2 id=\"Send-a-GET-Request-and-Print-the-Response-to-Screen\"><a href=\"#Send-a-GET-Request-and-Print-the-Response-to-Screen\" class=\"headerlink\" title=\"Send a GET Request and Print the Response to Screen\"></a>Send a GET Request and Print the Response to Screen</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://catonmat.net</span><br></pre></td></tr></table></figure>\n\n<p>You don’t need to specify any arguments to make a GET request. It’s curl’s default request method. This recipe makes a GET request to <code>https://catonmat.net</code> and prints the returned content to screen.</p>\n<h2 id=\"Send-a-GET-Request-and-Save-the-Response-to-a-File\"><a href=\"#Send-a-GET-Request-and-Save-the-Response-to-a-File\" class=\"headerlink\" title=\"Send a GET Request and Save the Response to a File\"></a>Send a GET Request and Save the Response to a File</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o response.txt https://catonmat.net</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, curl makes a GET request to <code>https://catonmat.net</code> and uses the <code>-o response.txt</code> argument to save the body of the HTTP response to <code>response.txt</code> file.</p>\n<h1 id=\"Save-the-Response-to-a-File\"><a href=\"#Save-the-Response-to-a-File\" class=\"headerlink\" title=\"Save the Response to a File\"></a>Save the Response to a File</h1><p>These curl recipes show you how to save the response from a curl request to a file. By default, curl prints the response to screen. To make it save the response to a file, use the <code>-o file</code> command line option.</p>\n<p>Save the Response from a GET Request to a File</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o response.txt https://google.com?q=kitties</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, curl uses the <code>-o response.txt</code> command line option to save the response from a GET request that it makes to <code>https://google.com?q=kitties</code> to a file with filename <code>response.txt</code>.</p>\n<h2 id=\"Use-the-Last-Fragment-of-a-URL-as-the-Filename\"><a href=\"#Use-the-Last-Fragment-of-a-URL-as-the-Filename\" class=\"headerlink\" title=\"Use the Last Fragment of a URL as the Filename\"></a>Use the Last Fragment of a URL as the Filename</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -O https://catonmat.net/ftp/digg.pm</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Use-gt-to-store-the-content\"><a href=\"#Use-gt-to-store-the-content\" class=\"headerlink\" title=\"Use &gt; to store the content\"></a>Use &gt; to store the content</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s https://domai -XPOST --data <span class=\"string\">&quot;<span class=\"variable\">$JSON_DATA</span>&quot;</span> --header <span class=\"string\">&quot;Content-Type: application/json&quot;</span>  &gt; result.json</span><br></pre></td></tr></table></figure>\n\n\n\n<h1 id=\"Construct-a-Query-String\"><a href=\"#Construct-a-Query-String\" class=\"headerlink\" title=\"Construct a Query String\"></a>Construct a Query String</h1><p>This curl recipe shows you how to construct query strings for your GET requests. This is done via the <code>-G</code> command line argument in combination with the <code>-d</code> or <code>--data-urlencode</code> arguments. The <code>-G</code> argument will append the data specified in <code>-d</code> and <code>--data-urlencode</code> arguments at the end of the request URL, joining all data pieces with the <code>&amp;</code> character and separating them from the URL with the <code>?</code> character.</p>\n<h3 id=\"Construct-Two-Query-Arguments\"><a href=\"#Construct-Two-Query-Arguments\" class=\"headerlink\" title=\"Construct Two Query Arguments\"></a>Construct Two Query Arguments</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -G -d <span class=\"string\">&#x27;q=kitties&#x27;</span> -d <span class=\"string\">&#x27;count=20&#x27;</span> https://google.com/search</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, we let curl construct the query string and the final request URL for us. This recipe uses the <code>-G</code> option and the <code>-d</code> option twice that creates two query arguments. Curl joins them together like this <code>q=kitties&amp;count=20</code> and appends this string at the end of the <code>https://google.com/search</code> request URL, and makes a GET request to <code>https://google.com/search?q=kitties&amp;count=20</code>. Be careful – if you forget the <code>-G</code> argument, then curl will make a POST request instead!</p>\n<h3 id=\"URL-encode-a-Query-Argument\"><a href=\"#URL-encode-a-Query-Argument\" class=\"headerlink\" title=\"URL-encode a Query Argument\"></a>URL-encode a Query Argument</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -G --data-urlencode <span class=\"string\">&#x27;comment=this cookbook is awesome&#x27;</span> https://catonmat.net</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>--data-urlencode</code> argument. It works similar to the <code>-d</code> argument but curl also URL-encodes the value. In this recipe, the <code>comment</code> gets URL-encoded to <code>this%20cookbook%20is%20awesome</code> and the GET request goes to <code>https://catonmat.net?comment=this%20cookbook%20is%20awesome</code>.</p>\n<h1 id=\"Add-HTTP-Headers\"><a href=\"#Add-HTTP-Headers\" class=\"headerlink\" title=\"Add HTTP Headers\"></a>Add HTTP Headers</h1><p>Last updated 1 week ago</p>\n<p>These curl recipes show you how to add custom HTTP headers to curl requests. This is done via the <code>-H &#39;Header: Value&#39;</code> command line argument.</p>\n<h2 id=\"Add-a-Single-Header\"><a href=\"#Add-a-Single-Header\" class=\"headerlink\" title=\"Add a Single Header\"></a>Add a Single Header</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Accept-Language: en-US&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-H</code> argument to add <code>Accept-Language: en-US</code> header to a GET request to <code>https://google.com</code>. This header tells Google to serve the English version of the page.</p>\n<h2 id=\"Add-Two-Headers\"><a href=\"#Add-Two-Headers\" class=\"headerlink\" title=\"Add Two Headers\"></a>Add Two Headers</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Accept-Language: en-US&#x27;</span> -H <span class=\"string\">&#x27;Secret-Message: xyzzy&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>This recipe adds two headers to a GET request to Google. The first header is the same as in the previous recipe and the other one is <code>Secret-Message: xyzzy</code>.</p>\n<h2 id=\"Add-an-Empty-Header\"><a href=\"#Add-an-Empty-Header\" class=\"headerlink\" title=\"Add an Empty Header\"></a>Add an Empty Header</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Puppies;&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, we add an empty header to a curl request. We pass <code>Puppies;</code> (with a semicolon at the end) as an argument to the <code>-H</code> option and curl converts it to an empty header <code>Puppies:</code> with no value.</p>\n<h2 id=\"Use-jq\"><a href=\"#Use-jq\" class=\"headerlink\" title=\"Use jq\"></a>Use jq</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s --request POST <span class=\"string\">&#x27;https://$DOMAIN/auth/realms/main/protocol/openid-connect/token&#x27;</span> --header <span class=\"string\">&#x27;Content-Type: application/x-www-form-urlencoded&#x27;</span> --data-urlencode <span class=\"string\">&#x27;grant_type=client_credentials&#x27;</span> --data-urlencode <span class=\"string\">&#x27;client_id=test&#x27;</span> | jq -r .access_token)</span><br></pre></td></tr></table></figure>\n\n"},{"uuid":"bbaf4815-c0ab-11ec-92a1-7557b2313227","title":"cur参数","abbrlink":"44f7453a","_content":"\n# 简介\n\ncurl 是常用的命令行工具，用来请求 Web 服务器。它的名字就是客户端（client）的 URL 工具的意思。\n\n它的功能非常强大，命令行参数多达几十种。如果熟练的话，完全可以取代 Postman 这一类的图形界面工具。\n\n参考：[curl cookbook](https://catonmat.net/cookbooks/curl)\n\n不带有任何参数时，curl 就是发出 GET 请求。\n\n~~~bash\ncurl https://www.baidu.com\n~~~\n\n以上命令向`www.baidu.com`发出GET请求，服务器返回的内容会在命令行输出。\n\n## -A\n\n`-A`参数指定客户端的用户代理标头，即`User—Agent`。curl的默认用户代理字符串是`curl/[version]`。\n\n~~~bash\ncurl -A 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36' https://google.com\n~~~\n\n上面的命令将`User-Agent`改成Chrome浏览器。\n\n~~~bash\ncurl -A '' https://google.com\n~~~\n\n上面命令会移除`User-Agent`标头。也可以通过`-H`参数直接指定标头，更改`User-Agent`。\n\n~~~bash\ncurl -H 'User-Agent: php/1.0' https://google.com\n~~~\n\n## -b\n\n`-b`参数用来向服务器发送 Cookie。\n\n~~~bash\ncurl -b 'foo=bar' https://google.com\n~~~\n\n上面命令会生成一个标头`Cookie: foo=bar`，向服务器发送一个名为`foo`、值为`bar`的 Cookie。\n\n```bash\n curl -b 'foo1=bar;foo2=bar2' https://google.com\n```\n\n上面命令发送两个 Cookie。\n\n```bash\ncurl -b cookies.txt https://www.google.com\n```\n\n上面命令读取本地文件`cookies.txt`，里面是服务器设置的 Cookie（参见`-c`参数），将其发送到服务器。\n\n## -c\n\n`-c`参数将服务器设置的 Cookie 写入一个文件。\n\n```bash\ncurl -c cookies.txt https://www.google.com\n```\n\n上面命令将服务器的 HTTP 回应所设置 Cookie 写入文本文件`cookies.txt`。\n\n## **-d**\n\n`-d`参数用于发送 POST 请求的数据体。\n\n```bash\n$ curl -d 'login=emma＆password=123'-X POST https://google.com/login\n# 或者\n$ curl -d 'login=emma' -d 'password=123' -X POST  https://google.com/login\n```\n\n使用`-d`参数以后，HTTP 请求会自动加上标头`Content-Type : application/x-www-form-urlencoded`。并且会自动将请求转为 POST 方法，因此可以省略`-X POST`。\n\n`-d`参数可以读取本地文本文件的数据，向服务器发送。\n\n```bash\n curl -d '@data.txt' https://google.com/login\n```\n\n上面命令读取`data.txt`文件的内容，作为数据体向服务器发送。\n\n## **--data-urlencode**\n\n`--data-urlencode`参数等同于`-d`，发送 POST 请求的数据体，区别在于会自动将发送的数据进行 URL 编码。\n\n```bash\ncurl --data-urlencode 'comment=hello world' https://google.com/login\n```\n\n上面代码中，发送的数据`hello world`之间有一个空格，需要进行 URL 编码。\n\n## **-e**\n\n`-e`参数用来设置 HTTP 的标头`Referer`，表示请求的来源。\n\n```bash\ncurl -e 'https://google.com?q=example' https://www.example.com\n```\n\n上面命令将`Referer`标头设为`https://google.com?q=example`。\n\n`-H`参数可以通过直接添加标头`Referer`，达到同样效果。\n\n```bash\ncurl -H 'Referer: https://google.com?q=example' https://www.example.com\n```\n\n## **-F**\n\n`-F`参数用来向服务器上传二进制文件。\n\n```bash\ncurl -F 'file=@photo.png' https://google.com/profile\n```\n\n上面命令会给 HTTP 请求加上标头`Content-Type: multipart/form-data`，然后将文件`photo.png`作为`file`字段上传。\n\n`-F`参数可以指定 MIME 类型。\n\n```bash\ncurl -F 'file=@photo.png;type=image/png' https://google.com/profile\n```\n\n上面命令指定 MIME 类型为`image/png`，否则 curl 会把 MIME 类型设为`application/octet-stream`。\n\n`-F`参数也可以指定文件名。\n\n```bash\ncurl -F 'file=@photo.png;filename=me.png' https://google.com/profile\n```\n\n上面命令中，原始文件名为`photo.png`，但是服务器接收到的文件名为`me.png`。\n\n## **-G**\n\n`-G`参数用来构造 URL 的查询字符串。\n\n```bash\ncurl -G -d 'q=kitties' -d 'count=20' https://google.com/search\n```\n\n上面命令会发出一个 GET 请求，实际请求的 URL 为`https://google.com/search?q=kitties&count=20`。如果省略`--G`，会发出一个 POST 请求。\n\n如果数据需要 URL 编码，可以结合`--data--urlencode`参数。\n\n```bash\ncurl -G --data-urlencode 'comment=hello world' https://www.example.com\n```\n\n## **-H**\n\n`-H`参数添加 HTTP 请求的标头。\n\n```bash\ncurl -H 'Accept-Language: en-US' https://google.com\n```\n\n上面命令添加 HTTP 标头`Accept-Language: en-US`。\n\n```bash\ncurl -H 'Accept-Language: en-US' -H 'Secret-Message: xyzzy' https://google.com\n```\n\n上面命令添加两个 HTTP 标头。\n\n```bash\ncurl -d '{\"login\": \"emma\", \"pass\": \"123\"}' -H 'Content-Type: application/json' https://google.com/login\n```\n\n上面命令添加 HTTP 请求的标头是`Content-Type: application/json`，然后用`-d`参数发送 JSON 数据。\n\n## **-i**\n\n`-i`参数打印出服务器回应的 HTTP 标头。\n\n```bash\ncurl -i https://www.example.com\n```\n\n上面命令收到服务器回应后，先输出服务器回应的标头，然后空一行，再输出网页的源码。\n\n## **-I**\n\n`-I`参数向服务器发出 HEAD 请求，然会将服务器返回的 HTTP 标头打印出来。\n\n```bash\n curl -I https://www.example.com\n```\n\n上面命令输出服务器对 HEAD 请求的回应。\n\n`--head`参数等同于`-I`。\n\n```bash\ncurl --head https://www.example.com\n```\n\n## **-k**\n\n`-k`参数指定跳过 SSL 检测。\n\n```bash\ncurl -k https://www.example.com\n```\n\n上面命令不会检查服务器的 SSL 证书是否正确。\n\n## **-L**\n\n`-L`参数会让 HTTP 请求跟随服务器的重定向。curl 默认不跟随重定向。\n\n```bash\ncurl -L -d 'tweet=hi' https://api.twitter.com/tweet\n```\n\n## **--limit-rate**\n\n`--limit-rate`用来限制 HTTP 请求和回应的带宽，模拟慢网速的环境。\n\n```bash\ncurl --limit-rate 200k https://google.com\n```\n\n上面命令将带宽限制在每秒 200K 字节。\n\n## **-o**\n\n`-o`参数将服务器的回应保存成文件，等同于`wget`命令。\n\n```bash\ncurl -o example.html https://www.example.com\n```\n\n## **-O**\n\n`-O`参数将服务器回应保存成文件，并将 URL 的最后部分当作文件名。\n\n```bash\ncurl -O https://www.example.com/foo/bar.html\n```\n\n上面命令将服务器回应保存成文件，文件名为`bar.html`。\n\n## **-s**\n\n`-s`参数将不输出错误和进度信息。\n\n```bash\ncurl -s https://www.example.com\n```\n\n上面命令一旦发生错误，不会显示错误信息。不发生错误的话，会正常显示运行结果。\n\n如果想让 curl 不产生任何输出，可以使用下面的命令。\n\n```bash\ncurl -s -o /dev/null https://google.com\n```\n\n## **-S**\n\n`-S`参数指定只输出错误信息，通常与`-s`一起使用。\n\n```bash\ncurl -s -o /dev/null https://google.com\n```\n\n上面命令没有任何输出，除非发生错误。\n\n## **-u**\n\n`-u`参数用来设置服务器认证的用户名和密码。\n\n```bash\ncurl -u 'bob:12345' https://google.com/login\n```\n\n上面命令设置用户名为`bob`，密码为`12345`，然后将其转为 HTTP 标头`Authorization: Basic Ym9iOjEyMzQ1`。\n\ncurl 能够识别 URL 里面的用户名和密码。\n\n```bash\ncurl https://bob:12345@google.com/login\n```\n\n上面命令能够识别 URL 里面的用户名和密码，将其转为上个例子里面的 HTTP 标头。\n\n```bash\ncurl -u 'bob' https://google.com/login\n```\n\n上面命令只设置了用户名，执行后，curl 会提示用户输入密码。\n\n## **-v**\n\n`-v`参数输出通信的整个过程，用于调试。\n\n```bash\ncurl -v https://www.example.com\n```\n\n`--trace`参数也可以用于调试，还会输出原始的二进制数据。\n\n```bash\ncurl --trace - https://www.example.com\n```\n\n## **-x**\n\n`-x`参数指定 HTTP 请求的代理。\n\n```bash\ncurl -x socks5://james:cats@myproxy.com:8080 https://www.example.com\n```\n\n上面命令指定 HTTP 请求通过`myproxy.com:8080`的 socks5 代理发出。\n\n如果没有指定代理协议，默认为 HTTP。\n\n```bash\n curl -x james:cats@myproxy.com:8080 https://www.example.com\n```\n\n上面命令中，请求的代理使用 HTTP 协议。\n\n## **-X**\n\n`-X`参数指定 HTTP 请求的方法。\n\n```bash\ncurl -X POST https://www.example.com\n```\n\n上面命令对`https://www.example.com`发出 POST 请求。\n","source":"_posts/network/curl参数.md","raw":"---\nuuid: bbaf4815-c0ab-11ec-92a1-7557b2313227\ntitle: cur参数\ncategories: Linux\ntags:\n  - curl\nabbrlink: 44f7453a\n---\n\n# 简介\n\ncurl 是常用的命令行工具，用来请求 Web 服务器。它的名字就是客户端（client）的 URL 工具的意思。\n\n它的功能非常强大，命令行参数多达几十种。如果熟练的话，完全可以取代 Postman 这一类的图形界面工具。\n\n参考：[curl cookbook](https://catonmat.net/cookbooks/curl)\n\n不带有任何参数时，curl 就是发出 GET 请求。\n\n~~~bash\ncurl https://www.baidu.com\n~~~\n\n以上命令向`www.baidu.com`发出GET请求，服务器返回的内容会在命令行输出。\n\n## -A\n\n`-A`参数指定客户端的用户代理标头，即`User—Agent`。curl的默认用户代理字符串是`curl/[version]`。\n\n~~~bash\ncurl -A 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36' https://google.com\n~~~\n\n上面的命令将`User-Agent`改成Chrome浏览器。\n\n~~~bash\ncurl -A '' https://google.com\n~~~\n\n上面命令会移除`User-Agent`标头。也可以通过`-H`参数直接指定标头，更改`User-Agent`。\n\n~~~bash\ncurl -H 'User-Agent: php/1.0' https://google.com\n~~~\n\n## -b\n\n`-b`参数用来向服务器发送 Cookie。\n\n~~~bash\ncurl -b 'foo=bar' https://google.com\n~~~\n\n上面命令会生成一个标头`Cookie: foo=bar`，向服务器发送一个名为`foo`、值为`bar`的 Cookie。\n\n```bash\n curl -b 'foo1=bar;foo2=bar2' https://google.com\n```\n\n上面命令发送两个 Cookie。\n\n```bash\ncurl -b cookies.txt https://www.google.com\n```\n\n上面命令读取本地文件`cookies.txt`，里面是服务器设置的 Cookie（参见`-c`参数），将其发送到服务器。\n\n## -c\n\n`-c`参数将服务器设置的 Cookie 写入一个文件。\n\n```bash\ncurl -c cookies.txt https://www.google.com\n```\n\n上面命令将服务器的 HTTP 回应所设置 Cookie 写入文本文件`cookies.txt`。\n\n## **-d**\n\n`-d`参数用于发送 POST 请求的数据体。\n\n```bash\n$ curl -d 'login=emma＆password=123'-X POST https://google.com/login\n# 或者\n$ curl -d 'login=emma' -d 'password=123' -X POST  https://google.com/login\n```\n\n使用`-d`参数以后，HTTP 请求会自动加上标头`Content-Type : application/x-www-form-urlencoded`。并且会自动将请求转为 POST 方法，因此可以省略`-X POST`。\n\n`-d`参数可以读取本地文本文件的数据，向服务器发送。\n\n```bash\n curl -d '@data.txt' https://google.com/login\n```\n\n上面命令读取`data.txt`文件的内容，作为数据体向服务器发送。\n\n## **--data-urlencode**\n\n`--data-urlencode`参数等同于`-d`，发送 POST 请求的数据体，区别在于会自动将发送的数据进行 URL 编码。\n\n```bash\ncurl --data-urlencode 'comment=hello world' https://google.com/login\n```\n\n上面代码中，发送的数据`hello world`之间有一个空格，需要进行 URL 编码。\n\n## **-e**\n\n`-e`参数用来设置 HTTP 的标头`Referer`，表示请求的来源。\n\n```bash\ncurl -e 'https://google.com?q=example' https://www.example.com\n```\n\n上面命令将`Referer`标头设为`https://google.com?q=example`。\n\n`-H`参数可以通过直接添加标头`Referer`，达到同样效果。\n\n```bash\ncurl -H 'Referer: https://google.com?q=example' https://www.example.com\n```\n\n## **-F**\n\n`-F`参数用来向服务器上传二进制文件。\n\n```bash\ncurl -F 'file=@photo.png' https://google.com/profile\n```\n\n上面命令会给 HTTP 请求加上标头`Content-Type: multipart/form-data`，然后将文件`photo.png`作为`file`字段上传。\n\n`-F`参数可以指定 MIME 类型。\n\n```bash\ncurl -F 'file=@photo.png;type=image/png' https://google.com/profile\n```\n\n上面命令指定 MIME 类型为`image/png`，否则 curl 会把 MIME 类型设为`application/octet-stream`。\n\n`-F`参数也可以指定文件名。\n\n```bash\ncurl -F 'file=@photo.png;filename=me.png' https://google.com/profile\n```\n\n上面命令中，原始文件名为`photo.png`，但是服务器接收到的文件名为`me.png`。\n\n## **-G**\n\n`-G`参数用来构造 URL 的查询字符串。\n\n```bash\ncurl -G -d 'q=kitties' -d 'count=20' https://google.com/search\n```\n\n上面命令会发出一个 GET 请求，实际请求的 URL 为`https://google.com/search?q=kitties&count=20`。如果省略`--G`，会发出一个 POST 请求。\n\n如果数据需要 URL 编码，可以结合`--data--urlencode`参数。\n\n```bash\ncurl -G --data-urlencode 'comment=hello world' https://www.example.com\n```\n\n## **-H**\n\n`-H`参数添加 HTTP 请求的标头。\n\n```bash\ncurl -H 'Accept-Language: en-US' https://google.com\n```\n\n上面命令添加 HTTP 标头`Accept-Language: en-US`。\n\n```bash\ncurl -H 'Accept-Language: en-US' -H 'Secret-Message: xyzzy' https://google.com\n```\n\n上面命令添加两个 HTTP 标头。\n\n```bash\ncurl -d '{\"login\": \"emma\", \"pass\": \"123\"}' -H 'Content-Type: application/json' https://google.com/login\n```\n\n上面命令添加 HTTP 请求的标头是`Content-Type: application/json`，然后用`-d`参数发送 JSON 数据。\n\n## **-i**\n\n`-i`参数打印出服务器回应的 HTTP 标头。\n\n```bash\ncurl -i https://www.example.com\n```\n\n上面命令收到服务器回应后，先输出服务器回应的标头，然后空一行，再输出网页的源码。\n\n## **-I**\n\n`-I`参数向服务器发出 HEAD 请求，然会将服务器返回的 HTTP 标头打印出来。\n\n```bash\n curl -I https://www.example.com\n```\n\n上面命令输出服务器对 HEAD 请求的回应。\n\n`--head`参数等同于`-I`。\n\n```bash\ncurl --head https://www.example.com\n```\n\n## **-k**\n\n`-k`参数指定跳过 SSL 检测。\n\n```bash\ncurl -k https://www.example.com\n```\n\n上面命令不会检查服务器的 SSL 证书是否正确。\n\n## **-L**\n\n`-L`参数会让 HTTP 请求跟随服务器的重定向。curl 默认不跟随重定向。\n\n```bash\ncurl -L -d 'tweet=hi' https://api.twitter.com/tweet\n```\n\n## **--limit-rate**\n\n`--limit-rate`用来限制 HTTP 请求和回应的带宽，模拟慢网速的环境。\n\n```bash\ncurl --limit-rate 200k https://google.com\n```\n\n上面命令将带宽限制在每秒 200K 字节。\n\n## **-o**\n\n`-o`参数将服务器的回应保存成文件，等同于`wget`命令。\n\n```bash\ncurl -o example.html https://www.example.com\n```\n\n## **-O**\n\n`-O`参数将服务器回应保存成文件，并将 URL 的最后部分当作文件名。\n\n```bash\ncurl -O https://www.example.com/foo/bar.html\n```\n\n上面命令将服务器回应保存成文件，文件名为`bar.html`。\n\n## **-s**\n\n`-s`参数将不输出错误和进度信息。\n\n```bash\ncurl -s https://www.example.com\n```\n\n上面命令一旦发生错误，不会显示错误信息。不发生错误的话，会正常显示运行结果。\n\n如果想让 curl 不产生任何输出，可以使用下面的命令。\n\n```bash\ncurl -s -o /dev/null https://google.com\n```\n\n## **-S**\n\n`-S`参数指定只输出错误信息，通常与`-s`一起使用。\n\n```bash\ncurl -s -o /dev/null https://google.com\n```\n\n上面命令没有任何输出，除非发生错误。\n\n## **-u**\n\n`-u`参数用来设置服务器认证的用户名和密码。\n\n```bash\ncurl -u 'bob:12345' https://google.com/login\n```\n\n上面命令设置用户名为`bob`，密码为`12345`，然后将其转为 HTTP 标头`Authorization: Basic Ym9iOjEyMzQ1`。\n\ncurl 能够识别 URL 里面的用户名和密码。\n\n```bash\ncurl https://bob:12345@google.com/login\n```\n\n上面命令能够识别 URL 里面的用户名和密码，将其转为上个例子里面的 HTTP 标头。\n\n```bash\ncurl -u 'bob' https://google.com/login\n```\n\n上面命令只设置了用户名，执行后，curl 会提示用户输入密码。\n\n## **-v**\n\n`-v`参数输出通信的整个过程，用于调试。\n\n```bash\ncurl -v https://www.example.com\n```\n\n`--trace`参数也可以用于调试，还会输出原始的二进制数据。\n\n```bash\ncurl --trace - https://www.example.com\n```\n\n## **-x**\n\n`-x`参数指定 HTTP 请求的代理。\n\n```bash\ncurl -x socks5://james:cats@myproxy.com:8080 https://www.example.com\n```\n\n上面命令指定 HTTP 请求通过`myproxy.com:8080`的 socks5 代理发出。\n\n如果没有指定代理协议，默认为 HTTP。\n\n```bash\n curl -x james:cats@myproxy.com:8080 https://www.example.com\n```\n\n上面命令中，请求的代理使用 HTTP 协议。\n\n## **-X**\n\n`-X`参数指定 HTTP 请求的方法。\n\n```bash\ncurl -X POST https://www.example.com\n```\n\n上面命令对`https://www.example.com`发出 POST 请求。\n","slug":"network/curl参数","published":1,"date":"2022-04-20T12:41:20.924Z","updated":"2022-05-04T03:22:22.627Z","_id":"cl2qzfti7004c13no50hadk03","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h1><p>curl 是常用的命令行工具，用来请求 Web 服务器。它的名字就是客户端（client）的 URL 工具的意思。</p>\n<p>它的功能非常强大，命令行参数多达几十种。如果熟练的话，完全可以取代 Postman 这一类的图形界面工具。</p>\n<p>参考：<a href=\"https://catonmat.net/cookbooks/curl\">curl cookbook</a></p>\n<p>不带有任何参数时，curl 就是发出 GET 请求。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://www.baidu.com</span><br></pre></td></tr></table></figure>\n\n<p>以上命令向<code>www.baidu.com</code>发出GET请求，服务器返回的内容会在命令行输出。</p>\n<h2 id=\"A\"><a href=\"#A\" class=\"headerlink\" title=\"-A\"></a>-A</h2><p><code>-A</code>参数指定客户端的用户代理标头，即<code>User—Agent</code>。curl的默认用户代理字符串是<code>curl/[version]</code>。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -A <span class=\"string\">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面的命令将<code>User-Agent</code>改成Chrome浏览器。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -A <span class=\"string\">&#x27;&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令会移除<code>User-Agent</code>标头。也可以通过<code>-H</code>参数直接指定标头，更改<code>User-Agent</code>。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;User-Agent: php/1.0&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"b\"><a href=\"#b\" class=\"headerlink\" title=\"-b\"></a>-b</h2><p><code>-b</code>参数用来向服务器发送 Cookie。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -b <span class=\"string\">&#x27;foo=bar&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令会生成一个标头<code>Cookie: foo=bar</code>，向服务器发送一个名为<code>foo</code>、值为<code>bar</code>的 Cookie。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -b <span class=\"string\">&#x27;foo1=bar;foo2=bar2&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令发送两个 Cookie。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -b cookies.txt https://www.google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令读取本地文件<code>cookies.txt</code>，里面是服务器设置的 Cookie（参见<code>-c</code>参数），将其发送到服务器。</p>\n<h2 id=\"c\"><a href=\"#c\" class=\"headerlink\" title=\"-c\"></a>-c</h2><p><code>-c</code>参数将服务器设置的 Cookie 写入一个文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -c cookies.txt https://www.google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令将服务器的 HTTP 回应所设置 Cookie 写入文本文件<code>cookies.txt</code>。</p>\n<h2 id=\"d\"><a href=\"#d\" class=\"headerlink\" title=\"-d\"></a><strong>-d</strong></h2><p><code>-d</code>参数用于发送 POST 请求的数据体。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ curl -d <span class=\"string\">&#x27;login=emma＆password=123&#x27;</span>-X POST https://google.com/login</span><br><span class=\"line\"><span class=\"comment\"># 或者</span></span><br><span class=\"line\">$ curl -d <span class=\"string\">&#x27;login=emma&#x27;</span> -d <span class=\"string\">&#x27;password=123&#x27;</span> -X POST  https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>-d</code>参数以后，HTTP 请求会自动加上标头<code>Content-Type : application/x-www-form-urlencoded</code>。并且会自动将请求转为 POST 方法，因此可以省略<code>-X POST</code>。</p>\n<p><code>-d</code>参数可以读取本地文本文件的数据，向服务器发送。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;@data.txt&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面命令读取<code>data.txt</code>文件的内容，作为数据体向服务器发送。</p>\n<h2 id=\"–data-urlencode\"><a href=\"#–data-urlencode\" class=\"headerlink\" title=\"–data-urlencode\"></a><strong>–data-urlencode</strong></h2><p><code>--data-urlencode</code>参数等同于<code>-d</code>，发送 POST 请求的数据体，区别在于会自动将发送的数据进行 URL 编码。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --data-urlencode <span class=\"string\">&#x27;comment=hello world&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面代码中，发送的数据<code>hello world</code>之间有一个空格，需要进行 URL 编码。</p>\n<h2 id=\"e\"><a href=\"#e\" class=\"headerlink\" title=\"-e\"></a><strong>-e</strong></h2><p><code>-e</code>参数用来设置 HTTP 的标头<code>Referer</code>，表示请求的来源。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -e <span class=\"string\">&#x27;https://google.com?q=example&#x27;</span> https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令将<code>Referer</code>标头设为<code>https://google.com?q=example</code>。</p>\n<p><code>-H</code>参数可以通过直接添加标头<code>Referer</code>，达到同样效果。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Referer: https://google.com?q=example&#x27;</span> https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"F\"><a href=\"#F\" class=\"headerlink\" title=\"-F\"></a><strong>-F</strong></h2><p><code>-F</code>参数用来向服务器上传二进制文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F <span class=\"string\">&#x27;file=@photo.png&#x27;</span> https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>上面命令会给 HTTP 请求加上标头<code>Content-Type: multipart/form-data</code>，然后将文件<code>photo.png</code>作为<code>file</code>字段上传。</p>\n<p><code>-F</code>参数可以指定 MIME 类型。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F <span class=\"string\">&#x27;file=@photo.png;type=image/png&#x27;</span> https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>上面命令指定 MIME 类型为<code>image/png</code>，否则 curl 会把 MIME 类型设为<code>application/octet-stream</code>。</p>\n<p><code>-F</code>参数也可以指定文件名。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F <span class=\"string\">&#x27;file=@photo.png;filename=me.png&#x27;</span> https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>上面命令中，原始文件名为<code>photo.png</code>，但是服务器接收到的文件名为<code>me.png</code>。</p>\n<h2 id=\"G\"><a href=\"#G\" class=\"headerlink\" title=\"-G\"></a><strong>-G</strong></h2><p><code>-G</code>参数用来构造 URL 的查询字符串。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -G -d <span class=\"string\">&#x27;q=kitties&#x27;</span> -d <span class=\"string\">&#x27;count=20&#x27;</span> https://google.com/search</span><br></pre></td></tr></table></figure>\n\n<p>上面命令会发出一个 GET 请求，实际请求的 URL 为<code>https://google.com/search?q=kitties&amp;count=20</code>。如果省略<code>--G</code>，会发出一个 POST 请求。</p>\n<p>如果数据需要 URL 编码，可以结合<code>--data--urlencode</code>参数。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -G --data-urlencode <span class=\"string\">&#x27;comment=hello world&#x27;</span> https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"H\"><a href=\"#H\" class=\"headerlink\" title=\"-H\"></a><strong>-H</strong></h2><p><code>-H</code>参数添加 HTTP 请求的标头。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Accept-Language: en-US&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令添加 HTTP 标头<code>Accept-Language: en-US</code>。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Accept-Language: en-US&#x27;</span> -H <span class=\"string\">&#x27;Secret-Message: xyzzy&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令添加两个 HTTP 标头。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;&#123;&quot;login&quot;: &quot;emma&quot;, &quot;pass&quot;: &quot;123&quot;&#125;&#x27;</span> -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面命令添加 HTTP 请求的标头是<code>Content-Type: application/json</code>，然后用<code>-d</code>参数发送 JSON 数据。</p>\n<h2 id=\"i\"><a href=\"#i\" class=\"headerlink\" title=\"-i\"></a><strong>-i</strong></h2><p><code>-i</code>参数打印出服务器回应的 HTTP 标头。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -i https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令收到服务器回应后，先输出服务器回应的标头，然后空一行，再输出网页的源码。</p>\n<h2 id=\"I\"><a href=\"#I\" class=\"headerlink\" title=\"-I\"></a><strong>-I</strong></h2><p><code>-I</code>参数向服务器发出 HEAD 请求，然会将服务器返回的 HTTP 标头打印出来。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -I https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令输出服务器对 HEAD 请求的回应。</p>\n<p><code>--head</code>参数等同于<code>-I</code>。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --<span class=\"built_in\">head</span> https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"k\"><a href=\"#k\" class=\"headerlink\" title=\"-k\"></a><strong>-k</strong></h2><p><code>-k</code>参数指定跳过 SSL 检测。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -k https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令不会检查服务器的 SSL 证书是否正确。</p>\n<h2 id=\"L\"><a href=\"#L\" class=\"headerlink\" title=\"-L\"></a><strong>-L</strong></h2><p><code>-L</code>参数会让 HTTP 请求跟随服务器的重定向。curl 默认不跟随重定向。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L -d <span class=\"string\">&#x27;tweet=hi&#x27;</span> https://api.twitter.com/tweet</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"–limit-rate\"><a href=\"#–limit-rate\" class=\"headerlink\" title=\"–limit-rate\"></a><strong>–limit-rate</strong></h2><p><code>--limit-rate</code>用来限制 HTTP 请求和回应的带宽，模拟慢网速的环境。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --limit-rate 200k https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令将带宽限制在每秒 200K 字节。</p>\n<h2 id=\"o\"><a href=\"#o\" class=\"headerlink\" title=\"-o\"></a><strong>-o</strong></h2><p><code>-o</code>参数将服务器的回应保存成文件，等同于<code>wget</code>命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o example.html https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"O\"><a href=\"#O\" class=\"headerlink\" title=\"-O\"></a><strong>-O</strong></h2><p><code>-O</code>参数将服务器回应保存成文件，并将 URL 的最后部分当作文件名。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -O https://www.example.com/foo/bar.html</span><br></pre></td></tr></table></figure>\n\n<p>上面命令将服务器回应保存成文件，文件名为<code>bar.html</code>。</p>\n<h2 id=\"s\"><a href=\"#s\" class=\"headerlink\" title=\"-s\"></a><strong>-s</strong></h2><p><code>-s</code>参数将不输出错误和进度信息。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令一旦发生错误，不会显示错误信息。不发生错误的话，会正常显示运行结果。</p>\n<p>如果想让 curl 不产生任何输出，可以使用下面的命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s -o /dev/null https://google.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"S\"><a href=\"#S\" class=\"headerlink\" title=\"-S\"></a><strong>-S</strong></h2><p><code>-S</code>参数指定只输出错误信息，通常与<code>-s</code>一起使用。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s -o /dev/null https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令没有任何输出，除非发生错误。</p>\n<h2 id=\"u\"><a href=\"#u\" class=\"headerlink\" title=\"-u\"></a><strong>-u</strong></h2><p><code>-u</code>参数用来设置服务器认证的用户名和密码。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -u <span class=\"string\">&#x27;bob:12345&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面命令设置用户名为<code>bob</code>，密码为<code>12345</code>，然后将其转为 HTTP 标头<code>Authorization: Basic Ym9iOjEyMzQ1</code>。</p>\n<p>curl 能够识别 URL 里面的用户名和密码。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://bob:12345@google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面命令能够识别 URL 里面的用户名和密码，将其转为上个例子里面的 HTTP 标头。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -u <span class=\"string\">&#x27;bob&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面命令只设置了用户名，执行后，curl 会提示用户输入密码。</p>\n<h2 id=\"v\"><a href=\"#v\" class=\"headerlink\" title=\"-v\"></a><strong>-v</strong></h2><p><code>-v</code>参数输出通信的整个过程，用于调试。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -v https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p><code>--trace</code>参数也可以用于调试，还会输出原始的二进制数据。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --trace - https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"x\"><a href=\"#x\" class=\"headerlink\" title=\"-x\"></a><strong>-x</strong></h2><p><code>-x</code>参数指定 HTTP 请求的代理。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -x socks5://james:cats@myproxy.com:8080 https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令指定 HTTP 请求通过<code>myproxy.com:8080</code>的 socks5 代理发出。</p>\n<p>如果没有指定代理协议，默认为 HTTP。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -x james:cats@myproxy.com:8080 https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令中，请求的代理使用 HTTP 协议。</p>\n<h2 id=\"X\"><a href=\"#X\" class=\"headerlink\" title=\"-X\"></a><strong>-X</strong></h2><p><code>-X</code>参数指定 HTTP 请求的方法。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令对<code>https://www.example.com</code>发出 POST 请求。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h1><p>curl 是常用的命令行工具，用来请求 Web 服务器。它的名字就是客户端（client）的 URL 工具的意思。</p>\n<p>它的功能非常强大，命令行参数多达几十种。如果熟练的话，完全可以取代 Postman 这一类的图形界面工具。</p>\n<p>参考：<a href=\"https://catonmat.net/cookbooks/curl\">curl cookbook</a></p>\n<p>不带有任何参数时，curl 就是发出 GET 请求。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://www.baidu.com</span><br></pre></td></tr></table></figure>\n\n<p>以上命令向<code>www.baidu.com</code>发出GET请求，服务器返回的内容会在命令行输出。</p>\n<h2 id=\"A\"><a href=\"#A\" class=\"headerlink\" title=\"-A\"></a>-A</h2><p><code>-A</code>参数指定客户端的用户代理标头，即<code>User—Agent</code>。curl的默认用户代理字符串是<code>curl/[version]</code>。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -A <span class=\"string\">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面的命令将<code>User-Agent</code>改成Chrome浏览器。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -A <span class=\"string\">&#x27;&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令会移除<code>User-Agent</code>标头。也可以通过<code>-H</code>参数直接指定标头，更改<code>User-Agent</code>。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;User-Agent: php/1.0&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"b\"><a href=\"#b\" class=\"headerlink\" title=\"-b\"></a>-b</h2><p><code>-b</code>参数用来向服务器发送 Cookie。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -b <span class=\"string\">&#x27;foo=bar&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令会生成一个标头<code>Cookie: foo=bar</code>，向服务器发送一个名为<code>foo</code>、值为<code>bar</code>的 Cookie。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -b <span class=\"string\">&#x27;foo1=bar;foo2=bar2&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令发送两个 Cookie。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -b cookies.txt https://www.google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令读取本地文件<code>cookies.txt</code>，里面是服务器设置的 Cookie（参见<code>-c</code>参数），将其发送到服务器。</p>\n<h2 id=\"c\"><a href=\"#c\" class=\"headerlink\" title=\"-c\"></a>-c</h2><p><code>-c</code>参数将服务器设置的 Cookie 写入一个文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -c cookies.txt https://www.google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令将服务器的 HTTP 回应所设置 Cookie 写入文本文件<code>cookies.txt</code>。</p>\n<h2 id=\"d\"><a href=\"#d\" class=\"headerlink\" title=\"-d\"></a><strong>-d</strong></h2><p><code>-d</code>参数用于发送 POST 请求的数据体。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ curl -d <span class=\"string\">&#x27;login=emma＆password=123&#x27;</span>-X POST https://google.com/login</span><br><span class=\"line\"><span class=\"comment\"># 或者</span></span><br><span class=\"line\">$ curl -d <span class=\"string\">&#x27;login=emma&#x27;</span> -d <span class=\"string\">&#x27;password=123&#x27;</span> -X POST  https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>-d</code>参数以后，HTTP 请求会自动加上标头<code>Content-Type : application/x-www-form-urlencoded</code>。并且会自动将请求转为 POST 方法，因此可以省略<code>-X POST</code>。</p>\n<p><code>-d</code>参数可以读取本地文本文件的数据，向服务器发送。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;@data.txt&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面命令读取<code>data.txt</code>文件的内容，作为数据体向服务器发送。</p>\n<h2 id=\"–data-urlencode\"><a href=\"#–data-urlencode\" class=\"headerlink\" title=\"–data-urlencode\"></a><strong>–data-urlencode</strong></h2><p><code>--data-urlencode</code>参数等同于<code>-d</code>，发送 POST 请求的数据体，区别在于会自动将发送的数据进行 URL 编码。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --data-urlencode <span class=\"string\">&#x27;comment=hello world&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面代码中，发送的数据<code>hello world</code>之间有一个空格，需要进行 URL 编码。</p>\n<h2 id=\"e\"><a href=\"#e\" class=\"headerlink\" title=\"-e\"></a><strong>-e</strong></h2><p><code>-e</code>参数用来设置 HTTP 的标头<code>Referer</code>，表示请求的来源。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -e <span class=\"string\">&#x27;https://google.com?q=example&#x27;</span> https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令将<code>Referer</code>标头设为<code>https://google.com?q=example</code>。</p>\n<p><code>-H</code>参数可以通过直接添加标头<code>Referer</code>，达到同样效果。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Referer: https://google.com?q=example&#x27;</span> https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"F\"><a href=\"#F\" class=\"headerlink\" title=\"-F\"></a><strong>-F</strong></h2><p><code>-F</code>参数用来向服务器上传二进制文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F <span class=\"string\">&#x27;file=@photo.png&#x27;</span> https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>上面命令会给 HTTP 请求加上标头<code>Content-Type: multipart/form-data</code>，然后将文件<code>photo.png</code>作为<code>file</code>字段上传。</p>\n<p><code>-F</code>参数可以指定 MIME 类型。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F <span class=\"string\">&#x27;file=@photo.png;type=image/png&#x27;</span> https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>上面命令指定 MIME 类型为<code>image/png</code>，否则 curl 会把 MIME 类型设为<code>application/octet-stream</code>。</p>\n<p><code>-F</code>参数也可以指定文件名。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F <span class=\"string\">&#x27;file=@photo.png;filename=me.png&#x27;</span> https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>上面命令中，原始文件名为<code>photo.png</code>，但是服务器接收到的文件名为<code>me.png</code>。</p>\n<h2 id=\"G\"><a href=\"#G\" class=\"headerlink\" title=\"-G\"></a><strong>-G</strong></h2><p><code>-G</code>参数用来构造 URL 的查询字符串。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -G -d <span class=\"string\">&#x27;q=kitties&#x27;</span> -d <span class=\"string\">&#x27;count=20&#x27;</span> https://google.com/search</span><br></pre></td></tr></table></figure>\n\n<p>上面命令会发出一个 GET 请求，实际请求的 URL 为<code>https://google.com/search?q=kitties&amp;count=20</code>。如果省略<code>--G</code>，会发出一个 POST 请求。</p>\n<p>如果数据需要 URL 编码，可以结合<code>--data--urlencode</code>参数。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -G --data-urlencode <span class=\"string\">&#x27;comment=hello world&#x27;</span> https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"H\"><a href=\"#H\" class=\"headerlink\" title=\"-H\"></a><strong>-H</strong></h2><p><code>-H</code>参数添加 HTTP 请求的标头。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Accept-Language: en-US&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令添加 HTTP 标头<code>Accept-Language: en-US</code>。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H <span class=\"string\">&#x27;Accept-Language: en-US&#x27;</span> -H <span class=\"string\">&#x27;Secret-Message: xyzzy&#x27;</span> https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令添加两个 HTTP 标头。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;&#123;&quot;login&quot;: &quot;emma&quot;, &quot;pass&quot;: &quot;123&quot;&#125;&#x27;</span> -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面命令添加 HTTP 请求的标头是<code>Content-Type: application/json</code>，然后用<code>-d</code>参数发送 JSON 数据。</p>\n<h2 id=\"i\"><a href=\"#i\" class=\"headerlink\" title=\"-i\"></a><strong>-i</strong></h2><p><code>-i</code>参数打印出服务器回应的 HTTP 标头。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -i https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令收到服务器回应后，先输出服务器回应的标头，然后空一行，再输出网页的源码。</p>\n<h2 id=\"I\"><a href=\"#I\" class=\"headerlink\" title=\"-I\"></a><strong>-I</strong></h2><p><code>-I</code>参数向服务器发出 HEAD 请求，然会将服务器返回的 HTTP 标头打印出来。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -I https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令输出服务器对 HEAD 请求的回应。</p>\n<p><code>--head</code>参数等同于<code>-I</code>。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --<span class=\"built_in\">head</span> https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"k\"><a href=\"#k\" class=\"headerlink\" title=\"-k\"></a><strong>-k</strong></h2><p><code>-k</code>参数指定跳过 SSL 检测。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -k https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令不会检查服务器的 SSL 证书是否正确。</p>\n<h2 id=\"L\"><a href=\"#L\" class=\"headerlink\" title=\"-L\"></a><strong>-L</strong></h2><p><code>-L</code>参数会让 HTTP 请求跟随服务器的重定向。curl 默认不跟随重定向。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L -d <span class=\"string\">&#x27;tweet=hi&#x27;</span> https://api.twitter.com/tweet</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"–limit-rate\"><a href=\"#–limit-rate\" class=\"headerlink\" title=\"–limit-rate\"></a><strong>–limit-rate</strong></h2><p><code>--limit-rate</code>用来限制 HTTP 请求和回应的带宽，模拟慢网速的环境。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --limit-rate 200k https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令将带宽限制在每秒 200K 字节。</p>\n<h2 id=\"o\"><a href=\"#o\" class=\"headerlink\" title=\"-o\"></a><strong>-o</strong></h2><p><code>-o</code>参数将服务器的回应保存成文件，等同于<code>wget</code>命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -o example.html https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"O\"><a href=\"#O\" class=\"headerlink\" title=\"-O\"></a><strong>-O</strong></h2><p><code>-O</code>参数将服务器回应保存成文件，并将 URL 的最后部分当作文件名。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -O https://www.example.com/foo/bar.html</span><br></pre></td></tr></table></figure>\n\n<p>上面命令将服务器回应保存成文件，文件名为<code>bar.html</code>。</p>\n<h2 id=\"s\"><a href=\"#s\" class=\"headerlink\" title=\"-s\"></a><strong>-s</strong></h2><p><code>-s</code>参数将不输出错误和进度信息。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令一旦发生错误，不会显示错误信息。不发生错误的话，会正常显示运行结果。</p>\n<p>如果想让 curl 不产生任何输出，可以使用下面的命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s -o /dev/null https://google.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"S\"><a href=\"#S\" class=\"headerlink\" title=\"-S\"></a><strong>-S</strong></h2><p><code>-S</code>参数指定只输出错误信息，通常与<code>-s</code>一起使用。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -s -o /dev/null https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令没有任何输出，除非发生错误。</p>\n<h2 id=\"u\"><a href=\"#u\" class=\"headerlink\" title=\"-u\"></a><strong>-u</strong></h2><p><code>-u</code>参数用来设置服务器认证的用户名和密码。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -u <span class=\"string\">&#x27;bob:12345&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面命令设置用户名为<code>bob</code>，密码为<code>12345</code>，然后将其转为 HTTP 标头<code>Authorization: Basic Ym9iOjEyMzQ1</code>。</p>\n<p>curl 能够识别 URL 里面的用户名和密码。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://bob:12345@google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面命令能够识别 URL 里面的用户名和密码，将其转为上个例子里面的 HTTP 标头。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -u <span class=\"string\">&#x27;bob&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>上面命令只设置了用户名，执行后，curl 会提示用户输入密码。</p>\n<h2 id=\"v\"><a href=\"#v\" class=\"headerlink\" title=\"-v\"></a><strong>-v</strong></h2><p><code>-v</code>参数输出通信的整个过程，用于调试。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -v https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p><code>--trace</code>参数也可以用于调试，还会输出原始的二进制数据。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --trace - https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"x\"><a href=\"#x\" class=\"headerlink\" title=\"-x\"></a><strong>-x</strong></h2><p><code>-x</code>参数指定 HTTP 请求的代理。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -x socks5://james:cats@myproxy.com:8080 https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令指定 HTTP 请求通过<code>myproxy.com:8080</code>的 socks5 代理发出。</p>\n<p>如果没有指定代理协议，默认为 HTTP。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -x james:cats@myproxy.com:8080 https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令中，请求的代理使用 HTTP 协议。</p>\n<h2 id=\"X\"><a href=\"#X\" class=\"headerlink\" title=\"-X\"></a><strong>-X</strong></h2><p><code>-X</code>参数指定 HTTP 请求的方法。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST https://www.example.com</span><br></pre></td></tr></table></figure>\n\n<p>上面命令对<code>https://www.example.com</code>发出 POST 请求。</p>\n"},{"uuid":"bbaf4816-c0ab-11ec-92a1-7557b2313227","title":"configurationProperties解析","abbrlink":"1fdc0995","_content":"\nspring boot configuration properties解析\n\n项目中我们一般通过`@Value`来获取application.yaml或application.yaml文件中配置的属性值来配置到bean对象中，一般这种对于单个或几个会比较合适。如果属性很多，这样配置很不方便。关于@Value，之前我们有讲到过，这里主要说另外一个`@ConfigurationProperties`主角，它能绑定多个值到一个对象上。\n\n### 官方文档说明\n\n```\nAnnotation for externalized configuration. Add this to a class definition or a\n{@code @Bean} method in a {@code @Configuration} class if you want to bind and validate\n some external Properties (e.g. from a .properties file).\n <p>\nBinding is either performed by calling setters on the annotated class or, if\n{@link ConstructorBinding @ConstructorBinding} is in use, by binding to the constructor\n parameters.\n <p>\n Note that contrary to {@code @Value}, SpEL expressions are not evaluated since property\n values are externalized.\n```\n\n对于官方的文档，主要说了这几点意思。\n\n- 外部化配置的注解。主要用在一个类上或者标注有`@Configuration`类中`@Bean`方法上\n- 能够绑定外部化属性，同时也能够对属性进行校验\n- 绑定的过程要么是通过类属性的setters方法，要么通过`@ConstructorBinding`绑定都构造方法的参数上\n- 和`@Value`的区别就是不支持SpEL表达式\n\n### 实例\n\n**application.yaml**\n\n```yaml\ncar:\n  name: BMW\n  price: 30.50\n#  buyDate: 2021-10-22\n```\n\n#### 1、通过class进行进行绑定\n\n方式一，结合`@EnableConfigurationProperties`使用\n\n```java\n@Data\n@ConfigurationProperties(prefix = \"car\")\npublic class Car {\n    private String name;\n    private Double price;\n    private Date buyDate;\n}\n\n@Configuration\n@EnableConfigurationProperties(Car.class)\npublic class Config {\n    \n}\n```\n\n方式二，直接在类上标注`@Component`注解\n\n```java\n@Data\n@Component\n@ConfigurationProperties(prefix = \"car\")\npublic class Car {\n    private String name;\n    private Double price;\n    private Date buyDate;\n}\n```\n\n#### 2、通过@Bean方式进行绑定\n\n```java\n@Bean\n@ConfigurationProperties(prefix = \"car\")\npublic Car car(){\n  return new Car();\n}\n```\n\n#### 3、通过@ConstructorBinding进行绑定\n\n默认的属性绑定是通过setter方法进行，如果使用构造方法可以进行绑定。当然以前的版本都是使用`@Configuration`和`@ConfigurationProperties`进行配置的，如果使用`@ConstructorBinding`\n\n只需要在类上加上`@ConfigurationProperties`和`@ConstructorBinding`,同时在启动类上加上`@ConfigurationPropertiesScan`即可。**这里的boot版本是2.2.0以后**\n\n```java\n@Data\n@ConfigurationProperties(prefix = \"car\")\n@ConstructorBinding\n@SuppressWarnings(\"all\")\npublic class Car {\n    private String name;\n    private Double price;\n    private Date buyDate;\n\n    public Car(String name, Double price, Date buyDate) {\n        // 这里会打印出名字\n        System.out.println(\"constructor: \" + name);\n        this.name = name;\n        this.price = price;\n        this.buyDate = buyDate;\n    }\n\n    public void setName(String name) {\n        System.out.println(\"setter: \" + name);\n        this.name = name;\n    }\n}\n\n@SpringBootApplication\n@ConfigurationPropertiesScan\npublic class SpringbootTestApplication {\n\n    @Autowired\n    Car car;\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringbootTestApplication.class, args);\n    }\n\n}\n```\n\n### 原理\n\n> Springboot verion 2.5.2\n\n熟悉spring的应该知道，对spring bean的的生命周期流程涉及到的类有`BeanFactoryPostProcessor`和`BeanPostProcessor`。这里对`ConfigurationProperties`进行属性绑定的就是`ConfigurationPropertiesBindingPostProcessor`这个`BeanPostProcessor`,它**被框架添加到容器**，用于\n\n解析`bean`组件上的注解`@ConfigurationProperties`,将属性源中的属性设置到`bean`组件中。\n\n> ```\n> ConfigurationPropertiesBindingPostProcessor`所在包为: `org.springframework.boot.context.properties`\n> ```\n\n#### 1、引入到容器\n\n在idea中查看`ConfigurationPropertiesBindingPostProcessor`类的引用关系依次是：\n\n> EnableConfigurationPropertiesRegistrar\n\n```java\n// EnableConfigurationPropertiesRegistrar\nstatic void registerInfrastructureBeans(BeanDefinitionRegistry registry) {\n\t\tConfigurationPropertiesBindingPostProcessor.register(registry);\n\t\tBoundConfigurationProperties.register(registry);\n}\n```\n\n> EnableConfigurationProperties\n\n```java\n@Import(EnableConfigurationPropertiesRegistrar.class)\npublic @interface EnableConfigurationProperties {\n\n\t/**\n\t * The bean name of the configuration properties validator.\n\t * @since 2.2.0\n\t */\n\tString VALIDATOR_BEAN_NAME = \"configurationPropertiesValidator\";\n\n\t/**\n\t * Convenient way to quickly register\n\t * {@link ConfigurationProperties @ConfigurationProperties} annotated beans with\n\t * Spring. Standard Spring Beans will also be scanned regardless of this value.\n\t * @return {@code @ConfigurationProperties} annotated beans to register\n\t */\n\tClass<?>[] value() default {};\n\n}\n```\n\n> spring-boot-autoconfigure-2.5.2.jar\n\n**spring.factories**\n\n```\norg.springframework.boot.autoconfigure.EnableAutoConfiguration=\\\norg.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\\\n```\n\n>ConfigurationPropertiesAutoConfiguration\n\n```java\n@Configuration(\n    proxyBeanMethods = false\n)\n@EnableConfigurationProperties\npublic class ConfigurationPropertiesAutoConfiguration {\n    public ConfigurationPropertiesAutoConfiguration() {\n    }\n}\n```\n\n由此总结出springboot启动后会自动把`ConfigurationPropertiesBindingPostProcessor`配置ioc容器中。\n\n#### 2、初始化自生的属性\n\n`ConfigurationPropertiesAutoConfiguration`实现了`BeanPostProcessor`、`ApplicationContextAware`、\n\n`InitializingBean`,在实现的方法中依次初始化了三个属性\n\n```java\n// 应用上下文\nprivate ApplicationContext applicationContext;\n\n// bean注册工厂，实例为AutowireCapableBeanFactory\nprivate BeanDefinitionRegistry registry;\n\n// 处理@ConfigurationProperties属性的具体绑定工作\nprivate ConfigurationPropertiesBinder binder;\n```\n\n#### 3、处理属性绑定工作\n\n大致步骤，先获取是否是**ConfigurationPropertiesBean**，然后进行具体绑定工作\n\n```java\n// 步骤1 执行BeanPostProcessor的postProcessBeforeInitialization\n@Override\npublic Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n  // 通过bean和beanName\n  // 获取ConfigurationProperties类型的ConfigurationPropertiesBean\n  bind(ConfigurationPropertiesBean.get(this.applicationContext, bean, beanName));\n  return bean;\n}\n\n// 步骤2\nprivate void bind(ConfigurationPropertiesBean bean) {\n  // 判断是否为空和属性是否绑定\n\t\tif (bean == null || hasBoundValueObject(bean.getName())) {\n\t\t\treturn;\n\t\t}\n\t\tAssert.state(bean.getBindMethod() == BindMethod.JAVA_BEAN, \"Cannot bind @ConfigurationProperties for bean '\"\n\t\t\t\t+ bean.getName() + \"'. Ensure that @ConstructorBinding has not been applied to regular bean\");\n\t\ttry {\n      // ConfigurationPropertiesBinder#bind()\n\t\t\tthis.binder.bind(bean);\n\t\t}\n\t\tcatch (Exception ex) {\n\t\t\tthrow new ConfigurationPropertiesBindException(bean, ex);\n\t\t}\n\t}\n\nprivate boolean hasBoundValueObject(String beanName) {\n\t\treturn this.registry.containsBeanDefinition(beanName) && this.registry\n\t\t\t\t.getBeanDefinition(beanName) instanceof ConfigurationPropertiesValueObjectBeanDefinition;\n}\n```\n\n**ConfigurationPropertiesBinder#bind()**\n\n```java\nBindResult<?> bind(ConfigurationPropertiesBean propertiesBean) {\n  Bindable<?> target = propertiesBean.asBindTarget();\n  ConfigurationProperties annotation = propertiesBean.getAnnotation();\n  // 执行下面的方法\n  BindHandler bindHandler = getBindHandler(target, annotation);\n  // 该binder里面包含了所有的环境变量的配置数据\n  // 然后利用Properties配置bean\n  return getBinder().bind(annotation.prefix(), target, bindHandler);\n}\n\nprivate <T> BindHandler getBindHandler(Bindable<T> target, ConfigurationProperties annotation) {\n  // 获取Validators\n  List<Validator> validators = getValidators(target);\n  BindHandler handler = getHandler();\n  handler = new ConfigurationPropertiesBindHander(handler);\n  if (annotation.ignoreInvalidFields()) {\n    handler = new IgnoreErrorsBindHandler(handler);\n  }\n  if (!annotation.ignoreUnknownFields()) {\n    UnboundElementsSourceFilter filter = new UnboundElementsSourceFilter();\n    handler = new NoUnboundElementsBindHandler(handler, filter);\n  }\n  // 如果校验器不为空，则进行校验\n  if (!validators.isEmpty()) {\n    handler = new ValidationBindHandler(handler, validators.toArray(new Validator[0]));\n  }\n  for (ConfigurationPropertiesBindHandlerAdvisor advisor : getBindHandlerAdvisors()) {\n    handler = advisor.apply(handler);\n  }\n  return handler;\n}\n\n// 对属性进行校验的验证器\nprivate List<Validator> getValidators(Bindable<?> target) {\n  List<Validator> validators = new ArrayList<>(3);\n  if (this.configurationPropertiesValidator != null) {\n    validators.add(this.configurationPropertiesValidator);\n  }\n  // 如果引入了jsr303(例如hibernate实现),而且bean属性上有@Validated\n  // 则添加该校验\n  if (this.jsr303Present && target.getAnnotation(Validated.class) != null) {\n    validators.add(getJsr303Validator());\n  }\n  // 如果该对象本身不为null且对象实现了Validator接口，则把自己加入到validators列表中去\n  if (target.getValue() != null && target.getValue().get() instanceof Validator) {\n    validators.add((Validator) target.getValue().get());\n  }\n  return validators;\n}\n```\n\n### 总结\n\n- 只要被配置到容器中的类且类上标注@ConfigurationProperties都会进行属性绑定\n\n- 属性绑定支持jsr303校验规则\n\n- 如果该类实现了`org.springframework.validation.Validator`也可以增强校验。例如\n\n  ```java\n  @Data\n  @ConfigurationProperties(prefix = \"car\")\n  @Component(\"car\")\n  @SuppressWarnings(\"all\")\n  public class Car implements Validator {\n      private String name;\n      private Double price;\n      private Date buyDate;\n  \n  \n      public void setName(String name) {\n          System.out.println(\"setter: \" + name);\n          this.name = name;\n      }\n  \n      @Override\n      public boolean supports(Class<?> clazz) {\n          return clazz.isAssignableFrom(Car.class);\n      }\n  \n      @Override\n      public void validate(Object target, Errors errors) {\n          System.out.println(target);\n          ValidationUtils.rejectIfEmpty(errors, \"other\", \"name不能为空\");\n          //throw new RuntimeException();\n      }\n  }\n  ```\n\n  ### 思考\n\n  - 以上实例中，实体类对应的属性配置在application.yaml,那能不能从其他自定义的yaml中配置或者从配置中心获取呢？\n  - 配置的参数如何转换，例如时间，日期格式等等。\n","source":"_posts/spring/ConfigurationProperties解析.md","raw":"---\nuuid: bbaf4816-c0ab-11ec-92a1-7557b2313227\ntitle: configurationProperties解析\ncategories: Java\ntags:\n  - springBoot\nabbrlink: 1fdc0995\n---\n\nspring boot configuration properties解析\n\n项目中我们一般通过`@Value`来获取application.yaml或application.yaml文件中配置的属性值来配置到bean对象中，一般这种对于单个或几个会比较合适。如果属性很多，这样配置很不方便。关于@Value，之前我们有讲到过，这里主要说另外一个`@ConfigurationProperties`主角，它能绑定多个值到一个对象上。\n\n### 官方文档说明\n\n```\nAnnotation for externalized configuration. Add this to a class definition or a\n{@code @Bean} method in a {@code @Configuration} class if you want to bind and validate\n some external Properties (e.g. from a .properties file).\n <p>\nBinding is either performed by calling setters on the annotated class or, if\n{@link ConstructorBinding @ConstructorBinding} is in use, by binding to the constructor\n parameters.\n <p>\n Note that contrary to {@code @Value}, SpEL expressions are not evaluated since property\n values are externalized.\n```\n\n对于官方的文档，主要说了这几点意思。\n\n- 外部化配置的注解。主要用在一个类上或者标注有`@Configuration`类中`@Bean`方法上\n- 能够绑定外部化属性，同时也能够对属性进行校验\n- 绑定的过程要么是通过类属性的setters方法，要么通过`@ConstructorBinding`绑定都构造方法的参数上\n- 和`@Value`的区别就是不支持SpEL表达式\n\n### 实例\n\n**application.yaml**\n\n```yaml\ncar:\n  name: BMW\n  price: 30.50\n#  buyDate: 2021-10-22\n```\n\n#### 1、通过class进行进行绑定\n\n方式一，结合`@EnableConfigurationProperties`使用\n\n```java\n@Data\n@ConfigurationProperties(prefix = \"car\")\npublic class Car {\n    private String name;\n    private Double price;\n    private Date buyDate;\n}\n\n@Configuration\n@EnableConfigurationProperties(Car.class)\npublic class Config {\n    \n}\n```\n\n方式二，直接在类上标注`@Component`注解\n\n```java\n@Data\n@Component\n@ConfigurationProperties(prefix = \"car\")\npublic class Car {\n    private String name;\n    private Double price;\n    private Date buyDate;\n}\n```\n\n#### 2、通过@Bean方式进行绑定\n\n```java\n@Bean\n@ConfigurationProperties(prefix = \"car\")\npublic Car car(){\n  return new Car();\n}\n```\n\n#### 3、通过@ConstructorBinding进行绑定\n\n默认的属性绑定是通过setter方法进行，如果使用构造方法可以进行绑定。当然以前的版本都是使用`@Configuration`和`@ConfigurationProperties`进行配置的，如果使用`@ConstructorBinding`\n\n只需要在类上加上`@ConfigurationProperties`和`@ConstructorBinding`,同时在启动类上加上`@ConfigurationPropertiesScan`即可。**这里的boot版本是2.2.0以后**\n\n```java\n@Data\n@ConfigurationProperties(prefix = \"car\")\n@ConstructorBinding\n@SuppressWarnings(\"all\")\npublic class Car {\n    private String name;\n    private Double price;\n    private Date buyDate;\n\n    public Car(String name, Double price, Date buyDate) {\n        // 这里会打印出名字\n        System.out.println(\"constructor: \" + name);\n        this.name = name;\n        this.price = price;\n        this.buyDate = buyDate;\n    }\n\n    public void setName(String name) {\n        System.out.println(\"setter: \" + name);\n        this.name = name;\n    }\n}\n\n@SpringBootApplication\n@ConfigurationPropertiesScan\npublic class SpringbootTestApplication {\n\n    @Autowired\n    Car car;\n\n    public static void main(String[] args) {\n        SpringApplication.run(SpringbootTestApplication.class, args);\n    }\n\n}\n```\n\n### 原理\n\n> Springboot verion 2.5.2\n\n熟悉spring的应该知道，对spring bean的的生命周期流程涉及到的类有`BeanFactoryPostProcessor`和`BeanPostProcessor`。这里对`ConfigurationProperties`进行属性绑定的就是`ConfigurationPropertiesBindingPostProcessor`这个`BeanPostProcessor`,它**被框架添加到容器**，用于\n\n解析`bean`组件上的注解`@ConfigurationProperties`,将属性源中的属性设置到`bean`组件中。\n\n> ```\n> ConfigurationPropertiesBindingPostProcessor`所在包为: `org.springframework.boot.context.properties`\n> ```\n\n#### 1、引入到容器\n\n在idea中查看`ConfigurationPropertiesBindingPostProcessor`类的引用关系依次是：\n\n> EnableConfigurationPropertiesRegistrar\n\n```java\n// EnableConfigurationPropertiesRegistrar\nstatic void registerInfrastructureBeans(BeanDefinitionRegistry registry) {\n\t\tConfigurationPropertiesBindingPostProcessor.register(registry);\n\t\tBoundConfigurationProperties.register(registry);\n}\n```\n\n> EnableConfigurationProperties\n\n```java\n@Import(EnableConfigurationPropertiesRegistrar.class)\npublic @interface EnableConfigurationProperties {\n\n\t/**\n\t * The bean name of the configuration properties validator.\n\t * @since 2.2.0\n\t */\n\tString VALIDATOR_BEAN_NAME = \"configurationPropertiesValidator\";\n\n\t/**\n\t * Convenient way to quickly register\n\t * {@link ConfigurationProperties @ConfigurationProperties} annotated beans with\n\t * Spring. Standard Spring Beans will also be scanned regardless of this value.\n\t * @return {@code @ConfigurationProperties} annotated beans to register\n\t */\n\tClass<?>[] value() default {};\n\n}\n```\n\n> spring-boot-autoconfigure-2.5.2.jar\n\n**spring.factories**\n\n```\norg.springframework.boot.autoconfigure.EnableAutoConfiguration=\\\norg.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\\\n```\n\n>ConfigurationPropertiesAutoConfiguration\n\n```java\n@Configuration(\n    proxyBeanMethods = false\n)\n@EnableConfigurationProperties\npublic class ConfigurationPropertiesAutoConfiguration {\n    public ConfigurationPropertiesAutoConfiguration() {\n    }\n}\n```\n\n由此总结出springboot启动后会自动把`ConfigurationPropertiesBindingPostProcessor`配置ioc容器中。\n\n#### 2、初始化自生的属性\n\n`ConfigurationPropertiesAutoConfiguration`实现了`BeanPostProcessor`、`ApplicationContextAware`、\n\n`InitializingBean`,在实现的方法中依次初始化了三个属性\n\n```java\n// 应用上下文\nprivate ApplicationContext applicationContext;\n\n// bean注册工厂，实例为AutowireCapableBeanFactory\nprivate BeanDefinitionRegistry registry;\n\n// 处理@ConfigurationProperties属性的具体绑定工作\nprivate ConfigurationPropertiesBinder binder;\n```\n\n#### 3、处理属性绑定工作\n\n大致步骤，先获取是否是**ConfigurationPropertiesBean**，然后进行具体绑定工作\n\n```java\n// 步骤1 执行BeanPostProcessor的postProcessBeforeInitialization\n@Override\npublic Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n  // 通过bean和beanName\n  // 获取ConfigurationProperties类型的ConfigurationPropertiesBean\n  bind(ConfigurationPropertiesBean.get(this.applicationContext, bean, beanName));\n  return bean;\n}\n\n// 步骤2\nprivate void bind(ConfigurationPropertiesBean bean) {\n  // 判断是否为空和属性是否绑定\n\t\tif (bean == null || hasBoundValueObject(bean.getName())) {\n\t\t\treturn;\n\t\t}\n\t\tAssert.state(bean.getBindMethod() == BindMethod.JAVA_BEAN, \"Cannot bind @ConfigurationProperties for bean '\"\n\t\t\t\t+ bean.getName() + \"'. Ensure that @ConstructorBinding has not been applied to regular bean\");\n\t\ttry {\n      // ConfigurationPropertiesBinder#bind()\n\t\t\tthis.binder.bind(bean);\n\t\t}\n\t\tcatch (Exception ex) {\n\t\t\tthrow new ConfigurationPropertiesBindException(bean, ex);\n\t\t}\n\t}\n\nprivate boolean hasBoundValueObject(String beanName) {\n\t\treturn this.registry.containsBeanDefinition(beanName) && this.registry\n\t\t\t\t.getBeanDefinition(beanName) instanceof ConfigurationPropertiesValueObjectBeanDefinition;\n}\n```\n\n**ConfigurationPropertiesBinder#bind()**\n\n```java\nBindResult<?> bind(ConfigurationPropertiesBean propertiesBean) {\n  Bindable<?> target = propertiesBean.asBindTarget();\n  ConfigurationProperties annotation = propertiesBean.getAnnotation();\n  // 执行下面的方法\n  BindHandler bindHandler = getBindHandler(target, annotation);\n  // 该binder里面包含了所有的环境变量的配置数据\n  // 然后利用Properties配置bean\n  return getBinder().bind(annotation.prefix(), target, bindHandler);\n}\n\nprivate <T> BindHandler getBindHandler(Bindable<T> target, ConfigurationProperties annotation) {\n  // 获取Validators\n  List<Validator> validators = getValidators(target);\n  BindHandler handler = getHandler();\n  handler = new ConfigurationPropertiesBindHander(handler);\n  if (annotation.ignoreInvalidFields()) {\n    handler = new IgnoreErrorsBindHandler(handler);\n  }\n  if (!annotation.ignoreUnknownFields()) {\n    UnboundElementsSourceFilter filter = new UnboundElementsSourceFilter();\n    handler = new NoUnboundElementsBindHandler(handler, filter);\n  }\n  // 如果校验器不为空，则进行校验\n  if (!validators.isEmpty()) {\n    handler = new ValidationBindHandler(handler, validators.toArray(new Validator[0]));\n  }\n  for (ConfigurationPropertiesBindHandlerAdvisor advisor : getBindHandlerAdvisors()) {\n    handler = advisor.apply(handler);\n  }\n  return handler;\n}\n\n// 对属性进行校验的验证器\nprivate List<Validator> getValidators(Bindable<?> target) {\n  List<Validator> validators = new ArrayList<>(3);\n  if (this.configurationPropertiesValidator != null) {\n    validators.add(this.configurationPropertiesValidator);\n  }\n  // 如果引入了jsr303(例如hibernate实现),而且bean属性上有@Validated\n  // 则添加该校验\n  if (this.jsr303Present && target.getAnnotation(Validated.class) != null) {\n    validators.add(getJsr303Validator());\n  }\n  // 如果该对象本身不为null且对象实现了Validator接口，则把自己加入到validators列表中去\n  if (target.getValue() != null && target.getValue().get() instanceof Validator) {\n    validators.add((Validator) target.getValue().get());\n  }\n  return validators;\n}\n```\n\n### 总结\n\n- 只要被配置到容器中的类且类上标注@ConfigurationProperties都会进行属性绑定\n\n- 属性绑定支持jsr303校验规则\n\n- 如果该类实现了`org.springframework.validation.Validator`也可以增强校验。例如\n\n  ```java\n  @Data\n  @ConfigurationProperties(prefix = \"car\")\n  @Component(\"car\")\n  @SuppressWarnings(\"all\")\n  public class Car implements Validator {\n      private String name;\n      private Double price;\n      private Date buyDate;\n  \n  \n      public void setName(String name) {\n          System.out.println(\"setter: \" + name);\n          this.name = name;\n      }\n  \n      @Override\n      public boolean supports(Class<?> clazz) {\n          return clazz.isAssignableFrom(Car.class);\n      }\n  \n      @Override\n      public void validate(Object target, Errors errors) {\n          System.out.println(target);\n          ValidationUtils.rejectIfEmpty(errors, \"other\", \"name不能为空\");\n          //throw new RuntimeException();\n      }\n  }\n  ```\n\n  ### 思考\n\n  - 以上实例中，实体类对应的属性配置在application.yaml,那能不能从其他自定义的yaml中配置或者从配置中心获取呢？\n  - 配置的参数如何转换，例如时间，日期格式等等。\n","slug":"spring/ConfigurationProperties解析","published":1,"date":"2022-04-20T12:41:20.918Z","updated":"2022-05-04T03:22:45.180Z","_id":"cl2qzfti8004f13no8q0iavid","comments":1,"layout":"post","photos":[],"link":"","content":"<p>spring boot configuration properties解析</p>\n<p>项目中我们一般通过<code>@Value</code>来获取application.yaml或application.yaml文件中配置的属性值来配置到bean对象中，一般这种对于单个或几个会比较合适。如果属性很多，这样配置很不方便。关于@Value，之前我们有讲到过，这里主要说另外一个<code>@ConfigurationProperties</code>主角，它能绑定多个值到一个对象上。</p>\n<h3 id=\"官方文档说明\"><a href=\"#官方文档说明\" class=\"headerlink\" title=\"官方文档说明\"></a>官方文档说明</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Annotation for externalized configuration. Add this to a class definition or a</span><br><span class=\"line\">&#123;@code @Bean&#125; method in a &#123;@code @Configuration&#125; class if you want to bind and validate</span><br><span class=\"line\"> some external Properties (e.g. from a .properties file).</span><br><span class=\"line\"> &lt;p&gt;</span><br><span class=\"line\">Binding is either performed by calling setters on the annotated class or, if</span><br><span class=\"line\">&#123;@link ConstructorBinding @ConstructorBinding&#125; is in use, by binding to the constructor</span><br><span class=\"line\"> parameters.</span><br><span class=\"line\"> &lt;p&gt;</span><br><span class=\"line\"> Note that contrary to &#123;@code @Value&#125;, SpEL expressions are not evaluated since property</span><br><span class=\"line\"> values are externalized.</span><br></pre></td></tr></table></figure>\n\n<p>对于官方的文档，主要说了这几点意思。</p>\n<ul>\n<li>外部化配置的注解。主要用在一个类上或者标注有<code>@Configuration</code>类中<code>@Bean</code>方法上</li>\n<li>能够绑定外部化属性，同时也能够对属性进行校验</li>\n<li>绑定的过程要么是通过类属性的setters方法，要么通过<code>@ConstructorBinding</code>绑定都构造方法的参数上</li>\n<li>和<code>@Value</code>的区别就是不支持SpEL表达式</li>\n</ul>\n<h3 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h3><p><strong>application.yaml</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">car:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">BMW</span></span><br><span class=\"line\">  <span class=\"attr\">price:</span> <span class=\"number\">30.50</span></span><br><span class=\"line\"><span class=\"comment\">#  buyDate: 2021-10-22</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"1、通过class进行进行绑定\"><a href=\"#1、通过class进行进行绑定\" class=\"headerlink\" title=\"1、通过class进行进行绑定\"></a>1、通过class进行进行绑定</h4><p>方式一，结合<code>@EnableConfigurationProperties</code>使用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Car</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double price;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Date buyDate;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableConfigurationProperties(Car.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Config</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方式二，直接在类上标注<code>@Component</code>注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Car</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double price;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Date buyDate;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2、通过-Bean方式进行绑定\"><a href=\"#2、通过-Bean方式进行绑定\" class=\"headerlink\" title=\"2、通过@Bean方式进行绑定\"></a>2、通过@Bean方式进行绑定</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Car <span class=\"title function_\">car</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Car</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3、通过-ConstructorBinding进行绑定\"><a href=\"#3、通过-ConstructorBinding进行绑定\" class=\"headerlink\" title=\"3、通过@ConstructorBinding进行绑定\"></a>3、通过@ConstructorBinding进行绑定</h4><p>默认的属性绑定是通过setter方法进行，如果使用构造方法可以进行绑定。当然以前的版本都是使用<code>@Configuration</code>和<code>@ConfigurationProperties</code>进行配置的，如果使用<code>@ConstructorBinding</code></p>\n<p>只需要在类上加上<code>@ConfigurationProperties</code>和<code>@ConstructorBinding</code>,同时在启动类上加上<code>@ConfigurationPropertiesScan</code>即可。<strong>这里的boot版本是2.2.0以后</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ConstructorBinding</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Car</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double price;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Date buyDate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Car</span><span class=\"params\">(String name, Double price, Date buyDate)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 这里会打印出名字</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;constructor: &quot;</span> + name);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.price = price;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.buyDate = buyDate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setName</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;setter: &quot;</span> + name);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationPropertiesScan</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringbootTestApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    Car car;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringbootTestApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h3><blockquote>\n<p>Springboot verion 2.5.2</p>\n</blockquote>\n<p>熟悉spring的应该知道，对spring bean的的生命周期流程涉及到的类有<code>BeanFactoryPostProcessor</code>和<code>BeanPostProcessor</code>。这里对<code>ConfigurationProperties</code>进行属性绑定的就是<code>ConfigurationPropertiesBindingPostProcessor</code>这个<code>BeanPostProcessor</code>,它<strong>被框架添加到容器</strong>，用于</p>\n<p>解析<code>bean</code>组件上的注解<code>@ConfigurationProperties</code>,将属性源中的属性设置到<code>bean</code>组件中。</p>\n<blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ConfigurationPropertiesBindingPostProcessor`所在包为: `org.springframework.boot.context.properties`</span><br></pre></td></tr></table></figure>\n</blockquote>\n<h4 id=\"1、引入到容器\"><a href=\"#1、引入到容器\" class=\"headerlink\" title=\"1、引入到容器\"></a>1、引入到容器</h4><p>在idea中查看<code>ConfigurationPropertiesBindingPostProcessor</code>类的引用关系依次是：</p>\n<blockquote>\n<p>EnableConfigurationPropertiesRegistrar</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// EnableConfigurationPropertiesRegistrar</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">registerInfrastructureBeans</span><span class=\"params\">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class=\"line\">\t\tConfigurationPropertiesBindingPostProcessor.register(registry);</span><br><span class=\"line\">\t\tBoundConfigurationProperties.register(registry);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>EnableConfigurationProperties</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Import(EnableConfigurationPropertiesRegistrar.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> EnableConfigurationProperties &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * The bean name of the configuration properties validator.</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@since</span> 2.2.0</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"type\">String</span> <span class=\"variable\">VALIDATOR_BEAN_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;configurationPropertiesValidator&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Convenient way to quickly register</span></span><br><span class=\"line\"><span class=\"comment\">\t * &#123;<span class=\"doctag\">@link</span> ConfigurationProperties <span class=\"doctag\">@ConfigurationProperties</span>&#125; annotated beans with</span></span><br><span class=\"line\"><span class=\"comment\">\t * Spring. Standard Spring Beans will also be scanned regardless of this value.</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span> &#123;<span class=\"doctag\">@code</span> <span class=\"doctag\">@ConfigurationProperties</span>&#125; annotated beans to register</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\tClass&lt;?&gt;[] value() <span class=\"keyword\">default</span> &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>spring-boot-autoconfigure-2.5.2.jar</p>\n</blockquote>\n<p><strong>spring.factories</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\\</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>ConfigurationPropertiesAutoConfiguration</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration(</span></span><br><span class=\"line\"><span class=\"meta\">    proxyBeanMethods = false</span></span><br><span class=\"line\"><span class=\"meta\">)</span></span><br><span class=\"line\"><span class=\"meta\">@EnableConfigurationProperties</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ConfigurationPropertiesAutoConfiguration</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ConfigurationPropertiesAutoConfiguration</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>由此总结出springboot启动后会自动把<code>ConfigurationPropertiesBindingPostProcessor</code>配置ioc容器中。</p>\n<h4 id=\"2、初始化自生的属性\"><a href=\"#2、初始化自生的属性\" class=\"headerlink\" title=\"2、初始化自生的属性\"></a>2、初始化自生的属性</h4><p><code>ConfigurationPropertiesAutoConfiguration</code>实现了<code>BeanPostProcessor</code>、<code>ApplicationContextAware</code>、</p>\n<p><code>InitializingBean</code>,在实现的方法中依次初始化了三个属性</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 应用上下文</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> ApplicationContext applicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// bean注册工厂，实例为AutowireCapableBeanFactory</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> BeanDefinitionRegistry registry;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 处理@ConfigurationProperties属性的具体绑定工作</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> ConfigurationPropertiesBinder binder;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3、处理属性绑定工作\"><a href=\"#3、处理属性绑定工作\" class=\"headerlink\" title=\"3、处理属性绑定工作\"></a>3、处理属性绑定工作</h4><p>大致步骤，先获取是否是<strong>ConfigurationPropertiesBean</strong>，然后进行具体绑定工作</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 步骤1 执行BeanPostProcessor的postProcessBeforeInitialization</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Object <span class=\"title function_\">postProcessBeforeInitialization</span><span class=\"params\">(Object bean, String beanName)</span> <span class=\"keyword\">throws</span> BeansException &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 通过bean和beanName</span></span><br><span class=\"line\">  <span class=\"comment\">// 获取ConfigurationProperties类型的ConfigurationPropertiesBean</span></span><br><span class=\"line\">  bind(ConfigurationPropertiesBean.get(<span class=\"built_in\">this</span>.applicationContext, bean, beanName));</span><br><span class=\"line\">  <span class=\"keyword\">return</span> bean;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 步骤2</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">bind</span><span class=\"params\">(ConfigurationPropertiesBean bean)</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 判断是否为空和属性是否绑定</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (bean == <span class=\"literal\">null</span> || hasBoundValueObject(bean.getName())) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tAssert.state(bean.getBindMethod() == BindMethod.JAVA_BEAN, <span class=\"string\">&quot;Cannot bind @ConfigurationProperties for bean &#x27;&quot;</span></span><br><span class=\"line\">\t\t\t\t+ bean.getName() + <span class=\"string\">&quot;&#x27;. Ensure that @ConstructorBinding has not been applied to regular bean&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// ConfigurationPropertiesBinder#bind()</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.binder.bind(bean);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConfigurationPropertiesBindException</span>(bean, ex);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">hasBoundValueObject</span><span class=\"params\">(String beanName)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.registry.containsBeanDefinition(beanName) &amp;&amp; <span class=\"built_in\">this</span>.registry</span><br><span class=\"line\">\t\t\t\t.getBeanDefinition(beanName) <span class=\"keyword\">instanceof</span> ConfigurationPropertiesValueObjectBeanDefinition;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>ConfigurationPropertiesBinder#bind()</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BindResult&lt;?&gt; bind(ConfigurationPropertiesBean propertiesBean) &#123;</span><br><span class=\"line\">  Bindable&lt;?&gt; target = propertiesBean.asBindTarget();</span><br><span class=\"line\">  <span class=\"type\">ConfigurationProperties</span> <span class=\"variable\">annotation</span> <span class=\"operator\">=</span> propertiesBean.getAnnotation();</span><br><span class=\"line\">  <span class=\"comment\">// 执行下面的方法</span></span><br><span class=\"line\">  <span class=\"type\">BindHandler</span> <span class=\"variable\">bindHandler</span> <span class=\"operator\">=</span> getBindHandler(target, annotation);</span><br><span class=\"line\">  <span class=\"comment\">// 该binder里面包含了所有的环境变量的配置数据</span></span><br><span class=\"line\">  <span class=\"comment\">// 然后利用Properties配置bean</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> getBinder().bind(annotation.prefix(), target, bindHandler);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> &lt;T&gt; BindHandler <span class=\"title function_\">getBindHandler</span><span class=\"params\">(Bindable&lt;T&gt; target, ConfigurationProperties annotation)</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 获取Validators</span></span><br><span class=\"line\">  List&lt;Validator&gt; validators = getValidators(target);</span><br><span class=\"line\">  <span class=\"type\">BindHandler</span> <span class=\"variable\">handler</span> <span class=\"operator\">=</span> getHandler();</span><br><span class=\"line\">  handler = <span class=\"keyword\">new</span> <span class=\"title class_\">ConfigurationPropertiesBindHander</span>(handler);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (annotation.ignoreInvalidFields()) &#123;</span><br><span class=\"line\">    handler = <span class=\"keyword\">new</span> <span class=\"title class_\">IgnoreErrorsBindHandler</span>(handler);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!annotation.ignoreUnknownFields()) &#123;</span><br><span class=\"line\">    <span class=\"type\">UnboundElementsSourceFilter</span> <span class=\"variable\">filter</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UnboundElementsSourceFilter</span>();</span><br><span class=\"line\">    handler = <span class=\"keyword\">new</span> <span class=\"title class_\">NoUnboundElementsBindHandler</span>(handler, filter);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 如果校验器不为空，则进行校验</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!validators.isEmpty()) &#123;</span><br><span class=\"line\">    handler = <span class=\"keyword\">new</span> <span class=\"title class_\">ValidationBindHandler</span>(handler, validators.toArray(<span class=\"keyword\">new</span> <span class=\"title class_\">Validator</span>[<span class=\"number\">0</span>]));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (ConfigurationPropertiesBindHandlerAdvisor advisor : getBindHandlerAdvisors()) &#123;</span><br><span class=\"line\">    handler = advisor.apply(handler);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> handler;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对属性进行校验的验证器</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> List&lt;Validator&gt; <span class=\"title function_\">getValidators</span><span class=\"params\">(Bindable&lt;?&gt; target)</span> &#123;</span><br><span class=\"line\">  List&lt;Validator&gt; validators = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(<span class=\"number\">3</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.configurationPropertiesValidator != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    validators.add(<span class=\"built_in\">this</span>.configurationPropertiesValidator);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 如果引入了jsr303(例如hibernate实现),而且bean属性上有@Validated</span></span><br><span class=\"line\">  <span class=\"comment\">// 则添加该校验</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.jsr303Present &amp;&amp; target.getAnnotation(Validated.class) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    validators.add(getJsr303Validator());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 如果该对象本身不为null且对象实现了Validator接口，则把自己加入到validators列表中去</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (target.getValue() != <span class=\"literal\">null</span> &amp;&amp; target.getValue().get() <span class=\"keyword\">instanceof</span> Validator) &#123;</span><br><span class=\"line\">    validators.add((Validator) target.getValue().get());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> validators;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><ul>\n<li><p>只要被配置到容器中的类且类上标注@ConfigurationProperties都会进行属性绑定</p>\n</li>\n<li><p>属性绑定支持jsr303校验规则</p>\n</li>\n<li><p>如果该类实现了<code>org.springframework.validation.Validator</code>也可以增强校验。例如</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Component(&quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Car</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Validator</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double price;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Date buyDate;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setName</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;setter: &quot;</span> + name);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">supports</span><span class=\"params\">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> clazz.isAssignableFrom(Car.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">validate</span><span class=\"params\">(Object target, Errors errors)</span> &#123;</span><br><span class=\"line\">        System.out.println(target);</span><br><span class=\"line\">        ValidationUtils.rejectIfEmpty(errors, <span class=\"string\">&quot;other&quot;</span>, <span class=\"string\">&quot;name不能为空&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//throw new RuntimeException();</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"思考\"><a href=\"#思考\" class=\"headerlink\" title=\"思考\"></a>思考</h3><ul>\n<li>以上实例中，实体类对应的属性配置在application.yaml,那能不能从其他自定义的yaml中配置或者从配置中心获取呢？</li>\n<li>配置的参数如何转换，例如时间，日期格式等等。</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>spring boot configuration properties解析</p>\n<p>项目中我们一般通过<code>@Value</code>来获取application.yaml或application.yaml文件中配置的属性值来配置到bean对象中，一般这种对于单个或几个会比较合适。如果属性很多，这样配置很不方便。关于@Value，之前我们有讲到过，这里主要说另外一个<code>@ConfigurationProperties</code>主角，它能绑定多个值到一个对象上。</p>\n<h3 id=\"官方文档说明\"><a href=\"#官方文档说明\" class=\"headerlink\" title=\"官方文档说明\"></a>官方文档说明</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Annotation for externalized configuration. Add this to a class definition or a</span><br><span class=\"line\">&#123;@code @Bean&#125; method in a &#123;@code @Configuration&#125; class if you want to bind and validate</span><br><span class=\"line\"> some external Properties (e.g. from a .properties file).</span><br><span class=\"line\"> &lt;p&gt;</span><br><span class=\"line\">Binding is either performed by calling setters on the annotated class or, if</span><br><span class=\"line\">&#123;@link ConstructorBinding @ConstructorBinding&#125; is in use, by binding to the constructor</span><br><span class=\"line\"> parameters.</span><br><span class=\"line\"> &lt;p&gt;</span><br><span class=\"line\"> Note that contrary to &#123;@code @Value&#125;, SpEL expressions are not evaluated since property</span><br><span class=\"line\"> values are externalized.</span><br></pre></td></tr></table></figure>\n\n<p>对于官方的文档，主要说了这几点意思。</p>\n<ul>\n<li>外部化配置的注解。主要用在一个类上或者标注有<code>@Configuration</code>类中<code>@Bean</code>方法上</li>\n<li>能够绑定外部化属性，同时也能够对属性进行校验</li>\n<li>绑定的过程要么是通过类属性的setters方法，要么通过<code>@ConstructorBinding</code>绑定都构造方法的参数上</li>\n<li>和<code>@Value</code>的区别就是不支持SpEL表达式</li>\n</ul>\n<h3 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h3><p><strong>application.yaml</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">car:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">BMW</span></span><br><span class=\"line\">  <span class=\"attr\">price:</span> <span class=\"number\">30.50</span></span><br><span class=\"line\"><span class=\"comment\">#  buyDate: 2021-10-22</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"1、通过class进行进行绑定\"><a href=\"#1、通过class进行进行绑定\" class=\"headerlink\" title=\"1、通过class进行进行绑定\"></a>1、通过class进行进行绑定</h4><p>方式一，结合<code>@EnableConfigurationProperties</code>使用</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Car</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double price;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Date buyDate;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableConfigurationProperties(Car.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Config</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>方式二，直接在类上标注<code>@Component</code>注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Car</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double price;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Date buyDate;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2、通过-Bean方式进行绑定\"><a href=\"#2、通过-Bean方式进行绑定\" class=\"headerlink\" title=\"2、通过@Bean方式进行绑定\"></a>2、通过@Bean方式进行绑定</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Bean</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Car <span class=\"title function_\">car</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Car</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3、通过-ConstructorBinding进行绑定\"><a href=\"#3、通过-ConstructorBinding进行绑定\" class=\"headerlink\" title=\"3、通过@ConstructorBinding进行绑定\"></a>3、通过@ConstructorBinding进行绑定</h4><p>默认的属性绑定是通过setter方法进行，如果使用构造方法可以进行绑定。当然以前的版本都是使用<code>@Configuration</code>和<code>@ConfigurationProperties</code>进行配置的，如果使用<code>@ConstructorBinding</code></p>\n<p>只需要在类上加上<code>@ConfigurationProperties</code>和<code>@ConstructorBinding</code>,同时在启动类上加上<code>@ConfigurationPropertiesScan</code>即可。<strong>这里的boot版本是2.2.0以后</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@ConstructorBinding</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Car</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double price;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Date buyDate;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">Car</span><span class=\"params\">(String name, Double price, Date buyDate)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 这里会打印出名字</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;constructor: &quot;</span> + name);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.price = price;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.buyDate = buyDate;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setName</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;setter: &quot;</span> + name);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationPropertiesScan</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringbootTestApplication</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    Car car;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringbootTestApplication.class, args);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"原理\"><a href=\"#原理\" class=\"headerlink\" title=\"原理\"></a>原理</h3><blockquote>\n<p>Springboot verion 2.5.2</p>\n</blockquote>\n<p>熟悉spring的应该知道，对spring bean的的生命周期流程涉及到的类有<code>BeanFactoryPostProcessor</code>和<code>BeanPostProcessor</code>。这里对<code>ConfigurationProperties</code>进行属性绑定的就是<code>ConfigurationPropertiesBindingPostProcessor</code>这个<code>BeanPostProcessor</code>,它<strong>被框架添加到容器</strong>，用于</p>\n<p>解析<code>bean</code>组件上的注解<code>@ConfigurationProperties</code>,将属性源中的属性设置到<code>bean</code>组件中。</p>\n<blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ConfigurationPropertiesBindingPostProcessor`所在包为: `org.springframework.boot.context.properties`</span><br></pre></td></tr></table></figure>\n</blockquote>\n<h4 id=\"1、引入到容器\"><a href=\"#1、引入到容器\" class=\"headerlink\" title=\"1、引入到容器\"></a>1、引入到容器</h4><p>在idea中查看<code>ConfigurationPropertiesBindingPostProcessor</code>类的引用关系依次是：</p>\n<blockquote>\n<p>EnableConfigurationPropertiesRegistrar</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// EnableConfigurationPropertiesRegistrar</span></span><br><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">registerInfrastructureBeans</span><span class=\"params\">(BeanDefinitionRegistry registry)</span> &#123;</span><br><span class=\"line\">\t\tConfigurationPropertiesBindingPostProcessor.register(registry);</span><br><span class=\"line\">\t\tBoundConfigurationProperties.register(registry);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>EnableConfigurationProperties</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Import(EnableConfigurationPropertiesRegistrar.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> EnableConfigurationProperties &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * The bean name of the configuration properties validator.</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@since</span> 2.2.0</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"type\">String</span> <span class=\"variable\">VALIDATOR_BEAN_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;configurationPropertiesValidator&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * Convenient way to quickly register</span></span><br><span class=\"line\"><span class=\"comment\">\t * &#123;<span class=\"doctag\">@link</span> ConfigurationProperties <span class=\"doctag\">@ConfigurationProperties</span>&#125; annotated beans with</span></span><br><span class=\"line\"><span class=\"comment\">\t * Spring. Standard Spring Beans will also be scanned regardless of this value.</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@return</span> &#123;<span class=\"doctag\">@code</span> <span class=\"doctag\">@ConfigurationProperties</span>&#125; annotated beans to register</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\tClass&lt;?&gt;[] value() <span class=\"keyword\">default</span> &#123;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>spring-boot-autoconfigure-2.5.2.jar</p>\n</blockquote>\n<p><strong>spring.factories</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\\</span><br><span class=\"line\">org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\\</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>ConfigurationPropertiesAutoConfiguration</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration(</span></span><br><span class=\"line\"><span class=\"meta\">    proxyBeanMethods = false</span></span><br><span class=\"line\"><span class=\"meta\">)</span></span><br><span class=\"line\"><span class=\"meta\">@EnableConfigurationProperties</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ConfigurationPropertiesAutoConfiguration</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">ConfigurationPropertiesAutoConfiguration</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>由此总结出springboot启动后会自动把<code>ConfigurationPropertiesBindingPostProcessor</code>配置ioc容器中。</p>\n<h4 id=\"2、初始化自生的属性\"><a href=\"#2、初始化自生的属性\" class=\"headerlink\" title=\"2、初始化自生的属性\"></a>2、初始化自生的属性</h4><p><code>ConfigurationPropertiesAutoConfiguration</code>实现了<code>BeanPostProcessor</code>、<code>ApplicationContextAware</code>、</p>\n<p><code>InitializingBean</code>,在实现的方法中依次初始化了三个属性</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 应用上下文</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> ApplicationContext applicationContext;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// bean注册工厂，实例为AutowireCapableBeanFactory</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> BeanDefinitionRegistry registry;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 处理@ConfigurationProperties属性的具体绑定工作</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> ConfigurationPropertiesBinder binder;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"3、处理属性绑定工作\"><a href=\"#3、处理属性绑定工作\" class=\"headerlink\" title=\"3、处理属性绑定工作\"></a>3、处理属性绑定工作</h4><p>大致步骤，先获取是否是<strong>ConfigurationPropertiesBean</strong>，然后进行具体绑定工作</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 步骤1 执行BeanPostProcessor的postProcessBeforeInitialization</span></span><br><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> Object <span class=\"title function_\">postProcessBeforeInitialization</span><span class=\"params\">(Object bean, String beanName)</span> <span class=\"keyword\">throws</span> BeansException &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 通过bean和beanName</span></span><br><span class=\"line\">  <span class=\"comment\">// 获取ConfigurationProperties类型的ConfigurationPropertiesBean</span></span><br><span class=\"line\">  bind(ConfigurationPropertiesBean.get(<span class=\"built_in\">this</span>.applicationContext, bean, beanName));</span><br><span class=\"line\">  <span class=\"keyword\">return</span> bean;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 步骤2</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">bind</span><span class=\"params\">(ConfigurationPropertiesBean bean)</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 判断是否为空和属性是否绑定</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (bean == <span class=\"literal\">null</span> || hasBoundValueObject(bean.getName())) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tAssert.state(bean.getBindMethod() == BindMethod.JAVA_BEAN, <span class=\"string\">&quot;Cannot bind @ConfigurationProperties for bean &#x27;&quot;</span></span><br><span class=\"line\">\t\t\t\t+ bean.getName() + <span class=\"string\">&quot;&#x27;. Ensure that @ConstructorBinding has not been applied to regular bean&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// ConfigurationPropertiesBinder#bind()</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.binder.bind(bean);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">catch</span> (Exception ex) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throw</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConfigurationPropertiesBindException</span>(bean, ex);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">hasBoundValueObject</span><span class=\"params\">(String beanName)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.registry.containsBeanDefinition(beanName) &amp;&amp; <span class=\"built_in\">this</span>.registry</span><br><span class=\"line\">\t\t\t\t.getBeanDefinition(beanName) <span class=\"keyword\">instanceof</span> ConfigurationPropertiesValueObjectBeanDefinition;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>ConfigurationPropertiesBinder#bind()</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BindResult&lt;?&gt; bind(ConfigurationPropertiesBean propertiesBean) &#123;</span><br><span class=\"line\">  Bindable&lt;?&gt; target = propertiesBean.asBindTarget();</span><br><span class=\"line\">  <span class=\"type\">ConfigurationProperties</span> <span class=\"variable\">annotation</span> <span class=\"operator\">=</span> propertiesBean.getAnnotation();</span><br><span class=\"line\">  <span class=\"comment\">// 执行下面的方法</span></span><br><span class=\"line\">  <span class=\"type\">BindHandler</span> <span class=\"variable\">bindHandler</span> <span class=\"operator\">=</span> getBindHandler(target, annotation);</span><br><span class=\"line\">  <span class=\"comment\">// 该binder里面包含了所有的环境变量的配置数据</span></span><br><span class=\"line\">  <span class=\"comment\">// 然后利用Properties配置bean</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> getBinder().bind(annotation.prefix(), target, bindHandler);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> &lt;T&gt; BindHandler <span class=\"title function_\">getBindHandler</span><span class=\"params\">(Bindable&lt;T&gt; target, ConfigurationProperties annotation)</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 获取Validators</span></span><br><span class=\"line\">  List&lt;Validator&gt; validators = getValidators(target);</span><br><span class=\"line\">  <span class=\"type\">BindHandler</span> <span class=\"variable\">handler</span> <span class=\"operator\">=</span> getHandler();</span><br><span class=\"line\">  handler = <span class=\"keyword\">new</span> <span class=\"title class_\">ConfigurationPropertiesBindHander</span>(handler);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (annotation.ignoreInvalidFields()) &#123;</span><br><span class=\"line\">    handler = <span class=\"keyword\">new</span> <span class=\"title class_\">IgnoreErrorsBindHandler</span>(handler);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!annotation.ignoreUnknownFields()) &#123;</span><br><span class=\"line\">    <span class=\"type\">UnboundElementsSourceFilter</span> <span class=\"variable\">filter</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UnboundElementsSourceFilter</span>();</span><br><span class=\"line\">    handler = <span class=\"keyword\">new</span> <span class=\"title class_\">NoUnboundElementsBindHandler</span>(handler, filter);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 如果校验器不为空，则进行校验</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (!validators.isEmpty()) &#123;</span><br><span class=\"line\">    handler = <span class=\"keyword\">new</span> <span class=\"title class_\">ValidationBindHandler</span>(handler, validators.toArray(<span class=\"keyword\">new</span> <span class=\"title class_\">Validator</span>[<span class=\"number\">0</span>]));</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (ConfigurationPropertiesBindHandlerAdvisor advisor : getBindHandlerAdvisors()) &#123;</span><br><span class=\"line\">    handler = advisor.apply(handler);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> handler;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 对属性进行校验的验证器</span></span><br><span class=\"line\"><span class=\"keyword\">private</span> List&lt;Validator&gt; <span class=\"title function_\">getValidators</span><span class=\"params\">(Bindable&lt;?&gt; target)</span> &#123;</span><br><span class=\"line\">  List&lt;Validator&gt; validators = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(<span class=\"number\">3</span>);</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.configurationPropertiesValidator != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    validators.add(<span class=\"built_in\">this</span>.configurationPropertiesValidator);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 如果引入了jsr303(例如hibernate实现),而且bean属性上有@Validated</span></span><br><span class=\"line\">  <span class=\"comment\">// 则添加该校验</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.jsr303Present &amp;&amp; target.getAnnotation(Validated.class) != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">    validators.add(getJsr303Validator());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 如果该对象本身不为null且对象实现了Validator接口，则把自己加入到validators列表中去</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (target.getValue() != <span class=\"literal\">null</span> &amp;&amp; target.getValue().get() <span class=\"keyword\">instanceof</span> Validator) &#123;</span><br><span class=\"line\">    validators.add((Validator) target.getValue().get());</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> validators;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><ul>\n<li><p>只要被配置到容器中的类且类上标注@ConfigurationProperties都会进行属性绑定</p>\n</li>\n<li><p>属性绑定支持jsr303校验规则</p>\n</li>\n<li><p>如果该类实现了<code>org.springframework.validation.Validator</code>也可以增强校验。例如</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Component(&quot;car&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Car</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Validator</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String name;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Double price;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Date buyDate;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setName</span><span class=\"params\">(String name)</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;setter: &quot;</span> + name);</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.name = name;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">supports</span><span class=\"params\">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> clazz.isAssignableFrom(Car.class);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">validate</span><span class=\"params\">(Object target, Errors errors)</span> &#123;</span><br><span class=\"line\">        System.out.println(target);</span><br><span class=\"line\">        ValidationUtils.rejectIfEmpty(errors, <span class=\"string\">&quot;other&quot;</span>, <span class=\"string\">&quot;name不能为空&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//throw new RuntimeException();</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"思考\"><a href=\"#思考\" class=\"headerlink\" title=\"思考\"></a>思考</h3><ul>\n<li>以上实例中，实体类对应的属性配置在application.yaml,那能不能从其他自定义的yaml中配置或者从配置中心获取呢？</li>\n<li>配置的参数如何转换，例如时间，日期格式等等。</li>\n</ul>\n</li>\n</ul>\n"},{"uuid":"bbaf4817-c0ab-11ec-92a1-7557b2313227","title":"springboot 加载自定义配置文件","abbrlink":"4eeb76e3","_content":"\n在`@ConfigurationProperties`一节中，我们知道了application.yaml中配置的属性会被绑定到该类的属性中，那么如果很多配置都写到application中，会导致配置很乱。同时，如果配置是从其他远程或者目录加载，application.yaml配置并不适合的适合，怎么去加载其他的配置文件呢。下面先讲以下两种方法，其实springboot应该也支持以其他profile的形式去剥离配置，但是目前以springboot-2.5.2这块还在研究中，后续如果可以，会补充上来。\n\n## 通过`@PropertySource`注解\n\n先来看下`@PropertySource`源码\n\n```java\n@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Repeatable(PropertySources.class)\npublic @interface PropertySource {\n    /**\n     * 资源的名称\n     */\n    String name() default \"\";\n    /**\n     * 资源文件路径，可以是数据多个文件地址\n     * 可以是classpath地址如：\n     *                  \"classpath:/com/myco/app.properties\"\n     * 也可以是对应的文件系统地址如：\n     *                  \"file:/path/to/file\"\n     */\n    String[] value();\n    /**\n     * 是否忽略文件资源是否存在，默认是false,也就是说配置不存在的文件地址spring启动将会报错\n     */\n    boolean ignoreResourceNotFound() default false;\n    /**\n     * 这个没什么好说的了就是对应的字符编码了，默认是空值，如果配置文件中有中文应该设置为utf-8     */\n    String encoding() default \"\";\n    /**\n     * 关键的元素了 读取对应资源文件的工厂类了 默认的是PropertySourceFactory\n     */\n    Class<? extends PropertySourceFactory> factory() default PropertySourceFactory.class;\n}\n```\n\n对于`@PropertySource`,官方的使用说明如下：\n\n- 在一个`@Configuration`标注的类上加上该注解，并设置value属性等。实测`@Component`也可以。\n\n- 加上该注解后，即可通过`Environment`#`getProperty`获取相关的配置属性。同时也可以进行属性绑定。\n\n- `value`的属性值支持`${}`placeholde格式，所以多文件格式支持多placeholder并以逗号分隔\n\n- 如果配置多个文件而且文件配置属性值冲突，将以最后一个配置的为准\n\n- 默认的`PropertySourceFactory`是PropertySourceFactory的子类`DefaultPropertySourceFactory`该子类支持`.xml`和`.properties`文件的解析。\n\n- 如果需要支持其他文件格式例如Yaml文件解析，需要自定义解析类并实现`PropertySourceFactory`接口\n\n  ```java\n  public class YamlPropertySourceFactory implements PropertySourceFactory {\n  \n          @Override\n          public PropertySource<?> createPropertySource(String name, EncodedResource encodedResource)\n                  throws IOException {\n              YamlPropertiesFactoryBean factory = new YamlPropertiesFactoryBean();\n              factory.setResources(encodedResource.getResource());\n              Properties properties = factory.getObject();\n              return new PropertiesPropertySource(encodedResource.getResource()\n                      .getFilename(), properties);\n          }\n  }\n  ```\n\n  那么为什么`@Component`或`@Configuration`类上加上`@PropertySource`就可以解析了呢？\n\n  Spring-boot启动过程中依次调用。\n\n  - `AbstractApplicationContext`#`refresh`里的`invokeBeanFactoryPostProcessors(beanFactory)`方法\n\n    ```java\n    protected void invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory beanFactory) {\n    \t\tPostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());\n    \n    \t\t// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime\n    \t\t// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)\n    \t\tif (!NativeDetector.inNativeImage() && beanFactory.getTempClassLoader() == null && beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) {\n    \t\t\tbeanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory));\n    \t\t\tbeanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));\n    \t\t}\n    }\n    ```\n\n  - PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());\n\n    ```java\n    public static void invokeBeanFactoryPostProcessors(\n    \t\t\tConfigurableListableBeanFactory beanFactory, List<BeanFactoryPostProcessor> beanFactoryPostProcessors) {\n    \n    \t\t\t\t// 省略部分代码\n    \t\t\t\tinvokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());\n    \t\t\t\tcurrentRegistryProcessors.clear();\n    \t\t\t}\n    \t\t\t// 省略部分代码\n    \t}\n    ```\n\n  - invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());\n\n    ```java\n    private static void invokeBeanDefinitionRegistryPostProcessors(\n    \t\t\tCollection<? extends BeanDefinitionRegistryPostProcessor> postProcessors, BeanDefinitionRegistry registry, ApplicationStartup applicationStartup) {\n    \t\t\n        // 这里会执行ConfigurationClassPostProcessor#postProcessBeanDefinitionRegistry\n    \t\tfor (BeanDefinitionRegistryPostProcessor postProcessor : postProcessors) {\n    \t\t\tStartupStep postProcessBeanDefRegistry = applicationStartup.start(\"spring.context.beandef-registry.post-process\")\n    \t\t\t\t\t.tag(\"postProcessor\", postProcessor::toString);\n    \t\t\tpostProcessor.postProcessBeanDefinitionRegistry(registry);\n    \t\t\tpostProcessBeanDefRegistry.end();\n    \t\t}\n    \t}\n    ```\n\n  - ConfigurationClassPostProcessor#processConfigBeanDefinitions\n\n  - ConfigurationClassParser#doProcessConfigurationClass\n\n    ```java\n    protected final SourceClass doProcessConfigurationClass(\n    \t\t\tConfigurationClass configClass, SourceClass sourceClass, Predicate<String> filter)\n    \t\t\tthrows IOException {\n    \n    \t\tif (configClass.getMetadata().isAnnotated(Component.class.getName())) {\n    \t\t\t// Recursively process any member (nested) classes first\n    \t\t\tprocessMemberClasses(configClass, sourceClass, filter);\n    \t\t}\n    \n    \t\t// Process any @PropertySource annotations\n    \t\tfor (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(\n    \t\t\t\tsourceClass.getMetadata(), PropertySources.class,\n    \t\t\t\torg.springframework.context.annotation.PropertySource.class)) {\n    \t\t\tif (this.environment instanceof ConfigurableEnvironment) {\n    \t\t\t\tprocessPropertySource(propertySource);\n    \t\t\t}\n    \t\t\telse {\n    \t\t\t\tlogger.info(\"Ignoring @PropertySource annotation on [\" + sourceClass.getMetadata().getClassName() +\n    \t\t\t\t\t\t\"]. Reason: Environment must implement ConfigurableEnvironment\");\n    \t\t\t}\n    \t\t}\n    \n    \t\t// Process any @ComponentScan annotations\n    \t\tSet<AnnotationAttributes> componentScans = AnnotationConfigUtils.attributesForRepeatable(\n    \t\t\t\tsourceClass.getMetadata(), ComponentScans.class, ComponentScan.class);\n    \t\tif (!componentScans.isEmpty() &&\n    \t\t\t\t!this.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) {\n    \t\t\tfor (AnnotationAttributes componentScan : componentScans) {\n    \t\t\t\t// The config class is annotated with @ComponentScan -> perform the scan immediately\n    \t\t\t\tSet<BeanDefinitionHolder> scannedBeanDefinitions =\n    \t\t\t\t\t\tthis.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());\n    \t\t\t\t// Check the set of scanned definitions for any further config classes and parse recursively if needed\n    \t\t\t\tfor (BeanDefinitionHolder holder : scannedBeanDefinitions) {\n    \t\t\t\t\tBeanDefinition bdCand = holder.getBeanDefinition().getOriginatingBeanDefinition();\n    \t\t\t\t\tif (bdCand == null) {\n    \t\t\t\t\t\tbdCand = holder.getBeanDefinition();\n    \t\t\t\t\t}\n    \t\t\t\t\tif (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, this.metadataReaderFactory)) {\n    \t\t\t\t\t\tparse(bdCand.getBeanClassName(), holder.getBeanName());\n    \t\t\t\t\t}\n    \t\t\t\t}\n    \t\t\t}\n    \t\t}\n    \n    \t\t// Process any @Import annotations\n    \t\tprocessImports(configClass, sourceClass, getImports(sourceClass), filter, true);\n    \n    \t\t// Process any @ImportResource annotations\n    \t\tAnnotationAttributes importResource =\n    \t\t\t\tAnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);\n    \t\tif (importResource != null) {\n    \t\t\tString[] resources = importResource.getStringArray(\"locations\");\n    \t\t\tClass<? extends BeanDefinitionReader> readerClass = importResource.getClass(\"reader\");\n    \t\t\tfor (String resource : resources) {\n    \t\t\t\tString resolvedResource = this.environment.resolveRequiredPlaceholders(resource);\n    \t\t\t\tconfigClass.addImportedResource(resolvedResource, readerClass);\n    \t\t\t}\n    \t\t}\n    \n    \t\t// Process individual @Bean methods\n    \t\tSet<MethodMetadata> beanMethods = retrieveBeanMethodMetadata(sourceClass);\n    \t\tfor (MethodMetadata methodMetadata : beanMethods) {\n    \t\t\tconfigClass.addBeanMethod(new BeanMethod(methodMetadata, configClass));\n    \t\t}\n    \n    \t\t// Process default methods on interfaces\n    \t\tprocessInterfaces(configClass, sourceClass);\n    \n    \t\t// Process superclass, if any\n    \t\tif (sourceClass.getMetadata().hasSuperClass()) {\n    \t\t\tString superclass = sourceClass.getMetadata().getSuperClassName();\n    \t\t\tif (superclass != null && !superclass.startsWith(\"java\") &&\n    \t\t\t\t\t!this.knownSuperclasses.containsKey(superclass)) {\n    \t\t\t\tthis.knownSuperclasses.put(superclass, configClass);\n    \t\t\t\t// Superclass found, return its annotation metadata and recurse\n    \t\t\t\treturn sourceClass.getSuperClass();\n    \t\t\t}\n    \t\t}\n    \n    \t\t// No superclass -> processing is complete\n    \t\treturn null;\n    \t}\n    ```\n\n  - ConfigurationClassParser#processPropertySource\n\n    ```java\n    private void processPropertySource(AnnotationAttributes propertySource) throws IOException {\n    \t\tString name = propertySource.getString(\"name\");\n    \t\tif (!StringUtils.hasLength(name)) {\n    \t\t\tname = null;\n    \t\t}\n    \t\tString encoding = propertySource.getString(\"encoding\");\n    \t\tif (!StringUtils.hasLength(encoding)) {\n    \t\t\tencoding = null;\n    \t\t}\n    \t\tString[] locations = propertySource.getStringArray(\"value\");\n    \t\tAssert.isTrue(locations.length > 0, \"At least one @PropertySource(value) location is required\");\n    \t\tboolean ignoreResourceNotFound = propertySource.getBoolean(\"ignoreResourceNotFound\");\n    \n    \t\tClass<? extends PropertySourceFactory> factoryClass = propertySource.getClass(\"factory\");\n    \t\tPropertySourceFactory factory = (factoryClass == PropertySourceFactory.class ?\n    \t\t\t\tDEFAULT_PROPERTY_SOURCE_FACTORY : BeanUtils.instantiateClass(factoryClass));\n    \n    \t\tfor (String location : locations) {\n    \t\t\ttry {\n    \t\t\t\tString resolvedLocation = this.environment.resolveRequiredPlaceholders(location);\n    \t\t\t\tResource resource = this.resourceLoader.getResource(resolvedLocation);\n    \t\t\t\taddPropertySource(factory.createPropertySource(name, new EncodedResource(resource, encoding)));\n    \t\t\t}\n    \t\t\tcatch (IllegalArgumentException | FileNotFoundException | UnknownHostException | SocketException ex) {\n    \t\t\t\t// Placeholders not resolvable or resource not found when trying to open it\n    \t\t\t\tif (ignoreResourceNotFound) {\n    \t\t\t\t\tif (logger.isInfoEnabled()) {\n    \t\t\t\t\t\tlogger.info(\"Properties location [\" + location + \"] not resolvable: \" + ex.getMessage());\n    \t\t\t\t\t}\n    \t\t\t\t}\n    \t\t\t\telse {\n    \t\t\t\t\tthrow ex;\n    \t\t\t\t}\n    \t\t\t}\n    \t\t}\n    \t}\n    ```\n\n    这里有两个比较重要的方法\n\n    ```java\n    // ApplicationServeletEnvironment\n    // 这里去解析placeholder\n    String resolvedLocation = this.environment.resolveRequiredPlaceholders(location);\n    //org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplic//ationContext\n    // 这里去获取resource 例如 file:xxx,classpath:xxx\n    Resource resource = this.resourceLoader.getResource(resolvedLocation);\n    // 把propertyResource添加到Environment中的MutablePropertySources\n    addPropertySource(factory.createPropertySource(name, new EncodedResource(resource, encoding)));\n    ```\n\n    上面的流程走完就把PropertiesPropertySource添加到Environment中了，最后只需要按需获取或绑定属性就行了。\n\n    ##  通过EnvironmentPostProcessor设置\n\n    ### 1.编写类实现该接口\n\n    ```java\n    // 这里配置在最后执行\n    @Order(Ordered.LOWEST_PRECEDENCE)\n    public class MyEnvironmentPostProcessor implements EnvironmentPostProcessor {\n    \n        @Override\n        public void postProcessEnvironment(ConfigurableEnvironment environment,\n                                           SpringApplication application) {\n    \t\t\t\t\n            YamlPropertiesFactoryBean yaml = new YamlPropertiesFactoryBean();\n            // 通过环境变量获取files路径，这里可以配置在application.yaml中或环境变量中\n            String files = environment.getProperty(\"files\");\n    \t\t\t\t// 我们在上面讲到PropertyResource是通过ResourceLoader加载资源的\n            // 包括各种路径资源file:xxx或者classpath:xxx \n            DefaultResourceLoader defaultResourceLoader = new DefaultResourceLoader();\n            Resource resource = defaultResourceLoader.getResource(files);\n          \t\n            yaml.setResources(resource);\n            MutablePropertySources propertySources = environment.getPropertySources();\n            propertySources.addFirst(new PropertiesPropertySource(\"Config\", yaml.getObject()));\n        }\n    }\n    ```\n\n    ### 2.配置spring.factories 使MyEnvironmentPostProcessor生效\n\n    在resource下创建**META-INF**文件夹，在**META-INF**下创建**spring.factories**，并且引入刚刚编写的**MyEnvironmentPostProcessor** 类\n\n    ```\n    org.springframework.boot.env.EnvironmentPostProcessor=MyEnvironmentPostProcessor\n    ```\n\n    这样也可以配置资源文件了。\n\n    ### 3.思考\n\n    - 通过environmentPostProcessor的资源文件如何动态设置呢\n    - environmentPostProcessor的原理是啥，是怎么动态调用的\n    - spring中resourceLoader有哪些，是怎么动态处理不同的资源的。`DefaultResourceLoader`是怎么做到的。\n","source":"_posts/spring/Springboot加载自定义配置文件.md","raw":"---\nuuid: bbaf4817-c0ab-11ec-92a1-7557b2313227\ntitle: springboot 加载自定义配置文件\ncategories: Java\ntags:\n  - springBoot\nabbrlink: 4eeb76e3\n---\n\n在`@ConfigurationProperties`一节中，我们知道了application.yaml中配置的属性会被绑定到该类的属性中，那么如果很多配置都写到application中，会导致配置很乱。同时，如果配置是从其他远程或者目录加载，application.yaml配置并不适合的适合，怎么去加载其他的配置文件呢。下面先讲以下两种方法，其实springboot应该也支持以其他profile的形式去剥离配置，但是目前以springboot-2.5.2这块还在研究中，后续如果可以，会补充上来。\n\n## 通过`@PropertySource`注解\n\n先来看下`@PropertySource`源码\n\n```java\n@Target(ElementType.TYPE)\n@Retention(RetentionPolicy.RUNTIME)\n@Documented\n@Repeatable(PropertySources.class)\npublic @interface PropertySource {\n    /**\n     * 资源的名称\n     */\n    String name() default \"\";\n    /**\n     * 资源文件路径，可以是数据多个文件地址\n     * 可以是classpath地址如：\n     *                  \"classpath:/com/myco/app.properties\"\n     * 也可以是对应的文件系统地址如：\n     *                  \"file:/path/to/file\"\n     */\n    String[] value();\n    /**\n     * 是否忽略文件资源是否存在，默认是false,也就是说配置不存在的文件地址spring启动将会报错\n     */\n    boolean ignoreResourceNotFound() default false;\n    /**\n     * 这个没什么好说的了就是对应的字符编码了，默认是空值，如果配置文件中有中文应该设置为utf-8     */\n    String encoding() default \"\";\n    /**\n     * 关键的元素了 读取对应资源文件的工厂类了 默认的是PropertySourceFactory\n     */\n    Class<? extends PropertySourceFactory> factory() default PropertySourceFactory.class;\n}\n```\n\n对于`@PropertySource`,官方的使用说明如下：\n\n- 在一个`@Configuration`标注的类上加上该注解，并设置value属性等。实测`@Component`也可以。\n\n- 加上该注解后，即可通过`Environment`#`getProperty`获取相关的配置属性。同时也可以进行属性绑定。\n\n- `value`的属性值支持`${}`placeholde格式，所以多文件格式支持多placeholder并以逗号分隔\n\n- 如果配置多个文件而且文件配置属性值冲突，将以最后一个配置的为准\n\n- 默认的`PropertySourceFactory`是PropertySourceFactory的子类`DefaultPropertySourceFactory`该子类支持`.xml`和`.properties`文件的解析。\n\n- 如果需要支持其他文件格式例如Yaml文件解析，需要自定义解析类并实现`PropertySourceFactory`接口\n\n  ```java\n  public class YamlPropertySourceFactory implements PropertySourceFactory {\n  \n          @Override\n          public PropertySource<?> createPropertySource(String name, EncodedResource encodedResource)\n                  throws IOException {\n              YamlPropertiesFactoryBean factory = new YamlPropertiesFactoryBean();\n              factory.setResources(encodedResource.getResource());\n              Properties properties = factory.getObject();\n              return new PropertiesPropertySource(encodedResource.getResource()\n                      .getFilename(), properties);\n          }\n  }\n  ```\n\n  那么为什么`@Component`或`@Configuration`类上加上`@PropertySource`就可以解析了呢？\n\n  Spring-boot启动过程中依次调用。\n\n  - `AbstractApplicationContext`#`refresh`里的`invokeBeanFactoryPostProcessors(beanFactory)`方法\n\n    ```java\n    protected void invokeBeanFactoryPostProcessors(ConfigurableListableBeanFactory beanFactory) {\n    \t\tPostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());\n    \n    \t\t// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime\n    \t\t// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)\n    \t\tif (!NativeDetector.inNativeImage() && beanFactory.getTempClassLoader() == null && beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) {\n    \t\t\tbeanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory));\n    \t\t\tbeanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));\n    \t\t}\n    }\n    ```\n\n  - PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());\n\n    ```java\n    public static void invokeBeanFactoryPostProcessors(\n    \t\t\tConfigurableListableBeanFactory beanFactory, List<BeanFactoryPostProcessor> beanFactoryPostProcessors) {\n    \n    \t\t\t\t// 省略部分代码\n    \t\t\t\tinvokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());\n    \t\t\t\tcurrentRegistryProcessors.clear();\n    \t\t\t}\n    \t\t\t// 省略部分代码\n    \t}\n    ```\n\n  - invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());\n\n    ```java\n    private static void invokeBeanDefinitionRegistryPostProcessors(\n    \t\t\tCollection<? extends BeanDefinitionRegistryPostProcessor> postProcessors, BeanDefinitionRegistry registry, ApplicationStartup applicationStartup) {\n    \t\t\n        // 这里会执行ConfigurationClassPostProcessor#postProcessBeanDefinitionRegistry\n    \t\tfor (BeanDefinitionRegistryPostProcessor postProcessor : postProcessors) {\n    \t\t\tStartupStep postProcessBeanDefRegistry = applicationStartup.start(\"spring.context.beandef-registry.post-process\")\n    \t\t\t\t\t.tag(\"postProcessor\", postProcessor::toString);\n    \t\t\tpostProcessor.postProcessBeanDefinitionRegistry(registry);\n    \t\t\tpostProcessBeanDefRegistry.end();\n    \t\t}\n    \t}\n    ```\n\n  - ConfigurationClassPostProcessor#processConfigBeanDefinitions\n\n  - ConfigurationClassParser#doProcessConfigurationClass\n\n    ```java\n    protected final SourceClass doProcessConfigurationClass(\n    \t\t\tConfigurationClass configClass, SourceClass sourceClass, Predicate<String> filter)\n    \t\t\tthrows IOException {\n    \n    \t\tif (configClass.getMetadata().isAnnotated(Component.class.getName())) {\n    \t\t\t// Recursively process any member (nested) classes first\n    \t\t\tprocessMemberClasses(configClass, sourceClass, filter);\n    \t\t}\n    \n    \t\t// Process any @PropertySource annotations\n    \t\tfor (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(\n    \t\t\t\tsourceClass.getMetadata(), PropertySources.class,\n    \t\t\t\torg.springframework.context.annotation.PropertySource.class)) {\n    \t\t\tif (this.environment instanceof ConfigurableEnvironment) {\n    \t\t\t\tprocessPropertySource(propertySource);\n    \t\t\t}\n    \t\t\telse {\n    \t\t\t\tlogger.info(\"Ignoring @PropertySource annotation on [\" + sourceClass.getMetadata().getClassName() +\n    \t\t\t\t\t\t\"]. Reason: Environment must implement ConfigurableEnvironment\");\n    \t\t\t}\n    \t\t}\n    \n    \t\t// Process any @ComponentScan annotations\n    \t\tSet<AnnotationAttributes> componentScans = AnnotationConfigUtils.attributesForRepeatable(\n    \t\t\t\tsourceClass.getMetadata(), ComponentScans.class, ComponentScan.class);\n    \t\tif (!componentScans.isEmpty() &&\n    \t\t\t\t!this.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) {\n    \t\t\tfor (AnnotationAttributes componentScan : componentScans) {\n    \t\t\t\t// The config class is annotated with @ComponentScan -> perform the scan immediately\n    \t\t\t\tSet<BeanDefinitionHolder> scannedBeanDefinitions =\n    \t\t\t\t\t\tthis.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());\n    \t\t\t\t// Check the set of scanned definitions for any further config classes and parse recursively if needed\n    \t\t\t\tfor (BeanDefinitionHolder holder : scannedBeanDefinitions) {\n    \t\t\t\t\tBeanDefinition bdCand = holder.getBeanDefinition().getOriginatingBeanDefinition();\n    \t\t\t\t\tif (bdCand == null) {\n    \t\t\t\t\t\tbdCand = holder.getBeanDefinition();\n    \t\t\t\t\t}\n    \t\t\t\t\tif (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, this.metadataReaderFactory)) {\n    \t\t\t\t\t\tparse(bdCand.getBeanClassName(), holder.getBeanName());\n    \t\t\t\t\t}\n    \t\t\t\t}\n    \t\t\t}\n    \t\t}\n    \n    \t\t// Process any @Import annotations\n    \t\tprocessImports(configClass, sourceClass, getImports(sourceClass), filter, true);\n    \n    \t\t// Process any @ImportResource annotations\n    \t\tAnnotationAttributes importResource =\n    \t\t\t\tAnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);\n    \t\tif (importResource != null) {\n    \t\t\tString[] resources = importResource.getStringArray(\"locations\");\n    \t\t\tClass<? extends BeanDefinitionReader> readerClass = importResource.getClass(\"reader\");\n    \t\t\tfor (String resource : resources) {\n    \t\t\t\tString resolvedResource = this.environment.resolveRequiredPlaceholders(resource);\n    \t\t\t\tconfigClass.addImportedResource(resolvedResource, readerClass);\n    \t\t\t}\n    \t\t}\n    \n    \t\t// Process individual @Bean methods\n    \t\tSet<MethodMetadata> beanMethods = retrieveBeanMethodMetadata(sourceClass);\n    \t\tfor (MethodMetadata methodMetadata : beanMethods) {\n    \t\t\tconfigClass.addBeanMethod(new BeanMethod(methodMetadata, configClass));\n    \t\t}\n    \n    \t\t// Process default methods on interfaces\n    \t\tprocessInterfaces(configClass, sourceClass);\n    \n    \t\t// Process superclass, if any\n    \t\tif (sourceClass.getMetadata().hasSuperClass()) {\n    \t\t\tString superclass = sourceClass.getMetadata().getSuperClassName();\n    \t\t\tif (superclass != null && !superclass.startsWith(\"java\") &&\n    \t\t\t\t\t!this.knownSuperclasses.containsKey(superclass)) {\n    \t\t\t\tthis.knownSuperclasses.put(superclass, configClass);\n    \t\t\t\t// Superclass found, return its annotation metadata and recurse\n    \t\t\t\treturn sourceClass.getSuperClass();\n    \t\t\t}\n    \t\t}\n    \n    \t\t// No superclass -> processing is complete\n    \t\treturn null;\n    \t}\n    ```\n\n  - ConfigurationClassParser#processPropertySource\n\n    ```java\n    private void processPropertySource(AnnotationAttributes propertySource) throws IOException {\n    \t\tString name = propertySource.getString(\"name\");\n    \t\tif (!StringUtils.hasLength(name)) {\n    \t\t\tname = null;\n    \t\t}\n    \t\tString encoding = propertySource.getString(\"encoding\");\n    \t\tif (!StringUtils.hasLength(encoding)) {\n    \t\t\tencoding = null;\n    \t\t}\n    \t\tString[] locations = propertySource.getStringArray(\"value\");\n    \t\tAssert.isTrue(locations.length > 0, \"At least one @PropertySource(value) location is required\");\n    \t\tboolean ignoreResourceNotFound = propertySource.getBoolean(\"ignoreResourceNotFound\");\n    \n    \t\tClass<? extends PropertySourceFactory> factoryClass = propertySource.getClass(\"factory\");\n    \t\tPropertySourceFactory factory = (factoryClass == PropertySourceFactory.class ?\n    \t\t\t\tDEFAULT_PROPERTY_SOURCE_FACTORY : BeanUtils.instantiateClass(factoryClass));\n    \n    \t\tfor (String location : locations) {\n    \t\t\ttry {\n    \t\t\t\tString resolvedLocation = this.environment.resolveRequiredPlaceholders(location);\n    \t\t\t\tResource resource = this.resourceLoader.getResource(resolvedLocation);\n    \t\t\t\taddPropertySource(factory.createPropertySource(name, new EncodedResource(resource, encoding)));\n    \t\t\t}\n    \t\t\tcatch (IllegalArgumentException | FileNotFoundException | UnknownHostException | SocketException ex) {\n    \t\t\t\t// Placeholders not resolvable or resource not found when trying to open it\n    \t\t\t\tif (ignoreResourceNotFound) {\n    \t\t\t\t\tif (logger.isInfoEnabled()) {\n    \t\t\t\t\t\tlogger.info(\"Properties location [\" + location + \"] not resolvable: \" + ex.getMessage());\n    \t\t\t\t\t}\n    \t\t\t\t}\n    \t\t\t\telse {\n    \t\t\t\t\tthrow ex;\n    \t\t\t\t}\n    \t\t\t}\n    \t\t}\n    \t}\n    ```\n\n    这里有两个比较重要的方法\n\n    ```java\n    // ApplicationServeletEnvironment\n    // 这里去解析placeholder\n    String resolvedLocation = this.environment.resolveRequiredPlaceholders(location);\n    //org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplic//ationContext\n    // 这里去获取resource 例如 file:xxx,classpath:xxx\n    Resource resource = this.resourceLoader.getResource(resolvedLocation);\n    // 把propertyResource添加到Environment中的MutablePropertySources\n    addPropertySource(factory.createPropertySource(name, new EncodedResource(resource, encoding)));\n    ```\n\n    上面的流程走完就把PropertiesPropertySource添加到Environment中了，最后只需要按需获取或绑定属性就行了。\n\n    ##  通过EnvironmentPostProcessor设置\n\n    ### 1.编写类实现该接口\n\n    ```java\n    // 这里配置在最后执行\n    @Order(Ordered.LOWEST_PRECEDENCE)\n    public class MyEnvironmentPostProcessor implements EnvironmentPostProcessor {\n    \n        @Override\n        public void postProcessEnvironment(ConfigurableEnvironment environment,\n                                           SpringApplication application) {\n    \t\t\t\t\n            YamlPropertiesFactoryBean yaml = new YamlPropertiesFactoryBean();\n            // 通过环境变量获取files路径，这里可以配置在application.yaml中或环境变量中\n            String files = environment.getProperty(\"files\");\n    \t\t\t\t// 我们在上面讲到PropertyResource是通过ResourceLoader加载资源的\n            // 包括各种路径资源file:xxx或者classpath:xxx \n            DefaultResourceLoader defaultResourceLoader = new DefaultResourceLoader();\n            Resource resource = defaultResourceLoader.getResource(files);\n          \t\n            yaml.setResources(resource);\n            MutablePropertySources propertySources = environment.getPropertySources();\n            propertySources.addFirst(new PropertiesPropertySource(\"Config\", yaml.getObject()));\n        }\n    }\n    ```\n\n    ### 2.配置spring.factories 使MyEnvironmentPostProcessor生效\n\n    在resource下创建**META-INF**文件夹，在**META-INF**下创建**spring.factories**，并且引入刚刚编写的**MyEnvironmentPostProcessor** 类\n\n    ```\n    org.springframework.boot.env.EnvironmentPostProcessor=MyEnvironmentPostProcessor\n    ```\n\n    这样也可以配置资源文件了。\n\n    ### 3.思考\n\n    - 通过environmentPostProcessor的资源文件如何动态设置呢\n    - environmentPostProcessor的原理是啥，是怎么动态调用的\n    - spring中resourceLoader有哪些，是怎么动态处理不同的资源的。`DefaultResourceLoader`是怎么做到的。\n","slug":"spring/Springboot加载自定义配置文件","published":1,"date":"2022-04-20T12:41:20.916Z","updated":"2022-05-04T03:23:10.877Z","_id":"cl2qzfti9004j13no7w0247s2","comments":1,"layout":"post","photos":[],"link":"","content":"<p>在<code>@ConfigurationProperties</code>一节中，我们知道了application.yaml中配置的属性会被绑定到该类的属性中，那么如果很多配置都写到application中，会导致配置很乱。同时，如果配置是从其他远程或者目录加载，application.yaml配置并不适合的适合，怎么去加载其他的配置文件呢。下面先讲以下两种方法，其实springboot应该也支持以其他profile的形式去剥离配置，但是目前以springboot-2.5.2这块还在研究中，后续如果可以，会补充上来。</p>\n<h2 id=\"通过-PropertySource注解\"><a href=\"#通过-PropertySource注解\" class=\"headerlink\" title=\"通过@PropertySource注解\"></a>通过<code>@PropertySource</code>注解</h2><p>先来看下<code>@PropertySource</code>源码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(ElementType.TYPE)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Repeatable(PropertySources.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> PropertySource &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 资源的名称</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    String <span class=\"title function_\">name</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 资源文件路径，可以是数据多个文件地址</span></span><br><span class=\"line\"><span class=\"comment\">     * 可以是classpath地址如：</span></span><br><span class=\"line\"><span class=\"comment\">     *                  &quot;classpath:/com/myco/app.properties&quot;</span></span><br><span class=\"line\"><span class=\"comment\">     * 也可以是对应的文件系统地址如：</span></span><br><span class=\"line\"><span class=\"comment\">     *                  &quot;file:/path/to/file&quot;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    String[] value();</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 是否忽略文件资源是否存在，默认是false,也就是说配置不存在的文件地址spring启动将会报错</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">ignoreResourceNotFound</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 这个没什么好说的了就是对应的字符编码了，默认是空值，如果配置文件中有中文应该设置为utf-8     */</span></span><br><span class=\"line\">    String <span class=\"title function_\">encoding</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 关键的元素了 读取对应资源文件的工厂类了 默认的是PropertySourceFactory</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    Class&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">PropertySourceFactory</span>&gt; factory() <span class=\"keyword\">default</span> PropertySourceFactory.class;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对于<code>@PropertySource</code>,官方的使用说明如下：</p>\n<ul>\n<li><p>在一个<code>@Configuration</code>标注的类上加上该注解，并设置value属性等。实测<code>@Component</code>也可以。</p>\n</li>\n<li><p>加上该注解后，即可通过<code>Environment</code>#<code>getProperty</code>获取相关的配置属性。同时也可以进行属性绑定。</p>\n</li>\n<li><p><code>value</code>的属性值支持<code>$&#123;&#125;</code>placeholde格式，所以多文件格式支持多placeholder并以逗号分隔</p>\n</li>\n<li><p>如果配置多个文件而且文件配置属性值冲突，将以最后一个配置的为准</p>\n</li>\n<li><p>默认的<code>PropertySourceFactory</code>是PropertySourceFactory的子类<code>DefaultPropertySourceFactory</code>该子类支持<code>.xml</code>和<code>.properties</code>文件的解析。</p>\n</li>\n<li><p>如果需要支持其他文件格式例如Yaml文件解析，需要自定义解析类并实现<code>PropertySourceFactory</code>接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">YamlPropertySourceFactory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">PropertySourceFactory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> PropertySource&lt;?&gt; createPropertySource(String name, EncodedResource encodedResource)</span><br><span class=\"line\">                <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">            <span class=\"type\">YamlPropertiesFactoryBean</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">YamlPropertiesFactoryBean</span>();</span><br><span class=\"line\">            factory.setResources(encodedResource.getResource());</span><br><span class=\"line\">            <span class=\"type\">Properties</span> <span class=\"variable\">properties</span> <span class=\"operator\">=</span> factory.getObject();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PropertiesPropertySource</span>(encodedResource.getResource()</span><br><span class=\"line\">                    .getFilename(), properties);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>那么为什么<code>@Component</code>或<code>@Configuration</code>类上加上<code>@PropertySource</code>就可以解析了呢？</p>\n<p>Spring-boot启动过程中依次调用。</p>\n<ul>\n<li><p><code>AbstractApplicationContext</code>#<code>refresh</code>里的<code>invokeBeanFactoryPostProcessors(beanFactory)</code>方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">invokeBeanFactoryPostProcessors</span><span class=\"params\">(ConfigurableListableBeanFactory beanFactory)</span> &#123;</span><br><span class=\"line\">\t\tPostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!NativeDetector.inNativeImage() &amp;&amp; beanFactory.getTempClassLoader() == <span class=\"literal\">null</span> &amp;&amp; beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) &#123;</span><br><span class=\"line\">\t\t\tbeanFactory.addBeanPostProcessor(<span class=\"keyword\">new</span> <span class=\"title class_\">LoadTimeWeaverAwareProcessor</span>(beanFactory));</span><br><span class=\"line\">\t\t\tbeanFactory.setTempClassLoader(<span class=\"keyword\">new</span> <span class=\"title class_\">ContextTypeMatchClassLoader</span>(beanFactory.getBeanClassLoader()));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">invokeBeanFactoryPostProcessors</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">\t\t\tConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 省略部分代码</span></span><br><span class=\"line\">\t\t\t\tinvokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());</span><br><span class=\"line\">\t\t\t\tcurrentRegistryProcessors.clear();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 省略部分代码</span></span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">invokeBeanDefinitionRegistryPostProcessors</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">\t\t\tCollection&lt;? extends BeanDefinitionRegistryPostProcessor&gt; postProcessors, BeanDefinitionRegistry registry, ApplicationStartup applicationStartup)</span> &#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">    <span class=\"comment\">// 这里会执行ConfigurationClassPostProcessor#postProcessBeanDefinitionRegistry</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (BeanDefinitionRegistryPostProcessor postProcessor : postProcessors) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"type\">StartupStep</span> <span class=\"variable\">postProcessBeanDefRegistry</span> <span class=\"operator\">=</span> applicationStartup.start(<span class=\"string\">&quot;spring.context.beandef-registry.post-process&quot;</span>)</span><br><span class=\"line\">\t\t\t\t\t.tag(<span class=\"string\">&quot;postProcessor&quot;</span>, postProcessor::toString);</span><br><span class=\"line\">\t\t\tpostProcessor.postProcessBeanDefinitionRegistry(registry);</span><br><span class=\"line\">\t\t\tpostProcessBeanDefRegistry.end();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>ConfigurationClassPostProcessor#processConfigBeanDefinitions</p>\n</li>\n<li><p>ConfigurationClassParser#doProcessConfigurationClass</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">final</span> SourceClass <span class=\"title function_\">doProcessConfigurationClass</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">\t\t\tConfigurationClass configClass, SourceClass sourceClass, Predicate&lt;String&gt; filter)</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (configClass.getMetadata().isAnnotated(Component.class.getName())) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Recursively process any member (nested) classes first</span></span><br><span class=\"line\">\t\t\tprocessMemberClasses(configClass, sourceClass, filter);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process any @PropertySource annotations</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(</span><br><span class=\"line\">\t\t\t\tsourceClass.getMetadata(), PropertySources.class,</span><br><span class=\"line\">\t\t\t\torg.springframework.context.annotation.PropertySource.class)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.environment <span class=\"keyword\">instanceof</span> ConfigurableEnvironment) &#123;</span><br><span class=\"line\">\t\t\t\tprocessPropertySource(propertySource);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tlogger.info(<span class=\"string\">&quot;Ignoring @PropertySource annotation on [&quot;</span> + sourceClass.getMetadata().getClassName() +</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"string\">&quot;]. Reason: Environment must implement ConfigurableEnvironment&quot;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process any @ComponentScan annotations</span></span><br><span class=\"line\">\t\tSet&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable(</span><br><span class=\"line\">\t\t\t\tsourceClass.getMetadata(), ComponentScans.class, ComponentScan.class);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!componentScans.isEmpty() &amp;&amp;</span><br><span class=\"line\">\t\t\t\t!<span class=\"built_in\">this</span>.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (AnnotationAttributes componentScan : componentScans) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// The config class is annotated with @ComponentScan -&gt; perform the scan immediately</span></span><br><span class=\"line\">\t\t\t\tSet&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions =</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"built_in\">this</span>.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Check the set of scanned definitions for any further config classes and parse recursively if needed</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (BeanDefinitionHolder holder : scannedBeanDefinitions) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">BeanDefinition</span> <span class=\"variable\">bdCand</span> <span class=\"operator\">=</span> holder.getBeanDefinition().getOriginatingBeanDefinition();</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (bdCand == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tbdCand = holder.getBeanDefinition();</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, <span class=\"built_in\">this</span>.metadataReaderFactory)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tparse(bdCand.getBeanClassName(), holder.getBeanName());</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process any @Import annotations</span></span><br><span class=\"line\">\t\tprocessImports(configClass, sourceClass, getImports(sourceClass), filter, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process any @ImportResource annotations</span></span><br><span class=\"line\">\t\t<span class=\"type\">AnnotationAttributes</span> <span class=\"variable\">importResource</span> <span class=\"operator\">=</span></span><br><span class=\"line\">\t\t\t\tAnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (importResource != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tString[] resources = importResource.getStringArray(<span class=\"string\">&quot;locations&quot;</span>);</span><br><span class=\"line\">\t\t\tClass&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">BeanDefinitionReader</span>&gt; readerClass = importResource.getClass(<span class=\"string\">&quot;reader&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (String resource : resources) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"type\">String</span> <span class=\"variable\">resolvedResource</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.environment.resolveRequiredPlaceholders(resource);</span><br><span class=\"line\">\t\t\t\tconfigClass.addImportedResource(resolvedResource, readerClass);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process individual @Bean methods</span></span><br><span class=\"line\">\t\tSet&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (MethodMetadata methodMetadata : beanMethods) &#123;</span><br><span class=\"line\">\t\t\tconfigClass.addBeanMethod(<span class=\"keyword\">new</span> <span class=\"title class_\">BeanMethod</span>(methodMetadata, configClass));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process default methods on interfaces</span></span><br><span class=\"line\">\t\tprocessInterfaces(configClass, sourceClass);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process superclass, if any</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (sourceClass.getMetadata().hasSuperClass()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"type\">String</span> <span class=\"variable\">superclass</span> <span class=\"operator\">=</span> sourceClass.getMetadata().getSuperClassName();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (superclass != <span class=\"literal\">null</span> &amp;&amp; !superclass.startsWith(<span class=\"string\">&quot;java&quot;</span>) &amp;&amp;</span><br><span class=\"line\">\t\t\t\t\t!<span class=\"built_in\">this</span>.knownSuperclasses.containsKey(superclass)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.knownSuperclasses.put(superclass, configClass);</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Superclass found, return its annotation metadata and recurse</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> sourceClass.getSuperClass();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// No superclass -&gt; processing is complete</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>ConfigurationClassParser#processPropertySource</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">processPropertySource</span><span class=\"params\">(AnnotationAttributes propertySource)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> propertySource.getString(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!StringUtils.hasLength(name)) &#123;</span><br><span class=\"line\">\t\t\tname = <span class=\"literal\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"type\">String</span> <span class=\"variable\">encoding</span> <span class=\"operator\">=</span> propertySource.getString(<span class=\"string\">&quot;encoding&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!StringUtils.hasLength(encoding)) &#123;</span><br><span class=\"line\">\t\t\tencoding = <span class=\"literal\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tString[] locations = propertySource.getStringArray(<span class=\"string\">&quot;value&quot;</span>);</span><br><span class=\"line\">\t\tAssert.isTrue(locations.length &gt; <span class=\"number\">0</span>, <span class=\"string\">&quot;At least one @PropertySource(value) location is required&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"type\">boolean</span> <span class=\"variable\">ignoreResourceNotFound</span> <span class=\"operator\">=</span> propertySource.getBoolean(<span class=\"string\">&quot;ignoreResourceNotFound&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tClass&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">PropertySourceFactory</span>&gt; factoryClass = propertySource.getClass(<span class=\"string\">&quot;factory&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"type\">PropertySourceFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> (factoryClass == PropertySourceFactory.class ?</span><br><span class=\"line\">\t\t\t\tDEFAULT_PROPERTY_SOURCE_FACTORY : BeanUtils.instantiateClass(factoryClass));</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (String location : locations) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"type\">String</span> <span class=\"variable\">resolvedLocation</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.environment.resolveRequiredPlaceholders(location);</span><br><span class=\"line\">\t\t\t\t<span class=\"type\">Resource</span> <span class=\"variable\">resource</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.resourceLoader.getResource(resolvedLocation);</span><br><span class=\"line\">\t\t\t\taddPropertySource(factory.createPropertySource(name, <span class=\"keyword\">new</span> <span class=\"title class_\">EncodedResource</span>(resource, encoding)));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">catch</span> (IllegalArgumentException | FileNotFoundException | UnknownHostException | SocketException ex) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Placeholders not resolvable or resource not found when trying to open it</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ignoreResourceNotFound) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tlogger.info(<span class=\"string\">&quot;Properties location [&quot;</span> + location + <span class=\"string\">&quot;] not resolvable: &quot;</span> + ex.getMessage());</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">throw</span> ex;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里有两个比较重要的方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ApplicationServeletEnvironment</span></span><br><span class=\"line\"><span class=\"comment\">// 这里去解析placeholder</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">resolvedLocation</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.environment.resolveRequiredPlaceholders(location);</span><br><span class=\"line\"><span class=\"comment\">//org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplic//ationContext</span></span><br><span class=\"line\"><span class=\"comment\">// 这里去获取resource 例如 file:xxx,classpath:xxx</span></span><br><span class=\"line\"><span class=\"type\">Resource</span> <span class=\"variable\">resource</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.resourceLoader.getResource(resolvedLocation);</span><br><span class=\"line\"><span class=\"comment\">// 把propertyResource添加到Environment中的MutablePropertySources</span></span><br><span class=\"line\">addPropertySource(factory.createPropertySource(name, <span class=\"keyword\">new</span> <span class=\"title class_\">EncodedResource</span>(resource, encoding)));</span><br></pre></td></tr></table></figure>\n\n<p>上面的流程走完就把PropertiesPropertySource添加到Environment中了，最后只需要按需获取或绑定属性就行了。</p>\n<h2 id=\"通过EnvironmentPostProcessor设置\"><a href=\"#通过EnvironmentPostProcessor设置\" class=\"headerlink\" title=\"通过EnvironmentPostProcessor设置\"></a>通过EnvironmentPostProcessor设置</h2><h3 id=\"1-编写类实现该接口\"><a href=\"#1-编写类实现该接口\" class=\"headerlink\" title=\"1.编写类实现该接口\"></a>1.编写类实现该接口</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这里配置在最后执行</span></span><br><span class=\"line\"><span class=\"meta\">@Order(Ordered.LOWEST_PRECEDENCE)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyEnvironmentPostProcessor</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">EnvironmentPostProcessor</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postProcessEnvironment</span><span class=\"params\">(ConfigurableEnvironment environment,</span></span><br><span class=\"line\"><span class=\"params\">                                       SpringApplication application)</span> &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">        <span class=\"type\">YamlPropertiesFactoryBean</span> <span class=\"variable\">yaml</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">YamlPropertiesFactoryBean</span>();</span><br><span class=\"line\">        <span class=\"comment\">// 通过环境变量获取files路径，这里可以配置在application.yaml中或环境变量中</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">files</span> <span class=\"operator\">=</span> environment.getProperty(<span class=\"string\">&quot;files&quot;</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 我们在上面讲到PropertyResource是通过ResourceLoader加载资源的</span></span><br><span class=\"line\">        <span class=\"comment\">// 包括各种路径资源file:xxx或者classpath:xxx </span></span><br><span class=\"line\">        <span class=\"type\">DefaultResourceLoader</span> <span class=\"variable\">defaultResourceLoader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultResourceLoader</span>();</span><br><span class=\"line\">        <span class=\"type\">Resource</span> <span class=\"variable\">resource</span> <span class=\"operator\">=</span> defaultResourceLoader.getResource(files);</span><br><span class=\"line\">      \t</span><br><span class=\"line\">        yaml.setResources(resource);</span><br><span class=\"line\">        <span class=\"type\">MutablePropertySources</span> <span class=\"variable\">propertySources</span> <span class=\"operator\">=</span> environment.getPropertySources();</span><br><span class=\"line\">        propertySources.addFirst(<span class=\"keyword\">new</span> <span class=\"title class_\">PropertiesPropertySource</span>(<span class=\"string\">&quot;Config&quot;</span>, yaml.getObject()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-配置spring-factories-使MyEnvironmentPostProcessor生效\"><a href=\"#2-配置spring-factories-使MyEnvironmentPostProcessor生效\" class=\"headerlink\" title=\"2.配置spring.factories 使MyEnvironmentPostProcessor生效\"></a>2.配置spring.factories 使MyEnvironmentPostProcessor生效</h3><p>在resource下创建<strong>META-INF</strong>文件夹，在<strong>META-INF</strong>下创建<strong>spring.factories</strong>，并且引入刚刚编写的<strong>MyEnvironmentPostProcessor</strong> 类</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.springframework.boot.env.EnvironmentPostProcessor=MyEnvironmentPostProcessor</span><br></pre></td></tr></table></figure>\n\n<p>这样也可以配置资源文件了。</p>\n<h3 id=\"3-思考\"><a href=\"#3-思考\" class=\"headerlink\" title=\"3.思考\"></a>3.思考</h3><ul>\n<li>通过environmentPostProcessor的资源文件如何动态设置呢</li>\n<li>environmentPostProcessor的原理是啥，是怎么动态调用的</li>\n<li>spring中resourceLoader有哪些，是怎么动态处理不同的资源的。<code>DefaultResourceLoader</code>是怎么做到的。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>在<code>@ConfigurationProperties</code>一节中，我们知道了application.yaml中配置的属性会被绑定到该类的属性中，那么如果很多配置都写到application中，会导致配置很乱。同时，如果配置是从其他远程或者目录加载，application.yaml配置并不适合的适合，怎么去加载其他的配置文件呢。下面先讲以下两种方法，其实springboot应该也支持以其他profile的形式去剥离配置，但是目前以springboot-2.5.2这块还在研究中，后续如果可以，会补充上来。</p>\n<h2 id=\"通过-PropertySource注解\"><a href=\"#通过-PropertySource注解\" class=\"headerlink\" title=\"通过@PropertySource注解\"></a>通过<code>@PropertySource</code>注解</h2><p>先来看下<code>@PropertySource</code>源码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(ElementType.TYPE)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Repeatable(PropertySources.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> PropertySource &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 资源的名称</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    String <span class=\"title function_\">name</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 资源文件路径，可以是数据多个文件地址</span></span><br><span class=\"line\"><span class=\"comment\">     * 可以是classpath地址如：</span></span><br><span class=\"line\"><span class=\"comment\">     *                  &quot;classpath:/com/myco/app.properties&quot;</span></span><br><span class=\"line\"><span class=\"comment\">     * 也可以是对应的文件系统地址如：</span></span><br><span class=\"line\"><span class=\"comment\">     *                  &quot;file:/path/to/file&quot;</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    String[] value();</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 是否忽略文件资源是否存在，默认是false,也就是说配置不存在的文件地址spring启动将会报错</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">ignoreResourceNotFound</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 这个没什么好说的了就是对应的字符编码了，默认是空值，如果配置文件中有中文应该设置为utf-8     */</span></span><br><span class=\"line\">    String <span class=\"title function_\">encoding</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 关键的元素了 读取对应资源文件的工厂类了 默认的是PropertySourceFactory</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    Class&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">PropertySourceFactory</span>&gt; factory() <span class=\"keyword\">default</span> PropertySourceFactory.class;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>对于<code>@PropertySource</code>,官方的使用说明如下：</p>\n<ul>\n<li><p>在一个<code>@Configuration</code>标注的类上加上该注解，并设置value属性等。实测<code>@Component</code>也可以。</p>\n</li>\n<li><p>加上该注解后，即可通过<code>Environment</code>#<code>getProperty</code>获取相关的配置属性。同时也可以进行属性绑定。</p>\n</li>\n<li><p><code>value</code>的属性值支持<code>$&#123;&#125;</code>placeholde格式，所以多文件格式支持多placeholder并以逗号分隔</p>\n</li>\n<li><p>如果配置多个文件而且文件配置属性值冲突，将以最后一个配置的为准</p>\n</li>\n<li><p>默认的<code>PropertySourceFactory</code>是PropertySourceFactory的子类<code>DefaultPropertySourceFactory</code>该子类支持<code>.xml</code>和<code>.properties</code>文件的解析。</p>\n</li>\n<li><p>如果需要支持其他文件格式例如Yaml文件解析，需要自定义解析类并实现<code>PropertySourceFactory</code>接口</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">YamlPropertySourceFactory</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">PropertySourceFactory</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"meta\">@Override</span></span><br><span class=\"line\">        <span class=\"keyword\">public</span> PropertySource&lt;?&gt; createPropertySource(String name, EncodedResource encodedResource)</span><br><span class=\"line\">                <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">            <span class=\"type\">YamlPropertiesFactoryBean</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">YamlPropertiesFactoryBean</span>();</span><br><span class=\"line\">            factory.setResources(encodedResource.getResource());</span><br><span class=\"line\">            <span class=\"type\">Properties</span> <span class=\"variable\">properties</span> <span class=\"operator\">=</span> factory.getObject();</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">PropertiesPropertySource</span>(encodedResource.getResource()</span><br><span class=\"line\">                    .getFilename(), properties);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>那么为什么<code>@Component</code>或<code>@Configuration</code>类上加上<code>@PropertySource</code>就可以解析了呢？</p>\n<p>Spring-boot启动过程中依次调用。</p>\n<ul>\n<li><p><code>AbstractApplicationContext</code>#<code>refresh</code>里的<code>invokeBeanFactoryPostProcessors(beanFactory)</code>方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title function_\">invokeBeanFactoryPostProcessors</span><span class=\"params\">(ConfigurableListableBeanFactory beanFactory)</span> &#123;</span><br><span class=\"line\">\t\tPostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime</span></span><br><span class=\"line\">\t\t<span class=\"comment\">// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!NativeDetector.inNativeImage() &amp;&amp; beanFactory.getTempClassLoader() == <span class=\"literal\">null</span> &amp;&amp; beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) &#123;</span><br><span class=\"line\">\t\t\tbeanFactory.addBeanPostProcessor(<span class=\"keyword\">new</span> <span class=\"title class_\">LoadTimeWeaverAwareProcessor</span>(beanFactory));</span><br><span class=\"line\">\t\t\tbeanFactory.setTempClassLoader(<span class=\"keyword\">new</span> <span class=\"title class_\">ContextTypeMatchClassLoader</span>(beanFactory.getBeanClassLoader()));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>PostProcessorRegistrationDelegate.invokeBeanFactoryPostProcessors(beanFactory, getBeanFactoryPostProcessors());</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">invokeBeanFactoryPostProcessors</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">\t\t\tConfigurableListableBeanFactory beanFactory, List&lt;BeanFactoryPostProcessor&gt; beanFactoryPostProcessors)</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 省略部分代码</span></span><br><span class=\"line\">\t\t\t\tinvokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());</span><br><span class=\"line\">\t\t\t\tcurrentRegistryProcessors.clear();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 省略部分代码</span></span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>invokeBeanDefinitionRegistryPostProcessors(currentRegistryProcessors, registry, beanFactory.getApplicationStartup());</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">invokeBeanDefinitionRegistryPostProcessors</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">\t\t\tCollection&lt;? extends BeanDefinitionRegistryPostProcessor&gt; postProcessors, BeanDefinitionRegistry registry, ApplicationStartup applicationStartup)</span> &#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">    <span class=\"comment\">// 这里会执行ConfigurationClassPostProcessor#postProcessBeanDefinitionRegistry</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (BeanDefinitionRegistryPostProcessor postProcessor : postProcessors) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"type\">StartupStep</span> <span class=\"variable\">postProcessBeanDefRegistry</span> <span class=\"operator\">=</span> applicationStartup.start(<span class=\"string\">&quot;spring.context.beandef-registry.post-process&quot;</span>)</span><br><span class=\"line\">\t\t\t\t\t.tag(<span class=\"string\">&quot;postProcessor&quot;</span>, postProcessor::toString);</span><br><span class=\"line\">\t\t\tpostProcessor.postProcessBeanDefinitionRegistry(registry);</span><br><span class=\"line\">\t\t\tpostProcessBeanDefRegistry.end();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>ConfigurationClassPostProcessor#processConfigBeanDefinitions</p>\n</li>\n<li><p>ConfigurationClassParser#doProcessConfigurationClass</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">final</span> SourceClass <span class=\"title function_\">doProcessConfigurationClass</span><span class=\"params\">(</span></span><br><span class=\"line\"><span class=\"params\">\t\t\tConfigurationClass configClass, SourceClass sourceClass, Predicate&lt;String&gt; filter)</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (configClass.getMetadata().isAnnotated(Component.class.getName())) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// Recursively process any member (nested) classes first</span></span><br><span class=\"line\">\t\t\tprocessMemberClasses(configClass, sourceClass, filter);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process any @PropertySource annotations</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (AnnotationAttributes propertySource : AnnotationConfigUtils.attributesForRepeatable(</span><br><span class=\"line\">\t\t\t\tsourceClass.getMetadata(), PropertySources.class,</span><br><span class=\"line\">\t\t\t\torg.springframework.context.annotation.PropertySource.class)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.environment <span class=\"keyword\">instanceof</span> ConfigurableEnvironment) &#123;</span><br><span class=\"line\">\t\t\t\tprocessPropertySource(propertySource);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tlogger.info(<span class=\"string\">&quot;Ignoring @PropertySource annotation on [&quot;</span> + sourceClass.getMetadata().getClassName() +</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"string\">&quot;]. Reason: Environment must implement ConfigurableEnvironment&quot;</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process any @ComponentScan annotations</span></span><br><span class=\"line\">\t\tSet&lt;AnnotationAttributes&gt; componentScans = AnnotationConfigUtils.attributesForRepeatable(</span><br><span class=\"line\">\t\t\t\tsourceClass.getMetadata(), ComponentScans.class, ComponentScan.class);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!componentScans.isEmpty() &amp;&amp;</span><br><span class=\"line\">\t\t\t\t!<span class=\"built_in\">this</span>.conditionEvaluator.shouldSkip(sourceClass.getMetadata(), ConfigurationPhase.REGISTER_BEAN)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (AnnotationAttributes componentScan : componentScans) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// The config class is annotated with @ComponentScan -&gt; perform the scan immediately</span></span><br><span class=\"line\">\t\t\t\tSet&lt;BeanDefinitionHolder&gt; scannedBeanDefinitions =</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"built_in\">this</span>.componentScanParser.parse(componentScan, sourceClass.getMetadata().getClassName());</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Check the set of scanned definitions for any further config classes and parse recursively if needed</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span> (BeanDefinitionHolder holder : scannedBeanDefinitions) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">BeanDefinition</span> <span class=\"variable\">bdCand</span> <span class=\"operator\">=</span> holder.getBeanDefinition().getOriginatingBeanDefinition();</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (bdCand == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tbdCand = holder.getBeanDefinition();</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (ConfigurationClassUtils.checkConfigurationClassCandidate(bdCand, <span class=\"built_in\">this</span>.metadataReaderFactory)) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tparse(bdCand.getBeanClassName(), holder.getBeanName());</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process any @Import annotations</span></span><br><span class=\"line\">\t\tprocessImports(configClass, sourceClass, getImports(sourceClass), filter, <span class=\"literal\">true</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process any @ImportResource annotations</span></span><br><span class=\"line\">\t\t<span class=\"type\">AnnotationAttributes</span> <span class=\"variable\">importResource</span> <span class=\"operator\">=</span></span><br><span class=\"line\">\t\t\t\tAnnotationConfigUtils.attributesFor(sourceClass.getMetadata(), ImportResource.class);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (importResource != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">\t\t\tString[] resources = importResource.getStringArray(<span class=\"string\">&quot;locations&quot;</span>);</span><br><span class=\"line\">\t\t\tClass&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">BeanDefinitionReader</span>&gt; readerClass = importResource.getClass(<span class=\"string\">&quot;reader&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (String resource : resources) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"type\">String</span> <span class=\"variable\">resolvedResource</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.environment.resolveRequiredPlaceholders(resource);</span><br><span class=\"line\">\t\t\t\tconfigClass.addImportedResource(resolvedResource, readerClass);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process individual @Bean methods</span></span><br><span class=\"line\">\t\tSet&lt;MethodMetadata&gt; beanMethods = retrieveBeanMethodMetadata(sourceClass);</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (MethodMetadata methodMetadata : beanMethods) &#123;</span><br><span class=\"line\">\t\t\tconfigClass.addBeanMethod(<span class=\"keyword\">new</span> <span class=\"title class_\">BeanMethod</span>(methodMetadata, configClass));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process default methods on interfaces</span></span><br><span class=\"line\">\t\tprocessInterfaces(configClass, sourceClass);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// Process superclass, if any</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (sourceClass.getMetadata().hasSuperClass()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"type\">String</span> <span class=\"variable\">superclass</span> <span class=\"operator\">=</span> sourceClass.getMetadata().getSuperClassName();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (superclass != <span class=\"literal\">null</span> &amp;&amp; !superclass.startsWith(<span class=\"string\">&quot;java&quot;</span>) &amp;&amp;</span><br><span class=\"line\">\t\t\t\t\t!<span class=\"built_in\">this</span>.knownSuperclasses.containsKey(superclass)) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.knownSuperclasses.put(superclass, configClass);</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Superclass found, return its annotation metadata and recurse</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> sourceClass.getSuperClass();</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// No superclass -&gt; processing is complete</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p>ConfigurationClassParser#processPropertySource</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">processPropertySource</span><span class=\"params\">(AnnotationAttributes propertySource)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">String</span> <span class=\"variable\">name</span> <span class=\"operator\">=</span> propertySource.getString(<span class=\"string\">&quot;name&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!StringUtils.hasLength(name)) &#123;</span><br><span class=\"line\">\t\t\tname = <span class=\"literal\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"type\">String</span> <span class=\"variable\">encoding</span> <span class=\"operator\">=</span> propertySource.getString(<span class=\"string\">&quot;encoding&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!StringUtils.hasLength(encoding)) &#123;</span><br><span class=\"line\">\t\t\tencoding = <span class=\"literal\">null</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tString[] locations = propertySource.getStringArray(<span class=\"string\">&quot;value&quot;</span>);</span><br><span class=\"line\">\t\tAssert.isTrue(locations.length &gt; <span class=\"number\">0</span>, <span class=\"string\">&quot;At least one @PropertySource(value) location is required&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"type\">boolean</span> <span class=\"variable\">ignoreResourceNotFound</span> <span class=\"operator\">=</span> propertySource.getBoolean(<span class=\"string\">&quot;ignoreResourceNotFound&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tClass&lt;? <span class=\"keyword\">extends</span> <span class=\"title class_\">PropertySourceFactory</span>&gt; factoryClass = propertySource.getClass(<span class=\"string\">&quot;factory&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"type\">PropertySourceFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> (factoryClass == PropertySourceFactory.class ?</span><br><span class=\"line\">\t\t\t\tDEFAULT_PROPERTY_SOURCE_FACTORY : BeanUtils.instantiateClass(factoryClass));</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (String location : locations) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"type\">String</span> <span class=\"variable\">resolvedLocation</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.environment.resolveRequiredPlaceholders(location);</span><br><span class=\"line\">\t\t\t\t<span class=\"type\">Resource</span> <span class=\"variable\">resource</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.resourceLoader.getResource(resolvedLocation);</span><br><span class=\"line\">\t\t\t\taddPropertySource(factory.createPropertySource(name, <span class=\"keyword\">new</span> <span class=\"title class_\">EncodedResource</span>(resource, encoding)));</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">catch</span> (IllegalArgumentException | FileNotFoundException | UnknownHostException | SocketException ex) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// Placeholders not resolvable or resource not found when trying to open it</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (ignoreResourceNotFound) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class=\"line\">\t\t\t\t\t\tlogger.info(<span class=\"string\">&quot;Properties location [&quot;</span> + location + <span class=\"string\">&quot;] not resolvable: &quot;</span> + ex.getMessage());</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">throw</span> ex;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这里有两个比较重要的方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// ApplicationServeletEnvironment</span></span><br><span class=\"line\"><span class=\"comment\">// 这里去解析placeholder</span></span><br><span class=\"line\"><span class=\"type\">String</span> <span class=\"variable\">resolvedLocation</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.environment.resolveRequiredPlaceholders(location);</span><br><span class=\"line\"><span class=\"comment\">//org.springframework.boot.web.servlet.context.AnnotationConfigServletWebServerApplic//ationContext</span></span><br><span class=\"line\"><span class=\"comment\">// 这里去获取resource 例如 file:xxx,classpath:xxx</span></span><br><span class=\"line\"><span class=\"type\">Resource</span> <span class=\"variable\">resource</span> <span class=\"operator\">=</span> <span class=\"built_in\">this</span>.resourceLoader.getResource(resolvedLocation);</span><br><span class=\"line\"><span class=\"comment\">// 把propertyResource添加到Environment中的MutablePropertySources</span></span><br><span class=\"line\">addPropertySource(factory.createPropertySource(name, <span class=\"keyword\">new</span> <span class=\"title class_\">EncodedResource</span>(resource, encoding)));</span><br></pre></td></tr></table></figure>\n\n<p>上面的流程走完就把PropertiesPropertySource添加到Environment中了，最后只需要按需获取或绑定属性就行了。</p>\n<h2 id=\"通过EnvironmentPostProcessor设置\"><a href=\"#通过EnvironmentPostProcessor设置\" class=\"headerlink\" title=\"通过EnvironmentPostProcessor设置\"></a>通过EnvironmentPostProcessor设置</h2><h3 id=\"1-编写类实现该接口\"><a href=\"#1-编写类实现该接口\" class=\"headerlink\" title=\"1.编写类实现该接口\"></a>1.编写类实现该接口</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 这里配置在最后执行</span></span><br><span class=\"line\"><span class=\"meta\">@Order(Ordered.LOWEST_PRECEDENCE)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyEnvironmentPostProcessor</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">EnvironmentPostProcessor</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">postProcessEnvironment</span><span class=\"params\">(ConfigurableEnvironment environment,</span></span><br><span class=\"line\"><span class=\"params\">                                       SpringApplication application)</span> &#123;</span><br><span class=\"line\">\t\t\t\t</span><br><span class=\"line\">        <span class=\"type\">YamlPropertiesFactoryBean</span> <span class=\"variable\">yaml</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">YamlPropertiesFactoryBean</span>();</span><br><span class=\"line\">        <span class=\"comment\">// 通过环境变量获取files路径，这里可以配置在application.yaml中或环境变量中</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">files</span> <span class=\"operator\">=</span> environment.getProperty(<span class=\"string\">&quot;files&quot;</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 我们在上面讲到PropertyResource是通过ResourceLoader加载资源的</span></span><br><span class=\"line\">        <span class=\"comment\">// 包括各种路径资源file:xxx或者classpath:xxx </span></span><br><span class=\"line\">        <span class=\"type\">DefaultResourceLoader</span> <span class=\"variable\">defaultResourceLoader</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultResourceLoader</span>();</span><br><span class=\"line\">        <span class=\"type\">Resource</span> <span class=\"variable\">resource</span> <span class=\"operator\">=</span> defaultResourceLoader.getResource(files);</span><br><span class=\"line\">      \t</span><br><span class=\"line\">        yaml.setResources(resource);</span><br><span class=\"line\">        <span class=\"type\">MutablePropertySources</span> <span class=\"variable\">propertySources</span> <span class=\"operator\">=</span> environment.getPropertySources();</span><br><span class=\"line\">        propertySources.addFirst(<span class=\"keyword\">new</span> <span class=\"title class_\">PropertiesPropertySource</span>(<span class=\"string\">&quot;Config&quot;</span>, yaml.getObject()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"2-配置spring-factories-使MyEnvironmentPostProcessor生效\"><a href=\"#2-配置spring-factories-使MyEnvironmentPostProcessor生效\" class=\"headerlink\" title=\"2.配置spring.factories 使MyEnvironmentPostProcessor生效\"></a>2.配置spring.factories 使MyEnvironmentPostProcessor生效</h3><p>在resource下创建<strong>META-INF</strong>文件夹，在<strong>META-INF</strong>下创建<strong>spring.factories</strong>，并且引入刚刚编写的<strong>MyEnvironmentPostProcessor</strong> 类</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">org.springframework.boot.env.EnvironmentPostProcessor=MyEnvironmentPostProcessor</span><br></pre></td></tr></table></figure>\n\n<p>这样也可以配置资源文件了。</p>\n<h3 id=\"3-思考\"><a href=\"#3-思考\" class=\"headerlink\" title=\"3.思考\"></a>3.思考</h3><ul>\n<li>通过environmentPostProcessor的资源文件如何动态设置呢</li>\n<li>environmentPostProcessor的原理是啥，是怎么动态调用的</li>\n<li>spring中resourceLoader有哪些，是怎么动态处理不同的资源的。<code>DefaultResourceLoader</code>是怎么做到的。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n"},{"uuid":"bbaf4818-c0ab-11ec-92a1-7557b2313227","title":"springboot环境解析分析","abbrlink":"508fe272","_content":"\nspringboot的yaml配置能设置环境变量到Environment对象里。那么springboot的怎么解析的\n\nyaml文件呢。在讲配置到ConfigurationProperties校验属性之前，我们先看看这个问题。\n","source":"_posts/spring/configurationProperties属性转换.md","raw":"---\nuuid: bbaf4818-c0ab-11ec-92a1-7557b2313227\ntitle: springboot环境解析分析\ncategories: Java\ntags:\n  - springBoot\n  - todo\nabbrlink: 508fe272\n---\n\nspringboot的yaml配置能设置环境变量到Environment对象里。那么springboot的怎么解析的\n\nyaml文件呢。在讲配置到ConfigurationProperties校验属性之前，我们先看看这个问题。\n","slug":"spring/configurationProperties属性转换","published":1,"date":"2022-04-20T12:41:20.920Z","updated":"2022-05-04T03:22:53.300Z","_id":"cl2qzftia004l13nof0l8g5q4","comments":1,"layout":"post","photos":[],"link":"","content":"<p>springboot的yaml配置能设置环境变量到Environment对象里。那么springboot的怎么解析的</p>\n<p>yaml文件呢。在讲配置到ConfigurationProperties校验属性之前，我们先看看这个问题。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>springboot的yaml配置能设置环境变量到Environment对象里。那么springboot的怎么解析的</p>\n<p>yaml文件呢。在讲配置到ConfigurationProperties校验属性之前，我们先看看这个问题。</p>\n"},{"uuid":"bbaf4814-c0ab-11ec-92a1-7557b2313227","title":"cur post","abbrlink":"79f3b7e2","_content":"\n# POST Request\n\n## Send an Empty POST Request\n\n```bash\ncurl -X POST https://catonmat.net\n```\n\nThis recipe uses the `-X POST` option that makes curl send a POST request to `https://catonmat.net`. Once it receives a response from the server, it prints the response body to the screen. It doesn't send any POST data.\n\n## Send a POST Request with Form Data\n\n```bash\ncurl -d 'login=emma&password=123' -X POST https://google.com/login\n```\n\nThis recipe sends a POST request to `https://google.com/login` with `login=emma&password=123` data in request's body. When using the `-d` argument, curl also sets the `Content-Type` header to `application/x-www-form-urlencoded`. Additionally, when the `-d` option is set, the `-X POST` argument can be skipped as curl will automatically set the request's type to POST.\n\n## Skipping the -X Argument\n\n```bash\ncurl -d 'login=emma&password=123' https://google.com/login\n```\n\nIn this recipe, we skip the `-X POST` argument that explicitly tells curl to send a POST request. We can skip it because we have specified the `-d` argument. When `-d` is used, curl implicitly sets the request's type to POST.\n\n## A Neater Way to POST Data\n\n```bash\ncurl -d 'login=emma' -d 'password=123' https://google.com/login\n```\n\nThe previous recipe used a single `-d` option to send all data `login=emma&password=123` but here's a neater way to do the same that makes the command easier to read. Instead of using a single `-d` argument for all data, use multiple `-d` arguments for each `key=value` data piece! If you do that, then curl joins all data pieces with the `&` separator symbol when creating the request. This recipe skips the `-X POST` argument because when `-d` argument is present, curl makes a POST request implicitly.\n\n## Send a POST Request and Follow a Redirect\n\n```bash\ncurl -L -d 'tweet=hi' https://api.twitter.com/tweet\n```\n\nThis recipe uses the `-L` command line option that tells curl to follow any possible redirects that it may encounter in the way. By default, curl doesn't follow the redirects, so you have to add `-L` to make it follow them. This recipe skips the `-X POST` argument because `-d` argument forces curl to make a POST request.\n\n## Send a POST Request with JSON Data\n\n```bash\ncurl -d '{\"login\": \"emma\", \"pass\": \"123\"}' -H 'Content-Type: application/json' https://google.com/login\n```\n\nIn this recipe, curl sends a POST request with JSON data in it. This is accomplished by passing JSON to the `-d` option and also using the `-H` option that sets the `Content-Type` header to `application/json`. Setting the content type header to `application/json` is necessary because otherwise, the web server won't know what type of data this is. I've also removed the `-X POST` argument as it can be skipped because `-d` forces a POST request.\n\n## Send a POST Request with XML Data\n\n```bash\ncurl -d '<user><login>ann</login><password>123</password></user>' -H 'Content-Type: text/xml' https://google.com/login\n```\n\nThis recipe POSTs XML data to `https://google.com/login`. Just like the form data and JSON data, XML data is specified in the `-d` argument. To tell the web server that the request contains XML, the `Content-Type` header is changed to `text/xml` via the `-H` argument.\n\n## Send a POST Request with Plain Text Data\n\n```bash\ncurl -d 'hello world' -H 'Content-Type: text/plain' https://google.com/login\n```\n\nThis recipe sends a POST request with a plain text string `hello world` in request's body. It also sets the `Content-Type` header to `text/plain` to tell web server that it's just plain text coming in.\n\n## Send a POST Request with Data from a File\n\n```bash\ncurl -d '@data.txt' https://google.com/login\n```\n\nThis recipe loads POST data from a file called `data.txt`. Notice the extra `@` symbol before the filename. That's how you tell curl that `data.txt` is a file and not just a string that should go in the POST body.\n\n## URL-encode POST Data\n\n```bash\ncurl --data-urlencode 'comment=hello world' https://google.com/login\n```\n\nSo far, all recipes have been using the `-d` argument to add POST data to requests. This argument assumes that your data is URL-encoded already. If it is not, then there can be some trouble. If your data is not URL-encoded, then replace `-d` with `--data-urlencode`. It works exactly the same way as `-d`, except the data gets URL-encoded by curl before it's sent out on the wire.\n\n## POST a Binary File\n\n```\ncurl -F 'file=@photo.png' https://google.com/profile\n```\n\nThis recipe uses the `-F` argument that forces curl to make a multipart form data POST request. It's a more complicated content type that's more efficient at sending binary files. This recipe makes curl read an image `photo.png` and upload it to `https://google.com/profile` with a name `file`. The `-F` argument also sets the `Content-Type` header to `multipart/form-data`.\n\n## POST a Binary File and Set Its MIME Type\n\n```\ncurl -F 'file=@photo.png;type=image/png' https://google.com/profile\n```\n\nSimilar to the previous recipe, this recipe uses the `-F` argument to upload a binary file (a photo with the filename `photo.png`) via a multipart POST request. It also specifies the MIME type of this file and sets it to `image/png`. If no type is specified, then curl sets it to `application/octet-stream`.\n\n## POST a Binary File and Change Its Filename\n\n```\ncurl -F 'file=@photo.png;filename=me.png' https://google.com/profile\n```\n\nSimilar to the previous two recipes, this recipe uses the `-F` argument to upload a `photo.png` via a POST request. Additionally, in this recipe, the filename that is sent to the web server is changed from `photo.png` to `me.png`. The web server only sees the filename `me.png` and doesn't know the original filename was `photo.png`.\n\n# Add POST Data to a Request\n\nLast updated 1 week ago\n\nThese curl recipes show you how to add POST data to curl requests. To add URL-encoded form data, use the `-d` argument. To make curl URL-escape form data for you, use the `--data-urlencode` argument. To send multipart form data, use the `-F` argument.\n\n\n## Send Form Data\n\n```\ncurl -d 'name=johnny%20depp' https://google.com/login\n```\n\nThis recipe uses the `-d` argument to add `name=johnny%20depp` to the body of a POST request to `https://google.com/login`. When using the `-d` argument, curl automatically adds the `Content-Type: application/x-www-form-urlencoded` header that tells the web server it's sending URL-encoded form data. Note that the `key=value` data should be URL-escaped.\n\n## URL-encode and Send Form Data\n\n```\ncurl --data-urlencode 'name=john depp' https://google.com/login\n```\n\nThis recipe uses the `--data-urlencode` argument to add `name=john depp` form data to a POST request. This argument works just like the `-d` argument in the previous recipe, except it also URL-encodes the data. Thus, the data this recipe adds to the body of the POST request is `name=johnny%20depp` and the request is then sent to `https://google.com/login`.\n\n## Using Multiple -d Arguments\n\n```\ncurl -d 'foo=bar' -d 'baz=quux' https://google.com\n```\n\nThe previous two recipes sent just a single variable in the POST request but you can send as many variables as you need. Just specify them one after another. This recipe POSTs two variables, `foo=bar` and `baz=quux`.\n\n## Send Multipart Data\n\n```\ncurl -F 'name=johnny' https://google.com/search\n```\n\nThis recipe uses the `-F` argument to send multipart form data in a POST request. When sending multipart data, curl sets the `Content-Type` header to `multipart/form-data`. Sending multipart data is useful when you need to upload images or other binary files.\n\n## Upload an Image\n\n```\ncurl -F 'pic=@me.jpg' https://google.com/profile\n```\n\nThis recipe also uses the `-F` argument but instead of sending textual data, it sends the file `me.jpg`. It uploads it to `https://google.com/profile` via a POST request. As this recipe uses the `-F` argument, this image is uploaded as multipart base64-encoded form data.\n\n## Upload an Image and Change Its Filename\n\n```\ncurl -F 'pic=@me.jpg;filename=x.jpg' https://google.com/profile\n```\n\nThis recipe adds a special argument `filename=x.jpg` after `me.jpg`. This tells curl to use a new filename for the attached file. Curl will read `me.jpg` but tell the server that the filename is `x.jpg`.\n\n## Send JSON Data\n\n```\ncurl -H 'Content-Type: application/json' -d '{\"query\": \"cats\"}' https://google.com/search\n```\n\nThis recipe sends a POST request with JSON data in it. It specifies the JSON data itself as the argument to the `-d` switch, and it also sets the request's content type to `application/json` via the `-H` argument so that the web server knew that the incoming data is JSON and not plain text.\n\n## Send XML Data\n\n```\ncurl -H 'Content-Type: text/xml' -d 'hello' https://google.com/msg\n```\n\nThis recipe sets the content type header to `text/xml`, which is the MIME type of XML. It then adds `<message>hello</message>` data to the request and POSTs it to `https://google.com/msg`. Sending XML data, JSON data, or any other text data is very similar. All you have to do is change the content type header to the correct MIME type so that the server and the application know what type of data it is.\n","source":"_posts/network/curl-post.md","raw":"---\nuuid: bbaf4814-c0ab-11ec-92a1-7557b2313227\ntitle: cur post\ncategories: Linux\ntags:\n  - curl\nabbrlink: 79f3b7e2\n---\n\n# POST Request\n\n## Send an Empty POST Request\n\n```bash\ncurl -X POST https://catonmat.net\n```\n\nThis recipe uses the `-X POST` option that makes curl send a POST request to `https://catonmat.net`. Once it receives a response from the server, it prints the response body to the screen. It doesn't send any POST data.\n\n## Send a POST Request with Form Data\n\n```bash\ncurl -d 'login=emma&password=123' -X POST https://google.com/login\n```\n\nThis recipe sends a POST request to `https://google.com/login` with `login=emma&password=123` data in request's body. When using the `-d` argument, curl also sets the `Content-Type` header to `application/x-www-form-urlencoded`. Additionally, when the `-d` option is set, the `-X POST` argument can be skipped as curl will automatically set the request's type to POST.\n\n## Skipping the -X Argument\n\n```bash\ncurl -d 'login=emma&password=123' https://google.com/login\n```\n\nIn this recipe, we skip the `-X POST` argument that explicitly tells curl to send a POST request. We can skip it because we have specified the `-d` argument. When `-d` is used, curl implicitly sets the request's type to POST.\n\n## A Neater Way to POST Data\n\n```bash\ncurl -d 'login=emma' -d 'password=123' https://google.com/login\n```\n\nThe previous recipe used a single `-d` option to send all data `login=emma&password=123` but here's a neater way to do the same that makes the command easier to read. Instead of using a single `-d` argument for all data, use multiple `-d` arguments for each `key=value` data piece! If you do that, then curl joins all data pieces with the `&` separator symbol when creating the request. This recipe skips the `-X POST` argument because when `-d` argument is present, curl makes a POST request implicitly.\n\n## Send a POST Request and Follow a Redirect\n\n```bash\ncurl -L -d 'tweet=hi' https://api.twitter.com/tweet\n```\n\nThis recipe uses the `-L` command line option that tells curl to follow any possible redirects that it may encounter in the way. By default, curl doesn't follow the redirects, so you have to add `-L` to make it follow them. This recipe skips the `-X POST` argument because `-d` argument forces curl to make a POST request.\n\n## Send a POST Request with JSON Data\n\n```bash\ncurl -d '{\"login\": \"emma\", \"pass\": \"123\"}' -H 'Content-Type: application/json' https://google.com/login\n```\n\nIn this recipe, curl sends a POST request with JSON data in it. This is accomplished by passing JSON to the `-d` option and also using the `-H` option that sets the `Content-Type` header to `application/json`. Setting the content type header to `application/json` is necessary because otherwise, the web server won't know what type of data this is. I've also removed the `-X POST` argument as it can be skipped because `-d` forces a POST request.\n\n## Send a POST Request with XML Data\n\n```bash\ncurl -d '<user><login>ann</login><password>123</password></user>' -H 'Content-Type: text/xml' https://google.com/login\n```\n\nThis recipe POSTs XML data to `https://google.com/login`. Just like the form data and JSON data, XML data is specified in the `-d` argument. To tell the web server that the request contains XML, the `Content-Type` header is changed to `text/xml` via the `-H` argument.\n\n## Send a POST Request with Plain Text Data\n\n```bash\ncurl -d 'hello world' -H 'Content-Type: text/plain' https://google.com/login\n```\n\nThis recipe sends a POST request with a plain text string `hello world` in request's body. It also sets the `Content-Type` header to `text/plain` to tell web server that it's just plain text coming in.\n\n## Send a POST Request with Data from a File\n\n```bash\ncurl -d '@data.txt' https://google.com/login\n```\n\nThis recipe loads POST data from a file called `data.txt`. Notice the extra `@` symbol before the filename. That's how you tell curl that `data.txt` is a file and not just a string that should go in the POST body.\n\n## URL-encode POST Data\n\n```bash\ncurl --data-urlencode 'comment=hello world' https://google.com/login\n```\n\nSo far, all recipes have been using the `-d` argument to add POST data to requests. This argument assumes that your data is URL-encoded already. If it is not, then there can be some trouble. If your data is not URL-encoded, then replace `-d` with `--data-urlencode`. It works exactly the same way as `-d`, except the data gets URL-encoded by curl before it's sent out on the wire.\n\n## POST a Binary File\n\n```\ncurl -F 'file=@photo.png' https://google.com/profile\n```\n\nThis recipe uses the `-F` argument that forces curl to make a multipart form data POST request. It's a more complicated content type that's more efficient at sending binary files. This recipe makes curl read an image `photo.png` and upload it to `https://google.com/profile` with a name `file`. The `-F` argument also sets the `Content-Type` header to `multipart/form-data`.\n\n## POST a Binary File and Set Its MIME Type\n\n```\ncurl -F 'file=@photo.png;type=image/png' https://google.com/profile\n```\n\nSimilar to the previous recipe, this recipe uses the `-F` argument to upload a binary file (a photo with the filename `photo.png`) via a multipart POST request. It also specifies the MIME type of this file and sets it to `image/png`. If no type is specified, then curl sets it to `application/octet-stream`.\n\n## POST a Binary File and Change Its Filename\n\n```\ncurl -F 'file=@photo.png;filename=me.png' https://google.com/profile\n```\n\nSimilar to the previous two recipes, this recipe uses the `-F` argument to upload a `photo.png` via a POST request. Additionally, in this recipe, the filename that is sent to the web server is changed from `photo.png` to `me.png`. The web server only sees the filename `me.png` and doesn't know the original filename was `photo.png`.\n\n# Add POST Data to a Request\n\nLast updated 1 week ago\n\nThese curl recipes show you how to add POST data to curl requests. To add URL-encoded form data, use the `-d` argument. To make curl URL-escape form data for you, use the `--data-urlencode` argument. To send multipart form data, use the `-F` argument.\n\n\n## Send Form Data\n\n```\ncurl -d 'name=johnny%20depp' https://google.com/login\n```\n\nThis recipe uses the `-d` argument to add `name=johnny%20depp` to the body of a POST request to `https://google.com/login`. When using the `-d` argument, curl automatically adds the `Content-Type: application/x-www-form-urlencoded` header that tells the web server it's sending URL-encoded form data. Note that the `key=value` data should be URL-escaped.\n\n## URL-encode and Send Form Data\n\n```\ncurl --data-urlencode 'name=john depp' https://google.com/login\n```\n\nThis recipe uses the `--data-urlencode` argument to add `name=john depp` form data to a POST request. This argument works just like the `-d` argument in the previous recipe, except it also URL-encodes the data. Thus, the data this recipe adds to the body of the POST request is `name=johnny%20depp` and the request is then sent to `https://google.com/login`.\n\n## Using Multiple -d Arguments\n\n```\ncurl -d 'foo=bar' -d 'baz=quux' https://google.com\n```\n\nThe previous two recipes sent just a single variable in the POST request but you can send as many variables as you need. Just specify them one after another. This recipe POSTs two variables, `foo=bar` and `baz=quux`.\n\n## Send Multipart Data\n\n```\ncurl -F 'name=johnny' https://google.com/search\n```\n\nThis recipe uses the `-F` argument to send multipart form data in a POST request. When sending multipart data, curl sets the `Content-Type` header to `multipart/form-data`. Sending multipart data is useful when you need to upload images or other binary files.\n\n## Upload an Image\n\n```\ncurl -F 'pic=@me.jpg' https://google.com/profile\n```\n\nThis recipe also uses the `-F` argument but instead of sending textual data, it sends the file `me.jpg`. It uploads it to `https://google.com/profile` via a POST request. As this recipe uses the `-F` argument, this image is uploaded as multipart base64-encoded form data.\n\n## Upload an Image and Change Its Filename\n\n```\ncurl -F 'pic=@me.jpg;filename=x.jpg' https://google.com/profile\n```\n\nThis recipe adds a special argument `filename=x.jpg` after `me.jpg`. This tells curl to use a new filename for the attached file. Curl will read `me.jpg` but tell the server that the filename is `x.jpg`.\n\n## Send JSON Data\n\n```\ncurl -H 'Content-Type: application/json' -d '{\"query\": \"cats\"}' https://google.com/search\n```\n\nThis recipe sends a POST request with JSON data in it. It specifies the JSON data itself as the argument to the `-d` switch, and it also sets the request's content type to `application/json` via the `-H` argument so that the web server knew that the incoming data is JSON and not plain text.\n\n## Send XML Data\n\n```\ncurl -H 'Content-Type: text/xml' -d 'hello' https://google.com/msg\n```\n\nThis recipe sets the content type header to `text/xml`, which is the MIME type of XML. It then adds `<message>hello</message>` data to the request and POSTs it to `https://google.com/msg`. Sending XML data, JSON data, or any other text data is very similar. All you have to do is change the content type header to the correct MIME type so that the server and the application know what type of data it is.\n","slug":"network/curl-post","published":1,"date":"2022-04-20T12:41:20.927Z","updated":"2022-05-04T03:22:13.501Z","_id":"cl2qzftib004q13nofn7ob2fk","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"POST-Request\"><a href=\"#POST-Request\" class=\"headerlink\" title=\"POST Request\"></a>POST Request</h1><h2 id=\"Send-an-Empty-POST-Request\"><a href=\"#Send-an-Empty-POST-Request\" class=\"headerlink\" title=\"Send an Empty POST Request\"></a>Send an Empty POST Request</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST https://catonmat.net</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-X POST</code> option that makes curl send a POST request to <code>https://catonmat.net</code>. Once it receives a response from the server, it prints the response body to the screen. It doesn’t send any POST data.</p>\n<h2 id=\"Send-a-POST-Request-with-Form-Data\"><a href=\"#Send-a-POST-Request-with-Form-Data\" class=\"headerlink\" title=\"Send a POST Request with Form Data\"></a>Send a POST Request with Form Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;login=emma&amp;password=123&#x27;</span> -X POST https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe sends a POST request to <code>https://google.com/login</code> with <code>login=emma&amp;password=123</code> data in request’s body. When using the <code>-d</code> argument, curl also sets the <code>Content-Type</code> header to <code>application/x-www-form-urlencoded</code>. Additionally, when the <code>-d</code> option is set, the <code>-X POST</code> argument can be skipped as curl will automatically set the request’s type to POST.</p>\n<h2 id=\"Skipping-the-X-Argument\"><a href=\"#Skipping-the-X-Argument\" class=\"headerlink\" title=\"Skipping the -X Argument\"></a>Skipping the -X Argument</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;login=emma&amp;password=123&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, we skip the <code>-X POST</code> argument that explicitly tells curl to send a POST request. We can skip it because we have specified the <code>-d</code> argument. When <code>-d</code> is used, curl implicitly sets the request’s type to POST.</p>\n<h2 id=\"A-Neater-Way-to-POST-Data\"><a href=\"#A-Neater-Way-to-POST-Data\" class=\"headerlink\" title=\"A Neater Way to POST Data\"></a>A Neater Way to POST Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;login=emma&#x27;</span> -d <span class=\"string\">&#x27;password=123&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>The previous recipe used a single <code>-d</code> option to send all data <code>login=emma&amp;password=123</code> but here’s a neater way to do the same that makes the command easier to read. Instead of using a single <code>-d</code> argument for all data, use multiple <code>-d</code> arguments for each <code>key=value</code> data piece! If you do that, then curl joins all data pieces with the <code>&amp;</code> separator symbol when creating the request. This recipe skips the <code>-X POST</code> argument because when <code>-d</code> argument is present, curl makes a POST request implicitly.</p>\n<h2 id=\"Send-a-POST-Request-and-Follow-a-Redirect\"><a href=\"#Send-a-POST-Request-and-Follow-a-Redirect\" class=\"headerlink\" title=\"Send a POST Request and Follow a Redirect\"></a>Send a POST Request and Follow a Redirect</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L -d <span class=\"string\">&#x27;tweet=hi&#x27;</span> https://api.twitter.com/tweet</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-L</code> command line option that tells curl to follow any possible redirects that it may encounter in the way. By default, curl doesn’t follow the redirects, so you have to add <code>-L</code> to make it follow them. This recipe skips the <code>-X POST</code> argument because <code>-d</code> argument forces curl to make a POST request.</p>\n<h2 id=\"Send-a-POST-Request-with-JSON-Data\"><a href=\"#Send-a-POST-Request-with-JSON-Data\" class=\"headerlink\" title=\"Send a POST Request with JSON Data\"></a>Send a POST Request with JSON Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;&#123;&quot;login&quot;: &quot;emma&quot;, &quot;pass&quot;: &quot;123&quot;&#125;&#x27;</span> -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, curl sends a POST request with JSON data in it. This is accomplished by passing JSON to the <code>-d</code> option and also using the <code>-H</code> option that sets the <code>Content-Type</code> header to <code>application/json</code>. Setting the content type header to <code>application/json</code> is necessary because otherwise, the web server won’t know what type of data this is. I’ve also removed the <code>-X POST</code> argument as it can be skipped because <code>-d</code> forces a POST request.</p>\n<h2 id=\"Send-a-POST-Request-with-XML-Data\"><a href=\"#Send-a-POST-Request-with-XML-Data\" class=\"headerlink\" title=\"Send a POST Request with XML Data\"></a>Send a POST Request with XML Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;&lt;user&gt;&lt;login&gt;ann&lt;/login&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;&#x27;</span> -H <span class=\"string\">&#x27;Content-Type: text/xml&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe POSTs XML data to <code>https://google.com/login</code>. Just like the form data and JSON data, XML data is specified in the <code>-d</code> argument. To tell the web server that the request contains XML, the <code>Content-Type</code> header is changed to <code>text/xml</code> via the <code>-H</code> argument.</p>\n<h2 id=\"Send-a-POST-Request-with-Plain-Text-Data\"><a href=\"#Send-a-POST-Request-with-Plain-Text-Data\" class=\"headerlink\" title=\"Send a POST Request with Plain Text Data\"></a>Send a POST Request with Plain Text Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;hello world&#x27;</span> -H <span class=\"string\">&#x27;Content-Type: text/plain&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe sends a POST request with a plain text string <code>hello world</code> in request’s body. It also sets the <code>Content-Type</code> header to <code>text/plain</code> to tell web server that it’s just plain text coming in.</p>\n<h2 id=\"Send-a-POST-Request-with-Data-from-a-File\"><a href=\"#Send-a-POST-Request-with-Data-from-a-File\" class=\"headerlink\" title=\"Send a POST Request with Data from a File\"></a>Send a POST Request with Data from a File</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;@data.txt&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe loads POST data from a file called <code>data.txt</code>. Notice the extra <code>@</code> symbol before the filename. That’s how you tell curl that <code>data.txt</code> is a file and not just a string that should go in the POST body.</p>\n<h2 id=\"URL-encode-POST-Data\"><a href=\"#URL-encode-POST-Data\" class=\"headerlink\" title=\"URL-encode POST Data\"></a>URL-encode POST Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --data-urlencode <span class=\"string\">&#x27;comment=hello world&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>So far, all recipes have been using the <code>-d</code> argument to add POST data to requests. This argument assumes that your data is URL-encoded already. If it is not, then there can be some trouble. If your data is not URL-encoded, then replace <code>-d</code> with <code>--data-urlencode</code>. It works exactly the same way as <code>-d</code>, except the data gets URL-encoded by curl before it’s sent out on the wire.</p>\n<h2 id=\"POST-a-Binary-File\"><a href=\"#POST-a-Binary-File\" class=\"headerlink\" title=\"POST a Binary File\"></a>POST a Binary File</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;file=@photo.png&#x27; https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-F</code> argument that forces curl to make a multipart form data POST request. It’s a more complicated content type that’s more efficient at sending binary files. This recipe makes curl read an image <code>photo.png</code> and upload it to <code>https://google.com/profile</code> with a name <code>file</code>. The <code>-F</code> argument also sets the <code>Content-Type</code> header to <code>multipart/form-data</code>.</p>\n<h2 id=\"POST-a-Binary-File-and-Set-Its-MIME-Type\"><a href=\"#POST-a-Binary-File-and-Set-Its-MIME-Type\" class=\"headerlink\" title=\"POST a Binary File and Set Its MIME Type\"></a>POST a Binary File and Set Its MIME Type</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;file=@photo.png;type=image/png&#x27; https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>Similar to the previous recipe, this recipe uses the <code>-F</code> argument to upload a binary file (a photo with the filename <code>photo.png</code>) via a multipart POST request. It also specifies the MIME type of this file and sets it to <code>image/png</code>. If no type is specified, then curl sets it to <code>application/octet-stream</code>.</p>\n<h2 id=\"POST-a-Binary-File-and-Change-Its-Filename\"><a href=\"#POST-a-Binary-File-and-Change-Its-Filename\" class=\"headerlink\" title=\"POST a Binary File and Change Its Filename\"></a>POST a Binary File and Change Its Filename</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;file=@photo.png;filename=me.png&#x27; https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>Similar to the previous two recipes, this recipe uses the <code>-F</code> argument to upload a <code>photo.png</code> via a POST request. Additionally, in this recipe, the filename that is sent to the web server is changed from <code>photo.png</code> to <code>me.png</code>. The web server only sees the filename <code>me.png</code> and doesn’t know the original filename was <code>photo.png</code>.</p>\n<h1 id=\"Add-POST-Data-to-a-Request\"><a href=\"#Add-POST-Data-to-a-Request\" class=\"headerlink\" title=\"Add POST Data to a Request\"></a>Add POST Data to a Request</h1><p>Last updated 1 week ago</p>\n<p>These curl recipes show you how to add POST data to curl requests. To add URL-encoded form data, use the <code>-d</code> argument. To make curl URL-escape form data for you, use the <code>--data-urlencode</code> argument. To send multipart form data, use the <code>-F</code> argument.</p>\n<h2 id=\"Send-Form-Data\"><a href=\"#Send-Form-Data\" class=\"headerlink\" title=\"Send Form Data\"></a>Send Form Data</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d &#x27;name=johnny%20depp&#x27; https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-d</code> argument to add <code>name=johnny%20depp</code> to the body of a POST request to <code>https://google.com/login</code>. When using the <code>-d</code> argument, curl automatically adds the <code>Content-Type: application/x-www-form-urlencoded</code> header that tells the web server it’s sending URL-encoded form data. Note that the <code>key=value</code> data should be URL-escaped.</p>\n<h2 id=\"URL-encode-and-Send-Form-Data\"><a href=\"#URL-encode-and-Send-Form-Data\" class=\"headerlink\" title=\"URL-encode and Send Form Data\"></a>URL-encode and Send Form Data</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --data-urlencode &#x27;name=john depp&#x27; https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>--data-urlencode</code> argument to add <code>name=john depp</code> form data to a POST request. This argument works just like the <code>-d</code> argument in the previous recipe, except it also URL-encodes the data. Thus, the data this recipe adds to the body of the POST request is <code>name=johnny%20depp</code> and the request is then sent to <code>https://google.com/login</code>.</p>\n<h2 id=\"Using-Multiple-d-Arguments\"><a href=\"#Using-Multiple-d-Arguments\" class=\"headerlink\" title=\"Using Multiple -d Arguments\"></a>Using Multiple -d Arguments</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d &#x27;foo=bar&#x27; -d &#x27;baz=quux&#x27; https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>The previous two recipes sent just a single variable in the POST request but you can send as many variables as you need. Just specify them one after another. This recipe POSTs two variables, <code>foo=bar</code> and <code>baz=quux</code>.</p>\n<h2 id=\"Send-Multipart-Data\"><a href=\"#Send-Multipart-Data\" class=\"headerlink\" title=\"Send Multipart Data\"></a>Send Multipart Data</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;name=johnny&#x27; https://google.com/search</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-F</code> argument to send multipart form data in a POST request. When sending multipart data, curl sets the <code>Content-Type</code> header to <code>multipart/form-data</code>. Sending multipart data is useful when you need to upload images or other binary files.</p>\n<h2 id=\"Upload-an-Image\"><a href=\"#Upload-an-Image\" class=\"headerlink\" title=\"Upload an Image\"></a>Upload an Image</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;pic=@me.jpg&#x27; https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>This recipe also uses the <code>-F</code> argument but instead of sending textual data, it sends the file <code>me.jpg</code>. It uploads it to <code>https://google.com/profile</code> via a POST request. As this recipe uses the <code>-F</code> argument, this image is uploaded as multipart base64-encoded form data.</p>\n<h2 id=\"Upload-an-Image-and-Change-Its-Filename\"><a href=\"#Upload-an-Image-and-Change-Its-Filename\" class=\"headerlink\" title=\"Upload an Image and Change Its Filename\"></a>Upload an Image and Change Its Filename</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;pic=@me.jpg;filename=x.jpg&#x27; https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>This recipe adds a special argument <code>filename=x.jpg</code> after <code>me.jpg</code>. This tells curl to use a new filename for the attached file. Curl will read <code>me.jpg</code> but tell the server that the filename is <code>x.jpg</code>.</p>\n<h2 id=\"Send-JSON-Data\"><a href=\"#Send-JSON-Data\" class=\"headerlink\" title=\"Send JSON Data\"></a>Send JSON Data</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H &#x27;Content-Type: application/json&#x27; -d &#x27;&#123;&quot;query&quot;: &quot;cats&quot;&#125;&#x27; https://google.com/search</span><br></pre></td></tr></table></figure>\n\n<p>This recipe sends a POST request with JSON data in it. It specifies the JSON data itself as the argument to the <code>-d</code> switch, and it also sets the request’s content type to <code>application/json</code> via the <code>-H</code> argument so that the web server knew that the incoming data is JSON and not plain text.</p>\n<h2 id=\"Send-XML-Data\"><a href=\"#Send-XML-Data\" class=\"headerlink\" title=\"Send XML Data\"></a>Send XML Data</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H &#x27;Content-Type: text/xml&#x27; -d &#x27;hello&#x27; https://google.com/msg</span><br></pre></td></tr></table></figure>\n\n<p>This recipe sets the content type header to <code>text/xml</code>, which is the MIME type of XML. It then adds <code>&lt;message&gt;hello&lt;/message&gt;</code> data to the request and POSTs it to <code>https://google.com/msg</code>. Sending XML data, JSON data, or any other text data is very similar. All you have to do is change the content type header to the correct MIME type so that the server and the application know what type of data it is.</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"POST-Request\"><a href=\"#POST-Request\" class=\"headerlink\" title=\"POST Request\"></a>POST Request</h1><h2 id=\"Send-an-Empty-POST-Request\"><a href=\"#Send-an-Empty-POST-Request\" class=\"headerlink\" title=\"Send an Empty POST Request\"></a>Send an Empty POST Request</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -X POST https://catonmat.net</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-X POST</code> option that makes curl send a POST request to <code>https://catonmat.net</code>. Once it receives a response from the server, it prints the response body to the screen. It doesn’t send any POST data.</p>\n<h2 id=\"Send-a-POST-Request-with-Form-Data\"><a href=\"#Send-a-POST-Request-with-Form-Data\" class=\"headerlink\" title=\"Send a POST Request with Form Data\"></a>Send a POST Request with Form Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;login=emma&amp;password=123&#x27;</span> -X POST https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe sends a POST request to <code>https://google.com/login</code> with <code>login=emma&amp;password=123</code> data in request’s body. When using the <code>-d</code> argument, curl also sets the <code>Content-Type</code> header to <code>application/x-www-form-urlencoded</code>. Additionally, when the <code>-d</code> option is set, the <code>-X POST</code> argument can be skipped as curl will automatically set the request’s type to POST.</p>\n<h2 id=\"Skipping-the-X-Argument\"><a href=\"#Skipping-the-X-Argument\" class=\"headerlink\" title=\"Skipping the -X Argument\"></a>Skipping the -X Argument</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;login=emma&amp;password=123&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, we skip the <code>-X POST</code> argument that explicitly tells curl to send a POST request. We can skip it because we have specified the <code>-d</code> argument. When <code>-d</code> is used, curl implicitly sets the request’s type to POST.</p>\n<h2 id=\"A-Neater-Way-to-POST-Data\"><a href=\"#A-Neater-Way-to-POST-Data\" class=\"headerlink\" title=\"A Neater Way to POST Data\"></a>A Neater Way to POST Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;login=emma&#x27;</span> -d <span class=\"string\">&#x27;password=123&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>The previous recipe used a single <code>-d</code> option to send all data <code>login=emma&amp;password=123</code> but here’s a neater way to do the same that makes the command easier to read. Instead of using a single <code>-d</code> argument for all data, use multiple <code>-d</code> arguments for each <code>key=value</code> data piece! If you do that, then curl joins all data pieces with the <code>&amp;</code> separator symbol when creating the request. This recipe skips the <code>-X POST</code> argument because when <code>-d</code> argument is present, curl makes a POST request implicitly.</p>\n<h2 id=\"Send-a-POST-Request-and-Follow-a-Redirect\"><a href=\"#Send-a-POST-Request-and-Follow-a-Redirect\" class=\"headerlink\" title=\"Send a POST Request and Follow a Redirect\"></a>Send a POST Request and Follow a Redirect</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -L -d <span class=\"string\">&#x27;tweet=hi&#x27;</span> https://api.twitter.com/tweet</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-L</code> command line option that tells curl to follow any possible redirects that it may encounter in the way. By default, curl doesn’t follow the redirects, so you have to add <code>-L</code> to make it follow them. This recipe skips the <code>-X POST</code> argument because <code>-d</code> argument forces curl to make a POST request.</p>\n<h2 id=\"Send-a-POST-Request-with-JSON-Data\"><a href=\"#Send-a-POST-Request-with-JSON-Data\" class=\"headerlink\" title=\"Send a POST Request with JSON Data\"></a>Send a POST Request with JSON Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;&#123;&quot;login&quot;: &quot;emma&quot;, &quot;pass&quot;: &quot;123&quot;&#125;&#x27;</span> -H <span class=\"string\">&#x27;Content-Type: application/json&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>In this recipe, curl sends a POST request with JSON data in it. This is accomplished by passing JSON to the <code>-d</code> option and also using the <code>-H</code> option that sets the <code>Content-Type</code> header to <code>application/json</code>. Setting the content type header to <code>application/json</code> is necessary because otherwise, the web server won’t know what type of data this is. I’ve also removed the <code>-X POST</code> argument as it can be skipped because <code>-d</code> forces a POST request.</p>\n<h2 id=\"Send-a-POST-Request-with-XML-Data\"><a href=\"#Send-a-POST-Request-with-XML-Data\" class=\"headerlink\" title=\"Send a POST Request with XML Data\"></a>Send a POST Request with XML Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;&lt;user&gt;&lt;login&gt;ann&lt;/login&gt;&lt;password&gt;123&lt;/password&gt;&lt;/user&gt;&#x27;</span> -H <span class=\"string\">&#x27;Content-Type: text/xml&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe POSTs XML data to <code>https://google.com/login</code>. Just like the form data and JSON data, XML data is specified in the <code>-d</code> argument. To tell the web server that the request contains XML, the <code>Content-Type</code> header is changed to <code>text/xml</code> via the <code>-H</code> argument.</p>\n<h2 id=\"Send-a-POST-Request-with-Plain-Text-Data\"><a href=\"#Send-a-POST-Request-with-Plain-Text-Data\" class=\"headerlink\" title=\"Send a POST Request with Plain Text Data\"></a>Send a POST Request with Plain Text Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;hello world&#x27;</span> -H <span class=\"string\">&#x27;Content-Type: text/plain&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe sends a POST request with a plain text string <code>hello world</code> in request’s body. It also sets the <code>Content-Type</code> header to <code>text/plain</code> to tell web server that it’s just plain text coming in.</p>\n<h2 id=\"Send-a-POST-Request-with-Data-from-a-File\"><a href=\"#Send-a-POST-Request-with-Data-from-a-File\" class=\"headerlink\" title=\"Send a POST Request with Data from a File\"></a>Send a POST Request with Data from a File</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d <span class=\"string\">&#x27;@data.txt&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe loads POST data from a file called <code>data.txt</code>. Notice the extra <code>@</code> symbol before the filename. That’s how you tell curl that <code>data.txt</code> is a file and not just a string that should go in the POST body.</p>\n<h2 id=\"URL-encode-POST-Data\"><a href=\"#URL-encode-POST-Data\" class=\"headerlink\" title=\"URL-encode POST Data\"></a>URL-encode POST Data</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --data-urlencode <span class=\"string\">&#x27;comment=hello world&#x27;</span> https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>So far, all recipes have been using the <code>-d</code> argument to add POST data to requests. This argument assumes that your data is URL-encoded already. If it is not, then there can be some trouble. If your data is not URL-encoded, then replace <code>-d</code> with <code>--data-urlencode</code>. It works exactly the same way as <code>-d</code>, except the data gets URL-encoded by curl before it’s sent out on the wire.</p>\n<h2 id=\"POST-a-Binary-File\"><a href=\"#POST-a-Binary-File\" class=\"headerlink\" title=\"POST a Binary File\"></a>POST a Binary File</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;file=@photo.png&#x27; https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-F</code> argument that forces curl to make a multipart form data POST request. It’s a more complicated content type that’s more efficient at sending binary files. This recipe makes curl read an image <code>photo.png</code> and upload it to <code>https://google.com/profile</code> with a name <code>file</code>. The <code>-F</code> argument also sets the <code>Content-Type</code> header to <code>multipart/form-data</code>.</p>\n<h2 id=\"POST-a-Binary-File-and-Set-Its-MIME-Type\"><a href=\"#POST-a-Binary-File-and-Set-Its-MIME-Type\" class=\"headerlink\" title=\"POST a Binary File and Set Its MIME Type\"></a>POST a Binary File and Set Its MIME Type</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;file=@photo.png;type=image/png&#x27; https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>Similar to the previous recipe, this recipe uses the <code>-F</code> argument to upload a binary file (a photo with the filename <code>photo.png</code>) via a multipart POST request. It also specifies the MIME type of this file and sets it to <code>image/png</code>. If no type is specified, then curl sets it to <code>application/octet-stream</code>.</p>\n<h2 id=\"POST-a-Binary-File-and-Change-Its-Filename\"><a href=\"#POST-a-Binary-File-and-Change-Its-Filename\" class=\"headerlink\" title=\"POST a Binary File and Change Its Filename\"></a>POST a Binary File and Change Its Filename</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;file=@photo.png;filename=me.png&#x27; https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>Similar to the previous two recipes, this recipe uses the <code>-F</code> argument to upload a <code>photo.png</code> via a POST request. Additionally, in this recipe, the filename that is sent to the web server is changed from <code>photo.png</code> to <code>me.png</code>. The web server only sees the filename <code>me.png</code> and doesn’t know the original filename was <code>photo.png</code>.</p>\n<h1 id=\"Add-POST-Data-to-a-Request\"><a href=\"#Add-POST-Data-to-a-Request\" class=\"headerlink\" title=\"Add POST Data to a Request\"></a>Add POST Data to a Request</h1><p>Last updated 1 week ago</p>\n<p>These curl recipes show you how to add POST data to curl requests. To add URL-encoded form data, use the <code>-d</code> argument. To make curl URL-escape form data for you, use the <code>--data-urlencode</code> argument. To send multipart form data, use the <code>-F</code> argument.</p>\n<h2 id=\"Send-Form-Data\"><a href=\"#Send-Form-Data\" class=\"headerlink\" title=\"Send Form Data\"></a>Send Form Data</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d &#x27;name=johnny%20depp&#x27; https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-d</code> argument to add <code>name=johnny%20depp</code> to the body of a POST request to <code>https://google.com/login</code>. When using the <code>-d</code> argument, curl automatically adds the <code>Content-Type: application/x-www-form-urlencoded</code> header that tells the web server it’s sending URL-encoded form data. Note that the <code>key=value</code> data should be URL-escaped.</p>\n<h2 id=\"URL-encode-and-Send-Form-Data\"><a href=\"#URL-encode-and-Send-Form-Data\" class=\"headerlink\" title=\"URL-encode and Send Form Data\"></a>URL-encode and Send Form Data</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl --data-urlencode &#x27;name=john depp&#x27; https://google.com/login</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>--data-urlencode</code> argument to add <code>name=john depp</code> form data to a POST request. This argument works just like the <code>-d</code> argument in the previous recipe, except it also URL-encodes the data. Thus, the data this recipe adds to the body of the POST request is <code>name=johnny%20depp</code> and the request is then sent to <code>https://google.com/login</code>.</p>\n<h2 id=\"Using-Multiple-d-Arguments\"><a href=\"#Using-Multiple-d-Arguments\" class=\"headerlink\" title=\"Using Multiple -d Arguments\"></a>Using Multiple -d Arguments</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -d &#x27;foo=bar&#x27; -d &#x27;baz=quux&#x27; https://google.com</span><br></pre></td></tr></table></figure>\n\n<p>The previous two recipes sent just a single variable in the POST request but you can send as many variables as you need. Just specify them one after another. This recipe POSTs two variables, <code>foo=bar</code> and <code>baz=quux</code>.</p>\n<h2 id=\"Send-Multipart-Data\"><a href=\"#Send-Multipart-Data\" class=\"headerlink\" title=\"Send Multipart Data\"></a>Send Multipart Data</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;name=johnny&#x27; https://google.com/search</span><br></pre></td></tr></table></figure>\n\n<p>This recipe uses the <code>-F</code> argument to send multipart form data in a POST request. When sending multipart data, curl sets the <code>Content-Type</code> header to <code>multipart/form-data</code>. Sending multipart data is useful when you need to upload images or other binary files.</p>\n<h2 id=\"Upload-an-Image\"><a href=\"#Upload-an-Image\" class=\"headerlink\" title=\"Upload an Image\"></a>Upload an Image</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;pic=@me.jpg&#x27; https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>This recipe also uses the <code>-F</code> argument but instead of sending textual data, it sends the file <code>me.jpg</code>. It uploads it to <code>https://google.com/profile</code> via a POST request. As this recipe uses the <code>-F</code> argument, this image is uploaded as multipart base64-encoded form data.</p>\n<h2 id=\"Upload-an-Image-and-Change-Its-Filename\"><a href=\"#Upload-an-Image-and-Change-Its-Filename\" class=\"headerlink\" title=\"Upload an Image and Change Its Filename\"></a>Upload an Image and Change Its Filename</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -F &#x27;pic=@me.jpg;filename=x.jpg&#x27; https://google.com/profile</span><br></pre></td></tr></table></figure>\n\n<p>This recipe adds a special argument <code>filename=x.jpg</code> after <code>me.jpg</code>. This tells curl to use a new filename for the attached file. Curl will read <code>me.jpg</code> but tell the server that the filename is <code>x.jpg</code>.</p>\n<h2 id=\"Send-JSON-Data\"><a href=\"#Send-JSON-Data\" class=\"headerlink\" title=\"Send JSON Data\"></a>Send JSON Data</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H &#x27;Content-Type: application/json&#x27; -d &#x27;&#123;&quot;query&quot;: &quot;cats&quot;&#125;&#x27; https://google.com/search</span><br></pre></td></tr></table></figure>\n\n<p>This recipe sends a POST request with JSON data in it. It specifies the JSON data itself as the argument to the <code>-d</code> switch, and it also sets the request’s content type to <code>application/json</code> via the <code>-H</code> argument so that the web server knew that the incoming data is JSON and not plain text.</p>\n<h2 id=\"Send-XML-Data\"><a href=\"#Send-XML-Data\" class=\"headerlink\" title=\"Send XML Data\"></a>Send XML Data</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl -H &#x27;Content-Type: text/xml&#x27; -d &#x27;hello&#x27; https://google.com/msg</span><br></pre></td></tr></table></figure>\n\n<p>This recipe sets the content type header to <code>text/xml</code>, which is the MIME type of XML. It then adds <code>&lt;message&gt;hello&lt;/message&gt;</code> data to the request and POSTs it to <code>https://google.com/msg</code>. Sending XML data, JSON data, or any other text data is very similar. All you have to do is change the content type header to the correct MIME type so that the server and the application know what type of data it is.</p>\n"},{"uuid":"bbaf4819-c0ab-11ec-92a1-7557b2313227","title":"springboot项目打包","abbrlink":"9d6d839f","_content":"\n# springboot项目打包\n\n## plugin基本配置\n\n在springboot应用中，我们可以使用`spring-boot-maven-plugin`插件来打包应用，我们只需在`pom.xml`中加入以下配置：\n\n```xml\n<project>\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n```\n\n无需任何配置，springbot会自动定位到应用程序入口的Class，我们执行以下maven命令即可打包\n\n```bash\nmvn clean package\n```\n\n以`spring-exec-jar`项目为例，打包后我们在target目录下可以看到两个jar文件：\n\n```bash\n$ ls\nclasses\ngenerated-sources\nmaven-archiver\nmaven-status\nspringboot-exec-jar-1.0-SNAPSHOT.jar\nspringboot-exec-jar-1.0-SNAPSHOT.jar.original\n```\n\n其中，`springboot-exec-jar-1.0-SNAPSHOT.jar.original`是Maven标准打包插件打的jar包，它只包含我们自己的Class，不包含依赖，而`springboot-exec-jar-1.0-SNAPSHOT.jar`是Spring Boot打包插件创建的包含依赖的jar，可以直接运行：\n\n```xml\njava -jar springboot-exec-jar-1.0-SNAPSHOT.jar\n```\n\n这样，部署一个Spring Boot应用就非常简单，无需预装任何服务器，只需要上传jar包即可。\n\n在打包的时候，因为打包后的Spring Boot应用不会被修改，因此，默认情况下，`spring-boot-devtools`这个依赖不会被打包进去。但是要注意，使用早期的Spring Boot版本时，需要配置一下才能排除`spring-boot-devtools`这个依赖：\n\n```xml\n<plugin>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-maven-plugin</artifactId>\n    <configuration>\n        <excludeDevtools>true</excludeDevtools>\n    </configuration>\n</plugin>\n```\n\n如果不喜欢默认的项目名+版本号作为文件名，可以加一个配置指定文件名：\n\n```xml\n<project >\n    <build>\n        <finalName>awesome-app</finalName>\n    </build>\n</project>\n```\n\n## 可能遇到的问题\n\n如果pom中父类依赖并非`spring-boot-starter-parent`项目打包的时候可能会遇到问题。\n\n按照上面的条件，我们依次执行如下命令。\n\n```bash\nmvn clean install -DskipTests=true\njava -jar app-demo.jar\napp-demo.jar中没有主清单属性\n```\n\n会出现jar中没有主清单属性错误。查看了生成的包，只有几十k,说明并没有打包成功。\n\n那这种情况的解决办法就是修改pom文件\n\n```xml\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-maven-plugin</artifactId>\n            <executions>\n                <execution>\n                    <goals>\n                        <goal>repackage</goal>\n                    </goals>\n                </execution>\n            </executions>\n        </plugin>\n    </plugins>\n</build>\n```\n\n然后继续打包发现就没有问题了。\n\n### 分析原因\n\n- maven中的插件和phase都需要绑定在goal上，真正执行的是goal中的mojo\n- Spring-boot-maven-plugin的作用是将项目打包成可执行的jar\n- 如果打包的项目父工程是spring-boot-starter-parent,那么会将上述插件绑定到repackage的goal上\n- 否则，我们需要手动指定repackage\n- repackage的goal,会在打包后，将原包，添加上original的后缀，然后重新打出来我们执行的jar包。\n\n## spring boot maven plugin 说明\n\nSpring Boot的Maven插件（Spring Boot Maven plugin）能够以Maven的方式为应用提供Spring Boot的支持，即为Spring Boot应用提供了执行Maven操作的可能。\nSpring Boot Maven plugin能够将Spring Boot应用打包为可执行的jar或war文件，然后以通常的方式运行Spring Boot应用。\nSpring Boot Maven plugin的最新版本为2017.6.8发布的1.5.4.RELEASE，要求Java 8, Maven 3.2及以后。\n\n### Spring Boot Maven plugin的5个Goals\n\nspring-boot:repackage，默认goal。在mvn package之后，再次打包可执行的jar/war，同时保留mvn package生成的jar/war为.origin\nspring-boot:run，运行Spring Boot应用\nspring-boot:start，在mvn integration-test阶段，进行Spring Boot应用生命周期的管理\nspring-boot:stop，在mvn integration-test阶段，进行Spring Boot应用生命周期的管理\nspring-boot:build-info，生成Actuator使用的构建信息文件build-info.properties\n### 配置pom.xml文件\n\n```xml\n<build>\n\t<plugins>\n\t\t<plugin>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-maven-plugin</artifactId>\n\t\t</plugin>\n\t</plugins>\n</build>\n```\n\n### mvn package spring-boot:repackage说明\n\nSpring Boot Maven plugin的最主要goal就是repackage，其在Maven的package生命周期阶段，能够将mvn package生成的软件包，再次打包为可执行的软件包，并将mvn package生成的软件包重命名为*.original。\n\n基于上述配置，对一个生成Jar软件包的项目执行如下命令。\n\nmvn package spring-boot:repackage\n可以看到生成的两个jar文件，一个是*.jar，另一个是*.jar.original。\n\n在执行上述命令的过程中，Maven首先在package阶段打包生成*.jar文件；然后执行spring-boot:repackage重新打包，查找Manifest文件中配置的Main-Class属性，如下所示：\n\n```bahs\nManifest-Version: 1.0\nImplementation-Title: gs-consuming-rest\nImplementation-Version: 0.1.0\nArchiver-Version: Plexus Archiver\nBuilt-By: sam\nImplementation-Vendor-Id: org.springframework\nSpring-Boot-Version: 1.5.3.RELEASE\nImplementation-Vendor: Pivotal Software, Inc.\nMain-Class: org.springframework.boot.loader.JarLauncher\nStart-Class: com.ericsson.ramltest.MyApplication\nSpring-Boot-Classes: BOOT-INF/classes/\nSpring-Boot-Lib: BOOT-INF/lib/\nCreated-By: Apache Maven 3.5.0\nBuild-Jdk: 1.8.0_131\n```\n\n注意，其中的Main-Class属性值为org.springframework.boot.loader.JarLauncher；\n\nStart-Class属性值为com.ericsson.ramltest.MyApplication。\n\n其中com.ericsson.ramltest.MyApplication类中定义了main()方法，是程序的入口。\n\n通常，Spring Boot Maven plugin会在打包过程中自动为Manifest文件设置Main-Class属性，事实上该属性究竟作用几何，还可以受Spring Boot Maven plugin的配置属性layout控制的，示例如下。\n\n```xml\n<plugin>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-maven-plugin</artifactId>\n  <configuration>\n    <mainClass>${start-class}</mainClass>\n    <layout>ZIP</layout>\n  </configuration>\n  <executions>\n    <execution>\n      <goals>\n        <goal>repackage</goal>\n      </goals>\n    </execution>\n  </executions>\n</plugin>\n```\n\n注意，这里的layout属性值为ZIP。\n\n**layout属性的值可以如下：**\n\n**JAR**，即通常的可执行jar\nMain-Class: org.springframework.boot.loader.JarLauncher\n\n**WAR**，即通常的可执行war，需要的servlet容器依赖位于WEB-INF/lib-provided\nMain-Class: org.springframework.boot.loader.warLauncher\n\n**ZIP**，即DIR，类似于JAR\nMain-Class: org.springframework.boot.loader.PropertiesLauncher\n\n**MODULE**，将所有的依赖库打包（scope为provided的除外），但是不打包Spring Boot的任何Launcher。\nNONE，将所有的依赖库打包，但是不打包Spring Boot的任何Launcher。\n\nintegration-test阶段中的Spring Boot Maven plugin的start/stop\n\n```xml\n<plugin>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-maven-plugin</artifactId>\n  <executions>\n    <execution>\n      <goals>\n        <goal>repackage</goal>\n      </goals>\n    </execution>\n    <execution>\n      <id>pre-integration-test</id>\n      <goals>\n        <goal>start</goal>\n      </goals>\n      <configuration>\n        <profiles>\n          <profile>test</profile>\n        </profiles>\n      </configuration>\n    </execution>\n    <execution>\n      <id>post-integration-test</id>\n      <goals>\n        <goal>stop</goal>\n      </goals>\n    </execution>\n  </executions>\n  <configuration>\n    <mainClass>${start-class}</mainClass>\n    <executable>true</executable>\n    <fork>false</fork>\n    <wait>1000</wait>\n    <maxAttempts>180</maxAttempts>\n  </configuration>\n</plugin>\n```\n\n***\n\n参考链接：\n\n> https://docs.spring.io/spring-boot/docs/2.5.2/maven-plugin/reference/htmlsingle/\n> https://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html\n","source":"_posts/spring/springboot项目打包jar.md","raw":"---\nuuid: bbaf4819-c0ab-11ec-92a1-7557b2313227\ntitle: springboot项目打包\ncategories: Java\ntags:\n  - springBoot\nabbrlink: 9d6d839f\n---\n\n# springboot项目打包\n\n## plugin基本配置\n\n在springboot应用中，我们可以使用`spring-boot-maven-plugin`插件来打包应用，我们只需在`pom.xml`中加入以下配置：\n\n```xml\n<project>\n    <build>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n```\n\n无需任何配置，springbot会自动定位到应用程序入口的Class，我们执行以下maven命令即可打包\n\n```bash\nmvn clean package\n```\n\n以`spring-exec-jar`项目为例，打包后我们在target目录下可以看到两个jar文件：\n\n```bash\n$ ls\nclasses\ngenerated-sources\nmaven-archiver\nmaven-status\nspringboot-exec-jar-1.0-SNAPSHOT.jar\nspringboot-exec-jar-1.0-SNAPSHOT.jar.original\n```\n\n其中，`springboot-exec-jar-1.0-SNAPSHOT.jar.original`是Maven标准打包插件打的jar包，它只包含我们自己的Class，不包含依赖，而`springboot-exec-jar-1.0-SNAPSHOT.jar`是Spring Boot打包插件创建的包含依赖的jar，可以直接运行：\n\n```xml\njava -jar springboot-exec-jar-1.0-SNAPSHOT.jar\n```\n\n这样，部署一个Spring Boot应用就非常简单，无需预装任何服务器，只需要上传jar包即可。\n\n在打包的时候，因为打包后的Spring Boot应用不会被修改，因此，默认情况下，`spring-boot-devtools`这个依赖不会被打包进去。但是要注意，使用早期的Spring Boot版本时，需要配置一下才能排除`spring-boot-devtools`这个依赖：\n\n```xml\n<plugin>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-maven-plugin</artifactId>\n    <configuration>\n        <excludeDevtools>true</excludeDevtools>\n    </configuration>\n</plugin>\n```\n\n如果不喜欢默认的项目名+版本号作为文件名，可以加一个配置指定文件名：\n\n```xml\n<project >\n    <build>\n        <finalName>awesome-app</finalName>\n    </build>\n</project>\n```\n\n## 可能遇到的问题\n\n如果pom中父类依赖并非`spring-boot-starter-parent`项目打包的时候可能会遇到问题。\n\n按照上面的条件，我们依次执行如下命令。\n\n```bash\nmvn clean install -DskipTests=true\njava -jar app-demo.jar\napp-demo.jar中没有主清单属性\n```\n\n会出现jar中没有主清单属性错误。查看了生成的包，只有几十k,说明并没有打包成功。\n\n那这种情况的解决办法就是修改pom文件\n\n```xml\n<build>\n    <plugins>\n        <plugin>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-maven-plugin</artifactId>\n            <executions>\n                <execution>\n                    <goals>\n                        <goal>repackage</goal>\n                    </goals>\n                </execution>\n            </executions>\n        </plugin>\n    </plugins>\n</build>\n```\n\n然后继续打包发现就没有问题了。\n\n### 分析原因\n\n- maven中的插件和phase都需要绑定在goal上，真正执行的是goal中的mojo\n- Spring-boot-maven-plugin的作用是将项目打包成可执行的jar\n- 如果打包的项目父工程是spring-boot-starter-parent,那么会将上述插件绑定到repackage的goal上\n- 否则，我们需要手动指定repackage\n- repackage的goal,会在打包后，将原包，添加上original的后缀，然后重新打出来我们执行的jar包。\n\n## spring boot maven plugin 说明\n\nSpring Boot的Maven插件（Spring Boot Maven plugin）能够以Maven的方式为应用提供Spring Boot的支持，即为Spring Boot应用提供了执行Maven操作的可能。\nSpring Boot Maven plugin能够将Spring Boot应用打包为可执行的jar或war文件，然后以通常的方式运行Spring Boot应用。\nSpring Boot Maven plugin的最新版本为2017.6.8发布的1.5.4.RELEASE，要求Java 8, Maven 3.2及以后。\n\n### Spring Boot Maven plugin的5个Goals\n\nspring-boot:repackage，默认goal。在mvn package之后，再次打包可执行的jar/war，同时保留mvn package生成的jar/war为.origin\nspring-boot:run，运行Spring Boot应用\nspring-boot:start，在mvn integration-test阶段，进行Spring Boot应用生命周期的管理\nspring-boot:stop，在mvn integration-test阶段，进行Spring Boot应用生命周期的管理\nspring-boot:build-info，生成Actuator使用的构建信息文件build-info.properties\n### 配置pom.xml文件\n\n```xml\n<build>\n\t<plugins>\n\t\t<plugin>\n\t\t\t<groupId>org.springframework.boot</groupId>\n\t\t\t<artifactId>spring-boot-maven-plugin</artifactId>\n\t\t</plugin>\n\t</plugins>\n</build>\n```\n\n### mvn package spring-boot:repackage说明\n\nSpring Boot Maven plugin的最主要goal就是repackage，其在Maven的package生命周期阶段，能够将mvn package生成的软件包，再次打包为可执行的软件包，并将mvn package生成的软件包重命名为*.original。\n\n基于上述配置，对一个生成Jar软件包的项目执行如下命令。\n\nmvn package spring-boot:repackage\n可以看到生成的两个jar文件，一个是*.jar，另一个是*.jar.original。\n\n在执行上述命令的过程中，Maven首先在package阶段打包生成*.jar文件；然后执行spring-boot:repackage重新打包，查找Manifest文件中配置的Main-Class属性，如下所示：\n\n```bahs\nManifest-Version: 1.0\nImplementation-Title: gs-consuming-rest\nImplementation-Version: 0.1.0\nArchiver-Version: Plexus Archiver\nBuilt-By: sam\nImplementation-Vendor-Id: org.springframework\nSpring-Boot-Version: 1.5.3.RELEASE\nImplementation-Vendor: Pivotal Software, Inc.\nMain-Class: org.springframework.boot.loader.JarLauncher\nStart-Class: com.ericsson.ramltest.MyApplication\nSpring-Boot-Classes: BOOT-INF/classes/\nSpring-Boot-Lib: BOOT-INF/lib/\nCreated-By: Apache Maven 3.5.0\nBuild-Jdk: 1.8.0_131\n```\n\n注意，其中的Main-Class属性值为org.springframework.boot.loader.JarLauncher；\n\nStart-Class属性值为com.ericsson.ramltest.MyApplication。\n\n其中com.ericsson.ramltest.MyApplication类中定义了main()方法，是程序的入口。\n\n通常，Spring Boot Maven plugin会在打包过程中自动为Manifest文件设置Main-Class属性，事实上该属性究竟作用几何，还可以受Spring Boot Maven plugin的配置属性layout控制的，示例如下。\n\n```xml\n<plugin>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-maven-plugin</artifactId>\n  <configuration>\n    <mainClass>${start-class}</mainClass>\n    <layout>ZIP</layout>\n  </configuration>\n  <executions>\n    <execution>\n      <goals>\n        <goal>repackage</goal>\n      </goals>\n    </execution>\n  </executions>\n</plugin>\n```\n\n注意，这里的layout属性值为ZIP。\n\n**layout属性的值可以如下：**\n\n**JAR**，即通常的可执行jar\nMain-Class: org.springframework.boot.loader.JarLauncher\n\n**WAR**，即通常的可执行war，需要的servlet容器依赖位于WEB-INF/lib-provided\nMain-Class: org.springframework.boot.loader.warLauncher\n\n**ZIP**，即DIR，类似于JAR\nMain-Class: org.springframework.boot.loader.PropertiesLauncher\n\n**MODULE**，将所有的依赖库打包（scope为provided的除外），但是不打包Spring Boot的任何Launcher。\nNONE，将所有的依赖库打包，但是不打包Spring Boot的任何Launcher。\n\nintegration-test阶段中的Spring Boot Maven plugin的start/stop\n\n```xml\n<plugin>\n  <groupId>org.springframework.boot</groupId>\n  <artifactId>spring-boot-maven-plugin</artifactId>\n  <executions>\n    <execution>\n      <goals>\n        <goal>repackage</goal>\n      </goals>\n    </execution>\n    <execution>\n      <id>pre-integration-test</id>\n      <goals>\n        <goal>start</goal>\n      </goals>\n      <configuration>\n        <profiles>\n          <profile>test</profile>\n        </profiles>\n      </configuration>\n    </execution>\n    <execution>\n      <id>post-integration-test</id>\n      <goals>\n        <goal>stop</goal>\n      </goals>\n    </execution>\n  </executions>\n  <configuration>\n    <mainClass>${start-class}</mainClass>\n    <executable>true</executable>\n    <fork>false</fork>\n    <wait>1000</wait>\n    <maxAttempts>180</maxAttempts>\n  </configuration>\n</plugin>\n```\n\n***\n\n参考链接：\n\n> https://docs.spring.io/spring-boot/docs/2.5.2/maven-plugin/reference/htmlsingle/\n> https://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html\n","slug":"spring/springboot项目打包jar","published":1,"date":"2022-04-20T12:41:20.911Z","updated":"2022-05-04T03:23:28.100Z","_id":"cl2qzftib004s13no8wiagwn4","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"springboot项目打包\"><a href=\"#springboot项目打包\" class=\"headerlink\" title=\"springboot项目打包\"></a>springboot项目打包</h1><h2 id=\"plugin基本配置\"><a href=\"#plugin基本配置\" class=\"headerlink\" title=\"plugin基本配置\"></a>plugin基本配置</h2><p>在springboot应用中，我们可以使用<code>spring-boot-maven-plugin</code>插件来打包应用，我们只需在<code>pom.xml</code>中加入以下配置：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>无需任何配置，springbot会自动定位到应用程序入口的Class，我们执行以下maven命令即可打包</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean package</span><br></pre></td></tr></table></figure>\n\n<p>以<code>spring-exec-jar</code>项目为例，打包后我们在target目录下可以看到两个jar文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">ls</span></span><br><span class=\"line\">classes</span><br><span class=\"line\">generated-sources</span><br><span class=\"line\">maven-archiver</span><br><span class=\"line\">maven-status</span><br><span class=\"line\">springboot-exec-jar-1.0-SNAPSHOT.jar</span><br><span class=\"line\">springboot-exec-jar-1.0-SNAPSHOT.jar.original</span><br></pre></td></tr></table></figure>\n\n<p>其中，<code>springboot-exec-jar-1.0-SNAPSHOT.jar.original</code>是Maven标准打包插件打的jar包，它只包含我们自己的Class，不包含依赖，而<code>springboot-exec-jar-1.0-SNAPSHOT.jar</code>是Spring Boot打包插件创建的包含依赖的jar，可以直接运行：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -jar springboot-exec-jar-1.0-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>\n\n<p>这样，部署一个Spring Boot应用就非常简单，无需预装任何服务器，只需要上传jar包即可。</p>\n<p>在打包的时候，因为打包后的Spring Boot应用不会被修改，因此，默认情况下，<code>spring-boot-devtools</code>这个依赖不会被打包进去。但是要注意，使用早期的Spring Boot版本时，需要配置一下才能排除<code>spring-boot-devtools</code>这个依赖：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">excludeDevtools</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">excludeDevtools</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果不喜欢默认的项目名+版本号作为文件名，可以加一个配置指定文件名：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> &gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>awesome-app<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"可能遇到的问题\"><a href=\"#可能遇到的问题\" class=\"headerlink\" title=\"可能遇到的问题\"></a>可能遇到的问题</h2><p>如果pom中父类依赖并非<code>spring-boot-starter-parent</code>项目打包的时候可能会遇到问题。</p>\n<p>按照上面的条件，我们依次执行如下命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean install -DskipTests=<span class=\"literal\">true</span></span><br><span class=\"line\">java -jar app-demo.jar</span><br><span class=\"line\">app-demo.jar中没有主清单属性</span><br></pre></td></tr></table></figure>\n\n<p>会出现jar中没有主清单属性错误。查看了生成的包，只有几十k,说明并没有打包成功。</p>\n<p>那这种情况的解决办法就是修改pom文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>repackage<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后继续打包发现就没有问题了。</p>\n<h3 id=\"分析原因\"><a href=\"#分析原因\" class=\"headerlink\" title=\"分析原因\"></a>分析原因</h3><ul>\n<li>maven中的插件和phase都需要绑定在goal上，真正执行的是goal中的mojo</li>\n<li>Spring-boot-maven-plugin的作用是将项目打包成可执行的jar</li>\n<li>如果打包的项目父工程是spring-boot-starter-parent,那么会将上述插件绑定到repackage的goal上</li>\n<li>否则，我们需要手动指定repackage</li>\n<li>repackage的goal,会在打包后，将原包，添加上original的后缀，然后重新打出来我们执行的jar包。</li>\n</ul>\n<h2 id=\"spring-boot-maven-plugin-说明\"><a href=\"#spring-boot-maven-plugin-说明\" class=\"headerlink\" title=\"spring boot maven plugin 说明\"></a>spring boot maven plugin 说明</h2><p>Spring Boot的Maven插件（Spring Boot Maven plugin）能够以Maven的方式为应用提供Spring Boot的支持，即为Spring Boot应用提供了执行Maven操作的可能。<br>Spring Boot Maven plugin能够将Spring Boot应用打包为可执行的jar或war文件，然后以通常的方式运行Spring Boot应用。<br>Spring Boot Maven plugin的最新版本为2017.6.8发布的1.5.4.RELEASE，要求Java 8, Maven 3.2及以后。</p>\n<h3 id=\"Spring-Boot-Maven-plugin的5个Goals\"><a href=\"#Spring-Boot-Maven-plugin的5个Goals\" class=\"headerlink\" title=\"Spring Boot Maven plugin的5个Goals\"></a>Spring Boot Maven plugin的5个Goals</h3><p>spring-boot:repackage，默认goal。在mvn package之后，再次打包可执行的jar/war，同时保留mvn package生成的jar/war为.origin<br>spring-boot:run，运行Spring Boot应用<br>spring-boot:start，在mvn integration-test阶段，进行Spring Boot应用生命周期的管理<br>spring-boot:stop，在mvn integration-test阶段，进行Spring Boot应用生命周期的管理<br>spring-boot:build-info，生成Actuator使用的构建信息文件build-info.properties</p>\n<h3 id=\"配置pom-xml文件\"><a href=\"#配置pom-xml文件\" class=\"headerlink\" title=\"配置pom.xml文件\"></a>配置pom.xml文件</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"mvn-package-spring-boot-repackage说明\"><a href=\"#mvn-package-spring-boot-repackage说明\" class=\"headerlink\" title=\"mvn package spring-boot:repackage说明\"></a>mvn package spring-boot:repackage说明</h3><p>Spring Boot Maven plugin的最主要goal就是repackage，其在Maven的package生命周期阶段，能够将mvn package生成的软件包，再次打包为可执行的软件包，并将mvn package生成的软件包重命名为*.original。</p>\n<p>基于上述配置，对一个生成Jar软件包的项目执行如下命令。</p>\n<p>mvn package spring-boot:repackage<br>可以看到生成的两个jar文件，一个是*.jar，另一个是*.jar.original。</p>\n<p>在执行上述命令的过程中，Maven首先在package阶段打包生成*.jar文件；然后执行spring-boot:repackage重新打包，查找Manifest文件中配置的Main-Class属性，如下所示：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Manifest-Version: 1.0</span><br><span class=\"line\">Implementation-Title: gs-consuming-rest</span><br><span class=\"line\">Implementation-Version: 0.1.0</span><br><span class=\"line\">Archiver-Version: Plexus Archiver</span><br><span class=\"line\">Built-By: sam</span><br><span class=\"line\">Implementation-Vendor-Id: org.springframework</span><br><span class=\"line\">Spring-Boot-Version: 1.5.3.RELEASE</span><br><span class=\"line\">Implementation-Vendor: Pivotal Software, Inc.</span><br><span class=\"line\">Main-Class: org.springframework.boot.loader.JarLauncher</span><br><span class=\"line\">Start-Class: com.ericsson.ramltest.MyApplication</span><br><span class=\"line\">Spring-Boot-Classes: BOOT-INF/classes/</span><br><span class=\"line\">Spring-Boot-Lib: BOOT-INF/lib/</span><br><span class=\"line\">Created-By: Apache Maven 3.5.0</span><br><span class=\"line\">Build-Jdk: 1.8.0_131</span><br></pre></td></tr></table></figure>\n\n<p>注意，其中的Main-Class属性值为org.springframework.boot.loader.JarLauncher；</p>\n<p>Start-Class属性值为com.ericsson.ramltest.MyApplication。</p>\n<p>其中com.ericsson.ramltest.MyApplication类中定义了main()方法，是程序的入口。</p>\n<p>通常，Spring Boot Maven plugin会在打包过程中自动为Manifest文件设置Main-Class属性，事实上该属性究竟作用几何，还可以受Spring Boot Maven plugin的配置属性layout控制的，示例如下。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mainClass</span>&gt;</span>$&#123;start-class&#125;<span class=\"tag\">&lt;/<span class=\"name\">mainClass</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">layout</span>&gt;</span>ZIP<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>repackage<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>注意，这里的layout属性值为ZIP。</p>\n<p><strong>layout属性的值可以如下：</strong></p>\n<p><strong>JAR</strong>，即通常的可执行jar<br>Main-Class: org.springframework.boot.loader.JarLauncher</p>\n<p><strong>WAR</strong>，即通常的可执行war，需要的servlet容器依赖位于WEB-INF/lib-provided<br>Main-Class: org.springframework.boot.loader.warLauncher</p>\n<p><strong>ZIP</strong>，即DIR，类似于JAR<br>Main-Class: org.springframework.boot.loader.PropertiesLauncher</p>\n<p><strong>MODULE</strong>，将所有的依赖库打包（scope为provided的除外），但是不打包Spring Boot的任何Launcher。<br>NONE，将所有的依赖库打包，但是不打包Spring Boot的任何Launcher。</p>\n<p>integration-test阶段中的Spring Boot Maven plugin的start/stop</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>repackage<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>pre-integration-test<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>start<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">profile</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>post-integration-test<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>stop<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mainClass</span>&gt;</span>$&#123;start-class&#125;<span class=\"tag\">&lt;/<span class=\"name\">mainClass</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">executable</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">executable</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">fork</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">fork</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">wait</span>&gt;</span>1000<span class=\"tag\">&lt;/<span class=\"name\">wait</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">maxAttempts</span>&gt;</span>180<span class=\"tag\">&lt;/<span class=\"name\">maxAttempts</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<p>参考链接：</p>\n<blockquote>\n<p><a href=\"https://docs.spring.io/spring-boot/docs/2.5.2/maven-plugin/reference/htmlsingle/\">https://docs.spring.io/spring-boot/docs/2.5.2/maven-plugin/reference/htmlsingle/</a><br><a href=\"https://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html\">https://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html</a></p>\n</blockquote>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"springboot项目打包\"><a href=\"#springboot项目打包\" class=\"headerlink\" title=\"springboot项目打包\"></a>springboot项目打包</h1><h2 id=\"plugin基本配置\"><a href=\"#plugin基本配置\" class=\"headerlink\" title=\"plugin基本配置\"></a>plugin基本配置</h2><p>在springboot应用中，我们可以使用<code>spring-boot-maven-plugin</code>插件来打包应用，我们只需在<code>pom.xml</code>中加入以下配置：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>无需任何配置，springbot会自动定位到应用程序入口的Class，我们执行以下maven命令即可打包</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean package</span><br></pre></td></tr></table></figure>\n\n<p>以<code>spring-exec-jar</code>项目为例，打包后我们在target目录下可以看到两个jar文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">ls</span></span><br><span class=\"line\">classes</span><br><span class=\"line\">generated-sources</span><br><span class=\"line\">maven-archiver</span><br><span class=\"line\">maven-status</span><br><span class=\"line\">springboot-exec-jar-1.0-SNAPSHOT.jar</span><br><span class=\"line\">springboot-exec-jar-1.0-SNAPSHOT.jar.original</span><br></pre></td></tr></table></figure>\n\n<p>其中，<code>springboot-exec-jar-1.0-SNAPSHOT.jar.original</code>是Maven标准打包插件打的jar包，它只包含我们自己的Class，不包含依赖，而<code>springboot-exec-jar-1.0-SNAPSHOT.jar</code>是Spring Boot打包插件创建的包含依赖的jar，可以直接运行：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -jar springboot-exec-jar-1.0-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>\n\n<p>这样，部署一个Spring Boot应用就非常简单，无需预装任何服务器，只需要上传jar包即可。</p>\n<p>在打包的时候，因为打包后的Spring Boot应用不会被修改，因此，默认情况下，<code>spring-boot-devtools</code>这个依赖不会被打包进去。但是要注意，使用早期的Spring Boot版本时，需要配置一下才能排除<code>spring-boot-devtools</code>这个依赖：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">excludeDevtools</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">excludeDevtools</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>如果不喜欢默认的项目名+版本号作为文件名，可以加一个配置指定文件名：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> &gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">finalName</span>&gt;</span>awesome-app<span class=\"tag\">&lt;/<span class=\"name\">finalName</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"可能遇到的问题\"><a href=\"#可能遇到的问题\" class=\"headerlink\" title=\"可能遇到的问题\"></a>可能遇到的问题</h2><p>如果pom中父类依赖并非<code>spring-boot-starter-parent</code>项目打包的时候可能会遇到问题。</p>\n<p>按照上面的条件，我们依次执行如下命令。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mvn clean install -DskipTests=<span class=\"literal\">true</span></span><br><span class=\"line\">java -jar app-demo.jar</span><br><span class=\"line\">app-demo.jar中没有主清单属性</span><br></pre></td></tr></table></figure>\n\n<p>会出现jar中没有主清单属性错误。查看了生成的包，只有几十k,说明并没有打包成功。</p>\n<p>那这种情况的解决办法就是修改pom文件</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>repackage<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>然后继续打包发现就没有问题了。</p>\n<h3 id=\"分析原因\"><a href=\"#分析原因\" class=\"headerlink\" title=\"分析原因\"></a>分析原因</h3><ul>\n<li>maven中的插件和phase都需要绑定在goal上，真正执行的是goal中的mojo</li>\n<li>Spring-boot-maven-plugin的作用是将项目打包成可执行的jar</li>\n<li>如果打包的项目父工程是spring-boot-starter-parent,那么会将上述插件绑定到repackage的goal上</li>\n<li>否则，我们需要手动指定repackage</li>\n<li>repackage的goal,会在打包后，将原包，添加上original的后缀，然后重新打出来我们执行的jar包。</li>\n</ul>\n<h2 id=\"spring-boot-maven-plugin-说明\"><a href=\"#spring-boot-maven-plugin-说明\" class=\"headerlink\" title=\"spring boot maven plugin 说明\"></a>spring boot maven plugin 说明</h2><p>Spring Boot的Maven插件（Spring Boot Maven plugin）能够以Maven的方式为应用提供Spring Boot的支持，即为Spring Boot应用提供了执行Maven操作的可能。<br>Spring Boot Maven plugin能够将Spring Boot应用打包为可执行的jar或war文件，然后以通常的方式运行Spring Boot应用。<br>Spring Boot Maven plugin的最新版本为2017.6.8发布的1.5.4.RELEASE，要求Java 8, Maven 3.2及以后。</p>\n<h3 id=\"Spring-Boot-Maven-plugin的5个Goals\"><a href=\"#Spring-Boot-Maven-plugin的5个Goals\" class=\"headerlink\" title=\"Spring Boot Maven plugin的5个Goals\"></a>Spring Boot Maven plugin的5个Goals</h3><p>spring-boot:repackage，默认goal。在mvn package之后，再次打包可执行的jar/war，同时保留mvn package生成的jar/war为.origin<br>spring-boot:run，运行Spring Boot应用<br>spring-boot:start，在mvn integration-test阶段，进行Spring Boot应用生命周期的管理<br>spring-boot:stop，在mvn integration-test阶段，进行Spring Boot应用生命周期的管理<br>spring-boot:build-info，生成Actuator使用的构建信息文件build-info.properties</p>\n<h3 id=\"配置pom-xml文件\"><a href=\"#配置pom-xml文件\" class=\"headerlink\" title=\"配置pom.xml文件\"></a>配置pom.xml文件</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">build</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">plugins</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">build</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"mvn-package-spring-boot-repackage说明\"><a href=\"#mvn-package-spring-boot-repackage说明\" class=\"headerlink\" title=\"mvn package spring-boot:repackage说明\"></a>mvn package spring-boot:repackage说明</h3><p>Spring Boot Maven plugin的最主要goal就是repackage，其在Maven的package生命周期阶段，能够将mvn package生成的软件包，再次打包为可执行的软件包，并将mvn package生成的软件包重命名为*.original。</p>\n<p>基于上述配置，对一个生成Jar软件包的项目执行如下命令。</p>\n<p>mvn package spring-boot:repackage<br>可以看到生成的两个jar文件，一个是*.jar，另一个是*.jar.original。</p>\n<p>在执行上述命令的过程中，Maven首先在package阶段打包生成*.jar文件；然后执行spring-boot:repackage重新打包，查找Manifest文件中配置的Main-Class属性，如下所示：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Manifest-Version: 1.0</span><br><span class=\"line\">Implementation-Title: gs-consuming-rest</span><br><span class=\"line\">Implementation-Version: 0.1.0</span><br><span class=\"line\">Archiver-Version: Plexus Archiver</span><br><span class=\"line\">Built-By: sam</span><br><span class=\"line\">Implementation-Vendor-Id: org.springframework</span><br><span class=\"line\">Spring-Boot-Version: 1.5.3.RELEASE</span><br><span class=\"line\">Implementation-Vendor: Pivotal Software, Inc.</span><br><span class=\"line\">Main-Class: org.springframework.boot.loader.JarLauncher</span><br><span class=\"line\">Start-Class: com.ericsson.ramltest.MyApplication</span><br><span class=\"line\">Spring-Boot-Classes: BOOT-INF/classes/</span><br><span class=\"line\">Spring-Boot-Lib: BOOT-INF/lib/</span><br><span class=\"line\">Created-By: Apache Maven 3.5.0</span><br><span class=\"line\">Build-Jdk: 1.8.0_131</span><br></pre></td></tr></table></figure>\n\n<p>注意，其中的Main-Class属性值为org.springframework.boot.loader.JarLauncher；</p>\n<p>Start-Class属性值为com.ericsson.ramltest.MyApplication。</p>\n<p>其中com.ericsson.ramltest.MyApplication类中定义了main()方法，是程序的入口。</p>\n<p>通常，Spring Boot Maven plugin会在打包过程中自动为Manifest文件设置Main-Class属性，事实上该属性究竟作用几何，还可以受Spring Boot Maven plugin的配置属性layout控制的，示例如下。</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mainClass</span>&gt;</span>$&#123;start-class&#125;<span class=\"tag\">&lt;/<span class=\"name\">mainClass</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">layout</span>&gt;</span>ZIP<span class=\"tag\">&lt;/<span class=\"name\">layout</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>repackage<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>注意，这里的layout属性值为ZIP。</p>\n<p><strong>layout属性的值可以如下：</strong></p>\n<p><strong>JAR</strong>，即通常的可执行jar<br>Main-Class: org.springframework.boot.loader.JarLauncher</p>\n<p><strong>WAR</strong>，即通常的可执行war，需要的servlet容器依赖位于WEB-INF/lib-provided<br>Main-Class: org.springframework.boot.loader.warLauncher</p>\n<p><strong>ZIP</strong>，即DIR，类似于JAR<br>Main-Class: org.springframework.boot.loader.PropertiesLauncher</p>\n<p><strong>MODULE</strong>，将所有的依赖库打包（scope为provided的除外），但是不打包Spring Boot的任何Launcher。<br>NONE，将所有的依赖库打包，但是不打包Spring Boot的任何Launcher。</p>\n<p>integration-test阶段中的Spring Boot Maven plugin的start/stop</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">plugin</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>repackage<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>pre-integration-test<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>start<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">profile</span>&gt;</span>test<span class=\"tag\">&lt;/<span class=\"name\">profile</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">profiles</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">id</span>&gt;</span>post-integration-test<span class=\"tag\">&lt;/<span class=\"name\">id</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">goal</span>&gt;</span>stop<span class=\"tag\">&lt;/<span class=\"name\">goal</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">goals</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">execution</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">executions</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">mainClass</span>&gt;</span>$&#123;start-class&#125;<span class=\"tag\">&lt;/<span class=\"name\">mainClass</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">executable</span>&gt;</span>true<span class=\"tag\">&lt;/<span class=\"name\">executable</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">fork</span>&gt;</span>false<span class=\"tag\">&lt;/<span class=\"name\">fork</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">wait</span>&gt;</span>1000<span class=\"tag\">&lt;/<span class=\"name\">wait</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">maxAttempts</span>&gt;</span>180<span class=\"tag\">&lt;/<span class=\"name\">maxAttempts</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">configuration</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<hr>\n<p>参考链接：</p>\n<blockquote>\n<p><a href=\"https://docs.spring.io/spring-boot/docs/2.5.2/maven-plugin/reference/htmlsingle/\">https://docs.spring.io/spring-boot/docs/2.5.2/maven-plugin/reference/htmlsingle/</a><br><a href=\"https://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html\">https://docs.spring.io/spring-boot/docs/current/reference/html/build-tool-plugins-maven-plugin.html</a></p>\n</blockquote>\n"},{"uuid":"bbaf481b-c0ab-11ec-92a1-7557b2313227","title":"spring bean 注入的四种方式","abbrlink":"7d86e9f","_content":"\n## spring容器注入组件的四种方式\n\n- `@ComponetScan`和`@Component`（`@Componet`、`@Controller`,`@Service`,`@Repository`）使用包扫描和组件标注\n\n  例如`@SpringbootApplication`注解\n\n  ~~~java\n  @SpringBootApplication\n  源码\n  @Target(ElementType.TYPE)\n  @Retention(RetentionPolicy.RUNTIME)\n  @Documented\n  @Inherited\n  @SpringBootConfiguration\n  @EnableAutoConfiguration\n  @ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),\n  \t\t@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })\n  public @interface SpringBootApplication\n  ~~~\n\n  默认是加载和Application类所在同一目录下的包和所有子包的配置类。如果需要额外添加其他非上述包下的组件，可以增加注解`@ComponentScan`\n\n- `@Configuration`和`@Bean`方式\n\n  使用场景：导入第三方包组件，或其他jar包中类。\n\n  ~~~java\n  public class User {\n      //@Value(\"Tom\")\n      public String username;\n   \n      public User(String s) {\n          this.username = s;\n      }\n  }\n   \n   \n  @Configuration\n  public class ImportConfig {\n      @Bean\n      public User user(){\n          return new User(\"Lily\");\n      }\n  }\n   \n   \n  @RestController\n  public class ImportDemoController {\n   \n      @Autowired\n      private User user;\n   \n   \n      @RequestMapping(\"/importDemo\")\n      public String demo() throws Exception {\n          String s = user.username;\n          return \"ImportDemo@SpringBoot \" + s;\n      }\n  }\n  ~~~\n\n  \n\n- `@Import`给容器导入一个组件\n\n  - `@Import`,要导入组件的类，容器会自动注册该组件，id默认是全类名\n\n    ~~~java\n    public class ImportDemo {\n        public void doSomething () {\n            System.out.println(\"ImportDemo.doSomething()\");\n        }\n    }\n     \n    @Configuration\n    @Import({ImportDemo.class})\n    public class ImportConfig{\n        @Bean\n        public User user(){\n            return new User(\"Lily\");\n        }\n    }\n     \n     \n    @RestController\n    public class ImportDemoController {\n     \n        @Autowired\n        private User user;\n     \n        @Autowired\n        private ImportDemo importDemo;\n     \n        @RequestMapping(\"/importDemo\")\n        public String demo() throws Exception {\n            importDemo.doSomething();\n            \n            String s = user.username;\n            \n     \n            return \"ImportDemo@SpringBoot \" + s;\n        }\n    }\n    ~~~\n\n    \n\n  - `ImportSelector`,返回需要导入组件的全类名数组\n\n    ~~~java\n    //自定义逻辑返回需要导入的组件\n    public class MyImportSelector implements ImportSelector {\n     \n        //返回值，就是到导入到容器中的组件全类名\n        //AnnotationMetadata:当前标注@Import注解的类的所有注解信息\n        @Override\n        public String[] selectImports(AnnotationMetadata importingClassMetadata) {\n            // TODO Auto-generated method stub\n            //importingClassMetadata\n            //方法不要返回null值\n            //当前类的所有注解\n            Set<String> annotationTypes = importingClassMetadata.getAnnotationTypes();\n            System.out.println(\"当前配置类的注解信息：\"+annotationTypes);\n            //注意不能返回null,不然会报NullPointException\n            return new String[]\t       \t{\"com.adolph.springboot.bean.User01\",\"com.adolph.springboot.bean.User02\"};\n        }\n    }\n     \n    public class User01 {\n    \tpublic String username;\n     \n        public User01() {\n            System.out.println(\"user01...constructor\");\n        }\n    }\n     \n    public class User02 {\n        public String username;\n     \n        public User02() {\n            System.out.println(\"user02...constructor\");\n        }\n    }\n     \n    @Configuration\n    @Import({ImportDemo.class, MyImportSelector.class})\n    public class ImportConfig {\n     \n        /**\n         * 给容器中注册组件；\n         * 1）、包扫描+组件标注注解（@Controller/@Service/@Repository/@Component）[自己写的类]\n         * 2）、@Bean[导入的第三方包里面的组件]\n         * 3）、@Import[快速给容器中导入一个组件]\n         * \t\t1）、@Import(要导入到容器中的组件)；容器中就会自动注册这个组件，id默认是全类名\n         * \t\t2）、ImportSelector:返回需要导入的组件的全类名数组；\n         * \t\t3）、ImportBeanDefinitionRegistrar:手动注册bean到容器中\n         * 4）、使用Spring提供的 FactoryBean（工厂Bean）;\n         * \t\t1）、默认获取到的是工厂bean调用getObject创建的对象\n         * \t\t2）、要获取工厂Bean本身，我们需要给id前面加一个&，&userFactoryBean\n         */\n     \n        @Bean\n        public User user(){\n            return new User(\"Lily\");\n        }\n    }\n     \n    @RestController\n    public class ImportDemoController {\n     \n        @Autowired\n        private User user;\n     \n        @Autowired\n        private ImportDemo importDemo;\n     \n        @Autowired\n        private User01 user01;\n     \n        \n     \n        @RequestMapping(\"/importDemo\")\n        public String demo() throws Exception {\n            importDemo.doSomething();\n            user01.username = \"user01\";\n            String s = user.username;\n            String s1 = user01.username;\n     \n            return \"ImportDemo@SpringBoot \" + s + \" \" + s1;\n        }\n    }\n    ~~~\n\n    \n\n  - `ImportBeanDefinitionRegistrar`,手动注册bean到容器\n\n    ~~~java\n    public class User03 {\n        public String username;\n     \n        public User03() {\n            System.out.println(\"user03...constructor\");\n        }\n    }\n    \n    \n    public class MyImportBeanDefinitionRegistrar implements ImportBeanDefinitionRegistrar {\n     \n        /**\n         * AnnotationMetadata：当前类的注解信息\n         * BeanDefinitionRegistry:BeanDefinition注册类；\n         * \t\t把所有需要添加到容器中的bean；调用\n         * \t\tBeanDefinitionRegistry.registerBeanDefinition手工注册进来\n         */\n        @Override\n        public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {\n     \n            boolean definition = registry.containsBeanDefinition(\"com.paopaoedu.springboot.bean.User01\");\n            boolean definition2 = registry.containsBeanDefinition(\"com.paopaoedu.springboot.bean.User02\");\n            if(definition && definition2){\n                //指定Bean定义信息作用域都可以在这里定义；（Bean的类型，Bean。。。）\n                RootBeanDefinition beanDefinition = new RootBeanDefinition(User03.class);\n                //注册一个Bean，指定bean名\n                registry.registerBeanDefinition(\"User03\", beanDefinition);\n            }\n        }\n     \n    }\n    ~~~\n\n- 使用spring提供的FactoryBean\n  - 默认获取到的是工厂bean调用getObject创建的对象\n  - 要获取工厂Bean本身，我们需要给id前面加一个&,&xxxFactoryBean 注意类名是X，这里就是小写的x？\n\n~~~java\npublic class UserFactoryBean implements FactoryBean<User04> {\n    @Override\n    public User04 getObject() throws Exception {\n        // TODO Auto-generated method stub\n        System.out.println(\"UserFactoryBean...getObject...\");\n        return new User04(\"User04\");\n    }\n \n    @Override\n    public Class<?> getObjectType() {\n        // TODO Auto-generated method stub\n        return User04.class;\n    }\n \n    //是否单例？\n    //true：这个bean是单实例，在容器中保存一份\n    //false：多实例，每次获取都会创建一个新的bean；\n    @Override\n    public boolean isSingleton() {\n        // TODO Auto-generated method stub\n        return true;\n    }\n}\n \n \npublic class User04 {\n    public String username;\n    public User04(String s) {\n        String nowtime= DateUtil.now();\n        username=s+\" \"+nowtime;\n    }\n}\n \n \n \n@Configuration\n@Import({ImportDemo.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar.class})\npublic class ImportConfig {\n \n    /**\n     * 给容器中注册组件；\n     * 1）、包扫描+组件标注注解（@Controller/@Service/@Repository/@Component）[自己写的类]\n     * 2）、@Bean[导入的第三方包里面的组件]\n     * 3）、@Import[快速给容器中导入一个组件]\n     * \t\t1）、@Import(要导入到容器中的组件)；容器中就会自动注册这个组件，id默认是全类名\n     * \t\t2）、ImportSelector:返回需要导入的组件的全类名数组；\n     * \t\t3）、ImportBeanDefinitionRegistrar:手动注册bean到容器中\n     * 4）、使用Spring提供的 FactoryBean（工厂Bean）;\n     * \t\t1）、默认获取到的是工厂bean调用getObject创建的对象\n     * \t\t2）、要获取工厂Bean本身，我们需要给id前面加一个&，&userFactoryBean\n     */\n    @Bean\n    public UserFactoryBean userFactoryBean(){\n        return new UserFactoryBean();\n    }\n \n    @Bean\n    public User user(){\n        return new User(\"Lily\");\n    }\n}\n \n \n@RestController\npublic class ImportDemoController {\n \n    @Autowired\n    private User user;\n \n    @Autowired\n    private ImportDemo importDemo;\n \n    @Autowired\n    private User01 user01;\n \n    @Autowired\n    private UserFactoryBean userFactoryBean;\n \n    @RequestMapping(\"/importDemo\")\n    public String demo() throws Exception {\n        importDemo.doSomething();\n        user01.username = \"user01\";\n        String s = user.username;\n        String s1 = user01.username;\n        String s4 = userFactoryBean.getObject().username;\n \n        return \"ImportDemo@SpringBoot \" + s + \" \" + s1 + \" \" + s4;\n    }\n}\n \n \n@SpringBootApplication\npublic class SpringBootLearningApplication {\n \n    public static void main(String[] args) {\n        SpringApplication.run(SpringBootLearningApplication.class, args);\n \n        AnnotationConfigApplicationContext context =\n                new AnnotationConfigApplicationContext(\"com.paopaoedu.springboot.config\");\n        ImportDemo importDemo = context.getBean(ImportDemo.class);\n        importDemo.doSomething();\n        printClassName(context);\n \n        Object bean1 = context.getBean(\"userFactoryBean\");\n        Object bean2 = context.getBean(\"userFactoryBean\");\n        System.out.println(bean1 == bean2);\n    }\n \n    private static void printClassName(AnnotationConfigApplicationContext annotationConfigApplicationContext){\n        String[] beanDefinitionNames = annotationConfigApplicationContext.getBeanDefinitionNames();\n        for (int i = 0; i < beanDefinitionNames.length; i++) {\n            System.out.println(\"匹配的类\"+beanDefinitionNames[i]);\n        }\n    }\n}\n~~~\n","source":"_posts/spring/spring注入bean的四种方式.md","raw":"---\nuuid: bbaf481b-c0ab-11ec-92a1-7557b2313227\ntitle: spring bean 注入的四种方式\ncategories: Java\ntags:\n  - springBoot\nabbrlink: 7d86e9f\n---\n\n## spring容器注入组件的四种方式\n\n- `@ComponetScan`和`@Component`（`@Componet`、`@Controller`,`@Service`,`@Repository`）使用包扫描和组件标注\n\n  例如`@SpringbootApplication`注解\n\n  ~~~java\n  @SpringBootApplication\n  源码\n  @Target(ElementType.TYPE)\n  @Retention(RetentionPolicy.RUNTIME)\n  @Documented\n  @Inherited\n  @SpringBootConfiguration\n  @EnableAutoConfiguration\n  @ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),\n  \t\t@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })\n  public @interface SpringBootApplication\n  ~~~\n\n  默认是加载和Application类所在同一目录下的包和所有子包的配置类。如果需要额外添加其他非上述包下的组件，可以增加注解`@ComponentScan`\n\n- `@Configuration`和`@Bean`方式\n\n  使用场景：导入第三方包组件，或其他jar包中类。\n\n  ~~~java\n  public class User {\n      //@Value(\"Tom\")\n      public String username;\n   \n      public User(String s) {\n          this.username = s;\n      }\n  }\n   \n   \n  @Configuration\n  public class ImportConfig {\n      @Bean\n      public User user(){\n          return new User(\"Lily\");\n      }\n  }\n   \n   \n  @RestController\n  public class ImportDemoController {\n   \n      @Autowired\n      private User user;\n   \n   \n      @RequestMapping(\"/importDemo\")\n      public String demo() throws Exception {\n          String s = user.username;\n          return \"ImportDemo@SpringBoot \" + s;\n      }\n  }\n  ~~~\n\n  \n\n- `@Import`给容器导入一个组件\n\n  - `@Import`,要导入组件的类，容器会自动注册该组件，id默认是全类名\n\n    ~~~java\n    public class ImportDemo {\n        public void doSomething () {\n            System.out.println(\"ImportDemo.doSomething()\");\n        }\n    }\n     \n    @Configuration\n    @Import({ImportDemo.class})\n    public class ImportConfig{\n        @Bean\n        public User user(){\n            return new User(\"Lily\");\n        }\n    }\n     \n     \n    @RestController\n    public class ImportDemoController {\n     \n        @Autowired\n        private User user;\n     \n        @Autowired\n        private ImportDemo importDemo;\n     \n        @RequestMapping(\"/importDemo\")\n        public String demo() throws Exception {\n            importDemo.doSomething();\n            \n            String s = user.username;\n            \n     \n            return \"ImportDemo@SpringBoot \" + s;\n        }\n    }\n    ~~~\n\n    \n\n  - `ImportSelector`,返回需要导入组件的全类名数组\n\n    ~~~java\n    //自定义逻辑返回需要导入的组件\n    public class MyImportSelector implements ImportSelector {\n     \n        //返回值，就是到导入到容器中的组件全类名\n        //AnnotationMetadata:当前标注@Import注解的类的所有注解信息\n        @Override\n        public String[] selectImports(AnnotationMetadata importingClassMetadata) {\n            // TODO Auto-generated method stub\n            //importingClassMetadata\n            //方法不要返回null值\n            //当前类的所有注解\n            Set<String> annotationTypes = importingClassMetadata.getAnnotationTypes();\n            System.out.println(\"当前配置类的注解信息：\"+annotationTypes);\n            //注意不能返回null,不然会报NullPointException\n            return new String[]\t       \t{\"com.adolph.springboot.bean.User01\",\"com.adolph.springboot.bean.User02\"};\n        }\n    }\n     \n    public class User01 {\n    \tpublic String username;\n     \n        public User01() {\n            System.out.println(\"user01...constructor\");\n        }\n    }\n     \n    public class User02 {\n        public String username;\n     \n        public User02() {\n            System.out.println(\"user02...constructor\");\n        }\n    }\n     \n    @Configuration\n    @Import({ImportDemo.class, MyImportSelector.class})\n    public class ImportConfig {\n     \n        /**\n         * 给容器中注册组件；\n         * 1）、包扫描+组件标注注解（@Controller/@Service/@Repository/@Component）[自己写的类]\n         * 2）、@Bean[导入的第三方包里面的组件]\n         * 3）、@Import[快速给容器中导入一个组件]\n         * \t\t1）、@Import(要导入到容器中的组件)；容器中就会自动注册这个组件，id默认是全类名\n         * \t\t2）、ImportSelector:返回需要导入的组件的全类名数组；\n         * \t\t3）、ImportBeanDefinitionRegistrar:手动注册bean到容器中\n         * 4）、使用Spring提供的 FactoryBean（工厂Bean）;\n         * \t\t1）、默认获取到的是工厂bean调用getObject创建的对象\n         * \t\t2）、要获取工厂Bean本身，我们需要给id前面加一个&，&userFactoryBean\n         */\n     \n        @Bean\n        public User user(){\n            return new User(\"Lily\");\n        }\n    }\n     \n    @RestController\n    public class ImportDemoController {\n     \n        @Autowired\n        private User user;\n     \n        @Autowired\n        private ImportDemo importDemo;\n     \n        @Autowired\n        private User01 user01;\n     \n        \n     \n        @RequestMapping(\"/importDemo\")\n        public String demo() throws Exception {\n            importDemo.doSomething();\n            user01.username = \"user01\";\n            String s = user.username;\n            String s1 = user01.username;\n     \n            return \"ImportDemo@SpringBoot \" + s + \" \" + s1;\n        }\n    }\n    ~~~\n\n    \n\n  - `ImportBeanDefinitionRegistrar`,手动注册bean到容器\n\n    ~~~java\n    public class User03 {\n        public String username;\n     \n        public User03() {\n            System.out.println(\"user03...constructor\");\n        }\n    }\n    \n    \n    public class MyImportBeanDefinitionRegistrar implements ImportBeanDefinitionRegistrar {\n     \n        /**\n         * AnnotationMetadata：当前类的注解信息\n         * BeanDefinitionRegistry:BeanDefinition注册类；\n         * \t\t把所有需要添加到容器中的bean；调用\n         * \t\tBeanDefinitionRegistry.registerBeanDefinition手工注册进来\n         */\n        @Override\n        public void registerBeanDefinitions(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry) {\n     \n            boolean definition = registry.containsBeanDefinition(\"com.paopaoedu.springboot.bean.User01\");\n            boolean definition2 = registry.containsBeanDefinition(\"com.paopaoedu.springboot.bean.User02\");\n            if(definition && definition2){\n                //指定Bean定义信息作用域都可以在这里定义；（Bean的类型，Bean。。。）\n                RootBeanDefinition beanDefinition = new RootBeanDefinition(User03.class);\n                //注册一个Bean，指定bean名\n                registry.registerBeanDefinition(\"User03\", beanDefinition);\n            }\n        }\n     \n    }\n    ~~~\n\n- 使用spring提供的FactoryBean\n  - 默认获取到的是工厂bean调用getObject创建的对象\n  - 要获取工厂Bean本身，我们需要给id前面加一个&,&xxxFactoryBean 注意类名是X，这里就是小写的x？\n\n~~~java\npublic class UserFactoryBean implements FactoryBean<User04> {\n    @Override\n    public User04 getObject() throws Exception {\n        // TODO Auto-generated method stub\n        System.out.println(\"UserFactoryBean...getObject...\");\n        return new User04(\"User04\");\n    }\n \n    @Override\n    public Class<?> getObjectType() {\n        // TODO Auto-generated method stub\n        return User04.class;\n    }\n \n    //是否单例？\n    //true：这个bean是单实例，在容器中保存一份\n    //false：多实例，每次获取都会创建一个新的bean；\n    @Override\n    public boolean isSingleton() {\n        // TODO Auto-generated method stub\n        return true;\n    }\n}\n \n \npublic class User04 {\n    public String username;\n    public User04(String s) {\n        String nowtime= DateUtil.now();\n        username=s+\" \"+nowtime;\n    }\n}\n \n \n \n@Configuration\n@Import({ImportDemo.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar.class})\npublic class ImportConfig {\n \n    /**\n     * 给容器中注册组件；\n     * 1）、包扫描+组件标注注解（@Controller/@Service/@Repository/@Component）[自己写的类]\n     * 2）、@Bean[导入的第三方包里面的组件]\n     * 3）、@Import[快速给容器中导入一个组件]\n     * \t\t1）、@Import(要导入到容器中的组件)；容器中就会自动注册这个组件，id默认是全类名\n     * \t\t2）、ImportSelector:返回需要导入的组件的全类名数组；\n     * \t\t3）、ImportBeanDefinitionRegistrar:手动注册bean到容器中\n     * 4）、使用Spring提供的 FactoryBean（工厂Bean）;\n     * \t\t1）、默认获取到的是工厂bean调用getObject创建的对象\n     * \t\t2）、要获取工厂Bean本身，我们需要给id前面加一个&，&userFactoryBean\n     */\n    @Bean\n    public UserFactoryBean userFactoryBean(){\n        return new UserFactoryBean();\n    }\n \n    @Bean\n    public User user(){\n        return new User(\"Lily\");\n    }\n}\n \n \n@RestController\npublic class ImportDemoController {\n \n    @Autowired\n    private User user;\n \n    @Autowired\n    private ImportDemo importDemo;\n \n    @Autowired\n    private User01 user01;\n \n    @Autowired\n    private UserFactoryBean userFactoryBean;\n \n    @RequestMapping(\"/importDemo\")\n    public String demo() throws Exception {\n        importDemo.doSomething();\n        user01.username = \"user01\";\n        String s = user.username;\n        String s1 = user01.username;\n        String s4 = userFactoryBean.getObject().username;\n \n        return \"ImportDemo@SpringBoot \" + s + \" \" + s1 + \" \" + s4;\n    }\n}\n \n \n@SpringBootApplication\npublic class SpringBootLearningApplication {\n \n    public static void main(String[] args) {\n        SpringApplication.run(SpringBootLearningApplication.class, args);\n \n        AnnotationConfigApplicationContext context =\n                new AnnotationConfigApplicationContext(\"com.paopaoedu.springboot.config\");\n        ImportDemo importDemo = context.getBean(ImportDemo.class);\n        importDemo.doSomething();\n        printClassName(context);\n \n        Object bean1 = context.getBean(\"userFactoryBean\");\n        Object bean2 = context.getBean(\"userFactoryBean\");\n        System.out.println(bean1 == bean2);\n    }\n \n    private static void printClassName(AnnotationConfigApplicationContext annotationConfigApplicationContext){\n        String[] beanDefinitionNames = annotationConfigApplicationContext.getBeanDefinitionNames();\n        for (int i = 0; i < beanDefinitionNames.length; i++) {\n            System.out.println(\"匹配的类\"+beanDefinitionNames[i]);\n        }\n    }\n}\n~~~\n","slug":"spring/spring注入bean的四种方式","published":1,"date":"2022-04-20T12:41:20.914Z","updated":"2022-05-04T03:23:02.494Z","_id":"cl2qzftid004w13noghayfvxa","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"spring容器注入组件的四种方式\"><a href=\"#spring容器注入组件的四种方式\" class=\"headerlink\" title=\"spring容器注入组件的四种方式\"></a>spring容器注入组件的四种方式</h2><ul>\n<li><p><code>@ComponetScan</code>和<code>@Component</code>（<code>@Componet</code>、<code>@Controller</code>,<code>@Service</code>,<code>@Repository</code>）使用包扫描和组件标注</p>\n<p>例如<code>@SpringbootApplication</code>注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\">源码</span><br><span class=\"line\"><span class=\"meta\">@Target(ElementType.TYPE)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Inherited</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAutoConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class=\"line\"><span class=\"meta\">\t\t@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> SpringBootApplication</span><br></pre></td></tr></table></figure>\n\n<p>默认是加载和Application类所在同一目录下的包和所有子包的配置类。如果需要额外添加其他非上述包下的组件，可以增加注解<code>@ComponentScan</code></p>\n</li>\n<li><p><code>@Configuration</code>和<code>@Bean</code>方式</p>\n<p>使用场景：导入第三方包组件，或其他jar包中类。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//@Value(&quot;Tom&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String username;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">User</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.username = s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">user</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;Lily&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportDemoController</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User user;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/importDemo&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">demo</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> user.username;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;ImportDemo@SpringBoot &quot;</span> + s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>@Import</code>给容器导入一个组件</p>\n<ul>\n<li><p><code>@Import</code>,要导入组件的类，容器会自动注册该组件，id默认是全类名</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doSomething</span> <span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;ImportDemo.doSomething()&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;ImportDemo.class&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportConfig</span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">user</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;Lily&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportDemoController</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User user;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ImportDemo importDemo;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/importDemo&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">demo</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        importDemo.doSomething();</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> user.username;</span><br><span class=\"line\">        </span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;ImportDemo@SpringBoot &quot;</span> + s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>ImportSelector</code>,返回需要导入组件的全类名数组</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//自定义逻辑返回需要导入的组件</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyImportSelector</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ImportSelector</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//返回值，就是到导入到容器中的组件全类名</span></span><br><span class=\"line\">    <span class=\"comment\">//AnnotationMetadata:当前标注@Import注解的类的所有注解信息</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">        <span class=\"comment\">//importingClassMetadata</span></span><br><span class=\"line\">        <span class=\"comment\">//方法不要返回null值</span></span><br><span class=\"line\">        <span class=\"comment\">//当前类的所有注解</span></span><br><span class=\"line\">        Set&lt;String&gt; annotationTypes = importingClassMetadata.getAnnotationTypes();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;当前配置类的注解信息：&quot;</span>+annotationTypes);</span><br><span class=\"line\">        <span class=\"comment\">//注意不能返回null,不然会报NullPointException</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[]\t       \t&#123;<span class=\"string\">&quot;com.adolph.springboot.bean.User01&quot;</span>,<span class=\"string\">&quot;com.adolph.springboot.bean.User02&quot;</span>&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User01</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> String username;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">User01</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;user01...constructor&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User02</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String username;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">User02</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;user02...constructor&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;ImportDemo.class, MyImportSelector.class&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportConfig</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 给容器中注册组件；</span></span><br><span class=\"line\"><span class=\"comment\">     * 1）、包扫描+组件标注注解（<span class=\"doctag\">@Controller</span>/<span class=\"doctag\">@Service</span>/<span class=\"doctag\">@Repository</span>/<span class=\"doctag\">@Component</span>）[自己写的类]</span></span><br><span class=\"line\"><span class=\"comment\">     * 2）、<span class=\"doctag\">@Bean</span>[导入的第三方包里面的组件]</span></span><br><span class=\"line\"><span class=\"comment\">     * 3）、<span class=\"doctag\">@Import</span>[快速给容器中导入一个组件]</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t1）、<span class=\"doctag\">@Import</span>(要导入到容器中的组件)；容器中就会自动注册这个组件，id默认是全类名</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t2）、ImportSelector:返回需要导入的组件的全类名数组；</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t3）、ImportBeanDefinitionRegistrar:手动注册bean到容器中</span></span><br><span class=\"line\"><span class=\"comment\">     * 4）、使用Spring提供的 FactoryBean（工厂Bean）;</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t1）、默认获取到的是工厂bean调用getObject创建的对象</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t2）、要获取工厂Bean本身，我们需要给id前面加一个&amp;，&amp;userFactoryBean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">user</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;Lily&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportDemoController</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User user;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ImportDemo importDemo;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User01 user01;</span><br><span class=\"line\"> </span><br><span class=\"line\">    </span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/importDemo&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">demo</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        importDemo.doSomething();</span><br><span class=\"line\">        user01.username = <span class=\"string\">&quot;user01&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> user.username;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s1</span> <span class=\"operator\">=</span> user01.username;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;ImportDemo@SpringBoot &quot;</span> + s + <span class=\"string\">&quot; &quot;</span> + s1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>ImportBeanDefinitionRegistrar</code>,手动注册bean到容器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User03</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String username;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">User03</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;user03...constructor&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyImportBeanDefinitionRegistrar</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * AnnotationMetadata：当前类的注解信息</span></span><br><span class=\"line\"><span class=\"comment\">     * BeanDefinitionRegistry:BeanDefinition注册类；</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t把所有需要添加到容器中的bean；调用</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\tBeanDefinitionRegistry.registerBeanDefinition手工注册进来</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">registerBeanDefinitions</span><span class=\"params\">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">definition</span> <span class=\"operator\">=</span> registry.containsBeanDefinition(<span class=\"string\">&quot;com.paopaoedu.springboot.bean.User01&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">definition2</span> <span class=\"operator\">=</span> registry.containsBeanDefinition(<span class=\"string\">&quot;com.paopaoedu.springboot.bean.User02&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(definition &amp;&amp; definition2)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//指定Bean定义信息作用域都可以在这里定义；（Bean的类型，Bean。。。）</span></span><br><span class=\"line\">            <span class=\"type\">RootBeanDefinition</span> <span class=\"variable\">beanDefinition</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RootBeanDefinition</span>(User03.class);</span><br><span class=\"line\">            <span class=\"comment\">//注册一个Bean，指定bean名</span></span><br><span class=\"line\">            registry.registerBeanDefinition(<span class=\"string\">&quot;User03&quot;</span>, beanDefinition);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>使用spring提供的FactoryBean</p>\n<ul>\n<li>默认获取到的是工厂bean调用getObject创建的对象</li>\n<li>要获取工厂Bean本身，我们需要给id前面加一个&amp;,&amp;xxxFactoryBean 注意类名是X，这里就是小写的x？</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserFactoryBean</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">FactoryBean</span>&lt;User04&gt; &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User04 <span class=\"title function_\">getObject</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;UserFactoryBean...getObject...&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User04</span>(<span class=\"string\">&quot;User04&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class=\"line\">        <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> User04.class;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//是否单例？</span></span><br><span class=\"line\">    <span class=\"comment\">//true：这个bean是单实例，在容器中保存一份</span></span><br><span class=\"line\">    <span class=\"comment\">//false：多实例，每次获取都会创建一个新的bean；</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isSingleton</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User04</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String username;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">User04</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">        String nowtime= DateUtil.now();</span><br><span class=\"line\">        username=s+<span class=\"string\">&quot; &quot;</span>+nowtime;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;ImportDemo.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar.class&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportConfig</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 给容器中注册组件；</span></span><br><span class=\"line\"><span class=\"comment\">     * 1）、包扫描+组件标注注解（<span class=\"doctag\">@Controller</span>/<span class=\"doctag\">@Service</span>/<span class=\"doctag\">@Repository</span>/<span class=\"doctag\">@Component</span>）[自己写的类]</span></span><br><span class=\"line\"><span class=\"comment\">     * 2）、<span class=\"doctag\">@Bean</span>[导入的第三方包里面的组件]</span></span><br><span class=\"line\"><span class=\"comment\">     * 3）、<span class=\"doctag\">@Import</span>[快速给容器中导入一个组件]</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t1）、<span class=\"doctag\">@Import</span>(要导入到容器中的组件)；容器中就会自动注册这个组件，id默认是全类名</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t2）、ImportSelector:返回需要导入的组件的全类名数组；</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t3）、ImportBeanDefinitionRegistrar:手动注册bean到容器中</span></span><br><span class=\"line\"><span class=\"comment\">     * 4）、使用Spring提供的 FactoryBean（工厂Bean）;</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t1）、默认获取到的是工厂bean调用getObject创建的对象</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t2）、要获取工厂Bean本身，我们需要给id前面加一个&amp;，&amp;userFactoryBean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> UserFactoryBean <span class=\"title function_\">userFactoryBean</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UserFactoryBean</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">user</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;Lily&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportDemoController</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User user;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ImportDemo importDemo;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User01 user01;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserFactoryBean userFactoryBean;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/importDemo&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">demo</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        importDemo.doSomething();</span><br><span class=\"line\">        user01.username = <span class=\"string\">&quot;user01&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> user.username;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s1</span> <span class=\"operator\">=</span> user01.username;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s4</span> <span class=\"operator\">=</span> userFactoryBean.getObject().username;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;ImportDemo@SpringBoot &quot;</span> + s + <span class=\"string\">&quot; &quot;</span> + s1 + <span class=\"string\">&quot; &quot;</span> + s4;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringBootLearningApplication</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringBootLearningApplication.class, args);</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"type\">AnnotationConfigApplicationContext</span> <span class=\"variable\">context</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">AnnotationConfigApplicationContext</span>(<span class=\"string\">&quot;com.paopaoedu.springboot.config&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">ImportDemo</span> <span class=\"variable\">importDemo</span> <span class=\"operator\">=</span> context.getBean(ImportDemo.class);</span><br><span class=\"line\">        importDemo.doSomething();</span><br><span class=\"line\">        printClassName(context);</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">bean1</span> <span class=\"operator\">=</span> context.getBean(<span class=\"string\">&quot;userFactoryBean&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">bean2</span> <span class=\"operator\">=</span> context.getBean(<span class=\"string\">&quot;userFactoryBean&quot;</span>);</span><br><span class=\"line\">        System.out.println(bean1 == bean2);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">printClassName</span><span class=\"params\">(AnnotationConfigApplicationContext annotationConfigApplicationContext)</span>&#123;</span><br><span class=\"line\">        String[] beanDefinitionNames = annotationConfigApplicationContext.getBeanDefinitionNames();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; beanDefinitionNames.length; i++) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;匹配的类&quot;</span>+beanDefinitionNames[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"spring容器注入组件的四种方式\"><a href=\"#spring容器注入组件的四种方式\" class=\"headerlink\" title=\"spring容器注入组件的四种方式\"></a>spring容器注入组件的四种方式</h2><ul>\n<li><p><code>@ComponetScan</code>和<code>@Component</code>（<code>@Componet</code>、<code>@Controller</code>,<code>@Service</code>,<code>@Repository</code>）使用包扫描和组件标注</p>\n<p>例如<code>@SpringbootApplication</code>注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\">源码</span><br><span class=\"line\"><span class=\"meta\">@Target(ElementType.TYPE)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Inherited</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAutoConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class=\"line\"><span class=\"meta\">\t\t@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> SpringBootApplication</span><br></pre></td></tr></table></figure>\n\n<p>默认是加载和Application类所在同一目录下的包和所有子包的配置类。如果需要额外添加其他非上述包下的组件，可以增加注解<code>@ComponentScan</code></p>\n</li>\n<li><p><code>@Configuration</code>和<code>@Bean</code>方式</p>\n<p>使用场景：导入第三方包组件，或其他jar包中类。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//@Value(&quot;Tom&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String username;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">User</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.username = s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportConfig</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">user</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;Lily&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportDemoController</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User user;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/importDemo&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">demo</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> user.username;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;ImportDemo@SpringBoot &quot;</span> + s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>@Import</code>给容器导入一个组件</p>\n<ul>\n<li><p><code>@Import</code>,要导入组件的类，容器会自动注册该组件，id默认是全类名</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportDemo</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">doSomething</span> <span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;ImportDemo.doSomething()&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;ImportDemo.class&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportConfig</span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">user</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;Lily&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportDemoController</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User user;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ImportDemo importDemo;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/importDemo&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">demo</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        importDemo.doSomething();</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> user.username;</span><br><span class=\"line\">        </span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;ImportDemo@SpringBoot &quot;</span> + s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>ImportSelector</code>,返回需要导入组件的全类名数组</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//自定义逻辑返回需要导入的组件</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyImportSelector</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ImportSelector</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//返回值，就是到导入到容器中的组件全类名</span></span><br><span class=\"line\">    <span class=\"comment\">//AnnotationMetadata:当前标注@Import注解的类的所有注解信息</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">        <span class=\"comment\">//importingClassMetadata</span></span><br><span class=\"line\">        <span class=\"comment\">//方法不要返回null值</span></span><br><span class=\"line\">        <span class=\"comment\">//当前类的所有注解</span></span><br><span class=\"line\">        Set&lt;String&gt; annotationTypes = importingClassMetadata.getAnnotationTypes();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;当前配置类的注解信息：&quot;</span>+annotationTypes);</span><br><span class=\"line\">        <span class=\"comment\">//注意不能返回null,不然会报NullPointException</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>[]\t       \t&#123;<span class=\"string\">&quot;com.adolph.springboot.bean.User01&quot;</span>,<span class=\"string\">&quot;com.adolph.springboot.bean.User02&quot;</span>&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User01</span> &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">public</span> String username;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">User01</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;user01...constructor&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User02</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String username;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">User02</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;user02...constructor&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;ImportDemo.class, MyImportSelector.class&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportConfig</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 给容器中注册组件；</span></span><br><span class=\"line\"><span class=\"comment\">     * 1）、包扫描+组件标注注解（<span class=\"doctag\">@Controller</span>/<span class=\"doctag\">@Service</span>/<span class=\"doctag\">@Repository</span>/<span class=\"doctag\">@Component</span>）[自己写的类]</span></span><br><span class=\"line\"><span class=\"comment\">     * 2）、<span class=\"doctag\">@Bean</span>[导入的第三方包里面的组件]</span></span><br><span class=\"line\"><span class=\"comment\">     * 3）、<span class=\"doctag\">@Import</span>[快速给容器中导入一个组件]</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t1）、<span class=\"doctag\">@Import</span>(要导入到容器中的组件)；容器中就会自动注册这个组件，id默认是全类名</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t2）、ImportSelector:返回需要导入的组件的全类名数组；</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t3）、ImportBeanDefinitionRegistrar:手动注册bean到容器中</span></span><br><span class=\"line\"><span class=\"comment\">     * 4）、使用Spring提供的 FactoryBean（工厂Bean）;</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t1）、默认获取到的是工厂bean调用getObject创建的对象</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t2）、要获取工厂Bean本身，我们需要给id前面加一个&amp;，&amp;userFactoryBean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">user</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;Lily&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportDemoController</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User user;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ImportDemo importDemo;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User01 user01;</span><br><span class=\"line\"> </span><br><span class=\"line\">    </span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/importDemo&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">demo</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        importDemo.doSomething();</span><br><span class=\"line\">        user01.username = <span class=\"string\">&quot;user01&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> user.username;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s1</span> <span class=\"operator\">=</span> user01.username;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;ImportDemo@SpringBoot &quot;</span> + s + <span class=\"string\">&quot; &quot;</span> + s1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li><p><code>ImportBeanDefinitionRegistrar</code>,手动注册bean到容器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User03</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String username;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">User03</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;user03...constructor&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">MyImportBeanDefinitionRegistrar</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * AnnotationMetadata：当前类的注解信息</span></span><br><span class=\"line\"><span class=\"comment\">     * BeanDefinitionRegistry:BeanDefinition注册类；</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t把所有需要添加到容器中的bean；调用</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\tBeanDefinitionRegistry.registerBeanDefinition手工注册进来</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">registerBeanDefinitions</span><span class=\"params\">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">definition</span> <span class=\"operator\">=</span> registry.containsBeanDefinition(<span class=\"string\">&quot;com.paopaoedu.springboot.bean.User01&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">definition2</span> <span class=\"operator\">=</span> registry.containsBeanDefinition(<span class=\"string\">&quot;com.paopaoedu.springboot.bean.User02&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(definition &amp;&amp; definition2)&#123;</span><br><span class=\"line\">            <span class=\"comment\">//指定Bean定义信息作用域都可以在这里定义；（Bean的类型，Bean。。。）</span></span><br><span class=\"line\">            <span class=\"type\">RootBeanDefinition</span> <span class=\"variable\">beanDefinition</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RootBeanDefinition</span>(User03.class);</span><br><span class=\"line\">            <span class=\"comment\">//注册一个Bean，指定bean名</span></span><br><span class=\"line\">            registry.registerBeanDefinition(<span class=\"string\">&quot;User03&quot;</span>, beanDefinition);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>使用spring提供的FactoryBean</p>\n<ul>\n<li>默认获取到的是工厂bean调用getObject创建的对象</li>\n<li>要获取工厂Bean本身，我们需要给id前面加一个&amp;,&amp;xxxFactoryBean 注意类名是X，这里就是小写的x？</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">UserFactoryBean</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">FactoryBean</span>&lt;User04&gt; &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User04 <span class=\"title function_\">getObject</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;UserFactoryBean...getObject...&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User04</span>(<span class=\"string\">&quot;User04&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class=\"line\">        <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> User04.class;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">//是否单例？</span></span><br><span class=\"line\">    <span class=\"comment\">//true：这个bean是单实例，在容器中保存一份</span></span><br><span class=\"line\">    <span class=\"comment\">//false：多实例，每次获取都会创建一个新的bean；</span></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isSingleton</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">User04</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> String username;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">User04</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">        String nowtime= DateUtil.now();</span><br><span class=\"line\">        username=s+<span class=\"string\">&quot; &quot;</span>+nowtime;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@Import(&#123;ImportDemo.class, MyImportSelector.class, MyImportBeanDefinitionRegistrar.class&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportConfig</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 给容器中注册组件；</span></span><br><span class=\"line\"><span class=\"comment\">     * 1）、包扫描+组件标注注解（<span class=\"doctag\">@Controller</span>/<span class=\"doctag\">@Service</span>/<span class=\"doctag\">@Repository</span>/<span class=\"doctag\">@Component</span>）[自己写的类]</span></span><br><span class=\"line\"><span class=\"comment\">     * 2）、<span class=\"doctag\">@Bean</span>[导入的第三方包里面的组件]</span></span><br><span class=\"line\"><span class=\"comment\">     * 3）、<span class=\"doctag\">@Import</span>[快速给容器中导入一个组件]</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t1）、<span class=\"doctag\">@Import</span>(要导入到容器中的组件)；容器中就会自动注册这个组件，id默认是全类名</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t2）、ImportSelector:返回需要导入的组件的全类名数组；</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t3）、ImportBeanDefinitionRegistrar:手动注册bean到容器中</span></span><br><span class=\"line\"><span class=\"comment\">     * 4）、使用Spring提供的 FactoryBean（工厂Bean）;</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t1）、默认获取到的是工厂bean调用getObject创建的对象</span></span><br><span class=\"line\"><span class=\"comment\">     * \t\t2）、要获取工厂Bean本身，我们需要给id前面加一个&amp;，&amp;userFactoryBean</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> UserFactoryBean <span class=\"title function_\">userFactoryBean</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">UserFactoryBean</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">user</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(<span class=\"string\">&quot;Lily&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ImportDemoController</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User user;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ImportDemo importDemo;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> User01 user01;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> UserFactoryBean userFactoryBean;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"meta\">@RequestMapping(&quot;/importDemo&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">demo</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        importDemo.doSomething();</span><br><span class=\"line\">        user01.username = <span class=\"string\">&quot;user01&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s</span> <span class=\"operator\">=</span> user.username;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s1</span> <span class=\"operator\">=</span> user01.username;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">s4</span> <span class=\"operator\">=</span> userFactoryBean.getObject().username;</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;ImportDemo@SpringBoot &quot;</span> + s + <span class=\"string\">&quot; &quot;</span> + s1 + <span class=\"string\">&quot; &quot;</span> + s4;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"meta\">@SpringBootApplication</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">SpringBootLearningApplication</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        SpringApplication.run(SpringBootLearningApplication.class, args);</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"type\">AnnotationConfigApplicationContext</span> <span class=\"variable\">context</span> <span class=\"operator\">=</span></span><br><span class=\"line\">                <span class=\"keyword\">new</span> <span class=\"title class_\">AnnotationConfigApplicationContext</span>(<span class=\"string\">&quot;com.paopaoedu.springboot.config&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">ImportDemo</span> <span class=\"variable\">importDemo</span> <span class=\"operator\">=</span> context.getBean(ImportDemo.class);</span><br><span class=\"line\">        importDemo.doSomething();</span><br><span class=\"line\">        printClassName(context);</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">bean1</span> <span class=\"operator\">=</span> context.getBean(<span class=\"string\">&quot;userFactoryBean&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Object</span> <span class=\"variable\">bean2</span> <span class=\"operator\">=</span> context.getBean(<span class=\"string\">&quot;userFactoryBean&quot;</span>);</span><br><span class=\"line\">        System.out.println(bean1 == bean2);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">printClassName</span><span class=\"params\">(AnnotationConfigApplicationContext annotationConfigApplicationContext)</span>&#123;</span><br><span class=\"line\">        String[] beanDefinitionNames = annotationConfigApplicationContext.getBeanDefinitionNames();</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; beanDefinitionNames.length; i++) &#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;匹配的类&quot;</span>+beanDefinitionNames[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf6f21-c0ab-11ec-92a1-7557b2313227","title":"plantuml 活动图","abbrlink":"9a3b4b45","_content":"\n\n\n# plantuml活动图新语法\n\n## 活动图(新语法)\n\n[当前活动图(activity diagram)](https://plantuml.com/zh/activity-diagram-legacy)的语法有诸多限制和缺点，比如代码难以维护。\n\n所以从V7947开始提出一种全新的、更好的语法格式和软件实现供用户使用(beta版)。\n\n就像序列图一样，新的软件实现的另一个优点是它不再依赖于Graphviz。\n\n新的语法将会替换旧的语法。然而考虑到兼容性，旧的语法仍被能够使用以确保*向前兼容*。\n\n但是我们鼓励用户使用新的语法格式。\n\n## 简单活动图\n\n活动标签(activity label)以冒号开始，以分号结束。\n\n文本格式支持[creole wiki](https://plantuml.com/zh/creole)语法。\n\n活动默认安装它们定义的顺序就行连接。\n\n~~~plantuml\n@startuml\n:Hello world;\n:This is on defined on\nseveral **lines**;\n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191655177.png)\n\n## 开始/结束\n\n你可以使用关键字`start`和`stop`表示图示的开始和结束。\n\n~~~\n@startuml\nstart\n:Hello world;\n:This is on defined on\nseveral **lines**;\nstop\n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191655272.png)\n\n也可以使用 `end` 关键字。\n\n~~~\n@startuml\nstart\n:Hello world;\n:This is on defined on\nseveral **lines**;\nend\n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191655948.png)\n\n## 条件语句\n\n在图示中可以使用关键字`if`，`then`和`else`设置分支测试。标注文字则放在括号中。\n\n~~~\n@startuml\n \nstart\n \nif (Graphviz installed?) then (yes)\n  :process all\\ndiagrams;\nelse (no)\n  :process only\n  __sequence__ and __activity__ diagrams;\nendif\n \nstop\n \n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191655881.png)\n\n也可以使用关键字`elseif`设置多个分支测试。\n\n~~~\n@startuml\nstart\nif (condition A) then (yes)\n  :Text 1;\nelseif (condition B) then (yes)\n  :Text 2;\n  stop\nelseif (condition C) then (yes)\n  :Text 3;\nelseif (condition D) then (yes)\n  :Text 4;\nelse (nothing)\n  :Text else;\nendif\nstop\n@enduml\n~~~\n\n\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191656068.png)\n\n## 重复循环\n\n你可以使用关键字`repeat`和`repeatwhile`进行重复循环。\n\n~~~\n@startuml\n \nstart\n \nrepeat\n  :read data;\n  :generate diagrams;\nrepeat while (more data?)\n \nstop\n \n@enduml\n~~~\n\n![image-20211028110226692](https://raw.githubusercontent.com/xzyup/image/master/202203191656733.png)\n\n## while循环\n\n可以使用关键字`while`和`end while`进行while循环。\n\n~~~\n@startuml\n \nstart\n \nwhile (data available?)\n  :read data;\n  :generate diagrams;\nendwhile\n \nstop\n \n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191656421.png)\n\n还可以在关键字`endwhile`后添加标注，还有一种方式是使用关键字`is`。\n\n~~~\n@startuml\nwhile (check filesize ?) is (not empty)\n  :read file;\nendwhile (empty)\n:close file;\n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191656216.png)\n\n## 并行处理\n\n你可以使用关键字`fork`，`fork again`和`end fork`表示并行处理。\n\n~~~\n@startuml\n \nstart\n \nif (multiprocessor?) then (yes)\n  fork\n\t:Treatment 1;\n  fork again\n\t:Treatment 2;\n  end fork\nelse (monoproc)\n  :Treatment 1;\n  :Treatment 2;\nendif\n \n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191656860.png)\n\n### = 注释 =\n\n文本格式支持[creole wiki](https://plantuml.com/zh/creole)语法。\n\nA note can be floating, using `floating` keyword.\n\n~~~\n@startuml\nstart\n:foo1;\nfloating note left: This is a note\n:foo2;\nnote right\n  This note is on several\n  //lines// and can\n  contain <b>HTML</b>\n  ====\n  * Calling the method \"\"foo()\"\" is prohibited\nend note\nstop\n@enduml\n~~~\n\n![image-20211028110853176](https://raw.githubusercontent.com/xzyup/image/master/202203191657392.png)\n\n### = 颜色 =\n\n你可以为活动(activity)指定一种[颜色](https://plantuml.com/zh/color)。\n\n~~~\n@startuml\n \nstart\n:starting progress;\n#HotPink:reading configuration files\nThese files should edited at this point!;\n#AAAAAA:ending of the process;\n \n@enduml\n~~~\n\n![image-20211028111048219](https://raw.githubusercontent.com/xzyup/image/master/202203191657000.png)\n\n### = 箭头 =\n\n使用`->`标记，你可以给箭头添加文字或者修改箭头[颜色](https://plantuml.com/zh/color)。\n\n同时，你也可以选择点状 (dotted)，条状(dashed)，加粗或者是隐式箭头\n\n~~~\n@startuml\n:foo1;\n-> You can put text on arrows;\nif (test) then\n  -[#blue]->\n  :foo2;\n  -[#green,dashed]-> The text can\n  also be on several lines\n  and **very** long...;\n  :foo3;\nelse\n  -[#black,dotted]->\n  :foo4;\nendif\n-[#gray,bold]->\n:foo5;\n@enduml\n~~~\n\n![image-20211028111212858](https://raw.githubusercontent.com/xzyup/image/master/202203191657590.png)\n\n## 连接器(Connector)\n\n你可以使用括号定义连接器。\n\n~~~\n@startuml\nstart\n:Some activity;\n(A)\ndetach\n(A)\n:Other activity;\n@enduml\n~~~\n\n![image-20211028111322439](https://raw.githubusercontent.com/xzyup/image/master/202203191657510.png)\n\n## 组合(grouping)\n\n通过定义分区(partition)，你可以把多个活动组合(group)在一起。\n\n~~~\n@startuml\nstart\npartition Initialization {\n\t:read config file;\n\t:init internal variable;\n}\npartition Running {\n\t:wait for user interaction;\n\t:print information;\n}\n \nstop\n@enduml\n~~~\n\n![image-20211028111440387](https://raw.githubusercontent.com/xzyup/image/master/202203191657402.png)\n\n## 泳道(Swimlanes)\n\n你可以使用管道符`|`来定义泳道。\n\n还可以改变泳道的[颜色](https://plantuml.com/zh/color)。\n\n~~~\n@startuml\n|Swimlane1|\nstart\n:foo1;\n|#AntiqueWhite|Swimlane2|\n:foo2;\n:foo3;\n|Swimlane1|\n:foo4;\n|Swimlane2|\n:foo5;\nstop\n@enduml\n~~~\n\n![image-20211028111552133](https://raw.githubusercontent.com/xzyup/image/master/202203191658920.png)\n\n## 分离(detach)\n\n可以使用关键字`detach`移除箭头。\n\n~~~\n@startuml\n :start;\n fork\n   :foo1;\n   :foo2;\n fork again\n   :foo3;\n   detach\n endfork\n if (foo4) then\n   :foo5;\n   detach\n endif\n :foo6;\n detach\n :foo7;\n stop\n@enduml\n~~~\n\n![image-20211028111651950](https://raw.githubusercontent.com/xzyup/image/master/202203191658132.png)\n\n## 特殊领域语言(SDL)\n\n通过修改活动标签最后的分号分隔符(`;`)，可以为活动设置不同的形状。\n\n- `|`\n- `<`\n- `>`\n- `/`\n- `]`\n- `}`\n\n~~~\n@startuml\n:Ready;\n:next(o)|\n:Receiving;\nsplit\n :nak(i)<\n :ack(o)>\nsplit again\n :ack(i)<\n :next(o)\n on several line|\n :i := i + 1]\n :ack(o)>\nsplit again\n :err(i)<\n :nak(o)>\nsplit again\n :foo/\nsplit again\n :i > 5}\nstop\nend split\n:finish;\n@enduml\n~~~\n\n![image-20211028111822416](https://raw.githubusercontent.com/xzyup/image/master/202203191658270.png)\n\n## 一个完整的例子\n\n~~~\n@startuml\n \nstart\n:ClickServlet.handleRequest();\n:new page;\nif (Page.onSecurityCheck) then (true)\n  :Page.onInit();\n  if (isForward?) then (no)\n\t:Process controls;\n\tif (continue processing?) then (no)\n\t  stop\n\tendif\n\t\n\tif (isPost?) then (yes)\n\t  :Page.onPost();\n\telse (no)\n\t  :Page.onGet();\n\tendif\n\t:Page.onRender();\n  endif\nelse (false)\nendif\n \nif (do redirect?) then (yes)\n  :redirect process;\nelse\n  if (do forward?) then (yes)\n\t:Forward request;\n  else (no)\n\t:Render page template;\n  endif\nendif\n \nstop\n \n@enduml\n~~~\n\n![image-20211028111940853](https://raw.githubusercontent.com/xzyup/image/master/202203191658965.png)\n","source":"_posts/uml/plantuml活动图.md","raw":"---\nuuid: bbaf6f21-c0ab-11ec-92a1-7557b2313227\ntitle: plantuml 活动图\ncategories: Uml\ntags:\n  - plantuml\nabbrlink: 9a3b4b45\n---\n\n\n\n# plantuml活动图新语法\n\n## 活动图(新语法)\n\n[当前活动图(activity diagram)](https://plantuml.com/zh/activity-diagram-legacy)的语法有诸多限制和缺点，比如代码难以维护。\n\n所以从V7947开始提出一种全新的、更好的语法格式和软件实现供用户使用(beta版)。\n\n就像序列图一样，新的软件实现的另一个优点是它不再依赖于Graphviz。\n\n新的语法将会替换旧的语法。然而考虑到兼容性，旧的语法仍被能够使用以确保*向前兼容*。\n\n但是我们鼓励用户使用新的语法格式。\n\n## 简单活动图\n\n活动标签(activity label)以冒号开始，以分号结束。\n\n文本格式支持[creole wiki](https://plantuml.com/zh/creole)语法。\n\n活动默认安装它们定义的顺序就行连接。\n\n~~~plantuml\n@startuml\n:Hello world;\n:This is on defined on\nseveral **lines**;\n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191655177.png)\n\n## 开始/结束\n\n你可以使用关键字`start`和`stop`表示图示的开始和结束。\n\n~~~\n@startuml\nstart\n:Hello world;\n:This is on defined on\nseveral **lines**;\nstop\n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191655272.png)\n\n也可以使用 `end` 关键字。\n\n~~~\n@startuml\nstart\n:Hello world;\n:This is on defined on\nseveral **lines**;\nend\n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191655948.png)\n\n## 条件语句\n\n在图示中可以使用关键字`if`，`then`和`else`设置分支测试。标注文字则放在括号中。\n\n~~~\n@startuml\n \nstart\n \nif (Graphviz installed?) then (yes)\n  :process all\\ndiagrams;\nelse (no)\n  :process only\n  __sequence__ and __activity__ diagrams;\nendif\n \nstop\n \n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191655881.png)\n\n也可以使用关键字`elseif`设置多个分支测试。\n\n~~~\n@startuml\nstart\nif (condition A) then (yes)\n  :Text 1;\nelseif (condition B) then (yes)\n  :Text 2;\n  stop\nelseif (condition C) then (yes)\n  :Text 3;\nelseif (condition D) then (yes)\n  :Text 4;\nelse (nothing)\n  :Text else;\nendif\nstop\n@enduml\n~~~\n\n\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191656068.png)\n\n## 重复循环\n\n你可以使用关键字`repeat`和`repeatwhile`进行重复循环。\n\n~~~\n@startuml\n \nstart\n \nrepeat\n  :read data;\n  :generate diagrams;\nrepeat while (more data?)\n \nstop\n \n@enduml\n~~~\n\n![image-20211028110226692](https://raw.githubusercontent.com/xzyup/image/master/202203191656733.png)\n\n## while循环\n\n可以使用关键字`while`和`end while`进行while循环。\n\n~~~\n@startuml\n \nstart\n \nwhile (data available?)\n  :read data;\n  :generate diagrams;\nendwhile\n \nstop\n \n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191656421.png)\n\n还可以在关键字`endwhile`后添加标注，还有一种方式是使用关键字`is`。\n\n~~~\n@startuml\nwhile (check filesize ?) is (not empty)\n  :read file;\nendwhile (empty)\n:close file;\n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191656216.png)\n\n## 并行处理\n\n你可以使用关键字`fork`，`fork again`和`end fork`表示并行处理。\n\n~~~\n@startuml\n \nstart\n \nif (multiprocessor?) then (yes)\n  fork\n\t:Treatment 1;\n  fork again\n\t:Treatment 2;\n  end fork\nelse (monoproc)\n  :Treatment 1;\n  :Treatment 2;\nendif\n \n@enduml\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191656860.png)\n\n### = 注释 =\n\n文本格式支持[creole wiki](https://plantuml.com/zh/creole)语法。\n\nA note can be floating, using `floating` keyword.\n\n~~~\n@startuml\nstart\n:foo1;\nfloating note left: This is a note\n:foo2;\nnote right\n  This note is on several\n  //lines// and can\n  contain <b>HTML</b>\n  ====\n  * Calling the method \"\"foo()\"\" is prohibited\nend note\nstop\n@enduml\n~~~\n\n![image-20211028110853176](https://raw.githubusercontent.com/xzyup/image/master/202203191657392.png)\n\n### = 颜色 =\n\n你可以为活动(activity)指定一种[颜色](https://plantuml.com/zh/color)。\n\n~~~\n@startuml\n \nstart\n:starting progress;\n#HotPink:reading configuration files\nThese files should edited at this point!;\n#AAAAAA:ending of the process;\n \n@enduml\n~~~\n\n![image-20211028111048219](https://raw.githubusercontent.com/xzyup/image/master/202203191657000.png)\n\n### = 箭头 =\n\n使用`->`标记，你可以给箭头添加文字或者修改箭头[颜色](https://plantuml.com/zh/color)。\n\n同时，你也可以选择点状 (dotted)，条状(dashed)，加粗或者是隐式箭头\n\n~~~\n@startuml\n:foo1;\n-> You can put text on arrows;\nif (test) then\n  -[#blue]->\n  :foo2;\n  -[#green,dashed]-> The text can\n  also be on several lines\n  and **very** long...;\n  :foo3;\nelse\n  -[#black,dotted]->\n  :foo4;\nendif\n-[#gray,bold]->\n:foo5;\n@enduml\n~~~\n\n![image-20211028111212858](https://raw.githubusercontent.com/xzyup/image/master/202203191657590.png)\n\n## 连接器(Connector)\n\n你可以使用括号定义连接器。\n\n~~~\n@startuml\nstart\n:Some activity;\n(A)\ndetach\n(A)\n:Other activity;\n@enduml\n~~~\n\n![image-20211028111322439](https://raw.githubusercontent.com/xzyup/image/master/202203191657510.png)\n\n## 组合(grouping)\n\n通过定义分区(partition)，你可以把多个活动组合(group)在一起。\n\n~~~\n@startuml\nstart\npartition Initialization {\n\t:read config file;\n\t:init internal variable;\n}\npartition Running {\n\t:wait for user interaction;\n\t:print information;\n}\n \nstop\n@enduml\n~~~\n\n![image-20211028111440387](https://raw.githubusercontent.com/xzyup/image/master/202203191657402.png)\n\n## 泳道(Swimlanes)\n\n你可以使用管道符`|`来定义泳道。\n\n还可以改变泳道的[颜色](https://plantuml.com/zh/color)。\n\n~~~\n@startuml\n|Swimlane1|\nstart\n:foo1;\n|#AntiqueWhite|Swimlane2|\n:foo2;\n:foo3;\n|Swimlane1|\n:foo4;\n|Swimlane2|\n:foo5;\nstop\n@enduml\n~~~\n\n![image-20211028111552133](https://raw.githubusercontent.com/xzyup/image/master/202203191658920.png)\n\n## 分离(detach)\n\n可以使用关键字`detach`移除箭头。\n\n~~~\n@startuml\n :start;\n fork\n   :foo1;\n   :foo2;\n fork again\n   :foo3;\n   detach\n endfork\n if (foo4) then\n   :foo5;\n   detach\n endif\n :foo6;\n detach\n :foo7;\n stop\n@enduml\n~~~\n\n![image-20211028111651950](https://raw.githubusercontent.com/xzyup/image/master/202203191658132.png)\n\n## 特殊领域语言(SDL)\n\n通过修改活动标签最后的分号分隔符(`;`)，可以为活动设置不同的形状。\n\n- `|`\n- `<`\n- `>`\n- `/`\n- `]`\n- `}`\n\n~~~\n@startuml\n:Ready;\n:next(o)|\n:Receiving;\nsplit\n :nak(i)<\n :ack(o)>\nsplit again\n :ack(i)<\n :next(o)\n on several line|\n :i := i + 1]\n :ack(o)>\nsplit again\n :err(i)<\n :nak(o)>\nsplit again\n :foo/\nsplit again\n :i > 5}\nstop\nend split\n:finish;\n@enduml\n~~~\n\n![image-20211028111822416](https://raw.githubusercontent.com/xzyup/image/master/202203191658270.png)\n\n## 一个完整的例子\n\n~~~\n@startuml\n \nstart\n:ClickServlet.handleRequest();\n:new page;\nif (Page.onSecurityCheck) then (true)\n  :Page.onInit();\n  if (isForward?) then (no)\n\t:Process controls;\n\tif (continue processing?) then (no)\n\t  stop\n\tendif\n\t\n\tif (isPost?) then (yes)\n\t  :Page.onPost();\n\telse (no)\n\t  :Page.onGet();\n\tendif\n\t:Page.onRender();\n  endif\nelse (false)\nendif\n \nif (do redirect?) then (yes)\n  :redirect process;\nelse\n  if (do forward?) then (yes)\n\t:Forward request;\n  else (no)\n\t:Render page template;\n  endif\nendif\n \nstop\n \n@enduml\n~~~\n\n![image-20211028111940853](https://raw.githubusercontent.com/xzyup/image/master/202203191658965.png)\n","slug":"uml/plantuml活动图","published":1,"date":"2022-04-20T12:41:20.806Z","updated":"2022-05-04T03:23:45.125Z","_id":"cl2qzftid004z13no5sbybwuk","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"plantuml活动图新语法\"><a href=\"#plantuml活动图新语法\" class=\"headerlink\" title=\"plantuml活动图新语法\"></a>plantuml活动图新语法</h1><h2 id=\"活动图-新语法\"><a href=\"#活动图-新语法\" class=\"headerlink\" title=\"活动图(新语法)\"></a>活动图(新语法)</h2><p><a href=\"https://plantuml.com/zh/activity-diagram-legacy\">当前活动图(activity diagram)</a>的语法有诸多限制和缺点，比如代码难以维护。</p>\n<p>所以从V7947开始提出一种全新的、更好的语法格式和软件实现供用户使用(beta版)。</p>\n<p>就像序列图一样，新的软件实现的另一个优点是它不再依赖于Graphviz。</p>\n<p>新的语法将会替换旧的语法。然而考虑到兼容性，旧的语法仍被能够使用以确保<em>向前兼容</em>。</p>\n<p>但是我们鼓励用户使用新的语法格式。</p>\n<h2 id=\"简单活动图\"><a href=\"#简单活动图\" class=\"headerlink\" title=\"简单活动图\"></a>简单活动图</h2><p>活动标签(activity label)以冒号开始，以分号结束。</p>\n<p>文本格式支持<a href=\"https://plantuml.com/zh/creole\">creole wiki</a>语法。</p>\n<p>活动默认安装它们定义的顺序就行连接。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">:Hello world;</span><br><span class=\"line\">:This is on defined on</span><br><span class=\"line\">several **lines**;</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191655177.png\"></p>\n<h2 id=\"开始-结束\"><a href=\"#开始-结束\" class=\"headerlink\" title=\"开始/结束\"></a>开始/结束</h2><p>你可以使用关键字<code>start</code>和<code>stop</code>表示图示的开始和结束。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">:Hello world;</span><br><span class=\"line\">:This is on defined on</span><br><span class=\"line\">several **lines**;</span><br><span class=\"line\">stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191655272.png\"></p>\n<p>也可以使用 <code>end</code> 关键字。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">:Hello world;</span><br><span class=\"line\">:This is on defined on</span><br><span class=\"line\">several **lines**;</span><br><span class=\"line\">end</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191655948.png\"></p>\n<h2 id=\"条件语句\"><a href=\"#条件语句\" class=\"headerlink\" title=\"条件语句\"></a>条件语句</h2><p>在图示中可以使用关键字<code>if</code>，<code>then</code>和<code>else</code>设置分支测试。标注文字则放在括号中。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\"> </span><br><span class=\"line\">if (Graphviz installed?) then (yes)</span><br><span class=\"line\">  :process all\\ndiagrams;</span><br><span class=\"line\">else (no)</span><br><span class=\"line\">  :process only</span><br><span class=\"line\">  __sequence__ and __activity__ diagrams;</span><br><span class=\"line\">endif</span><br><span class=\"line\"> </span><br><span class=\"line\">stop</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191655881.png\"></p>\n<p>也可以使用关键字<code>elseif</code>设置多个分支测试。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">if (condition A) then (yes)</span><br><span class=\"line\">  :Text 1;</span><br><span class=\"line\">elseif (condition B) then (yes)</span><br><span class=\"line\">  :Text 2;</span><br><span class=\"line\">  stop</span><br><span class=\"line\">elseif (condition C) then (yes)</span><br><span class=\"line\">  :Text 3;</span><br><span class=\"line\">elseif (condition D) then (yes)</span><br><span class=\"line\">  :Text 4;</span><br><span class=\"line\">else (nothing)</span><br><span class=\"line\">  :Text else;</span><br><span class=\"line\">endif</span><br><span class=\"line\">stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191656068.png\"></p>\n<h2 id=\"重复循环\"><a href=\"#重复循环\" class=\"headerlink\" title=\"重复循环\"></a>重复循环</h2><p>你可以使用关键字<code>repeat</code>和<code>repeatwhile</code>进行重复循环。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\"> </span><br><span class=\"line\">repeat</span><br><span class=\"line\">  :read data;</span><br><span class=\"line\">  :generate diagrams;</span><br><span class=\"line\">repeat while (more data?)</span><br><span class=\"line\"> </span><br><span class=\"line\">stop</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191656733.png\" alt=\"image-20211028110226692\"></p>\n<h2 id=\"while循环\"><a href=\"#while循环\" class=\"headerlink\" title=\"while循环\"></a>while循环</h2><p>可以使用关键字<code>while</code>和<code>end while</code>进行while循环。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\"> </span><br><span class=\"line\">while (data available?)</span><br><span class=\"line\">  :read data;</span><br><span class=\"line\">  :generate diagrams;</span><br><span class=\"line\">endwhile</span><br><span class=\"line\"> </span><br><span class=\"line\">stop</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191656421.png\"></p>\n<p>还可以在关键字<code>endwhile</code>后添加标注，还有一种方式是使用关键字<code>is</code>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">while (check filesize ?) is (not empty)</span><br><span class=\"line\">  :read file;</span><br><span class=\"line\">endwhile (empty)</span><br><span class=\"line\">:close file;</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191656216.png\"></p>\n<h2 id=\"并行处理\"><a href=\"#并行处理\" class=\"headerlink\" title=\"并行处理\"></a>并行处理</h2><p>你可以使用关键字<code>fork</code>，<code>fork again</code>和<code>end fork</code>表示并行处理。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\"> </span><br><span class=\"line\">if (multiprocessor?) then (yes)</span><br><span class=\"line\">  fork</span><br><span class=\"line\">\t:Treatment 1;</span><br><span class=\"line\">  fork again</span><br><span class=\"line\">\t:Treatment 2;</span><br><span class=\"line\">  end fork</span><br><span class=\"line\">else (monoproc)</span><br><span class=\"line\">  :Treatment 1;</span><br><span class=\"line\">  :Treatment 2;</span><br><span class=\"line\">endif</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191656860.png\"></p>\n<h3 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"= 注释 =\"></a>= 注释 =</h3><p>文本格式支持<a href=\"https://plantuml.com/zh/creole\">creole wiki</a>语法。</p>\n<p>A note can be floating, using <code>floating</code> keyword.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">:foo1;</span><br><span class=\"line\">floating note left: This is a note</span><br><span class=\"line\">:foo2;</span><br><span class=\"line\">note right</span><br><span class=\"line\">  This note is on several</span><br><span class=\"line\">  //lines// and can</span><br><span class=\"line\">  contain &lt;b&gt;HTML&lt;/b&gt;</span><br><span class=\"line\">  ====</span><br><span class=\"line\">  * Calling the method &quot;&quot;foo()&quot;&quot; is prohibited</span><br><span class=\"line\">end note</span><br><span class=\"line\">stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191657392.png\" alt=\"image-20211028110853176\"></p>\n<h3 id=\"颜色\"><a href=\"#颜色\" class=\"headerlink\" title=\"= 颜色 =\"></a>= 颜色 =</h3><p>你可以为活动(activity)指定一种<a href=\"https://plantuml.com/zh/color\">颜色</a>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\">:starting progress;</span><br><span class=\"line\">#HotPink:reading configuration files</span><br><span class=\"line\">These files should edited at this point!;</span><br><span class=\"line\">#AAAAAA:ending of the process;</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191657000.png\" alt=\"image-20211028111048219\"></p>\n<h3 id=\"箭头\"><a href=\"#箭头\" class=\"headerlink\" title=\"= 箭头 =\"></a>= 箭头 =</h3><p>使用<code>-&gt;</code>标记，你可以给箭头添加文字或者修改箭头<a href=\"https://plantuml.com/zh/color\">颜色</a>。</p>\n<p>同时，你也可以选择点状 (dotted)，条状(dashed)，加粗或者是隐式箭头</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">:foo1;</span><br><span class=\"line\">-&gt; You can put text on arrows;</span><br><span class=\"line\">if (test) then</span><br><span class=\"line\">  -[#blue]-&gt;</span><br><span class=\"line\">  :foo2;</span><br><span class=\"line\">  -[#green,dashed]-&gt; The text can</span><br><span class=\"line\">  also be on several lines</span><br><span class=\"line\">  and **very** long...;</span><br><span class=\"line\">  :foo3;</span><br><span class=\"line\">else</span><br><span class=\"line\">  -[#black,dotted]-&gt;</span><br><span class=\"line\">  :foo4;</span><br><span class=\"line\">endif</span><br><span class=\"line\">-[#gray,bold]-&gt;</span><br><span class=\"line\">:foo5;</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191657590.png\" alt=\"image-20211028111212858\"></p>\n<h2 id=\"连接器-Connector\"><a href=\"#连接器-Connector\" class=\"headerlink\" title=\"连接器(Connector)\"></a>连接器(Connector)</h2><p>你可以使用括号定义连接器。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">:Some activity;</span><br><span class=\"line\">(A)</span><br><span class=\"line\">detach</span><br><span class=\"line\">(A)</span><br><span class=\"line\">:Other activity;</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191657510.png\" alt=\"image-20211028111322439\"></p>\n<h2 id=\"组合-grouping\"><a href=\"#组合-grouping\" class=\"headerlink\" title=\"组合(grouping)\"></a>组合(grouping)</h2><p>通过定义分区(partition)，你可以把多个活动组合(group)在一起。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">partition Initialization &#123;</span><br><span class=\"line\">\t:read config file;</span><br><span class=\"line\">\t:init internal variable;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">partition Running &#123;</span><br><span class=\"line\">\t:wait for user interaction;</span><br><span class=\"line\">\t:print information;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191657402.png\" alt=\"image-20211028111440387\"></p>\n<h2 id=\"泳道-Swimlanes\"><a href=\"#泳道-Swimlanes\" class=\"headerlink\" title=\"泳道(Swimlanes)\"></a>泳道(Swimlanes)</h2><p>你可以使用管道符<code>|</code>来定义泳道。</p>\n<p>还可以改变泳道的<a href=\"https://plantuml.com/zh/color\">颜色</a>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">|Swimlane1|</span><br><span class=\"line\">start</span><br><span class=\"line\">:foo1;</span><br><span class=\"line\">|#AntiqueWhite|Swimlane2|</span><br><span class=\"line\">:foo2;</span><br><span class=\"line\">:foo3;</span><br><span class=\"line\">|Swimlane1|</span><br><span class=\"line\">:foo4;</span><br><span class=\"line\">|Swimlane2|</span><br><span class=\"line\">:foo5;</span><br><span class=\"line\">stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191658920.png\" alt=\"image-20211028111552133\"></p>\n<h2 id=\"分离-detach\"><a href=\"#分离-detach\" class=\"headerlink\" title=\"分离(detach)\"></a>分离(detach)</h2><p>可以使用关键字<code>detach</code>移除箭头。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> :start;</span><br><span class=\"line\"> fork</span><br><span class=\"line\">   :foo1;</span><br><span class=\"line\">   :foo2;</span><br><span class=\"line\"> fork again</span><br><span class=\"line\">   :foo3;</span><br><span class=\"line\">   detach</span><br><span class=\"line\"> endfork</span><br><span class=\"line\"> if (foo4) then</span><br><span class=\"line\">   :foo5;</span><br><span class=\"line\">   detach</span><br><span class=\"line\"> endif</span><br><span class=\"line\"> :foo6;</span><br><span class=\"line\"> detach</span><br><span class=\"line\"> :foo7;</span><br><span class=\"line\"> stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191658132.png\" alt=\"image-20211028111651950\"></p>\n<h2 id=\"特殊领域语言-SDL\"><a href=\"#特殊领域语言-SDL\" class=\"headerlink\" title=\"特殊领域语言(SDL)\"></a>特殊领域语言(SDL)</h2><p>通过修改活动标签最后的分号分隔符(<code>;</code>)，可以为活动设置不同的形状。</p>\n<ul>\n<li><code>|</code></li>\n<li><code>&lt;</code></li>\n<li><code>&gt;</code></li>\n<li><code>/</code></li>\n<li><code>]</code></li>\n<li><code>&#125;</code></li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">:Ready;</span><br><span class=\"line\">:next(o)|</span><br><span class=\"line\">:Receiving;</span><br><span class=\"line\">split</span><br><span class=\"line\"> :nak(i)&lt;</span><br><span class=\"line\"> :ack(o)&gt;</span><br><span class=\"line\">split again</span><br><span class=\"line\"> :ack(i)&lt;</span><br><span class=\"line\"> :next(o)</span><br><span class=\"line\"> on several line|</span><br><span class=\"line\"> :i := i + 1]</span><br><span class=\"line\"> :ack(o)&gt;</span><br><span class=\"line\">split again</span><br><span class=\"line\"> :err(i)&lt;</span><br><span class=\"line\"> :nak(o)&gt;</span><br><span class=\"line\">split again</span><br><span class=\"line\"> :foo/</span><br><span class=\"line\">split again</span><br><span class=\"line\"> :i &gt; 5&#125;</span><br><span class=\"line\">stop</span><br><span class=\"line\">end split</span><br><span class=\"line\">:finish;</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191658270.png\" alt=\"image-20211028111822416\"></p>\n<h2 id=\"一个完整的例子\"><a href=\"#一个完整的例子\" class=\"headerlink\" title=\"一个完整的例子\"></a>一个完整的例子</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\">:ClickServlet.handleRequest();</span><br><span class=\"line\">:new page;</span><br><span class=\"line\">if (Page.onSecurityCheck) then (true)</span><br><span class=\"line\">  :Page.onInit();</span><br><span class=\"line\">  if (isForward?) then (no)</span><br><span class=\"line\">\t:Process controls;</span><br><span class=\"line\">\tif (continue processing?) then (no)</span><br><span class=\"line\">\t  stop</span><br><span class=\"line\">\tendif</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tif (isPost?) then (yes)</span><br><span class=\"line\">\t  :Page.onPost();</span><br><span class=\"line\">\telse (no)</span><br><span class=\"line\">\t  :Page.onGet();</span><br><span class=\"line\">\tendif</span><br><span class=\"line\">\t:Page.onRender();</span><br><span class=\"line\">  endif</span><br><span class=\"line\">else (false)</span><br><span class=\"line\">endif</span><br><span class=\"line\"> </span><br><span class=\"line\">if (do redirect?) then (yes)</span><br><span class=\"line\">  :redirect process;</span><br><span class=\"line\">else</span><br><span class=\"line\">  if (do forward?) then (yes)</span><br><span class=\"line\">\t:Forward request;</span><br><span class=\"line\">  else (no)</span><br><span class=\"line\">\t:Render page template;</span><br><span class=\"line\">  endif</span><br><span class=\"line\">endif</span><br><span class=\"line\"> </span><br><span class=\"line\">stop</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191658965.png\" alt=\"image-20211028111940853\"></p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"plantuml活动图新语法\"><a href=\"#plantuml活动图新语法\" class=\"headerlink\" title=\"plantuml活动图新语法\"></a>plantuml活动图新语法</h1><h2 id=\"活动图-新语法\"><a href=\"#活动图-新语法\" class=\"headerlink\" title=\"活动图(新语法)\"></a>活动图(新语法)</h2><p><a href=\"https://plantuml.com/zh/activity-diagram-legacy\">当前活动图(activity diagram)</a>的语法有诸多限制和缺点，比如代码难以维护。</p>\n<p>所以从V7947开始提出一种全新的、更好的语法格式和软件实现供用户使用(beta版)。</p>\n<p>就像序列图一样，新的软件实现的另一个优点是它不再依赖于Graphviz。</p>\n<p>新的语法将会替换旧的语法。然而考虑到兼容性，旧的语法仍被能够使用以确保<em>向前兼容</em>。</p>\n<p>但是我们鼓励用户使用新的语法格式。</p>\n<h2 id=\"简单活动图\"><a href=\"#简单活动图\" class=\"headerlink\" title=\"简单活动图\"></a>简单活动图</h2><p>活动标签(activity label)以冒号开始，以分号结束。</p>\n<p>文本格式支持<a href=\"https://plantuml.com/zh/creole\">creole wiki</a>语法。</p>\n<p>活动默认安装它们定义的顺序就行连接。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">:Hello world;</span><br><span class=\"line\">:This is on defined on</span><br><span class=\"line\">several **lines**;</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191655177.png\"></p>\n<h2 id=\"开始-结束\"><a href=\"#开始-结束\" class=\"headerlink\" title=\"开始/结束\"></a>开始/结束</h2><p>你可以使用关键字<code>start</code>和<code>stop</code>表示图示的开始和结束。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">:Hello world;</span><br><span class=\"line\">:This is on defined on</span><br><span class=\"line\">several **lines**;</span><br><span class=\"line\">stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191655272.png\"></p>\n<p>也可以使用 <code>end</code> 关键字。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">:Hello world;</span><br><span class=\"line\">:This is on defined on</span><br><span class=\"line\">several **lines**;</span><br><span class=\"line\">end</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191655948.png\"></p>\n<h2 id=\"条件语句\"><a href=\"#条件语句\" class=\"headerlink\" title=\"条件语句\"></a>条件语句</h2><p>在图示中可以使用关键字<code>if</code>，<code>then</code>和<code>else</code>设置分支测试。标注文字则放在括号中。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\"> </span><br><span class=\"line\">if (Graphviz installed?) then (yes)</span><br><span class=\"line\">  :process all\\ndiagrams;</span><br><span class=\"line\">else (no)</span><br><span class=\"line\">  :process only</span><br><span class=\"line\">  __sequence__ and __activity__ diagrams;</span><br><span class=\"line\">endif</span><br><span class=\"line\"> </span><br><span class=\"line\">stop</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191655881.png\"></p>\n<p>也可以使用关键字<code>elseif</code>设置多个分支测试。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">if (condition A) then (yes)</span><br><span class=\"line\">  :Text 1;</span><br><span class=\"line\">elseif (condition B) then (yes)</span><br><span class=\"line\">  :Text 2;</span><br><span class=\"line\">  stop</span><br><span class=\"line\">elseif (condition C) then (yes)</span><br><span class=\"line\">  :Text 3;</span><br><span class=\"line\">elseif (condition D) then (yes)</span><br><span class=\"line\">  :Text 4;</span><br><span class=\"line\">else (nothing)</span><br><span class=\"line\">  :Text else;</span><br><span class=\"line\">endif</span><br><span class=\"line\">stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191656068.png\"></p>\n<h2 id=\"重复循环\"><a href=\"#重复循环\" class=\"headerlink\" title=\"重复循环\"></a>重复循环</h2><p>你可以使用关键字<code>repeat</code>和<code>repeatwhile</code>进行重复循环。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\"> </span><br><span class=\"line\">repeat</span><br><span class=\"line\">  :read data;</span><br><span class=\"line\">  :generate diagrams;</span><br><span class=\"line\">repeat while (more data?)</span><br><span class=\"line\"> </span><br><span class=\"line\">stop</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191656733.png\" alt=\"image-20211028110226692\"></p>\n<h2 id=\"while循环\"><a href=\"#while循环\" class=\"headerlink\" title=\"while循环\"></a>while循环</h2><p>可以使用关键字<code>while</code>和<code>end while</code>进行while循环。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\"> </span><br><span class=\"line\">while (data available?)</span><br><span class=\"line\">  :read data;</span><br><span class=\"line\">  :generate diagrams;</span><br><span class=\"line\">endwhile</span><br><span class=\"line\"> </span><br><span class=\"line\">stop</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191656421.png\"></p>\n<p>还可以在关键字<code>endwhile</code>后添加标注，还有一种方式是使用关键字<code>is</code>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">while (check filesize ?) is (not empty)</span><br><span class=\"line\">  :read file;</span><br><span class=\"line\">endwhile (empty)</span><br><span class=\"line\">:close file;</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191656216.png\"></p>\n<h2 id=\"并行处理\"><a href=\"#并行处理\" class=\"headerlink\" title=\"并行处理\"></a>并行处理</h2><p>你可以使用关键字<code>fork</code>，<code>fork again</code>和<code>end fork</code>表示并行处理。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\"> </span><br><span class=\"line\">if (multiprocessor?) then (yes)</span><br><span class=\"line\">  fork</span><br><span class=\"line\">\t:Treatment 1;</span><br><span class=\"line\">  fork again</span><br><span class=\"line\">\t:Treatment 2;</span><br><span class=\"line\">  end fork</span><br><span class=\"line\">else (monoproc)</span><br><span class=\"line\">  :Treatment 1;</span><br><span class=\"line\">  :Treatment 2;</span><br><span class=\"line\">endif</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191656860.png\"></p>\n<h3 id=\"注释\"><a href=\"#注释\" class=\"headerlink\" title=\"= 注释 =\"></a>= 注释 =</h3><p>文本格式支持<a href=\"https://plantuml.com/zh/creole\">creole wiki</a>语法。</p>\n<p>A note can be floating, using <code>floating</code> keyword.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">:foo1;</span><br><span class=\"line\">floating note left: This is a note</span><br><span class=\"line\">:foo2;</span><br><span class=\"line\">note right</span><br><span class=\"line\">  This note is on several</span><br><span class=\"line\">  //lines// and can</span><br><span class=\"line\">  contain &lt;b&gt;HTML&lt;/b&gt;</span><br><span class=\"line\">  ====</span><br><span class=\"line\">  * Calling the method &quot;&quot;foo()&quot;&quot; is prohibited</span><br><span class=\"line\">end note</span><br><span class=\"line\">stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191657392.png\" alt=\"image-20211028110853176\"></p>\n<h3 id=\"颜色\"><a href=\"#颜色\" class=\"headerlink\" title=\"= 颜色 =\"></a>= 颜色 =</h3><p>你可以为活动(activity)指定一种<a href=\"https://plantuml.com/zh/color\">颜色</a>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\">:starting progress;</span><br><span class=\"line\">#HotPink:reading configuration files</span><br><span class=\"line\">These files should edited at this point!;</span><br><span class=\"line\">#AAAAAA:ending of the process;</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191657000.png\" alt=\"image-20211028111048219\"></p>\n<h3 id=\"箭头\"><a href=\"#箭头\" class=\"headerlink\" title=\"= 箭头 =\"></a>= 箭头 =</h3><p>使用<code>-&gt;</code>标记，你可以给箭头添加文字或者修改箭头<a href=\"https://plantuml.com/zh/color\">颜色</a>。</p>\n<p>同时，你也可以选择点状 (dotted)，条状(dashed)，加粗或者是隐式箭头</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">:foo1;</span><br><span class=\"line\">-&gt; You can put text on arrows;</span><br><span class=\"line\">if (test) then</span><br><span class=\"line\">  -[#blue]-&gt;</span><br><span class=\"line\">  :foo2;</span><br><span class=\"line\">  -[#green,dashed]-&gt; The text can</span><br><span class=\"line\">  also be on several lines</span><br><span class=\"line\">  and **very** long...;</span><br><span class=\"line\">  :foo3;</span><br><span class=\"line\">else</span><br><span class=\"line\">  -[#black,dotted]-&gt;</span><br><span class=\"line\">  :foo4;</span><br><span class=\"line\">endif</span><br><span class=\"line\">-[#gray,bold]-&gt;</span><br><span class=\"line\">:foo5;</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191657590.png\" alt=\"image-20211028111212858\"></p>\n<h2 id=\"连接器-Connector\"><a href=\"#连接器-Connector\" class=\"headerlink\" title=\"连接器(Connector)\"></a>连接器(Connector)</h2><p>你可以使用括号定义连接器。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">:Some activity;</span><br><span class=\"line\">(A)</span><br><span class=\"line\">detach</span><br><span class=\"line\">(A)</span><br><span class=\"line\">:Other activity;</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191657510.png\" alt=\"image-20211028111322439\"></p>\n<h2 id=\"组合-grouping\"><a href=\"#组合-grouping\" class=\"headerlink\" title=\"组合(grouping)\"></a>组合(grouping)</h2><p>通过定义分区(partition)，你可以把多个活动组合(group)在一起。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">start</span><br><span class=\"line\">partition Initialization &#123;</span><br><span class=\"line\">\t:read config file;</span><br><span class=\"line\">\t:init internal variable;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">partition Running &#123;</span><br><span class=\"line\">\t:wait for user interaction;</span><br><span class=\"line\">\t:print information;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191657402.png\" alt=\"image-20211028111440387\"></p>\n<h2 id=\"泳道-Swimlanes\"><a href=\"#泳道-Swimlanes\" class=\"headerlink\" title=\"泳道(Swimlanes)\"></a>泳道(Swimlanes)</h2><p>你可以使用管道符<code>|</code>来定义泳道。</p>\n<p>还可以改变泳道的<a href=\"https://plantuml.com/zh/color\">颜色</a>。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">|Swimlane1|</span><br><span class=\"line\">start</span><br><span class=\"line\">:foo1;</span><br><span class=\"line\">|#AntiqueWhite|Swimlane2|</span><br><span class=\"line\">:foo2;</span><br><span class=\"line\">:foo3;</span><br><span class=\"line\">|Swimlane1|</span><br><span class=\"line\">:foo4;</span><br><span class=\"line\">|Swimlane2|</span><br><span class=\"line\">:foo5;</span><br><span class=\"line\">stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191658920.png\" alt=\"image-20211028111552133\"></p>\n<h2 id=\"分离-detach\"><a href=\"#分离-detach\" class=\"headerlink\" title=\"分离(detach)\"></a>分离(detach)</h2><p>可以使用关键字<code>detach</code>移除箭头。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> :start;</span><br><span class=\"line\"> fork</span><br><span class=\"line\">   :foo1;</span><br><span class=\"line\">   :foo2;</span><br><span class=\"line\"> fork again</span><br><span class=\"line\">   :foo3;</span><br><span class=\"line\">   detach</span><br><span class=\"line\"> endfork</span><br><span class=\"line\"> if (foo4) then</span><br><span class=\"line\">   :foo5;</span><br><span class=\"line\">   detach</span><br><span class=\"line\"> endif</span><br><span class=\"line\"> :foo6;</span><br><span class=\"line\"> detach</span><br><span class=\"line\"> :foo7;</span><br><span class=\"line\"> stop</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191658132.png\" alt=\"image-20211028111651950\"></p>\n<h2 id=\"特殊领域语言-SDL\"><a href=\"#特殊领域语言-SDL\" class=\"headerlink\" title=\"特殊领域语言(SDL)\"></a>特殊领域语言(SDL)</h2><p>通过修改活动标签最后的分号分隔符(<code>;</code>)，可以为活动设置不同的形状。</p>\n<ul>\n<li><code>|</code></li>\n<li><code>&lt;</code></li>\n<li><code>&gt;</code></li>\n<li><code>/</code></li>\n<li><code>]</code></li>\n<li><code>&#125;</code></li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">:Ready;</span><br><span class=\"line\">:next(o)|</span><br><span class=\"line\">:Receiving;</span><br><span class=\"line\">split</span><br><span class=\"line\"> :nak(i)&lt;</span><br><span class=\"line\"> :ack(o)&gt;</span><br><span class=\"line\">split again</span><br><span class=\"line\"> :ack(i)&lt;</span><br><span class=\"line\"> :next(o)</span><br><span class=\"line\"> on several line|</span><br><span class=\"line\"> :i := i + 1]</span><br><span class=\"line\"> :ack(o)&gt;</span><br><span class=\"line\">split again</span><br><span class=\"line\"> :err(i)&lt;</span><br><span class=\"line\"> :nak(o)&gt;</span><br><span class=\"line\">split again</span><br><span class=\"line\"> :foo/</span><br><span class=\"line\">split again</span><br><span class=\"line\"> :i &gt; 5&#125;</span><br><span class=\"line\">stop</span><br><span class=\"line\">end split</span><br><span class=\"line\">:finish;</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191658270.png\" alt=\"image-20211028111822416\"></p>\n<h2 id=\"一个完整的例子\"><a href=\"#一个完整的例子\" class=\"headerlink\" title=\"一个完整的例子\"></a>一个完整的例子</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"> </span><br><span class=\"line\">start</span><br><span class=\"line\">:ClickServlet.handleRequest();</span><br><span class=\"line\">:new page;</span><br><span class=\"line\">if (Page.onSecurityCheck) then (true)</span><br><span class=\"line\">  :Page.onInit();</span><br><span class=\"line\">  if (isForward?) then (no)</span><br><span class=\"line\">\t:Process controls;</span><br><span class=\"line\">\tif (continue processing?) then (no)</span><br><span class=\"line\">\t  stop</span><br><span class=\"line\">\tendif</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tif (isPost?) then (yes)</span><br><span class=\"line\">\t  :Page.onPost();</span><br><span class=\"line\">\telse (no)</span><br><span class=\"line\">\t  :Page.onGet();</span><br><span class=\"line\">\tendif</span><br><span class=\"line\">\t:Page.onRender();</span><br><span class=\"line\">  endif</span><br><span class=\"line\">else (false)</span><br><span class=\"line\">endif</span><br><span class=\"line\"> </span><br><span class=\"line\">if (do redirect?) then (yes)</span><br><span class=\"line\">  :redirect process;</span><br><span class=\"line\">else</span><br><span class=\"line\">  if (do forward?) then (yes)</span><br><span class=\"line\">\t:Forward request;</span><br><span class=\"line\">  else (no)</span><br><span class=\"line\">\t:Render page template;</span><br><span class=\"line\">  endif</span><br><span class=\"line\">endif</span><br><span class=\"line\"> </span><br><span class=\"line\">stop</span><br><span class=\"line\"> </span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191658965.png\" alt=\"image-20211028111940853\"></p>\n"},{"uuid":"bbaf481a-c0ab-11ec-92a1-7557b2313227","title":"springboot项目瘦身","abbrlink":"9156e972","_content":"\n\n我们使用Spring Boot提供的`spring-boot-maven-plugin`打包Spring Boot应用，可以直接获得一个完整的可运行的jar包，把它上传到服务器上再运行就极其方便。\n\n但是这种方式也不是没有缺点。最大的缺点就是包太大了，动不动几十MB，在网速不给力的情况下，上传服务器非常耗时。并且，其中我们引用到的Tomcat、Spring和其他第三方组件，只要版本号不变，这些jar就相当于每次都重复打进去，再重复上传了一遍。\n\n真正经常改动的代码其实是我们自己编写的代码。如果只打包我们自己编写的代码，通常jar包也就几百KB。但是，运行的时候，classpath中没有依赖的jar包，肯定会报错。\n\n所以问题来了：如何只打包我们自己编写的代码，同时又自动把依赖包下载到某处，并自动引入到classpath中。解决方案就是使用`spring-boot-thin-launcher`。\n\n### 使用spring-boot-thin-launcher\n\n我们先演示如何使用spring-boot-thin-launcher，再详细讨论它的工作原理。\n\n首先复制一份上一节的Maven项目，并重命名为`springboot-thin-jar`：\n\n```\n<project ...>\n    ...\n    <groupId>com.itranswarp.learnjava</groupId>\n    <artifactId>springboot-thin-jar</artifactId>\n    <version>1.0-SNAPSHOT</version>\n    ...\n```\n\n然后，修改`<build>`-`<plugins>`-`<plugin>`，给原来的`spring-boot-maven-plugin`增加一个`<dependency>`如下：\n\n```\n<project ...>\n    ...\n    <build>\n        <finalName>awesome-app</finalName>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <dependencies>\n                    <dependency>\n                        <groupId>org.springframework.boot.experimental</groupId>\n                        <artifactId>spring-boot-thin-layout</artifactId>\n                        <version>1.0.27.RELEASE</version>\n                    </dependency>\n                </dependencies>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n```\n\n不需要任何其他改动了，我们直接按正常的流程打包，执行`mvn clean package`，观察`target`目录最终生成的可执行`awesome-app.jar`，只有79KB左右。\n\n直接运行`java -jar awesome-app.jar`，效果和上一节完全一样。显然，79KB的jar肯定无法放下Tomcat和Spring这样的大块头。那么，运行时这个`awesome-app.jar`又是怎么找到它自己依赖的jar包呢？\n\n实际上`spring-boot-thin-launcher`这个插件改变了`spring-boot-maven-plugin`的默认行为。它输出的jar包只包含我们自己代码编译后的class，一个很小的`ThinJarWrapper`，以及解析`pom.xml`后得到的所有依赖jar的列表。\n\n运行的时候，入口实际上是`ThinJarWrapper`，它会先在指定目录搜索看看依赖的jar包是否都存在，如果不存在，先从Maven中央仓库下载到本地，然后，再执行我们自己编写的`main()`入口方法。这种方式有点类似很多在线安装程序：用户下载后得到的是一个很小的exe安装程序，执行安装程序时，会首先在线下载所需的若干巨大的文件，再进行真正的安装。\n\n这个`spring-boot-thin-launcher`在启动时搜索的默认目录是用户主目录的`.m2`，我们也可以指定下载目录，例如，将下载目录指定为当前目录：\n\n```\n$ java -Dthin.root=. -jar awesome-app.jar\n```\n\n上述命令通过环境变量`thin.root`传入当前目录，执行后发现当前目录下自动生成了一个`repository`目录，这和Maven的默认下载目录`~/.m2/repository`的结构是完全一样的，只是它仅包含`awesome-app.jar`所需的运行期依赖项。\n\n 注意：只有首次运行时会自动下载依赖项，再次运行时由于无需下载，所以启动速度会大大加快。如果删除了repository目录，再次运行时就会再次触发下载。\n\n### 预热\n\n把79KB大小的`awesome-app.jar`直接扔到服务器执行，上传过程就非常快。但是，第一次在服务器上运行`awesome-app.jar`时，仍需要从Maven中央仓库下载大量的jar包，所以，`spring-boot-thin-launcher`还提供了一个`dryrun`选项，专门用来下载依赖项而不执行实际代码：\n\n```\njava -Dthin.dryrun=true -Dthin.root=. -jar awesome-app.jar\n```\n\n执行上述代码会在当前目录创建`repository`目录，并下载所有依赖项，但并不会运行我们编写的`main()`方法。此过程称之为“预热”（warm up）。\n\n如果服务器由于安全限制不允许从外网下载文件，那么可以在本地预热，然后把`awesome-app.jar`和`repository`目录上传到服务器。只要依赖项没有变化，后续改动只需要上传`awesome-app.jar`即可。\n\n### 小结\n\n利用`spring-boot-thin-launcher`可以给Spring Boot应用瘦身。其原理是记录app依赖的jar包，在首次运行时先下载依赖项并缓存到本地。\n","source":"_posts/spring/springboot项目打包瘦身.md","raw":"---\nuuid: bbaf481a-c0ab-11ec-92a1-7557b2313227\ntitle: springboot项目瘦身\ncategories: Java\ntags:\n  - springBoot\nabbrlink: '9156e972'\n---\n\n\n我们使用Spring Boot提供的`spring-boot-maven-plugin`打包Spring Boot应用，可以直接获得一个完整的可运行的jar包，把它上传到服务器上再运行就极其方便。\n\n但是这种方式也不是没有缺点。最大的缺点就是包太大了，动不动几十MB，在网速不给力的情况下，上传服务器非常耗时。并且，其中我们引用到的Tomcat、Spring和其他第三方组件，只要版本号不变，这些jar就相当于每次都重复打进去，再重复上传了一遍。\n\n真正经常改动的代码其实是我们自己编写的代码。如果只打包我们自己编写的代码，通常jar包也就几百KB。但是，运行的时候，classpath中没有依赖的jar包，肯定会报错。\n\n所以问题来了：如何只打包我们自己编写的代码，同时又自动把依赖包下载到某处，并自动引入到classpath中。解决方案就是使用`spring-boot-thin-launcher`。\n\n### 使用spring-boot-thin-launcher\n\n我们先演示如何使用spring-boot-thin-launcher，再详细讨论它的工作原理。\n\n首先复制一份上一节的Maven项目，并重命名为`springboot-thin-jar`：\n\n```\n<project ...>\n    ...\n    <groupId>com.itranswarp.learnjava</groupId>\n    <artifactId>springboot-thin-jar</artifactId>\n    <version>1.0-SNAPSHOT</version>\n    ...\n```\n\n然后，修改`<build>`-`<plugins>`-`<plugin>`，给原来的`spring-boot-maven-plugin`增加一个`<dependency>`如下：\n\n```\n<project ...>\n    ...\n    <build>\n        <finalName>awesome-app</finalName>\n        <plugins>\n            <plugin>\n                <groupId>org.springframework.boot</groupId>\n                <artifactId>spring-boot-maven-plugin</artifactId>\n                <dependencies>\n                    <dependency>\n                        <groupId>org.springframework.boot.experimental</groupId>\n                        <artifactId>spring-boot-thin-layout</artifactId>\n                        <version>1.0.27.RELEASE</version>\n                    </dependency>\n                </dependencies>\n            </plugin>\n        </plugins>\n    </build>\n</project>\n```\n\n不需要任何其他改动了，我们直接按正常的流程打包，执行`mvn clean package`，观察`target`目录最终生成的可执行`awesome-app.jar`，只有79KB左右。\n\n直接运行`java -jar awesome-app.jar`，效果和上一节完全一样。显然，79KB的jar肯定无法放下Tomcat和Spring这样的大块头。那么，运行时这个`awesome-app.jar`又是怎么找到它自己依赖的jar包呢？\n\n实际上`spring-boot-thin-launcher`这个插件改变了`spring-boot-maven-plugin`的默认行为。它输出的jar包只包含我们自己代码编译后的class，一个很小的`ThinJarWrapper`，以及解析`pom.xml`后得到的所有依赖jar的列表。\n\n运行的时候，入口实际上是`ThinJarWrapper`，它会先在指定目录搜索看看依赖的jar包是否都存在，如果不存在，先从Maven中央仓库下载到本地，然后，再执行我们自己编写的`main()`入口方法。这种方式有点类似很多在线安装程序：用户下载后得到的是一个很小的exe安装程序，执行安装程序时，会首先在线下载所需的若干巨大的文件，再进行真正的安装。\n\n这个`spring-boot-thin-launcher`在启动时搜索的默认目录是用户主目录的`.m2`，我们也可以指定下载目录，例如，将下载目录指定为当前目录：\n\n```\n$ java -Dthin.root=. -jar awesome-app.jar\n```\n\n上述命令通过环境变量`thin.root`传入当前目录，执行后发现当前目录下自动生成了一个`repository`目录，这和Maven的默认下载目录`~/.m2/repository`的结构是完全一样的，只是它仅包含`awesome-app.jar`所需的运行期依赖项。\n\n 注意：只有首次运行时会自动下载依赖项，再次运行时由于无需下载，所以启动速度会大大加快。如果删除了repository目录，再次运行时就会再次触发下载。\n\n### 预热\n\n把79KB大小的`awesome-app.jar`直接扔到服务器执行，上传过程就非常快。但是，第一次在服务器上运行`awesome-app.jar`时，仍需要从Maven中央仓库下载大量的jar包，所以，`spring-boot-thin-launcher`还提供了一个`dryrun`选项，专门用来下载依赖项而不执行实际代码：\n\n```\njava -Dthin.dryrun=true -Dthin.root=. -jar awesome-app.jar\n```\n\n执行上述代码会在当前目录创建`repository`目录，并下载所有依赖项，但并不会运行我们编写的`main()`方法。此过程称之为“预热”（warm up）。\n\n如果服务器由于安全限制不允许从外网下载文件，那么可以在本地预热，然后把`awesome-app.jar`和`repository`目录上传到服务器。只要依赖项没有变化，后续改动只需要上传`awesome-app.jar`即可。\n\n### 小结\n\n利用`spring-boot-thin-launcher`可以给Spring Boot应用瘦身。其原理是记录app依赖的jar包，在首次运行时先下载依赖项并缓存到本地。\n","slug":"spring/springboot项目打包瘦身","published":1,"date":"2022-04-20T12:41:20.909Z","updated":"2022-05-04T03:23:19.571Z","_id":"cl2qzftif005313no8n873yog","comments":1,"layout":"post","photos":[],"link":"","content":"<p>我们使用Spring Boot提供的<code>spring-boot-maven-plugin</code>打包Spring Boot应用，可以直接获得一个完整的可运行的jar包，把它上传到服务器上再运行就极其方便。</p>\n<p>但是这种方式也不是没有缺点。最大的缺点就是包太大了，动不动几十MB，在网速不给力的情况下，上传服务器非常耗时。并且，其中我们引用到的Tomcat、Spring和其他第三方组件，只要版本号不变，这些jar就相当于每次都重复打进去，再重复上传了一遍。</p>\n<p>真正经常改动的代码其实是我们自己编写的代码。如果只打包我们自己编写的代码，通常jar包也就几百KB。但是，运行的时候，classpath中没有依赖的jar包，肯定会报错。</p>\n<p>所以问题来了：如何只打包我们自己编写的代码，同时又自动把依赖包下载到某处，并自动引入到classpath中。解决方案就是使用<code>spring-boot-thin-launcher</code>。</p>\n<h3 id=\"使用spring-boot-thin-launcher\"><a href=\"#使用spring-boot-thin-launcher\" class=\"headerlink\" title=\"使用spring-boot-thin-launcher\"></a>使用spring-boot-thin-launcher</h3><p>我们先演示如何使用spring-boot-thin-launcher，再详细讨论它的工作原理。</p>\n<p>首先复制一份上一节的Maven项目，并重命名为<code>springboot-thin-jar</code>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;project ...&gt;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    &lt;groupId&gt;com.itranswarp.learnjava&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;springboot-thin-jar&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n\n<p>然后，修改<code>&lt;build&gt;</code>-<code>&lt;plugins&gt;</code>-<code>&lt;plugin&gt;</code>，给原来的<code>spring-boot-maven-plugin</code>增加一个<code>&lt;dependency&gt;</code>如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;project ...&gt;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    &lt;build&gt;</span><br><span class=\"line\">        &lt;finalName&gt;awesome-app&lt;/finalName&gt;</span><br><span class=\"line\">        &lt;plugins&gt;</span><br><span class=\"line\">            &lt;plugin&gt;</span><br><span class=\"line\">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">                &lt;dependencies&gt;</span><br><span class=\"line\">                    &lt;dependency&gt;</span><br><span class=\"line\">                        &lt;groupId&gt;org.springframework.boot.experimental&lt;/groupId&gt;</span><br><span class=\"line\">                        &lt;artifactId&gt;spring-boot-thin-layout&lt;/artifactId&gt;</span><br><span class=\"line\">                        &lt;version&gt;1.0.27.RELEASE&lt;/version&gt;</span><br><span class=\"line\">                    &lt;/dependency&gt;</span><br><span class=\"line\">                &lt;/dependencies&gt;</span><br><span class=\"line\">            &lt;/plugin&gt;</span><br><span class=\"line\">        &lt;/plugins&gt;</span><br><span class=\"line\">    &lt;/build&gt;</span><br><span class=\"line\">&lt;/project&gt;</span><br></pre></td></tr></table></figure>\n\n<p>不需要任何其他改动了，我们直接按正常的流程打包，执行<code>mvn clean package</code>，观察<code>target</code>目录最终生成的可执行<code>awesome-app.jar</code>，只有79KB左右。</p>\n<p>直接运行<code>java -jar awesome-app.jar</code>，效果和上一节完全一样。显然，79KB的jar肯定无法放下Tomcat和Spring这样的大块头。那么，运行时这个<code>awesome-app.jar</code>又是怎么找到它自己依赖的jar包呢？</p>\n<p>实际上<code>spring-boot-thin-launcher</code>这个插件改变了<code>spring-boot-maven-plugin</code>的默认行为。它输出的jar包只包含我们自己代码编译后的class，一个很小的<code>ThinJarWrapper</code>，以及解析<code>pom.xml</code>后得到的所有依赖jar的列表。</p>\n<p>运行的时候，入口实际上是<code>ThinJarWrapper</code>，它会先在指定目录搜索看看依赖的jar包是否都存在，如果不存在，先从Maven中央仓库下载到本地，然后，再执行我们自己编写的<code>main()</code>入口方法。这种方式有点类似很多在线安装程序：用户下载后得到的是一个很小的exe安装程序，执行安装程序时，会首先在线下载所需的若干巨大的文件，再进行真正的安装。</p>\n<p>这个<code>spring-boot-thin-launcher</code>在启动时搜索的默认目录是用户主目录的<code>.m2</code>，我们也可以指定下载目录，例如，将下载目录指定为当前目录：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ java -Dthin.root=. -jar awesome-app.jar</span><br></pre></td></tr></table></figure>\n\n<p>上述命令通过环境变量<code>thin.root</code>传入当前目录，执行后发现当前目录下自动生成了一个<code>repository</code>目录，这和Maven的默认下载目录<code>~/.m2/repository</code>的结构是完全一样的，只是它仅包含<code>awesome-app.jar</code>所需的运行期依赖项。</p>\n<p> 注意：只有首次运行时会自动下载依赖项，再次运行时由于无需下载，所以启动速度会大大加快。如果删除了repository目录，再次运行时就会再次触发下载。</p>\n<h3 id=\"预热\"><a href=\"#预热\" class=\"headerlink\" title=\"预热\"></a>预热</h3><p>把79KB大小的<code>awesome-app.jar</code>直接扔到服务器执行，上传过程就非常快。但是，第一次在服务器上运行<code>awesome-app.jar</code>时，仍需要从Maven中央仓库下载大量的jar包，所以，<code>spring-boot-thin-launcher</code>还提供了一个<code>dryrun</code>选项，专门用来下载依赖项而不执行实际代码：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -Dthin.dryrun=true -Dthin.root=. -jar awesome-app.jar</span><br></pre></td></tr></table></figure>\n\n<p>执行上述代码会在当前目录创建<code>repository</code>目录，并下载所有依赖项，但并不会运行我们编写的<code>main()</code>方法。此过程称之为“预热”（warm up）。</p>\n<p>如果服务器由于安全限制不允许从外网下载文件，那么可以在本地预热，然后把<code>awesome-app.jar</code>和<code>repository</code>目录上传到服务器。只要依赖项没有变化，后续改动只需要上传<code>awesome-app.jar</code>即可。</p>\n<h3 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h3><p>利用<code>spring-boot-thin-launcher</code>可以给Spring Boot应用瘦身。其原理是记录app依赖的jar包，在首次运行时先下载依赖项并缓存到本地。</p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>我们使用Spring Boot提供的<code>spring-boot-maven-plugin</code>打包Spring Boot应用，可以直接获得一个完整的可运行的jar包，把它上传到服务器上再运行就极其方便。</p>\n<p>但是这种方式也不是没有缺点。最大的缺点就是包太大了，动不动几十MB，在网速不给力的情况下，上传服务器非常耗时。并且，其中我们引用到的Tomcat、Spring和其他第三方组件，只要版本号不变，这些jar就相当于每次都重复打进去，再重复上传了一遍。</p>\n<p>真正经常改动的代码其实是我们自己编写的代码。如果只打包我们自己编写的代码，通常jar包也就几百KB。但是，运行的时候，classpath中没有依赖的jar包，肯定会报错。</p>\n<p>所以问题来了：如何只打包我们自己编写的代码，同时又自动把依赖包下载到某处，并自动引入到classpath中。解决方案就是使用<code>spring-boot-thin-launcher</code>。</p>\n<h3 id=\"使用spring-boot-thin-launcher\"><a href=\"#使用spring-boot-thin-launcher\" class=\"headerlink\" title=\"使用spring-boot-thin-launcher\"></a>使用spring-boot-thin-launcher</h3><p>我们先演示如何使用spring-boot-thin-launcher，再详细讨论它的工作原理。</p>\n<p>首先复制一份上一节的Maven项目，并重命名为<code>springboot-thin-jar</code>：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;project ...&gt;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    &lt;groupId&gt;com.itranswarp.learnjava&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;springboot-thin-jar&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class=\"line\">    ...</span><br></pre></td></tr></table></figure>\n\n<p>然后，修改<code>&lt;build&gt;</code>-<code>&lt;plugins&gt;</code>-<code>&lt;plugin&gt;</code>，给原来的<code>spring-boot-maven-plugin</code>增加一个<code>&lt;dependency&gt;</code>如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;project ...&gt;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    &lt;build&gt;</span><br><span class=\"line\">        &lt;finalName&gt;awesome-app&lt;/finalName&gt;</span><br><span class=\"line\">        &lt;plugins&gt;</span><br><span class=\"line\">            &lt;plugin&gt;</span><br><span class=\"line\">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class=\"line\">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class=\"line\">                &lt;dependencies&gt;</span><br><span class=\"line\">                    &lt;dependency&gt;</span><br><span class=\"line\">                        &lt;groupId&gt;org.springframework.boot.experimental&lt;/groupId&gt;</span><br><span class=\"line\">                        &lt;artifactId&gt;spring-boot-thin-layout&lt;/artifactId&gt;</span><br><span class=\"line\">                        &lt;version&gt;1.0.27.RELEASE&lt;/version&gt;</span><br><span class=\"line\">                    &lt;/dependency&gt;</span><br><span class=\"line\">                &lt;/dependencies&gt;</span><br><span class=\"line\">            &lt;/plugin&gt;</span><br><span class=\"line\">        &lt;/plugins&gt;</span><br><span class=\"line\">    &lt;/build&gt;</span><br><span class=\"line\">&lt;/project&gt;</span><br></pre></td></tr></table></figure>\n\n<p>不需要任何其他改动了，我们直接按正常的流程打包，执行<code>mvn clean package</code>，观察<code>target</code>目录最终生成的可执行<code>awesome-app.jar</code>，只有79KB左右。</p>\n<p>直接运行<code>java -jar awesome-app.jar</code>，效果和上一节完全一样。显然，79KB的jar肯定无法放下Tomcat和Spring这样的大块头。那么，运行时这个<code>awesome-app.jar</code>又是怎么找到它自己依赖的jar包呢？</p>\n<p>实际上<code>spring-boot-thin-launcher</code>这个插件改变了<code>spring-boot-maven-plugin</code>的默认行为。它输出的jar包只包含我们自己代码编译后的class，一个很小的<code>ThinJarWrapper</code>，以及解析<code>pom.xml</code>后得到的所有依赖jar的列表。</p>\n<p>运行的时候，入口实际上是<code>ThinJarWrapper</code>，它会先在指定目录搜索看看依赖的jar包是否都存在，如果不存在，先从Maven中央仓库下载到本地，然后，再执行我们自己编写的<code>main()</code>入口方法。这种方式有点类似很多在线安装程序：用户下载后得到的是一个很小的exe安装程序，执行安装程序时，会首先在线下载所需的若干巨大的文件，再进行真正的安装。</p>\n<p>这个<code>spring-boot-thin-launcher</code>在启动时搜索的默认目录是用户主目录的<code>.m2</code>，我们也可以指定下载目录，例如，将下载目录指定为当前目录：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ java -Dthin.root=. -jar awesome-app.jar</span><br></pre></td></tr></table></figure>\n\n<p>上述命令通过环境变量<code>thin.root</code>传入当前目录，执行后发现当前目录下自动生成了一个<code>repository</code>目录，这和Maven的默认下载目录<code>~/.m2/repository</code>的结构是完全一样的，只是它仅包含<code>awesome-app.jar</code>所需的运行期依赖项。</p>\n<p> 注意：只有首次运行时会自动下载依赖项，再次运行时由于无需下载，所以启动速度会大大加快。如果删除了repository目录，再次运行时就会再次触发下载。</p>\n<h3 id=\"预热\"><a href=\"#预热\" class=\"headerlink\" title=\"预热\"></a>预热</h3><p>把79KB大小的<code>awesome-app.jar</code>直接扔到服务器执行，上传过程就非常快。但是，第一次在服务器上运行<code>awesome-app.jar</code>时，仍需要从Maven中央仓库下载大量的jar包，所以，<code>spring-boot-thin-launcher</code>还提供了一个<code>dryrun</code>选项，专门用来下载依赖项而不执行实际代码：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -Dthin.dryrun=true -Dthin.root=. -jar awesome-app.jar</span><br></pre></td></tr></table></figure>\n\n<p>执行上述代码会在当前目录创建<code>repository</code>目录，并下载所有依赖项，但并不会运行我们编写的<code>main()</code>方法。此过程称之为“预热”（warm up）。</p>\n<p>如果服务器由于安全限制不允许从外网下载文件，那么可以在本地预热，然后把<code>awesome-app.jar</code>和<code>repository</code>目录上传到服务器。只要依赖项没有变化，后续改动只需要上传<code>awesome-app.jar</code>即可。</p>\n<h3 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h3><p>利用<code>spring-boot-thin-launcher</code>可以给Spring Boot应用瘦身。其原理是记录app依赖的jar包，在首次运行时先下载依赖项并缓存到本地。</p>\n"},{"uuid":"bbaf6f22-c0ab-11ec-92a1-7557b2313227","title":"plantuml 简介","abbrlink":"245017e5","_content":"\n\n# PlantUML 简介\n\n[PlantUML](https://links.jianshu.com/go?to=http%3A%2F%2Fplantuml.com%2F) 是一个开源项目，支持快速绘制时序图、用例图、类图、活动图、组件图、状态图、对象图、部署图等。同时还支持非 UML 图的甘特图、架构图等。例如下面等用例图：\n\n![image-20211028134337523](https://raw.githubusercontent.com/xzyup/image/master/202203191658878.png)\n\n~~~\n@startuml\nP: PENDING\nP: Pending for result\n\nN: NO_RESULT_YET\nN: Did not send the KYC check yet \n\nY: APPROVED\nY: KYC check successful\n\nR: REJECTED\nR: KYC check found the applicant's \nR: information not correct \n\nX: EXPIRED\nX: Proof of Address (POA) too old\n\n[*] --> N : Card application received\nN --> P : Submitted the KYC check\nP --> Y\nP --> R\nP --> X : Proof of Address (POA) too old\nP --> X : explicitly by KYC\nY --> [*]\nR --> [*]\nX --> [*]\n@enduml\n~~~\n\n![image-20211028134433980](https://raw.githubusercontent.com/xzyup/image/master/202203191659925.png)\n\n~~~\n@startuml\n\nskinparam rectangle {\n    BackgroundColor DarkSeaGreen\n    FontStyle Bold\n    FontColor DarkGreen\n}\n\n:User: as u\nrectangle Tool as t\nrectangle \"Knowledge Base\" as kb\n(Robot Framework) as rf\n(DUT) as dut\n\nnote as ts\n    test script\nend note\n\nnote as act\n    query\n    &\n    action\nend note\n\nnote as t_cmt\n    - 执行测试脚本\n    - 按照知识库响应消息\nend note\n\nnote as kb_cmt\n    - 根据当前消息确定响应方法\n    - 根据上下文填充消息\n    - 保存信息到相关上下文\nend note\n\nu --> rf\nrf =right=> ts\nts =down=> t\n\nkb <=left=> act\nact <=up=> t\n\nt = dut\n\nt_cmt -- t\nkb_cmt -left- kb\n@enduml\n~~~\n\n![image-20211028134522066](https://raw.githubusercontent.com/xzyup/image/master/202203191659326.png)\n\n~~~\n@startuml\ninterface Command {\n    execute()\n    undo()\n}\nclass Invoker{\n    setCommand()\n}\nclass Client\nclass Receiver{\n    action()\n}\nclass ConcreteCommand{\n    execute()\n    undo()\n}\n\nCommand <|-down- ConcreteCommand\nClient -right-> Receiver\nClient --> ConcreteCommand\nInvoker o-right-> Command\nReceiver <-left- ConcreteCommand\n@enduml\n~~~\n\n一款还算不错的绘图工具-- Plantuml, 它本质上是也算一门可以快速画图的设计语言，学习起来也很方便。可以在[http://plantuml.com/](https://links.jianshu.com/go?to=http%3A%2F%2Fplantuml.com%2F)网站上体验一下。 在vscode, webstorm都有相关的插件可以使用。\n\n# 时序图\n\n时序图相对来说是平常比较经常画的一种设计图稿，在这里记录一下plantuml中相关的语法。\n\n## 基本用法\n\n~~~\n@startuml\nA -> B: do something\nB -> A: do something\n@enduml\n~~~\n\n![image-20211028134701752](https://raw.githubusercontent.com/xzyup/image/master/202203191659299.png)\n\n## 设置不同的角色\n\n时序图角色可以分为: actor, boundary, control, entity, database，每种角色呈现的图形也是不一样的。\n\n~~~\n@startuml\nactor Foo1\nboundary Foo2\ncontrol Foo3\nentity Foo4\ndatabase Foo5\ncollections Foo6\nFoo1 -> Foo2 : To boundary\nFoo1 -> Foo3 : To control\nFoo1 -> Foo4 : To entity\nFoo1 -> Foo5 : To database\nFoo1 -> Foo6 : To collections\n\n@enduml\n~~~\n\n![image-20211028134748732](https://raw.githubusercontent.com/xzyup/image/master/202203191659968.png)\n\n## 不用的箭头样式\n\n~~~\n@startuml\nBob ->x Alice\nBob -> Alice\nBob ->> Alice\nBob -\\ Alice\nBob \\\\- Alice\nBob //-- Alice\n\nBob ->o Alice\nBob o\\\\-- Alice\n\nBob <-> Alice\nBob <->o Alice\nBob -[#red]> Alice : hello\nAlice -[#0000FF]->Bob : ok\n@enduml\n~~~\n\n![image-20211028134906473](https://raw.githubusercontent.com/xzyup/image/master/202203191659658.png)\n\n## 分页\n\n~~~\n@startuml\n\nAlice -> Bob : message 1\nAlice -> Bob : message 2\n\nnewpage\n\nAlice -> Bob : message 3\nAlice -> Bob : message 4\n\nnewpage A title for the\\nlast page\n\nAlice -> Bob : message 5\nAlice -> Bob : message 6\n@enduml\n~~~\n\n![image-20211028135036412](https://raw.githubusercontent.com/xzyup/image/master/202203191659447.png)\n\n## 分段\n\n~~~\n@startuml\n\n== Initialization ==\n\nAlice -> Bob: Authentication Request\nBob --> Alice: Authentication Response\n\n== Repetition ==\n\nAlice -> Bob: Another authentication Request\nAlice <-- Bob: another authentication Response\n\n@enduml\n~~~\n\n![image-20211028135145988](https://raw.githubusercontent.com/xzyup/image/master/202203191700518.png)\n\n## 生命线\n\n~~~\n@startuml\nparticipant User\n\nUser -> A: DoWork\nactivate A #FFBBBB\n\nA -> A: Internal call\nactivate A #DarkSalmon\n\nA -> B: << createRequest >>\nactivate B\n\nB --> A: RequestCreated\ndeactivate B\ndeactivate A\nA -> User: Done\ndeactivate A\n\n@enduml\n~~~\n\n![image-20211028135346014](https://raw.githubusercontent.com/xzyup/image/master/202203191700717.png)\n\n## 图例注脚等\n\n~~~\n@startuml\n\nheader Page Header\nfooter Page %page% of %lastpage%\n\ntitle Example Title\n\nAlice -> Bob : message 1\nnote left: this is a first note\n\nAlice -> Bob : message 2\n\n@enduml\n~~~\n\n![image-20211028135444347](https://raw.githubusercontent.com/xzyup/image/master/202203191700245.png)\n\n# C4架构图\n\nC4 model是一种软件架构图的设计方法，具体介绍可以参考[C4 architecture model](https://links.jianshu.com/go?to=https%3A%2F%2Fwww.infoq.cn%2Farticle%2FC4-architecture-model)。利用[C4-PlantUML](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FRicardoNiepel%2FC4-PlantUML)工具，可以画出很多很不错的架构图。 C4模型分为Context, Container, Component和Code 4个组成部分，我们一般在画图的时候主要用到前三个组成部分。\n\n~~~\n@startuml C4_Elements\n!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Context.puml\n!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Container.puml\n!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Component.puml\n\nSystem(systemAlias, \"System\", \"这可以看作系统上下文(Context)\")\nContainer(containerAlias, \"Container\", \"这是Container\")\nPerson(personAlias, \"Person\", \"这可以看作是组件(Component)\")\n\nRel(personAlias, containerAlias, \"Label\", \"设置关联关系\")\n@enduml\n~~~\n","source":"_posts/uml/plantuml简介.md","raw":"---\nuuid: bbaf6f22-c0ab-11ec-92a1-7557b2313227\ntitle: plantuml 简介\ncategories: Uml\ntags:\n  - plantuml\nabbrlink: '245017e5'\n---\n\n\n# PlantUML 简介\n\n[PlantUML](https://links.jianshu.com/go?to=http%3A%2F%2Fplantuml.com%2F) 是一个开源项目，支持快速绘制时序图、用例图、类图、活动图、组件图、状态图、对象图、部署图等。同时还支持非 UML 图的甘特图、架构图等。例如下面等用例图：\n\n![image-20211028134337523](https://raw.githubusercontent.com/xzyup/image/master/202203191658878.png)\n\n~~~\n@startuml\nP: PENDING\nP: Pending for result\n\nN: NO_RESULT_YET\nN: Did not send the KYC check yet \n\nY: APPROVED\nY: KYC check successful\n\nR: REJECTED\nR: KYC check found the applicant's \nR: information not correct \n\nX: EXPIRED\nX: Proof of Address (POA) too old\n\n[*] --> N : Card application received\nN --> P : Submitted the KYC check\nP --> Y\nP --> R\nP --> X : Proof of Address (POA) too old\nP --> X : explicitly by KYC\nY --> [*]\nR --> [*]\nX --> [*]\n@enduml\n~~~\n\n![image-20211028134433980](https://raw.githubusercontent.com/xzyup/image/master/202203191659925.png)\n\n~~~\n@startuml\n\nskinparam rectangle {\n    BackgroundColor DarkSeaGreen\n    FontStyle Bold\n    FontColor DarkGreen\n}\n\n:User: as u\nrectangle Tool as t\nrectangle \"Knowledge Base\" as kb\n(Robot Framework) as rf\n(DUT) as dut\n\nnote as ts\n    test script\nend note\n\nnote as act\n    query\n    &\n    action\nend note\n\nnote as t_cmt\n    - 执行测试脚本\n    - 按照知识库响应消息\nend note\n\nnote as kb_cmt\n    - 根据当前消息确定响应方法\n    - 根据上下文填充消息\n    - 保存信息到相关上下文\nend note\n\nu --> rf\nrf =right=> ts\nts =down=> t\n\nkb <=left=> act\nact <=up=> t\n\nt = dut\n\nt_cmt -- t\nkb_cmt -left- kb\n@enduml\n~~~\n\n![image-20211028134522066](https://raw.githubusercontent.com/xzyup/image/master/202203191659326.png)\n\n~~~\n@startuml\ninterface Command {\n    execute()\n    undo()\n}\nclass Invoker{\n    setCommand()\n}\nclass Client\nclass Receiver{\n    action()\n}\nclass ConcreteCommand{\n    execute()\n    undo()\n}\n\nCommand <|-down- ConcreteCommand\nClient -right-> Receiver\nClient --> ConcreteCommand\nInvoker o-right-> Command\nReceiver <-left- ConcreteCommand\n@enduml\n~~~\n\n一款还算不错的绘图工具-- Plantuml, 它本质上是也算一门可以快速画图的设计语言，学习起来也很方便。可以在[http://plantuml.com/](https://links.jianshu.com/go?to=http%3A%2F%2Fplantuml.com%2F)网站上体验一下。 在vscode, webstorm都有相关的插件可以使用。\n\n# 时序图\n\n时序图相对来说是平常比较经常画的一种设计图稿，在这里记录一下plantuml中相关的语法。\n\n## 基本用法\n\n~~~\n@startuml\nA -> B: do something\nB -> A: do something\n@enduml\n~~~\n\n![image-20211028134701752](https://raw.githubusercontent.com/xzyup/image/master/202203191659299.png)\n\n## 设置不同的角色\n\n时序图角色可以分为: actor, boundary, control, entity, database，每种角色呈现的图形也是不一样的。\n\n~~~\n@startuml\nactor Foo1\nboundary Foo2\ncontrol Foo3\nentity Foo4\ndatabase Foo5\ncollections Foo6\nFoo1 -> Foo2 : To boundary\nFoo1 -> Foo3 : To control\nFoo1 -> Foo4 : To entity\nFoo1 -> Foo5 : To database\nFoo1 -> Foo6 : To collections\n\n@enduml\n~~~\n\n![image-20211028134748732](https://raw.githubusercontent.com/xzyup/image/master/202203191659968.png)\n\n## 不用的箭头样式\n\n~~~\n@startuml\nBob ->x Alice\nBob -> Alice\nBob ->> Alice\nBob -\\ Alice\nBob \\\\- Alice\nBob //-- Alice\n\nBob ->o Alice\nBob o\\\\-- Alice\n\nBob <-> Alice\nBob <->o Alice\nBob -[#red]> Alice : hello\nAlice -[#0000FF]->Bob : ok\n@enduml\n~~~\n\n![image-20211028134906473](https://raw.githubusercontent.com/xzyup/image/master/202203191659658.png)\n\n## 分页\n\n~~~\n@startuml\n\nAlice -> Bob : message 1\nAlice -> Bob : message 2\n\nnewpage\n\nAlice -> Bob : message 3\nAlice -> Bob : message 4\n\nnewpage A title for the\\nlast page\n\nAlice -> Bob : message 5\nAlice -> Bob : message 6\n@enduml\n~~~\n\n![image-20211028135036412](https://raw.githubusercontent.com/xzyup/image/master/202203191659447.png)\n\n## 分段\n\n~~~\n@startuml\n\n== Initialization ==\n\nAlice -> Bob: Authentication Request\nBob --> Alice: Authentication Response\n\n== Repetition ==\n\nAlice -> Bob: Another authentication Request\nAlice <-- Bob: another authentication Response\n\n@enduml\n~~~\n\n![image-20211028135145988](https://raw.githubusercontent.com/xzyup/image/master/202203191700518.png)\n\n## 生命线\n\n~~~\n@startuml\nparticipant User\n\nUser -> A: DoWork\nactivate A #FFBBBB\n\nA -> A: Internal call\nactivate A #DarkSalmon\n\nA -> B: << createRequest >>\nactivate B\n\nB --> A: RequestCreated\ndeactivate B\ndeactivate A\nA -> User: Done\ndeactivate A\n\n@enduml\n~~~\n\n![image-20211028135346014](https://raw.githubusercontent.com/xzyup/image/master/202203191700717.png)\n\n## 图例注脚等\n\n~~~\n@startuml\n\nheader Page Header\nfooter Page %page% of %lastpage%\n\ntitle Example Title\n\nAlice -> Bob : message 1\nnote left: this is a first note\n\nAlice -> Bob : message 2\n\n@enduml\n~~~\n\n![image-20211028135444347](https://raw.githubusercontent.com/xzyup/image/master/202203191700245.png)\n\n# C4架构图\n\nC4 model是一种软件架构图的设计方法，具体介绍可以参考[C4 architecture model](https://links.jianshu.com/go?to=https%3A%2F%2Fwww.infoq.cn%2Farticle%2FC4-architecture-model)。利用[C4-PlantUML](https://links.jianshu.com/go?to=https%3A%2F%2Fgithub.com%2FRicardoNiepel%2FC4-PlantUML)工具，可以画出很多很不错的架构图。 C4模型分为Context, Container, Component和Code 4个组成部分，我们一般在画图的时候主要用到前三个组成部分。\n\n~~~\n@startuml C4_Elements\n!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Context.puml\n!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Container.puml\n!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Component.puml\n\nSystem(systemAlias, \"System\", \"这可以看作系统上下文(Context)\")\nContainer(containerAlias, \"Container\", \"这是Container\")\nPerson(personAlias, \"Person\", \"这可以看作是组件(Component)\")\n\nRel(personAlias, containerAlias, \"Label\", \"设置关联关系\")\n@enduml\n~~~\n","slug":"uml/plantuml简介","published":1,"date":"2022-04-20T12:41:20.804Z","updated":"2022-05-04T03:24:07.166Z","_id":"cl2qzftif005613nodsb4bnv3","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"PlantUML-简介\"><a href=\"#PlantUML-简介\" class=\"headerlink\" title=\"PlantUML 简介\"></a>PlantUML 简介</h1><p><a href=\"https://links.jianshu.com/go?to=http://plantuml.com/\">PlantUML</a> 是一个开源项目，支持快速绘制时序图、用例图、类图、活动图、组件图、状态图、对象图、部署图等。同时还支持非 UML 图的甘特图、架构图等。例如下面等用例图：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191658878.png\" alt=\"image-20211028134337523\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">P: PENDING</span><br><span class=\"line\">P: Pending for result</span><br><span class=\"line\"></span><br><span class=\"line\">N: NO_RESULT_YET</span><br><span class=\"line\">N: Did not send the KYC check yet </span><br><span class=\"line\"></span><br><span class=\"line\">Y: APPROVED</span><br><span class=\"line\">Y: KYC check successful</span><br><span class=\"line\"></span><br><span class=\"line\">R: REJECTED</span><br><span class=\"line\">R: KYC check found the applicant&#x27;s </span><br><span class=\"line\">R: information not correct </span><br><span class=\"line\"></span><br><span class=\"line\">X: EXPIRED</span><br><span class=\"line\">X: Proof of Address (POA) too old</span><br><span class=\"line\"></span><br><span class=\"line\">[*] --&gt; N : Card application received</span><br><span class=\"line\">N --&gt; P : Submitted the KYC check</span><br><span class=\"line\">P --&gt; Y</span><br><span class=\"line\">P --&gt; R</span><br><span class=\"line\">P --&gt; X : Proof of Address (POA) too old</span><br><span class=\"line\">P --&gt; X : explicitly by KYC</span><br><span class=\"line\">Y --&gt; [*]</span><br><span class=\"line\">R --&gt; [*]</span><br><span class=\"line\">X --&gt; [*]</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659925.png\" alt=\"image-20211028134433980\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"></span><br><span class=\"line\">skinparam rectangle &#123;</span><br><span class=\"line\">    BackgroundColor DarkSeaGreen</span><br><span class=\"line\">    FontStyle Bold</span><br><span class=\"line\">    FontColor DarkGreen</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">:User: as u</span><br><span class=\"line\">rectangle Tool as t</span><br><span class=\"line\">rectangle &quot;Knowledge Base&quot; as kb</span><br><span class=\"line\">(Robot Framework) as rf</span><br><span class=\"line\">(DUT) as dut</span><br><span class=\"line\"></span><br><span class=\"line\">note as ts</span><br><span class=\"line\">    test script</span><br><span class=\"line\">end note</span><br><span class=\"line\"></span><br><span class=\"line\">note as act</span><br><span class=\"line\">    query</span><br><span class=\"line\">    &amp;</span><br><span class=\"line\">    action</span><br><span class=\"line\">end note</span><br><span class=\"line\"></span><br><span class=\"line\">note as t_cmt</span><br><span class=\"line\">    - 执行测试脚本</span><br><span class=\"line\">    - 按照知识库响应消息</span><br><span class=\"line\">end note</span><br><span class=\"line\"></span><br><span class=\"line\">note as kb_cmt</span><br><span class=\"line\">    - 根据当前消息确定响应方法</span><br><span class=\"line\">    - 根据上下文填充消息</span><br><span class=\"line\">    - 保存信息到相关上下文</span><br><span class=\"line\">end note</span><br><span class=\"line\"></span><br><span class=\"line\">u --&gt; rf</span><br><span class=\"line\">rf =right=&gt; ts</span><br><span class=\"line\">ts =down=&gt; t</span><br><span class=\"line\"></span><br><span class=\"line\">kb &lt;=left=&gt; act</span><br><span class=\"line\">act &lt;=up=&gt; t</span><br><span class=\"line\"></span><br><span class=\"line\">t = dut</span><br><span class=\"line\"></span><br><span class=\"line\">t_cmt -- t</span><br><span class=\"line\">kb_cmt -left- kb</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659326.png\" alt=\"image-20211028134522066\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">interface Command &#123;</span><br><span class=\"line\">    execute()</span><br><span class=\"line\">    undo()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class Invoker&#123;</span><br><span class=\"line\">    setCommand()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class Client</span><br><span class=\"line\">class Receiver&#123;</span><br><span class=\"line\">    action()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class ConcreteCommand&#123;</span><br><span class=\"line\">    execute()</span><br><span class=\"line\">    undo()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Command &lt;|-down- ConcreteCommand</span><br><span class=\"line\">Client -right-&gt; Receiver</span><br><span class=\"line\">Client --&gt; ConcreteCommand</span><br><span class=\"line\">Invoker o-right-&gt; Command</span><br><span class=\"line\">Receiver &lt;-left- ConcreteCommand</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p>一款还算不错的绘图工具– Plantuml, 它本质上是也算一门可以快速画图的设计语言，学习起来也很方便。可以在<a href=\"https://links.jianshu.com/go?to=http://plantuml.com/\">http://plantuml.com/</a>网站上体验一下。 在vscode, webstorm都有相关的插件可以使用。</p>\n<h1 id=\"时序图\"><a href=\"#时序图\" class=\"headerlink\" title=\"时序图\"></a>时序图</h1><p>时序图相对来说是平常比较经常画的一种设计图稿，在这里记录一下plantuml中相关的语法。</p>\n<h2 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">A -&gt; B: do something</span><br><span class=\"line\">B -&gt; A: do something</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659299.png\" alt=\"image-20211028134701752\"></p>\n<h2 id=\"设置不同的角色\"><a href=\"#设置不同的角色\" class=\"headerlink\" title=\"设置不同的角色\"></a>设置不同的角色</h2><p>时序图角色可以分为: actor, boundary, control, entity, database，每种角色呈现的图形也是不一样的。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">actor Foo1</span><br><span class=\"line\">boundary Foo2</span><br><span class=\"line\">control Foo3</span><br><span class=\"line\">entity Foo4</span><br><span class=\"line\">database Foo5</span><br><span class=\"line\">collections Foo6</span><br><span class=\"line\">Foo1 -&gt; Foo2 : To boundary</span><br><span class=\"line\">Foo1 -&gt; Foo3 : To control</span><br><span class=\"line\">Foo1 -&gt; Foo4 : To entity</span><br><span class=\"line\">Foo1 -&gt; Foo5 : To database</span><br><span class=\"line\">Foo1 -&gt; Foo6 : To collections</span><br><span class=\"line\"></span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659968.png\" alt=\"image-20211028134748732\"></p>\n<h2 id=\"不用的箭头样式\"><a href=\"#不用的箭头样式\" class=\"headerlink\" title=\"不用的箭头样式\"></a>不用的箭头样式</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">Bob -&gt;x Alice</span><br><span class=\"line\">Bob -&gt; Alice</span><br><span class=\"line\">Bob -&gt;&gt; Alice</span><br><span class=\"line\">Bob -\\ Alice</span><br><span class=\"line\">Bob \\\\- Alice</span><br><span class=\"line\">Bob //-- Alice</span><br><span class=\"line\"></span><br><span class=\"line\">Bob -&gt;o Alice</span><br><span class=\"line\">Bob o\\\\-- Alice</span><br><span class=\"line\"></span><br><span class=\"line\">Bob &lt;-&gt; Alice</span><br><span class=\"line\">Bob &lt;-&gt;o Alice</span><br><span class=\"line\">Bob -[#red]&gt; Alice : hello</span><br><span class=\"line\">Alice -[#0000FF]-&gt;Bob : ok</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659658.png\" alt=\"image-20211028134906473\"></p>\n<h2 id=\"分页\"><a href=\"#分页\" class=\"headerlink\" title=\"分页\"></a>分页</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob : message 1</span><br><span class=\"line\">Alice -&gt; Bob : message 2</span><br><span class=\"line\"></span><br><span class=\"line\">newpage</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob : message 3</span><br><span class=\"line\">Alice -&gt; Bob : message 4</span><br><span class=\"line\"></span><br><span class=\"line\">newpage A title for the\\nlast page</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob : message 5</span><br><span class=\"line\">Alice -&gt; Bob : message 6</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659447.png\" alt=\"image-20211028135036412\"></p>\n<h2 id=\"分段\"><a href=\"#分段\" class=\"headerlink\" title=\"分段\"></a>分段</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"></span><br><span class=\"line\">== Initialization ==</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob: Authentication Request</span><br><span class=\"line\">Bob --&gt; Alice: Authentication Response</span><br><span class=\"line\"></span><br><span class=\"line\">== Repetition ==</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob: Another authentication Request</span><br><span class=\"line\">Alice &lt;-- Bob: another authentication Response</span><br><span class=\"line\"></span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700518.png\" alt=\"image-20211028135145988\"></p>\n<h2 id=\"生命线\"><a href=\"#生命线\" class=\"headerlink\" title=\"生命线\"></a>生命线</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">participant User</span><br><span class=\"line\"></span><br><span class=\"line\">User -&gt; A: DoWork</span><br><span class=\"line\">activate A #FFBBBB</span><br><span class=\"line\"></span><br><span class=\"line\">A -&gt; A: Internal call</span><br><span class=\"line\">activate A #DarkSalmon</span><br><span class=\"line\"></span><br><span class=\"line\">A -&gt; B: &lt;&lt; createRequest &gt;&gt;</span><br><span class=\"line\">activate B</span><br><span class=\"line\"></span><br><span class=\"line\">B --&gt; A: RequestCreated</span><br><span class=\"line\">deactivate B</span><br><span class=\"line\">deactivate A</span><br><span class=\"line\">A -&gt; User: Done</span><br><span class=\"line\">deactivate A</span><br><span class=\"line\"></span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700717.png\" alt=\"image-20211028135346014\"></p>\n<h2 id=\"图例注脚等\"><a href=\"#图例注脚等\" class=\"headerlink\" title=\"图例注脚等\"></a>图例注脚等</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"></span><br><span class=\"line\">header Page Header</span><br><span class=\"line\">footer Page %page% of %lastpage%</span><br><span class=\"line\"></span><br><span class=\"line\">title Example Title</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob : message 1</span><br><span class=\"line\">note left: this is a first note</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob : message 2</span><br><span class=\"line\"></span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700245.png\" alt=\"image-20211028135444347\"></p>\n<h1 id=\"C4架构图\"><a href=\"#C4架构图\" class=\"headerlink\" title=\"C4架构图\"></a>C4架构图</h1><p>C4 model是一种软件架构图的设计方法，具体介绍可以参考<a href=\"https://links.jianshu.com/go?to=https://www.infoq.cn/article/C4-architecture-model\">C4 architecture model</a>。利用<a href=\"https://links.jianshu.com/go?to=https://github.com/RicardoNiepel/C4-PlantUML\">C4-PlantUML</a>工具，可以画出很多很不错的架构图。 C4模型分为Context, Container, Component和Code 4个组成部分，我们一般在画图的时候主要用到前三个组成部分。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml C4_Elements</span><br><span class=\"line\">!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Context.puml</span><br><span class=\"line\">!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Container.puml</span><br><span class=\"line\">!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Component.puml</span><br><span class=\"line\"></span><br><span class=\"line\">System(systemAlias, &quot;System&quot;, &quot;这可以看作系统上下文(Context)&quot;)</span><br><span class=\"line\">Container(containerAlias, &quot;Container&quot;, &quot;这是Container&quot;)</span><br><span class=\"line\">Person(personAlias, &quot;Person&quot;, &quot;这可以看作是组件(Component)&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">Rel(personAlias, containerAlias, &quot;Label&quot;, &quot;设置关联关系&quot;)</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"PlantUML-简介\"><a href=\"#PlantUML-简介\" class=\"headerlink\" title=\"PlantUML 简介\"></a>PlantUML 简介</h1><p><a href=\"https://links.jianshu.com/go?to=http://plantuml.com/\">PlantUML</a> 是一个开源项目，支持快速绘制时序图、用例图、类图、活动图、组件图、状态图、对象图、部署图等。同时还支持非 UML 图的甘特图、架构图等。例如下面等用例图：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191658878.png\" alt=\"image-20211028134337523\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">P: PENDING</span><br><span class=\"line\">P: Pending for result</span><br><span class=\"line\"></span><br><span class=\"line\">N: NO_RESULT_YET</span><br><span class=\"line\">N: Did not send the KYC check yet </span><br><span class=\"line\"></span><br><span class=\"line\">Y: APPROVED</span><br><span class=\"line\">Y: KYC check successful</span><br><span class=\"line\"></span><br><span class=\"line\">R: REJECTED</span><br><span class=\"line\">R: KYC check found the applicant&#x27;s </span><br><span class=\"line\">R: information not correct </span><br><span class=\"line\"></span><br><span class=\"line\">X: EXPIRED</span><br><span class=\"line\">X: Proof of Address (POA) too old</span><br><span class=\"line\"></span><br><span class=\"line\">[*] --&gt; N : Card application received</span><br><span class=\"line\">N --&gt; P : Submitted the KYC check</span><br><span class=\"line\">P --&gt; Y</span><br><span class=\"line\">P --&gt; R</span><br><span class=\"line\">P --&gt; X : Proof of Address (POA) too old</span><br><span class=\"line\">P --&gt; X : explicitly by KYC</span><br><span class=\"line\">Y --&gt; [*]</span><br><span class=\"line\">R --&gt; [*]</span><br><span class=\"line\">X --&gt; [*]</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659925.png\" alt=\"image-20211028134433980\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"></span><br><span class=\"line\">skinparam rectangle &#123;</span><br><span class=\"line\">    BackgroundColor DarkSeaGreen</span><br><span class=\"line\">    FontStyle Bold</span><br><span class=\"line\">    FontColor DarkGreen</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">:User: as u</span><br><span class=\"line\">rectangle Tool as t</span><br><span class=\"line\">rectangle &quot;Knowledge Base&quot; as kb</span><br><span class=\"line\">(Robot Framework) as rf</span><br><span class=\"line\">(DUT) as dut</span><br><span class=\"line\"></span><br><span class=\"line\">note as ts</span><br><span class=\"line\">    test script</span><br><span class=\"line\">end note</span><br><span class=\"line\"></span><br><span class=\"line\">note as act</span><br><span class=\"line\">    query</span><br><span class=\"line\">    &amp;</span><br><span class=\"line\">    action</span><br><span class=\"line\">end note</span><br><span class=\"line\"></span><br><span class=\"line\">note as t_cmt</span><br><span class=\"line\">    - 执行测试脚本</span><br><span class=\"line\">    - 按照知识库响应消息</span><br><span class=\"line\">end note</span><br><span class=\"line\"></span><br><span class=\"line\">note as kb_cmt</span><br><span class=\"line\">    - 根据当前消息确定响应方法</span><br><span class=\"line\">    - 根据上下文填充消息</span><br><span class=\"line\">    - 保存信息到相关上下文</span><br><span class=\"line\">end note</span><br><span class=\"line\"></span><br><span class=\"line\">u --&gt; rf</span><br><span class=\"line\">rf =right=&gt; ts</span><br><span class=\"line\">ts =down=&gt; t</span><br><span class=\"line\"></span><br><span class=\"line\">kb &lt;=left=&gt; act</span><br><span class=\"line\">act &lt;=up=&gt; t</span><br><span class=\"line\"></span><br><span class=\"line\">t = dut</span><br><span class=\"line\"></span><br><span class=\"line\">t_cmt -- t</span><br><span class=\"line\">kb_cmt -left- kb</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659326.png\" alt=\"image-20211028134522066\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">interface Command &#123;</span><br><span class=\"line\">    execute()</span><br><span class=\"line\">    undo()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class Invoker&#123;</span><br><span class=\"line\">    setCommand()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class Client</span><br><span class=\"line\">class Receiver&#123;</span><br><span class=\"line\">    action()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class ConcreteCommand&#123;</span><br><span class=\"line\">    execute()</span><br><span class=\"line\">    undo()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Command &lt;|-down- ConcreteCommand</span><br><span class=\"line\">Client -right-&gt; Receiver</span><br><span class=\"line\">Client --&gt; ConcreteCommand</span><br><span class=\"line\">Invoker o-right-&gt; Command</span><br><span class=\"line\">Receiver &lt;-left- ConcreteCommand</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p>一款还算不错的绘图工具– Plantuml, 它本质上是也算一门可以快速画图的设计语言，学习起来也很方便。可以在<a href=\"https://links.jianshu.com/go?to=http://plantuml.com/\">http://plantuml.com/</a>网站上体验一下。 在vscode, webstorm都有相关的插件可以使用。</p>\n<h1 id=\"时序图\"><a href=\"#时序图\" class=\"headerlink\" title=\"时序图\"></a>时序图</h1><p>时序图相对来说是平常比较经常画的一种设计图稿，在这里记录一下plantuml中相关的语法。</p>\n<h2 id=\"基本用法\"><a href=\"#基本用法\" class=\"headerlink\" title=\"基本用法\"></a>基本用法</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">A -&gt; B: do something</span><br><span class=\"line\">B -&gt; A: do something</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659299.png\" alt=\"image-20211028134701752\"></p>\n<h2 id=\"设置不同的角色\"><a href=\"#设置不同的角色\" class=\"headerlink\" title=\"设置不同的角色\"></a>设置不同的角色</h2><p>时序图角色可以分为: actor, boundary, control, entity, database，每种角色呈现的图形也是不一样的。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">actor Foo1</span><br><span class=\"line\">boundary Foo2</span><br><span class=\"line\">control Foo3</span><br><span class=\"line\">entity Foo4</span><br><span class=\"line\">database Foo5</span><br><span class=\"line\">collections Foo6</span><br><span class=\"line\">Foo1 -&gt; Foo2 : To boundary</span><br><span class=\"line\">Foo1 -&gt; Foo3 : To control</span><br><span class=\"line\">Foo1 -&gt; Foo4 : To entity</span><br><span class=\"line\">Foo1 -&gt; Foo5 : To database</span><br><span class=\"line\">Foo1 -&gt; Foo6 : To collections</span><br><span class=\"line\"></span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659968.png\" alt=\"image-20211028134748732\"></p>\n<h2 id=\"不用的箭头样式\"><a href=\"#不用的箭头样式\" class=\"headerlink\" title=\"不用的箭头样式\"></a>不用的箭头样式</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">Bob -&gt;x Alice</span><br><span class=\"line\">Bob -&gt; Alice</span><br><span class=\"line\">Bob -&gt;&gt; Alice</span><br><span class=\"line\">Bob -\\ Alice</span><br><span class=\"line\">Bob \\\\- Alice</span><br><span class=\"line\">Bob //-- Alice</span><br><span class=\"line\"></span><br><span class=\"line\">Bob -&gt;o Alice</span><br><span class=\"line\">Bob o\\\\-- Alice</span><br><span class=\"line\"></span><br><span class=\"line\">Bob &lt;-&gt; Alice</span><br><span class=\"line\">Bob &lt;-&gt;o Alice</span><br><span class=\"line\">Bob -[#red]&gt; Alice : hello</span><br><span class=\"line\">Alice -[#0000FF]-&gt;Bob : ok</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659658.png\" alt=\"image-20211028134906473\"></p>\n<h2 id=\"分页\"><a href=\"#分页\" class=\"headerlink\" title=\"分页\"></a>分页</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob : message 1</span><br><span class=\"line\">Alice -&gt; Bob : message 2</span><br><span class=\"line\"></span><br><span class=\"line\">newpage</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob : message 3</span><br><span class=\"line\">Alice -&gt; Bob : message 4</span><br><span class=\"line\"></span><br><span class=\"line\">newpage A title for the\\nlast page</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob : message 5</span><br><span class=\"line\">Alice -&gt; Bob : message 6</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191659447.png\" alt=\"image-20211028135036412\"></p>\n<h2 id=\"分段\"><a href=\"#分段\" class=\"headerlink\" title=\"分段\"></a>分段</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"></span><br><span class=\"line\">== Initialization ==</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob: Authentication Request</span><br><span class=\"line\">Bob --&gt; Alice: Authentication Response</span><br><span class=\"line\"></span><br><span class=\"line\">== Repetition ==</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob: Another authentication Request</span><br><span class=\"line\">Alice &lt;-- Bob: another authentication Response</span><br><span class=\"line\"></span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700518.png\" alt=\"image-20211028135145988\"></p>\n<h2 id=\"生命线\"><a href=\"#生命线\" class=\"headerlink\" title=\"生命线\"></a>生命线</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\">participant User</span><br><span class=\"line\"></span><br><span class=\"line\">User -&gt; A: DoWork</span><br><span class=\"line\">activate A #FFBBBB</span><br><span class=\"line\"></span><br><span class=\"line\">A -&gt; A: Internal call</span><br><span class=\"line\">activate A #DarkSalmon</span><br><span class=\"line\"></span><br><span class=\"line\">A -&gt; B: &lt;&lt; createRequest &gt;&gt;</span><br><span class=\"line\">activate B</span><br><span class=\"line\"></span><br><span class=\"line\">B --&gt; A: RequestCreated</span><br><span class=\"line\">deactivate B</span><br><span class=\"line\">deactivate A</span><br><span class=\"line\">A -&gt; User: Done</span><br><span class=\"line\">deactivate A</span><br><span class=\"line\"></span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700717.png\" alt=\"image-20211028135346014\"></p>\n<h2 id=\"图例注脚等\"><a href=\"#图例注脚等\" class=\"headerlink\" title=\"图例注脚等\"></a>图例注脚等</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml</span><br><span class=\"line\"></span><br><span class=\"line\">header Page Header</span><br><span class=\"line\">footer Page %page% of %lastpage%</span><br><span class=\"line\"></span><br><span class=\"line\">title Example Title</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob : message 1</span><br><span class=\"line\">note left: this is a first note</span><br><span class=\"line\"></span><br><span class=\"line\">Alice -&gt; Bob : message 2</span><br><span class=\"line\"></span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700245.png\" alt=\"image-20211028135444347\"></p>\n<h1 id=\"C4架构图\"><a href=\"#C4架构图\" class=\"headerlink\" title=\"C4架构图\"></a>C4架构图</h1><p>C4 model是一种软件架构图的设计方法，具体介绍可以参考<a href=\"https://links.jianshu.com/go?to=https://www.infoq.cn/article/C4-architecture-model\">C4 architecture model</a>。利用<a href=\"https://links.jianshu.com/go?to=https://github.com/RicardoNiepel/C4-PlantUML\">C4-PlantUML</a>工具，可以画出很多很不错的架构图。 C4模型分为Context, Container, Component和Code 4个组成部分，我们一般在画图的时候主要用到前三个组成部分。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startuml C4_Elements</span><br><span class=\"line\">!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Context.puml</span><br><span class=\"line\">!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Container.puml</span><br><span class=\"line\">!includeurl https://raw.githubusercontent.com/RicardoNiepel/C4-PlantUML/master/C4_Component.puml</span><br><span class=\"line\"></span><br><span class=\"line\">System(systemAlias, &quot;System&quot;, &quot;这可以看作系统上下文(Context)&quot;)</span><br><span class=\"line\">Container(containerAlias, &quot;Container&quot;, &quot;这是Container&quot;)</span><br><span class=\"line\">Person(personAlias, &quot;Person&quot;, &quot;这可以看作是组件(Component)&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">Rel(personAlias, containerAlias, &quot;Label&quot;, &quot;设置关联关系&quot;)</span><br><span class=\"line\">@enduml</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf6f23-c0ab-11ec-92a1-7557b2313227","title":"Guava Bimap","abbrlink":"872f7cc2","_content":"\n# Guava Bimap接口\n\nBiMap是一种特殊的映射其保持映射，同时确保没有重复的值是存在于该映射和一个值可以安全地用于获取键背面的倒数映射。\n\n## 接口声明\n\n以下是com.google.common.collect.Bimap<K，V>接口的声明：\n\n```java\n@GwtCompatible\npublic interface BiMap<K,V> extends Map<K,V>\n```\n\n## 接口方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **V forcePut(K key, V value)**  另一种put的形式是默默删除，在put(K, V)运行前的任何现有条目值值。 |\n| 2    | **BiMap<V,K> inverse()**  返回此bimap，每一个bimap的值映射到其相关联的键的逆视图。 |\n| 3    | **V put(K key, V value)**  关联指定值与此映射中(可选操作)指定的键。 |\n| 4    | **void putAll(Map<? extends K,? extends V> map)**  将所有从指定映射此映射(可选操作)的映射。 |\n| 5    | **Set<V> values()**  返回此映射中包含Collection的值视图。    |\n\n## 继承的方法\n\n这个类继承自以下接口方法：\n\n- java.util.Map\n\n## BiMap 示例\n\n使用所选择的编辑器创建下面的java程序，比如说 **C:/> Guava**\n\n*GuavaTester.java*\n\n```java\nimport com.google.common.collect.BiMap;\nimport com.google.common.collect.HashBiMap;\n\npublic class GuavaTester {\n\n   public static void main(String args[]){\n      BiMap<Integer, String> empIDNameMap = HashBiMap.create();\n\n      empIDNameMap.put(new Integer(101), \"Mahesh\");\n      empIDNameMap.put(new Integer(102), \"Sohan\");\n      empIDNameMap.put(new Integer(103), \"Ramesh\");\n\n      //Emp Id of Employee \"Mahesh\"\n      System.out.println(empIDNameMap.inverse().get(\"Mahesh\"));\n   }\t\n}\n```\n","source":"_posts/guava/collections/Bimap.md","raw":"---\nuuid: bbaf6f23-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Bimap\ntags:\n  - guava\ncategories: Java\nabbrlink: 872f7cc2\n---\n\n# Guava Bimap接口\n\nBiMap是一种特殊的映射其保持映射，同时确保没有重复的值是存在于该映射和一个值可以安全地用于获取键背面的倒数映射。\n\n## 接口声明\n\n以下是com.google.common.collect.Bimap<K，V>接口的声明：\n\n```java\n@GwtCompatible\npublic interface BiMap<K,V> extends Map<K,V>\n```\n\n## 接口方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **V forcePut(K key, V value)**  另一种put的形式是默默删除，在put(K, V)运行前的任何现有条目值值。 |\n| 2    | **BiMap<V,K> inverse()**  返回此bimap，每一个bimap的值映射到其相关联的键的逆视图。 |\n| 3    | **V put(K key, V value)**  关联指定值与此映射中(可选操作)指定的键。 |\n| 4    | **void putAll(Map<? extends K,? extends V> map)**  将所有从指定映射此映射(可选操作)的映射。 |\n| 5    | **Set<V> values()**  返回此映射中包含Collection的值视图。    |\n\n## 继承的方法\n\n这个类继承自以下接口方法：\n\n- java.util.Map\n\n## BiMap 示例\n\n使用所选择的编辑器创建下面的java程序，比如说 **C:/> Guava**\n\n*GuavaTester.java*\n\n```java\nimport com.google.common.collect.BiMap;\nimport com.google.common.collect.HashBiMap;\n\npublic class GuavaTester {\n\n   public static void main(String args[]){\n      BiMap<Integer, String> empIDNameMap = HashBiMap.create();\n\n      empIDNameMap.put(new Integer(101), \"Mahesh\");\n      empIDNameMap.put(new Integer(102), \"Sohan\");\n      empIDNameMap.put(new Integer(103), \"Ramesh\");\n\n      //Emp Id of Employee \"Mahesh\"\n      System.out.println(empIDNameMap.inverse().get(\"Mahesh\"));\n   }\t\n}\n```\n","slug":"guava/collections/Bimap","published":1,"date":"2022-04-20T12:41:20.847Z","updated":"2022-05-04T03:03:58.438Z","_id":"cl2qzftig005a13no6noag53u","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Guava-Bimap接口\"><a href=\"#Guava-Bimap接口\" class=\"headerlink\" title=\"Guava Bimap接口\"></a>Guava Bimap接口</h1><p>BiMap是一种特殊的映射其保持映射，同时确保没有重复的值是存在于该映射和一个值可以安全地用于获取键背面的倒数映射。</p>\n<h2 id=\"接口声明\"><a href=\"#接口声明\" class=\"headerlink\" title=\"接口声明\"></a>接口声明</h2><p>以下是com.google.common.collect.Bimap&lt;K，V&gt;接口的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">BiMap</span>&lt;K,V&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Map</span>&lt;K,V&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"接口方法\"><a href=\"#接口方法\" class=\"headerlink\" title=\"接口方法\"></a>接口方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>V forcePut(K key, V value)</strong>  另一种put的形式是默默删除，在put(K, V)运行前的任何现有条目值值。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>BiMap&lt;V,K&gt; inverse()</strong>  返回此bimap，每一个bimap的值映射到其相关联的键的逆视图。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>V put(K key, V value)</strong>  关联指定值与此映射中(可选操作)指定的键。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>void putAll(Map&lt;? extends K,? extends V&gt; map)</strong>  将所有从指定映射此映射(可选操作)的映射。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>Set<V> values()</strong>  返回此映射中包含Collection的值视图。</td>\n</tr>\n</tbody></table>\n<h2 id=\"继承的方法\"><a href=\"#继承的方法\" class=\"headerlink\" title=\"继承的方法\"></a>继承的方法</h2><p>这个类继承自以下接口方法：</p>\n<ul>\n<li>java.util.Map</li>\n</ul>\n<h2 id=\"BiMap-示例\"><a href=\"#BiMap-示例\" class=\"headerlink\" title=\"BiMap 示例\"></a>BiMap 示例</h2><p>使用所选择的编辑器创建下面的java程序，比如说 <strong>C:/&gt; Guava</strong></p>\n<p><em>GuavaTester.java</em></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.BiMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.HashBiMap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      BiMap&lt;Integer, String&gt; empIDNameMap = HashBiMap.create();</span><br><span class=\"line\"></span><br><span class=\"line\">      empIDNameMap.put(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">101</span>), <span class=\"string\">&quot;Mahesh&quot;</span>);</span><br><span class=\"line\">      empIDNameMap.put(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">102</span>), <span class=\"string\">&quot;Sohan&quot;</span>);</span><br><span class=\"line\">      empIDNameMap.put(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">103</span>), <span class=\"string\">&quot;Ramesh&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//Emp Id of Employee &quot;Mahesh&quot;</span></span><br><span class=\"line\">      System.out.println(empIDNameMap.inverse().get(<span class=\"string\">&quot;Mahesh&quot;</span>));</span><br><span class=\"line\">   &#125;\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Guava-Bimap接口\"><a href=\"#Guava-Bimap接口\" class=\"headerlink\" title=\"Guava Bimap接口\"></a>Guava Bimap接口</h1><p>BiMap是一种特殊的映射其保持映射，同时确保没有重复的值是存在于该映射和一个值可以安全地用于获取键背面的倒数映射。</p>\n<h2 id=\"接口声明\"><a href=\"#接口声明\" class=\"headerlink\" title=\"接口声明\"></a>接口声明</h2><p>以下是com.google.common.collect.Bimap&lt;K，V&gt;接口的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">BiMap</span>&lt;K,V&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Map</span>&lt;K,V&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"接口方法\"><a href=\"#接口方法\" class=\"headerlink\" title=\"接口方法\"></a>接口方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>V forcePut(K key, V value)</strong>  另一种put的形式是默默删除，在put(K, V)运行前的任何现有条目值值。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>BiMap&lt;V,K&gt; inverse()</strong>  返回此bimap，每一个bimap的值映射到其相关联的键的逆视图。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>V put(K key, V value)</strong>  关联指定值与此映射中(可选操作)指定的键。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>void putAll(Map&lt;? extends K,? extends V&gt; map)</strong>  将所有从指定映射此映射(可选操作)的映射。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>Set<V> values()</strong>  返回此映射中包含Collection的值视图。</td>\n</tr>\n</tbody></table>\n<h2 id=\"继承的方法\"><a href=\"#继承的方法\" class=\"headerlink\" title=\"继承的方法\"></a>继承的方法</h2><p>这个类继承自以下接口方法：</p>\n<ul>\n<li>java.util.Map</li>\n</ul>\n<h2 id=\"BiMap-示例\"><a href=\"#BiMap-示例\" class=\"headerlink\" title=\"BiMap 示例\"></a>BiMap 示例</h2><p>使用所选择的编辑器创建下面的java程序，比如说 <strong>C:/&gt; Guava</strong></p>\n<p><em>GuavaTester.java</em></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.BiMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.HashBiMap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      BiMap&lt;Integer, String&gt; empIDNameMap = HashBiMap.create();</span><br><span class=\"line\"></span><br><span class=\"line\">      empIDNameMap.put(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">101</span>), <span class=\"string\">&quot;Mahesh&quot;</span>);</span><br><span class=\"line\">      empIDNameMap.put(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">102</span>), <span class=\"string\">&quot;Sohan&quot;</span>);</span><br><span class=\"line\">      empIDNameMap.put(<span class=\"keyword\">new</span> <span class=\"title class_\">Integer</span>(<span class=\"number\">103</span>), <span class=\"string\">&quot;Ramesh&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//Emp Id of Employee &quot;Mahesh&quot;</span></span><br><span class=\"line\">      System.out.println(empIDNameMap.inverse().get(<span class=\"string\">&quot;Mahesh&quot;</span>));</span><br><span class=\"line\">   &#125;\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf6f24-c0ab-11ec-92a1-7557b2313227","title":"Guava Multimap","abbrlink":"1eced4e5","_content":"\n#  Guava Multimap类\n\n多重映射接口扩展映射，使得其键一次可被映射到多个值。\n\n## 接口声明\n\n以下是com.google.common.collect.Multimap<K，V>接口的声明：\n\n```java\n@GwtCompatible\npublic interface Multimap<K,V>\n```\n\n## 接口方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **Map<K,Collection<V>> asMap()**  返回此multimap中的视图，从每个不同的键在键的关联值的非空集合映射。 |\n| 2    | **void clear()**  \t将删除所有multimap中的键值对，留下空。 |\n| 3    | **boolean containsEntry(Object key, Object value)**  \t返回true如果此多重映射包含至少一个键 - 值对用键键和值value。 |\n| 4    | **boolean containsKey(Object key)**  返回true，如果这个multimap中至少包含一个键值对的键key。 |\n| 5    | **boolean containsValue(Object value)**  \t返回true，如果这个multimap至少包含一个键值对的值值。 |\n| 6    | **Collection<Map.Entry<K,V>> entries()**  返回包含在此multimap中，为Map.Entry的情况下，所有的键 - 值对的视图集合。 |\n| 7    | **boolean equals(Object obj)**  比较指定对象与此多重映射是否相等。 |\n| 8    | **Collection<V> get(K key)**  返回，如果有的话，在这个multimap中键关联的值的视图集合。 |\n| 9    | **int hashCode()**  \t返回此多重映射的哈希码。             |\n| 10   | **boolean isEmpty()**  \t返回true，如果这个multimap中未包含键 - 值对。 |\n| 11   | **Multiset<K> keys()**  返回一个视图集合包含从每个键值对这个multimap中的关键，没有折叠重复。 |\n| 12   | **Set<K> keySet()**  \tReturns a view collection of all distinct keys contained in this multimap. |\n| 13   | **boolean put(K key, V value)**  \t存储键 - 值对在这个multimap中。 |\n| 14   | **boolean putAll(K key, Iterable<? extends V> values)**  \t\t\t存储一个键 - 值对在此multimap中的每个值，都使用相同的键 key。 |\n| 15   | **boolean putAll(Multimap<? extends K,? extends V> multimap)**  \t\t\t存储了所有键 - 值对多重映射在这个multimap中，通过返回 multimap.entries() 的顺序. |\n| 16   | **boolean remove(Object key, Object value)**  \t删除一个键 - 值对用键键，并从该多重映射的值的值，如果这样的存在。 |\n| 17   | **Collection<V> removeAll(Object key)**  \t删除与键键关联的所有值。 |\n| 18   | **Collection<V> replaceValues(K key, Iterable<? extends V> values)**  \t\t\t存储与相同的键值，替换任何现有值的键的集合。 |\n| 19   | int size() 返回此多重映射键 - 值对的数量。                   |\n| 20   | **Collection<V> values()**  \t返回一个视图集合包含从包含在该multimap中的每个键 - 值对的值，而不发生重复 (so values().size() == size()). |\n\n## Multimap 示例\n\n使用所选择的任何编辑器创建下面的java程序 **C:/> Guava**\n\n*GuavaTester.java*\n\n```java\nimport java.util.Collection;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\n\nimport com.google.common.collect.ArrayListMultimap;\nimport com.google.common.collect.Multimap;\n\npublic class GuavaTester {\n   public static void main(String args[]){\n      GuavaTester tester = new GuavaTester();\n      Multimap<String,String> multimap = tester.getMultimap();\n\n      List<String> lowerList = (List<String>)multimap.get(\"lower\");\n      System.out.println(\"Initial lower case list\");\n      System.out.println(lowerList.toString());\n      lowerList.add(\"f\");\n      System.out.println(\"Modified lower case list\");\n      System.out.println(lowerList.toString());\n\n      List<String> upperList = (List<String>)multimap.get(\"upper\");\n      System.out.println(\"Initial upper case list\");\n      System.out.println(upperList.toString());\n      upperList.remove(\"D\");\n      System.out.println(\"Modified upper case list\");\n      System.out.println(upperList.toString());\n\n      Map<String, Collection<String>> map = multimap.asMap();\n      System.out.println(\"Multimap as a map\");\n      for (Map.Entry<String,  Collection<String>> entry : map.entrySet()) {\n         String key = entry.getKey();\n         Collection<String> value =  multimap.get(\"lower\");\n         System.out.println(key + \":\" + value);\n      }\n\n      System.out.println(\"Keys of Multimap\");\n      Set<String> keys =  multimap.keySet();\n      for(String key:keys){\n         System.out.println(key);\n      }\n\n      System.out.println(\"Values of Multimap\");\n      Collection<String> values = multimap.values();\n      System.out.println(values);\n   }\t\n\n   private Multimap<String,String> getMultimap(){\n      //Map<String, List<String>>\n      // lower -> a, b, c, d, e \n      // upper -> A, B, C, D\n\n      Multimap<String,String> multimap = ArrayListMultimap.create();\t\t\n\n      multimap.put(\"lower\", \"a\");\n      multimap.put(\"lower\", \"b\");\n      multimap.put(\"lower\", \"c\");\n      multimap.put(\"lower\", \"d\");\n      multimap.put(\"lower\", \"e\");\n\n      multimap.put(\"upper\", \"A\");\n      multimap.put(\"upper\", \"B\");\n      multimap.put(\"upper\", \"C\");\n      multimap.put(\"upper\", \"D\");\t\t\n      return multimap;\t\t\n   }\n}\n```\n","source":"_posts/guava/collections/Multimap.md","raw":"---\nuuid: bbaf6f24-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Multimap\ncategories: Java\ntags:\n  - guava\nabbrlink: 1eced4e5\n---\n\n#  Guava Multimap类\n\n多重映射接口扩展映射，使得其键一次可被映射到多个值。\n\n## 接口声明\n\n以下是com.google.common.collect.Multimap<K，V>接口的声明：\n\n```java\n@GwtCompatible\npublic interface Multimap<K,V>\n```\n\n## 接口方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **Map<K,Collection<V>> asMap()**  返回此multimap中的视图，从每个不同的键在键的关联值的非空集合映射。 |\n| 2    | **void clear()**  \t将删除所有multimap中的键值对，留下空。 |\n| 3    | **boolean containsEntry(Object key, Object value)**  \t返回true如果此多重映射包含至少一个键 - 值对用键键和值value。 |\n| 4    | **boolean containsKey(Object key)**  返回true，如果这个multimap中至少包含一个键值对的键key。 |\n| 5    | **boolean containsValue(Object value)**  \t返回true，如果这个multimap至少包含一个键值对的值值。 |\n| 6    | **Collection<Map.Entry<K,V>> entries()**  返回包含在此multimap中，为Map.Entry的情况下，所有的键 - 值对的视图集合。 |\n| 7    | **boolean equals(Object obj)**  比较指定对象与此多重映射是否相等。 |\n| 8    | **Collection<V> get(K key)**  返回，如果有的话，在这个multimap中键关联的值的视图集合。 |\n| 9    | **int hashCode()**  \t返回此多重映射的哈希码。             |\n| 10   | **boolean isEmpty()**  \t返回true，如果这个multimap中未包含键 - 值对。 |\n| 11   | **Multiset<K> keys()**  返回一个视图集合包含从每个键值对这个multimap中的关键，没有折叠重复。 |\n| 12   | **Set<K> keySet()**  \tReturns a view collection of all distinct keys contained in this multimap. |\n| 13   | **boolean put(K key, V value)**  \t存储键 - 值对在这个multimap中。 |\n| 14   | **boolean putAll(K key, Iterable<? extends V> values)**  \t\t\t存储一个键 - 值对在此multimap中的每个值，都使用相同的键 key。 |\n| 15   | **boolean putAll(Multimap<? extends K,? extends V> multimap)**  \t\t\t存储了所有键 - 值对多重映射在这个multimap中，通过返回 multimap.entries() 的顺序. |\n| 16   | **boolean remove(Object key, Object value)**  \t删除一个键 - 值对用键键，并从该多重映射的值的值，如果这样的存在。 |\n| 17   | **Collection<V> removeAll(Object key)**  \t删除与键键关联的所有值。 |\n| 18   | **Collection<V> replaceValues(K key, Iterable<? extends V> values)**  \t\t\t存储与相同的键值，替换任何现有值的键的集合。 |\n| 19   | int size() 返回此多重映射键 - 值对的数量。                   |\n| 20   | **Collection<V> values()**  \t返回一个视图集合包含从包含在该multimap中的每个键 - 值对的值，而不发生重复 (so values().size() == size()). |\n\n## Multimap 示例\n\n使用所选择的任何编辑器创建下面的java程序 **C:/> Guava**\n\n*GuavaTester.java*\n\n```java\nimport java.util.Collection;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Set;\n\nimport com.google.common.collect.ArrayListMultimap;\nimport com.google.common.collect.Multimap;\n\npublic class GuavaTester {\n   public static void main(String args[]){\n      GuavaTester tester = new GuavaTester();\n      Multimap<String,String> multimap = tester.getMultimap();\n\n      List<String> lowerList = (List<String>)multimap.get(\"lower\");\n      System.out.println(\"Initial lower case list\");\n      System.out.println(lowerList.toString());\n      lowerList.add(\"f\");\n      System.out.println(\"Modified lower case list\");\n      System.out.println(lowerList.toString());\n\n      List<String> upperList = (List<String>)multimap.get(\"upper\");\n      System.out.println(\"Initial upper case list\");\n      System.out.println(upperList.toString());\n      upperList.remove(\"D\");\n      System.out.println(\"Modified upper case list\");\n      System.out.println(upperList.toString());\n\n      Map<String, Collection<String>> map = multimap.asMap();\n      System.out.println(\"Multimap as a map\");\n      for (Map.Entry<String,  Collection<String>> entry : map.entrySet()) {\n         String key = entry.getKey();\n         Collection<String> value =  multimap.get(\"lower\");\n         System.out.println(key + \":\" + value);\n      }\n\n      System.out.println(\"Keys of Multimap\");\n      Set<String> keys =  multimap.keySet();\n      for(String key:keys){\n         System.out.println(key);\n      }\n\n      System.out.println(\"Values of Multimap\");\n      Collection<String> values = multimap.values();\n      System.out.println(values);\n   }\t\n\n   private Multimap<String,String> getMultimap(){\n      //Map<String, List<String>>\n      // lower -> a, b, c, d, e \n      // upper -> A, B, C, D\n\n      Multimap<String,String> multimap = ArrayListMultimap.create();\t\t\n\n      multimap.put(\"lower\", \"a\");\n      multimap.put(\"lower\", \"b\");\n      multimap.put(\"lower\", \"c\");\n      multimap.put(\"lower\", \"d\");\n      multimap.put(\"lower\", \"e\");\n\n      multimap.put(\"upper\", \"A\");\n      multimap.put(\"upper\", \"B\");\n      multimap.put(\"upper\", \"C\");\n      multimap.put(\"upper\", \"D\");\t\t\n      return multimap;\t\t\n   }\n}\n```\n","slug":"guava/collections/Multimap","published":1,"date":"2022-04-20T12:41:20.851Z","updated":"2022-05-04T03:04:08.425Z","_id":"cl2qzftih005d13noa95kfk19","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Guava-Multimap类\"><a href=\"#Guava-Multimap类\" class=\"headerlink\" title=\"Guava Multimap类\"></a>Guava Multimap类</h1><p>多重映射接口扩展映射，使得其键一次可被映射到多个值。</p>\n<h2 id=\"接口声明\"><a href=\"#接口声明\" class=\"headerlink\" title=\"接口声明\"></a>接口声明</h2><p>以下是com.google.common.collect.Multimap&lt;K，V&gt;接口的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Multimap</span>&lt;K,V&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"接口方法\"><a href=\"#接口方法\" class=\"headerlink\" title=\"接口方法\"></a>接口方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>Map&lt;K,Collection<V>&gt; asMap()</strong>  返回此multimap中的视图，从每个不同的键在键的关联值的非空集合映射。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>void clear()</strong>      将删除所有multimap中的键值对，留下空。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>boolean containsEntry(Object key, Object value)</strong>      返回true如果此多重映射包含至少一个键 - 值对用键键和值value。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>boolean containsKey(Object key)</strong>  返回true，如果这个multimap中至少包含一个键值对的键key。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>boolean containsValue(Object value)</strong>      返回true，如果这个multimap至少包含一个键值对的值值。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>Collection&lt;Map.Entry&lt;K,V&gt;&gt; entries()</strong>  返回包含在此multimap中，为Map.Entry的情况下，所有的键 - 值对的视图集合。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>boolean equals(Object obj)</strong>  比较指定对象与此多重映射是否相等。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>Collection<V> get(K key)</strong>  返回，如果有的话，在这个multimap中键关联的值的视图集合。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>int hashCode()</strong>      返回此多重映射的哈希码。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>boolean isEmpty()</strong>      返回true，如果这个multimap中未包含键 - 值对。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>Multiset<K> keys()</strong>  返回一个视图集合包含从每个键值对这个multimap中的关键，没有折叠重复。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>Set<K> keySet()</strong>      Returns a view collection of all distinct keys contained in this multimap.</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>boolean put(K key, V value)</strong>      存储键 - 值对在这个multimap中。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>boolean putAll(K key, Iterable&lt;? extends V&gt; values)</strong>              存储一个键 - 值对在此multimap中的每个值，都使用相同的键 key。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>boolean putAll(Multimap&lt;? extends K,? extends V&gt; multimap)</strong>              存储了所有键 - 值对多重映射在这个multimap中，通过返回 multimap.entries() 的顺序.</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong>boolean remove(Object key, Object value)</strong>      删除一个键 - 值对用键键，并从该多重映射的值的值，如果这样的存在。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong>Collection<V> removeAll(Object key)</strong>      删除与键键关联的所有值。</td>\n</tr>\n<tr>\n<td>18</td>\n<td><strong>Collection<V> replaceValues(K key, Iterable&lt;? extends V&gt; values)</strong>              存储与相同的键值，替换任何现有值的键的集合。</td>\n</tr>\n<tr>\n<td>19</td>\n<td>int size() 返回此多重映射键 - 值对的数量。</td>\n</tr>\n<tr>\n<td>20</td>\n<td><strong>Collection<V> values()</strong>      返回一个视图集合包含从包含在该multimap中的每个键 - 值对的值，而不发生重复 (so values().size() == size()).</td>\n</tr>\n</tbody></table>\n<h2 id=\"Multimap-示例\"><a href=\"#Multimap-示例\" class=\"headerlink\" title=\"Multimap 示例\"></a>Multimap 示例</h2><p>使用所选择的任何编辑器创建下面的java程序 <strong>C:/&gt; Guava</strong></p>\n<p><em>GuavaTester.java</em></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.ArrayListMultimap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.Multimap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"type\">GuavaTester</span> <span class=\"variable\">tester</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">GuavaTester</span>();</span><br><span class=\"line\">      Multimap&lt;String,String&gt; multimap = tester.getMultimap();</span><br><span class=\"line\"></span><br><span class=\"line\">      List&lt;String&gt; lowerList = (List&lt;String&gt;)multimap.get(<span class=\"string\">&quot;lower&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Initial lower case list&quot;</span>);</span><br><span class=\"line\">      System.out.println(lowerList.toString());</span><br><span class=\"line\">      lowerList.add(<span class=\"string\">&quot;f&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Modified lower case list&quot;</span>);</span><br><span class=\"line\">      System.out.println(lowerList.toString());</span><br><span class=\"line\"></span><br><span class=\"line\">      List&lt;String&gt; upperList = (List&lt;String&gt;)multimap.get(<span class=\"string\">&quot;upper&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Initial upper case list&quot;</span>);</span><br><span class=\"line\">      System.out.println(upperList.toString());</span><br><span class=\"line\">      upperList.remove(<span class=\"string\">&quot;D&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Modified upper case list&quot;</span>);</span><br><span class=\"line\">      System.out.println(upperList.toString());</span><br><span class=\"line\"></span><br><span class=\"line\">      Map&lt;String, Collection&lt;String&gt;&gt; map = multimap.asMap();</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Multimap as a map&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (Map.Entry&lt;String,  Collection&lt;String&gt;&gt; entry : map.entrySet()) &#123;</span><br><span class=\"line\">         <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> entry.getKey();</span><br><span class=\"line\">         Collection&lt;String&gt; value =  multimap.get(<span class=\"string\">&quot;lower&quot;</span>);</span><br><span class=\"line\">         System.out.println(key + <span class=\"string\">&quot;:&quot;</span> + value);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Keys of Multimap&quot;</span>);</span><br><span class=\"line\">      Set&lt;String&gt; keys =  multimap.keySet();</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(String key:keys)&#123;</span><br><span class=\"line\">         System.out.println(key);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Values of Multimap&quot;</span>);</span><br><span class=\"line\">      Collection&lt;String&gt; values = multimap.values();</span><br><span class=\"line\">      System.out.println(values);</span><br><span class=\"line\">   &#125;\t</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">private</span> Multimap&lt;String,String&gt; <span class=\"title function_\">getMultimap</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//Map&lt;String, List&lt;String&gt;&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">// lower -&gt; a, b, c, d, e </span></span><br><span class=\"line\">      <span class=\"comment\">// upper -&gt; A, B, C, D</span></span><br><span class=\"line\"></span><br><span class=\"line\">      Multimap&lt;String,String&gt; multimap = ArrayListMultimap.create();\t\t</span><br><span class=\"line\"></span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;lower&quot;</span>, <span class=\"string\">&quot;a&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;lower&quot;</span>, <span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;lower&quot;</span>, <span class=\"string\">&quot;c&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;lower&quot;</span>, <span class=\"string\">&quot;d&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;lower&quot;</span>, <span class=\"string\">&quot;e&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;upper&quot;</span>, <span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;upper&quot;</span>, <span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;upper&quot;</span>, <span class=\"string\">&quot;C&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;upper&quot;</span>, <span class=\"string\">&quot;D&quot;</span>);\t\t</span><br><span class=\"line\">      <span class=\"keyword\">return</span> multimap;\t\t</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Guava-Multimap类\"><a href=\"#Guava-Multimap类\" class=\"headerlink\" title=\"Guava Multimap类\"></a>Guava Multimap类</h1><p>多重映射接口扩展映射，使得其键一次可被映射到多个值。</p>\n<h2 id=\"接口声明\"><a href=\"#接口声明\" class=\"headerlink\" title=\"接口声明\"></a>接口声明</h2><p>以下是com.google.common.collect.Multimap&lt;K，V&gt;接口的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Multimap</span>&lt;K,V&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"接口方法\"><a href=\"#接口方法\" class=\"headerlink\" title=\"接口方法\"></a>接口方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>Map&lt;K,Collection<V>&gt; asMap()</strong>  返回此multimap中的视图，从每个不同的键在键的关联值的非空集合映射。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>void clear()</strong>      将删除所有multimap中的键值对，留下空。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>boolean containsEntry(Object key, Object value)</strong>      返回true如果此多重映射包含至少一个键 - 值对用键键和值value。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>boolean containsKey(Object key)</strong>  返回true，如果这个multimap中至少包含一个键值对的键key。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>boolean containsValue(Object value)</strong>      返回true，如果这个multimap至少包含一个键值对的值值。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>Collection&lt;Map.Entry&lt;K,V&gt;&gt; entries()</strong>  返回包含在此multimap中，为Map.Entry的情况下，所有的键 - 值对的视图集合。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>boolean equals(Object obj)</strong>  比较指定对象与此多重映射是否相等。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>Collection<V> get(K key)</strong>  返回，如果有的话，在这个multimap中键关联的值的视图集合。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>int hashCode()</strong>      返回此多重映射的哈希码。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>boolean isEmpty()</strong>      返回true，如果这个multimap中未包含键 - 值对。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>Multiset<K> keys()</strong>  返回一个视图集合包含从每个键值对这个multimap中的关键，没有折叠重复。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>Set<K> keySet()</strong>      Returns a view collection of all distinct keys contained in this multimap.</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>boolean put(K key, V value)</strong>      存储键 - 值对在这个multimap中。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>boolean putAll(K key, Iterable&lt;? extends V&gt; values)</strong>              存储一个键 - 值对在此multimap中的每个值，都使用相同的键 key。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>boolean putAll(Multimap&lt;? extends K,? extends V&gt; multimap)</strong>              存储了所有键 - 值对多重映射在这个multimap中，通过返回 multimap.entries() 的顺序.</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong>boolean remove(Object key, Object value)</strong>      删除一个键 - 值对用键键，并从该多重映射的值的值，如果这样的存在。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong>Collection<V> removeAll(Object key)</strong>      删除与键键关联的所有值。</td>\n</tr>\n<tr>\n<td>18</td>\n<td><strong>Collection<V> replaceValues(K key, Iterable&lt;? extends V&gt; values)</strong>              存储与相同的键值，替换任何现有值的键的集合。</td>\n</tr>\n<tr>\n<td>19</td>\n<td>int size() 返回此多重映射键 - 值对的数量。</td>\n</tr>\n<tr>\n<td>20</td>\n<td><strong>Collection<V> values()</strong>      返回一个视图集合包含从包含在该multimap中的每个键 - 值对的值，而不发生重复 (so values().size() == size()).</td>\n</tr>\n</tbody></table>\n<h2 id=\"Multimap-示例\"><a href=\"#Multimap-示例\" class=\"headerlink\" title=\"Multimap 示例\"></a>Multimap 示例</h2><p>使用所选择的任何编辑器创建下面的java程序 <strong>C:/&gt; Guava</strong></p>\n<p><em>GuavaTester.java</em></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.Collection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.ArrayListMultimap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.Multimap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"type\">GuavaTester</span> <span class=\"variable\">tester</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">GuavaTester</span>();</span><br><span class=\"line\">      Multimap&lt;String,String&gt; multimap = tester.getMultimap();</span><br><span class=\"line\"></span><br><span class=\"line\">      List&lt;String&gt; lowerList = (List&lt;String&gt;)multimap.get(<span class=\"string\">&quot;lower&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Initial lower case list&quot;</span>);</span><br><span class=\"line\">      System.out.println(lowerList.toString());</span><br><span class=\"line\">      lowerList.add(<span class=\"string\">&quot;f&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Modified lower case list&quot;</span>);</span><br><span class=\"line\">      System.out.println(lowerList.toString());</span><br><span class=\"line\"></span><br><span class=\"line\">      List&lt;String&gt; upperList = (List&lt;String&gt;)multimap.get(<span class=\"string\">&quot;upper&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Initial upper case list&quot;</span>);</span><br><span class=\"line\">      System.out.println(upperList.toString());</span><br><span class=\"line\">      upperList.remove(<span class=\"string\">&quot;D&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Modified upper case list&quot;</span>);</span><br><span class=\"line\">      System.out.println(upperList.toString());</span><br><span class=\"line\"></span><br><span class=\"line\">      Map&lt;String, Collection&lt;String&gt;&gt; map = multimap.asMap();</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Multimap as a map&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (Map.Entry&lt;String,  Collection&lt;String&gt;&gt; entry : map.entrySet()) &#123;</span><br><span class=\"line\">         <span class=\"type\">String</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> entry.getKey();</span><br><span class=\"line\">         Collection&lt;String&gt; value =  multimap.get(<span class=\"string\">&quot;lower&quot;</span>);</span><br><span class=\"line\">         System.out.println(key + <span class=\"string\">&quot;:&quot;</span> + value);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Keys of Multimap&quot;</span>);</span><br><span class=\"line\">      Set&lt;String&gt; keys =  multimap.keySet();</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(String key:keys)&#123;</span><br><span class=\"line\">         System.out.println(key);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Values of Multimap&quot;</span>);</span><br><span class=\"line\">      Collection&lt;String&gt; values = multimap.values();</span><br><span class=\"line\">      System.out.println(values);</span><br><span class=\"line\">   &#125;\t</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">private</span> Multimap&lt;String,String&gt; <span class=\"title function_\">getMultimap</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//Map&lt;String, List&lt;String&gt;&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">// lower -&gt; a, b, c, d, e </span></span><br><span class=\"line\">      <span class=\"comment\">// upper -&gt; A, B, C, D</span></span><br><span class=\"line\"></span><br><span class=\"line\">      Multimap&lt;String,String&gt; multimap = ArrayListMultimap.create();\t\t</span><br><span class=\"line\"></span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;lower&quot;</span>, <span class=\"string\">&quot;a&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;lower&quot;</span>, <span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;lower&quot;</span>, <span class=\"string\">&quot;c&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;lower&quot;</span>, <span class=\"string\">&quot;d&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;lower&quot;</span>, <span class=\"string\">&quot;e&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;upper&quot;</span>, <span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;upper&quot;</span>, <span class=\"string\">&quot;B&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;upper&quot;</span>, <span class=\"string\">&quot;C&quot;</span>);</span><br><span class=\"line\">      multimap.put(<span class=\"string\">&quot;upper&quot;</span>, <span class=\"string\">&quot;D&quot;</span>);\t\t</span><br><span class=\"line\">      <span class=\"keyword\">return</span> multimap;\t\t</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf6f25-c0ab-11ec-92a1-7557b2313227","title":"Guava Multiset","abbrlink":"6b775b82","_content":"\n# Guava Multiset接口\n\nMultiset接口扩展设置有重复的元素，并提供了各种实用的方法来处理这样的元素在集合中出现。\n\n## 接口声明\n\n以下是com.google.common.collect.Multiset<E>接口的声明：\n\n```java\n@GwtCompatible\npublic interface Multiset<E> extends Collection<E>\n```\n\n## 接口方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **boolean add(E element)**  添加一个出现的指定元素这个multiset。 |\n| 2    | **int add(E element, int occurrences)**  增加大量的元素到这个multiset。 |\n| 3    | **boolean contains(Object element)**  确定此多集是否包含指定的元素。 |\n| 4    | **boolean containsAll(Collection<?> elements)**  返回true，如果这个多集至少包含一个出现的指定集合中的所有元素。 |\n| 5    | **int count(Object element)**  返回出现的元素的在该multiset的数目（元素的数量）。 |\n| 6    | **Set<E> elementSet()**  返回集包含在此多集不同的元素。      |\n| 7    | **Set<Multiset.Entry<E>> entrySet()**  返回此多集的内容的视图，分组在Multiset.Entry实例中，每一个都提供了多集的一个元素和元素的计数。 |\n| 8    | **boolean equals(Object object)** 比较指定对象与此multiset是否相等。 |\n| 9    | **int hashCode()**  返回此multiset的哈希码。                 |\n| 10   | **Iterator<E> iterator()**  返回一个迭代在这个集合中的元素。 |\n| 11   | **boolean remove(Object element)**  移除此多集multiset的单个出现的指定元素，如果存在。 |\n| 12   | **int remove(Object element, int occurrences)**  删除了一些出现，从该多集multiset的指定元素。 |\n| 13   | **boolean removeAll(Collection<?> c)**  删除所有这一切都包含在指定集合（可选操作）在此集合的元素。 |\n| 14   | **boolean retainAll(Collection<?> c)**  保持那些包含在指定collection（可选操作）在此只集合中的元素。 |\n| 15   | **int setCount(E element, int count)**  添加或删除，使得该元素达到所期望的计数的元件的必要出现。 |\n| 16   | **boolean setCount(E element, int oldCount, int newCount)**  \t\t\t有条件设置元素的计数为一个新值，如在setCount（对象，INT）中所述，条件是该元素预期的当前计数。 |\n| 17   | **String toString()**  返回该对象的字符串表示。              |\n\n## 方法继承\n\n此接口继承从以下接口方法：\n\n- java.util.Collection\n\n## Multiset 示例\n\n使用所选择的编辑器创建下面的java程序，比如说 C:/> Guava\n\n*GuavaTester.java*\n\n```java\nimport java.util.Iterator;\nimport java.util.Set;\n\nimport com.google.common.collect.HashMultiset;\nimport com.google.common.collect.Multiset;\n\npublic class GuavaTester {\n\n   public static void main(String args[]){\n      //create a multiset collection\n      Multiset<String> multiset = HashMultiset.create();\n      multiset.add(\"a\");\n      multiset.add(\"b\");\n      multiset.add(\"c\");\n      multiset.add(\"d\");\n      multiset.add(\"a\");\n      multiset.add(\"b\");\n      multiset.add(\"c\");\n      multiset.add(\"b\");\n      multiset.add(\"b\");\n      multiset.add(\"b\");\n      //print the occurrence of an element\n      System.out.println(\"Occurrence of 'b' : \"+multiset.count(\"b\"));\n      //print the total size of the multiset\n      System.out.println(\"Total Size : \"+multiset.size());\n      //get the distinct elements of the multiset as set\n      Set<String> set = multiset.elementSet();\n      //display the elements of the set\n      System.out.println(\"Set [\");\n      for (String s : set) {\t\t\t\n         System.out.println(s);\t\t    \n      }\n      System.out.println(\"]\");\n      //display all the elements of the multiset using iterator\n      Iterator<String> iterator  = multiset.iterator();\n      System.out.println(\"MultiSet [\");\n      while(iterator.hasNext()){\n         System.out.println(iterator.next());\n      }\n      System.out.println(\"]\");\t\t\n      //display the distinct elements of the multiset with their occurrence count\n      System.out.println(\"MultiSet [\");\n      for (Multiset.Entry<String> entry : multiset.entrySet())\n      {\n         System.out.println(\"Element: \"+entry.getElement() +\", Occurrence(s): \" + entry.getCount());\t\t    \n      }\n      System.out.println(\"]\");\t\t\n\n      //remove extra occurrences \n      multiset.remove(\"b\",2);\n      //print the occurrence of an element\n      System.out.println(\"Occurence of 'b' : \"+multiset.count(\"b\"));\n   }\t\n}\n```\n","source":"_posts/guava/collections/Multiset.md","raw":"---\nuuid: bbaf6f25-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Multiset\ncategories: Java\ntags:\n  - guava\nabbrlink: 6b775b82\n---\n\n# Guava Multiset接口\n\nMultiset接口扩展设置有重复的元素，并提供了各种实用的方法来处理这样的元素在集合中出现。\n\n## 接口声明\n\n以下是com.google.common.collect.Multiset<E>接口的声明：\n\n```java\n@GwtCompatible\npublic interface Multiset<E> extends Collection<E>\n```\n\n## 接口方法\n\n| S.N. | 方法及说明                                                   |\n| ---- | ------------------------------------------------------------ |\n| 1    | **boolean add(E element)**  添加一个出现的指定元素这个multiset。 |\n| 2    | **int add(E element, int occurrences)**  增加大量的元素到这个multiset。 |\n| 3    | **boolean contains(Object element)**  确定此多集是否包含指定的元素。 |\n| 4    | **boolean containsAll(Collection<?> elements)**  返回true，如果这个多集至少包含一个出现的指定集合中的所有元素。 |\n| 5    | **int count(Object element)**  返回出现的元素的在该multiset的数目（元素的数量）。 |\n| 6    | **Set<E> elementSet()**  返回集包含在此多集不同的元素。      |\n| 7    | **Set<Multiset.Entry<E>> entrySet()**  返回此多集的内容的视图，分组在Multiset.Entry实例中，每一个都提供了多集的一个元素和元素的计数。 |\n| 8    | **boolean equals(Object object)** 比较指定对象与此multiset是否相等。 |\n| 9    | **int hashCode()**  返回此multiset的哈希码。                 |\n| 10   | **Iterator<E> iterator()**  返回一个迭代在这个集合中的元素。 |\n| 11   | **boolean remove(Object element)**  移除此多集multiset的单个出现的指定元素，如果存在。 |\n| 12   | **int remove(Object element, int occurrences)**  删除了一些出现，从该多集multiset的指定元素。 |\n| 13   | **boolean removeAll(Collection<?> c)**  删除所有这一切都包含在指定集合（可选操作）在此集合的元素。 |\n| 14   | **boolean retainAll(Collection<?> c)**  保持那些包含在指定collection（可选操作）在此只集合中的元素。 |\n| 15   | **int setCount(E element, int count)**  添加或删除，使得该元素达到所期望的计数的元件的必要出现。 |\n| 16   | **boolean setCount(E element, int oldCount, int newCount)**  \t\t\t有条件设置元素的计数为一个新值，如在setCount（对象，INT）中所述，条件是该元素预期的当前计数。 |\n| 17   | **String toString()**  返回该对象的字符串表示。              |\n\n## 方法继承\n\n此接口继承从以下接口方法：\n\n- java.util.Collection\n\n## Multiset 示例\n\n使用所选择的编辑器创建下面的java程序，比如说 C:/> Guava\n\n*GuavaTester.java*\n\n```java\nimport java.util.Iterator;\nimport java.util.Set;\n\nimport com.google.common.collect.HashMultiset;\nimport com.google.common.collect.Multiset;\n\npublic class GuavaTester {\n\n   public static void main(String args[]){\n      //create a multiset collection\n      Multiset<String> multiset = HashMultiset.create();\n      multiset.add(\"a\");\n      multiset.add(\"b\");\n      multiset.add(\"c\");\n      multiset.add(\"d\");\n      multiset.add(\"a\");\n      multiset.add(\"b\");\n      multiset.add(\"c\");\n      multiset.add(\"b\");\n      multiset.add(\"b\");\n      multiset.add(\"b\");\n      //print the occurrence of an element\n      System.out.println(\"Occurrence of 'b' : \"+multiset.count(\"b\"));\n      //print the total size of the multiset\n      System.out.println(\"Total Size : \"+multiset.size());\n      //get the distinct elements of the multiset as set\n      Set<String> set = multiset.elementSet();\n      //display the elements of the set\n      System.out.println(\"Set [\");\n      for (String s : set) {\t\t\t\n         System.out.println(s);\t\t    \n      }\n      System.out.println(\"]\");\n      //display all the elements of the multiset using iterator\n      Iterator<String> iterator  = multiset.iterator();\n      System.out.println(\"MultiSet [\");\n      while(iterator.hasNext()){\n         System.out.println(iterator.next());\n      }\n      System.out.println(\"]\");\t\t\n      //display the distinct elements of the multiset with their occurrence count\n      System.out.println(\"MultiSet [\");\n      for (Multiset.Entry<String> entry : multiset.entrySet())\n      {\n         System.out.println(\"Element: \"+entry.getElement() +\", Occurrence(s): \" + entry.getCount());\t\t    \n      }\n      System.out.println(\"]\");\t\t\n\n      //remove extra occurrences \n      multiset.remove(\"b\",2);\n      //print the occurrence of an element\n      System.out.println(\"Occurence of 'b' : \"+multiset.count(\"b\"));\n   }\t\n}\n```\n","slug":"guava/collections/Multiset","published":1,"date":"2022-04-20T12:41:20.853Z","updated":"2022-05-04T03:05:29.659Z","_id":"cl2qzftii005i13nog2i47u6m","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Guava-Multiset接口\"><a href=\"#Guava-Multiset接口\" class=\"headerlink\" title=\"Guava Multiset接口\"></a>Guava Multiset接口</h1><p>Multiset接口扩展设置有重复的元素，并提供了各种实用的方法来处理这样的元素在集合中出现。</p>\n<h2 id=\"接口声明\"><a href=\"#接口声明\" class=\"headerlink\" title=\"接口声明\"></a>接口声明</h2><p>以下是com.google.common.collect.Multiset<E>接口的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Multiset</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Collection</span>&lt;E&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"接口方法\"><a href=\"#接口方法\" class=\"headerlink\" title=\"接口方法\"></a>接口方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>boolean add(E element)</strong>  添加一个出现的指定元素这个multiset。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>int add(E element, int occurrences)</strong>  增加大量的元素到这个multiset。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>boolean contains(Object element)</strong>  确定此多集是否包含指定的元素。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>boolean containsAll(Collection&lt;?&gt; elements)</strong>  返回true，如果这个多集至少包含一个出现的指定集合中的所有元素。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>int count(Object element)</strong>  返回出现的元素的在该multiset的数目（元素的数量）。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>Set<E> elementSet()</strong>  返回集包含在此多集不同的元素。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>Set&lt;Multiset.Entry<E>&gt; entrySet()</strong>  返回此多集的内容的视图，分组在Multiset.Entry实例中，每一个都提供了多集的一个元素和元素的计数。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>boolean equals(Object object)</strong> 比较指定对象与此multiset是否相等。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>int hashCode()</strong>  返回此multiset的哈希码。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>Iterator<E> iterator()</strong>  返回一个迭代在这个集合中的元素。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>boolean remove(Object element)</strong>  移除此多集multiset的单个出现的指定元素，如果存在。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>int remove(Object element, int occurrences)</strong>  删除了一些出现，从该多集multiset的指定元素。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>boolean removeAll(Collection&lt;?&gt; c)</strong>  删除所有这一切都包含在指定集合（可选操作）在此集合的元素。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>boolean retainAll(Collection&lt;?&gt; c)</strong>  保持那些包含在指定collection（可选操作）在此只集合中的元素。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>int setCount(E element, int count)</strong>  添加或删除，使得该元素达到所期望的计数的元件的必要出现。</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong>boolean setCount(E element, int oldCount, int newCount)</strong>              有条件设置元素的计数为一个新值，如在setCount（对象，INT）中所述，条件是该元素预期的当前计数。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong>String toString()</strong>  返回该对象的字符串表示。</td>\n</tr>\n</tbody></table>\n<h2 id=\"方法继承\"><a href=\"#方法继承\" class=\"headerlink\" title=\"方法继承\"></a>方法继承</h2><p>此接口继承从以下接口方法：</p>\n<ul>\n<li>java.util.Collection</li>\n</ul>\n<h2 id=\"Multiset-示例\"><a href=\"#Multiset-示例\" class=\"headerlink\" title=\"Multiset 示例\"></a>Multiset 示例</h2><p>使用所选择的编辑器创建下面的java程序，比如说 C:/&gt; Guava</p>\n<p><em>GuavaTester.java</em></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.Iterator;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.HashMultiset;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.Multiset;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//create a multiset collection</span></span><br><span class=\"line\">      Multiset&lt;String&gt; multiset = HashMultiset.create();</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;a&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;c&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;d&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;a&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;c&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">//print the occurrence of an element</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Occurrence of &#x27;b&#x27; : &quot;</span>+multiset.count(<span class=\"string\">&quot;b&quot;</span>));</span><br><span class=\"line\">      <span class=\"comment\">//print the total size of the multiset</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Total Size : &quot;</span>+multiset.size());</span><br><span class=\"line\">      <span class=\"comment\">//get the distinct elements of the multiset as set</span></span><br><span class=\"line\">      Set&lt;String&gt; set = multiset.elementSet();</span><br><span class=\"line\">      <span class=\"comment\">//display the elements of the set</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Set [&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (String s : set) &#123;\t\t\t</span><br><span class=\"line\">         System.out.println(s);\t\t    </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;]&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">//display all the elements of the multiset using iterator</span></span><br><span class=\"line\">      Iterator&lt;String&gt; iterator  = multiset.iterator();</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;MultiSet [&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">while</span>(iterator.hasNext())&#123;</span><br><span class=\"line\">         System.out.println(iterator.next());</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;]&quot;</span>);\t\t</span><br><span class=\"line\">      <span class=\"comment\">//display the distinct elements of the multiset with their occurrence count</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;MultiSet [&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (Multiset.Entry&lt;String&gt; entry : multiset.entrySet())</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">         System.out.println(<span class=\"string\">&quot;Element: &quot;</span>+entry.getElement() +<span class=\"string\">&quot;, Occurrence(s): &quot;</span> + entry.getCount());\t\t    </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;]&quot;</span>);\t\t</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//remove extra occurrences </span></span><br><span class=\"line\">      multiset.remove(<span class=\"string\">&quot;b&quot;</span>,<span class=\"number\">2</span>);</span><br><span class=\"line\">      <span class=\"comment\">//print the occurrence of an element</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Occurence of &#x27;b&#x27; : &quot;</span>+multiset.count(<span class=\"string\">&quot;b&quot;</span>));</span><br><span class=\"line\">   &#125;\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Guava-Multiset接口\"><a href=\"#Guava-Multiset接口\" class=\"headerlink\" title=\"Guava Multiset接口\"></a>Guava Multiset接口</h1><p>Multiset接口扩展设置有重复的元素，并提供了各种实用的方法来处理这样的元素在集合中出现。</p>\n<h2 id=\"接口声明\"><a href=\"#接口声明\" class=\"headerlink\" title=\"接口声明\"></a>接口声明</h2><p>以下是com.google.common.collect.Multiset<E>接口的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Multiset</span>&lt;E&gt; <span class=\"keyword\">extends</span> <span class=\"title class_\">Collection</span>&lt;E&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"接口方法\"><a href=\"#接口方法\" class=\"headerlink\" title=\"接口方法\"></a>接口方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法及说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>boolean add(E element)</strong>  添加一个出现的指定元素这个multiset。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>int add(E element, int occurrences)</strong>  增加大量的元素到这个multiset。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>boolean contains(Object element)</strong>  确定此多集是否包含指定的元素。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>boolean containsAll(Collection&lt;?&gt; elements)</strong>  返回true，如果这个多集至少包含一个出现的指定集合中的所有元素。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>int count(Object element)</strong>  返回出现的元素的在该multiset的数目（元素的数量）。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>Set<E> elementSet()</strong>  返回集包含在此多集不同的元素。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>Set&lt;Multiset.Entry<E>&gt; entrySet()</strong>  返回此多集的内容的视图，分组在Multiset.Entry实例中，每一个都提供了多集的一个元素和元素的计数。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>boolean equals(Object object)</strong> 比较指定对象与此multiset是否相等。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>int hashCode()</strong>  返回此multiset的哈希码。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>Iterator<E> iterator()</strong>  返回一个迭代在这个集合中的元素。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>boolean remove(Object element)</strong>  移除此多集multiset的单个出现的指定元素，如果存在。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>int remove(Object element, int occurrences)</strong>  删除了一些出现，从该多集multiset的指定元素。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>boolean removeAll(Collection&lt;?&gt; c)</strong>  删除所有这一切都包含在指定集合（可选操作）在此集合的元素。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>boolean retainAll(Collection&lt;?&gt; c)</strong>  保持那些包含在指定collection（可选操作）在此只集合中的元素。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>int setCount(E element, int count)</strong>  添加或删除，使得该元素达到所期望的计数的元件的必要出现。</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong>boolean setCount(E element, int oldCount, int newCount)</strong>              有条件设置元素的计数为一个新值，如在setCount（对象，INT）中所述，条件是该元素预期的当前计数。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong>String toString()</strong>  返回该对象的字符串表示。</td>\n</tr>\n</tbody></table>\n<h2 id=\"方法继承\"><a href=\"#方法继承\" class=\"headerlink\" title=\"方法继承\"></a>方法继承</h2><p>此接口继承从以下接口方法：</p>\n<ul>\n<li>java.util.Collection</li>\n</ul>\n<h2 id=\"Multiset-示例\"><a href=\"#Multiset-示例\" class=\"headerlink\" title=\"Multiset 示例\"></a>Multiset 示例</h2><p>使用所选择的编辑器创建下面的java程序，比如说 C:/&gt; Guava</p>\n<p><em>GuavaTester.java</em></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.Iterator;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.HashMultiset;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.Multiset;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//create a multiset collection</span></span><br><span class=\"line\">      Multiset&lt;String&gt; multiset = HashMultiset.create();</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;a&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;c&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;d&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;a&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;c&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      multiset.add(<span class=\"string\">&quot;b&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">//print the occurrence of an element</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Occurrence of &#x27;b&#x27; : &quot;</span>+multiset.count(<span class=\"string\">&quot;b&quot;</span>));</span><br><span class=\"line\">      <span class=\"comment\">//print the total size of the multiset</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Total Size : &quot;</span>+multiset.size());</span><br><span class=\"line\">      <span class=\"comment\">//get the distinct elements of the multiset as set</span></span><br><span class=\"line\">      Set&lt;String&gt; set = multiset.elementSet();</span><br><span class=\"line\">      <span class=\"comment\">//display the elements of the set</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Set [&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (String s : set) &#123;\t\t\t</span><br><span class=\"line\">         System.out.println(s);\t\t    </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;]&quot;</span>);</span><br><span class=\"line\">      <span class=\"comment\">//display all the elements of the multiset using iterator</span></span><br><span class=\"line\">      Iterator&lt;String&gt; iterator  = multiset.iterator();</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;MultiSet [&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">while</span>(iterator.hasNext())&#123;</span><br><span class=\"line\">         System.out.println(iterator.next());</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;]&quot;</span>);\t\t</span><br><span class=\"line\">      <span class=\"comment\">//display the distinct elements of the multiset with their occurrence count</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;MultiSet [&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span> (Multiset.Entry&lt;String&gt; entry : multiset.entrySet())</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">         System.out.println(<span class=\"string\">&quot;Element: &quot;</span>+entry.getElement() +<span class=\"string\">&quot;, Occurrence(s): &quot;</span> + entry.getCount());\t\t    </span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;]&quot;</span>);\t\t</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//remove extra occurrences </span></span><br><span class=\"line\">      multiset.remove(<span class=\"string\">&quot;b&quot;</span>,<span class=\"number\">2</span>);</span><br><span class=\"line\">      <span class=\"comment\">//print the occurrence of an element</span></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;Occurence of &#x27;b&#x27; : &quot;</span>+multiset.count(<span class=\"string\">&quot;b&quot;</span>));</span><br><span class=\"line\">   &#125;\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf6f26-c0ab-11ec-92a1-7557b2313227","title":"Guava Table","abbrlink":"7e14eb94","_content":"\n# Guava Table接口\n\nTable代表一个特殊的映射，其中两个键可以在组合的方式被指定为单个值。它类似于创建映射的映射。\n\n## \t接口声明\n\n以下是 com.google.common.collect.Table<R，C，V> 接口的声明：\n\n```java\n@GwtCompatible\npublic interface Table<R,C,V>\n```\n\n## \t接口方法\n\n| S.N. | 方法 & 描述                                                  |\n| ---- | ------------------------------------------------------------ |\n| 1    | **Set<Table.Cell<R,C,V>> cellSet()**  \t\t\t返回集合中的所有行键/列键/值三元组。 |\n| 2    | **void clear()**  \t\t\t从表中删除所有映射。           |\n| 3    | **Map<R,V> column(C columnKey)**  \t\t\t返回在给定列键的所有映射的视图。 |\n| 4    | **Set<C> columnKeySet()**  \t\t\t返回一组具有表中的一个或多个值的列键。 |\n| 5    | **Map<C,Map<R,V>> columnMap()**  \t\t\t返回关联的每一列键与行键对应的映射值的视图。 |\n| 6    | **boolean contains(Object rowKey, Object columnKey)**  \t\t\t返回true，如果表中包含与指定的行和列键的映射。 |\n| 7    | **boolean containsColumn(Object columnKey)**  \t\t\t返回true，如果表中包含与指定列的映射。 |\n| 8    | **boolean containsRow(Object rowKey)**  \t\t\t返回true，如果表中包含与指定的行键的映射关系。 |\n| 9    | **boolean containsValue(Object value)**  \t\t\t返回true，如果表中包含具有指定值的映射。 |\n| 10   | **boolean equals(Object obj)**  \t\t\t比较指定对象与此表是否相等。 |\n| 11   | **V get(Object rowKey, Object columnKey)**  \t\t\t返回对应于给定的行和列键，如果没有这样的映射存在值，返回null。 |\n| 12   | **int hashCode()**  \t\t\t返回此表中的哈希码。         |\n| 13   | **boolean isEmpty()**  \t\t\t返回true，如果表中没有映射。 |\n| 14   | **V put(R rowKey, C columnKey, V value)**  关联指定值与指定键。 |\n| 15   | **void putAll(Table<? extends R,? extends C,? extends V> table)**  复制从指定的表中的所有映射到这个表。 |\n| 16   | **V remove(Object rowKey, Object columnKey)**  \t如果有的话，使用给定键相关联删除的映射。 |\n| 17   | **Map<C,V> row(R rowKey)**  返回包含给定行键的所有映射的视图。 |\n| 18   | **Set<R> rowKeySet()**  \t返回一组行键具有在表中的一个或多个值。 |\n| 19   | **Map<R,Map<C,V>> rowMap()**  返回关联的每一行按键与键列对应的映射值的视图。 |\n| 20   | **int size()**  \t\t\t返回行键/列键/表中的值映射关系的数量。 |\n| 21   | **Collection<V> values()**  返回所有值，其中可能包含重复的集合。 |\n\n## Table 例子\n\n选择使用任何编辑器创建以下java程序在 **C:/> Guava**\n\n*GuavaTester.java*\n\n```java\nimport java.util.Map;\nimport java.util.Set;\n\nimport com.google.common.collect.HashBasedTable;\nimport com.google.common.collect.Table;\n\npublic class GuavaTester {\n\n   public static void main(String args[]){\n      //Table<R,C,V> == Map<R,Map<C,V>>\n      /*\n      *  Company: IBM, Microsoft, TCS\n      *  IBM \t\t-> {101:Mahesh, 102:Ramesh, 103:Suresh}\n      *  Microsoft \t-> {101:Sohan, 102:Mohan, 103:Rohan } \n      *  TCS \t\t-> {101:Ram, 102: Shyam, 103: Sunil } \n      * \n      * */\n      //create a table\n      Table<String, String, String> employeeTable = HashBasedTable.create();\n\n      //initialize the table with employee details\n      employeeTable.put(\"IBM\", \"101\",\"Mahesh\");\n      employeeTable.put(\"IBM\", \"102\",\"Ramesh\");\n      employeeTable.put(\"IBM\", \"103\",\"Suresh\");\n\n      employeeTable.put(\"Microsoft\", \"111\",\"Sohan\");\n      employeeTable.put(\"Microsoft\", \"112\",\"Mohan\");\n      employeeTable.put(\"Microsoft\", \"113\",\"Rohan\");\n\n      employeeTable.put(\"TCS\", \"121\",\"Ram\");\n      employeeTable.put(\"TCS\", \"122\",\"Shyam\");\n      employeeTable.put(\"TCS\", \"123\",\"Sunil\");\n\n      //get Map corresponding to IBM\n      Map<String,String> ibmEmployees =  employeeTable.row(\"IBM\");\n\n      System.out.println(\"List of IBM Employees\");\n      for(Map.Entry<String, String> entry : ibmEmployees.entrySet()){\n         System.out.println(\"Emp Id: \" + entry.getKey() + \", Name: \" + entry.getValue());\n      }\n\n      //get all the unique keys of the table\n      Set<String> employers = employeeTable.rowKeySet();\n      System.out.print(\"Employers: \");\n      for(String employer: employers){\n         System.out.print(employer + \" \");\n      }\n      System.out.println();\n\n      //get a Map corresponding to 102\n      Map<String,String> EmployerMap =  employeeTable.column(\"102\");\n      for(Map.Entry<String, String> entry : EmployerMap.entrySet()){\n         System.out.println(\"Employer: \" + entry.getKey() + \", Name: \" + entry.getValue());\n      }\t\t\n   }\t\n}\n```\n","source":"_posts/guava/collections/Table.md","raw":"---\nuuid: bbaf6f26-c0ab-11ec-92a1-7557b2313227\ntitle: Guava Table\ncategories: Java\ntags:\n  - guava\nabbrlink: 7e14eb94\n---\n\n# Guava Table接口\n\nTable代表一个特殊的映射，其中两个键可以在组合的方式被指定为单个值。它类似于创建映射的映射。\n\n## \t接口声明\n\n以下是 com.google.common.collect.Table<R，C，V> 接口的声明：\n\n```java\n@GwtCompatible\npublic interface Table<R,C,V>\n```\n\n## \t接口方法\n\n| S.N. | 方法 & 描述                                                  |\n| ---- | ------------------------------------------------------------ |\n| 1    | **Set<Table.Cell<R,C,V>> cellSet()**  \t\t\t返回集合中的所有行键/列键/值三元组。 |\n| 2    | **void clear()**  \t\t\t从表中删除所有映射。           |\n| 3    | **Map<R,V> column(C columnKey)**  \t\t\t返回在给定列键的所有映射的视图。 |\n| 4    | **Set<C> columnKeySet()**  \t\t\t返回一组具有表中的一个或多个值的列键。 |\n| 5    | **Map<C,Map<R,V>> columnMap()**  \t\t\t返回关联的每一列键与行键对应的映射值的视图。 |\n| 6    | **boolean contains(Object rowKey, Object columnKey)**  \t\t\t返回true，如果表中包含与指定的行和列键的映射。 |\n| 7    | **boolean containsColumn(Object columnKey)**  \t\t\t返回true，如果表中包含与指定列的映射。 |\n| 8    | **boolean containsRow(Object rowKey)**  \t\t\t返回true，如果表中包含与指定的行键的映射关系。 |\n| 9    | **boolean containsValue(Object value)**  \t\t\t返回true，如果表中包含具有指定值的映射。 |\n| 10   | **boolean equals(Object obj)**  \t\t\t比较指定对象与此表是否相等。 |\n| 11   | **V get(Object rowKey, Object columnKey)**  \t\t\t返回对应于给定的行和列键，如果没有这样的映射存在值，返回null。 |\n| 12   | **int hashCode()**  \t\t\t返回此表中的哈希码。         |\n| 13   | **boolean isEmpty()**  \t\t\t返回true，如果表中没有映射。 |\n| 14   | **V put(R rowKey, C columnKey, V value)**  关联指定值与指定键。 |\n| 15   | **void putAll(Table<? extends R,? extends C,? extends V> table)**  复制从指定的表中的所有映射到这个表。 |\n| 16   | **V remove(Object rowKey, Object columnKey)**  \t如果有的话，使用给定键相关联删除的映射。 |\n| 17   | **Map<C,V> row(R rowKey)**  返回包含给定行键的所有映射的视图。 |\n| 18   | **Set<R> rowKeySet()**  \t返回一组行键具有在表中的一个或多个值。 |\n| 19   | **Map<R,Map<C,V>> rowMap()**  返回关联的每一行按键与键列对应的映射值的视图。 |\n| 20   | **int size()**  \t\t\t返回行键/列键/表中的值映射关系的数量。 |\n| 21   | **Collection<V> values()**  返回所有值，其中可能包含重复的集合。 |\n\n## Table 例子\n\n选择使用任何编辑器创建以下java程序在 **C:/> Guava**\n\n*GuavaTester.java*\n\n```java\nimport java.util.Map;\nimport java.util.Set;\n\nimport com.google.common.collect.HashBasedTable;\nimport com.google.common.collect.Table;\n\npublic class GuavaTester {\n\n   public static void main(String args[]){\n      //Table<R,C,V> == Map<R,Map<C,V>>\n      /*\n      *  Company: IBM, Microsoft, TCS\n      *  IBM \t\t-> {101:Mahesh, 102:Ramesh, 103:Suresh}\n      *  Microsoft \t-> {101:Sohan, 102:Mohan, 103:Rohan } \n      *  TCS \t\t-> {101:Ram, 102: Shyam, 103: Sunil } \n      * \n      * */\n      //create a table\n      Table<String, String, String> employeeTable = HashBasedTable.create();\n\n      //initialize the table with employee details\n      employeeTable.put(\"IBM\", \"101\",\"Mahesh\");\n      employeeTable.put(\"IBM\", \"102\",\"Ramesh\");\n      employeeTable.put(\"IBM\", \"103\",\"Suresh\");\n\n      employeeTable.put(\"Microsoft\", \"111\",\"Sohan\");\n      employeeTable.put(\"Microsoft\", \"112\",\"Mohan\");\n      employeeTable.put(\"Microsoft\", \"113\",\"Rohan\");\n\n      employeeTable.put(\"TCS\", \"121\",\"Ram\");\n      employeeTable.put(\"TCS\", \"122\",\"Shyam\");\n      employeeTable.put(\"TCS\", \"123\",\"Sunil\");\n\n      //get Map corresponding to IBM\n      Map<String,String> ibmEmployees =  employeeTable.row(\"IBM\");\n\n      System.out.println(\"List of IBM Employees\");\n      for(Map.Entry<String, String> entry : ibmEmployees.entrySet()){\n         System.out.println(\"Emp Id: \" + entry.getKey() + \", Name: \" + entry.getValue());\n      }\n\n      //get all the unique keys of the table\n      Set<String> employers = employeeTable.rowKeySet();\n      System.out.print(\"Employers: \");\n      for(String employer: employers){\n         System.out.print(employer + \" \");\n      }\n      System.out.println();\n\n      //get a Map corresponding to 102\n      Map<String,String> EmployerMap =  employeeTable.column(\"102\");\n      for(Map.Entry<String, String> entry : EmployerMap.entrySet()){\n         System.out.println(\"Employer: \" + entry.getKey() + \", Name: \" + entry.getValue());\n      }\t\t\n   }\t\n}\n```\n","slug":"guava/collections/Table","published":1,"date":"2022-04-20T12:41:20.849Z","updated":"2022-05-04T03:07:08.558Z","_id":"cl2qzftik005l13nof3bgermc","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"Guava-Table接口\"><a href=\"#Guava-Table接口\" class=\"headerlink\" title=\"Guava Table接口\"></a>Guava Table接口</h1><p>Table代表一个特殊的映射，其中两个键可以在组合的方式被指定为单个值。它类似于创建映射的映射。</p>\n<h2 id=\"接口声明\"><a href=\"#接口声明\" class=\"headerlink\" title=\"接口声明\"></a>接口声明</h2><p>以下是 com.google.common.collect.Table&lt;R，C，V&gt; 接口的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Table</span>&lt;R,C,V&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"接口方法\"><a href=\"#接口方法\" class=\"headerlink\" title=\"接口方法\"></a>接口方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法 &amp; 描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>Set&lt;Table.Cell&lt;R,C,V&gt;&gt; cellSet()</strong>              返回集合中的所有行键/列键/值三元组。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>void clear()</strong>              从表中删除所有映射。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>Map&lt;R,V&gt; column(C columnKey)</strong>              返回在给定列键的所有映射的视图。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>Set<C> columnKeySet()</strong>              返回一组具有表中的一个或多个值的列键。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>Map&lt;C,Map&lt;R,V&gt;&gt; columnMap()</strong>              返回关联的每一列键与行键对应的映射值的视图。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>boolean contains(Object rowKey, Object columnKey)</strong>              返回true，如果表中包含与指定的行和列键的映射。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>boolean containsColumn(Object columnKey)</strong>              返回true，如果表中包含与指定列的映射。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>boolean containsRow(Object rowKey)</strong>              返回true，如果表中包含与指定的行键的映射关系。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>boolean containsValue(Object value)</strong>              返回true，如果表中包含具有指定值的映射。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>boolean equals(Object obj)</strong>              比较指定对象与此表是否相等。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>V get(Object rowKey, Object columnKey)</strong>              返回对应于给定的行和列键，如果没有这样的映射存在值，返回null。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>int hashCode()</strong>              返回此表中的哈希码。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>boolean isEmpty()</strong>              返回true，如果表中没有映射。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>V put(R rowKey, C columnKey, V value)</strong>  关联指定值与指定键。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>void putAll(Table&lt;? extends R,? extends C,? extends V&gt; table)</strong>  复制从指定的表中的所有映射到这个表。</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong>V remove(Object rowKey, Object columnKey)</strong>      如果有的话，使用给定键相关联删除的映射。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong>Map&lt;C,V&gt; row(R rowKey)</strong>  返回包含给定行键的所有映射的视图。</td>\n</tr>\n<tr>\n<td>18</td>\n<td><strong>Set<R> rowKeySet()</strong>      返回一组行键具有在表中的一个或多个值。</td>\n</tr>\n<tr>\n<td>19</td>\n<td><strong>Map&lt;R,Map&lt;C,V&gt;&gt; rowMap()</strong>  返回关联的每一行按键与键列对应的映射值的视图。</td>\n</tr>\n<tr>\n<td>20</td>\n<td><strong>int size()</strong>              返回行键/列键/表中的值映射关系的数量。</td>\n</tr>\n<tr>\n<td>21</td>\n<td><strong>Collection<V> values()</strong>  返回所有值，其中可能包含重复的集合。</td>\n</tr>\n</tbody></table>\n<h2 id=\"Table-例子\"><a href=\"#Table-例子\" class=\"headerlink\" title=\"Table 例子\"></a>Table 例子</h2><p>选择使用任何编辑器创建以下java程序在 <strong>C:/&gt; Guava</strong></p>\n<p><em>GuavaTester.java</em></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.HashBasedTable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.Table;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//Table&lt;R,C,V&gt; == Map&lt;R,Map&lt;C,V&gt;&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">      *  Company: IBM, Microsoft, TCS</span></span><br><span class=\"line\"><span class=\"comment\">      *  IBM \t\t-&gt; &#123;101:Mahesh, 102:Ramesh, 103:Suresh&#125;</span></span><br><span class=\"line\"><span class=\"comment\">      *  Microsoft \t-&gt; &#123;101:Sohan, 102:Mohan, 103:Rohan &#125; </span></span><br><span class=\"line\"><span class=\"comment\">      *  TCS \t\t-&gt; &#123;101:Ram, 102: Shyam, 103: Sunil &#125; </span></span><br><span class=\"line\"><span class=\"comment\">      * </span></span><br><span class=\"line\"><span class=\"comment\">      * */</span></span><br><span class=\"line\">      <span class=\"comment\">//create a table</span></span><br><span class=\"line\">      Table&lt;String, String, String&gt; employeeTable = HashBasedTable.create();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//initialize the table with employee details</span></span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;IBM&quot;</span>, <span class=\"string\">&quot;101&quot;</span>,<span class=\"string\">&quot;Mahesh&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;IBM&quot;</span>, <span class=\"string\">&quot;102&quot;</span>,<span class=\"string\">&quot;Ramesh&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;IBM&quot;</span>, <span class=\"string\">&quot;103&quot;</span>,<span class=\"string\">&quot;Suresh&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;Microsoft&quot;</span>, <span class=\"string\">&quot;111&quot;</span>,<span class=\"string\">&quot;Sohan&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;Microsoft&quot;</span>, <span class=\"string\">&quot;112&quot;</span>,<span class=\"string\">&quot;Mohan&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;Microsoft&quot;</span>, <span class=\"string\">&quot;113&quot;</span>,<span class=\"string\">&quot;Rohan&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;TCS&quot;</span>, <span class=\"string\">&quot;121&quot;</span>,<span class=\"string\">&quot;Ram&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;TCS&quot;</span>, <span class=\"string\">&quot;122&quot;</span>,<span class=\"string\">&quot;Shyam&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;TCS&quot;</span>, <span class=\"string\">&quot;123&quot;</span>,<span class=\"string\">&quot;Sunil&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//get Map corresponding to IBM</span></span><br><span class=\"line\">      Map&lt;String,String&gt; ibmEmployees =  employeeTable.row(<span class=\"string\">&quot;IBM&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;List of IBM Employees&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(Map.Entry&lt;String, String&gt; entry : ibmEmployees.entrySet())&#123;</span><br><span class=\"line\">         System.out.println(<span class=\"string\">&quot;Emp Id: &quot;</span> + entry.getKey() + <span class=\"string\">&quot;, Name: &quot;</span> + entry.getValue());</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//get all the unique keys of the table</span></span><br><span class=\"line\">      Set&lt;String&gt; employers = employeeTable.rowKeySet();</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;Employers: &quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(String employer: employers)&#123;</span><br><span class=\"line\">         System.out.print(employer + <span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      System.out.println();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//get a Map corresponding to 102</span></span><br><span class=\"line\">      Map&lt;String,String&gt; EmployerMap =  employeeTable.column(<span class=\"string\">&quot;102&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(Map.Entry&lt;String, String&gt; entry : EmployerMap.entrySet())&#123;</span><br><span class=\"line\">         System.out.println(<span class=\"string\">&quot;Employer: &quot;</span> + entry.getKey() + <span class=\"string\">&quot;, Name: &quot;</span> + entry.getValue());</span><br><span class=\"line\">      &#125;\t\t</span><br><span class=\"line\">   &#125;\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"Guava-Table接口\"><a href=\"#Guava-Table接口\" class=\"headerlink\" title=\"Guava Table接口\"></a>Guava Table接口</h1><p>Table代表一个特殊的映射，其中两个键可以在组合的方式被指定为单个值。它类似于创建映射的映射。</p>\n<h2 id=\"接口声明\"><a href=\"#接口声明\" class=\"headerlink\" title=\"接口声明\"></a>接口声明</h2><p>以下是 com.google.common.collect.Table&lt;R，C，V&gt; 接口的声明：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@GwtCompatible</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Table</span>&lt;R,C,V&gt;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"接口方法\"><a href=\"#接口方法\" class=\"headerlink\" title=\"接口方法\"></a>接口方法</h2><table>\n<thead>\n<tr>\n<th>S.N.</th>\n<th>方法 &amp; 描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>1</td>\n<td><strong>Set&lt;Table.Cell&lt;R,C,V&gt;&gt; cellSet()</strong>              返回集合中的所有行键/列键/值三元组。</td>\n</tr>\n<tr>\n<td>2</td>\n<td><strong>void clear()</strong>              从表中删除所有映射。</td>\n</tr>\n<tr>\n<td>3</td>\n<td><strong>Map&lt;R,V&gt; column(C columnKey)</strong>              返回在给定列键的所有映射的视图。</td>\n</tr>\n<tr>\n<td>4</td>\n<td><strong>Set<C> columnKeySet()</strong>              返回一组具有表中的一个或多个值的列键。</td>\n</tr>\n<tr>\n<td>5</td>\n<td><strong>Map&lt;C,Map&lt;R,V&gt;&gt; columnMap()</strong>              返回关联的每一列键与行键对应的映射值的视图。</td>\n</tr>\n<tr>\n<td>6</td>\n<td><strong>boolean contains(Object rowKey, Object columnKey)</strong>              返回true，如果表中包含与指定的行和列键的映射。</td>\n</tr>\n<tr>\n<td>7</td>\n<td><strong>boolean containsColumn(Object columnKey)</strong>              返回true，如果表中包含与指定列的映射。</td>\n</tr>\n<tr>\n<td>8</td>\n<td><strong>boolean containsRow(Object rowKey)</strong>              返回true，如果表中包含与指定的行键的映射关系。</td>\n</tr>\n<tr>\n<td>9</td>\n<td><strong>boolean containsValue(Object value)</strong>              返回true，如果表中包含具有指定值的映射。</td>\n</tr>\n<tr>\n<td>10</td>\n<td><strong>boolean equals(Object obj)</strong>              比较指定对象与此表是否相等。</td>\n</tr>\n<tr>\n<td>11</td>\n<td><strong>V get(Object rowKey, Object columnKey)</strong>              返回对应于给定的行和列键，如果没有这样的映射存在值，返回null。</td>\n</tr>\n<tr>\n<td>12</td>\n<td><strong>int hashCode()</strong>              返回此表中的哈希码。</td>\n</tr>\n<tr>\n<td>13</td>\n<td><strong>boolean isEmpty()</strong>              返回true，如果表中没有映射。</td>\n</tr>\n<tr>\n<td>14</td>\n<td><strong>V put(R rowKey, C columnKey, V value)</strong>  关联指定值与指定键。</td>\n</tr>\n<tr>\n<td>15</td>\n<td><strong>void putAll(Table&lt;? extends R,? extends C,? extends V&gt; table)</strong>  复制从指定的表中的所有映射到这个表。</td>\n</tr>\n<tr>\n<td>16</td>\n<td><strong>V remove(Object rowKey, Object columnKey)</strong>      如果有的话，使用给定键相关联删除的映射。</td>\n</tr>\n<tr>\n<td>17</td>\n<td><strong>Map&lt;C,V&gt; row(R rowKey)</strong>  返回包含给定行键的所有映射的视图。</td>\n</tr>\n<tr>\n<td>18</td>\n<td><strong>Set<R> rowKeySet()</strong>      返回一组行键具有在表中的一个或多个值。</td>\n</tr>\n<tr>\n<td>19</td>\n<td><strong>Map&lt;R,Map&lt;C,V&gt;&gt; rowMap()</strong>  返回关联的每一行按键与键列对应的映射值的视图。</td>\n</tr>\n<tr>\n<td>20</td>\n<td><strong>int size()</strong>              返回行键/列键/表中的值映射关系的数量。</td>\n</tr>\n<tr>\n<td>21</td>\n<td><strong>Collection<V> values()</strong>  返回所有值，其中可能包含重复的集合。</td>\n</tr>\n</tbody></table>\n<h2 id=\"Table-例子\"><a href=\"#Table-例子\" class=\"headerlink\" title=\"Table 例子\"></a>Table 例子</h2><p>选择使用任何编辑器创建以下java程序在 <strong>C:/&gt; Guava</strong></p>\n<p><em>GuavaTester.java</em></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Set;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.HashBasedTable;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.google.common.collect.Table;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">GuavaTester</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String args[])</span>&#123;</span><br><span class=\"line\">      <span class=\"comment\">//Table&lt;R,C,V&gt; == Map&lt;R,Map&lt;C,V&gt;&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">      *  Company: IBM, Microsoft, TCS</span></span><br><span class=\"line\"><span class=\"comment\">      *  IBM \t\t-&gt; &#123;101:Mahesh, 102:Ramesh, 103:Suresh&#125;</span></span><br><span class=\"line\"><span class=\"comment\">      *  Microsoft \t-&gt; &#123;101:Sohan, 102:Mohan, 103:Rohan &#125; </span></span><br><span class=\"line\"><span class=\"comment\">      *  TCS \t\t-&gt; &#123;101:Ram, 102: Shyam, 103: Sunil &#125; </span></span><br><span class=\"line\"><span class=\"comment\">      * </span></span><br><span class=\"line\"><span class=\"comment\">      * */</span></span><br><span class=\"line\">      <span class=\"comment\">//create a table</span></span><br><span class=\"line\">      Table&lt;String, String, String&gt; employeeTable = HashBasedTable.create();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//initialize the table with employee details</span></span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;IBM&quot;</span>, <span class=\"string\">&quot;101&quot;</span>,<span class=\"string\">&quot;Mahesh&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;IBM&quot;</span>, <span class=\"string\">&quot;102&quot;</span>,<span class=\"string\">&quot;Ramesh&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;IBM&quot;</span>, <span class=\"string\">&quot;103&quot;</span>,<span class=\"string\">&quot;Suresh&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;Microsoft&quot;</span>, <span class=\"string\">&quot;111&quot;</span>,<span class=\"string\">&quot;Sohan&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;Microsoft&quot;</span>, <span class=\"string\">&quot;112&quot;</span>,<span class=\"string\">&quot;Mohan&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;Microsoft&quot;</span>, <span class=\"string\">&quot;113&quot;</span>,<span class=\"string\">&quot;Rohan&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;TCS&quot;</span>, <span class=\"string\">&quot;121&quot;</span>,<span class=\"string\">&quot;Ram&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;TCS&quot;</span>, <span class=\"string\">&quot;122&quot;</span>,<span class=\"string\">&quot;Shyam&quot;</span>);</span><br><span class=\"line\">      employeeTable.put(<span class=\"string\">&quot;TCS&quot;</span>, <span class=\"string\">&quot;123&quot;</span>,<span class=\"string\">&quot;Sunil&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//get Map corresponding to IBM</span></span><br><span class=\"line\">      Map&lt;String,String&gt; ibmEmployees =  employeeTable.row(<span class=\"string\">&quot;IBM&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot;List of IBM Employees&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(Map.Entry&lt;String, String&gt; entry : ibmEmployees.entrySet())&#123;</span><br><span class=\"line\">         System.out.println(<span class=\"string\">&quot;Emp Id: &quot;</span> + entry.getKey() + <span class=\"string\">&quot;, Name: &quot;</span> + entry.getValue());</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//get all the unique keys of the table</span></span><br><span class=\"line\">      Set&lt;String&gt; employers = employeeTable.rowKeySet();</span><br><span class=\"line\">      System.out.print(<span class=\"string\">&quot;Employers: &quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(String employer: employers)&#123;</span><br><span class=\"line\">         System.out.print(employer + <span class=\"string\">&quot; &quot;</span>);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      System.out.println();</span><br><span class=\"line\"></span><br><span class=\"line\">      <span class=\"comment\">//get a Map corresponding to 102</span></span><br><span class=\"line\">      Map&lt;String,String&gt; EmployerMap =  employeeTable.column(<span class=\"string\">&quot;102&quot;</span>);</span><br><span class=\"line\">      <span class=\"keyword\">for</span>(Map.Entry&lt;String, String&gt; entry : EmployerMap.entrySet())&#123;</span><br><span class=\"line\">         System.out.println(<span class=\"string\">&quot;Employer: &quot;</span> + entry.getKey() + <span class=\"string\">&quot;, Name: &quot;</span> + entry.getValue());</span><br><span class=\"line\">      &#125;\t\t</span><br><span class=\"line\">   &#125;\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n"},{"uuid":"bbaf6f20-c0ab-11ec-92a1-7557b2313227","title":"plantuml 思维导图","abbrlink":"d9642643","_content":"\n\n# [思维导图](https://plantuml.com/zh/mindmap-diagram)\n\n## OrgMode 语法\n\n同时兼容OrgMode语法。\n\n~~~\n@startmindmap\n* Debian\n** Ubuntu\n*** Linux Mint\n*** Kubuntu\n*** Lubuntu\n*** KDE Neon\n** LMDE\n** SolydXK\n** SteamOS\n** Raspbian with a very long name\n*** <s>Raspmbc</s> => OSMC\n*** <s>Raspyfi</s> => Volumio\n@endmindmap\n~~~\n\n![image-20211028140424528](https://raw.githubusercontent.com/xzyup/image/master/202203191700213.png)\n\n## Markdown语法\n\n~~~\n@startmindmap\n* root node\n\t* some first level node\n\t\t* second level node\n\t\t* another second level node\n\t* another first level node\n@endmindmap\n~~~\n\n![image-20211028140553231](https://raw.githubusercontent.com/xzyup/image/master/202203191700605.png)\n\n## 运算符\n\n你可以使用下面的运算符来决定图形方向\n\n~~~\n@startmindmap\n+ OS\n++ Ubuntu\n+++ Linux Mint\n+++ Kubuntu\n+++ Lubuntu\n+++ KDE Neon\n++ LMDE\n++ SolydXK\n++ SteamOS\n++ Raspbian\n-- Windows 95\n-- Windows 98\n-- Windows NT\n--- Windows 8\n--- Windows 10\n@endmindmap\n~~~\n\n![image-20211028140722407](https://raw.githubusercontent.com/xzyup/image/master/202203191700398.png)\n\n## Multilines\n\nYou can use `:` and `;` to have multilines box.\n\n~~~\n@startmindmap\n* Class Templates\n**:Example 1\n<code>\ntemplate <typename T>\nclass cname{\nvoid f1()<U+003B>\n...\n}\n</code>\n;\n**:Example 2\n<code>\nother template <typename T>\nclass cname{\n...\n</code>\n;\n@endmindmap\n~~~\n\n![image-20211028140848563](https://raw.githubusercontent.com/xzyup/image/master/202203191701547.png)\n\n~~~\n@startmindmap\n+ root\n**:right_1.1\nright_1.2;\n++ right_2\n\nleft side\n\n-- left_1\n-- left_2\n**:left_3.1\nleft_3.2;\n@endmindmap\n~~~\n\n![image-20211028140925260](https://raw.githubusercontent.com/xzyup/image/master/202203191701480.png)\n\n## Colors\n\nIt is possible to change node [color](https://plantuml.com/zh/color).\n\n### With inline color\n\n- OrgMode syntax mindmap\n\n  ~~~\n  @startmindmap\n  *[#Orange] Colors\n  **[#lightgreen] Green\n  **[#FFBBCC] Rose\n  **[#lightblue] Blue\n  @endmindmap\n  ~~~\n\n  ![image-20211028141140932](https://raw.githubusercontent.com/xzyup/image/master/202203191701909.png)\n\n- Arithmetic notation syntax mindmap\n\n  ~~~\n  @startmindmap\n  +[#Orange] Colors\n  ++[#lightgreen] Green\n  ++[#FFBBCC] Rose\n  --[#lightblue] Blue\n  @endmindmap\n  ~~~\n\n  ![image-20211028141246410](https://raw.githubusercontent.com/xzyup/image/master/202203191701869.png)\n\n- Markdown syntax mindmap\n\n  ~~~\n  @startmindmap\n  *[#Orange] root node\n   *[#lightgreen] some first level node\n    *[#FFBBCC] second level node\n    *[#lightblue] another second level node\n   *[#lightgreen] another first level node\n  @endmindmap\n  ~~~\n\n  ![image-20211028141350247](https://raw.githubusercontent.com/xzyup/image/master/202203191701376.png)\n\n\n\n### With style color\n\n- OrgMode syntax mindmap\n\n  ~~~\n  @startmindmap\n  <style>\n  mindmapDiagram {\n    .green {\n      BackgroundColor lightgreen\n    }\n    .rose {\n      BackgroundColor #FFBBCC\n    }\n    .your_style_name {\n      BackgroundColor lightblue\n    }\n  }\n  </style>\n  * Colors\n  ** Green <<green>>\n  ** Rose <<rose>>\n  ** Blue <<your_style_name>>\n  @endmindmap\n  ~~~\n\n  ![image-20211028141514810](https://raw.githubusercontent.com/xzyup/image/master/202203191701609.png)\n\n- Arithmetic notation syntax mindmap\n\n  ~~~\n  @startmindmap\n  <style>\n  mindmapDiagram {\n    .green {\n      BackgroundColor lightgreen\n    }\n    .rose {\n      BackgroundColor #FFBBCC\n    }\n    .your_style_name {\n      BackgroundColor lightblue\n    }\n  }\n  </style>\n  + Colors\n  ++ Green <<green>>\n  ++ Rose <<rose>>\n  -- Blue <<your_style_name>>\n  @endmindmap\n  ~~~\n\n  ![image-20211028141615812](https://raw.githubusercontent.com/xzyup/image/master/202203191701587.png)\n\n- Markdown syntax mindmap\n\n  ~~~\n  @startmindmap\n  <style>\n  mindmapDiagram {\n    .green {\n      BackgroundColor lightgreen\n    }\n    .rose {\n      BackgroundColor #FFBBCC\n    }\n    .your_style_name {\n      BackgroundColor lightblue\n    }\n  }\n  </style>\n  * root node\n   * some first level node <<green>>\n    * second level node <<rose>>\n    * another second level node <<your_style_name>>\n   * another first level node <<green>>\n  @endmindmap\n  ~~~\n\n  ![image-20211028141715479](https://raw.githubusercontent.com/xzyup/image/master/202203191701234.png)\n\n## 移除方框\n\n你可以用下划线移除方框图。\n\n~~~\n@startmindmap\n* root node\n** some first level node\n***_ second level node\n***_ another second level node\n***_ foo\n***_ bar\n***_ foobar\n** another first level node\n@endmindmap\n~~~\n\n![image-20211028141826325](https://raw.githubusercontent.com/xzyup/image/master/202203191702720.png)\n\n~~~\n@startmindmap\n*_ root node\n**_ some first level node\n***_ second level node\n***_ another second level node\n***_ foo\n***_ bar\n***_ foobar\n**_ another first level node\n@endmindmap\n~~~\n\n![image-20211028141936268](https://raw.githubusercontent.com/xzyup/image/master/202203191702558.png)\n\n~~~\n@startmindmap\n+ root node\n++ some first level node\n+++_ second level node\n+++_ another second level node\n+++_ foo\n+++_ bar\n+++_ foobar\n++_ another first level node\n-- some first right level node\n--_ another first right level node\n@endmindmap\n~~~\n\n![image-20211028142027306](https://raw.githubusercontent.com/xzyup/image/master/202203191702633.png)\n\n\n\n## 改变图形方向\n\n你可以同时使用图形的左右两侧。\n\n~~~\n@startmindmap\n* count\n** 100\n*** 101\n*** 102\n** 200\n\nleft side\n\n** A\n*** AA\n*** AB\n** B\n@endmindmap\n~~~\n\n![image-20211028142225270](https://raw.githubusercontent.com/xzyup/image/master/202203191702872.png)\n\n## 完整示例\n\n~~~\n@startmindmap\ncaption figure 1\ntitle My super title\n\n* <&flag>Debian\n** <&globe>Ubuntu\n*** Linux Mint\n*** Kubuntu\n*** Lubuntu\n*** KDE Neon\n** <&graph>LMDE\n** <&pulse>SolydXK\n** <&people>SteamOS\n** <&star>Raspbian with a very long name\n*** <s>Raspmbc</s> => OSMC\n*** <s>Raspyfi</s> => Volumio\n\nheader\nMy super header\nendheader\n\ncenter footer My super footer\n\nlegend right\n  Short\n  legend\nendlegend\n@endmindmap\n~~~\n\n![image-20211028142312553](https://raw.githubusercontent.com/xzyup/image/master/202203191702427.png)\n\n## 改变风格\n\n~~~\n@startmindmap\n<style>\nmindmapDiagram {\n    node {\n        BackgroundColor lightGreen\n    }\n    :depth(1) {\n      BackGroundColor white\n    }\n}\n</style>\n* Linux\n** NixOS\n** Debian\n*** Ubuntu\n**** Linux Mint\n**** Kubuntu\n**** Lubuntu\n**** KDE Neon\n@endmindmap\n~~~\n\n![image-20211028142457629](https://raw.githubusercontent.com/xzyup/image/master/202203191702086.png)\n\n### 无盒\n\n~~~\n@startmindmap\n<style>\nmindmapDiagram {\n  node {\n    BackgroundColor lightGreen\n  }\n  boxless {\n    FontColor darkgreen\n  }\n}\n</style>\n* Linux\n** NixOS\n** Debian\n***_ Ubuntu\n**** Linux Mint\n**** Kubuntu\n**** Lubuntu\n**** KDE Neon\n@endmindmap\n~~~\n\n![image-20211028142552979](https://raw.githubusercontent.com/xzyup/image/master/202203191702867.png)\n\n## Word Wrap\n\nUsing `MaximumWidth` setting you can control automatic word wrap. Unit used is pixel. \n\n~~~\n@startmindmap\n\n\n<style>\nnode {\n    Padding 12\n    Margin 3\n    HorizontalAlignment center\n    LineColor blue\n    LineThickness 3.0\n    BackgroundColor gold\n    RoundCorner 40\n    MaximumWidth 100\n}\n\nrootNode {\n    LineStyle 8.0;3.0\n    LineColor red\n    BackgroundColor white\n    LineThickness 1.0\n    RoundCorner 0\n    Shadowing 0.0\n}\n\nleafNode {\n    LineColor gold\n    RoundCorner 0\n    Padding 3\n}\n\narrow {\n    LineStyle 4\n    LineThickness 0.5\n    LineColor green\n}\n</style>\n\n* Hi =)\n** sometimes i have node in wich i want to write a long text\n*** this results in really huge diagram\n**** of course, i can explicit split with a\\nnew line\n**** but it could be cool if PlantUML was able to split long lines, maybe with an option \n\n@endmindmap\n~~~\n\n![image-20211028142657150](https://raw.githubusercontent.com/xzyup/image/master/202203191703508.png)\n","source":"_posts/uml/plantuml思维导图.md","raw":"---\nuuid: bbaf6f20-c0ab-11ec-92a1-7557b2313227\ntitle: plantuml 思维导图\ncategories: Uml\ntags:\n  - plantuml\nabbrlink: d9642643\n---\n\n\n# [思维导图](https://plantuml.com/zh/mindmap-diagram)\n\n## OrgMode 语法\n\n同时兼容OrgMode语法。\n\n~~~\n@startmindmap\n* Debian\n** Ubuntu\n*** Linux Mint\n*** Kubuntu\n*** Lubuntu\n*** KDE Neon\n** LMDE\n** SolydXK\n** SteamOS\n** Raspbian with a very long name\n*** <s>Raspmbc</s> => OSMC\n*** <s>Raspyfi</s> => Volumio\n@endmindmap\n~~~\n\n![image-20211028140424528](https://raw.githubusercontent.com/xzyup/image/master/202203191700213.png)\n\n## Markdown语法\n\n~~~\n@startmindmap\n* root node\n\t* some first level node\n\t\t* second level node\n\t\t* another second level node\n\t* another first level node\n@endmindmap\n~~~\n\n![image-20211028140553231](https://raw.githubusercontent.com/xzyup/image/master/202203191700605.png)\n\n## 运算符\n\n你可以使用下面的运算符来决定图形方向\n\n~~~\n@startmindmap\n+ OS\n++ Ubuntu\n+++ Linux Mint\n+++ Kubuntu\n+++ Lubuntu\n+++ KDE Neon\n++ LMDE\n++ SolydXK\n++ SteamOS\n++ Raspbian\n-- Windows 95\n-- Windows 98\n-- Windows NT\n--- Windows 8\n--- Windows 10\n@endmindmap\n~~~\n\n![image-20211028140722407](https://raw.githubusercontent.com/xzyup/image/master/202203191700398.png)\n\n## Multilines\n\nYou can use `:` and `;` to have multilines box.\n\n~~~\n@startmindmap\n* Class Templates\n**:Example 1\n<code>\ntemplate <typename T>\nclass cname{\nvoid f1()<U+003B>\n...\n}\n</code>\n;\n**:Example 2\n<code>\nother template <typename T>\nclass cname{\n...\n</code>\n;\n@endmindmap\n~~~\n\n![image-20211028140848563](https://raw.githubusercontent.com/xzyup/image/master/202203191701547.png)\n\n~~~\n@startmindmap\n+ root\n**:right_1.1\nright_1.2;\n++ right_2\n\nleft side\n\n-- left_1\n-- left_2\n**:left_3.1\nleft_3.2;\n@endmindmap\n~~~\n\n![image-20211028140925260](https://raw.githubusercontent.com/xzyup/image/master/202203191701480.png)\n\n## Colors\n\nIt is possible to change node [color](https://plantuml.com/zh/color).\n\n### With inline color\n\n- OrgMode syntax mindmap\n\n  ~~~\n  @startmindmap\n  *[#Orange] Colors\n  **[#lightgreen] Green\n  **[#FFBBCC] Rose\n  **[#lightblue] Blue\n  @endmindmap\n  ~~~\n\n  ![image-20211028141140932](https://raw.githubusercontent.com/xzyup/image/master/202203191701909.png)\n\n- Arithmetic notation syntax mindmap\n\n  ~~~\n  @startmindmap\n  +[#Orange] Colors\n  ++[#lightgreen] Green\n  ++[#FFBBCC] Rose\n  --[#lightblue] Blue\n  @endmindmap\n  ~~~\n\n  ![image-20211028141246410](https://raw.githubusercontent.com/xzyup/image/master/202203191701869.png)\n\n- Markdown syntax mindmap\n\n  ~~~\n  @startmindmap\n  *[#Orange] root node\n   *[#lightgreen] some first level node\n    *[#FFBBCC] second level node\n    *[#lightblue] another second level node\n   *[#lightgreen] another first level node\n  @endmindmap\n  ~~~\n\n  ![image-20211028141350247](https://raw.githubusercontent.com/xzyup/image/master/202203191701376.png)\n\n\n\n### With style color\n\n- OrgMode syntax mindmap\n\n  ~~~\n  @startmindmap\n  <style>\n  mindmapDiagram {\n    .green {\n      BackgroundColor lightgreen\n    }\n    .rose {\n      BackgroundColor #FFBBCC\n    }\n    .your_style_name {\n      BackgroundColor lightblue\n    }\n  }\n  </style>\n  * Colors\n  ** Green <<green>>\n  ** Rose <<rose>>\n  ** Blue <<your_style_name>>\n  @endmindmap\n  ~~~\n\n  ![image-20211028141514810](https://raw.githubusercontent.com/xzyup/image/master/202203191701609.png)\n\n- Arithmetic notation syntax mindmap\n\n  ~~~\n  @startmindmap\n  <style>\n  mindmapDiagram {\n    .green {\n      BackgroundColor lightgreen\n    }\n    .rose {\n      BackgroundColor #FFBBCC\n    }\n    .your_style_name {\n      BackgroundColor lightblue\n    }\n  }\n  </style>\n  + Colors\n  ++ Green <<green>>\n  ++ Rose <<rose>>\n  -- Blue <<your_style_name>>\n  @endmindmap\n  ~~~\n\n  ![image-20211028141615812](https://raw.githubusercontent.com/xzyup/image/master/202203191701587.png)\n\n- Markdown syntax mindmap\n\n  ~~~\n  @startmindmap\n  <style>\n  mindmapDiagram {\n    .green {\n      BackgroundColor lightgreen\n    }\n    .rose {\n      BackgroundColor #FFBBCC\n    }\n    .your_style_name {\n      BackgroundColor lightblue\n    }\n  }\n  </style>\n  * root node\n   * some first level node <<green>>\n    * second level node <<rose>>\n    * another second level node <<your_style_name>>\n   * another first level node <<green>>\n  @endmindmap\n  ~~~\n\n  ![image-20211028141715479](https://raw.githubusercontent.com/xzyup/image/master/202203191701234.png)\n\n## 移除方框\n\n你可以用下划线移除方框图。\n\n~~~\n@startmindmap\n* root node\n** some first level node\n***_ second level node\n***_ another second level node\n***_ foo\n***_ bar\n***_ foobar\n** another first level node\n@endmindmap\n~~~\n\n![image-20211028141826325](https://raw.githubusercontent.com/xzyup/image/master/202203191702720.png)\n\n~~~\n@startmindmap\n*_ root node\n**_ some first level node\n***_ second level node\n***_ another second level node\n***_ foo\n***_ bar\n***_ foobar\n**_ another first level node\n@endmindmap\n~~~\n\n![image-20211028141936268](https://raw.githubusercontent.com/xzyup/image/master/202203191702558.png)\n\n~~~\n@startmindmap\n+ root node\n++ some first level node\n+++_ second level node\n+++_ another second level node\n+++_ foo\n+++_ bar\n+++_ foobar\n++_ another first level node\n-- some first right level node\n--_ another first right level node\n@endmindmap\n~~~\n\n![image-20211028142027306](https://raw.githubusercontent.com/xzyup/image/master/202203191702633.png)\n\n\n\n## 改变图形方向\n\n你可以同时使用图形的左右两侧。\n\n~~~\n@startmindmap\n* count\n** 100\n*** 101\n*** 102\n** 200\n\nleft side\n\n** A\n*** AA\n*** AB\n** B\n@endmindmap\n~~~\n\n![image-20211028142225270](https://raw.githubusercontent.com/xzyup/image/master/202203191702872.png)\n\n## 完整示例\n\n~~~\n@startmindmap\ncaption figure 1\ntitle My super title\n\n* <&flag>Debian\n** <&globe>Ubuntu\n*** Linux Mint\n*** Kubuntu\n*** Lubuntu\n*** KDE Neon\n** <&graph>LMDE\n** <&pulse>SolydXK\n** <&people>SteamOS\n** <&star>Raspbian with a very long name\n*** <s>Raspmbc</s> => OSMC\n*** <s>Raspyfi</s> => Volumio\n\nheader\nMy super header\nendheader\n\ncenter footer My super footer\n\nlegend right\n  Short\n  legend\nendlegend\n@endmindmap\n~~~\n\n![image-20211028142312553](https://raw.githubusercontent.com/xzyup/image/master/202203191702427.png)\n\n## 改变风格\n\n~~~\n@startmindmap\n<style>\nmindmapDiagram {\n    node {\n        BackgroundColor lightGreen\n    }\n    :depth(1) {\n      BackGroundColor white\n    }\n}\n</style>\n* Linux\n** NixOS\n** Debian\n*** Ubuntu\n**** Linux Mint\n**** Kubuntu\n**** Lubuntu\n**** KDE Neon\n@endmindmap\n~~~\n\n![image-20211028142457629](https://raw.githubusercontent.com/xzyup/image/master/202203191702086.png)\n\n### 无盒\n\n~~~\n@startmindmap\n<style>\nmindmapDiagram {\n  node {\n    BackgroundColor lightGreen\n  }\n  boxless {\n    FontColor darkgreen\n  }\n}\n</style>\n* Linux\n** NixOS\n** Debian\n***_ Ubuntu\n**** Linux Mint\n**** Kubuntu\n**** Lubuntu\n**** KDE Neon\n@endmindmap\n~~~\n\n![image-20211028142552979](https://raw.githubusercontent.com/xzyup/image/master/202203191702867.png)\n\n## Word Wrap\n\nUsing `MaximumWidth` setting you can control automatic word wrap. Unit used is pixel. \n\n~~~\n@startmindmap\n\n\n<style>\nnode {\n    Padding 12\n    Margin 3\n    HorizontalAlignment center\n    LineColor blue\n    LineThickness 3.0\n    BackgroundColor gold\n    RoundCorner 40\n    MaximumWidth 100\n}\n\nrootNode {\n    LineStyle 8.0;3.0\n    LineColor red\n    BackgroundColor white\n    LineThickness 1.0\n    RoundCorner 0\n    Shadowing 0.0\n}\n\nleafNode {\n    LineColor gold\n    RoundCorner 0\n    Padding 3\n}\n\narrow {\n    LineStyle 4\n    LineThickness 0.5\n    LineColor green\n}\n</style>\n\n* Hi =)\n** sometimes i have node in wich i want to write a long text\n*** this results in really huge diagram\n**** of course, i can explicit split with a\\nnew line\n**** but it could be cool if PlantUML was able to split long lines, maybe with an option \n\n@endmindmap\n~~~\n\n![image-20211028142657150](https://raw.githubusercontent.com/xzyup/image/master/202203191703508.png)\n","slug":"uml/plantuml思维导图","published":1,"date":"2022-04-20T12:41:20.808Z","updated":"2022-05-04T03:24:16.754Z","_id":"cl2qzftil005q13noh9jv383b","comments":1,"layout":"post","photos":[],"link":"","content":"<h1 id=\"思维导图\"><a href=\"#思维导图\" class=\"headerlink\" title=\"思维导图\"></a><a href=\"https://plantuml.com/zh/mindmap-diagram\">思维导图</a></h1><h2 id=\"OrgMode-语法\"><a href=\"#OrgMode-语法\" class=\"headerlink\" title=\"OrgMode 语法\"></a>OrgMode 语法</h2><p>同时兼容OrgMode语法。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">* Debian</span><br><span class=\"line\">** Ubuntu</span><br><span class=\"line\">*** Linux Mint</span><br><span class=\"line\">*** Kubuntu</span><br><span class=\"line\">*** Lubuntu</span><br><span class=\"line\">*** KDE Neon</span><br><span class=\"line\">** LMDE</span><br><span class=\"line\">** SolydXK</span><br><span class=\"line\">** SteamOS</span><br><span class=\"line\">** Raspbian with a very long name</span><br><span class=\"line\">*** &lt;s&gt;Raspmbc&lt;/s&gt; =&gt; OSMC</span><br><span class=\"line\">*** &lt;s&gt;Raspyfi&lt;/s&gt; =&gt; Volumio</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700213.png\" alt=\"image-20211028140424528\"></p>\n<h2 id=\"Markdown语法\"><a href=\"#Markdown语法\" class=\"headerlink\" title=\"Markdown语法\"></a>Markdown语法</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">* root node</span><br><span class=\"line\">\t* some first level node</span><br><span class=\"line\">\t\t* second level node</span><br><span class=\"line\">\t\t* another second level node</span><br><span class=\"line\">\t* another first level node</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700605.png\" alt=\"image-20211028140553231\"></p>\n<h2 id=\"运算符\"><a href=\"#运算符\" class=\"headerlink\" title=\"运算符\"></a>运算符</h2><p>你可以使用下面的运算符来决定图形方向</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">+ OS</span><br><span class=\"line\">++ Ubuntu</span><br><span class=\"line\">+++ Linux Mint</span><br><span class=\"line\">+++ Kubuntu</span><br><span class=\"line\">+++ Lubuntu</span><br><span class=\"line\">+++ KDE Neon</span><br><span class=\"line\">++ LMDE</span><br><span class=\"line\">++ SolydXK</span><br><span class=\"line\">++ SteamOS</span><br><span class=\"line\">++ Raspbian</span><br><span class=\"line\">-- Windows 95</span><br><span class=\"line\">-- Windows 98</span><br><span class=\"line\">-- Windows NT</span><br><span class=\"line\">--- Windows 8</span><br><span class=\"line\">--- Windows 10</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700398.png\" alt=\"image-20211028140722407\"></p>\n<h2 id=\"Multilines\"><a href=\"#Multilines\" class=\"headerlink\" title=\"Multilines\"></a>Multilines</h2><p>You can use <code>:</code> and <code>;</code> to have multilines box.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">* Class Templates</span><br><span class=\"line\">**:Example 1</span><br><span class=\"line\">&lt;code&gt;</span><br><span class=\"line\">template &lt;typename T&gt;</span><br><span class=\"line\">class cname&#123;</span><br><span class=\"line\">void f1()&lt;U+003B&gt;</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/code&gt;</span><br><span class=\"line\">;</span><br><span class=\"line\">**:Example 2</span><br><span class=\"line\">&lt;code&gt;</span><br><span class=\"line\">other template &lt;typename T&gt;</span><br><span class=\"line\">class cname&#123;</span><br><span class=\"line\">...</span><br><span class=\"line\">&lt;/code&gt;</span><br><span class=\"line\">;</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701547.png\" alt=\"image-20211028140848563\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">+ root</span><br><span class=\"line\">**:right_1.1</span><br><span class=\"line\">right_1.2;</span><br><span class=\"line\">++ right_2</span><br><span class=\"line\"></span><br><span class=\"line\">left side</span><br><span class=\"line\"></span><br><span class=\"line\">-- left_1</span><br><span class=\"line\">-- left_2</span><br><span class=\"line\">**:left_3.1</span><br><span class=\"line\">left_3.2;</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701480.png\" alt=\"image-20211028140925260\"></p>\n<h2 id=\"Colors\"><a href=\"#Colors\" class=\"headerlink\" title=\"Colors\"></a>Colors</h2><p>It is possible to change node <a href=\"https://plantuml.com/zh/color\">color</a>.</p>\n<h3 id=\"With-inline-color\"><a href=\"#With-inline-color\" class=\"headerlink\" title=\"With inline color\"></a>With inline color</h3><ul>\n<li><p>OrgMode syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">*[#Orange] Colors</span><br><span class=\"line\">**[#lightgreen] Green</span><br><span class=\"line\">**[#FFBBCC] Rose</span><br><span class=\"line\">**[#lightblue] Blue</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701909.png\" alt=\"image-20211028141140932\"></p>\n</li>\n<li><p>Arithmetic notation syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">+[#Orange] Colors</span><br><span class=\"line\">++[#lightgreen] Green</span><br><span class=\"line\">++[#FFBBCC] Rose</span><br><span class=\"line\">--[#lightblue] Blue</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701869.png\" alt=\"image-20211028141246410\"></p>\n</li>\n<li><p>Markdown syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">*[#Orange] root node</span><br><span class=\"line\"> *[#lightgreen] some first level node</span><br><span class=\"line\">  *[#FFBBCC] second level node</span><br><span class=\"line\">  *[#lightblue] another second level node</span><br><span class=\"line\"> *[#lightgreen] another first level node</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701376.png\" alt=\"image-20211028141350247\"></p>\n</li>\n</ul>\n<h3 id=\"With-style-color\"><a href=\"#With-style-color\" class=\"headerlink\" title=\"With style color\"></a>With style color</h3><ul>\n<li><p>OrgMode syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">mindmapDiagram &#123;</span><br><span class=\"line\">  .green &#123;</span><br><span class=\"line\">    BackgroundColor lightgreen</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .rose &#123;</span><br><span class=\"line\">    BackgroundColor #FFBBCC</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .your_style_name &#123;</span><br><span class=\"line\">    BackgroundColor lightblue</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">* Colors</span><br><span class=\"line\">** Green &lt;&lt;green&gt;&gt;</span><br><span class=\"line\">** Rose &lt;&lt;rose&gt;&gt;</span><br><span class=\"line\">** Blue &lt;&lt;your_style_name&gt;&gt;</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701609.png\" alt=\"image-20211028141514810\"></p>\n</li>\n<li><p>Arithmetic notation syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">mindmapDiagram &#123;</span><br><span class=\"line\">  .green &#123;</span><br><span class=\"line\">    BackgroundColor lightgreen</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .rose &#123;</span><br><span class=\"line\">    BackgroundColor #FFBBCC</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .your_style_name &#123;</span><br><span class=\"line\">    BackgroundColor lightblue</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">+ Colors</span><br><span class=\"line\">++ Green &lt;&lt;green&gt;&gt;</span><br><span class=\"line\">++ Rose &lt;&lt;rose&gt;&gt;</span><br><span class=\"line\">-- Blue &lt;&lt;your_style_name&gt;&gt;</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701587.png\" alt=\"image-20211028141615812\"></p>\n</li>\n<li><p>Markdown syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">mindmapDiagram &#123;</span><br><span class=\"line\">  .green &#123;</span><br><span class=\"line\">    BackgroundColor lightgreen</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .rose &#123;</span><br><span class=\"line\">    BackgroundColor #FFBBCC</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .your_style_name &#123;</span><br><span class=\"line\">    BackgroundColor lightblue</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">* root node</span><br><span class=\"line\"> * some first level node &lt;&lt;green&gt;&gt;</span><br><span class=\"line\">  * second level node &lt;&lt;rose&gt;&gt;</span><br><span class=\"line\">  * another second level node &lt;&lt;your_style_name&gt;&gt;</span><br><span class=\"line\"> * another first level node &lt;&lt;green&gt;&gt;</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701234.png\" alt=\"image-20211028141715479\"></p>\n</li>\n</ul>\n<h2 id=\"移除方框\"><a href=\"#移除方框\" class=\"headerlink\" title=\"移除方框\"></a>移除方框</h2><p>你可以用下划线移除方框图。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">* root node</span><br><span class=\"line\">** some first level node</span><br><span class=\"line\">***_ second level node</span><br><span class=\"line\">***_ another second level node</span><br><span class=\"line\">***_ foo</span><br><span class=\"line\">***_ bar</span><br><span class=\"line\">***_ foobar</span><br><span class=\"line\">** another first level node</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702720.png\" alt=\"image-20211028141826325\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">*_ root node</span><br><span class=\"line\">**_ some first level node</span><br><span class=\"line\">***_ second level node</span><br><span class=\"line\">***_ another second level node</span><br><span class=\"line\">***_ foo</span><br><span class=\"line\">***_ bar</span><br><span class=\"line\">***_ foobar</span><br><span class=\"line\">**_ another first level node</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702558.png\" alt=\"image-20211028141936268\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">+ root node</span><br><span class=\"line\">++ some first level node</span><br><span class=\"line\">+++_ second level node</span><br><span class=\"line\">+++_ another second level node</span><br><span class=\"line\">+++_ foo</span><br><span class=\"line\">+++_ bar</span><br><span class=\"line\">+++_ foobar</span><br><span class=\"line\">++_ another first level node</span><br><span class=\"line\">-- some first right level node</span><br><span class=\"line\">--_ another first right level node</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702633.png\" alt=\"image-20211028142027306\"></p>\n<h2 id=\"改变图形方向\"><a href=\"#改变图形方向\" class=\"headerlink\" title=\"改变图形方向\"></a>改变图形方向</h2><p>你可以同时使用图形的左右两侧。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">* count</span><br><span class=\"line\">** 100</span><br><span class=\"line\">*** 101</span><br><span class=\"line\">*** 102</span><br><span class=\"line\">** 200</span><br><span class=\"line\"></span><br><span class=\"line\">left side</span><br><span class=\"line\"></span><br><span class=\"line\">** A</span><br><span class=\"line\">*** AA</span><br><span class=\"line\">*** AB</span><br><span class=\"line\">** B</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702872.png\" alt=\"image-20211028142225270\"></p>\n<h2 id=\"完整示例\"><a href=\"#完整示例\" class=\"headerlink\" title=\"完整示例\"></a>完整示例</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">caption figure 1</span><br><span class=\"line\">title My super title</span><br><span class=\"line\"></span><br><span class=\"line\">* &lt;&amp;flag&gt;Debian</span><br><span class=\"line\">** &lt;&amp;globe&gt;Ubuntu</span><br><span class=\"line\">*** Linux Mint</span><br><span class=\"line\">*** Kubuntu</span><br><span class=\"line\">*** Lubuntu</span><br><span class=\"line\">*** KDE Neon</span><br><span class=\"line\">** &lt;&amp;graph&gt;LMDE</span><br><span class=\"line\">** &lt;&amp;pulse&gt;SolydXK</span><br><span class=\"line\">** &lt;&amp;people&gt;SteamOS</span><br><span class=\"line\">** &lt;&amp;star&gt;Raspbian with a very long name</span><br><span class=\"line\">*** &lt;s&gt;Raspmbc&lt;/s&gt; =&gt; OSMC</span><br><span class=\"line\">*** &lt;s&gt;Raspyfi&lt;/s&gt; =&gt; Volumio</span><br><span class=\"line\"></span><br><span class=\"line\">header</span><br><span class=\"line\">My super header</span><br><span class=\"line\">endheader</span><br><span class=\"line\"></span><br><span class=\"line\">center footer My super footer</span><br><span class=\"line\"></span><br><span class=\"line\">legend right</span><br><span class=\"line\">  Short</span><br><span class=\"line\">  legend</span><br><span class=\"line\">endlegend</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702427.png\" alt=\"image-20211028142312553\"></p>\n<h2 id=\"改变风格\"><a href=\"#改变风格\" class=\"headerlink\" title=\"改变风格\"></a>改变风格</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">mindmapDiagram &#123;</span><br><span class=\"line\">    node &#123;</span><br><span class=\"line\">        BackgroundColor lightGreen</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    :depth(1) &#123;</span><br><span class=\"line\">      BackGroundColor white</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">* Linux</span><br><span class=\"line\">** NixOS</span><br><span class=\"line\">** Debian</span><br><span class=\"line\">*** Ubuntu</span><br><span class=\"line\">**** Linux Mint</span><br><span class=\"line\">**** Kubuntu</span><br><span class=\"line\">**** Lubuntu</span><br><span class=\"line\">**** KDE Neon</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702086.png\" alt=\"image-20211028142457629\"></p>\n<h3 id=\"无盒\"><a href=\"#无盒\" class=\"headerlink\" title=\"无盒\"></a>无盒</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">mindmapDiagram &#123;</span><br><span class=\"line\">  node &#123;</span><br><span class=\"line\">    BackgroundColor lightGreen</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  boxless &#123;</span><br><span class=\"line\">    FontColor darkgreen</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">* Linux</span><br><span class=\"line\">** NixOS</span><br><span class=\"line\">** Debian</span><br><span class=\"line\">***_ Ubuntu</span><br><span class=\"line\">**** Linux Mint</span><br><span class=\"line\">**** Kubuntu</span><br><span class=\"line\">**** Lubuntu</span><br><span class=\"line\">**** KDE Neon</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702867.png\" alt=\"image-20211028142552979\"></p>\n<h2 id=\"Word-Wrap\"><a href=\"#Word-Wrap\" class=\"headerlink\" title=\"Word Wrap\"></a>Word Wrap</h2><p>Using <code>MaximumWidth</code> setting you can control automatic word wrap. Unit used is pixel. </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">node &#123;</span><br><span class=\"line\">    Padding 12</span><br><span class=\"line\">    Margin 3</span><br><span class=\"line\">    HorizontalAlignment center</span><br><span class=\"line\">    LineColor blue</span><br><span class=\"line\">    LineThickness 3.0</span><br><span class=\"line\">    BackgroundColor gold</span><br><span class=\"line\">    RoundCorner 40</span><br><span class=\"line\">    MaximumWidth 100</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">rootNode &#123;</span><br><span class=\"line\">    LineStyle 8.0;3.0</span><br><span class=\"line\">    LineColor red</span><br><span class=\"line\">    BackgroundColor white</span><br><span class=\"line\">    LineThickness 1.0</span><br><span class=\"line\">    RoundCorner 0</span><br><span class=\"line\">    Shadowing 0.0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">leafNode &#123;</span><br><span class=\"line\">    LineColor gold</span><br><span class=\"line\">    RoundCorner 0</span><br><span class=\"line\">    Padding 3</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">arrow &#123;</span><br><span class=\"line\">    LineStyle 4</span><br><span class=\"line\">    LineThickness 0.5</span><br><span class=\"line\">    LineColor green</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">* Hi =)</span><br><span class=\"line\">** sometimes i have node in wich i want to write a long text</span><br><span class=\"line\">*** this results in really huge diagram</span><br><span class=\"line\">**** of course, i can explicit split with a\\nnew line</span><br><span class=\"line\">**** but it could be cool if PlantUML was able to split long lines, maybe with an option </span><br><span class=\"line\"></span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191703508.png\" alt=\"image-20211028142657150\"></p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h1 id=\"思维导图\"><a href=\"#思维导图\" class=\"headerlink\" title=\"思维导图\"></a><a href=\"https://plantuml.com/zh/mindmap-diagram\">思维导图</a></h1><h2 id=\"OrgMode-语法\"><a href=\"#OrgMode-语法\" class=\"headerlink\" title=\"OrgMode 语法\"></a>OrgMode 语法</h2><p>同时兼容OrgMode语法。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">* Debian</span><br><span class=\"line\">** Ubuntu</span><br><span class=\"line\">*** Linux Mint</span><br><span class=\"line\">*** Kubuntu</span><br><span class=\"line\">*** Lubuntu</span><br><span class=\"line\">*** KDE Neon</span><br><span class=\"line\">** LMDE</span><br><span class=\"line\">** SolydXK</span><br><span class=\"line\">** SteamOS</span><br><span class=\"line\">** Raspbian with a very long name</span><br><span class=\"line\">*** &lt;s&gt;Raspmbc&lt;/s&gt; =&gt; OSMC</span><br><span class=\"line\">*** &lt;s&gt;Raspyfi&lt;/s&gt; =&gt; Volumio</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700213.png\" alt=\"image-20211028140424528\"></p>\n<h2 id=\"Markdown语法\"><a href=\"#Markdown语法\" class=\"headerlink\" title=\"Markdown语法\"></a>Markdown语法</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">* root node</span><br><span class=\"line\">\t* some first level node</span><br><span class=\"line\">\t\t* second level node</span><br><span class=\"line\">\t\t* another second level node</span><br><span class=\"line\">\t* another first level node</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700605.png\" alt=\"image-20211028140553231\"></p>\n<h2 id=\"运算符\"><a href=\"#运算符\" class=\"headerlink\" title=\"运算符\"></a>运算符</h2><p>你可以使用下面的运算符来决定图形方向</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">+ OS</span><br><span class=\"line\">++ Ubuntu</span><br><span class=\"line\">+++ Linux Mint</span><br><span class=\"line\">+++ Kubuntu</span><br><span class=\"line\">+++ Lubuntu</span><br><span class=\"line\">+++ KDE Neon</span><br><span class=\"line\">++ LMDE</span><br><span class=\"line\">++ SolydXK</span><br><span class=\"line\">++ SteamOS</span><br><span class=\"line\">++ Raspbian</span><br><span class=\"line\">-- Windows 95</span><br><span class=\"line\">-- Windows 98</span><br><span class=\"line\">-- Windows NT</span><br><span class=\"line\">--- Windows 8</span><br><span class=\"line\">--- Windows 10</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191700398.png\" alt=\"image-20211028140722407\"></p>\n<h2 id=\"Multilines\"><a href=\"#Multilines\" class=\"headerlink\" title=\"Multilines\"></a>Multilines</h2><p>You can use <code>:</code> and <code>;</code> to have multilines box.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">* Class Templates</span><br><span class=\"line\">**:Example 1</span><br><span class=\"line\">&lt;code&gt;</span><br><span class=\"line\">template &lt;typename T&gt;</span><br><span class=\"line\">class cname&#123;</span><br><span class=\"line\">void f1()&lt;U+003B&gt;</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/code&gt;</span><br><span class=\"line\">;</span><br><span class=\"line\">**:Example 2</span><br><span class=\"line\">&lt;code&gt;</span><br><span class=\"line\">other template &lt;typename T&gt;</span><br><span class=\"line\">class cname&#123;</span><br><span class=\"line\">...</span><br><span class=\"line\">&lt;/code&gt;</span><br><span class=\"line\">;</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701547.png\" alt=\"image-20211028140848563\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">+ root</span><br><span class=\"line\">**:right_1.1</span><br><span class=\"line\">right_1.2;</span><br><span class=\"line\">++ right_2</span><br><span class=\"line\"></span><br><span class=\"line\">left side</span><br><span class=\"line\"></span><br><span class=\"line\">-- left_1</span><br><span class=\"line\">-- left_2</span><br><span class=\"line\">**:left_3.1</span><br><span class=\"line\">left_3.2;</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701480.png\" alt=\"image-20211028140925260\"></p>\n<h2 id=\"Colors\"><a href=\"#Colors\" class=\"headerlink\" title=\"Colors\"></a>Colors</h2><p>It is possible to change node <a href=\"https://plantuml.com/zh/color\">color</a>.</p>\n<h3 id=\"With-inline-color\"><a href=\"#With-inline-color\" class=\"headerlink\" title=\"With inline color\"></a>With inline color</h3><ul>\n<li><p>OrgMode syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">*[#Orange] Colors</span><br><span class=\"line\">**[#lightgreen] Green</span><br><span class=\"line\">**[#FFBBCC] Rose</span><br><span class=\"line\">**[#lightblue] Blue</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701909.png\" alt=\"image-20211028141140932\"></p>\n</li>\n<li><p>Arithmetic notation syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">+[#Orange] Colors</span><br><span class=\"line\">++[#lightgreen] Green</span><br><span class=\"line\">++[#FFBBCC] Rose</span><br><span class=\"line\">--[#lightblue] Blue</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701869.png\" alt=\"image-20211028141246410\"></p>\n</li>\n<li><p>Markdown syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">*[#Orange] root node</span><br><span class=\"line\"> *[#lightgreen] some first level node</span><br><span class=\"line\">  *[#FFBBCC] second level node</span><br><span class=\"line\">  *[#lightblue] another second level node</span><br><span class=\"line\"> *[#lightgreen] another first level node</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701376.png\" alt=\"image-20211028141350247\"></p>\n</li>\n</ul>\n<h3 id=\"With-style-color\"><a href=\"#With-style-color\" class=\"headerlink\" title=\"With style color\"></a>With style color</h3><ul>\n<li><p>OrgMode syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">mindmapDiagram &#123;</span><br><span class=\"line\">  .green &#123;</span><br><span class=\"line\">    BackgroundColor lightgreen</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .rose &#123;</span><br><span class=\"line\">    BackgroundColor #FFBBCC</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .your_style_name &#123;</span><br><span class=\"line\">    BackgroundColor lightblue</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">* Colors</span><br><span class=\"line\">** Green &lt;&lt;green&gt;&gt;</span><br><span class=\"line\">** Rose &lt;&lt;rose&gt;&gt;</span><br><span class=\"line\">** Blue &lt;&lt;your_style_name&gt;&gt;</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701609.png\" alt=\"image-20211028141514810\"></p>\n</li>\n<li><p>Arithmetic notation syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">mindmapDiagram &#123;</span><br><span class=\"line\">  .green &#123;</span><br><span class=\"line\">    BackgroundColor lightgreen</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .rose &#123;</span><br><span class=\"line\">    BackgroundColor #FFBBCC</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .your_style_name &#123;</span><br><span class=\"line\">    BackgroundColor lightblue</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">+ Colors</span><br><span class=\"line\">++ Green &lt;&lt;green&gt;&gt;</span><br><span class=\"line\">++ Rose &lt;&lt;rose&gt;&gt;</span><br><span class=\"line\">-- Blue &lt;&lt;your_style_name&gt;&gt;</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701587.png\" alt=\"image-20211028141615812\"></p>\n</li>\n<li><p>Markdown syntax mindmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">mindmapDiagram &#123;</span><br><span class=\"line\">  .green &#123;</span><br><span class=\"line\">    BackgroundColor lightgreen</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .rose &#123;</span><br><span class=\"line\">    BackgroundColor #FFBBCC</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  .your_style_name &#123;</span><br><span class=\"line\">    BackgroundColor lightblue</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">* root node</span><br><span class=\"line\"> * some first level node &lt;&lt;green&gt;&gt;</span><br><span class=\"line\">  * second level node &lt;&lt;rose&gt;&gt;</span><br><span class=\"line\">  * another second level node &lt;&lt;your_style_name&gt;&gt;</span><br><span class=\"line\"> * another first level node &lt;&lt;green&gt;&gt;</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191701234.png\" alt=\"image-20211028141715479\"></p>\n</li>\n</ul>\n<h2 id=\"移除方框\"><a href=\"#移除方框\" class=\"headerlink\" title=\"移除方框\"></a>移除方框</h2><p>你可以用下划线移除方框图。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">* root node</span><br><span class=\"line\">** some first level node</span><br><span class=\"line\">***_ second level node</span><br><span class=\"line\">***_ another second level node</span><br><span class=\"line\">***_ foo</span><br><span class=\"line\">***_ bar</span><br><span class=\"line\">***_ foobar</span><br><span class=\"line\">** another first level node</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702720.png\" alt=\"image-20211028141826325\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">*_ root node</span><br><span class=\"line\">**_ some first level node</span><br><span class=\"line\">***_ second level node</span><br><span class=\"line\">***_ another second level node</span><br><span class=\"line\">***_ foo</span><br><span class=\"line\">***_ bar</span><br><span class=\"line\">***_ foobar</span><br><span class=\"line\">**_ another first level node</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702558.png\" alt=\"image-20211028141936268\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">+ root node</span><br><span class=\"line\">++ some first level node</span><br><span class=\"line\">+++_ second level node</span><br><span class=\"line\">+++_ another second level node</span><br><span class=\"line\">+++_ foo</span><br><span class=\"line\">+++_ bar</span><br><span class=\"line\">+++_ foobar</span><br><span class=\"line\">++_ another first level node</span><br><span class=\"line\">-- some first right level node</span><br><span class=\"line\">--_ another first right level node</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702633.png\" alt=\"image-20211028142027306\"></p>\n<h2 id=\"改变图形方向\"><a href=\"#改变图形方向\" class=\"headerlink\" title=\"改变图形方向\"></a>改变图形方向</h2><p>你可以同时使用图形的左右两侧。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">* count</span><br><span class=\"line\">** 100</span><br><span class=\"line\">*** 101</span><br><span class=\"line\">*** 102</span><br><span class=\"line\">** 200</span><br><span class=\"line\"></span><br><span class=\"line\">left side</span><br><span class=\"line\"></span><br><span class=\"line\">** A</span><br><span class=\"line\">*** AA</span><br><span class=\"line\">*** AB</span><br><span class=\"line\">** B</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702872.png\" alt=\"image-20211028142225270\"></p>\n<h2 id=\"完整示例\"><a href=\"#完整示例\" class=\"headerlink\" title=\"完整示例\"></a>完整示例</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">caption figure 1</span><br><span class=\"line\">title My super title</span><br><span class=\"line\"></span><br><span class=\"line\">* &lt;&amp;flag&gt;Debian</span><br><span class=\"line\">** &lt;&amp;globe&gt;Ubuntu</span><br><span class=\"line\">*** Linux Mint</span><br><span class=\"line\">*** Kubuntu</span><br><span class=\"line\">*** Lubuntu</span><br><span class=\"line\">*** KDE Neon</span><br><span class=\"line\">** &lt;&amp;graph&gt;LMDE</span><br><span class=\"line\">** &lt;&amp;pulse&gt;SolydXK</span><br><span class=\"line\">** &lt;&amp;people&gt;SteamOS</span><br><span class=\"line\">** &lt;&amp;star&gt;Raspbian with a very long name</span><br><span class=\"line\">*** &lt;s&gt;Raspmbc&lt;/s&gt; =&gt; OSMC</span><br><span class=\"line\">*** &lt;s&gt;Raspyfi&lt;/s&gt; =&gt; Volumio</span><br><span class=\"line\"></span><br><span class=\"line\">header</span><br><span class=\"line\">My super header</span><br><span class=\"line\">endheader</span><br><span class=\"line\"></span><br><span class=\"line\">center footer My super footer</span><br><span class=\"line\"></span><br><span class=\"line\">legend right</span><br><span class=\"line\">  Short</span><br><span class=\"line\">  legend</span><br><span class=\"line\">endlegend</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702427.png\" alt=\"image-20211028142312553\"></p>\n<h2 id=\"改变风格\"><a href=\"#改变风格\" class=\"headerlink\" title=\"改变风格\"></a>改变风格</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">mindmapDiagram &#123;</span><br><span class=\"line\">    node &#123;</span><br><span class=\"line\">        BackgroundColor lightGreen</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    :depth(1) &#123;</span><br><span class=\"line\">      BackGroundColor white</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">* Linux</span><br><span class=\"line\">** NixOS</span><br><span class=\"line\">** Debian</span><br><span class=\"line\">*** Ubuntu</span><br><span class=\"line\">**** Linux Mint</span><br><span class=\"line\">**** Kubuntu</span><br><span class=\"line\">**** Lubuntu</span><br><span class=\"line\">**** KDE Neon</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702086.png\" alt=\"image-20211028142457629\"></p>\n<h3 id=\"无盒\"><a href=\"#无盒\" class=\"headerlink\" title=\"无盒\"></a>无盒</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">mindmapDiagram &#123;</span><br><span class=\"line\">  node &#123;</span><br><span class=\"line\">    BackgroundColor lightGreen</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  boxless &#123;</span><br><span class=\"line\">    FontColor darkgreen</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\">* Linux</span><br><span class=\"line\">** NixOS</span><br><span class=\"line\">** Debian</span><br><span class=\"line\">***_ Ubuntu</span><br><span class=\"line\">**** Linux Mint</span><br><span class=\"line\">**** Kubuntu</span><br><span class=\"line\">**** Lubuntu</span><br><span class=\"line\">**** KDE Neon</span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191702867.png\" alt=\"image-20211028142552979\"></p>\n<h2 id=\"Word-Wrap\"><a href=\"#Word-Wrap\" class=\"headerlink\" title=\"Word Wrap\"></a>Word Wrap</h2><p>Using <code>MaximumWidth</code> setting you can control automatic word wrap. Unit used is pixel. </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@startmindmap</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">node &#123;</span><br><span class=\"line\">    Padding 12</span><br><span class=\"line\">    Margin 3</span><br><span class=\"line\">    HorizontalAlignment center</span><br><span class=\"line\">    LineColor blue</span><br><span class=\"line\">    LineThickness 3.0</span><br><span class=\"line\">    BackgroundColor gold</span><br><span class=\"line\">    RoundCorner 40</span><br><span class=\"line\">    MaximumWidth 100</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">rootNode &#123;</span><br><span class=\"line\">    LineStyle 8.0;3.0</span><br><span class=\"line\">    LineColor red</span><br><span class=\"line\">    BackgroundColor white</span><br><span class=\"line\">    LineThickness 1.0</span><br><span class=\"line\">    RoundCorner 0</span><br><span class=\"line\">    Shadowing 0.0</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">leafNode &#123;</span><br><span class=\"line\">    LineColor gold</span><br><span class=\"line\">    RoundCorner 0</span><br><span class=\"line\">    Padding 3</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">arrow &#123;</span><br><span class=\"line\">    LineStyle 4</span><br><span class=\"line\">    LineThickness 0.5</span><br><span class=\"line\">    LineColor green</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">* Hi =)</span><br><span class=\"line\">** sometimes i have node in wich i want to write a long text</span><br><span class=\"line\">*** this results in really huge diagram</span><br><span class=\"line\">**** of course, i can explicit split with a\\nnew line</span><br><span class=\"line\">**** but it could be cool if PlantUML was able to split long lines, maybe with an option </span><br><span class=\"line\"></span><br><span class=\"line\">@endmindmap</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191703508.png\" alt=\"image-20211028142657150\"></p>\n"},{"uuid":"bbaf6f27-c0ab-11ec-92a1-7557b2313227","title":"gauge命令","abbrlink":"a84f6b4b","_content":"\nGauge是一流的命令行工具，这意味着您可以完全从命令行进行操作。或者如果您更喜欢使用IDE，那么Gauge也可以与多个IDE进行良好的集成。\n\n## 命令行接口\n\nGauge具有良好的命令行支持，安装gauge，列出运行支持的子命令/标志。\n\n> gauge\n\n这个命令行接口是跨平台的。在GNU/[Linux](https://so.csdn.net/so/search?from=pc_blog_highlight&q=Linux)和OSX，你可以使用任意终端，在windows上你可以使用cmd或者Powershell。\n\n### help\n\n由于子命令或者标识是通过版本被添加或者被弃用，所以建议通过gauge它本身来获取参考。\n\n> gauge -v\n>\n> gauge help\n\n### 创建项目\n\n创建或者初始化项目通过执行\n\n> gauge init <template>\n\n这里的template可以是python,js,java等等，更多细节可以查看官方文档\n\n### 执行测试\n\n在Gauge项目内，您可以通过调用spec的路径来执行测试。按照惯例，spec存储在项目根目录中的./spec/子目录中。\n语法是：\n\n> gauge run [flags] <path-to=specs>\n\nGauge命令行实用程序允许多种方式执行要执行的spec。用于执行测试的有效路径可以是：包含spec的目录路径或者sepc文件路径或者scenarios路径或者三种的混合。\n\n为执行在已有文件夹`specs`内的所有用例，使用:\n\n> gauge run specs/\n\n这将给出一个彩色的控制台输出，其中包括执行细节以及执行摘要。\n\n### 指定场景\n\n可以通过在spec中指定该场景的跨度中的行号来执行spec的单个场景，要执行下列spec中的`Admin Login` 场景，请使用命令`gauge run specs/login_test.spec:4`\n\n~~~markdown\n Configuration\n =============\n \n Admin Login\n -----------\n * User must login as \"admin\"\n * Navigate to the configuration page\n~~~\n\n这仅执行在行号4（即login_test.spec中的`Admin Login`）中存在的场景。在上述spec中，由于跨度，指定行号4-7会执行相同的场景。\n\n也可以选择性的执行多种场景如下：\n\n> gauge run specs/helloworld.spec:4 specs/helloword.spec:7\n\n这些场景也可以属于不同的spec文件。\n你也可以指定一个具体的scenario或者scenario列表来执行。要执行scenario，gauge将获取spec文件的路径，后跟冒号和零索引数字（译者注：从0开始的索引）的scenario。\n\n例如：要执行名为`spec1.spec`的spec文件的第二个scenario，你应该执行：\n\n> gauge run specs/spec1.spec:1\n\n要指定多个scenarios，请添加多个这样的参数。例如，要执行名为`spec1.spec`的spec文件的第一和第三个scenario，你应该执行：\n\n> gauge run specs/spec1.spec:0 specs/spec1.spec:2\n\n### 指定目录\n\n你可以指定存储spec文件的一个单独目录，Gauge扫描这个目录，并取出可用的spec文件。\n例如：\n\n> gauge run specs/\n\n你也可以指定存储spec文件的多个目录，Gauge扫描所有的目录内可用的spec文件并在一次运行过程中执行它们。\n例如：\n\n> gauge run specs-dir1/ specs-dir2/ specs-dir3/\n\n### 指定文件\n\n你可以指定spec文件的路径，在这种情况下，Gauge仅执行提供的spec文件。\n例如：要执行一个单独的spec文件：\n\n> gauge run specs/spec1.spec\n\n或者，执行多个spec文件：\n\n> gauge run specs/spec1.spec specs/spec2.spec specs/spec3.spec\n\n### 详细报告\n\n默认情况下，在执行测试中，gauge提供spec级别的报告。您可以使用`--verbose`标志来启用详细的步骤级别报告。例如：\n\n> gauge run --verbose specs/\n\n### 执行中的错误\n\n#### spec文件解析错误\n\n如果spec文件不符合预期的语法或者无法解析参数，则会发生这种情况。\n例如：\n\n> [ParseError] hello_world.spec : line no: 25, Dynamic parameter could not be resolved\n\n#### spec文件未实现的步骤\n\n如果spec文件包含未用项目编程语言实现的步骤，则会出现验证错误。必须要为执行的spec中的所有步骤提供适当的底层代码实现。\n例如：\n\n> login.spec:33: Step implementation not found. login with “user” and “p@ssword”\n\n#### 启动语言执行插件失败\n\n如果项目中语言特定插件未安装则执行会失败。\n\n### 数据驱动执行\n\n- 在任何步骤前，数据表格以markdown表格格式定义在spec的开头\n- 数据表格应该有标题行，且至少有一行数据\n- 表格中的标题名称，用在有角括号`<>`的步骤中，用于将数据表中特定列引用为参数\n- 一次执行，每个场景都会执行表格中的每一行数据\n- 表格很容易的在IDE中被创建，使用模版`table:<no of columns>`，然后点击`Tab`键\n- 表格参数以多标记表格格式编写\n\n示例\n\n~~~markdown\nTable driven execution\n======================\n\n     |id| name    |\n     |--|---------|\n     |1 |vishnu   |\n     |2 |prateek  |\n     |3 |navaneeth|\n\nScenario\n--------\n* Say \"hello\" to <name>\n\nSecond Scenario\n---------------\n* Say \"namaste\" to <name>\n~~~\n\n在上面的示例，步骤使用数据表格中的`name`列作为动态参数。\n`Scenario`和 `Second Scenario`都会首先执行第一行数据`1,vishnu`，然后连续地执行表格中第二和第三行的值。\n\n#### 执行选中的表格数据行\n\n默认情况下，spec中的场景会针对所有数据表格行运行。可以使用标志`--table-rows`针对选定的数据表行运行，并指定应执行场景的行号。如果有多个行号，则应以逗号分隔。\n例如：\n\n> gauge run --table-rows \"1\" specs/hello.spec\n>\n> gauge run --table-rows \"1,4,7\" specs/hello.spec\n\n针对哪些场景运行，也可以指定表格行范围。\n例如：\n\n> gauge run --table-rows \"1-3\" specs/hello.spec\n\n这将针对表格行1，2，3执行场景。\n\n#### 执行标签\n\n标签允许您快速过滤将要执行的spec和场景。执行标有某些标签的所有specs和场景，使用下面的命令：\n\n> gauge run --tags tag1,tag2 spec\n\n或者\n\n> gauge run --tags \"tag1, tag2\" specs\n\n这仅执行标记有`tag1`和`tag2`的场景和spec。\n\n示例：\n\n~~~markdown\nSearch Specification\n====================\nThe admin user must be able to search for available projects on the search page.\nTags: search, admin\n\n* User must be logged in as \"admin\"\n* Open the product search page\n\nSuccessful search\n-----------------\nTags: successful\n\nFor an existing product name, the search result will contain the product name.\n\n* Search for product \"Die Hard\"\n* \"Die Hard\" should show up in the search results\n\nUnsuccessful search\n-------------------\nOn an unknown product name search the search results will be empty\n\n* Search for product \"unknown\"\n* The search results will be empty\n~~~\n\n在上述spec中，如果想要标记有\"search\"和\"admin\"的所有场景被执行，使用下列命令：\n\n> gauge run --tags \"search & admin\" SPEC_FILE_NAME\n\n#### 标签表达式\n\n标签可以通过表达式被选中，例如：\n\n|          Tags          | Selects specs/scenario that                        |\n| :--------------------: | :------------------------------------------------- |\n|         !TagA          | do not have TagA                                   |\n|      TagA & TagB       | have both TagA and TagB.                           |\n|      TagA & !TagB      | have TagA and not TagB.                            |\n|      TagA \\| TagB      | have either TagA or TagB.                          |\n| (TagA & TagB) \\| TagC  | have either TagC or both TagA and TagB             |\n| !(TagA & TagB) \\| TagC | have either TagC or do not have both TagA and TagB |\n| (TagA \\| TagB) & TagC  | have either [TagA and TagC] or [TagB and TagC]     |\n\n#### 并行执行\n\n可以并行执行spec以更快的运行测试并分发负载。\n这可以通过命令完成：\n\n> gauge run --parallel specs\n>\n> gauge run -p specs\n\n这根据机器的核数量创建多个执行流，并在执行者之间分配负载。\n并行执行流数量可以通过`-n`标志指定。\n例如：\n\n> gauge run --parallel -n=4 specs\n\n这会创建四个并行执行流。\n\n备注\n执行流数量的指定应该是由机器的可用CPU核数量决定，超过此数量可能会导致不良结果。要进行优化，请尝试使用线程并行执行（译者注：下一节）。\n\n#### 使用线程并行执行\n\n在并行执行中，每个执行流会启动一个新的工作者进程。这可以通过使用多线程取代进程来优化。这样进行并行执行只有一个工作进程且启动多个线程。\n为使用它，设置`enable_multithreading`环境变量为true。这个属性也可以添加到默认/自定义环境。\n\n> enable_multithreading = true\n\n必要条件：\n\n- 线程安全测试代码\n- 语言执行插件应该支持多线程\n\n备注：目前，这个功能只有 Java语言插件支持。\n\n#### 执行一组spec\n\nspec可以分成组，并且`--group`和`-g`标志提供执行特定组的功能。\n可以通过下面的命令完成：\n\n> gauge run -n=4 -g=2 specs\n\n上述创建4组（由`-n`标志提供）spec，并且执行第二个（由`-g`提供）组。\nspec按照字母顺序排序，然后分成组，保证每个组都有相同的spec集合，无论执行多少次。\n例如：\n\n> gauge run -n=4 -g=2 specs\n>\n> gauge run -n=4 -g=2 specs\n\n上面的两条命令将会执行同样的一组spec。\n\n#### 懒惰分配测试执行您的测试套件\n\n此功能允许您在执行期间动态分配spec给工作流，而不是在执行开始时。\n这使得Gauge可以优化您的代理/执行环境的资源。这是有用的，因为某些spec可能需要比其他spec更多的时间，因为它们中的场景数量或者被测功能的性质。\n以下命令将在指定数量的流中分配测试：\n\n> gauge run -n=4 --strategy=\"lazy\" specs\n\n或者\n\n> gauge run -n=4 specs\n\n假设您有100个测试用例，您选择运行4个流/核心；在执行期间，懒惰分配将动态地将下一个spec分配给已完成先前执行的流并等待更多工作的流。\n\n懒惰分配测试是默认的行为。\n\n根据需求，另一种叫做`eager`的策略也是有用的。在这种情况下，100个测试用例在执行之前分发，从而使它们的数量相等。\n\n> gauge run -n=4 --strategy=\"eager\" specs\n\n备注：懒惰策略只有在你未使用`-g`标志时生效。这是因为分组依赖于开始执行之前测试的分配。结合懒惰策略使用它将不会对您的测试套件执行产生影响。\n\n#### 重新执行一个执行流\n\nspec可以分成组，`--group` 和 `-g`提供执行具体组的功能。\n\n可以通过下列命令完成：\n\n> gauge run -n=4 -g=2 specs\n\n上述创建4组（由`-n`标志提供）spec，并且执行第二个（由`-g`提供）组。\nspec按照字母顺序排序，然后分成组，保证每个组都有相同的spec集合，无论执行多少次。\n例如：\n\n> gauge run -n=4 -g=2 specs\n>\n> gauge run -n=4 -g=2 specs\n\n上面的两条命令将会执行同样的一组spec。\n\n### Hook中的当前执行上下文\n\n- 要获取有关当前spec，场景，步骤执行的其他信息，可以在hooks方法中添加一个附加的`ExecutionContext`参数。\n\n~~~java\n  @BeforeScenario\n  public void loginUser(ExecutionContext context) {\n    String scenarioName = context.getCurrentScenario().getName();\n    // Code for before scenario\n  }\n\n  @AfterSpec\n  public void performAfterSpec(ExecutionContext context) {\n    Specification currentSpecification = context.getCurrentSpecification();\n    // Code for after step\n  }\n~~~\n\n### 基于标签过滤Hooks执行\n\n您可以指定执行hooks可以运行的标签，这将确保hook仅在具有所需标签的场景和spec上运行。\n\n~~~java\n  // A before spec hook that runs when tag1 and tag2\n  // is present in the current scenario and spec.\n  @BeforeSpec(tags = {\"tag1, tag2\"})\n  public void loginUser() {\n      // Code forbefore scenario\n  }\n\n  // A after step hook runs when tag1 or tag2\n  // is present in the currentscenario and spec.\n  // Default tagAggregation value is Operator.AND.\n  @AfterStep(tags = {\"tag1\", \"tag2\"}, tagAggregation = Operator.OR)\n  public void performAfterStep() {\n      // Code for after step\n  }\n~~~\n\n备注：\n标签不能被指定在`@BeforeSuite`和`@AfterSuite`hooks上.\n\n## Gauge项目模版\n\nGauge提供的模版可用于引导初始化Gauge项目的过程以及合适的构建依赖工具，webdriver等。\n\n运行下面的命令，列出所有gauge项目可用的模版：\n\n> gauge init --templates\n\n这些模版也可以在[Bintray网站Gauge模版](https://bintray.com/gauge/Templates/gauge-templates/view#files)处找到。\n\n### 通过模版初始化Gauge项目\n\n假如您想使用Java编写测试代码以及Selenium作为驱动来初始化Gauge项目。\n\n您可以通过使用`java_maven_selenium`gauge模版快速设置此项目，该项目已准备好开始使用selenium编写测试 。\n\n要使用模版初始化gauge项目，从运行`gauge init --templates`后展示的名字选择其一然后在初始化gauge项目时将此名作为参数传入。\n\n例如，为创建使用`java_maven_selenium`模版的gauge项目，你需要运行下面的命令：\n\n> gauge init java_maven_selenium\n\n此模版将maven作为构建工具以及selenium作为webdrvier来创建gauge项目， 这将会下载gauge模版`java_maven_selenium`然后使用有用的示例代码设置您的项目。\n\n现在，您可以开始编写spec然后执行它们。\n\n## 步骤别名\n\n多个步骤名称对应相同的实现，所有步骤名称的参数的数量和类型必须与实现上的参数数量想匹配。\n\n### 用例\n\n可能在一些情况下，在创作spec的时候，您可能希望以不同的方式表达相同的功能，以使得spec更容易阅读。\n\n#### 示例1\n\n~~~markdown\nUser Creation\n=============\nMultiple Users\n--------------\n* Create a user \"user 1\"\n* Verify \"user 1\" has access to dashboard\n* Create another user \"user 2\"\n* Verify \"user 2\" has access to dashboard\n~~~\n\n在名为Multiple Users的场景里，第一和第三步的底层功能是一样的，但是它们的表达是不一样的。这有助于更清楚的传达意图和功能。在这样的情况下，应该使用步骤别名功能，以便您可以在代码级别实践DRY原则，同事确保功能被清楚的表达.\n\n**实现**\n\n~~~java\n  public class Users {\n\n      @Step({\"Create a user <user_name>\", \"Create another user <user_name>\"})\n      public void helloWorld(String user_name) {\n          // create user user_name\n      }\n\n  }\n~~~\n\n**示例2**\n\n~~~markdown\nUser Creation\n-------------\n* User creates a new account\n* A \"welcome\" email is sent to the user\n\nShopping Cart\n-------------\n* User checks out the shopping cart\n* Payment is successfully received\n* An email confirming the \"order\" is sent\n~~~\n\n在此用例中，两个场景的最后一行（发送邮件）底层功能是一样的，但是使用别名后表达更清楚。底层的步骤实现可能是这样的。\n\n实现\n\n~~~java\n  public class Users {\n\n      @Step({\"A <email_type> email is sent to the user\", \"An email confirming the <email_type> is sent\"})\n      public void helloWorld(String email_type) {\n          // Send email of email_type\n      }\n\n  }\n~~~\n\n## 失败用例重新运行\n\nGauge提供仅重新执行上次执行过程中失败场景的功能。失败场景运行可以通过使用gauge标签`--failed`。\n\n假如您运行`gauge run specs`后3个场景失败了，您通过下面的命令，可以仅仅重新执行失败场景而不是执行所有的场景。\n\n> gauge run --failed\n\n这个命令甚至会设置在您上次运行中提供的标志，例如：如果您已经执行了下列命令：\n\n> gauge run --env=\"chrome\" --verbose specs\n\n并且三个场景在这次运行过程中失败了，`gauge run --failed`命令设置`--env` 和`--verbose`标志为对应的值然后仅仅执行失败的三个场景。这个情况下`gauge run --failed`相当于命令:\n\n> gauge run --env=\"chrome\" --verbose specs <path_to_failed_scenarios>\n\n## 重构\n\n### 改写步骤\n\nGauge允许您改写项目中的步骤，改写步骤运行：\n\n> gauge refactor \"old step <name>\" \"new step name\"\n\n这里`<`和`>`用来表示步骤中的参数。参数可以在改写过程中被添加，被移除或者被修改。\n\n这样会修改所有的spec文件以及代码文件（用于支持重构的语言插件）。\n\n#### 示例\n\n假设我们的spec文件有以下步骤：\n\n~~~markdown\n* create user \"john\" with id \"123\"\n* create user \"mark\" with id \"345\"\n~~~\n\n现在，如果你需要添加一个额外的参数`last name`在这个步骤里，我们可以执行下面的命令：\n\n> gauge refactor \"create user <name> with id <id>\" \"create user <name> with <id> and last name <watson>\"\n\n这将修改所有的spec文件已反映修改。\n\n~~~markdown\n* create user \"john\" with id \"123\" and last name \"watson\"\n* create user \"mark\" with id \"345\" and last name \"watson\"\n~~~\n\n### 项目结构体\n\n在初始化特定语言的gauge项目时，将使用以下文件创建项目框架：\n\n### 通用Gauge文件\n\nGAUGE_PROJECT_ROOT环境变量保存创建Gauge项目的路径。\n\n> ├── env\n> │ └── default\n> │ └── default.properties\n> ├── manifest.json\n> ├── specs\n> │ └── example.spec\n\n### Env目录\n\nenv目录包含多个环境特定的目录，每个目录都有.property文件，用于定义在特定环境执行期间设置的环境变量。\n\nenv/default目录是在项目初始化的时候创建，包含执行过程中设置的默认环境变量。\n\n学习更多关于[管理环境](https://docs.getgauge.io/configuration.html#environments)的内容。\n\n### Specs目录\n\nspecs目录包含此项目所有的spec文件，它们是用简单的markdown语法编写的业务层spec。\n\n一个简单的spec示例（example.spec）被建在specs目录中，它易于理解spec的格式。\n\n学习更多关于[spec](https://docs.getgauge.io/syntax.html#spec-syntax)的内容。\n\n### manifest文件\n\nmanifest.json文件包含spec特定的配置，其中包括项目中所需的插件信息。\n\n项目初始化后，manifest.json文件将具有一下内容：\n\n~~~json\n{\n  \"Language\": \"<language>\",\n  \"Plugins\": [\n    \"html-report\"\n  ]\n}\n~~~\n\n- Language：编写测试代码的编程语言，Gauge使用对应的Language runner来执行specs。\n- Plugins：项目所用的Gauge插件，一些插件会在每个Gauge项目中默认被使用。插件可以通过执行下面的命令添加到项目中：\n\n> gauge add <plugin-name>\n\n例如：\n\n> gauge add xml-report\n\n在运行上面的命令之后，manifest.json文件将会具有以下内容：\n\n~~~json\n{\n  \"Language\": \"<language>\",\n  \"Plugins\": [\n    \"html-report\",\n    \"xml-report\"\n  ]\n}\n~~~\n\n参考信息:[更多信息](https://blog.csdn.net/amoscn/article/details/77855944?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163841644516780271542590%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=163841644516780271542590&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~sobaiduend~default-1-77855944.pc_v2_rank_blog_default&utm_term=gauge&spm=1018.2226.3001.4450)\n","source":"_posts/gauge/4.使用.md","raw":"---\nuuid: bbaf6f27-c0ab-11ec-92a1-7557b2313227\ntitle: gauge命令\ntags: gauge\ncategories: BDD\nabbrlink: a84f6b4b\n---\n\nGauge是一流的命令行工具，这意味着您可以完全从命令行进行操作。或者如果您更喜欢使用IDE，那么Gauge也可以与多个IDE进行良好的集成。\n\n## 命令行接口\n\nGauge具有良好的命令行支持，安装gauge，列出运行支持的子命令/标志。\n\n> gauge\n\n这个命令行接口是跨平台的。在GNU/[Linux](https://so.csdn.net/so/search?from=pc_blog_highlight&q=Linux)和OSX，你可以使用任意终端，在windows上你可以使用cmd或者Powershell。\n\n### help\n\n由于子命令或者标识是通过版本被添加或者被弃用，所以建议通过gauge它本身来获取参考。\n\n> gauge -v\n>\n> gauge help\n\n### 创建项目\n\n创建或者初始化项目通过执行\n\n> gauge init <template>\n\n这里的template可以是python,js,java等等，更多细节可以查看官方文档\n\n### 执行测试\n\n在Gauge项目内，您可以通过调用spec的路径来执行测试。按照惯例，spec存储在项目根目录中的./spec/子目录中。\n语法是：\n\n> gauge run [flags] <path-to=specs>\n\nGauge命令行实用程序允许多种方式执行要执行的spec。用于执行测试的有效路径可以是：包含spec的目录路径或者sepc文件路径或者scenarios路径或者三种的混合。\n\n为执行在已有文件夹`specs`内的所有用例，使用:\n\n> gauge run specs/\n\n这将给出一个彩色的控制台输出，其中包括执行细节以及执行摘要。\n\n### 指定场景\n\n可以通过在spec中指定该场景的跨度中的行号来执行spec的单个场景，要执行下列spec中的`Admin Login` 场景，请使用命令`gauge run specs/login_test.spec:4`\n\n~~~markdown\n Configuration\n =============\n \n Admin Login\n -----------\n * User must login as \"admin\"\n * Navigate to the configuration page\n~~~\n\n这仅执行在行号4（即login_test.spec中的`Admin Login`）中存在的场景。在上述spec中，由于跨度，指定行号4-7会执行相同的场景。\n\n也可以选择性的执行多种场景如下：\n\n> gauge run specs/helloworld.spec:4 specs/helloword.spec:7\n\n这些场景也可以属于不同的spec文件。\n你也可以指定一个具体的scenario或者scenario列表来执行。要执行scenario，gauge将获取spec文件的路径，后跟冒号和零索引数字（译者注：从0开始的索引）的scenario。\n\n例如：要执行名为`spec1.spec`的spec文件的第二个scenario，你应该执行：\n\n> gauge run specs/spec1.spec:1\n\n要指定多个scenarios，请添加多个这样的参数。例如，要执行名为`spec1.spec`的spec文件的第一和第三个scenario，你应该执行：\n\n> gauge run specs/spec1.spec:0 specs/spec1.spec:2\n\n### 指定目录\n\n你可以指定存储spec文件的一个单独目录，Gauge扫描这个目录，并取出可用的spec文件。\n例如：\n\n> gauge run specs/\n\n你也可以指定存储spec文件的多个目录，Gauge扫描所有的目录内可用的spec文件并在一次运行过程中执行它们。\n例如：\n\n> gauge run specs-dir1/ specs-dir2/ specs-dir3/\n\n### 指定文件\n\n你可以指定spec文件的路径，在这种情况下，Gauge仅执行提供的spec文件。\n例如：要执行一个单独的spec文件：\n\n> gauge run specs/spec1.spec\n\n或者，执行多个spec文件：\n\n> gauge run specs/spec1.spec specs/spec2.spec specs/spec3.spec\n\n### 详细报告\n\n默认情况下，在执行测试中，gauge提供spec级别的报告。您可以使用`--verbose`标志来启用详细的步骤级别报告。例如：\n\n> gauge run --verbose specs/\n\n### 执行中的错误\n\n#### spec文件解析错误\n\n如果spec文件不符合预期的语法或者无法解析参数，则会发生这种情况。\n例如：\n\n> [ParseError] hello_world.spec : line no: 25, Dynamic parameter could not be resolved\n\n#### spec文件未实现的步骤\n\n如果spec文件包含未用项目编程语言实现的步骤，则会出现验证错误。必须要为执行的spec中的所有步骤提供适当的底层代码实现。\n例如：\n\n> login.spec:33: Step implementation not found. login with “user” and “p@ssword”\n\n#### 启动语言执行插件失败\n\n如果项目中语言特定插件未安装则执行会失败。\n\n### 数据驱动执行\n\n- 在任何步骤前，数据表格以markdown表格格式定义在spec的开头\n- 数据表格应该有标题行，且至少有一行数据\n- 表格中的标题名称，用在有角括号`<>`的步骤中，用于将数据表中特定列引用为参数\n- 一次执行，每个场景都会执行表格中的每一行数据\n- 表格很容易的在IDE中被创建，使用模版`table:<no of columns>`，然后点击`Tab`键\n- 表格参数以多标记表格格式编写\n\n示例\n\n~~~markdown\nTable driven execution\n======================\n\n     |id| name    |\n     |--|---------|\n     |1 |vishnu   |\n     |2 |prateek  |\n     |3 |navaneeth|\n\nScenario\n--------\n* Say \"hello\" to <name>\n\nSecond Scenario\n---------------\n* Say \"namaste\" to <name>\n~~~\n\n在上面的示例，步骤使用数据表格中的`name`列作为动态参数。\n`Scenario`和 `Second Scenario`都会首先执行第一行数据`1,vishnu`，然后连续地执行表格中第二和第三行的值。\n\n#### 执行选中的表格数据行\n\n默认情况下，spec中的场景会针对所有数据表格行运行。可以使用标志`--table-rows`针对选定的数据表行运行，并指定应执行场景的行号。如果有多个行号，则应以逗号分隔。\n例如：\n\n> gauge run --table-rows \"1\" specs/hello.spec\n>\n> gauge run --table-rows \"1,4,7\" specs/hello.spec\n\n针对哪些场景运行，也可以指定表格行范围。\n例如：\n\n> gauge run --table-rows \"1-3\" specs/hello.spec\n\n这将针对表格行1，2，3执行场景。\n\n#### 执行标签\n\n标签允许您快速过滤将要执行的spec和场景。执行标有某些标签的所有specs和场景，使用下面的命令：\n\n> gauge run --tags tag1,tag2 spec\n\n或者\n\n> gauge run --tags \"tag1, tag2\" specs\n\n这仅执行标记有`tag1`和`tag2`的场景和spec。\n\n示例：\n\n~~~markdown\nSearch Specification\n====================\nThe admin user must be able to search for available projects on the search page.\nTags: search, admin\n\n* User must be logged in as \"admin\"\n* Open the product search page\n\nSuccessful search\n-----------------\nTags: successful\n\nFor an existing product name, the search result will contain the product name.\n\n* Search for product \"Die Hard\"\n* \"Die Hard\" should show up in the search results\n\nUnsuccessful search\n-------------------\nOn an unknown product name search the search results will be empty\n\n* Search for product \"unknown\"\n* The search results will be empty\n~~~\n\n在上述spec中，如果想要标记有\"search\"和\"admin\"的所有场景被执行，使用下列命令：\n\n> gauge run --tags \"search & admin\" SPEC_FILE_NAME\n\n#### 标签表达式\n\n标签可以通过表达式被选中，例如：\n\n|          Tags          | Selects specs/scenario that                        |\n| :--------------------: | :------------------------------------------------- |\n|         !TagA          | do not have TagA                                   |\n|      TagA & TagB       | have both TagA and TagB.                           |\n|      TagA & !TagB      | have TagA and not TagB.                            |\n|      TagA \\| TagB      | have either TagA or TagB.                          |\n| (TagA & TagB) \\| TagC  | have either TagC or both TagA and TagB             |\n| !(TagA & TagB) \\| TagC | have either TagC or do not have both TagA and TagB |\n| (TagA \\| TagB) & TagC  | have either [TagA and TagC] or [TagB and TagC]     |\n\n#### 并行执行\n\n可以并行执行spec以更快的运行测试并分发负载。\n这可以通过命令完成：\n\n> gauge run --parallel specs\n>\n> gauge run -p specs\n\n这根据机器的核数量创建多个执行流，并在执行者之间分配负载。\n并行执行流数量可以通过`-n`标志指定。\n例如：\n\n> gauge run --parallel -n=4 specs\n\n这会创建四个并行执行流。\n\n备注\n执行流数量的指定应该是由机器的可用CPU核数量决定，超过此数量可能会导致不良结果。要进行优化，请尝试使用线程并行执行（译者注：下一节）。\n\n#### 使用线程并行执行\n\n在并行执行中，每个执行流会启动一个新的工作者进程。这可以通过使用多线程取代进程来优化。这样进行并行执行只有一个工作进程且启动多个线程。\n为使用它，设置`enable_multithreading`环境变量为true。这个属性也可以添加到默认/自定义环境。\n\n> enable_multithreading = true\n\n必要条件：\n\n- 线程安全测试代码\n- 语言执行插件应该支持多线程\n\n备注：目前，这个功能只有 Java语言插件支持。\n\n#### 执行一组spec\n\nspec可以分成组，并且`--group`和`-g`标志提供执行特定组的功能。\n可以通过下面的命令完成：\n\n> gauge run -n=4 -g=2 specs\n\n上述创建4组（由`-n`标志提供）spec，并且执行第二个（由`-g`提供）组。\nspec按照字母顺序排序，然后分成组，保证每个组都有相同的spec集合，无论执行多少次。\n例如：\n\n> gauge run -n=4 -g=2 specs\n>\n> gauge run -n=4 -g=2 specs\n\n上面的两条命令将会执行同样的一组spec。\n\n#### 懒惰分配测试执行您的测试套件\n\n此功能允许您在执行期间动态分配spec给工作流，而不是在执行开始时。\n这使得Gauge可以优化您的代理/执行环境的资源。这是有用的，因为某些spec可能需要比其他spec更多的时间，因为它们中的场景数量或者被测功能的性质。\n以下命令将在指定数量的流中分配测试：\n\n> gauge run -n=4 --strategy=\"lazy\" specs\n\n或者\n\n> gauge run -n=4 specs\n\n假设您有100个测试用例，您选择运行4个流/核心；在执行期间，懒惰分配将动态地将下一个spec分配给已完成先前执行的流并等待更多工作的流。\n\n懒惰分配测试是默认的行为。\n\n根据需求，另一种叫做`eager`的策略也是有用的。在这种情况下，100个测试用例在执行之前分发，从而使它们的数量相等。\n\n> gauge run -n=4 --strategy=\"eager\" specs\n\n备注：懒惰策略只有在你未使用`-g`标志时生效。这是因为分组依赖于开始执行之前测试的分配。结合懒惰策略使用它将不会对您的测试套件执行产生影响。\n\n#### 重新执行一个执行流\n\nspec可以分成组，`--group` 和 `-g`提供执行具体组的功能。\n\n可以通过下列命令完成：\n\n> gauge run -n=4 -g=2 specs\n\n上述创建4组（由`-n`标志提供）spec，并且执行第二个（由`-g`提供）组。\nspec按照字母顺序排序，然后分成组，保证每个组都有相同的spec集合，无论执行多少次。\n例如：\n\n> gauge run -n=4 -g=2 specs\n>\n> gauge run -n=4 -g=2 specs\n\n上面的两条命令将会执行同样的一组spec。\n\n### Hook中的当前执行上下文\n\n- 要获取有关当前spec，场景，步骤执行的其他信息，可以在hooks方法中添加一个附加的`ExecutionContext`参数。\n\n~~~java\n  @BeforeScenario\n  public void loginUser(ExecutionContext context) {\n    String scenarioName = context.getCurrentScenario().getName();\n    // Code for before scenario\n  }\n\n  @AfterSpec\n  public void performAfterSpec(ExecutionContext context) {\n    Specification currentSpecification = context.getCurrentSpecification();\n    // Code for after step\n  }\n~~~\n\n### 基于标签过滤Hooks执行\n\n您可以指定执行hooks可以运行的标签，这将确保hook仅在具有所需标签的场景和spec上运行。\n\n~~~java\n  // A before spec hook that runs when tag1 and tag2\n  // is present in the current scenario and spec.\n  @BeforeSpec(tags = {\"tag1, tag2\"})\n  public void loginUser() {\n      // Code forbefore scenario\n  }\n\n  // A after step hook runs when tag1 or tag2\n  // is present in the currentscenario and spec.\n  // Default tagAggregation value is Operator.AND.\n  @AfterStep(tags = {\"tag1\", \"tag2\"}, tagAggregation = Operator.OR)\n  public void performAfterStep() {\n      // Code for after step\n  }\n~~~\n\n备注：\n标签不能被指定在`@BeforeSuite`和`@AfterSuite`hooks上.\n\n## Gauge项目模版\n\nGauge提供的模版可用于引导初始化Gauge项目的过程以及合适的构建依赖工具，webdriver等。\n\n运行下面的命令，列出所有gauge项目可用的模版：\n\n> gauge init --templates\n\n这些模版也可以在[Bintray网站Gauge模版](https://bintray.com/gauge/Templates/gauge-templates/view#files)处找到。\n\n### 通过模版初始化Gauge项目\n\n假如您想使用Java编写测试代码以及Selenium作为驱动来初始化Gauge项目。\n\n您可以通过使用`java_maven_selenium`gauge模版快速设置此项目，该项目已准备好开始使用selenium编写测试 。\n\n要使用模版初始化gauge项目，从运行`gauge init --templates`后展示的名字选择其一然后在初始化gauge项目时将此名作为参数传入。\n\n例如，为创建使用`java_maven_selenium`模版的gauge项目，你需要运行下面的命令：\n\n> gauge init java_maven_selenium\n\n此模版将maven作为构建工具以及selenium作为webdrvier来创建gauge项目， 这将会下载gauge模版`java_maven_selenium`然后使用有用的示例代码设置您的项目。\n\n现在，您可以开始编写spec然后执行它们。\n\n## 步骤别名\n\n多个步骤名称对应相同的实现，所有步骤名称的参数的数量和类型必须与实现上的参数数量想匹配。\n\n### 用例\n\n可能在一些情况下，在创作spec的时候，您可能希望以不同的方式表达相同的功能，以使得spec更容易阅读。\n\n#### 示例1\n\n~~~markdown\nUser Creation\n=============\nMultiple Users\n--------------\n* Create a user \"user 1\"\n* Verify \"user 1\" has access to dashboard\n* Create another user \"user 2\"\n* Verify \"user 2\" has access to dashboard\n~~~\n\n在名为Multiple Users的场景里，第一和第三步的底层功能是一样的，但是它们的表达是不一样的。这有助于更清楚的传达意图和功能。在这样的情况下，应该使用步骤别名功能，以便您可以在代码级别实践DRY原则，同事确保功能被清楚的表达.\n\n**实现**\n\n~~~java\n  public class Users {\n\n      @Step({\"Create a user <user_name>\", \"Create another user <user_name>\"})\n      public void helloWorld(String user_name) {\n          // create user user_name\n      }\n\n  }\n~~~\n\n**示例2**\n\n~~~markdown\nUser Creation\n-------------\n* User creates a new account\n* A \"welcome\" email is sent to the user\n\nShopping Cart\n-------------\n* User checks out the shopping cart\n* Payment is successfully received\n* An email confirming the \"order\" is sent\n~~~\n\n在此用例中，两个场景的最后一行（发送邮件）底层功能是一样的，但是使用别名后表达更清楚。底层的步骤实现可能是这样的。\n\n实现\n\n~~~java\n  public class Users {\n\n      @Step({\"A <email_type> email is sent to the user\", \"An email confirming the <email_type> is sent\"})\n      public void helloWorld(String email_type) {\n          // Send email of email_type\n      }\n\n  }\n~~~\n\n## 失败用例重新运行\n\nGauge提供仅重新执行上次执行过程中失败场景的功能。失败场景运行可以通过使用gauge标签`--failed`。\n\n假如您运行`gauge run specs`后3个场景失败了，您通过下面的命令，可以仅仅重新执行失败场景而不是执行所有的场景。\n\n> gauge run --failed\n\n这个命令甚至会设置在您上次运行中提供的标志，例如：如果您已经执行了下列命令：\n\n> gauge run --env=\"chrome\" --verbose specs\n\n并且三个场景在这次运行过程中失败了，`gauge run --failed`命令设置`--env` 和`--verbose`标志为对应的值然后仅仅执行失败的三个场景。这个情况下`gauge run --failed`相当于命令:\n\n> gauge run --env=\"chrome\" --verbose specs <path_to_failed_scenarios>\n\n## 重构\n\n### 改写步骤\n\nGauge允许您改写项目中的步骤，改写步骤运行：\n\n> gauge refactor \"old step <name>\" \"new step name\"\n\n这里`<`和`>`用来表示步骤中的参数。参数可以在改写过程中被添加，被移除或者被修改。\n\n这样会修改所有的spec文件以及代码文件（用于支持重构的语言插件）。\n\n#### 示例\n\n假设我们的spec文件有以下步骤：\n\n~~~markdown\n* create user \"john\" with id \"123\"\n* create user \"mark\" with id \"345\"\n~~~\n\n现在，如果你需要添加一个额外的参数`last name`在这个步骤里，我们可以执行下面的命令：\n\n> gauge refactor \"create user <name> with id <id>\" \"create user <name> with <id> and last name <watson>\"\n\n这将修改所有的spec文件已反映修改。\n\n~~~markdown\n* create user \"john\" with id \"123\" and last name \"watson\"\n* create user \"mark\" with id \"345\" and last name \"watson\"\n~~~\n\n### 项目结构体\n\n在初始化特定语言的gauge项目时，将使用以下文件创建项目框架：\n\n### 通用Gauge文件\n\nGAUGE_PROJECT_ROOT环境变量保存创建Gauge项目的路径。\n\n> ├── env\n> │ └── default\n> │ └── default.properties\n> ├── manifest.json\n> ├── specs\n> │ └── example.spec\n\n### Env目录\n\nenv目录包含多个环境特定的目录，每个目录都有.property文件，用于定义在特定环境执行期间设置的环境变量。\n\nenv/default目录是在项目初始化的时候创建，包含执行过程中设置的默认环境变量。\n\n学习更多关于[管理环境](https://docs.getgauge.io/configuration.html#environments)的内容。\n\n### Specs目录\n\nspecs目录包含此项目所有的spec文件，它们是用简单的markdown语法编写的业务层spec。\n\n一个简单的spec示例（example.spec）被建在specs目录中，它易于理解spec的格式。\n\n学习更多关于[spec](https://docs.getgauge.io/syntax.html#spec-syntax)的内容。\n\n### manifest文件\n\nmanifest.json文件包含spec特定的配置，其中包括项目中所需的插件信息。\n\n项目初始化后，manifest.json文件将具有一下内容：\n\n~~~json\n{\n  \"Language\": \"<language>\",\n  \"Plugins\": [\n    \"html-report\"\n  ]\n}\n~~~\n\n- Language：编写测试代码的编程语言，Gauge使用对应的Language runner来执行specs。\n- Plugins：项目所用的Gauge插件，一些插件会在每个Gauge项目中默认被使用。插件可以通过执行下面的命令添加到项目中：\n\n> gauge add <plugin-name>\n\n例如：\n\n> gauge add xml-report\n\n在运行上面的命令之后，manifest.json文件将会具有以下内容：\n\n~~~json\n{\n  \"Language\": \"<language>\",\n  \"Plugins\": [\n    \"html-report\",\n    \"xml-report\"\n  ]\n}\n~~~\n\n参考信息:[更多信息](https://blog.csdn.net/amoscn/article/details/77855944?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163841644516780271542590%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=163841644516780271542590&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~sobaiduend~default-1-77855944.pc_v2_rank_blog_default&utm_term=gauge&spm=1018.2226.3001.4450)\n","slug":"gauge/4.使用","published":1,"date":"2022-04-20T12:41:20.828Z","updated":"2022-05-04T03:03:05.507Z","_id":"cl2qzftj3008413no00w6a1le","comments":1,"layout":"post","photos":[],"link":"","content":"<p>Gauge是一流的命令行工具，这意味着您可以完全从命令行进行操作。或者如果您更喜欢使用IDE，那么Gauge也可以与多个IDE进行良好的集成。</p>\n<h2 id=\"命令行接口\"><a href=\"#命令行接口\" class=\"headerlink\" title=\"命令行接口\"></a>命令行接口</h2><p>Gauge具有良好的命令行支持，安装gauge，列出运行支持的子命令/标志。</p>\n<blockquote>\n<p>gauge</p>\n</blockquote>\n<p>这个命令行接口是跨平台的。在GNU/<a href=\"https://so.csdn.net/so/search?from=pc_blog_highlight&q=Linux\">Linux</a>和OSX，你可以使用任意终端，在windows上你可以使用cmd或者Powershell。</p>\n<h3 id=\"help\"><a href=\"#help\" class=\"headerlink\" title=\"help\"></a>help</h3><p>由于子命令或者标识是通过版本被添加或者被弃用，所以建议通过gauge它本身来获取参考。</p>\n<blockquote>\n<p>gauge -v</p>\n<p>gauge help</p>\n</blockquote>\n<h3 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h3><p>创建或者初始化项目通过执行</p>\n<blockquote>\n<p>gauge init <template></p>\n</blockquote>\n<p>这里的template可以是python,js,java等等，更多细节可以查看官方文档</p>\n<h3 id=\"执行测试\"><a href=\"#执行测试\" class=\"headerlink\" title=\"执行测试\"></a>执行测试</h3><p>在Gauge项目内，您可以通过调用spec的路径来执行测试。按照惯例，spec存储在项目根目录中的./spec/子目录中。<br>语法是：</p>\n<blockquote>\n<p>gauge run [flags] &lt;path-to=specs&gt;</p>\n</blockquote>\n<p>Gauge命令行实用程序允许多种方式执行要执行的spec。用于执行测试的有效路径可以是：包含spec的目录路径或者sepc文件路径或者scenarios路径或者三种的混合。</p>\n<p>为执行在已有文件夹<code>specs</code>内的所有用例，使用:</p>\n<blockquote>\n<p>gauge run specs/</p>\n</blockquote>\n<p>这将给出一个彩色的控制台输出，其中包括执行细节以及执行摘要。</p>\n<h3 id=\"指定场景\"><a href=\"#指定场景\" class=\"headerlink\" title=\"指定场景\"></a>指定场景</h3><p>可以通过在spec中指定该场景的跨度中的行号来执行spec的单个场景，要执行下列spec中的<code>Admin Login</code> 场景，请使用命令<code>gauge run specs/login_test.spec:4</code></p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Configuration</span></span><br><span class=\"line\"><span class=\"section\">=============</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Admin Login</span></span><br><span class=\"line\"><span class=\"section\">-----------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> User must login as &quot;admin&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Navigate to the configuration page</span><br></pre></td></tr></table></figure>\n\n<p>这仅执行在行号4（即login_test.spec中的<code>Admin Login</code>）中存在的场景。在上述spec中，由于跨度，指定行号4-7会执行相同的场景。</p>\n<p>也可以选择性的执行多种场景如下：</p>\n<blockquote>\n<p>gauge run specs/helloworld.spec:4 specs/helloword.spec:7</p>\n</blockquote>\n<p>这些场景也可以属于不同的spec文件。<br>你也可以指定一个具体的scenario或者scenario列表来执行。要执行scenario，gauge将获取spec文件的路径，后跟冒号和零索引数字（译者注：从0开始的索引）的scenario。</p>\n<p>例如：要执行名为<code>spec1.spec</code>的spec文件的第二个scenario，你应该执行：</p>\n<blockquote>\n<p>gauge run specs/spec1.spec:1</p>\n</blockquote>\n<p>要指定多个scenarios，请添加多个这样的参数。例如，要执行名为<code>spec1.spec</code>的spec文件的第一和第三个scenario，你应该执行：</p>\n<blockquote>\n<p>gauge run specs/spec1.spec:0 specs/spec1.spec:2</p>\n</blockquote>\n<h3 id=\"指定目录\"><a href=\"#指定目录\" class=\"headerlink\" title=\"指定目录\"></a>指定目录</h3><p>你可以指定存储spec文件的一个单独目录，Gauge扫描这个目录，并取出可用的spec文件。<br>例如：</p>\n<blockquote>\n<p>gauge run specs/</p>\n</blockquote>\n<p>你也可以指定存储spec文件的多个目录，Gauge扫描所有的目录内可用的spec文件并在一次运行过程中执行它们。<br>例如：</p>\n<blockquote>\n<p>gauge run specs-dir1/ specs-dir2/ specs-dir3/</p>\n</blockquote>\n<h3 id=\"指定文件\"><a href=\"#指定文件\" class=\"headerlink\" title=\"指定文件\"></a>指定文件</h3><p>你可以指定spec文件的路径，在这种情况下，Gauge仅执行提供的spec文件。<br>例如：要执行一个单独的spec文件：</p>\n<blockquote>\n<p>gauge run specs/spec1.spec</p>\n</blockquote>\n<p>或者，执行多个spec文件：</p>\n<blockquote>\n<p>gauge run specs/spec1.spec specs/spec2.spec specs/spec3.spec</p>\n</blockquote>\n<h3 id=\"详细报告\"><a href=\"#详细报告\" class=\"headerlink\" title=\"详细报告\"></a>详细报告</h3><p>默认情况下，在执行测试中，gauge提供spec级别的报告。您可以使用<code>--verbose</code>标志来启用详细的步骤级别报告。例如：</p>\n<blockquote>\n<p>gauge run –verbose specs/</p>\n</blockquote>\n<h3 id=\"执行中的错误\"><a href=\"#执行中的错误\" class=\"headerlink\" title=\"执行中的错误\"></a>执行中的错误</h3><h4 id=\"spec文件解析错误\"><a href=\"#spec文件解析错误\" class=\"headerlink\" title=\"spec文件解析错误\"></a>spec文件解析错误</h4><p>如果spec文件不符合预期的语法或者无法解析参数，则会发生这种情况。<br>例如：</p>\n<blockquote>\n<p>[ParseError] hello_world.spec : line no: 25, Dynamic parameter could not be resolved</p>\n</blockquote>\n<h4 id=\"spec文件未实现的步骤\"><a href=\"#spec文件未实现的步骤\" class=\"headerlink\" title=\"spec文件未实现的步骤\"></a>spec文件未实现的步骤</h4><p>如果spec文件包含未用项目编程语言实现的步骤，则会出现验证错误。必须要为执行的spec中的所有步骤提供适当的底层代码实现。<br>例如：</p>\n<blockquote>\n<p>login.spec:33: Step implementation not found. login with “user” and “p@ssword”</p>\n</blockquote>\n<h4 id=\"启动语言执行插件失败\"><a href=\"#启动语言执行插件失败\" class=\"headerlink\" title=\"启动语言执行插件失败\"></a>启动语言执行插件失败</h4><p>如果项目中语言特定插件未安装则执行会失败。</p>\n<h3 id=\"数据驱动执行\"><a href=\"#数据驱动执行\" class=\"headerlink\" title=\"数据驱动执行\"></a>数据驱动执行</h3><ul>\n<li>在任何步骤前，数据表格以markdown表格格式定义在spec的开头</li>\n<li>数据表格应该有标题行，且至少有一行数据</li>\n<li>表格中的标题名称，用在有角括号<code>&lt;&gt;</code>的步骤中，用于将数据表中特定列引用为参数</li>\n<li>一次执行，每个场景都会执行表格中的每一行数据</li>\n<li>表格很容易的在IDE中被创建，使用模版<code>table:&lt;no of columns&gt;</code>，然后点击<code>Tab</code>键</li>\n<li>表格参数以多标记表格格式编写</li>\n</ul>\n<p>示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Table driven execution</span></span><br><span class=\"line\"><span class=\"section\">======================</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"code\">     |id| name    |</span></span><br><span class=\"line\"><span class=\"code\">     |--|---------|</span></span><br><span class=\"line\"><span class=\"code\">     |1 |vishnu   |</span></span><br><span class=\"line\"><span class=\"code\">     |2 |prateek  |</span></span><br><span class=\"line\"><span class=\"code\">     |3 |navaneeth|</span></span><br><span class=\"line\"><span class=\"code\"></span></span><br><span class=\"line\"><span class=\"section\">Scenario</span></span><br><span class=\"line\"><span class=\"section\">--------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Say &quot;hello&quot; to <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Second Scenario</span></span><br><span class=\"line\"><span class=\"section\">---------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Say &quot;namaste&quot; to <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>在上面的示例，步骤使用数据表格中的<code>name</code>列作为动态参数。<br><code>Scenario</code>和 <code>Second Scenario</code>都会首先执行第一行数据<code>1,vishnu</code>，然后连续地执行表格中第二和第三行的值。</p>\n<h4 id=\"执行选中的表格数据行\"><a href=\"#执行选中的表格数据行\" class=\"headerlink\" title=\"执行选中的表格数据行\"></a>执行选中的表格数据行</h4><p>默认情况下，spec中的场景会针对所有数据表格行运行。可以使用标志<code>--table-rows</code>针对选定的数据表行运行，并指定应执行场景的行号。如果有多个行号，则应以逗号分隔。<br>例如：</p>\n<blockquote>\n<p>gauge run –table-rows “1” specs/hello.spec</p>\n<p>gauge run –table-rows “1,4,7” specs/hello.spec</p>\n</blockquote>\n<p>针对哪些场景运行，也可以指定表格行范围。<br>例如：</p>\n<blockquote>\n<p>gauge run –table-rows “1-3” specs/hello.spec</p>\n</blockquote>\n<p>这将针对表格行1，2，3执行场景。</p>\n<h4 id=\"执行标签\"><a href=\"#执行标签\" class=\"headerlink\" title=\"执行标签\"></a>执行标签</h4><p>标签允许您快速过滤将要执行的spec和场景。执行标有某些标签的所有specs和场景，使用下面的命令：</p>\n<blockquote>\n<p>gauge run –tags tag1,tag2 spec</p>\n</blockquote>\n<p>或者</p>\n<blockquote>\n<p>gauge run –tags “tag1, tag2” specs</p>\n</blockquote>\n<p>这仅执行标记有<code>tag1</code>和<code>tag2</code>的场景和spec。</p>\n<p>示例：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Search Specification</span></span><br><span class=\"line\"><span class=\"section\">====================</span></span><br><span class=\"line\">The admin user must be able to search for available projects on the search page.</span><br><span class=\"line\">Tags: search, admin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> User must be logged in as &quot;admin&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Open the product search page</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Successful search</span></span><br><span class=\"line\"><span class=\"section\">-----------------</span></span><br><span class=\"line\">Tags: successful</span><br><span class=\"line\"></span><br><span class=\"line\">For an existing product name, the search result will contain the product name.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> Search for product &quot;Die Hard&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> &quot;Die Hard&quot; should show up in the search results</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Unsuccessful search</span></span><br><span class=\"line\"><span class=\"section\">-------------------</span></span><br><span class=\"line\">On an unknown product name search the search results will be empty</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> Search for product &quot;unknown&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> The search results will be empty</span><br></pre></td></tr></table></figure>\n\n<p>在上述spec中，如果想要标记有”search”和”admin”的所有场景被执行，使用下列命令：</p>\n<blockquote>\n<p>gauge run –tags “search &amp; admin” SPEC_FILE_NAME</p>\n</blockquote>\n<h4 id=\"标签表达式\"><a href=\"#标签表达式\" class=\"headerlink\" title=\"标签表达式\"></a>标签表达式</h4><p>标签可以通过表达式被选中，例如：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Tags</th>\n<th align=\"left\">Selects specs/scenario that</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">!TagA</td>\n<td align=\"left\">do not have TagA</td>\n</tr>\n<tr>\n<td align=\"center\">TagA &amp; TagB</td>\n<td align=\"left\">have both TagA and TagB.</td>\n</tr>\n<tr>\n<td align=\"center\">TagA &amp; !TagB</td>\n<td align=\"left\">have TagA and not TagB.</td>\n</tr>\n<tr>\n<td align=\"center\">TagA | TagB</td>\n<td align=\"left\">have either TagA or TagB.</td>\n</tr>\n<tr>\n<td align=\"center\">(TagA &amp; TagB) | TagC</td>\n<td align=\"left\">have either TagC or both TagA and TagB</td>\n</tr>\n<tr>\n<td align=\"center\">!(TagA &amp; TagB) | TagC</td>\n<td align=\"left\">have either TagC or do not have both TagA and TagB</td>\n</tr>\n<tr>\n<td align=\"center\">(TagA | TagB) &amp; TagC</td>\n<td align=\"left\">have either [TagA and TagC] or [TagB and TagC]</td>\n</tr>\n</tbody></table>\n<h4 id=\"并行执行\"><a href=\"#并行执行\" class=\"headerlink\" title=\"并行执行\"></a>并行执行</h4><p>可以并行执行spec以更快的运行测试并分发负载。<br>这可以通过命令完成：</p>\n<blockquote>\n<p>gauge run –parallel specs</p>\n<p>gauge run -p specs</p>\n</blockquote>\n<p>这根据机器的核数量创建多个执行流，并在执行者之间分配负载。<br>并行执行流数量可以通过<code>-n</code>标志指定。<br>例如：</p>\n<blockquote>\n<p>gauge run –parallel -n=4 specs</p>\n</blockquote>\n<p>这会创建四个并行执行流。</p>\n<p>备注<br>执行流数量的指定应该是由机器的可用CPU核数量决定，超过此数量可能会导致不良结果。要进行优化，请尝试使用线程并行执行（译者注：下一节）。</p>\n<h4 id=\"使用线程并行执行\"><a href=\"#使用线程并行执行\" class=\"headerlink\" title=\"使用线程并行执行\"></a>使用线程并行执行</h4><p>在并行执行中，每个执行流会启动一个新的工作者进程。这可以通过使用多线程取代进程来优化。这样进行并行执行只有一个工作进程且启动多个线程。<br>为使用它，设置<code>enable_multithreading</code>环境变量为true。这个属性也可以添加到默认/自定义环境。</p>\n<blockquote>\n<p>enable_multithreading = true</p>\n</blockquote>\n<p>必要条件：</p>\n<ul>\n<li>线程安全测试代码</li>\n<li>语言执行插件应该支持多线程</li>\n</ul>\n<p>备注：目前，这个功能只有 Java语言插件支持。</p>\n<h4 id=\"执行一组spec\"><a href=\"#执行一组spec\" class=\"headerlink\" title=\"执行一组spec\"></a>执行一组spec</h4><p>spec可以分成组，并且<code>--group</code>和<code>-g</code>标志提供执行特定组的功能。<br>可以通过下面的命令完成：</p>\n<blockquote>\n<p>gauge run -n=4 -g=2 specs</p>\n</blockquote>\n<p>上述创建4组（由<code>-n</code>标志提供）spec，并且执行第二个（由<code>-g</code>提供）组。<br>spec按照字母顺序排序，然后分成组，保证每个组都有相同的spec集合，无论执行多少次。<br>例如：</p>\n<blockquote>\n<p>gauge run -n=4 -g=2 specs</p>\n<p>gauge run -n=4 -g=2 specs</p>\n</blockquote>\n<p>上面的两条命令将会执行同样的一组spec。</p>\n<h4 id=\"懒惰分配测试执行您的测试套件\"><a href=\"#懒惰分配测试执行您的测试套件\" class=\"headerlink\" title=\"懒惰分配测试执行您的测试套件\"></a>懒惰分配测试执行您的测试套件</h4><p>此功能允许您在执行期间动态分配spec给工作流，而不是在执行开始时。<br>这使得Gauge可以优化您的代理/执行环境的资源。这是有用的，因为某些spec可能需要比其他spec更多的时间，因为它们中的场景数量或者被测功能的性质。<br>以下命令将在指定数量的流中分配测试：</p>\n<blockquote>\n<p>gauge run -n=4 –strategy=”lazy” specs</p>\n</blockquote>\n<p>或者</p>\n<blockquote>\n<p>gauge run -n=4 specs</p>\n</blockquote>\n<p>假设您有100个测试用例，您选择运行4个流/核心；在执行期间，懒惰分配将动态地将下一个spec分配给已完成先前执行的流并等待更多工作的流。</p>\n<p>懒惰分配测试是默认的行为。</p>\n<p>根据需求，另一种叫做<code>eager</code>的策略也是有用的。在这种情况下，100个测试用例在执行之前分发，从而使它们的数量相等。</p>\n<blockquote>\n<p>gauge run -n=4 –strategy=”eager” specs</p>\n</blockquote>\n<p>备注：懒惰策略只有在你未使用<code>-g</code>标志时生效。这是因为分组依赖于开始执行之前测试的分配。结合懒惰策略使用它将不会对您的测试套件执行产生影响。</p>\n<h4 id=\"重新执行一个执行流\"><a href=\"#重新执行一个执行流\" class=\"headerlink\" title=\"重新执行一个执行流\"></a>重新执行一个执行流</h4><p>spec可以分成组，<code>--group</code> 和 <code>-g</code>提供执行具体组的功能。</p>\n<p>可以通过下列命令完成：</p>\n<blockquote>\n<p>gauge run -n=4 -g=2 specs</p>\n</blockquote>\n<p>上述创建4组（由<code>-n</code>标志提供）spec，并且执行第二个（由<code>-g</code>提供）组。<br>spec按照字母顺序排序，然后分成组，保证每个组都有相同的spec集合，无论执行多少次。<br>例如：</p>\n<blockquote>\n<p>gauge run -n=4 -g=2 specs</p>\n<p>gauge run -n=4 -g=2 specs</p>\n</blockquote>\n<p>上面的两条命令将会执行同样的一组spec。</p>\n<h3 id=\"Hook中的当前执行上下文\"><a href=\"#Hook中的当前执行上下文\" class=\"headerlink\" title=\"Hook中的当前执行上下文\"></a>Hook中的当前执行上下文</h3><ul>\n<li>要获取有关当前spec，场景，步骤执行的其他信息，可以在hooks方法中添加一个附加的<code>ExecutionContext</code>参数。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@BeforeScenario</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">loginUser</span><span class=\"params\">(ExecutionContext context)</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">scenarioName</span> <span class=\"operator\">=</span> context.getCurrentScenario().getName();</span><br><span class=\"line\">  <span class=\"comment\">// Code for before scenario</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@AfterSpec</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">performAfterSpec</span><span class=\"params\">(ExecutionContext context)</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">Specification</span> <span class=\"variable\">currentSpecification</span> <span class=\"operator\">=</span> context.getCurrentSpecification();</span><br><span class=\"line\">  <span class=\"comment\">// Code for after step</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"基于标签过滤Hooks执行\"><a href=\"#基于标签过滤Hooks执行\" class=\"headerlink\" title=\"基于标签过滤Hooks执行\"></a>基于标签过滤Hooks执行</h3><p>您可以指定执行hooks可以运行的标签，这将确保hook仅在具有所需标签的场景和spec上运行。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// A before spec hook that runs when tag1 and tag2</span></span><br><span class=\"line\"><span class=\"comment\">// is present in the current scenario and spec.</span></span><br><span class=\"line\"><span class=\"meta\">@BeforeSpec(tags = &#123;&quot;tag1, tag2&quot;&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">loginUser</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Code forbefore scenario</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// A after step hook runs when tag1 or tag2</span></span><br><span class=\"line\"><span class=\"comment\">// is present in the currentscenario and spec.</span></span><br><span class=\"line\"><span class=\"comment\">// Default tagAggregation value is Operator.AND.</span></span><br><span class=\"line\"><span class=\"meta\">@AfterStep(tags = &#123;&quot;tag1&quot;, &quot;tag2&quot;&#125;, tagAggregation = Operator.OR)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">performAfterStep</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Code for after step</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>备注：<br>标签不能被指定在<code>@BeforeSuite</code>和<code>@AfterSuite</code>hooks上.</p>\n<h2 id=\"Gauge项目模版\"><a href=\"#Gauge项目模版\" class=\"headerlink\" title=\"Gauge项目模版\"></a>Gauge项目模版</h2><p>Gauge提供的模版可用于引导初始化Gauge项目的过程以及合适的构建依赖工具，webdriver等。</p>\n<p>运行下面的命令，列出所有gauge项目可用的模版：</p>\n<blockquote>\n<p>gauge init –templates</p>\n</blockquote>\n<p>这些模版也可以在<a href=\"https://bintray.com/gauge/Templates/gauge-templates/view#files\">Bintray网站Gauge模版</a>处找到。</p>\n<h3 id=\"通过模版初始化Gauge项目\"><a href=\"#通过模版初始化Gauge项目\" class=\"headerlink\" title=\"通过模版初始化Gauge项目\"></a>通过模版初始化Gauge项目</h3><p>假如您想使用Java编写测试代码以及Selenium作为驱动来初始化Gauge项目。</p>\n<p>您可以通过使用<code>java_maven_selenium</code>gauge模版快速设置此项目，该项目已准备好开始使用selenium编写测试 。</p>\n<p>要使用模版初始化gauge项目，从运行<code>gauge init --templates</code>后展示的名字选择其一然后在初始化gauge项目时将此名作为参数传入。</p>\n<p>例如，为创建使用<code>java_maven_selenium</code>模版的gauge项目，你需要运行下面的命令：</p>\n<blockquote>\n<p>gauge init java_maven_selenium</p>\n</blockquote>\n<p>此模版将maven作为构建工具以及selenium作为webdrvier来创建gauge项目， 这将会下载gauge模版<code>java_maven_selenium</code>然后使用有用的示例代码设置您的项目。</p>\n<p>现在，您可以开始编写spec然后执行它们。</p>\n<h2 id=\"步骤别名\"><a href=\"#步骤别名\" class=\"headerlink\" title=\"步骤别名\"></a>步骤别名</h2><p>多个步骤名称对应相同的实现，所有步骤名称的参数的数量和类型必须与实现上的参数数量想匹配。</p>\n<h3 id=\"用例\"><a href=\"#用例\" class=\"headerlink\" title=\"用例\"></a>用例</h3><p>可能在一些情况下，在创作spec的时候，您可能希望以不同的方式表达相同的功能，以使得spec更容易阅读。</p>\n<h4 id=\"示例1\"><a href=\"#示例1\" class=\"headerlink\" title=\"示例1\"></a>示例1</h4><figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">User Creation</span></span><br><span class=\"line\"><span class=\"section\">=============</span></span><br><span class=\"line\"><span class=\"section\">Multiple Users</span></span><br><span class=\"line\"><span class=\"section\">--------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Create a user &quot;user 1&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Verify &quot;user 1&quot; has access to dashboard</span><br><span class=\"line\"><span class=\"bullet\">*</span> Create another user &quot;user 2&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Verify &quot;user 2&quot; has access to dashboard</span><br></pre></td></tr></table></figure>\n\n<p>在名为Multiple Users的场景里，第一和第三步的底层功能是一样的，但是它们的表达是不一样的。这有助于更清楚的传达意图和功能。在这样的情况下，应该使用步骤别名功能，以便您可以在代码级别实践DRY原则，同事确保功能被清楚的表达.</p>\n<p><strong>实现</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Users</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Step(&#123;&quot;Create a user &lt;user_name&gt;&quot;, &quot;Create another user &lt;user_name&gt;&quot;&#125;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">helloWorld</span><span class=\"params\">(String user_name)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// create user user_name</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>示例2</strong></p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">User Creation</span></span><br><span class=\"line\"><span class=\"section\">-------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> User creates a new account</span><br><span class=\"line\"><span class=\"bullet\">*</span> A &quot;welcome&quot; email is sent to the user</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Shopping Cart</span></span><br><span class=\"line\"><span class=\"section\">-------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> User checks out the shopping cart</span><br><span class=\"line\"><span class=\"bullet\">*</span> Payment is successfully received</span><br><span class=\"line\"><span class=\"bullet\">*</span> An email confirming the &quot;order&quot; is sent</span><br></pre></td></tr></table></figure>\n\n<p>在此用例中，两个场景的最后一行（发送邮件）底层功能是一样的，但是使用别名后表达更清楚。底层的步骤实现可能是这样的。</p>\n<p>实现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Users</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Step(&#123;&quot;A &lt;email_type&gt; email is sent to the user&quot;, &quot;An email confirming the &lt;email_type&gt; is sent&quot;&#125;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">helloWorld</span><span class=\"params\">(String email_type)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Send email of email_type</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"失败用例重新运行\"><a href=\"#失败用例重新运行\" class=\"headerlink\" title=\"失败用例重新运行\"></a>失败用例重新运行</h2><p>Gauge提供仅重新执行上次执行过程中失败场景的功能。失败场景运行可以通过使用gauge标签<code>--failed</code>。</p>\n<p>假如您运行<code>gauge run specs</code>后3个场景失败了，您通过下面的命令，可以仅仅重新执行失败场景而不是执行所有的场景。</p>\n<blockquote>\n<p>gauge run –failed</p>\n</blockquote>\n<p>这个命令甚至会设置在您上次运行中提供的标志，例如：如果您已经执行了下列命令：</p>\n<blockquote>\n<p>gauge run –env=”chrome” –verbose specs</p>\n</blockquote>\n<p>并且三个场景在这次运行过程中失败了，<code>gauge run --failed</code>命令设置<code>--env</code> 和<code>--verbose</code>标志为对应的值然后仅仅执行失败的三个场景。这个情况下<code>gauge run --failed</code>相当于命令:</p>\n<blockquote>\n<p>gauge run –env=”chrome” –verbose specs <path_to_failed_scenarios></p>\n</blockquote>\n<h2 id=\"重构\"><a href=\"#重构\" class=\"headerlink\" title=\"重构\"></a>重构</h2><h3 id=\"改写步骤\"><a href=\"#改写步骤\" class=\"headerlink\" title=\"改写步骤\"></a>改写步骤</h3><p>Gauge允许您改写项目中的步骤，改写步骤运行：</p>\n<blockquote>\n<p>gauge refactor “old step <name>“ “new step name”</p>\n</blockquote>\n<p>这里<code>&lt;</code>和<code>&gt;</code>用来表示步骤中的参数。参数可以在改写过程中被添加，被移除或者被修改。</p>\n<p>这样会修改所有的spec文件以及代码文件（用于支持重构的语言插件）。</p>\n<h4 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h4><p>假设我们的spec文件有以下步骤：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> create user &quot;john&quot; with id &quot;123&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> create user &quot;mark&quot; with id &quot;345&quot;</span><br></pre></td></tr></table></figure>\n\n<p>现在，如果你需要添加一个额外的参数<code>last name</code>在这个步骤里，我们可以执行下面的命令：</p>\n<blockquote>\n<p>gauge refactor “create user <name> with id <id>“ “create user <name> with <id> and last name <watson>“</p>\n</blockquote>\n<p>这将修改所有的spec文件已反映修改。</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> create user &quot;john&quot; with id &quot;123&quot; and last name &quot;watson&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> create user &quot;mark&quot; with id &quot;345&quot; and last name &quot;watson&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"项目结构体\"><a href=\"#项目结构体\" class=\"headerlink\" title=\"项目结构体\"></a>项目结构体</h3><p>在初始化特定语言的gauge项目时，将使用以下文件创建项目框架：</p>\n<h3 id=\"通用Gauge文件\"><a href=\"#通用Gauge文件\" class=\"headerlink\" title=\"通用Gauge文件\"></a>通用Gauge文件</h3><p>GAUGE_PROJECT_ROOT环境变量保存创建Gauge项目的路径。</p>\n<blockquote>\n<p>├── env<br>│ └── default<br>│ └── default.properties<br>├── manifest.json<br>├── specs<br>│ └── example.spec</p>\n</blockquote>\n<h3 id=\"Env目录\"><a href=\"#Env目录\" class=\"headerlink\" title=\"Env目录\"></a>Env目录</h3><p>env目录包含多个环境特定的目录，每个目录都有.property文件，用于定义在特定环境执行期间设置的环境变量。</p>\n<p>env/default目录是在项目初始化的时候创建，包含执行过程中设置的默认环境变量。</p>\n<p>学习更多关于<a href=\"https://docs.getgauge.io/configuration.html#environments\">管理环境</a>的内容。</p>\n<h3 id=\"Specs目录\"><a href=\"#Specs目录\" class=\"headerlink\" title=\"Specs目录\"></a>Specs目录</h3><p>specs目录包含此项目所有的spec文件，它们是用简单的markdown语法编写的业务层spec。</p>\n<p>一个简单的spec示例（example.spec）被建在specs目录中，它易于理解spec的格式。</p>\n<p>学习更多关于<a href=\"https://docs.getgauge.io/syntax.html#spec-syntax\">spec</a>的内容。</p>\n<h3 id=\"manifest文件\"><a href=\"#manifest文件\" class=\"headerlink\" title=\"manifest文件\"></a>manifest文件</h3><p>manifest.json文件包含spec特定的配置，其中包括项目中所需的插件信息。</p>\n<p>项目初始化后，manifest.json文件将具有一下内容：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;language&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Plugins&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;html-report&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Language：编写测试代码的编程语言，Gauge使用对应的Language runner来执行specs。</li>\n<li>Plugins：项目所用的Gauge插件，一些插件会在每个Gauge项目中默认被使用。插件可以通过执行下面的命令添加到项目中：</li>\n</ul>\n<blockquote>\n<p>gauge add <plugin-name></p>\n</blockquote>\n<p>例如：</p>\n<blockquote>\n<p>gauge add xml-report</p>\n</blockquote>\n<p>在运行上面的命令之后，manifest.json文件将会具有以下内容：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;language&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Plugins&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;html-report&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"string\">&quot;xml-report&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>参考信息:<a href=\"https://blog.csdn.net/amoscn/article/details/77855944?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163841644516780271542590%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=163841644516780271542590&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~sobaiduend~default-1-77855944.pc_v2_rank_blog_default&utm_term=gauge&spm=1018.2226.3001.4450\">更多信息</a></p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>Gauge是一流的命令行工具，这意味着您可以完全从命令行进行操作。或者如果您更喜欢使用IDE，那么Gauge也可以与多个IDE进行良好的集成。</p>\n<h2 id=\"命令行接口\"><a href=\"#命令行接口\" class=\"headerlink\" title=\"命令行接口\"></a>命令行接口</h2><p>Gauge具有良好的命令行支持，安装gauge，列出运行支持的子命令/标志。</p>\n<blockquote>\n<p>gauge</p>\n</blockquote>\n<p>这个命令行接口是跨平台的。在GNU/<a href=\"https://so.csdn.net/so/search?from=pc_blog_highlight&q=Linux\">Linux</a>和OSX，你可以使用任意终端，在windows上你可以使用cmd或者Powershell。</p>\n<h3 id=\"help\"><a href=\"#help\" class=\"headerlink\" title=\"help\"></a>help</h3><p>由于子命令或者标识是通过版本被添加或者被弃用，所以建议通过gauge它本身来获取参考。</p>\n<blockquote>\n<p>gauge -v</p>\n<p>gauge help</p>\n</blockquote>\n<h3 id=\"创建项目\"><a href=\"#创建项目\" class=\"headerlink\" title=\"创建项目\"></a>创建项目</h3><p>创建或者初始化项目通过执行</p>\n<blockquote>\n<p>gauge init <template></p>\n</blockquote>\n<p>这里的template可以是python,js,java等等，更多细节可以查看官方文档</p>\n<h3 id=\"执行测试\"><a href=\"#执行测试\" class=\"headerlink\" title=\"执行测试\"></a>执行测试</h3><p>在Gauge项目内，您可以通过调用spec的路径来执行测试。按照惯例，spec存储在项目根目录中的./spec/子目录中。<br>语法是：</p>\n<blockquote>\n<p>gauge run [flags] &lt;path-to=specs&gt;</p>\n</blockquote>\n<p>Gauge命令行实用程序允许多种方式执行要执行的spec。用于执行测试的有效路径可以是：包含spec的目录路径或者sepc文件路径或者scenarios路径或者三种的混合。</p>\n<p>为执行在已有文件夹<code>specs</code>内的所有用例，使用:</p>\n<blockquote>\n<p>gauge run specs/</p>\n</blockquote>\n<p>这将给出一个彩色的控制台输出，其中包括执行细节以及执行摘要。</p>\n<h3 id=\"指定场景\"><a href=\"#指定场景\" class=\"headerlink\" title=\"指定场景\"></a>指定场景</h3><p>可以通过在spec中指定该场景的跨度中的行号来执行spec的单个场景，要执行下列spec中的<code>Admin Login</code> 场景，请使用命令<code>gauge run specs/login_test.spec:4</code></p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Configuration</span></span><br><span class=\"line\"><span class=\"section\">=============</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Admin Login</span></span><br><span class=\"line\"><span class=\"section\">-----------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> User must login as &quot;admin&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Navigate to the configuration page</span><br></pre></td></tr></table></figure>\n\n<p>这仅执行在行号4（即login_test.spec中的<code>Admin Login</code>）中存在的场景。在上述spec中，由于跨度，指定行号4-7会执行相同的场景。</p>\n<p>也可以选择性的执行多种场景如下：</p>\n<blockquote>\n<p>gauge run specs/helloworld.spec:4 specs/helloword.spec:7</p>\n</blockquote>\n<p>这些场景也可以属于不同的spec文件。<br>你也可以指定一个具体的scenario或者scenario列表来执行。要执行scenario，gauge将获取spec文件的路径，后跟冒号和零索引数字（译者注：从0开始的索引）的scenario。</p>\n<p>例如：要执行名为<code>spec1.spec</code>的spec文件的第二个scenario，你应该执行：</p>\n<blockquote>\n<p>gauge run specs/spec1.spec:1</p>\n</blockquote>\n<p>要指定多个scenarios，请添加多个这样的参数。例如，要执行名为<code>spec1.spec</code>的spec文件的第一和第三个scenario，你应该执行：</p>\n<blockquote>\n<p>gauge run specs/spec1.spec:0 specs/spec1.spec:2</p>\n</blockquote>\n<h3 id=\"指定目录\"><a href=\"#指定目录\" class=\"headerlink\" title=\"指定目录\"></a>指定目录</h3><p>你可以指定存储spec文件的一个单独目录，Gauge扫描这个目录，并取出可用的spec文件。<br>例如：</p>\n<blockquote>\n<p>gauge run specs/</p>\n</blockquote>\n<p>你也可以指定存储spec文件的多个目录，Gauge扫描所有的目录内可用的spec文件并在一次运行过程中执行它们。<br>例如：</p>\n<blockquote>\n<p>gauge run specs-dir1/ specs-dir2/ specs-dir3/</p>\n</blockquote>\n<h3 id=\"指定文件\"><a href=\"#指定文件\" class=\"headerlink\" title=\"指定文件\"></a>指定文件</h3><p>你可以指定spec文件的路径，在这种情况下，Gauge仅执行提供的spec文件。<br>例如：要执行一个单独的spec文件：</p>\n<blockquote>\n<p>gauge run specs/spec1.spec</p>\n</blockquote>\n<p>或者，执行多个spec文件：</p>\n<blockquote>\n<p>gauge run specs/spec1.spec specs/spec2.spec specs/spec3.spec</p>\n</blockquote>\n<h3 id=\"详细报告\"><a href=\"#详细报告\" class=\"headerlink\" title=\"详细报告\"></a>详细报告</h3><p>默认情况下，在执行测试中，gauge提供spec级别的报告。您可以使用<code>--verbose</code>标志来启用详细的步骤级别报告。例如：</p>\n<blockquote>\n<p>gauge run –verbose specs/</p>\n</blockquote>\n<h3 id=\"执行中的错误\"><a href=\"#执行中的错误\" class=\"headerlink\" title=\"执行中的错误\"></a>执行中的错误</h3><h4 id=\"spec文件解析错误\"><a href=\"#spec文件解析错误\" class=\"headerlink\" title=\"spec文件解析错误\"></a>spec文件解析错误</h4><p>如果spec文件不符合预期的语法或者无法解析参数，则会发生这种情况。<br>例如：</p>\n<blockquote>\n<p>[ParseError] hello_world.spec : line no: 25, Dynamic parameter could not be resolved</p>\n</blockquote>\n<h4 id=\"spec文件未实现的步骤\"><a href=\"#spec文件未实现的步骤\" class=\"headerlink\" title=\"spec文件未实现的步骤\"></a>spec文件未实现的步骤</h4><p>如果spec文件包含未用项目编程语言实现的步骤，则会出现验证错误。必须要为执行的spec中的所有步骤提供适当的底层代码实现。<br>例如：</p>\n<blockquote>\n<p>login.spec:33: Step implementation not found. login with “user” and “p@ssword”</p>\n</blockquote>\n<h4 id=\"启动语言执行插件失败\"><a href=\"#启动语言执行插件失败\" class=\"headerlink\" title=\"启动语言执行插件失败\"></a>启动语言执行插件失败</h4><p>如果项目中语言特定插件未安装则执行会失败。</p>\n<h3 id=\"数据驱动执行\"><a href=\"#数据驱动执行\" class=\"headerlink\" title=\"数据驱动执行\"></a>数据驱动执行</h3><ul>\n<li>在任何步骤前，数据表格以markdown表格格式定义在spec的开头</li>\n<li>数据表格应该有标题行，且至少有一行数据</li>\n<li>表格中的标题名称，用在有角括号<code>&lt;&gt;</code>的步骤中，用于将数据表中特定列引用为参数</li>\n<li>一次执行，每个场景都会执行表格中的每一行数据</li>\n<li>表格很容易的在IDE中被创建，使用模版<code>table:&lt;no of columns&gt;</code>，然后点击<code>Tab</code>键</li>\n<li>表格参数以多标记表格格式编写</li>\n</ul>\n<p>示例</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Table driven execution</span></span><br><span class=\"line\"><span class=\"section\">======================</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"code\">     |id| name    |</span></span><br><span class=\"line\"><span class=\"code\">     |--|---------|</span></span><br><span class=\"line\"><span class=\"code\">     |1 |vishnu   |</span></span><br><span class=\"line\"><span class=\"code\">     |2 |prateek  |</span></span><br><span class=\"line\"><span class=\"code\">     |3 |navaneeth|</span></span><br><span class=\"line\"><span class=\"code\"></span></span><br><span class=\"line\"><span class=\"section\">Scenario</span></span><br><span class=\"line\"><span class=\"section\">--------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Say &quot;hello&quot; to <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Second Scenario</span></span><br><span class=\"line\"><span class=\"section\">---------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Say &quot;namaste&quot; to <span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span></span></span><br></pre></td></tr></table></figure>\n\n<p>在上面的示例，步骤使用数据表格中的<code>name</code>列作为动态参数。<br><code>Scenario</code>和 <code>Second Scenario</code>都会首先执行第一行数据<code>1,vishnu</code>，然后连续地执行表格中第二和第三行的值。</p>\n<h4 id=\"执行选中的表格数据行\"><a href=\"#执行选中的表格数据行\" class=\"headerlink\" title=\"执行选中的表格数据行\"></a>执行选中的表格数据行</h4><p>默认情况下，spec中的场景会针对所有数据表格行运行。可以使用标志<code>--table-rows</code>针对选定的数据表行运行，并指定应执行场景的行号。如果有多个行号，则应以逗号分隔。<br>例如：</p>\n<blockquote>\n<p>gauge run –table-rows “1” specs/hello.spec</p>\n<p>gauge run –table-rows “1,4,7” specs/hello.spec</p>\n</blockquote>\n<p>针对哪些场景运行，也可以指定表格行范围。<br>例如：</p>\n<blockquote>\n<p>gauge run –table-rows “1-3” specs/hello.spec</p>\n</blockquote>\n<p>这将针对表格行1，2，3执行场景。</p>\n<h4 id=\"执行标签\"><a href=\"#执行标签\" class=\"headerlink\" title=\"执行标签\"></a>执行标签</h4><p>标签允许您快速过滤将要执行的spec和场景。执行标有某些标签的所有specs和场景，使用下面的命令：</p>\n<blockquote>\n<p>gauge run –tags tag1,tag2 spec</p>\n</blockquote>\n<p>或者</p>\n<blockquote>\n<p>gauge run –tags “tag1, tag2” specs</p>\n</blockquote>\n<p>这仅执行标记有<code>tag1</code>和<code>tag2</code>的场景和spec。</p>\n<p>示例：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">Search Specification</span></span><br><span class=\"line\"><span class=\"section\">====================</span></span><br><span class=\"line\">The admin user must be able to search for available projects on the search page.</span><br><span class=\"line\">Tags: search, admin</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> User must be logged in as &quot;admin&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Open the product search page</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Successful search</span></span><br><span class=\"line\"><span class=\"section\">-----------------</span></span><br><span class=\"line\">Tags: successful</span><br><span class=\"line\"></span><br><span class=\"line\">For an existing product name, the search result will contain the product name.</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> Search for product &quot;Die Hard&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> &quot;Die Hard&quot; should show up in the search results</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Unsuccessful search</span></span><br><span class=\"line\"><span class=\"section\">-------------------</span></span><br><span class=\"line\">On an unknown product name search the search results will be empty</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"bullet\">*</span> Search for product &quot;unknown&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> The search results will be empty</span><br></pre></td></tr></table></figure>\n\n<p>在上述spec中，如果想要标记有”search”和”admin”的所有场景被执行，使用下列命令：</p>\n<blockquote>\n<p>gauge run –tags “search &amp; admin” SPEC_FILE_NAME</p>\n</blockquote>\n<h4 id=\"标签表达式\"><a href=\"#标签表达式\" class=\"headerlink\" title=\"标签表达式\"></a>标签表达式</h4><p>标签可以通过表达式被选中，例如：</p>\n<table>\n<thead>\n<tr>\n<th align=\"center\">Tags</th>\n<th align=\"left\">Selects specs/scenario that</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"center\">!TagA</td>\n<td align=\"left\">do not have TagA</td>\n</tr>\n<tr>\n<td align=\"center\">TagA &amp; TagB</td>\n<td align=\"left\">have both TagA and TagB.</td>\n</tr>\n<tr>\n<td align=\"center\">TagA &amp; !TagB</td>\n<td align=\"left\">have TagA and not TagB.</td>\n</tr>\n<tr>\n<td align=\"center\">TagA | TagB</td>\n<td align=\"left\">have either TagA or TagB.</td>\n</tr>\n<tr>\n<td align=\"center\">(TagA &amp; TagB) | TagC</td>\n<td align=\"left\">have either TagC or both TagA and TagB</td>\n</tr>\n<tr>\n<td align=\"center\">!(TagA &amp; TagB) | TagC</td>\n<td align=\"left\">have either TagC or do not have both TagA and TagB</td>\n</tr>\n<tr>\n<td align=\"center\">(TagA | TagB) &amp; TagC</td>\n<td align=\"left\">have either [TagA and TagC] or [TagB and TagC]</td>\n</tr>\n</tbody></table>\n<h4 id=\"并行执行\"><a href=\"#并行执行\" class=\"headerlink\" title=\"并行执行\"></a>并行执行</h4><p>可以并行执行spec以更快的运行测试并分发负载。<br>这可以通过命令完成：</p>\n<blockquote>\n<p>gauge run –parallel specs</p>\n<p>gauge run -p specs</p>\n</blockquote>\n<p>这根据机器的核数量创建多个执行流，并在执行者之间分配负载。<br>并行执行流数量可以通过<code>-n</code>标志指定。<br>例如：</p>\n<blockquote>\n<p>gauge run –parallel -n=4 specs</p>\n</blockquote>\n<p>这会创建四个并行执行流。</p>\n<p>备注<br>执行流数量的指定应该是由机器的可用CPU核数量决定，超过此数量可能会导致不良结果。要进行优化，请尝试使用线程并行执行（译者注：下一节）。</p>\n<h4 id=\"使用线程并行执行\"><a href=\"#使用线程并行执行\" class=\"headerlink\" title=\"使用线程并行执行\"></a>使用线程并行执行</h4><p>在并行执行中，每个执行流会启动一个新的工作者进程。这可以通过使用多线程取代进程来优化。这样进行并行执行只有一个工作进程且启动多个线程。<br>为使用它，设置<code>enable_multithreading</code>环境变量为true。这个属性也可以添加到默认/自定义环境。</p>\n<blockquote>\n<p>enable_multithreading = true</p>\n</blockquote>\n<p>必要条件：</p>\n<ul>\n<li>线程安全测试代码</li>\n<li>语言执行插件应该支持多线程</li>\n</ul>\n<p>备注：目前，这个功能只有 Java语言插件支持。</p>\n<h4 id=\"执行一组spec\"><a href=\"#执行一组spec\" class=\"headerlink\" title=\"执行一组spec\"></a>执行一组spec</h4><p>spec可以分成组，并且<code>--group</code>和<code>-g</code>标志提供执行特定组的功能。<br>可以通过下面的命令完成：</p>\n<blockquote>\n<p>gauge run -n=4 -g=2 specs</p>\n</blockquote>\n<p>上述创建4组（由<code>-n</code>标志提供）spec，并且执行第二个（由<code>-g</code>提供）组。<br>spec按照字母顺序排序，然后分成组，保证每个组都有相同的spec集合，无论执行多少次。<br>例如：</p>\n<blockquote>\n<p>gauge run -n=4 -g=2 specs</p>\n<p>gauge run -n=4 -g=2 specs</p>\n</blockquote>\n<p>上面的两条命令将会执行同样的一组spec。</p>\n<h4 id=\"懒惰分配测试执行您的测试套件\"><a href=\"#懒惰分配测试执行您的测试套件\" class=\"headerlink\" title=\"懒惰分配测试执行您的测试套件\"></a>懒惰分配测试执行您的测试套件</h4><p>此功能允许您在执行期间动态分配spec给工作流，而不是在执行开始时。<br>这使得Gauge可以优化您的代理/执行环境的资源。这是有用的，因为某些spec可能需要比其他spec更多的时间，因为它们中的场景数量或者被测功能的性质。<br>以下命令将在指定数量的流中分配测试：</p>\n<blockquote>\n<p>gauge run -n=4 –strategy=”lazy” specs</p>\n</blockquote>\n<p>或者</p>\n<blockquote>\n<p>gauge run -n=4 specs</p>\n</blockquote>\n<p>假设您有100个测试用例，您选择运行4个流/核心；在执行期间，懒惰分配将动态地将下一个spec分配给已完成先前执行的流并等待更多工作的流。</p>\n<p>懒惰分配测试是默认的行为。</p>\n<p>根据需求，另一种叫做<code>eager</code>的策略也是有用的。在这种情况下，100个测试用例在执行之前分发，从而使它们的数量相等。</p>\n<blockquote>\n<p>gauge run -n=4 –strategy=”eager” specs</p>\n</blockquote>\n<p>备注：懒惰策略只有在你未使用<code>-g</code>标志时生效。这是因为分组依赖于开始执行之前测试的分配。结合懒惰策略使用它将不会对您的测试套件执行产生影响。</p>\n<h4 id=\"重新执行一个执行流\"><a href=\"#重新执行一个执行流\" class=\"headerlink\" title=\"重新执行一个执行流\"></a>重新执行一个执行流</h4><p>spec可以分成组，<code>--group</code> 和 <code>-g</code>提供执行具体组的功能。</p>\n<p>可以通过下列命令完成：</p>\n<blockquote>\n<p>gauge run -n=4 -g=2 specs</p>\n</blockquote>\n<p>上述创建4组（由<code>-n</code>标志提供）spec，并且执行第二个（由<code>-g</code>提供）组。<br>spec按照字母顺序排序，然后分成组，保证每个组都有相同的spec集合，无论执行多少次。<br>例如：</p>\n<blockquote>\n<p>gauge run -n=4 -g=2 specs</p>\n<p>gauge run -n=4 -g=2 specs</p>\n</blockquote>\n<p>上面的两条命令将会执行同样的一组spec。</p>\n<h3 id=\"Hook中的当前执行上下文\"><a href=\"#Hook中的当前执行上下文\" class=\"headerlink\" title=\"Hook中的当前执行上下文\"></a>Hook中的当前执行上下文</h3><ul>\n<li>要获取有关当前spec，场景，步骤执行的其他信息，可以在hooks方法中添加一个附加的<code>ExecutionContext</code>参数。</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@BeforeScenario</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">loginUser</span><span class=\"params\">(ExecutionContext context)</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">String</span> <span class=\"variable\">scenarioName</span> <span class=\"operator\">=</span> context.getCurrentScenario().getName();</span><br><span class=\"line\">  <span class=\"comment\">// Code for before scenario</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">@AfterSpec</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">performAfterSpec</span><span class=\"params\">(ExecutionContext context)</span> &#123;</span><br><span class=\"line\">  <span class=\"type\">Specification</span> <span class=\"variable\">currentSpecification</span> <span class=\"operator\">=</span> context.getCurrentSpecification();</span><br><span class=\"line\">  <span class=\"comment\">// Code for after step</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"基于标签过滤Hooks执行\"><a href=\"#基于标签过滤Hooks执行\" class=\"headerlink\" title=\"基于标签过滤Hooks执行\"></a>基于标签过滤Hooks执行</h3><p>您可以指定执行hooks可以运行的标签，这将确保hook仅在具有所需标签的场景和spec上运行。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// A before spec hook that runs when tag1 and tag2</span></span><br><span class=\"line\"><span class=\"comment\">// is present in the current scenario and spec.</span></span><br><span class=\"line\"><span class=\"meta\">@BeforeSpec(tags = &#123;&quot;tag1, tag2&quot;&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">loginUser</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Code forbefore scenario</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// A after step hook runs when tag1 or tag2</span></span><br><span class=\"line\"><span class=\"comment\">// is present in the currentscenario and spec.</span></span><br><span class=\"line\"><span class=\"comment\">// Default tagAggregation value is Operator.AND.</span></span><br><span class=\"line\"><span class=\"meta\">@AfterStep(tags = &#123;&quot;tag1&quot;, &quot;tag2&quot;&#125;, tagAggregation = Operator.OR)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">performAfterStep</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Code for after step</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>备注：<br>标签不能被指定在<code>@BeforeSuite</code>和<code>@AfterSuite</code>hooks上.</p>\n<h2 id=\"Gauge项目模版\"><a href=\"#Gauge项目模版\" class=\"headerlink\" title=\"Gauge项目模版\"></a>Gauge项目模版</h2><p>Gauge提供的模版可用于引导初始化Gauge项目的过程以及合适的构建依赖工具，webdriver等。</p>\n<p>运行下面的命令，列出所有gauge项目可用的模版：</p>\n<blockquote>\n<p>gauge init –templates</p>\n</blockquote>\n<p>这些模版也可以在<a href=\"https://bintray.com/gauge/Templates/gauge-templates/view#files\">Bintray网站Gauge模版</a>处找到。</p>\n<h3 id=\"通过模版初始化Gauge项目\"><a href=\"#通过模版初始化Gauge项目\" class=\"headerlink\" title=\"通过模版初始化Gauge项目\"></a>通过模版初始化Gauge项目</h3><p>假如您想使用Java编写测试代码以及Selenium作为驱动来初始化Gauge项目。</p>\n<p>您可以通过使用<code>java_maven_selenium</code>gauge模版快速设置此项目，该项目已准备好开始使用selenium编写测试 。</p>\n<p>要使用模版初始化gauge项目，从运行<code>gauge init --templates</code>后展示的名字选择其一然后在初始化gauge项目时将此名作为参数传入。</p>\n<p>例如，为创建使用<code>java_maven_selenium</code>模版的gauge项目，你需要运行下面的命令：</p>\n<blockquote>\n<p>gauge init java_maven_selenium</p>\n</blockquote>\n<p>此模版将maven作为构建工具以及selenium作为webdrvier来创建gauge项目， 这将会下载gauge模版<code>java_maven_selenium</code>然后使用有用的示例代码设置您的项目。</p>\n<p>现在，您可以开始编写spec然后执行它们。</p>\n<h2 id=\"步骤别名\"><a href=\"#步骤别名\" class=\"headerlink\" title=\"步骤别名\"></a>步骤别名</h2><p>多个步骤名称对应相同的实现，所有步骤名称的参数的数量和类型必须与实现上的参数数量想匹配。</p>\n<h3 id=\"用例\"><a href=\"#用例\" class=\"headerlink\" title=\"用例\"></a>用例</h3><p>可能在一些情况下，在创作spec的时候，您可能希望以不同的方式表达相同的功能，以使得spec更容易阅读。</p>\n<h4 id=\"示例1\"><a href=\"#示例1\" class=\"headerlink\" title=\"示例1\"></a>示例1</h4><figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">User Creation</span></span><br><span class=\"line\"><span class=\"section\">=============</span></span><br><span class=\"line\"><span class=\"section\">Multiple Users</span></span><br><span class=\"line\"><span class=\"section\">--------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> Create a user &quot;user 1&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Verify &quot;user 1&quot; has access to dashboard</span><br><span class=\"line\"><span class=\"bullet\">*</span> Create another user &quot;user 2&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> Verify &quot;user 2&quot; has access to dashboard</span><br></pre></td></tr></table></figure>\n\n<p>在名为Multiple Users的场景里，第一和第三步的底层功能是一样的，但是它们的表达是不一样的。这有助于更清楚的传达意图和功能。在这样的情况下，应该使用步骤别名功能，以便您可以在代码级别实践DRY原则，同事确保功能被清楚的表达.</p>\n<p><strong>实现</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Users</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Step(&#123;&quot;Create a user &lt;user_name&gt;&quot;, &quot;Create another user &lt;user_name&gt;&quot;&#125;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">helloWorld</span><span class=\"params\">(String user_name)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// create user user_name</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><strong>示例2</strong></p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">User Creation</span></span><br><span class=\"line\"><span class=\"section\">-------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> User creates a new account</span><br><span class=\"line\"><span class=\"bullet\">*</span> A &quot;welcome&quot; email is sent to the user</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"section\">Shopping Cart</span></span><br><span class=\"line\"><span class=\"section\">-------------</span></span><br><span class=\"line\"><span class=\"bullet\">*</span> User checks out the shopping cart</span><br><span class=\"line\"><span class=\"bullet\">*</span> Payment is successfully received</span><br><span class=\"line\"><span class=\"bullet\">*</span> An email confirming the &quot;order&quot; is sent</span><br></pre></td></tr></table></figure>\n\n<p>在此用例中，两个场景的最后一行（发送邮件）底层功能是一样的，但是使用别名后表达更清楚。底层的步骤实现可能是这样的。</p>\n<p>实现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Users</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Step(&#123;&quot;A &lt;email_type&gt; email is sent to the user&quot;, &quot;An email confirming the &lt;email_type&gt; is sent&quot;&#125;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">helloWorld</span><span class=\"params\">(String email_type)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Send email of email_type</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"失败用例重新运行\"><a href=\"#失败用例重新运行\" class=\"headerlink\" title=\"失败用例重新运行\"></a>失败用例重新运行</h2><p>Gauge提供仅重新执行上次执行过程中失败场景的功能。失败场景运行可以通过使用gauge标签<code>--failed</code>。</p>\n<p>假如您运行<code>gauge run specs</code>后3个场景失败了，您通过下面的命令，可以仅仅重新执行失败场景而不是执行所有的场景。</p>\n<blockquote>\n<p>gauge run –failed</p>\n</blockquote>\n<p>这个命令甚至会设置在您上次运行中提供的标志，例如：如果您已经执行了下列命令：</p>\n<blockquote>\n<p>gauge run –env=”chrome” –verbose specs</p>\n</blockquote>\n<p>并且三个场景在这次运行过程中失败了，<code>gauge run --failed</code>命令设置<code>--env</code> 和<code>--verbose</code>标志为对应的值然后仅仅执行失败的三个场景。这个情况下<code>gauge run --failed</code>相当于命令:</p>\n<blockquote>\n<p>gauge run –env=”chrome” –verbose specs <path_to_failed_scenarios></p>\n</blockquote>\n<h2 id=\"重构\"><a href=\"#重构\" class=\"headerlink\" title=\"重构\"></a>重构</h2><h3 id=\"改写步骤\"><a href=\"#改写步骤\" class=\"headerlink\" title=\"改写步骤\"></a>改写步骤</h3><p>Gauge允许您改写项目中的步骤，改写步骤运行：</p>\n<blockquote>\n<p>gauge refactor “old step <name>“ “new step name”</p>\n</blockquote>\n<p>这里<code>&lt;</code>和<code>&gt;</code>用来表示步骤中的参数。参数可以在改写过程中被添加，被移除或者被修改。</p>\n<p>这样会修改所有的spec文件以及代码文件（用于支持重构的语言插件）。</p>\n<h4 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h4><p>假设我们的spec文件有以下步骤：</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> create user &quot;john&quot; with id &quot;123&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> create user &quot;mark&quot; with id &quot;345&quot;</span><br></pre></td></tr></table></figure>\n\n<p>现在，如果你需要添加一个额外的参数<code>last name</code>在这个步骤里，我们可以执行下面的命令：</p>\n<blockquote>\n<p>gauge refactor “create user <name> with id <id>“ “create user <name> with <id> and last name <watson>“</p>\n</blockquote>\n<p>这将修改所有的spec文件已反映修改。</p>\n<figure class=\"highlight markdown\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"bullet\">*</span> create user &quot;john&quot; with id &quot;123&quot; and last name &quot;watson&quot;</span><br><span class=\"line\"><span class=\"bullet\">*</span> create user &quot;mark&quot; with id &quot;345&quot; and last name &quot;watson&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"项目结构体\"><a href=\"#项目结构体\" class=\"headerlink\" title=\"项目结构体\"></a>项目结构体</h3><p>在初始化特定语言的gauge项目时，将使用以下文件创建项目框架：</p>\n<h3 id=\"通用Gauge文件\"><a href=\"#通用Gauge文件\" class=\"headerlink\" title=\"通用Gauge文件\"></a>通用Gauge文件</h3><p>GAUGE_PROJECT_ROOT环境变量保存创建Gauge项目的路径。</p>\n<blockquote>\n<p>├── env<br>│ └── default<br>│ └── default.properties<br>├── manifest.json<br>├── specs<br>│ └── example.spec</p>\n</blockquote>\n<h3 id=\"Env目录\"><a href=\"#Env目录\" class=\"headerlink\" title=\"Env目录\"></a>Env目录</h3><p>env目录包含多个环境特定的目录，每个目录都有.property文件，用于定义在特定环境执行期间设置的环境变量。</p>\n<p>env/default目录是在项目初始化的时候创建，包含执行过程中设置的默认环境变量。</p>\n<p>学习更多关于<a href=\"https://docs.getgauge.io/configuration.html#environments\">管理环境</a>的内容。</p>\n<h3 id=\"Specs目录\"><a href=\"#Specs目录\" class=\"headerlink\" title=\"Specs目录\"></a>Specs目录</h3><p>specs目录包含此项目所有的spec文件，它们是用简单的markdown语法编写的业务层spec。</p>\n<p>一个简单的spec示例（example.spec）被建在specs目录中，它易于理解spec的格式。</p>\n<p>学习更多关于<a href=\"https://docs.getgauge.io/syntax.html#spec-syntax\">spec</a>的内容。</p>\n<h3 id=\"manifest文件\"><a href=\"#manifest文件\" class=\"headerlink\" title=\"manifest文件\"></a>manifest文件</h3><p>manifest.json文件包含spec特定的配置，其中包括项目中所需的插件信息。</p>\n<p>项目初始化后，manifest.json文件将具有一下内容：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;language&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Plugins&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;html-report&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Language：编写测试代码的编程语言，Gauge使用对应的Language runner来执行specs。</li>\n<li>Plugins：项目所用的Gauge插件，一些插件会在每个Gauge项目中默认被使用。插件可以通过执行下面的命令添加到项目中：</li>\n</ul>\n<blockquote>\n<p>gauge add <plugin-name></p>\n</blockquote>\n<p>例如：</p>\n<blockquote>\n<p>gauge add xml-report</p>\n</blockquote>\n<p>在运行上面的命令之后，manifest.json文件将会具有以下内容：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Language&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;&lt;language&gt;&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;Plugins&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"string\">&quot;html-report&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"string\">&quot;xml-report&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>参考信息:<a href=\"https://blog.csdn.net/amoscn/article/details/77855944?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163841644516780271542590%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=163841644516780271542590&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~sobaiduend~default-1-77855944.pc_v2_rank_blog_default&utm_term=gauge&spm=1018.2226.3001.4450\">更多信息</a></p>\n"},{"uuid":"bbaf6f28-c0ab-11ec-92a1-7557b2313227","title":"spring-@Value","abbrlink":"5295323d","_content":"\n## 前言 \n\n对于从事java开发工作的小伙伴来说，spring框架肯定再熟悉不过了。spring给开发者提供了非常丰富的api，满足我们日常的工作需求。\n\n如果想要创建bean实例，可以使用@Controller、@Service、@Repository、@Component等注解。\n\n如果想要依赖注入某个对象，可以使用@Autowired和@Resource注解。\n\n如果想要开启事务，可以使用@Transactional注解。\n\n如果想要动态读取配置文件中的某个系统属性，可以使用@Value注解。\n\n等等，还有很多。。。\n\n今天咱们重点聊聊`@Value`注解，因为它是一个非常有用，但极其容易被忽视的注解，绝大多数人可能只用过它的一部分功能，这是一件非常遗憾的事情。\n\n所以今天有必要和大家一起，重新认识一下`@Value`。![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191639922)\n\n## 1. 由一个例子开始 \n\n假如在UserService类中，需要注入系统属性到userName变量中。通常情况下，我们会写出如下的代码：\n\n```\n@Service\npublic class UserService {\n\n    @Value(\"${susan.test.userName}\")\n    private String userName;\n\n    public String test() {\n        System.out.println(userName);\n        return userName;\n    }\n}\n```\n\n通过`@Value`注解指定系统属性的名称`susan.test.userName`，该名称需要使用`${}`包起来。\n\n这样spring就会自动的帮我们把对应的系统属性值，注入到userName变量中。\n\n不过，上面功能的重点是要在`applicationContext.properties`文件（简称：配置文件）中配置同名的系统属性：\n\n```\n#张三\nsusan.test.userName=\\u5f20\\u4e09\n```\n\n那么，名称真的必须完全相同吗？\n\n## 2. 关于属性名\n\n这时候，有些朋友可能会说：在`@ConfigurationProperties`配置类中，定义的参数名可以跟配置文件中的系统属性名不同。\n\n比如，在配置类MyConfig类中定义的参数名是userName：\n\n```\n@Configuration\n@ConfigurationProperties(prefix = \"susan.test\")\n@Data\npublic class MyConfig {\n    private String userName;\n}\n```\n\n而配置文件中配置的系统属性名是：\n\n```\nsusan.test.user-name=\\u5f20\\u4e09\n```\n\n类中用的`userName`，而配置文件中用的`user-name`，不一样。但测试之后，发现该功能能够正常运行。\n\n配置文件中的系统属性名用 `驼峰标识` 或 `小写字母加中划线的组合`，spring都能找到配置类中的属性名userName进行赋值。\n\n由此可见，配置文件中的系统属性名，可以跟配置类中的属性名不一样。不过，有个前提，前缀susan.test必须相同。\n\n那么，`@Value`注解中定义的系统属性名也可以不一样吗？\n\n答案：不能。如果不一样，启动项目时会直接报错。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191639512)此外，如果只在@Value注解中指定了系统属性名，但实际在配置文件中没有配置它，也会报跟上面一样的错。\n\n所以，**@Value注解中指定的系统属性名，必须跟配置文件中的相同。**\n\n## 3. 乱码问题\n\n不知道细心的小伙伴们有没有发现，我配置的属性值：`张三`，其实是`转义`过的。\n\n```\nsusan.test.userName=\\u5f20\\u4e09\n```\n\n为什么要做这个转义？\n\n假如在配置文件中配置中文的张三：\n\n```\nsusan.test.userName=张三\n```\n\n最后获取数据时，你会发现userName竟然出现了乱码：\n\n> å¼ ä¸\n\nwhat？\n\n为什么会出现乱码？\n\n答：在springboot的`CharacterReader`类中，默认的编码格式是`ISO-8859-1`，该类负责`.properties`文件中系统属性的读取。如果系统属性包含中文字符，就会出现乱码。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191639539)那么，如何解决乱码问题呢？\n\n目前主要有如下三种方案：\n\n1. 手动将ISO-8859-1格式的属性值，转换成UTF-8格式。\n2. 设置encoding参数，不过这个只对@PropertySource注解有用。\n3. 将中文字符用unicode编码转义。\n\n显然@Value不支持encoding参数，所以方案2不行。\n\n假如使用方案1，具体实现代码如下：\n\n```\n@Service\npublic class UserService {\n\n    @Value(value = \"${susan.test.userName}\")\n    private String userName;\n\n    public String test() {\n        String userName1 = new String(userName.getBytes(StandardCharsets.ISO_8859_1), StandardCharsets.UTF_8);\n        System.out.println();\n        return userName1;\n    }\n}\n```\n\n确实可以解决乱码问题。\n\n但如果项目中包含大量中文系统属性值，每次都需要加这样一段特殊转换代码。出现大量重复代码，有没有觉得有点恶心？\n\n反转我被恶心到了。\n\n那么，如何解决代码重复问题呢？\n\n答：将属性值的中文内容转换成unicode。\n\n类似于这样的：\n\n```\nsusan.test.userName=\\u5f20\\u4e09\n```\n\n这种方式同样能解决乱码问题，不会出现恶心的重复代码。但需要做一点额外的转换工作，不过这个转换非常容易，因为有现成的在线转换工具。\n\n> 推荐使用这个工具转换：http://www.jsons.cn/unicode/\n\n在这里顺便告诉你一个小秘密：如果你使用的是`.yml`或`.yaml`格式的配置文件，并不会出现中文乱码问题。\n\n这又是为什么？\n\n因为.yml或.yaml格式的配置文件，最终会使用`UnicodeReader`类进行解析，它的`init`方法中，首先读取BOM文件头信息，如果头信息中有UTF8、UTF16BE、UTF16LE，就采用对应的编码，如果没有，则采用默认`UTF8`编码。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191639766)\n\n> 需要注意的是：乱码问题一般出现在本地环境，因为本地直接读取的.properties配置文件。在dev、test、生产等环境，如果从zookeeper、apollo、nacos等配置中心中获取系统参数值，走的是另外的逻辑，并不会出现乱码问题。\n\n## 4.默认值\n\n有时候，默认值是我们非常头疼的问题。\n\n为什么这样说呢？\n\n因为很多时候使用java的默认值，并不能满足我们的日常工作需求。\n\n比如有这样一个需求：如果配置了系统属性，userName就用配置的属性值。如果没有配置，则userName用默认值susan。\n\n有些朋友可能认为可以这样做：\n\n```\n@Value(value = \"${susan.test.userName}\")\nprivate String userName = \"susan\";\n```\n\n在定义参数时直接给个默认值，但如果仔细想想这招是行不通的的。因为设置userName默认值的时机，比@Value注解依赖注入属性值要早，也就是说userName初始化好了默认值，后面还是会被覆盖。\n\n那么，到底该如何设置默认值呢？\n\n答：使用`:`。\n\n例如：\n\n```\n@Value(value = \"${susan.test.userName:susan}\")\nprivate String userName;\n```\n\n在需要设置默认值的系统属性名后，加`:`符号。紧接着，在`:`右边设置默认值。\n\n建议大家平时在使用@Value时，尽量都设置一个默认值。如果不需要默认值，宁可设置一个空。比如：\n\n```\n@Value(value = \"${susan.test.userName:}\")\nprivate String userName;\n```\n\n为什么这么说？\n\n假如有这种场景：在business层中包含了UserService类，business层被api服务和job服务都引用了。但UserService类中@Value的userName只在api服务中有用，在job服务中根本用不到该属性。\n\n对于job服务来说，如果不在.properties文件中配置同名的系统属性，则服务启动时就会报错。\n\n这个坑，我之前踩过多次。所以，建议大家，使用@Value注解时，最好给参数设置一个默认值，以防止出现类似的问题。\n\n## 5. static变量\n\n前面我们已经见识过，如何使用@Value注解，给类的`成员变量`注入`系统属性值`。\n\n那么，问题来了，`静态变量`可以自动注入系统属性值不？\n\n我们一起看看，假如将上面的userName定义成`static`的：\n\n```\n@Value(\"${susan.test.userName}\")\nprivate static String userName;\n```\n\n程序可以正常启动，但是获取到userName的值却是null。\n\n由此可见，被`static`修饰的变量通过@Value会注入失败。\n\n作为好奇宝宝的你，此时肯定想问：如何才能给静态变量注入系统属性值呢？\n\n答：这就需要使用如下的骚代码了：\n\n```\n@Service\npublic class UserService {\n\n    private static String userName;\n\n    @Value(\"${susan.test.userName}\")\n    public void setUserName(String userName) {\n        UserService.userName = userName;\n    }\n\n    public String test() {\n        return userName;\n    }\n}\n```\n\n提供一个静态参数的`setter`方法，在该方法上使用@Value注入属性值，并且同时在该方法中给静态变量赋值。\n\n有些细心的朋友可能会发现，@Value注解在这里竟然使用在setUserName方法上了，也就是对应的setter方法，而不是在变量上。\n\n有趣，有趣，这种用法有点高端喔。\n\n不过，通常情况下，我们一般会在pojo实体类上，使用lombok的@Data、@Setter、@Getter等注解，在编译时动态增加setter或getter方法，所以@Value用在方法上的场景其实不多。\n\n## 6.变量类型\n\n上面的内容，都是用的字符串类型的变量进行举例的。其实，@Value注解还支持其他多种类型的系统属性值的注入。\n\n### 6.1 基本类型\n\n众所周知，在Java中的基本数据类型有4类8种，然我们一起回顾一下：\n\n- 整型：byte、short、int、long\n- 浮点型：float、double\n- 布尔型：boolean\n- 字符型：char\n\n相对应地提供了8种包装类：\n\n- 整型：Byte、Short、Integer、Long\n- 浮点型：Float、Double\n- 布尔型：Boolean\n- 字符型：Character\n\n@Value注解对这8中基本类型和相应的包装类，有非常良好的支持，例如：\n\n```\n@Value(\"${susan.test.a:1}\")\nprivate byte a;\n\n@Value(\"${susan.test.b:100}\")\nprivate short b;\n\n@Value(\"${susan.test.c:3000}\")\nprivate int c;\n\n@Value(\"${susan.test.d:4000000}\")\nprivate long d;\n\n@Value(\"${susan.test.e:5.2}\")\nprivate float e;\n\n@Value(\"${susan.test.f:6.1}\")\nprivate double f;\n\n@Value(\"${susan.test.g:false}\")\nprivate boolean g;\n\n@Value(\"${susan.test.h:h}\")\nprivate char h;\n\n@Value(\"${susan.test.a:1}\")\nprivate byte a1;\n\n@Value(\"${susan.test.b:100}\")\nprivate Short b1;\n\n@Value(\"${susan.test.c:3000}\")\nprivate Integer c1;\n\n@Value(\"${susan.test.d:4000000}\")\nprivate Long d1;\n\n@Value(\"${susan.test.e:5.2}\")\nprivate Float e1;\n\n@Value(\"${susan.test.f:6.1}\")\nprivate Double f1;\n\n@Value(\"${susan.test.g:false}\")\nprivate Boolean g1;\n\n@Value(\"${susan.test.h:h}\")\nprivate Character h1;\n```\n\n有了这些常用的数据类型，我们在定义变量类型时，可以非常愉快的玩耍了，不用做额外的转换。\n\n### 6.2 数组\n\n但只用上面的基本类型是不够的，特别是很多需要批量处理数据的场景中。这时候可以使用`数组`，它在日常开发中使用的频率很高。\n\n我们在定义数组时可以这样写：\n\n```\n@Value(\"${susan.test.array:1,2,3,4,5}\")\nprivate int[] array;\n```\n\nspring默认使用逗号分隔参数值。\n\n如果用空格分隔，例如：\n\n```\n@Value(\"${susan.test.array:1 2 3 4 5}\")\nprivate int[] array;\n```\n\nspring会自动把空格去掉，导致数据中只有一个值：12345，注意千万别搞错了。\n\n顺便说一下，定义数组的时候，里面还是有挺多门道的。比如上面列子中，我的数据是：1,2,3,4,5。\n\n如果我们把数组定义成：short、int、long、char、string类型，spring是可以正常注入属性值的。\n\n但如果把数组定义成：float、double类型，启动项目时就会直接报错。\n\n![图片](https://raw.githubusercontent.com/lanbai1993/book/master/spring/images/202110281648428)小伙伴们，下巴惊掉了没？\n\n按理说，1,2,3,4,5用float、double是能够表示的呀，为什么会报错？\n\n如果使用int的包装类，比如：\n\n```\n@Value(\"${susan.test.array:1,2,3,4,5}\")\nprivate Integer[] array;\n```\n\n启动项目时同样会报上面的异常。\n\n此外，定义数组时一定要注意属性值的类型，必须完全一致才可以，如果出现下面这种情况：\n\n```\n@Value(\"${susan.test.array:1.0,abc,3,4,5}\")\nprivate int[] array;\n```\n\n属性值中包含了1.0和abc，显然都无法将该字符串转换成int。\n\n### 6.3 集合类\n\n有了基本类型和数组，的确让我们更加方便了。但对数据的处理，只用数组这一种数据结构是远远不够的，下面给大家介绍一下其他的常用数据结构。\n\n#### 6.3.1 List\n\nList是数组的变种，它的长度是可变的，而数组的长度是固定的。\n\n我们看看List是如何注入属性值的：\n\n```\n@Value(\"${susan.test.list}\")\nprivate List<String> list;\n```\n\n最关键的是看配置文件：\n\n```\nsusan.test.list[0]=10\nsusan.test.list[1]=11\nsusan.test.list[2]=12\nsusan.test.list[3]=13\n```\n\n当你满怀希望的启动项目，准备使用这个功能的时候，却发现竟然报错了。\n\n![图片](https://raw.githubusercontent.com/lanbai1993/book/master/spring/images/202110281648919)what?\n\n看来@Value不支持这种直接的List注入。\n\n那么，如何解决这个问题呢？\n\n有人说用`@ConfigurationProperties`。\n\n需要定义一个MyConfig类：\n\n```\n@Configuration\n@ConfigurationProperties(prefix = \"susan.test\")\n@Data\npublic class MyConfig {\n    private List<String> list;\n}\n```\n\n然后在调用的地方这样写：\n\n```\n@Service\npublic class UserService {\n\n    @Autowired\n    private MyConfig myConfig;\n\n    public String test() {\n        System.out.println(myConfig.getList());\n        return null;\n    }\n}\n```\n\n这种方法确实能够完成List注入。但是，只能说明@ConfigurationProperties注解的强大，跟@Value有半毛钱的关系？\n\n答：没有。\n\n那么，问题来了，用@Value如何实现这个功能呢？\n\n答：使用spring的EL表达式。\n\nList的定义改成：\n\n```\n@Value(\"#{'${susan.test.list}'.split(',')}\")\nprivate List<String> list;\n```\n\n使用`#`号加大括号的EL表达式。\n\n然后配置文件改成：\n\n```\nsusan.test.list=10,11,12,13\n```\n\n跟定义数组时的配置文件一样。\n\n#### 6.3.2 Set\n\nSet也是一种保存数据的集合，它比较特殊，里面保存的数据不会重复。\n\n我们可以这样定义Set：\n\n```\n@Value(\"#{'${susan.test.set}'.split(',')}\")\nprivate Set<String> set;\n```\n\n配置文件是这样的：\n\n```\nsusan.test.set=10,11,12,13\n```\n\nSet跟List的用法极为相似。\n\n但为了证明本节的独特之处，我打算说点新鲜的内容。\n\n如何给List或者Set设置默认值空呢？\n\n有些朋友可能会说：这还不简单，直接在@Value的$表达式后面加个:号不就行了。\n\n具体代码如下：\n\n```\n@Value(\"#{'${susan.test.set:}'.split(',')}\")\nprivate Set<String> set;\n```\n\n结果却跟想象中不太一样：![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191640261)Set集合怎么不是空的，而是包含了一个空字符串的集合？\n\n好吧，那我在:号后加null，总可以了吧？![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191640025)Set集合也不是空的，而是包含了一个\"null\"字符串的集合。\n\n这也不行，那也不行，该如何是好？\n\n答：使用EL表达式的`empty`方法。\n\n具体代码如下：\n\n```\n@Value(\"#{'${susan.test.set:}'.empty ? null : '${susan.test.set:}'.split(',')}\")\nprivate Set<String> set;\n```\n\n运行之后，结果对了：![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191640790)\n\n其实List也有类似的问题，也能使用该方法解决问题。\n\n> 在这里温馨的提醒一下，该判断的表达式比较复杂，自己手写非常容易写错，建议复制粘贴之后根据实际需求改改。\n\n#### 6.3.3 Map\n\n还有一种比较常用的集合是map，它支持key/value键值对的形式保存数据，并且不会出现相同key的数据。\n\n我们可以这样定义Map：\n\n```\n@Value(\"#{${susan.test.map}}\")\nprivate Map<String, String> map;\n```\n\n配置文件是这样的：\n\n```\nsusan.test.map={\"name\":\"苏三\", \"age\":\"18\"}\n```\n\n这种用法跟上面稍微有一点区别。\n\n设置默认值的代码如下：\n\n```\n@Value(\"#{'${susan.test.map:}'.empty ? null : '${susan.test.map:}'}\")\nprivate Map<String, String> map;\n```\n\n## 7 EL高端玩法\n\n前面我们已经见识过spring EL表达式的用法了，在设置空的默认值时特别有用。\n\n其实，`empty`方法只是它很普通的用法，还有更高端的用法，不信我们一起看看。\n\n### 7.1 注入bean\n\n以前我们注入bean，一般都是用的@Autowired或者@Resource注解。例如：\n\n```\n@Service\npublic class RoleService {\n    public String getRoleName() {\n        return \"管理员\";\n    }\n}\n\n@Service\npublic class UserService {\n\n    @Autowired\n    private RoleService roleService;\n\n    public String test() {\n        System.out.println(roleService.getRoleName());\n        return null;\n    }\n}\n```\n\n但我要告诉你的是@Value注解也可以注入bean，它是这么做的：\n\n```\n@Value(\"#{roleService}\")\nprivate RoleService roleService;\n```\n\n通过这种方式，可以注入id为roleService的bean。\n\n### 7.2 bean的变量和方法\n\n通过EL表达式，@Value注解已经可以注入bean了。既然能够拿到bean实例，接下来，可以再进一步。\n\n在RoleService类中定义了：成员变量、常量、方法、静态方法。\n\n```\n@Service\npublic class RoleService {\n    public static final int DEFAULT_AGE = 18;\n    public int id = 1000;\n\n    public String getRoleName() {\n        return \"管理员\";\n    }\n\n    public static int getParentId() {\n        return 2000;\n    }\n}\n```\n\n在调用的地方这样写：\n\n```\n@Service\npublic class UserService {\n\n    @Value(\"#{roleService.DEFAULT_AGE}\")\n    private int myAge;\n\n    @Value(\"#{roleService.id}\")\n    private int id;\n\n    @Value(\"#{roleService.getRoleName()}\")\n    private String myRoleName;\n\n    @Value(\"#{roleService.getParentId()}\")\n    private String myParentId;\n\n    public String test() {\n        System.out.println(myAge);\n        System.out.println(id);\n        System.out.println(myRoleName);\n        System.out.println(myParentId);\n        return null;\n    }\n}\n```\n\n在UserService类中通过@Value可以注入：成员变量、常量、方法、静态方法获取到的值，到相应的成员变量中。\n\n一下子有没有豁然开朗的感觉，有了这些，我们可以通过@Value注解，实现更多的功能了，不仅仅限于注入系统属性。\n\n### 7.3 静态类\n\n前面的内容都是基于bean的，但有时我们需要调用静态类，比如：Math、xxxUtil等静态工具类的方法，该怎么办呢？\n\n答：用T加括号。\n\n示例1：\n\n```\n@Value(\"#{T(java.io.File).separator}\")\nprivate String path;\n```\n\n可以注入系统的路径分隔符到path中。\n\n示例2：\n\n```\n@Value(\"#{T(java.lang.Math).random()}\")\nprivate double randomValue;\n```\n\n可以注入一个随机数到randomValue中。\n\n### 7.4 逻辑运算\n\n通过上面介绍的内容，我们可以获取到绝大多数类的变量和方法的值了。但有了这些值，还不够，我们能不能在EL表达式中加点逻辑？\n\n拼接字符串：\n\n```\n@Value(\"#{roleService.roleName + '' + roleService.DEFAULT_AGE}\")\nprivate String value;\n```\n\n逻辑判断：\n\n```\n@Value(\"#{roleService.DEFAULT_AGE > 16 and roleService.roleName.equals('苏三')}\")\nprivate String operation;\n```\n\n三目运算：\n\n```\n@Value(\"#{roleService.DEFAULT_AGE > 16 ? roleService.roleName: '苏三' }\")\nprivate String realRoleName;\n```\n\n还有很多很多功能，我就不一一列举了。\n\nEL表达式实在太强大了，对这方面如果感兴趣的小伙伴可以找我私聊。\n\n## 8 ${}和#{}的区别\n\n上面巴拉巴拉说了这么多@Value的牛逼用法，归根揭底就是`${}`和`#{}`的用法。\n\n下面重点说说${}和#{}的区别，这可能是很多小伙伴比较关心的话题。\n\n### 8.1 ${}\n\n主要用于获取配置文件中的系统属性值。\n\n例如：\n\n```\n@Value(value = \"${susan.test.userName:susan}\")\nprivate String userName;\n```\n\n通过`:`可以设置默认值。如果在配置文件中找不到susan.test.userName的配置，则注入时用默认值。\n\n如果在配置文件中找不到susan.test.userName的配置，也没有设置默认值，则启动项目时会报错。\n\n### 8.2 #{}\n\n主要用于通过spring的EL表达式，获取bean的属性，或者调用bean的某个方法。还有调用类的静态常量和静态方法。\n\n```\n@Value(\"#{roleService.DEFAULT_AGE}\")\nprivate int myAge;\n\n@Value(\"#{roleService.id}\")\nprivate int id;\n\n@Value(\"#{roleService.getRoleName()}\")\nprivate String myRoleName;\n\n@Value(\"#{T(java.lang.Math).random()}\")\nprivate double randomValue;\n```\n\n如果是调用类的静态方法，则需要加T(包名 + 方法名称)。\n\n例如：T(java.lang.Math)。\n\n好了，今天的内容就介绍到这里，希望对你会有所帮助。随便剧透一下，后面的文章会继续介绍：\n\n1. @Value的原理\n2. @Value动态刷新属性值的原因\n3. @ConfigurationProperties注解的用法，它也非常强大。 也非常强大。 ","source":"_posts/spring/@Value.md","raw":"---\nuuid: bbaf6f28-c0ab-11ec-92a1-7557b2313227\ntitle: spring-@Value\ncategories: Java\ntags:\n  - spring\nabbrlink: 5295323d\n---\n\n## 前言 \n\n对于从事java开发工作的小伙伴来说，spring框架肯定再熟悉不过了。spring给开发者提供了非常丰富的api，满足我们日常的工作需求。\n\n如果想要创建bean实例，可以使用@Controller、@Service、@Repository、@Component等注解。\n\n如果想要依赖注入某个对象，可以使用@Autowired和@Resource注解。\n\n如果想要开启事务，可以使用@Transactional注解。\n\n如果想要动态读取配置文件中的某个系统属性，可以使用@Value注解。\n\n等等，还有很多。。。\n\n今天咱们重点聊聊`@Value`注解，因为它是一个非常有用，但极其容易被忽视的注解，绝大多数人可能只用过它的一部分功能，这是一件非常遗憾的事情。\n\n所以今天有必要和大家一起，重新认识一下`@Value`。![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191639922)\n\n## 1. 由一个例子开始 \n\n假如在UserService类中，需要注入系统属性到userName变量中。通常情况下，我们会写出如下的代码：\n\n```\n@Service\npublic class UserService {\n\n    @Value(\"${susan.test.userName}\")\n    private String userName;\n\n    public String test() {\n        System.out.println(userName);\n        return userName;\n    }\n}\n```\n\n通过`@Value`注解指定系统属性的名称`susan.test.userName`，该名称需要使用`${}`包起来。\n\n这样spring就会自动的帮我们把对应的系统属性值，注入到userName变量中。\n\n不过，上面功能的重点是要在`applicationContext.properties`文件（简称：配置文件）中配置同名的系统属性：\n\n```\n#张三\nsusan.test.userName=\\u5f20\\u4e09\n```\n\n那么，名称真的必须完全相同吗？\n\n## 2. 关于属性名\n\n这时候，有些朋友可能会说：在`@ConfigurationProperties`配置类中，定义的参数名可以跟配置文件中的系统属性名不同。\n\n比如，在配置类MyConfig类中定义的参数名是userName：\n\n```\n@Configuration\n@ConfigurationProperties(prefix = \"susan.test\")\n@Data\npublic class MyConfig {\n    private String userName;\n}\n```\n\n而配置文件中配置的系统属性名是：\n\n```\nsusan.test.user-name=\\u5f20\\u4e09\n```\n\n类中用的`userName`，而配置文件中用的`user-name`，不一样。但测试之后，发现该功能能够正常运行。\n\n配置文件中的系统属性名用 `驼峰标识` 或 `小写字母加中划线的组合`，spring都能找到配置类中的属性名userName进行赋值。\n\n由此可见，配置文件中的系统属性名，可以跟配置类中的属性名不一样。不过，有个前提，前缀susan.test必须相同。\n\n那么，`@Value`注解中定义的系统属性名也可以不一样吗？\n\n答案：不能。如果不一样，启动项目时会直接报错。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191639512)此外，如果只在@Value注解中指定了系统属性名，但实际在配置文件中没有配置它，也会报跟上面一样的错。\n\n所以，**@Value注解中指定的系统属性名，必须跟配置文件中的相同。**\n\n## 3. 乱码问题\n\n不知道细心的小伙伴们有没有发现，我配置的属性值：`张三`，其实是`转义`过的。\n\n```\nsusan.test.userName=\\u5f20\\u4e09\n```\n\n为什么要做这个转义？\n\n假如在配置文件中配置中文的张三：\n\n```\nsusan.test.userName=张三\n```\n\n最后获取数据时，你会发现userName竟然出现了乱码：\n\n> å¼ ä¸\n\nwhat？\n\n为什么会出现乱码？\n\n答：在springboot的`CharacterReader`类中，默认的编码格式是`ISO-8859-1`，该类负责`.properties`文件中系统属性的读取。如果系统属性包含中文字符，就会出现乱码。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191639539)那么，如何解决乱码问题呢？\n\n目前主要有如下三种方案：\n\n1. 手动将ISO-8859-1格式的属性值，转换成UTF-8格式。\n2. 设置encoding参数，不过这个只对@PropertySource注解有用。\n3. 将中文字符用unicode编码转义。\n\n显然@Value不支持encoding参数，所以方案2不行。\n\n假如使用方案1，具体实现代码如下：\n\n```\n@Service\npublic class UserService {\n\n    @Value(value = \"${susan.test.userName}\")\n    private String userName;\n\n    public String test() {\n        String userName1 = new String(userName.getBytes(StandardCharsets.ISO_8859_1), StandardCharsets.UTF_8);\n        System.out.println();\n        return userName1;\n    }\n}\n```\n\n确实可以解决乱码问题。\n\n但如果项目中包含大量中文系统属性值，每次都需要加这样一段特殊转换代码。出现大量重复代码，有没有觉得有点恶心？\n\n反转我被恶心到了。\n\n那么，如何解决代码重复问题呢？\n\n答：将属性值的中文内容转换成unicode。\n\n类似于这样的：\n\n```\nsusan.test.userName=\\u5f20\\u4e09\n```\n\n这种方式同样能解决乱码问题，不会出现恶心的重复代码。但需要做一点额外的转换工作，不过这个转换非常容易，因为有现成的在线转换工具。\n\n> 推荐使用这个工具转换：http://www.jsons.cn/unicode/\n\n在这里顺便告诉你一个小秘密：如果你使用的是`.yml`或`.yaml`格式的配置文件，并不会出现中文乱码问题。\n\n这又是为什么？\n\n因为.yml或.yaml格式的配置文件，最终会使用`UnicodeReader`类进行解析，它的`init`方法中，首先读取BOM文件头信息，如果头信息中有UTF8、UTF16BE、UTF16LE，就采用对应的编码，如果没有，则采用默认`UTF8`编码。\n\n![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191639766)\n\n> 需要注意的是：乱码问题一般出现在本地环境，因为本地直接读取的.properties配置文件。在dev、test、生产等环境，如果从zookeeper、apollo、nacos等配置中心中获取系统参数值，走的是另外的逻辑，并不会出现乱码问题。\n\n## 4.默认值\n\n有时候，默认值是我们非常头疼的问题。\n\n为什么这样说呢？\n\n因为很多时候使用java的默认值，并不能满足我们的日常工作需求。\n\n比如有这样一个需求：如果配置了系统属性，userName就用配置的属性值。如果没有配置，则userName用默认值susan。\n\n有些朋友可能认为可以这样做：\n\n```\n@Value(value = \"${susan.test.userName}\")\nprivate String userName = \"susan\";\n```\n\n在定义参数时直接给个默认值，但如果仔细想想这招是行不通的的。因为设置userName默认值的时机，比@Value注解依赖注入属性值要早，也就是说userName初始化好了默认值，后面还是会被覆盖。\n\n那么，到底该如何设置默认值呢？\n\n答：使用`:`。\n\n例如：\n\n```\n@Value(value = \"${susan.test.userName:susan}\")\nprivate String userName;\n```\n\n在需要设置默认值的系统属性名后，加`:`符号。紧接着，在`:`右边设置默认值。\n\n建议大家平时在使用@Value时，尽量都设置一个默认值。如果不需要默认值，宁可设置一个空。比如：\n\n```\n@Value(value = \"${susan.test.userName:}\")\nprivate String userName;\n```\n\n为什么这么说？\n\n假如有这种场景：在business层中包含了UserService类，business层被api服务和job服务都引用了。但UserService类中@Value的userName只在api服务中有用，在job服务中根本用不到该属性。\n\n对于job服务来说，如果不在.properties文件中配置同名的系统属性，则服务启动时就会报错。\n\n这个坑，我之前踩过多次。所以，建议大家，使用@Value注解时，最好给参数设置一个默认值，以防止出现类似的问题。\n\n## 5. static变量\n\n前面我们已经见识过，如何使用@Value注解，给类的`成员变量`注入`系统属性值`。\n\n那么，问题来了，`静态变量`可以自动注入系统属性值不？\n\n我们一起看看，假如将上面的userName定义成`static`的：\n\n```\n@Value(\"${susan.test.userName}\")\nprivate static String userName;\n```\n\n程序可以正常启动，但是获取到userName的值却是null。\n\n由此可见，被`static`修饰的变量通过@Value会注入失败。\n\n作为好奇宝宝的你，此时肯定想问：如何才能给静态变量注入系统属性值呢？\n\n答：这就需要使用如下的骚代码了：\n\n```\n@Service\npublic class UserService {\n\n    private static String userName;\n\n    @Value(\"${susan.test.userName}\")\n    public void setUserName(String userName) {\n        UserService.userName = userName;\n    }\n\n    public String test() {\n        return userName;\n    }\n}\n```\n\n提供一个静态参数的`setter`方法，在该方法上使用@Value注入属性值，并且同时在该方法中给静态变量赋值。\n\n有些细心的朋友可能会发现，@Value注解在这里竟然使用在setUserName方法上了，也就是对应的setter方法，而不是在变量上。\n\n有趣，有趣，这种用法有点高端喔。\n\n不过，通常情况下，我们一般会在pojo实体类上，使用lombok的@Data、@Setter、@Getter等注解，在编译时动态增加setter或getter方法，所以@Value用在方法上的场景其实不多。\n\n## 6.变量类型\n\n上面的内容，都是用的字符串类型的变量进行举例的。其实，@Value注解还支持其他多种类型的系统属性值的注入。\n\n### 6.1 基本类型\n\n众所周知，在Java中的基本数据类型有4类8种，然我们一起回顾一下：\n\n- 整型：byte、short、int、long\n- 浮点型：float、double\n- 布尔型：boolean\n- 字符型：char\n\n相对应地提供了8种包装类：\n\n- 整型：Byte、Short、Integer、Long\n- 浮点型：Float、Double\n- 布尔型：Boolean\n- 字符型：Character\n\n@Value注解对这8中基本类型和相应的包装类，有非常良好的支持，例如：\n\n```\n@Value(\"${susan.test.a:1}\")\nprivate byte a;\n\n@Value(\"${susan.test.b:100}\")\nprivate short b;\n\n@Value(\"${susan.test.c:3000}\")\nprivate int c;\n\n@Value(\"${susan.test.d:4000000}\")\nprivate long d;\n\n@Value(\"${susan.test.e:5.2}\")\nprivate float e;\n\n@Value(\"${susan.test.f:6.1}\")\nprivate double f;\n\n@Value(\"${susan.test.g:false}\")\nprivate boolean g;\n\n@Value(\"${susan.test.h:h}\")\nprivate char h;\n\n@Value(\"${susan.test.a:1}\")\nprivate byte a1;\n\n@Value(\"${susan.test.b:100}\")\nprivate Short b1;\n\n@Value(\"${susan.test.c:3000}\")\nprivate Integer c1;\n\n@Value(\"${susan.test.d:4000000}\")\nprivate Long d1;\n\n@Value(\"${susan.test.e:5.2}\")\nprivate Float e1;\n\n@Value(\"${susan.test.f:6.1}\")\nprivate Double f1;\n\n@Value(\"${susan.test.g:false}\")\nprivate Boolean g1;\n\n@Value(\"${susan.test.h:h}\")\nprivate Character h1;\n```\n\n有了这些常用的数据类型，我们在定义变量类型时，可以非常愉快的玩耍了，不用做额外的转换。\n\n### 6.2 数组\n\n但只用上面的基本类型是不够的，特别是很多需要批量处理数据的场景中。这时候可以使用`数组`，它在日常开发中使用的频率很高。\n\n我们在定义数组时可以这样写：\n\n```\n@Value(\"${susan.test.array:1,2,3,4,5}\")\nprivate int[] array;\n```\n\nspring默认使用逗号分隔参数值。\n\n如果用空格分隔，例如：\n\n```\n@Value(\"${susan.test.array:1 2 3 4 5}\")\nprivate int[] array;\n```\n\nspring会自动把空格去掉，导致数据中只有一个值：12345，注意千万别搞错了。\n\n顺便说一下，定义数组的时候，里面还是有挺多门道的。比如上面列子中，我的数据是：1,2,3,4,5。\n\n如果我们把数组定义成：short、int、long、char、string类型，spring是可以正常注入属性值的。\n\n但如果把数组定义成：float、double类型，启动项目时就会直接报错。\n\n![图片](https://raw.githubusercontent.com/lanbai1993/book/master/spring/images/202110281648428)小伙伴们，下巴惊掉了没？\n\n按理说，1,2,3,4,5用float、double是能够表示的呀，为什么会报错？\n\n如果使用int的包装类，比如：\n\n```\n@Value(\"${susan.test.array:1,2,3,4,5}\")\nprivate Integer[] array;\n```\n\n启动项目时同样会报上面的异常。\n\n此外，定义数组时一定要注意属性值的类型，必须完全一致才可以，如果出现下面这种情况：\n\n```\n@Value(\"${susan.test.array:1.0,abc,3,4,5}\")\nprivate int[] array;\n```\n\n属性值中包含了1.0和abc，显然都无法将该字符串转换成int。\n\n### 6.3 集合类\n\n有了基本类型和数组，的确让我们更加方便了。但对数据的处理，只用数组这一种数据结构是远远不够的，下面给大家介绍一下其他的常用数据结构。\n\n#### 6.3.1 List\n\nList是数组的变种，它的长度是可变的，而数组的长度是固定的。\n\n我们看看List是如何注入属性值的：\n\n```\n@Value(\"${susan.test.list}\")\nprivate List<String> list;\n```\n\n最关键的是看配置文件：\n\n```\nsusan.test.list[0]=10\nsusan.test.list[1]=11\nsusan.test.list[2]=12\nsusan.test.list[3]=13\n```\n\n当你满怀希望的启动项目，准备使用这个功能的时候，却发现竟然报错了。\n\n![图片](https://raw.githubusercontent.com/lanbai1993/book/master/spring/images/202110281648919)what?\n\n看来@Value不支持这种直接的List注入。\n\n那么，如何解决这个问题呢？\n\n有人说用`@ConfigurationProperties`。\n\n需要定义一个MyConfig类：\n\n```\n@Configuration\n@ConfigurationProperties(prefix = \"susan.test\")\n@Data\npublic class MyConfig {\n    private List<String> list;\n}\n```\n\n然后在调用的地方这样写：\n\n```\n@Service\npublic class UserService {\n\n    @Autowired\n    private MyConfig myConfig;\n\n    public String test() {\n        System.out.println(myConfig.getList());\n        return null;\n    }\n}\n```\n\n这种方法确实能够完成List注入。但是，只能说明@ConfigurationProperties注解的强大，跟@Value有半毛钱的关系？\n\n答：没有。\n\n那么，问题来了，用@Value如何实现这个功能呢？\n\n答：使用spring的EL表达式。\n\nList的定义改成：\n\n```\n@Value(\"#{'${susan.test.list}'.split(',')}\")\nprivate List<String> list;\n```\n\n使用`#`号加大括号的EL表达式。\n\n然后配置文件改成：\n\n```\nsusan.test.list=10,11,12,13\n```\n\n跟定义数组时的配置文件一样。\n\n#### 6.3.2 Set\n\nSet也是一种保存数据的集合，它比较特殊，里面保存的数据不会重复。\n\n我们可以这样定义Set：\n\n```\n@Value(\"#{'${susan.test.set}'.split(',')}\")\nprivate Set<String> set;\n```\n\n配置文件是这样的：\n\n```\nsusan.test.set=10,11,12,13\n```\n\nSet跟List的用法极为相似。\n\n但为了证明本节的独特之处，我打算说点新鲜的内容。\n\n如何给List或者Set设置默认值空呢？\n\n有些朋友可能会说：这还不简单，直接在@Value的$表达式后面加个:号不就行了。\n\n具体代码如下：\n\n```\n@Value(\"#{'${susan.test.set:}'.split(',')}\")\nprivate Set<String> set;\n```\n\n结果却跟想象中不太一样：![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191640261)Set集合怎么不是空的，而是包含了一个空字符串的集合？\n\n好吧，那我在:号后加null，总可以了吧？![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191640025)Set集合也不是空的，而是包含了一个\"null\"字符串的集合。\n\n这也不行，那也不行，该如何是好？\n\n答：使用EL表达式的`empty`方法。\n\n具体代码如下：\n\n```\n@Value(\"#{'${susan.test.set:}'.empty ? null : '${susan.test.set:}'.split(',')}\")\nprivate Set<String> set;\n```\n\n运行之后，结果对了：![图片](https://raw.githubusercontent.com/xzyup/image/master/202203191640790)\n\n其实List也有类似的问题，也能使用该方法解决问题。\n\n> 在这里温馨的提醒一下，该判断的表达式比较复杂，自己手写非常容易写错，建议复制粘贴之后根据实际需求改改。\n\n#### 6.3.3 Map\n\n还有一种比较常用的集合是map，它支持key/value键值对的形式保存数据，并且不会出现相同key的数据。\n\n我们可以这样定义Map：\n\n```\n@Value(\"#{${susan.test.map}}\")\nprivate Map<String, String> map;\n```\n\n配置文件是这样的：\n\n```\nsusan.test.map={\"name\":\"苏三\", \"age\":\"18\"}\n```\n\n这种用法跟上面稍微有一点区别。\n\n设置默认值的代码如下：\n\n```\n@Value(\"#{'${susan.test.map:}'.empty ? null : '${susan.test.map:}'}\")\nprivate Map<String, String> map;\n```\n\n## 7 EL高端玩法\n\n前面我们已经见识过spring EL表达式的用法了，在设置空的默认值时特别有用。\n\n其实，`empty`方法只是它很普通的用法，还有更高端的用法，不信我们一起看看。\n\n### 7.1 注入bean\n\n以前我们注入bean，一般都是用的@Autowired或者@Resource注解。例如：\n\n```\n@Service\npublic class RoleService {\n    public String getRoleName() {\n        return \"管理员\";\n    }\n}\n\n@Service\npublic class UserService {\n\n    @Autowired\n    private RoleService roleService;\n\n    public String test() {\n        System.out.println(roleService.getRoleName());\n        return null;\n    }\n}\n```\n\n但我要告诉你的是@Value注解也可以注入bean，它是这么做的：\n\n```\n@Value(\"#{roleService}\")\nprivate RoleService roleService;\n```\n\n通过这种方式，可以注入id为roleService的bean。\n\n### 7.2 bean的变量和方法\n\n通过EL表达式，@Value注解已经可以注入bean了。既然能够拿到bean实例，接下来，可以再进一步。\n\n在RoleService类中定义了：成员变量、常量、方法、静态方法。\n\n```\n@Service\npublic class RoleService {\n    public static final int DEFAULT_AGE = 18;\n    public int id = 1000;\n\n    public String getRoleName() {\n        return \"管理员\";\n    }\n\n    public static int getParentId() {\n        return 2000;\n    }\n}\n```\n\n在调用的地方这样写：\n\n```\n@Service\npublic class UserService {\n\n    @Value(\"#{roleService.DEFAULT_AGE}\")\n    private int myAge;\n\n    @Value(\"#{roleService.id}\")\n    private int id;\n\n    @Value(\"#{roleService.getRoleName()}\")\n    private String myRoleName;\n\n    @Value(\"#{roleService.getParentId()}\")\n    private String myParentId;\n\n    public String test() {\n        System.out.println(myAge);\n        System.out.println(id);\n        System.out.println(myRoleName);\n        System.out.println(myParentId);\n        return null;\n    }\n}\n```\n\n在UserService类中通过@Value可以注入：成员变量、常量、方法、静态方法获取到的值，到相应的成员变量中。\n\n一下子有没有豁然开朗的感觉，有了这些，我们可以通过@Value注解，实现更多的功能了，不仅仅限于注入系统属性。\n\n### 7.3 静态类\n\n前面的内容都是基于bean的，但有时我们需要调用静态类，比如：Math、xxxUtil等静态工具类的方法，该怎么办呢？\n\n答：用T加括号。\n\n示例1：\n\n```\n@Value(\"#{T(java.io.File).separator}\")\nprivate String path;\n```\n\n可以注入系统的路径分隔符到path中。\n\n示例2：\n\n```\n@Value(\"#{T(java.lang.Math).random()}\")\nprivate double randomValue;\n```\n\n可以注入一个随机数到randomValue中。\n\n### 7.4 逻辑运算\n\n通过上面介绍的内容，我们可以获取到绝大多数类的变量和方法的值了。但有了这些值，还不够，我们能不能在EL表达式中加点逻辑？\n\n拼接字符串：\n\n```\n@Value(\"#{roleService.roleName + '' + roleService.DEFAULT_AGE}\")\nprivate String value;\n```\n\n逻辑判断：\n\n```\n@Value(\"#{roleService.DEFAULT_AGE > 16 and roleService.roleName.equals('苏三')}\")\nprivate String operation;\n```\n\n三目运算：\n\n```\n@Value(\"#{roleService.DEFAULT_AGE > 16 ? roleService.roleName: '苏三' }\")\nprivate String realRoleName;\n```\n\n还有很多很多功能，我就不一一列举了。\n\nEL表达式实在太强大了，对这方面如果感兴趣的小伙伴可以找我私聊。\n\n## 8 ${}和#{}的区别\n\n上面巴拉巴拉说了这么多@Value的牛逼用法，归根揭底就是`${}`和`#{}`的用法。\n\n下面重点说说${}和#{}的区别，这可能是很多小伙伴比较关心的话题。\n\n### 8.1 ${}\n\n主要用于获取配置文件中的系统属性值。\n\n例如：\n\n```\n@Value(value = \"${susan.test.userName:susan}\")\nprivate String userName;\n```\n\n通过`:`可以设置默认值。如果在配置文件中找不到susan.test.userName的配置，则注入时用默认值。\n\n如果在配置文件中找不到susan.test.userName的配置，也没有设置默认值，则启动项目时会报错。\n\n### 8.2 #{}\n\n主要用于通过spring的EL表达式，获取bean的属性，或者调用bean的某个方法。还有调用类的静态常量和静态方法。\n\n```\n@Value(\"#{roleService.DEFAULT_AGE}\")\nprivate int myAge;\n\n@Value(\"#{roleService.id}\")\nprivate int id;\n\n@Value(\"#{roleService.getRoleName()}\")\nprivate String myRoleName;\n\n@Value(\"#{T(java.lang.Math).random()}\")\nprivate double randomValue;\n```\n\n如果是调用类的静态方法，则需要加T(包名 + 方法名称)。\n\n例如：T(java.lang.Math)。\n\n好了，今天的内容就介绍到这里，希望对你会有所帮助。随便剧透一下，后面的文章会继续介绍：\n\n1. @Value的原理\n2. @Value动态刷新属性值的原因\n3. @ConfigurationProperties注解的用法，它也非常强大。 也非常强大。 ","slug":"spring/@Value","published":1,"date":"2022-04-20T12:41:20.907Z","updated":"2022-04-20T13:47:00.315Z","_id":"cl2qzftj3008513nogz8efcd2","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>对于从事java开发工作的小伙伴来说，spring框架肯定再熟悉不过了。spring给开发者提供了非常丰富的api，满足我们日常的工作需求。</p>\n<p>如果想要创建bean实例，可以使用@Controller、@Service、@Repository、@Component等注解。</p>\n<p>如果想要依赖注入某个对象，可以使用@Autowired和@Resource注解。</p>\n<p>如果想要开启事务，可以使用@Transactional注解。</p>\n<p>如果想要动态读取配置文件中的某个系统属性，可以使用@Value注解。</p>\n<p>等等，还有很多。。。</p>\n<p>今天咱们重点聊聊<code>@Value</code>注解，因为它是一个非常有用，但极其容易被忽视的注解，绝大多数人可能只用过它的一部分功能，这是一件非常遗憾的事情。</p>\n<p>所以今天有必要和大家一起，重新认识一下<code>@Value</code>。<img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191639922\" alt=\"图片\"></p>\n<h2 id=\"1-由一个例子开始\"><a href=\"#1-由一个例子开始\" class=\"headerlink\" title=\"1. 由一个例子开始\"></a>1. 由一个例子开始</h2><p>假如在UserService类中，需要注入系统属性到userName变量中。通常情况下，我们会写出如下的代码：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;$&#123;susan.test.userName&#125;&quot;)</span><br><span class=\"line\">    private String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        System.out.println(userName);</span><br><span class=\"line\">        return userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>通过<code>@Value</code>注解指定系统属性的名称<code>susan.test.userName</code>，该名称需要使用<code>$&#123;&#125;</code>包起来。</p>\n<p>这样spring就会自动的帮我们把对应的系统属性值，注入到userName变量中。</p>\n<p>不过，上面功能的重点是要在<code>applicationContext.properties</code>文件（简称：配置文件）中配置同名的系统属性：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#张三</span><br><span class=\"line\">susan.test.userName=\\u5f20\\u4e09</span><br></pre></td></tr></table></figure>\n\n<p>那么，名称真的必须完全相同吗？</p>\n<h2 id=\"2-关于属性名\"><a href=\"#2-关于属性名\" class=\"headerlink\" title=\"2. 关于属性名\"></a>2. 关于属性名</h2><p>这时候，有些朋友可能会说：在<code>@ConfigurationProperties</code>配置类中，定义的参数名可以跟配置文件中的系统属性名不同。</p>\n<p>比如，在配置类MyConfig类中定义的参数名是userName：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configuration</span><br><span class=\"line\">@ConfigurationProperties(prefix = &quot;susan.test&quot;)</span><br><span class=\"line\">@Data</span><br><span class=\"line\">public class MyConfig &#123;</span><br><span class=\"line\">    private String userName;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>而配置文件中配置的系统属性名是：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.user-name=\\u5f20\\u4e09</span><br></pre></td></tr></table></figure>\n\n<p>类中用的<code>userName</code>，而配置文件中用的<code>user-name</code>，不一样。但测试之后，发现该功能能够正常运行。</p>\n<p>配置文件中的系统属性名用 <code>驼峰标识</code> 或 <code>小写字母加中划线的组合</code>，spring都能找到配置类中的属性名userName进行赋值。</p>\n<p>由此可见，配置文件中的系统属性名，可以跟配置类中的属性名不一样。不过，有个前提，前缀susan.test必须相同。</p>\n<p>那么，<code>@Value</code>注解中定义的系统属性名也可以不一样吗？</p>\n<p>答案：不能。如果不一样，启动项目时会直接报错。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191639512\" alt=\"图片\">此外，如果只在@Value注解中指定了系统属性名，但实际在配置文件中没有配置它，也会报跟上面一样的错。</p>\n<p>所以，**@Value注解中指定的系统属性名，必须跟配置文件中的相同。**</p>\n<h2 id=\"3-乱码问题\"><a href=\"#3-乱码问题\" class=\"headerlink\" title=\"3. 乱码问题\"></a>3. 乱码问题</h2><p>不知道细心的小伙伴们有没有发现，我配置的属性值：<code>张三</code>，其实是<code>转义</code>过的。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.userName=\\u5f20\\u4e09</span><br></pre></td></tr></table></figure>\n\n<p>为什么要做这个转义？</p>\n<p>假如在配置文件中配置中文的张三：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.userName=张三</span><br></pre></td></tr></table></figure>\n\n<p>最后获取数据时，你会发现userName竟然出现了乱码：</p>\n<blockquote>\n<p>å¼ ä¸</p>\n</blockquote>\n<p>what？</p>\n<p>为什么会出现乱码？</p>\n<p>答：在springboot的<code>CharacterReader</code>类中，默认的编码格式是<code>ISO-8859-1</code>，该类负责<code>.properties</code>文件中系统属性的读取。如果系统属性包含中文字符，就会出现乱码。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191639539\" alt=\"图片\">那么，如何解决乱码问题呢？</p>\n<p>目前主要有如下三种方案：</p>\n<ol>\n<li>手动将ISO-8859-1格式的属性值，转换成UTF-8格式。</li>\n<li>设置encoding参数，不过这个只对@PropertySource注解有用。</li>\n<li>将中文字符用unicode编码转义。</li>\n</ol>\n<p>显然@Value不支持encoding参数，所以方案2不行。</p>\n<p>假如使用方案1，具体实现代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(value = &quot;$&#123;susan.test.userName&#125;&quot;)</span><br><span class=\"line\">    private String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        String userName1 = new String(userName.getBytes(StandardCharsets.ISO_8859_1), StandardCharsets.UTF_8);</span><br><span class=\"line\">        System.out.println();</span><br><span class=\"line\">        return userName1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>确实可以解决乱码问题。</p>\n<p>但如果项目中包含大量中文系统属性值，每次都需要加这样一段特殊转换代码。出现大量重复代码，有没有觉得有点恶心？</p>\n<p>反转我被恶心到了。</p>\n<p>那么，如何解决代码重复问题呢？</p>\n<p>答：将属性值的中文内容转换成unicode。</p>\n<p>类似于这样的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.userName=\\u5f20\\u4e09</span><br></pre></td></tr></table></figure>\n\n<p>这种方式同样能解决乱码问题，不会出现恶心的重复代码。但需要做一点额外的转换工作，不过这个转换非常容易，因为有现成的在线转换工具。</p>\n<blockquote>\n<p>推荐使用这个工具转换：<a href=\"http://www.jsons.cn/unicode/\">http://www.jsons.cn/unicode/</a></p>\n</blockquote>\n<p>在这里顺便告诉你一个小秘密：如果你使用的是<code>.yml</code>或<code>.yaml</code>格式的配置文件，并不会出现中文乱码问题。</p>\n<p>这又是为什么？</p>\n<p>因为.yml或.yaml格式的配置文件，最终会使用<code>UnicodeReader</code>类进行解析，它的<code>init</code>方法中，首先读取BOM文件头信息，如果头信息中有UTF8、UTF16BE、UTF16LE，就采用对应的编码，如果没有，则采用默认<code>UTF8</code>编码。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191639766\" alt=\"图片\"></p>\n<blockquote>\n<p>需要注意的是：乱码问题一般出现在本地环境，因为本地直接读取的.properties配置文件。在dev、test、生产等环境，如果从zookeeper、apollo、nacos等配置中心中获取系统参数值，走的是另外的逻辑，并不会出现乱码问题。</p>\n</blockquote>\n<h2 id=\"4-默认值\"><a href=\"#4-默认值\" class=\"headerlink\" title=\"4.默认值\"></a>4.默认值</h2><p>有时候，默认值是我们非常头疼的问题。</p>\n<p>为什么这样说呢？</p>\n<p>因为很多时候使用java的默认值，并不能满足我们的日常工作需求。</p>\n<p>比如有这样一个需求：如果配置了系统属性，userName就用配置的属性值。如果没有配置，则userName用默认值susan。</p>\n<p>有些朋友可能认为可以这样做：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(value = &quot;$&#123;susan.test.userName&#125;&quot;)</span><br><span class=\"line\">private String userName = &quot;susan&quot;;</span><br></pre></td></tr></table></figure>\n\n<p>在定义参数时直接给个默认值，但如果仔细想想这招是行不通的的。因为设置userName默认值的时机，比@Value注解依赖注入属性值要早，也就是说userName初始化好了默认值，后面还是会被覆盖。</p>\n<p>那么，到底该如何设置默认值呢？</p>\n<p>答：使用<code>:</code>。</p>\n<p>例如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(value = &quot;$&#123;susan.test.userName:susan&#125;&quot;)</span><br><span class=\"line\">private String userName;</span><br></pre></td></tr></table></figure>\n\n<p>在需要设置默认值的系统属性名后，加<code>:</code>符号。紧接着，在<code>:</code>右边设置默认值。</p>\n<p>建议大家平时在使用@Value时，尽量都设置一个默认值。如果不需要默认值，宁可设置一个空。比如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(value = &quot;$&#123;susan.test.userName:&#125;&quot;)</span><br><span class=\"line\">private String userName;</span><br></pre></td></tr></table></figure>\n\n<p>为什么这么说？</p>\n<p>假如有这种场景：在business层中包含了UserService类，business层被api服务和job服务都引用了。但UserService类中@Value的userName只在api服务中有用，在job服务中根本用不到该属性。</p>\n<p>对于job服务来说，如果不在.properties文件中配置同名的系统属性，则服务启动时就会报错。</p>\n<p>这个坑，我之前踩过多次。所以，建议大家，使用@Value注解时，最好给参数设置一个默认值，以防止出现类似的问题。</p>\n<h2 id=\"5-static变量\"><a href=\"#5-static变量\" class=\"headerlink\" title=\"5. static变量\"></a>5. static变量</h2><p>前面我们已经见识过，如何使用@Value注解，给类的<code>成员变量</code>注入<code>系统属性值</code>。</p>\n<p>那么，问题来了，<code>静态变量</code>可以自动注入系统属性值不？</p>\n<p>我们一起看看，假如将上面的userName定义成<code>static</code>的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.userName&#125;&quot;)</span><br><span class=\"line\">private static String userName;</span><br></pre></td></tr></table></figure>\n\n<p>程序可以正常启动，但是获取到userName的值却是null。</p>\n<p>由此可见，被<code>static</code>修饰的变量通过@Value会注入失败。</p>\n<p>作为好奇宝宝的你，此时肯定想问：如何才能给静态变量注入系统属性值呢？</p>\n<p>答：这就需要使用如下的骚代码了：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    private static String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;$&#123;susan.test.userName&#125;&quot;)</span><br><span class=\"line\">    public void setUserName(String userName) &#123;</span><br><span class=\"line\">        UserService.userName = userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        return userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>提供一个静态参数的<code>setter</code>方法，在该方法上使用@Value注入属性值，并且同时在该方法中给静态变量赋值。</p>\n<p>有些细心的朋友可能会发现，@Value注解在这里竟然使用在setUserName方法上了，也就是对应的setter方法，而不是在变量上。</p>\n<p>有趣，有趣，这种用法有点高端喔。</p>\n<p>不过，通常情况下，我们一般会在pojo实体类上，使用lombok的@Data、@Setter、@Getter等注解，在编译时动态增加setter或getter方法，所以@Value用在方法上的场景其实不多。</p>\n<h2 id=\"6-变量类型\"><a href=\"#6-变量类型\" class=\"headerlink\" title=\"6.变量类型\"></a>6.变量类型</h2><p>上面的内容，都是用的字符串类型的变量进行举例的。其实，@Value注解还支持其他多种类型的系统属性值的注入。</p>\n<h3 id=\"6-1-基本类型\"><a href=\"#6-1-基本类型\" class=\"headerlink\" title=\"6.1 基本类型\"></a>6.1 基本类型</h3><p>众所周知，在Java中的基本数据类型有4类8种，然我们一起回顾一下：</p>\n<ul>\n<li>整型：byte、short、int、long</li>\n<li>浮点型：float、double</li>\n<li>布尔型：boolean</li>\n<li>字符型：char</li>\n</ul>\n<p>相对应地提供了8种包装类：</p>\n<ul>\n<li>整型：Byte、Short、Integer、Long</li>\n<li>浮点型：Float、Double</li>\n<li>布尔型：Boolean</li>\n<li>字符型：Character</li>\n</ul>\n<p>@Value注解对这8中基本类型和相应的包装类，有非常良好的支持，例如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.a:1&#125;&quot;)</span><br><span class=\"line\">private byte a;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.b:100&#125;&quot;)</span><br><span class=\"line\">private short b;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.c:3000&#125;&quot;)</span><br><span class=\"line\">private int c;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.d:4000000&#125;&quot;)</span><br><span class=\"line\">private long d;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.e:5.2&#125;&quot;)</span><br><span class=\"line\">private float e;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.f:6.1&#125;&quot;)</span><br><span class=\"line\">private double f;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.g:false&#125;&quot;)</span><br><span class=\"line\">private boolean g;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.h:h&#125;&quot;)</span><br><span class=\"line\">private char h;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.a:1&#125;&quot;)</span><br><span class=\"line\">private byte a1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.b:100&#125;&quot;)</span><br><span class=\"line\">private Short b1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.c:3000&#125;&quot;)</span><br><span class=\"line\">private Integer c1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.d:4000000&#125;&quot;)</span><br><span class=\"line\">private Long d1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.e:5.2&#125;&quot;)</span><br><span class=\"line\">private Float e1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.f:6.1&#125;&quot;)</span><br><span class=\"line\">private Double f1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.g:false&#125;&quot;)</span><br><span class=\"line\">private Boolean g1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.h:h&#125;&quot;)</span><br><span class=\"line\">private Character h1;</span><br></pre></td></tr></table></figure>\n\n<p>有了这些常用的数据类型，我们在定义变量类型时，可以非常愉快的玩耍了，不用做额外的转换。</p>\n<h3 id=\"6-2-数组\"><a href=\"#6-2-数组\" class=\"headerlink\" title=\"6.2 数组\"></a>6.2 数组</h3><p>但只用上面的基本类型是不够的，特别是很多需要批量处理数据的场景中。这时候可以使用<code>数组</code>，它在日常开发中使用的频率很高。</p>\n<p>我们在定义数组时可以这样写：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.array:1,2,3,4,5&#125;&quot;)</span><br><span class=\"line\">private int[] array;</span><br></pre></td></tr></table></figure>\n\n<p>spring默认使用逗号分隔参数值。</p>\n<p>如果用空格分隔，例如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.array:1 2 3 4 5&#125;&quot;)</span><br><span class=\"line\">private int[] array;</span><br></pre></td></tr></table></figure>\n\n<p>spring会自动把空格去掉，导致数据中只有一个值：12345，注意千万别搞错了。</p>\n<p>顺便说一下，定义数组的时候，里面还是有挺多门道的。比如上面列子中，我的数据是：1,2,3,4,5。</p>\n<p>如果我们把数组定义成：short、int、long、char、string类型，spring是可以正常注入属性值的。</p>\n<p>但如果把数组定义成：float、double类型，启动项目时就会直接报错。</p>\n<p><img src=\"https://raw.githubusercontent.com/lanbai1993/book/master/spring/images/202110281648428\" alt=\"图片\">小伙伴们，下巴惊掉了没？</p>\n<p>按理说，1,2,3,4,5用float、double是能够表示的呀，为什么会报错？</p>\n<p>如果使用int的包装类，比如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.array:1,2,3,4,5&#125;&quot;)</span><br><span class=\"line\">private Integer[] array;</span><br></pre></td></tr></table></figure>\n\n<p>启动项目时同样会报上面的异常。</p>\n<p>此外，定义数组时一定要注意属性值的类型，必须完全一致才可以，如果出现下面这种情况：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.array:1.0,abc,3,4,5&#125;&quot;)</span><br><span class=\"line\">private int[] array;</span><br></pre></td></tr></table></figure>\n\n<p>属性值中包含了1.0和abc，显然都无法将该字符串转换成int。</p>\n<h3 id=\"6-3-集合类\"><a href=\"#6-3-集合类\" class=\"headerlink\" title=\"6.3 集合类\"></a>6.3 集合类</h3><p>有了基本类型和数组，的确让我们更加方便了。但对数据的处理，只用数组这一种数据结构是远远不够的，下面给大家介绍一下其他的常用数据结构。</p>\n<h4 id=\"6-3-1-List\"><a href=\"#6-3-1-List\" class=\"headerlink\" title=\"6.3.1 List\"></a>6.3.1 List</h4><p>List是数组的变种，它的长度是可变的，而数组的长度是固定的。</p>\n<p>我们看看List是如何注入属性值的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.list&#125;&quot;)</span><br><span class=\"line\">private List&lt;String&gt; list;</span><br></pre></td></tr></table></figure>\n\n<p>最关键的是看配置文件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.list[0]=10</span><br><span class=\"line\">susan.test.list[1]=11</span><br><span class=\"line\">susan.test.list[2]=12</span><br><span class=\"line\">susan.test.list[3]=13</span><br></pre></td></tr></table></figure>\n\n<p>当你满怀希望的启动项目，准备使用这个功能的时候，却发现竟然报错了。</p>\n<p><img src=\"https://raw.githubusercontent.com/lanbai1993/book/master/spring/images/202110281648919\" alt=\"图片\">what?</p>\n<p>看来@Value不支持这种直接的List注入。</p>\n<p>那么，如何解决这个问题呢？</p>\n<p>有人说用<code>@ConfigurationProperties</code>。</p>\n<p>需要定义一个MyConfig类：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configuration</span><br><span class=\"line\">@ConfigurationProperties(prefix = &quot;susan.test&quot;)</span><br><span class=\"line\">@Data</span><br><span class=\"line\">public class MyConfig &#123;</span><br><span class=\"line\">    private List&lt;String&gt; list;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后在调用的地方这样写：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    private MyConfig myConfig;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        System.out.println(myConfig.getList());</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这种方法确实能够完成List注入。但是，只能说明@ConfigurationProperties注解的强大，跟@Value有半毛钱的关系？</p>\n<p>答：没有。</p>\n<p>那么，问题来了，用@Value如何实现这个功能呢？</p>\n<p>答：使用spring的EL表达式。</p>\n<p>List的定义改成：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;&#x27;$&#123;susan.test.list&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span><br><span class=\"line\">private List&lt;String&gt; list;</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>#</code>号加大括号的EL表达式。</p>\n<p>然后配置文件改成：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.list=10,11,12,13</span><br></pre></td></tr></table></figure>\n\n<p>跟定义数组时的配置文件一样。</p>\n<h4 id=\"6-3-2-Set\"><a href=\"#6-3-2-Set\" class=\"headerlink\" title=\"6.3.2 Set\"></a>6.3.2 Set</h4><p>Set也是一种保存数据的集合，它比较特殊，里面保存的数据不会重复。</p>\n<p>我们可以这样定义Set：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;&#x27;$&#123;susan.test.set&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span><br><span class=\"line\">private Set&lt;String&gt; set;</span><br></pre></td></tr></table></figure>\n\n<p>配置文件是这样的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.set=10,11,12,13</span><br></pre></td></tr></table></figure>\n\n<p>Set跟List的用法极为相似。</p>\n<p>但为了证明本节的独特之处，我打算说点新鲜的内容。</p>\n<p>如何给List或者Set设置默认值空呢？</p>\n<p>有些朋友可能会说：这还不简单，直接在@Value的$表达式后面加个:号不就行了。</p>\n<p>具体代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;&#x27;$&#123;susan.test.set:&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span><br><span class=\"line\">private Set&lt;String&gt; set;</span><br></pre></td></tr></table></figure>\n\n<p>结果却跟想象中不太一样：<img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191640261\" alt=\"图片\">Set集合怎么不是空的，而是包含了一个空字符串的集合？</p>\n<p>好吧，那我在:号后加null，总可以了吧？<img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191640025\" alt=\"图片\">Set集合也不是空的，而是包含了一个”null”字符串的集合。</p>\n<p>这也不行，那也不行，该如何是好？</p>\n<p>答：使用EL表达式的<code>empty</code>方法。</p>\n<p>具体代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;&#x27;$&#123;susan.test.set:&#125;&#x27;.empty ? null : &#x27;$&#123;susan.test.set:&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span><br><span class=\"line\">private Set&lt;String&gt; set;</span><br></pre></td></tr></table></figure>\n\n<p>运行之后，结果对了：<img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191640790\" alt=\"图片\"></p>\n<p>其实List也有类似的问题，也能使用该方法解决问题。</p>\n<blockquote>\n<p>在这里温馨的提醒一下，该判断的表达式比较复杂，自己手写非常容易写错，建议复制粘贴之后根据实际需求改改。</p>\n</blockquote>\n<h4 id=\"6-3-3-Map\"><a href=\"#6-3-3-Map\" class=\"headerlink\" title=\"6.3.3 Map\"></a>6.3.3 Map</h4><p>还有一种比较常用的集合是map，它支持key/value键值对的形式保存数据，并且不会出现相同key的数据。</p>\n<p>我们可以这样定义Map：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;$&#123;susan.test.map&#125;&#125;&quot;)</span><br><span class=\"line\">private Map&lt;String, String&gt; map;</span><br></pre></td></tr></table></figure>\n\n<p>配置文件是这样的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.map=&#123;&quot;name&quot;:&quot;苏三&quot;, &quot;age&quot;:&quot;18&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这种用法跟上面稍微有一点区别。</p>\n<p>设置默认值的代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;&#x27;$&#123;susan.test.map:&#125;&#x27;.empty ? null : &#x27;$&#123;susan.test.map:&#125;&#x27;&#125;&quot;)</span><br><span class=\"line\">private Map&lt;String, String&gt; map;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"7-EL高端玩法\"><a href=\"#7-EL高端玩法\" class=\"headerlink\" title=\"7 EL高端玩法\"></a>7 EL高端玩法</h2><p>前面我们已经见识过spring EL表达式的用法了，在设置空的默认值时特别有用。</p>\n<p>其实，<code>empty</code>方法只是它很普通的用法，还有更高端的用法，不信我们一起看看。</p>\n<h3 id=\"7-1-注入bean\"><a href=\"#7-1-注入bean\" class=\"headerlink\" title=\"7.1 注入bean\"></a>7.1 注入bean</h3><p>以前我们注入bean，一般都是用的@Autowired或者@Resource注解。例如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class RoleService &#123;</span><br><span class=\"line\">    public String getRoleName() &#123;</span><br><span class=\"line\">        return &quot;管理员&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    private RoleService roleService;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        System.out.println(roleService.getRoleName());</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>但我要告诉你的是@Value注解也可以注入bean，它是这么做的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;roleService&#125;&quot;)</span><br><span class=\"line\">private RoleService roleService;</span><br></pre></td></tr></table></figure>\n\n<p>通过这种方式，可以注入id为roleService的bean。</p>\n<h3 id=\"7-2-bean的变量和方法\"><a href=\"#7-2-bean的变量和方法\" class=\"headerlink\" title=\"7.2 bean的变量和方法\"></a>7.2 bean的变量和方法</h3><p>通过EL表达式，@Value注解已经可以注入bean了。既然能够拿到bean实例，接下来，可以再进一步。</p>\n<p>在RoleService类中定义了：成员变量、常量、方法、静态方法。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class RoleService &#123;</span><br><span class=\"line\">    public static final int DEFAULT_AGE = 18;</span><br><span class=\"line\">    public int id = 1000;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getRoleName() &#123;</span><br><span class=\"line\">        return &quot;管理员&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static int getParentId() &#123;</span><br><span class=\"line\">        return 2000;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在调用的地方这样写：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;#&#123;roleService.DEFAULT_AGE&#125;&quot;)</span><br><span class=\"line\">    private int myAge;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;#&#123;roleService.id&#125;&quot;)</span><br><span class=\"line\">    private int id;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;#&#123;roleService.getRoleName()&#125;&quot;)</span><br><span class=\"line\">    private String myRoleName;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;#&#123;roleService.getParentId()&#125;&quot;)</span><br><span class=\"line\">    private String myParentId;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        System.out.println(myAge);</span><br><span class=\"line\">        System.out.println(id);</span><br><span class=\"line\">        System.out.println(myRoleName);</span><br><span class=\"line\">        System.out.println(myParentId);</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在UserService类中通过@Value可以注入：成员变量、常量、方法、静态方法获取到的值，到相应的成员变量中。</p>\n<p>一下子有没有豁然开朗的感觉，有了这些，我们可以通过@Value注解，实现更多的功能了，不仅仅限于注入系统属性。</p>\n<h3 id=\"7-3-静态类\"><a href=\"#7-3-静态类\" class=\"headerlink\" title=\"7.3 静态类\"></a>7.3 静态类</h3><p>前面的内容都是基于bean的，但有时我们需要调用静态类，比如：Math、xxxUtil等静态工具类的方法，该怎么办呢？</p>\n<p>答：用T加括号。</p>\n<p>示例1：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;T(java.io.File).separator&#125;&quot;)</span><br><span class=\"line\">private String path;</span><br></pre></td></tr></table></figure>\n\n<p>可以注入系统的路径分隔符到path中。</p>\n<p>示例2：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;T(java.lang.Math).random()&#125;&quot;)</span><br><span class=\"line\">private double randomValue;</span><br></pre></td></tr></table></figure>\n\n<p>可以注入一个随机数到randomValue中。</p>\n<h3 id=\"7-4-逻辑运算\"><a href=\"#7-4-逻辑运算\" class=\"headerlink\" title=\"7.4 逻辑运算\"></a>7.4 逻辑运算</h3><p>通过上面介绍的内容，我们可以获取到绝大多数类的变量和方法的值了。但有了这些值，还不够，我们能不能在EL表达式中加点逻辑？</p>\n<p>拼接字符串：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;roleService.roleName + &#x27;&#x27; + roleService.DEFAULT_AGE&#125;&quot;)</span><br><span class=\"line\">private String value;</span><br></pre></td></tr></table></figure>\n\n<p>逻辑判断：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;roleService.DEFAULT_AGE &gt; 16 and roleService.roleName.equals(&#x27;苏三&#x27;)&#125;&quot;)</span><br><span class=\"line\">private String operation;</span><br></pre></td></tr></table></figure>\n\n<p>三目运算：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;roleService.DEFAULT_AGE &gt; 16 ? roleService.roleName: &#x27;苏三&#x27; &#125;&quot;)</span><br><span class=\"line\">private String realRoleName;</span><br></pre></td></tr></table></figure>\n\n<p>还有很多很多功能，我就不一一列举了。</p>\n<p>EL表达式实在太强大了，对这方面如果感兴趣的小伙伴可以找我私聊。</p>\n<h2 id=\"8-和-的区别\"><a href=\"#8-和-的区别\" class=\"headerlink\" title=\"8 ${}和#{}的区别\"></a>8 ${}和#{}的区别</h2><p>上面巴拉巴拉说了这么多@Value的牛逼用法，归根揭底就是<code>$&#123;&#125;</code>和<code>#&#123;&#125;</code>的用法。</p>\n<p>下面重点说说${}和#{}的区别，这可能是很多小伙伴比较关心的话题。</p>\n<h3 id=\"8-1\"><a href=\"#8-1\" class=\"headerlink\" title=\"8.1 ${}\"></a>8.1 ${}</h3><p>主要用于获取配置文件中的系统属性值。</p>\n<p>例如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(value = &quot;$&#123;susan.test.userName:susan&#125;&quot;)</span><br><span class=\"line\">private String userName;</span><br></pre></td></tr></table></figure>\n\n<p>通过<code>:</code>可以设置默认值。如果在配置文件中找不到susan.test.userName的配置，则注入时用默认值。</p>\n<p>如果在配置文件中找不到susan.test.userName的配置，也没有设置默认值，则启动项目时会报错。</p>\n<h3 id=\"8-2\"><a href=\"#8-2\" class=\"headerlink\" title=\"8.2 #{}\"></a>8.2 #{}</h3><p>主要用于通过spring的EL表达式，获取bean的属性，或者调用bean的某个方法。还有调用类的静态常量和静态方法。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;roleService.DEFAULT_AGE&#125;&quot;)</span><br><span class=\"line\">private int myAge;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;#&#123;roleService.id&#125;&quot;)</span><br><span class=\"line\">private int id;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;#&#123;roleService.getRoleName()&#125;&quot;)</span><br><span class=\"line\">private String myRoleName;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;#&#123;T(java.lang.Math).random()&#125;&quot;)</span><br><span class=\"line\">private double randomValue;</span><br></pre></td></tr></table></figure>\n\n<p>如果是调用类的静态方法，则需要加T(包名 + 方法名称)。</p>\n<p>例如：T(java.lang.Math)。</p>\n<p>好了，今天的内容就介绍到这里，希望对你会有所帮助。随便剧透一下，后面的文章会继续介绍：</p>\n<ol>\n<li>@Value的原理</li>\n<li>@Value动态刷新属性值的原因</li>\n<li>@ConfigurationProperties注解的用法，它也非常强大。 也非常强大。 </li>\n</ol>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>对于从事java开发工作的小伙伴来说，spring框架肯定再熟悉不过了。spring给开发者提供了非常丰富的api，满足我们日常的工作需求。</p>\n<p>如果想要创建bean实例，可以使用@Controller、@Service、@Repository、@Component等注解。</p>\n<p>如果想要依赖注入某个对象，可以使用@Autowired和@Resource注解。</p>\n<p>如果想要开启事务，可以使用@Transactional注解。</p>\n<p>如果想要动态读取配置文件中的某个系统属性，可以使用@Value注解。</p>\n<p>等等，还有很多。。。</p>\n<p>今天咱们重点聊聊<code>@Value</code>注解，因为它是一个非常有用，但极其容易被忽视的注解，绝大多数人可能只用过它的一部分功能，这是一件非常遗憾的事情。</p>\n<p>所以今天有必要和大家一起，重新认识一下<code>@Value</code>。<img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191639922\" alt=\"图片\"></p>\n<h2 id=\"1-由一个例子开始\"><a href=\"#1-由一个例子开始\" class=\"headerlink\" title=\"1. 由一个例子开始\"></a>1. 由一个例子开始</h2><p>假如在UserService类中，需要注入系统属性到userName变量中。通常情况下，我们会写出如下的代码：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;$&#123;susan.test.userName&#125;&quot;)</span><br><span class=\"line\">    private String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        System.out.println(userName);</span><br><span class=\"line\">        return userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>通过<code>@Value</code>注解指定系统属性的名称<code>susan.test.userName</code>，该名称需要使用<code>$&#123;&#125;</code>包起来。</p>\n<p>这样spring就会自动的帮我们把对应的系统属性值，注入到userName变量中。</p>\n<p>不过，上面功能的重点是要在<code>applicationContext.properties</code>文件（简称：配置文件）中配置同名的系统属性：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#张三</span><br><span class=\"line\">susan.test.userName=\\u5f20\\u4e09</span><br></pre></td></tr></table></figure>\n\n<p>那么，名称真的必须完全相同吗？</p>\n<h2 id=\"2-关于属性名\"><a href=\"#2-关于属性名\" class=\"headerlink\" title=\"2. 关于属性名\"></a>2. 关于属性名</h2><p>这时候，有些朋友可能会说：在<code>@ConfigurationProperties</code>配置类中，定义的参数名可以跟配置文件中的系统属性名不同。</p>\n<p>比如，在配置类MyConfig类中定义的参数名是userName：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configuration</span><br><span class=\"line\">@ConfigurationProperties(prefix = &quot;susan.test&quot;)</span><br><span class=\"line\">@Data</span><br><span class=\"line\">public class MyConfig &#123;</span><br><span class=\"line\">    private String userName;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>而配置文件中配置的系统属性名是：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.user-name=\\u5f20\\u4e09</span><br></pre></td></tr></table></figure>\n\n<p>类中用的<code>userName</code>，而配置文件中用的<code>user-name</code>，不一样。但测试之后，发现该功能能够正常运行。</p>\n<p>配置文件中的系统属性名用 <code>驼峰标识</code> 或 <code>小写字母加中划线的组合</code>，spring都能找到配置类中的属性名userName进行赋值。</p>\n<p>由此可见，配置文件中的系统属性名，可以跟配置类中的属性名不一样。不过，有个前提，前缀susan.test必须相同。</p>\n<p>那么，<code>@Value</code>注解中定义的系统属性名也可以不一样吗？</p>\n<p>答案：不能。如果不一样，启动项目时会直接报错。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191639512\" alt=\"图片\">此外，如果只在@Value注解中指定了系统属性名，但实际在配置文件中没有配置它，也会报跟上面一样的错。</p>\n<p>所以，**@Value注解中指定的系统属性名，必须跟配置文件中的相同。**</p>\n<h2 id=\"3-乱码问题\"><a href=\"#3-乱码问题\" class=\"headerlink\" title=\"3. 乱码问题\"></a>3. 乱码问题</h2><p>不知道细心的小伙伴们有没有发现，我配置的属性值：<code>张三</code>，其实是<code>转义</code>过的。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.userName=\\u5f20\\u4e09</span><br></pre></td></tr></table></figure>\n\n<p>为什么要做这个转义？</p>\n<p>假如在配置文件中配置中文的张三：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.userName=张三</span><br></pre></td></tr></table></figure>\n\n<p>最后获取数据时，你会发现userName竟然出现了乱码：</p>\n<blockquote>\n<p>å¼ ä¸</p>\n</blockquote>\n<p>what？</p>\n<p>为什么会出现乱码？</p>\n<p>答：在springboot的<code>CharacterReader</code>类中，默认的编码格式是<code>ISO-8859-1</code>，该类负责<code>.properties</code>文件中系统属性的读取。如果系统属性包含中文字符，就会出现乱码。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191639539\" alt=\"图片\">那么，如何解决乱码问题呢？</p>\n<p>目前主要有如下三种方案：</p>\n<ol>\n<li>手动将ISO-8859-1格式的属性值，转换成UTF-8格式。</li>\n<li>设置encoding参数，不过这个只对@PropertySource注解有用。</li>\n<li>将中文字符用unicode编码转义。</li>\n</ol>\n<p>显然@Value不支持encoding参数，所以方案2不行。</p>\n<p>假如使用方案1，具体实现代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(value = &quot;$&#123;susan.test.userName&#125;&quot;)</span><br><span class=\"line\">    private String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        String userName1 = new String(userName.getBytes(StandardCharsets.ISO_8859_1), StandardCharsets.UTF_8);</span><br><span class=\"line\">        System.out.println();</span><br><span class=\"line\">        return userName1;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>确实可以解决乱码问题。</p>\n<p>但如果项目中包含大量中文系统属性值，每次都需要加这样一段特殊转换代码。出现大量重复代码，有没有觉得有点恶心？</p>\n<p>反转我被恶心到了。</p>\n<p>那么，如何解决代码重复问题呢？</p>\n<p>答：将属性值的中文内容转换成unicode。</p>\n<p>类似于这样的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.userName=\\u5f20\\u4e09</span><br></pre></td></tr></table></figure>\n\n<p>这种方式同样能解决乱码问题，不会出现恶心的重复代码。但需要做一点额外的转换工作，不过这个转换非常容易，因为有现成的在线转换工具。</p>\n<blockquote>\n<p>推荐使用这个工具转换：<a href=\"http://www.jsons.cn/unicode/\">http://www.jsons.cn/unicode/</a></p>\n</blockquote>\n<p>在这里顺便告诉你一个小秘密：如果你使用的是<code>.yml</code>或<code>.yaml</code>格式的配置文件，并不会出现中文乱码问题。</p>\n<p>这又是为什么？</p>\n<p>因为.yml或.yaml格式的配置文件，最终会使用<code>UnicodeReader</code>类进行解析，它的<code>init</code>方法中，首先读取BOM文件头信息，如果头信息中有UTF8、UTF16BE、UTF16LE，就采用对应的编码，如果没有，则采用默认<code>UTF8</code>编码。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191639766\" alt=\"图片\"></p>\n<blockquote>\n<p>需要注意的是：乱码问题一般出现在本地环境，因为本地直接读取的.properties配置文件。在dev、test、生产等环境，如果从zookeeper、apollo、nacos等配置中心中获取系统参数值，走的是另外的逻辑，并不会出现乱码问题。</p>\n</blockquote>\n<h2 id=\"4-默认值\"><a href=\"#4-默认值\" class=\"headerlink\" title=\"4.默认值\"></a>4.默认值</h2><p>有时候，默认值是我们非常头疼的问题。</p>\n<p>为什么这样说呢？</p>\n<p>因为很多时候使用java的默认值，并不能满足我们的日常工作需求。</p>\n<p>比如有这样一个需求：如果配置了系统属性，userName就用配置的属性值。如果没有配置，则userName用默认值susan。</p>\n<p>有些朋友可能认为可以这样做：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(value = &quot;$&#123;susan.test.userName&#125;&quot;)</span><br><span class=\"line\">private String userName = &quot;susan&quot;;</span><br></pre></td></tr></table></figure>\n\n<p>在定义参数时直接给个默认值，但如果仔细想想这招是行不通的的。因为设置userName默认值的时机，比@Value注解依赖注入属性值要早，也就是说userName初始化好了默认值，后面还是会被覆盖。</p>\n<p>那么，到底该如何设置默认值呢？</p>\n<p>答：使用<code>:</code>。</p>\n<p>例如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(value = &quot;$&#123;susan.test.userName:susan&#125;&quot;)</span><br><span class=\"line\">private String userName;</span><br></pre></td></tr></table></figure>\n\n<p>在需要设置默认值的系统属性名后，加<code>:</code>符号。紧接着，在<code>:</code>右边设置默认值。</p>\n<p>建议大家平时在使用@Value时，尽量都设置一个默认值。如果不需要默认值，宁可设置一个空。比如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(value = &quot;$&#123;susan.test.userName:&#125;&quot;)</span><br><span class=\"line\">private String userName;</span><br></pre></td></tr></table></figure>\n\n<p>为什么这么说？</p>\n<p>假如有这种场景：在business层中包含了UserService类，business层被api服务和job服务都引用了。但UserService类中@Value的userName只在api服务中有用，在job服务中根本用不到该属性。</p>\n<p>对于job服务来说，如果不在.properties文件中配置同名的系统属性，则服务启动时就会报错。</p>\n<p>这个坑，我之前踩过多次。所以，建议大家，使用@Value注解时，最好给参数设置一个默认值，以防止出现类似的问题。</p>\n<h2 id=\"5-static变量\"><a href=\"#5-static变量\" class=\"headerlink\" title=\"5. static变量\"></a>5. static变量</h2><p>前面我们已经见识过，如何使用@Value注解，给类的<code>成员变量</code>注入<code>系统属性值</code>。</p>\n<p>那么，问题来了，<code>静态变量</code>可以自动注入系统属性值不？</p>\n<p>我们一起看看，假如将上面的userName定义成<code>static</code>的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.userName&#125;&quot;)</span><br><span class=\"line\">private static String userName;</span><br></pre></td></tr></table></figure>\n\n<p>程序可以正常启动，但是获取到userName的值却是null。</p>\n<p>由此可见，被<code>static</code>修饰的变量通过@Value会注入失败。</p>\n<p>作为好奇宝宝的你，此时肯定想问：如何才能给静态变量注入系统属性值呢？</p>\n<p>答：这就需要使用如下的骚代码了：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    private static String userName;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;$&#123;susan.test.userName&#125;&quot;)</span><br><span class=\"line\">    public void setUserName(String userName) &#123;</span><br><span class=\"line\">        UserService.userName = userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        return userName;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>提供一个静态参数的<code>setter</code>方法，在该方法上使用@Value注入属性值，并且同时在该方法中给静态变量赋值。</p>\n<p>有些细心的朋友可能会发现，@Value注解在这里竟然使用在setUserName方法上了，也就是对应的setter方法，而不是在变量上。</p>\n<p>有趣，有趣，这种用法有点高端喔。</p>\n<p>不过，通常情况下，我们一般会在pojo实体类上，使用lombok的@Data、@Setter、@Getter等注解，在编译时动态增加setter或getter方法，所以@Value用在方法上的场景其实不多。</p>\n<h2 id=\"6-变量类型\"><a href=\"#6-变量类型\" class=\"headerlink\" title=\"6.变量类型\"></a>6.变量类型</h2><p>上面的内容，都是用的字符串类型的变量进行举例的。其实，@Value注解还支持其他多种类型的系统属性值的注入。</p>\n<h3 id=\"6-1-基本类型\"><a href=\"#6-1-基本类型\" class=\"headerlink\" title=\"6.1 基本类型\"></a>6.1 基本类型</h3><p>众所周知，在Java中的基本数据类型有4类8种，然我们一起回顾一下：</p>\n<ul>\n<li>整型：byte、short、int、long</li>\n<li>浮点型：float、double</li>\n<li>布尔型：boolean</li>\n<li>字符型：char</li>\n</ul>\n<p>相对应地提供了8种包装类：</p>\n<ul>\n<li>整型：Byte、Short、Integer、Long</li>\n<li>浮点型：Float、Double</li>\n<li>布尔型：Boolean</li>\n<li>字符型：Character</li>\n</ul>\n<p>@Value注解对这8中基本类型和相应的包装类，有非常良好的支持，例如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.a:1&#125;&quot;)</span><br><span class=\"line\">private byte a;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.b:100&#125;&quot;)</span><br><span class=\"line\">private short b;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.c:3000&#125;&quot;)</span><br><span class=\"line\">private int c;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.d:4000000&#125;&quot;)</span><br><span class=\"line\">private long d;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.e:5.2&#125;&quot;)</span><br><span class=\"line\">private float e;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.f:6.1&#125;&quot;)</span><br><span class=\"line\">private double f;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.g:false&#125;&quot;)</span><br><span class=\"line\">private boolean g;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.h:h&#125;&quot;)</span><br><span class=\"line\">private char h;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.a:1&#125;&quot;)</span><br><span class=\"line\">private byte a1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.b:100&#125;&quot;)</span><br><span class=\"line\">private Short b1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.c:3000&#125;&quot;)</span><br><span class=\"line\">private Integer c1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.d:4000000&#125;&quot;)</span><br><span class=\"line\">private Long d1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.e:5.2&#125;&quot;)</span><br><span class=\"line\">private Float e1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.f:6.1&#125;&quot;)</span><br><span class=\"line\">private Double f1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.g:false&#125;&quot;)</span><br><span class=\"line\">private Boolean g1;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;$&#123;susan.test.h:h&#125;&quot;)</span><br><span class=\"line\">private Character h1;</span><br></pre></td></tr></table></figure>\n\n<p>有了这些常用的数据类型，我们在定义变量类型时，可以非常愉快的玩耍了，不用做额外的转换。</p>\n<h3 id=\"6-2-数组\"><a href=\"#6-2-数组\" class=\"headerlink\" title=\"6.2 数组\"></a>6.2 数组</h3><p>但只用上面的基本类型是不够的，特别是很多需要批量处理数据的场景中。这时候可以使用<code>数组</code>，它在日常开发中使用的频率很高。</p>\n<p>我们在定义数组时可以这样写：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.array:1,2,3,4,5&#125;&quot;)</span><br><span class=\"line\">private int[] array;</span><br></pre></td></tr></table></figure>\n\n<p>spring默认使用逗号分隔参数值。</p>\n<p>如果用空格分隔，例如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.array:1 2 3 4 5&#125;&quot;)</span><br><span class=\"line\">private int[] array;</span><br></pre></td></tr></table></figure>\n\n<p>spring会自动把空格去掉，导致数据中只有一个值：12345，注意千万别搞错了。</p>\n<p>顺便说一下，定义数组的时候，里面还是有挺多门道的。比如上面列子中，我的数据是：1,2,3,4,5。</p>\n<p>如果我们把数组定义成：short、int、long、char、string类型，spring是可以正常注入属性值的。</p>\n<p>但如果把数组定义成：float、double类型，启动项目时就会直接报错。</p>\n<p><img src=\"https://raw.githubusercontent.com/lanbai1993/book/master/spring/images/202110281648428\" alt=\"图片\">小伙伴们，下巴惊掉了没？</p>\n<p>按理说，1,2,3,4,5用float、double是能够表示的呀，为什么会报错？</p>\n<p>如果使用int的包装类，比如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.array:1,2,3,4,5&#125;&quot;)</span><br><span class=\"line\">private Integer[] array;</span><br></pre></td></tr></table></figure>\n\n<p>启动项目时同样会报上面的异常。</p>\n<p>此外，定义数组时一定要注意属性值的类型，必须完全一致才可以，如果出现下面这种情况：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.array:1.0,abc,3,4,5&#125;&quot;)</span><br><span class=\"line\">private int[] array;</span><br></pre></td></tr></table></figure>\n\n<p>属性值中包含了1.0和abc，显然都无法将该字符串转换成int。</p>\n<h3 id=\"6-3-集合类\"><a href=\"#6-3-集合类\" class=\"headerlink\" title=\"6.3 集合类\"></a>6.3 集合类</h3><p>有了基本类型和数组，的确让我们更加方便了。但对数据的处理，只用数组这一种数据结构是远远不够的，下面给大家介绍一下其他的常用数据结构。</p>\n<h4 id=\"6-3-1-List\"><a href=\"#6-3-1-List\" class=\"headerlink\" title=\"6.3.1 List\"></a>6.3.1 List</h4><p>List是数组的变种，它的长度是可变的，而数组的长度是固定的。</p>\n<p>我们看看List是如何注入属性值的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;$&#123;susan.test.list&#125;&quot;)</span><br><span class=\"line\">private List&lt;String&gt; list;</span><br></pre></td></tr></table></figure>\n\n<p>最关键的是看配置文件：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.list[0]=10</span><br><span class=\"line\">susan.test.list[1]=11</span><br><span class=\"line\">susan.test.list[2]=12</span><br><span class=\"line\">susan.test.list[3]=13</span><br></pre></td></tr></table></figure>\n\n<p>当你满怀希望的启动项目，准备使用这个功能的时候，却发现竟然报错了。</p>\n<p><img src=\"https://raw.githubusercontent.com/lanbai1993/book/master/spring/images/202110281648919\" alt=\"图片\">what?</p>\n<p>看来@Value不支持这种直接的List注入。</p>\n<p>那么，如何解决这个问题呢？</p>\n<p>有人说用<code>@ConfigurationProperties</code>。</p>\n<p>需要定义一个MyConfig类：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Configuration</span><br><span class=\"line\">@ConfigurationProperties(prefix = &quot;susan.test&quot;)</span><br><span class=\"line\">@Data</span><br><span class=\"line\">public class MyConfig &#123;</span><br><span class=\"line\">    private List&lt;String&gt; list;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>然后在调用的地方这样写：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    private MyConfig myConfig;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        System.out.println(myConfig.getList());</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这种方法确实能够完成List注入。但是，只能说明@ConfigurationProperties注解的强大，跟@Value有半毛钱的关系？</p>\n<p>答：没有。</p>\n<p>那么，问题来了，用@Value如何实现这个功能呢？</p>\n<p>答：使用spring的EL表达式。</p>\n<p>List的定义改成：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;&#x27;$&#123;susan.test.list&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span><br><span class=\"line\">private List&lt;String&gt; list;</span><br></pre></td></tr></table></figure>\n\n<p>使用<code>#</code>号加大括号的EL表达式。</p>\n<p>然后配置文件改成：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.list=10,11,12,13</span><br></pre></td></tr></table></figure>\n\n<p>跟定义数组时的配置文件一样。</p>\n<h4 id=\"6-3-2-Set\"><a href=\"#6-3-2-Set\" class=\"headerlink\" title=\"6.3.2 Set\"></a>6.3.2 Set</h4><p>Set也是一种保存数据的集合，它比较特殊，里面保存的数据不会重复。</p>\n<p>我们可以这样定义Set：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;&#x27;$&#123;susan.test.set&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span><br><span class=\"line\">private Set&lt;String&gt; set;</span><br></pre></td></tr></table></figure>\n\n<p>配置文件是这样的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.set=10,11,12,13</span><br></pre></td></tr></table></figure>\n\n<p>Set跟List的用法极为相似。</p>\n<p>但为了证明本节的独特之处，我打算说点新鲜的内容。</p>\n<p>如何给List或者Set设置默认值空呢？</p>\n<p>有些朋友可能会说：这还不简单，直接在@Value的$表达式后面加个:号不就行了。</p>\n<p>具体代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;&#x27;$&#123;susan.test.set:&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span><br><span class=\"line\">private Set&lt;String&gt; set;</span><br></pre></td></tr></table></figure>\n\n<p>结果却跟想象中不太一样：<img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191640261\" alt=\"图片\">Set集合怎么不是空的，而是包含了一个空字符串的集合？</p>\n<p>好吧，那我在:号后加null，总可以了吧？<img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191640025\" alt=\"图片\">Set集合也不是空的，而是包含了一个”null”字符串的集合。</p>\n<p>这也不行，那也不行，该如何是好？</p>\n<p>答：使用EL表达式的<code>empty</code>方法。</p>\n<p>具体代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;&#x27;$&#123;susan.test.set:&#125;&#x27;.empty ? null : &#x27;$&#123;susan.test.set:&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span><br><span class=\"line\">private Set&lt;String&gt; set;</span><br></pre></td></tr></table></figure>\n\n<p>运行之后，结果对了：<img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191640790\" alt=\"图片\"></p>\n<p>其实List也有类似的问题，也能使用该方法解决问题。</p>\n<blockquote>\n<p>在这里温馨的提醒一下，该判断的表达式比较复杂，自己手写非常容易写错，建议复制粘贴之后根据实际需求改改。</p>\n</blockquote>\n<h4 id=\"6-3-3-Map\"><a href=\"#6-3-3-Map\" class=\"headerlink\" title=\"6.3.3 Map\"></a>6.3.3 Map</h4><p>还有一种比较常用的集合是map，它支持key/value键值对的形式保存数据，并且不会出现相同key的数据。</p>\n<p>我们可以这样定义Map：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;$&#123;susan.test.map&#125;&#125;&quot;)</span><br><span class=\"line\">private Map&lt;String, String&gt; map;</span><br></pre></td></tr></table></figure>\n\n<p>配置文件是这样的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">susan.test.map=&#123;&quot;name&quot;:&quot;苏三&quot;, &quot;age&quot;:&quot;18&quot;&#125;</span><br></pre></td></tr></table></figure>\n\n<p>这种用法跟上面稍微有一点区别。</p>\n<p>设置默认值的代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;&#x27;$&#123;susan.test.map:&#125;&#x27;.empty ? null : &#x27;$&#123;susan.test.map:&#125;&#x27;&#125;&quot;)</span><br><span class=\"line\">private Map&lt;String, String&gt; map;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"7-EL高端玩法\"><a href=\"#7-EL高端玩法\" class=\"headerlink\" title=\"7 EL高端玩法\"></a>7 EL高端玩法</h2><p>前面我们已经见识过spring EL表达式的用法了，在设置空的默认值时特别有用。</p>\n<p>其实，<code>empty</code>方法只是它很普通的用法，还有更高端的用法，不信我们一起看看。</p>\n<h3 id=\"7-1-注入bean\"><a href=\"#7-1-注入bean\" class=\"headerlink\" title=\"7.1 注入bean\"></a>7.1 注入bean</h3><p>以前我们注入bean，一般都是用的@Autowired或者@Resource注解。例如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class RoleService &#123;</span><br><span class=\"line\">    public String getRoleName() &#123;</span><br><span class=\"line\">        return &quot;管理员&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Autowired</span><br><span class=\"line\">    private RoleService roleService;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        System.out.println(roleService.getRoleName());</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>但我要告诉你的是@Value注解也可以注入bean，它是这么做的：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;roleService&#125;&quot;)</span><br><span class=\"line\">private RoleService roleService;</span><br></pre></td></tr></table></figure>\n\n<p>通过这种方式，可以注入id为roleService的bean。</p>\n<h3 id=\"7-2-bean的变量和方法\"><a href=\"#7-2-bean的变量和方法\" class=\"headerlink\" title=\"7.2 bean的变量和方法\"></a>7.2 bean的变量和方法</h3><p>通过EL表达式，@Value注解已经可以注入bean了。既然能够拿到bean实例，接下来，可以再进一步。</p>\n<p>在RoleService类中定义了：成员变量、常量、方法、静态方法。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class RoleService &#123;</span><br><span class=\"line\">    public static final int DEFAULT_AGE = 18;</span><br><span class=\"line\">    public int id = 1000;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String getRoleName() &#123;</span><br><span class=\"line\">        return &quot;管理员&quot;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    public static int getParentId() &#123;</span><br><span class=\"line\">        return 2000;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在调用的地方这样写：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Service</span><br><span class=\"line\">public class UserService &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;#&#123;roleService.DEFAULT_AGE&#125;&quot;)</span><br><span class=\"line\">    private int myAge;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;#&#123;roleService.id&#125;&quot;)</span><br><span class=\"line\">    private int id;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;#&#123;roleService.getRoleName()&#125;&quot;)</span><br><span class=\"line\">    private String myRoleName;</span><br><span class=\"line\"></span><br><span class=\"line\">    @Value(&quot;#&#123;roleService.getParentId()&#125;&quot;)</span><br><span class=\"line\">    private String myParentId;</span><br><span class=\"line\"></span><br><span class=\"line\">    public String test() &#123;</span><br><span class=\"line\">        System.out.println(myAge);</span><br><span class=\"line\">        System.out.println(id);</span><br><span class=\"line\">        System.out.println(myRoleName);</span><br><span class=\"line\">        System.out.println(myParentId);</span><br><span class=\"line\">        return null;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>在UserService类中通过@Value可以注入：成员变量、常量、方法、静态方法获取到的值，到相应的成员变量中。</p>\n<p>一下子有没有豁然开朗的感觉，有了这些，我们可以通过@Value注解，实现更多的功能了，不仅仅限于注入系统属性。</p>\n<h3 id=\"7-3-静态类\"><a href=\"#7-3-静态类\" class=\"headerlink\" title=\"7.3 静态类\"></a>7.3 静态类</h3><p>前面的内容都是基于bean的，但有时我们需要调用静态类，比如：Math、xxxUtil等静态工具类的方法，该怎么办呢？</p>\n<p>答：用T加括号。</p>\n<p>示例1：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;T(java.io.File).separator&#125;&quot;)</span><br><span class=\"line\">private String path;</span><br></pre></td></tr></table></figure>\n\n<p>可以注入系统的路径分隔符到path中。</p>\n<p>示例2：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;T(java.lang.Math).random()&#125;&quot;)</span><br><span class=\"line\">private double randomValue;</span><br></pre></td></tr></table></figure>\n\n<p>可以注入一个随机数到randomValue中。</p>\n<h3 id=\"7-4-逻辑运算\"><a href=\"#7-4-逻辑运算\" class=\"headerlink\" title=\"7.4 逻辑运算\"></a>7.4 逻辑运算</h3><p>通过上面介绍的内容，我们可以获取到绝大多数类的变量和方法的值了。但有了这些值，还不够，我们能不能在EL表达式中加点逻辑？</p>\n<p>拼接字符串：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;roleService.roleName + &#x27;&#x27; + roleService.DEFAULT_AGE&#125;&quot;)</span><br><span class=\"line\">private String value;</span><br></pre></td></tr></table></figure>\n\n<p>逻辑判断：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;roleService.DEFAULT_AGE &gt; 16 and roleService.roleName.equals(&#x27;苏三&#x27;)&#125;&quot;)</span><br><span class=\"line\">private String operation;</span><br></pre></td></tr></table></figure>\n\n<p>三目运算：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;roleService.DEFAULT_AGE &gt; 16 ? roleService.roleName: &#x27;苏三&#x27; &#125;&quot;)</span><br><span class=\"line\">private String realRoleName;</span><br></pre></td></tr></table></figure>\n\n<p>还有很多很多功能，我就不一一列举了。</p>\n<p>EL表达式实在太强大了，对这方面如果感兴趣的小伙伴可以找我私聊。</p>\n<h2 id=\"8-和-的区别\"><a href=\"#8-和-的区别\" class=\"headerlink\" title=\"8 ${}和#{}的区别\"></a>8 ${}和#{}的区别</h2><p>上面巴拉巴拉说了这么多@Value的牛逼用法，归根揭底就是<code>$&#123;&#125;</code>和<code>#&#123;&#125;</code>的用法。</p>\n<p>下面重点说说${}和#{}的区别，这可能是很多小伙伴比较关心的话题。</p>\n<h3 id=\"8-1\"><a href=\"#8-1\" class=\"headerlink\" title=\"8.1 ${}\"></a>8.1 ${}</h3><p>主要用于获取配置文件中的系统属性值。</p>\n<p>例如：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(value = &quot;$&#123;susan.test.userName:susan&#125;&quot;)</span><br><span class=\"line\">private String userName;</span><br></pre></td></tr></table></figure>\n\n<p>通过<code>:</code>可以设置默认值。如果在配置文件中找不到susan.test.userName的配置，则注入时用默认值。</p>\n<p>如果在配置文件中找不到susan.test.userName的配置，也没有设置默认值，则启动项目时会报错。</p>\n<h3 id=\"8-2\"><a href=\"#8-2\" class=\"headerlink\" title=\"8.2 #{}\"></a>8.2 #{}</h3><p>主要用于通过spring的EL表达式，获取bean的属性，或者调用bean的某个方法。还有调用类的静态常量和静态方法。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Value(&quot;#&#123;roleService.DEFAULT_AGE&#125;&quot;)</span><br><span class=\"line\">private int myAge;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;#&#123;roleService.id&#125;&quot;)</span><br><span class=\"line\">private int id;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;#&#123;roleService.getRoleName()&#125;&quot;)</span><br><span class=\"line\">private String myRoleName;</span><br><span class=\"line\"></span><br><span class=\"line\">@Value(&quot;#&#123;T(java.lang.Math).random()&#125;&quot;)</span><br><span class=\"line\">private double randomValue;</span><br></pre></td></tr></table></figure>\n\n<p>如果是调用类的静态方法，则需要加T(包名 + 方法名称)。</p>\n<p>例如：T(java.lang.Math)。</p>\n<p>好了，今天的内容就介绍到这里，希望对你会有所帮助。随便剧透一下，后面的文章会继续介绍：</p>\n<ol>\n<li>@Value的原理</li>\n<li>@Value动态刷新属性值的原因</li>\n<li>@ConfigurationProperties注解的用法，它也非常强大。 也非常强大。 </li>\n</ol>\n"},{"uuid":"bbaf6f29-c0ab-11ec-92a1-7557b2313227","title":"rabbitmq 入门","abbrlink":"114958f5","_content":"\n## 1 MQ引言\n\n> 参考 https://blog.csdn.net/unique_perfect/article/details/109380996\n\n### 1.1 什么是MQ\n\n~~~\nMQ(Message Quene) :  翻译为消息队列,通过典型的生产者\n和消费者模型,生产者不断向消息队列中生产消息，消费者\n不断的从队列中获取消息。因为消息的生产和消费都是异\n步的，而且只关心消息的发送和接收，没有业务逻辑的侵\n入,轻松的实现系统间解耦。别名为 消息中间件通过利用\n高效可靠的消息传递机制进行平台无关的数据交流，并\n基于数据通信来进行分布式系统的集成。\n~~~\n\n### 1.2 MQ有哪些\n\n~~~\n当今市面上有很多主流的消息中间件，如老牌的ActiveMQ、\nRabbitMQ，炙手可热的Kafka，阿里巴巴自主开发RocketMQ等。\n~~~\n\n### 1.3 不同MQ特点\n\n~~~\n1.ActiveMQ\n\t\tActiveMQ 是Apache出品，最流行的，能力强劲的开源\n\t\t消息总线。它是一个完全支持JMS规范的的消息中间件。\n\t\t丰富的API,多种集群架构模式让ActiveMQ在业界成为老\n\t\t牌的消息中间件,在中小型企业 颇受欢迎!\n\n2.Kafka\n\t\tKafka是LinkedIn开源的分布式发布-订阅消息系统，目\n\t\t前归属于Apache顶级项目。Kafka主要特点是基于Pull\n\t\t的模式来处理消息消费，追求高吞吐量，一开始的目的\n\t\t就是用于日志收集和传输。0.8版本开始支持复制，不支\n\t\t持事务，对消息的重复、丢失、错误没有严格要求，\n\t\t适合产生大量数据的互联网服务的数据收集业务。\n\n3.RocketMQ\n\t\tRocketMQ是阿里开源的消息中间件，它是纯Java开发，\n\t\t具有高吞吐量、高可用性、适合大规模分布式系统应用\n\t\t的特点。RocketMQ思路起源于Kafka，但并不是Kafka\n\t\t的一个Copy，它对消息的可靠传输及事务性做了优化，\n\t\t目前在阿里集团被广泛应用于交   易、充值、流计算、\n\t\t消息推送、日志流式处理、binglog分发等场景。\n\n4.RabbitMQ\n\t\tRabbitMQ是使用Erlang语言开发的开源消息队列系统，\n\t\t基于AMQP协议来实现。AMQP的主要特征是面向消息、\n\t\t队列、路由（包括点对点和发布/订阅）、可靠性、安全。\n\t\tAMQP协议更多用在企业系统内对数据一致性、稳定性和\n\t\t可靠性要求很高的场景，对性能和吞吐量的要求还在\n\t\t其次。\n\nRabbitMQ比Kafka可靠，Kafka更适合IO高吞吐的处理，一般应用\n在大数据日志处理或对实时性（少量延迟），可靠性（少量丢数据）\n要求稍低的场景使用，比如ELK日志收集。\t\t\n~~~\n\n## 2 RabbitMQ 的引言\n\n### 2.1 RabbitMQ\n\n~~~\n基于AMQP协议，erlang语言开发，是部署最广泛的开源\n消息中间件,是最受欢迎的开源消息中间件之一。\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191626795.png)\n\n~~~\nAMQP 协议\n \tAMQP（advanced message queuing protocol）在2003年\n \t时被提出，最早用于解决金融领不同平台之间的消息传递\n \t交互问题。顾名思义，AMQP是一种协议，更准确的说是\n \t一种binary wire-level protocol（链接协议）。这是其和\n \tJMS的本质差别，AMQP不从API层进行限定，而是直接\n \t定义网络交换的数据格式。这使得实现了AMQP的\n \tprovider天然性就是跨平台的。以下是AMQP协议模型:\n~~~\n\n![image-20211115164234247](https://raw.githubusercontent.com/xzyup/image/master/202203191627854.png)\n\n### 2.2 RabbitMQ 的安装\n\n~~~\n最新版的3.8版本的可以看我这篇文章\nhttps://blog.csdn.net/unique_perfect/article/details/108643804\n~~~\n\n#### 2.2.1 下载\n\n![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191627315.png)\n\n`注意:这里的安装包是centos7安装的包`\n\n#### 2.2.3 安装步骤\n\n~~~\n# 1.将rabbitmq安装包上传到linux系统中\n\terlang-22.0.7-1.el7.x86_64.rpm  #l7表示是Centosl7,Centosl8表示Centos8\n\trabbitmq-server-3.7.18-1.el7.noarch.rpm\n\n# 2.安装Erlang依赖包\n\trpm -ivh erlang-22.0.7-1.el7.x86_64.rpm\n\n# 3.安装RabbitMQ安装包(需要联网)\n\tyum install -y rabbitmq-server-3.7.18-1.el7.noarch.rpm\n\t注意:默认安装完成后配置文件模板在:/usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example目录中,需要\t\n\t将配置文件复制到/etc/rabbitmq/目录中,并修改名称为rabbitmq.config\n# 4.复制配置文件\n\tcp /usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example /etc/rabbitmq/rabbitmq.config\n\n# 5.查看配置文件位置\n\tls /etc/rabbitmq/rabbitmq.config\n\n# 6.修改配置文件(参见下图:)\n\tvim /etc/rabbitmq/rabbitmq.config \n~~~\n\n![image-20211115164655058](https://raw.githubusercontent.com/xzyup/image/master/202203191627769.png)\n\n~~~\n将上图中配置文件中红色部分去掉`%%`,以及最后的`,`逗号 \n修改为下图:\n~~~\n\n![image-20211115164726573](https://raw.githubusercontent.com/xzyup/image/master/202203191627998.png)\n\n~~~\n`或者这两行的注释放开` 不能版本配置文件有差异\nloopback_users.guest = true\nloopback_users.guest = false\n~~~\n\n~~~\n# 7.执行如下命令,启动rabbitmq中的插件管理\n\trabbitmq-plugins enable rabbitmq_management\n\t\n\t出现如下说明:\n\t\tEnabling plugins on node rabbit@localhost:\n    rabbitmq_management\n    The following plugins have been configured:\n      rabbitmq_management\n      rabbitmq_management_agent\n      rabbitmq_web_dispatch\n~~~\n\n    The following plugins have been enabled:\n      rabbitmq_management\n      rabbitmq_management_agent\n      rabbitmq_web_dispatch\n    \n    set 3 plugins.\n    Offline change; changes will take effect at broker restart.\n\n# 8.启动RabbitMQ的服务\n\tsystemctl start rabbitmq-server\n\tsystemctl restart rabbitmq-server\n\tsystemctl stop rabbitmq-server\n\n\n# 9.查看服务状态(见下图:)\n\tsystemctl status rabbitmq-server\n  ● rabbitmq-server.service - RabbitMQ broker\n     Loaded: loaded (/usr/lib/systemd/system/rabbitmq-server.service; disabled; vendor preset: disabled)\n     Active: active (running) since 三 2019-09-25 22:26:35 CST; 7s ago\n   Main PID: 2904 (beam.smp)\n     Status: \"Initialized\"\n     CGroup: /system.slice/rabbitmq-server.service\n             ├─2904 /usr/lib64/erlang/erts-10.4.4/bin/beam.smp -W w -A 64 -MBas ageffcbf -MHas ageffcbf -\n             MBlmbcs...\n             ├─3220 erl_child_setup 32768\n             ├─3243 inet_gethost 4\n             └─3244 inet_gethost 4\n      .........\n~~~\n\n![image-20211115164952765](https://raw.githubusercontent.com/xzyup/image/master/202203191627665.png)\n\n~~~\n# 10.关闭防火墙服务\n\tsystemctl disable firewalld  # 需要关闭防火墙，否则访问不了\n\tRemoved symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.\n\tRemoved symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.\n\tsystemctl stop firewalld   \n\n# 11.访问web管理界面\n\thttp://10.15.0.8:15672/\n~~~\n\n![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191627468.png)\n\n~~~\n# 12.登录管理界面\n\tusername:  guest\n\tpassword:  guest\n~~~\n\n![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191628472.png)\n\n## 3 RabiitMQ 配置\n\n### 3.1 RabbitMQ 管理命令行\n\n~~~\n# 1.服务启动相关\n\tsystemctl start|restart|stop|status rabbitmq-server\n\n# 2.管理命令行  用来在不使用web管理界面情况下命令操作RabbitMQ\n\trabbitmqctl  help  可以查看更多命令\n\n# 3.插件管理命令行\n\trabbitmq-plugins enable|list|disable \n~~~\n\n### 3.2 web管理界面介绍\n\n#### 3.2.1 overview概览\n\n![image-20211115165516989](https://raw.githubusercontent.com/xzyup/image/master/202203191628049.png)\n\n~~~\nconnections：无论生产者还是消费者，都需要与RabbitMQ建立连接后才\n可以完成消息的生产和消费，在这里可以查看连接情况`\n\nchannels：通道，建立连接后，会形成通道，消息的投递获取依赖通道。\n\nExchanges：交换机，用来实现消息的路由\n\nQueues：队列，即消息队列，消息存放在队列中，等待消费，\n消费后被移除队列。\n~~~\n\n#### 3.2.2 Admin用户和虚拟主机管理\n\n##### 3.2.2.1 添加用户\n\n![image-20211115165811824](https://raw.githubusercontent.com/xzyup/image/master/202203191628829.png)\n\n~~~\n上面的Tags选项，其实是指定用户的角色，可选的有以下几个：\n\n超级管理员(administrator)\n\n可登陆管理控制台，可查看所有的信息，并且可以对用户，\n策略(policy)进行操作。\n\n监控者(monitoring)\n\n可登陆管理控制台，同时可以查看rabbitmq节点的相关信息\n(进程数，内存使用情况，磁盘使用情况等)\n\n策略制定者(policymaker)\n\n可登陆管理控制台, 同时可以对policy进行管理。但无法查看节点的\n相关信息(上图红框标识的部分)。\n\n普通管理者(management)\n\n仅可登陆管理控制台，无法看到节点信息，也无法对策略进行管理。\n\n其他\n\n无法登陆管理控制台，通常就是普通的生产者和消费者。\n~~~\n\n##### 3.2.2.2 创建虚拟主机\n\n~~~\n虚拟主机\n为了让各个用户可以互不干扰的工作，RabbitMQ添加了\n虚拟主机（Virtual Hosts）的概念。其实就是一个独立的\n访问路径，不同用户使用不同路径，各自有自己的\n队列、交换机，互相不会影响。相当于关系型中的数据库\n~~~\n\n![image-20211115165945088](https://raw.githubusercontent.com/xzyup/image/master/202203191628947.png)\n\n##### 3.2.2.3 绑定虚拟主机和用户\n\n~~~\n创建好虚拟主机，我们还要给用户添加访问权限：\n\n点击添加好的虚拟主机：\n~~~\n\n![image-20211115170056567](https://raw.githubusercontent.com/xzyup/image/master/202203191628593.png)\n\n`进入虚拟机设置界面`\n\n![image-20211115172528979](https://raw.githubusercontent.com/xzyup/image/master/202203191629415.png)\n\n## 4 RabbitMQ 的第一个程序\n\n### 4.1 AMQP协议的回顾\n\n![image-20211115173046680](https://raw.githubusercontent.com/xzyup/image/master/202203191629621.png)\n\n### 4.2 RabbitMQ支持的消息模型\n\n![image-20211115173136189](https://raw.githubusercontent.com/xzyup/image/master/202203191629497.png)\n\n![image-20211115173209816](https://raw.githubusercontent.com/xzyup/image/master/202203191629518.png)\n\n### 4.3 引入依赖\n\n~~~xml\n<dependency>\n    <groupId>com.rabbitmq</groupId>\n    <artifactId>amqp-client</artifactId>\n    <version>5.7.2</version>\n</dependency>\n~~~\n\n### 4.4 第一种模型(直连)\n\n![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191629336.png)\n\n~~~\n在上图的模型中，有以下概念：\n\nP：生产者，也就是要发送消息的程序\nC：消费者：消息的接受者，会一直等待消息到来。\nqueue：消息队列，图中红色部分。类似一个邮箱，\n可以缓存消息；生产者向其中投递消息，消费者从其中取出消息。\n~~~\n\n#### 4.4.1 开发生产者\n\n~~~java\npackage demo.direct;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport common.Constant;\nimport utils.RabbitMQUtil;\n\n/**\n * 第一种模型(直连)\n *\n * @author xie.wei\n * @date created at 2021-11-15 17:39\n */\npublic class Producer {\n\n    public static void main(String[] args) {\n        // 获取连接\n        Connection connection = RabbitMQUtil.getConnection();\n        Channel channel = null;\n        try {\n            // 创建通道、生产者和mq服务所有通信都在channel中完成\n            channel = connection.createChannel();\n\n            /**\n             *  声明 direct 直连队列\n             *  1. queue 队列名称\n             *  2. durable 队列是否持久化，mq重启队列还在，不会保证消息的持久化\n             *  3. exclusive 是否独占连接，队列只允许在连接中访问，如果连接关闭则队列无法\n             *  访问,如果将此参数设置为true可以用于临时队列的创建\n             *  4. autoDelete 自动删除,及队列不在使用时自动删除，一般消费者消费完成ACK确认后，\n             *  生产消费都断开了连接后，队列自动删除，\n             *  5. 参数，可以设置队列的扩展属性，比如：可设置存活时间等\n             */\n            channel.queueDeclare(Constant.DIRECT_QUEUE, false, false, false,\n                    null);\n\n            /**\n             * 发布消息\n             * 1. exchange 交换机\n             * 2. routingKey 路由key，交换机根据key将消息转发到指定队列，如果使用默认交换机\n             * 则key就是队列名称\n             * 3. props 消息属性，可以设置消息为可持久化，MessageProperties.PERSISTENT_TEXT_PLAIN\n             * 4. body 消息内容\n             */\n            channel.basicPublish(\"\", Constant.DIRECT_QUEUE, null,\n                    \"hello world\".getBytes());\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            // 关闭通道和连接\n            RabbitMQUtil.close(channel, connection);\n        }\n    }\n}\n~~~\n\n#### 4.4.2 开发消费者\n\n```java\npackage demo.direct;\n\nimport com.rabbitmq.client.*;\nimport common.Constant;\nimport utils.RabbitMQUtil;\n\nimport java.io.IOException;\n\n/**\n * 第一种模型(直连)\n *\n * @author xie.wei\n * @date created at 2021-11-15 22:43\n */\n@SuppressWarnings(\"all\")\npublic class Consumer {\n    public static void main(String[] args) {\n        Connection connection = RabbitMQUtil.getConnection();\n        Channel channel = null;\n        try {\n            channel = connection.createChannel();\n            channel.queueDeclare(Constant.DIRECT_QUEUE, false, false, false, null);\n\n            /*\n             * 参数明细：\n             * 1、queue 队列名称\n             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，\n             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复\n             * 3、callback，消费方法，当消费者接收到消息要执行的方法\n             */\n            channel.basicConsume(Constant.DIRECT_QUEUE, true, new DefaultConsumer(channel) {\n\n                /**\n                 * 当接收到消息后此方法将被调用\n                 * @param consumerTag  消费者标签，用来标识消费者的，\n                 *        在监听队列时设置channel.basicConsume\n                 * @param envelope 信封，通过envelope\n                 * @param properties 消息属性\n                 * @param body 消息内容\n                 * @throws IOException\n                 */\n                @Override\n                public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                           byte[] body) throws IOException {\n                    // key,本例即队列名称\n                    String routingKey = envelope.getRoutingKey();\n                    // 交换机\n                    String exchange = envelope.getExchange();\n                    // 消息id，mq在channel中用来标识消息的id，可用于确认消息已接收\n                    long deliveryTag = envelope.getDeliveryTag();\n                    String msg = new String(body, \"utf-8\");\n                    System.out.printf(\"routingKey:%s,exchange:%s,deliveryTag:%s,body:%s\", routingKey,\n                            exchange, deliveryTag, msg);\n                }\n            });\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            // RabbitMQUtil.close(channel, connection);\n        }\n    }\n}\n```\n\n### 4.5 第二种模型(working queque)\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191630397.png)\n\n这种模式叫工作队列或者**竞争消费者**模式。\n\nWorking queues与入门程序相比，多了一个消费端，两个消费端共同消费同一个队列中的消息，但是**一个消息只能被一个消费者获取**。\n\n这个消息模型在Web应用程序中特别有用，可以处理短的HTTP请求窗口中无法处理复杂的任务。\n\n接下来我们来模拟这个流程：\n\nP：生产者：任务的发布者\n\nC1：消费者1：领取任务并且完成任务，假设完成速度较慢（模拟耗时）\n\nC2：消费者2：领取任务并且完成任务，假设完成速度较快\n\n#### 4.5.1 生成者\n\n```java\npackage demo.wokerqueue;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport common.Constant;\nimport utils.RabbitMQUtil;\n\n/**\n * working queue 生产者\n *\n * @author xie.wei\n * @date created at 2022-01-06 15:16\n */\npublic class Producer {\n\n    public static void main(String[] args) {\n        // 获取连接\n        Connection connection = RabbitMQUtil.getConnection();\n        Channel channel = null;\n        try {\n            // 创建通道、生产者和mq服务所有通信都在channel中完成\n            channel = connection.createChannel();\n\n            /*\n             *  声明 direct 直连队列\n             *  1. queue 队列名称\n             *  2. durable 队列是否持久化，mq重启队列还在，不会保证消息的持久化\n             *  3. exclusive 是否独占连接，队列只允许在连接中访问，如果连接关闭则队列无法\n             *  访问,如果将此参数设置为true可以用于临时队列的创建\n             *  4. autoDelete 自动删除,及队列不在使用时自动删除，一般消费者消费完成ACK确认后，\n             *  生产消费都断开了连接后，队列自动删除，\n             *  5. 参数，可以设置队列的扩展属性，比如：可设置存活时间等\n             */\n            channel.queueDeclare(Constant.WORKING_QUEUE, false, false, false,\n                    null);\n\n            /*\n             * 发布消息\n             * 1. exchange 交换机\n             * 2. routingKey 路由key，交换机根据key将消息转发到指定队列，如果使用默认交换机\n             * 则key就是队列名称\n             * 3. props 消息属性，可以设置消息为可持久化，MessageProperties.PERSISTENT_TEXT_PLAIN\n             * 4. body 消息内容\n             */\n            for (int i = 0; i < 50; i++) {\n                String message = \"working queue message: \" + i;\n                channel.basicPublish(\"\", Constant.WORKING_QUEUE, null,\n                        message.getBytes());\n            }\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            // 关闭通道和连接\n            RabbitMQUtil.close(channel, connection);\n        }\n    }\n}\n```\n\n#### 4.5.2 消费者1\n\n```java\npackage demo.wokerqueue;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport java.util.concurrent.TimeUnit;\nimport utils.RabbitMQUtil;\n\n/**\n * working queue consumer one\n *\n * @author xie.wei\n * @date created at 2022-01-06 15:22\n */\npublic class Consumer1 {\n    public static void main(String[] args) {\n        Connection connection = RabbitMQUtil.getConnection();\n        Channel channel = null;\n        try {\n            channel = connection.createChannel();\n            channel.queueDeclare(Constant.WORKING_QUEUE, false, false, false, null);\n\n            /*\n             * 参数明细：\n             * 1、queue 队列名称\n             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，\n             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复\n             * 3、callback，消费方法，当消费者接收到消息要执行的方法\n             */\n            channel.basicConsume(Constant.WORKING_QUEUE, true, new DefaultConsumer(channel) {\n\n                /**\n                 * 当接收到消息后此方法将被调用\n                 * @param consumerTag  消费者标签，用来标识消费者的，\n                 *        在监听队列时设置channel.basicConsume\n                 * @param envelope 信封，通过envelope\n                 * @param properties 消息属性\n                 * @param body 消息内容\n                 * @throws IOException\n                 */\n                @Override\n                public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                           byte[] body) throws IOException {\n                    // body 即消息体\n                    String msg = new String(body, \"utf-8\");\n                    System.out.println(\" [消费者1] received : \" + msg + \"!\");\n                    //模拟任务耗时1s\n                    try {\n                        TimeUnit.SECONDS.sleep(1);\n                    } catch (Exception e) {\n                        e.printStackTrace();\n                    }\n                }\n            });\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            // RabbitMQUtil.close(channel, connection);\n        }\n    }\n}\n```\n\n#### 4.5.3 消费者2\n\n```java\npackage demo.wokerqueue;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * working queue consumer two\n *\n * @author xie.wei\n * @date created at 2022-01-06 15:22\n */\npublic class Consumer2 {\n    public static void main(String[] args) {\n        Connection connection = RabbitMQUtil.getConnection();\n        Channel channel = null;\n        try {\n            channel = connection.createChannel();\n            channel.queueDeclare(Constant.WORKING_QUEUE, false, false, false, null);\n\n            /*\n             * 参数明细：\n             * 1、queue 队列名称\n             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，\n             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复\n             * 3、callback，消费方法，当消费者接收到消息要执行的方法\n             */\n            channel.basicConsume(Constant.WORKING_QUEUE, true, new DefaultConsumer(channel) {\n\n                /**\n                 * 当接收到消息后此方法将被调用\n                 * @param consumerTag  消费者标签，用来标识消费者的，\n                 *        在监听队列时设置channel.basicConsume\n                 * @param envelope 信封，通过envelope\n                 * @param properties 消息属性\n                 * @param body 消息内容\n                 * @throws IOException\n                 */\n                @Override\n                public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                           byte[] body) throws IOException {\n                    // body 即消息体\n                    String msg = new String(body, \"utf-8\");\n                    System.out.println(\" [消费者1] received : \" + msg + \"!\");\n                }\n            });\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            // RabbitMQUtil.close(channel, connection);\n        }\n    }\n}\n```\n\n与消费者1基本类似，只是消费者2没有设置消费耗时时间。\n\n接下来，两个消费者一同启动，然后生产者发送50条消息：\n\n![image-20220106153336710](https://raw.githubusercontent.com/xzyup/image/master/202203191630026.png)\n\n![image-20220106153405659](https://raw.githubusercontent.com/xzyup/image/master/202203191630579.png)\n\n**可以发现，两个消费者各自消费了不同25条消息，这就实现了任务的分发。** \n\n#### 4.5.4 能者多劳\n\n刚才的实现有问题吗？\n\n- 消费者1比消费者2的效率要低，一次任务的耗时较长\n- 然而两人最终消费的消息数量是一样的\n- 消费者2大量时间处于空闲状态，消费者1一直忙碌\n\n现在的状态属于是把任务平均分配，正确的做法应该是消费越快的人，消费的越多。\n\n怎么实现呢？\n\n通过 BasicQos 方法设置prefetchCount = 1。这样RabbitMQ就会使得每个Consumer在同一个时间点最多处理1个Message。换句话说，在接收到该Consumer的ack前，他它不会将新的Message分发给它。相反，它会将其分派给不是仍然忙碌的下一个Consumer。\n\n**值得注意的是：prefetchCount在手动ack的情况下才生效，自动ack不生效。**\n\n设置prefetchCount和手动ack代码如下：\n\n```java\npublic static void main(String[] args) throws Exception {\n  Connection connection = RabbitMQUtil.getConnection();\n  final Channel channel = connection.createChannel();\n\n  channel.queueDeclare(Constant.WORKING_QUEUE, false, false, false, null);\n  // 设置每个消费者同时只能处理一条消息，手动ack下生效\n  channel.basicQos(1);\n\n  channel.basicConsume(Constant.WORKING_QUEUE, false, new DefaultConsumer(channel) {\n\n\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                               byte[] body) throws IOException {\n      // body 即消息体\n      String msg = new String(body, \"utf-8\");\n      System.out.println(\" [消费者2] received : \" + msg + \"!\");\n      channel.basicAck(envelope.getDeliveryTag(), false);\n    }\n  });\n}\n```\n\n再次测试：\n\n![image-20220106155103949](https://raw.githubusercontent.com/xzyup/image/master/202203191630941.png)\n\n![image-20220106155123303](https://raw.githubusercontent.com/xzyup/image/master/202203191630053.png)\n\n\n\n### 4.6 第三种模型(订阅模型)\n\n**订阅模型分类**\n说明下：\n\n1、一个生产者多个消费者\n2、每个消费者都有一个自己的队列\n3、生产者没有将消息直接发送给队列，而是发送给exchange(交换机、转发器)\n4、每个队列都需要绑定到交换机上\n5、生产者发送的消息，经过交换机到达队列，实现一个消息被多个消费者消费\n例子：注册->发邮件、发短信\n\n**X（Exchanges）**：交换机一方面：接收生产者发送的消息。另一方面：知道如何处理消息，例如递交给某个特别队列、递交给所有队列、或是将消息丢弃。到底如何操作，取决于Exchange的类型。\n\nExchange类型有以下几种：\n\n**Fanout**：广播，将消息交给所有绑定到交换机的队列\n\n**Direct**：定向，把消息交给符合指定routing key 的队列\n\n**Topic**：通配符，把消息交给符合routing pattern（路由模式） 的队列\n\n**Header**：header模式与routing不同的地方在于，header模式取消routingkey，使用header中的 key/value（键值对）匹配队列。\n\nHeader模式不展开了，感兴趣可以参考这篇文章https://blog.csdn.net/zhu_tianwei/article/details/40923131\n\n**Exchange（交换机）只负责转发消息，不具备存储消息的能力，因此如果没有任何队列与Exchange绑定，或者没有符合路由规则的队列，那么消息会丢失！**\n\n#### 4.6.1 Publish/subcribe(交换机类型：fanout，也称广播)\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191630971.png)\n\n\n\n##### 生产者\n\n和前面两种模式不同：\n\n- 1） 声明Exchange，不再声明Queue\n- 2） 发送消息到Exchange，不再发送到Queue\n\n```java\npackage demo.pubsub;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * 订阅模式：pub/sub 生产者\n *\n * @author xie.wei\n * @date created at 2022-01-06 16:11\n */\npublic class Producer {\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n\n        channel.exchangeDeclare(Constant.FANOUT_EXCHANGE, \"fanout\");\n        String message = \"registration success\";\n        channel.basicPublish(Constant.FANOUT_EXCHANGE, \"\", null, message.getBytes());\n\n        RabbitMQUtil.close(channel, connection);\n    }\n}\n```\n\n##### 消费者1 （注册成功发给短信服务）\n\n```java\npackage demo.pubsub;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * pub/sub consumer1\n * 发送短信服务\n *\n * @author xie.wei\n * @date created at 2022-01-06 16:48\n */\npublic class Consumer1 {\n\n    static String QUEUE = \"fanout_exchange_queue_sms\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明队列\n        channel.queueDeclare(QUEUE, false, false, false, null);\n        // 定义队列消费者\n        channel.queueBind(QUEUE, Constant.FANOUT_EXCHANGE, \"\");\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [短信服务] received : \" + msg + \"!\");\n            }\n        };\n        channel.basicConsume(QUEUE, true, consumer);\n    }\n}\n```\n\n##### 消费者2（注册成功发给邮件服务）\n\n```java\npackage demo.pubsub;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * pub/sub consumer2\n * 发送邮件服务\n *\n * @author xie.wei\n * @date created at 2022-01-06 16:48\n */\npublic class Consumer2 {\n\n    static String QUEUE = \"fanout_exchange_queue_email\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明队列\n        channel.queueDeclare(QUEUE, false, false, false, null);\n        // 定义队列消费者\n        channel.queueBind(QUEUE, Constant.FANOUT_EXCHANGE, \"\");\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [邮件服务] received : \" + msg + \"!\");\n            }\n        };\n        channel.basicConsume(QUEUE, true, consumer);\n    }\n}\n```\n\n我们运行两个消费者，然后生成者发送1条消息：如果先运行消费者，可能出现exchange不存在的报错，可现在admin页面创建或者先运行生产者。\n\n![image-20220106171011803](https://raw.githubusercontent.com/xzyup/image/master/202203191631939.png)\n\n![image-20220106171035697](https://raw.githubusercontent.com/xzyup/image/master/202203191631763.png)\n\n##### 思考\n\n1、publish/subscribe与work queues有什么区别。\n\n区别：\n\n1）work queues不用定义交换机，而publish/subscribe需要定义交换机。\n\n2）publish/subscribe的生产方是面向交换机发送消息，work queues的生产方是面向队列发送消息(底层使用默认交换机)。\n\n3）publish/subscribe需要设置队列和交换机的绑定，work queues不需要设置，实际上work queues会将队列绑定到默认的交换机 。\n\n相同点：\n\n所以两者实现的发布/订阅的效果是一样的，多个消费端监听同一个队列不会重复消费消息。\n\n2、实际工作用 publish/subscribe还是work queues。\n\n建议使用 publish/subscribe，发布订阅模式比工作队列模式更强大（也可以做到同一队列竞争），并且发布订阅模式可以指定自己专用的交换机。\n\n#### 4.6.2 Routing 路由模型（交换机类型：direct）\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191631447.png)\n\nP：生产者，向Exchange发送消息，发送消息时，会指定一个routing key。\n\nX：Exchange（交换机），接收生产者的消息，然后把消息递交给 与routing key完全匹配的队列\n\nC1：消费者，其所在队列指定了需要routing key 为 error 的消息\n\nC2：消费者，其所在队列指定了需要routing key 为 info、error、warning 的消息\n\n接下来看代码：\n\n##### 生产者\n\n```java\npackage demo.routing;\n\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * routing路由模式 交换机类型为direct\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:15\n */\npublic class Producer {\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明exchange,指明类型为direct\n        channel.exchangeDeclare(Constant.DIRECT_EXCHANGE, BuiltinExchangeType.DIRECT);\n        // 消息内容\n        String message = \"注册成功！请短息回复[T]退订\";\n        // 发送消息，并指定routing key 为sms，只有短信服务才能接受该消息\n        channel.basicPublish(Constant.DIRECT_EXCHANGE, \"sms\", null, message.getBytes());\n        System.out.println(\" [x] Sent '\" + message + \"'\");\n\n        RabbitMQUtil.close(channel, connection);\n    }\n}\n```\n\n##### 消费者1\n\n```java\npackage demo.routing;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * routing key路由模式 exchange type: direct\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:23\n */\npublic class Consumer1 {\n\n    static String QUEUE = \"direct_exchange_queue_sms\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n\n        // 声明队列\n        channel.queueDeclare(QUEUE, false, false, false, null);\n        // 绑定交换机,同时指定需要指定的routing key,可以同时指定多个\n        channel.queueBind(QUEUE, Constant.DIRECT_EXCHANGE, \"sms\");\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [短信服务] received : \" + msg + \"!\");\n            }\n        };\n        // 监听队列，自动ACK\n        channel.basicConsume(QUEUE, true, consumer);\n    }\n}\n```\n\n##### 消费者2\n\n```java\npackage demo.routing;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * routing key路由模式 exchange type: direct\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:23\n */\npublic class Consumer2 {\n\n    static String QUEUE = \"direct_exchange_queue_email\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n\n        // 声明队列\n        channel.queueDeclare(QUEUE, false, false, false, null);\n        // 绑定交换机,同时指定需要指定的routing key,可以同时指定多个\n        channel.queueBind(QUEUE, Constant.DIRECT_EXCHANGE, \"email\");\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [邮件服务] received : \" + msg + \"!\");\n            }\n        };\n        // 监听队列，自动ACK\n        channel.basicConsume(QUEUE, true, consumer);\n    }\n}\n```\n\n我们发送sms的RoutingKey，发现结果：只有指定短信的消费者1收到消息了\n\n![image-20220106173229176](https://raw.githubusercontent.com/xzyup/image/master/202203191631537.png)\n\n#### 4.6.3 Topics 通配符模式（交换机类型：topics）\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191631892.png)\n\n 每个消费者监听自己的队列，并且设置带统配符的routingkey,生产者将消息发给broker，由交换机根据routingkey来转发消息到指定的队列。\n\nRoutingkey一般都是有一个或者多个单词组成，多个单词之间以“.”分割，例如：inform.sms\n\n通配符规则：\n\n#：匹配一个或多个词\n\n*：匹配不多不少恰好1个词\n\n举例：\n\naudit.#：能够匹配audit.irs.corporate 或者 audit.irs\n\naudit.*：只能匹配audit.irs\n\n从示意图可知，我们将发送所有描述动物的消息。消息将使用由三个字（两个点）组成的Routing key发送。路由关键字中的第一个单词将描述速度，第二个颜色和第三个种类：“<speed>.<color>.<species>”。\n\n我们创建了三个绑定：Q1绑定了“*.orange.*”，Q2绑定了“.*.*.rabbit”和“lazy.＃”。\n\nQ1匹配所有的橙色动物。\n\nQ2匹配关于兔子以及懒惰动物的消息。\n\n 下面做个小练习，假如生产者发送如下消息，会进入哪个队列：\n\nquick.orange.rabbit       Q1 Q2   routingKey=\"quick.orange.rabbit\"的消息会同时路由到Q1与Q2\n\nlazy.orange.elephant    Q1 Q2\n\nquick.orange.fox           Q1\n\nlazy.pink.rabbit              Q2  (值得注意的是，虽然这个routingKey与Q2的两个bindingKey都匹配，但是只会投递Q2一次)\n\nquick.brown.fox            不匹配任意队列，被丢弃\n\nquick.orange.male.rabbit   不匹配任意队列，被丢弃\n\norange         不匹配任意队列，被丢弃\n\n下面我们以指定Routing key=\"quick.orange.rabbit\"为例，验证上面的答案\n\n##### 生产者\n\n```java\npackage demo.topics;\n\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * topics模式\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:41\n */\npublic class Producer {\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明exchange，指定类型为topic\n        channel.exchangeDeclare(Constant.TOPIC_EXCHANGE, BuiltinExchangeType.TOPIC);\n        // 消息内容\n        String message = \"这是一只行动迅速的橙色的兔子\";\n        // 发送消息，并且指定routing key为：quick.orange.rabbit\n        channel.basicPublish(Constant.TOPIC_EXCHANGE, \"quick.orange.rabbit\", null, message.getBytes());\n        System.out.println(\" [动物描述：] Sent '\" + message + \"'\");\n        RabbitMQUtil.close(channel, connection);\n    }\n}\n```\n\n##### 消费者1\n\n```java\npackage demo.topics;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * topics模式\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:46\n */\npublic class Consumer1 {\n    static String QUEUE_NAME = \"topic_exchange_queue_Q1\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明队列\n        channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n\n        // 绑定队列到交换机，同时指定需要订阅的routing key。订阅所有的橙色动物\n        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, \"*.orange.*\");\n\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [消费者1] received : \" + msg + \"!\");\n            }\n        };\n        // 监听队列，自动ACK\n        channel.basicConsume(QUEUE_NAME, true, consumer);\n\n    }\n}\n```\n\n##### 消费者2\n\n```java\npackage demo.topics;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * topics模式\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:46\n */\npublic class Consumer2 {\n    static String QUEUE_NAME = \"topic_exchange_queue_Q2\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明队列\n        channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n\n        // 绑定队列到交换机，同时指定需要订阅的routing key。订阅关于兔子以及懒惰动物的消息\n        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, \"*.*.rabbit\");\n        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, \"lazy.＃\");\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [消费者2] received : \" + msg + \"!\");\n            }\n        };\n        // 监听队列，自动ACK\n        channel.basicConsume(QUEUE_NAME, true, consumer);\n\n    }\n}\n```\n\n结果C1、C2是都接收到消息了：\n\n![image-20220106175843295](https://raw.githubusercontent.com/xzyup/image/master/202203191631828.png)\n\n![image-20220106175904638](https://raw.githubusercontent.com/xzyup/image/master/202203191632611.png)\n\n#### 4.6.3 RPC\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191632340.png)\n\n基本概念：\n\nCallback queue 回调队列，客户端向服务器发送请求，服务器端处理请求后，将其处理结果保存在一个存储体中。而客户端为了获得处理结果，那么客户在向服务器发送请求时，同时发送一个回调队列地址reply_to。\n\nCorrelation id 关联标识，客户端可能会发送多个请求给服务器，当服务器处理完后，客户端无法辨别在回调队列中的响应具体和那个请求时对应的。为了处理这种情况，客户端在发送每个请求时，同时会附带一个独有correlation_id属性，这样客户端在回调队列中根据correlation_id字段的值就可以分辨此响应属于哪个请求。\n\n流程说明：\n\n当客户端启动的时候，它创建一个匿名独享的回调队列。\n在 RPC 请求中，客户端发送带有两个属性的消息：一个是设置回调队列的 reply_to 属性，另一个是设置唯一值的 correlation_id 属性。\n将请求发送到一个 rpc_queue 队列中。\n服务器等待请求发送到这个队列中来。当请求出现的时候，它执行他的工作并且将带有执行结果的消息发送给 reply_to 字段指定的队列。\n客户端等待回调队列里的数据。当有消息出现的时候，它会检查 correlation_id 属性。如果此属性的值与请求匹配，将它返回给应用\n\n### 5 面试题\n\n面试题：\n\n避免消息堆积？\n\n1） 采用workqueue，多个消费者监听同一队列。\n\n2）接收到消息以后，而是通过线程池，异步消费。\n\n如何避免消息丢失？\n\n1） 消费者的ACK机制。可以防止消费者丢失消息。\n\n但是，如果在消费者消费之前，MQ就宕机了，消息就没了？\n\n2）可以将消息进行持久化。要将消息持久化，前提是：队列、Exchange都持久化\n\n交换机持久化\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191632563.png)\n队列持久化\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191632941.png)\n消息持久化\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191632365.png)\n\n","source":"_posts/mq/rabbitmq入门.md","raw":"---\nuuid: bbaf6f29-c0ab-11ec-92a1-7557b2313227\ntitle: rabbitmq 入门\ncategories: MiddleWare\ntags:\n  - rabbitmq\nabbrlink: 114958f5\n---\n\n## 1 MQ引言\n\n> 参考 https://blog.csdn.net/unique_perfect/article/details/109380996\n\n### 1.1 什么是MQ\n\n~~~\nMQ(Message Quene) :  翻译为消息队列,通过典型的生产者\n和消费者模型,生产者不断向消息队列中生产消息，消费者\n不断的从队列中获取消息。因为消息的生产和消费都是异\n步的，而且只关心消息的发送和接收，没有业务逻辑的侵\n入,轻松的实现系统间解耦。别名为 消息中间件通过利用\n高效可靠的消息传递机制进行平台无关的数据交流，并\n基于数据通信来进行分布式系统的集成。\n~~~\n\n### 1.2 MQ有哪些\n\n~~~\n当今市面上有很多主流的消息中间件，如老牌的ActiveMQ、\nRabbitMQ，炙手可热的Kafka，阿里巴巴自主开发RocketMQ等。\n~~~\n\n### 1.3 不同MQ特点\n\n~~~\n1.ActiveMQ\n\t\tActiveMQ 是Apache出品，最流行的，能力强劲的开源\n\t\t消息总线。它是一个完全支持JMS规范的的消息中间件。\n\t\t丰富的API,多种集群架构模式让ActiveMQ在业界成为老\n\t\t牌的消息中间件,在中小型企业 颇受欢迎!\n\n2.Kafka\n\t\tKafka是LinkedIn开源的分布式发布-订阅消息系统，目\n\t\t前归属于Apache顶级项目。Kafka主要特点是基于Pull\n\t\t的模式来处理消息消费，追求高吞吐量，一开始的目的\n\t\t就是用于日志收集和传输。0.8版本开始支持复制，不支\n\t\t持事务，对消息的重复、丢失、错误没有严格要求，\n\t\t适合产生大量数据的互联网服务的数据收集业务。\n\n3.RocketMQ\n\t\tRocketMQ是阿里开源的消息中间件，它是纯Java开发，\n\t\t具有高吞吐量、高可用性、适合大规模分布式系统应用\n\t\t的特点。RocketMQ思路起源于Kafka，但并不是Kafka\n\t\t的一个Copy，它对消息的可靠传输及事务性做了优化，\n\t\t目前在阿里集团被广泛应用于交   易、充值、流计算、\n\t\t消息推送、日志流式处理、binglog分发等场景。\n\n4.RabbitMQ\n\t\tRabbitMQ是使用Erlang语言开发的开源消息队列系统，\n\t\t基于AMQP协议来实现。AMQP的主要特征是面向消息、\n\t\t队列、路由（包括点对点和发布/订阅）、可靠性、安全。\n\t\tAMQP协议更多用在企业系统内对数据一致性、稳定性和\n\t\t可靠性要求很高的场景，对性能和吞吐量的要求还在\n\t\t其次。\n\nRabbitMQ比Kafka可靠，Kafka更适合IO高吞吐的处理，一般应用\n在大数据日志处理或对实时性（少量延迟），可靠性（少量丢数据）\n要求稍低的场景使用，比如ELK日志收集。\t\t\n~~~\n\n## 2 RabbitMQ 的引言\n\n### 2.1 RabbitMQ\n\n~~~\n基于AMQP协议，erlang语言开发，是部署最广泛的开源\n消息中间件,是最受欢迎的开源消息中间件之一。\n~~~\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191626795.png)\n\n~~~\nAMQP 协议\n \tAMQP（advanced message queuing protocol）在2003年\n \t时被提出，最早用于解决金融领不同平台之间的消息传递\n \t交互问题。顾名思义，AMQP是一种协议，更准确的说是\n \t一种binary wire-level protocol（链接协议）。这是其和\n \tJMS的本质差别，AMQP不从API层进行限定，而是直接\n \t定义网络交换的数据格式。这使得实现了AMQP的\n \tprovider天然性就是跨平台的。以下是AMQP协议模型:\n~~~\n\n![image-20211115164234247](https://raw.githubusercontent.com/xzyup/image/master/202203191627854.png)\n\n### 2.2 RabbitMQ 的安装\n\n~~~\n最新版的3.8版本的可以看我这篇文章\nhttps://blog.csdn.net/unique_perfect/article/details/108643804\n~~~\n\n#### 2.2.1 下载\n\n![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191627315.png)\n\n`注意:这里的安装包是centos7安装的包`\n\n#### 2.2.3 安装步骤\n\n~~~\n# 1.将rabbitmq安装包上传到linux系统中\n\terlang-22.0.7-1.el7.x86_64.rpm  #l7表示是Centosl7,Centosl8表示Centos8\n\trabbitmq-server-3.7.18-1.el7.noarch.rpm\n\n# 2.安装Erlang依赖包\n\trpm -ivh erlang-22.0.7-1.el7.x86_64.rpm\n\n# 3.安装RabbitMQ安装包(需要联网)\n\tyum install -y rabbitmq-server-3.7.18-1.el7.noarch.rpm\n\t注意:默认安装完成后配置文件模板在:/usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example目录中,需要\t\n\t将配置文件复制到/etc/rabbitmq/目录中,并修改名称为rabbitmq.config\n# 4.复制配置文件\n\tcp /usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example /etc/rabbitmq/rabbitmq.config\n\n# 5.查看配置文件位置\n\tls /etc/rabbitmq/rabbitmq.config\n\n# 6.修改配置文件(参见下图:)\n\tvim /etc/rabbitmq/rabbitmq.config \n~~~\n\n![image-20211115164655058](https://raw.githubusercontent.com/xzyup/image/master/202203191627769.png)\n\n~~~\n将上图中配置文件中红色部分去掉`%%`,以及最后的`,`逗号 \n修改为下图:\n~~~\n\n![image-20211115164726573](https://raw.githubusercontent.com/xzyup/image/master/202203191627998.png)\n\n~~~\n`或者这两行的注释放开` 不能版本配置文件有差异\nloopback_users.guest = true\nloopback_users.guest = false\n~~~\n\n~~~\n# 7.执行如下命令,启动rabbitmq中的插件管理\n\trabbitmq-plugins enable rabbitmq_management\n\t\n\t出现如下说明:\n\t\tEnabling plugins on node rabbit@localhost:\n    rabbitmq_management\n    The following plugins have been configured:\n      rabbitmq_management\n      rabbitmq_management_agent\n      rabbitmq_web_dispatch\n~~~\n\n    The following plugins have been enabled:\n      rabbitmq_management\n      rabbitmq_management_agent\n      rabbitmq_web_dispatch\n    \n    set 3 plugins.\n    Offline change; changes will take effect at broker restart.\n\n# 8.启动RabbitMQ的服务\n\tsystemctl start rabbitmq-server\n\tsystemctl restart rabbitmq-server\n\tsystemctl stop rabbitmq-server\n\n\n# 9.查看服务状态(见下图:)\n\tsystemctl status rabbitmq-server\n  ● rabbitmq-server.service - RabbitMQ broker\n     Loaded: loaded (/usr/lib/systemd/system/rabbitmq-server.service; disabled; vendor preset: disabled)\n     Active: active (running) since 三 2019-09-25 22:26:35 CST; 7s ago\n   Main PID: 2904 (beam.smp)\n     Status: \"Initialized\"\n     CGroup: /system.slice/rabbitmq-server.service\n             ├─2904 /usr/lib64/erlang/erts-10.4.4/bin/beam.smp -W w -A 64 -MBas ageffcbf -MHas ageffcbf -\n             MBlmbcs...\n             ├─3220 erl_child_setup 32768\n             ├─3243 inet_gethost 4\n             └─3244 inet_gethost 4\n      .........\n~~~\n\n![image-20211115164952765](https://raw.githubusercontent.com/xzyup/image/master/202203191627665.png)\n\n~~~\n# 10.关闭防火墙服务\n\tsystemctl disable firewalld  # 需要关闭防火墙，否则访问不了\n\tRemoved symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.\n\tRemoved symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.\n\tsystemctl stop firewalld   \n\n# 11.访问web管理界面\n\thttp://10.15.0.8:15672/\n~~~\n\n![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191627468.png)\n\n~~~\n# 12.登录管理界面\n\tusername:  guest\n\tpassword:  guest\n~~~\n\n![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191628472.png)\n\n## 3 RabiitMQ 配置\n\n### 3.1 RabbitMQ 管理命令行\n\n~~~\n# 1.服务启动相关\n\tsystemctl start|restart|stop|status rabbitmq-server\n\n# 2.管理命令行  用来在不使用web管理界面情况下命令操作RabbitMQ\n\trabbitmqctl  help  可以查看更多命令\n\n# 3.插件管理命令行\n\trabbitmq-plugins enable|list|disable \n~~~\n\n### 3.2 web管理界面介绍\n\n#### 3.2.1 overview概览\n\n![image-20211115165516989](https://raw.githubusercontent.com/xzyup/image/master/202203191628049.png)\n\n~~~\nconnections：无论生产者还是消费者，都需要与RabbitMQ建立连接后才\n可以完成消息的生产和消费，在这里可以查看连接情况`\n\nchannels：通道，建立连接后，会形成通道，消息的投递获取依赖通道。\n\nExchanges：交换机，用来实现消息的路由\n\nQueues：队列，即消息队列，消息存放在队列中，等待消费，\n消费后被移除队列。\n~~~\n\n#### 3.2.2 Admin用户和虚拟主机管理\n\n##### 3.2.2.1 添加用户\n\n![image-20211115165811824](https://raw.githubusercontent.com/xzyup/image/master/202203191628829.png)\n\n~~~\n上面的Tags选项，其实是指定用户的角色，可选的有以下几个：\n\n超级管理员(administrator)\n\n可登陆管理控制台，可查看所有的信息，并且可以对用户，\n策略(policy)进行操作。\n\n监控者(monitoring)\n\n可登陆管理控制台，同时可以查看rabbitmq节点的相关信息\n(进程数，内存使用情况，磁盘使用情况等)\n\n策略制定者(policymaker)\n\n可登陆管理控制台, 同时可以对policy进行管理。但无法查看节点的\n相关信息(上图红框标识的部分)。\n\n普通管理者(management)\n\n仅可登陆管理控制台，无法看到节点信息，也无法对策略进行管理。\n\n其他\n\n无法登陆管理控制台，通常就是普通的生产者和消费者。\n~~~\n\n##### 3.2.2.2 创建虚拟主机\n\n~~~\n虚拟主机\n为了让各个用户可以互不干扰的工作，RabbitMQ添加了\n虚拟主机（Virtual Hosts）的概念。其实就是一个独立的\n访问路径，不同用户使用不同路径，各自有自己的\n队列、交换机，互相不会影响。相当于关系型中的数据库\n~~~\n\n![image-20211115165945088](https://raw.githubusercontent.com/xzyup/image/master/202203191628947.png)\n\n##### 3.2.2.3 绑定虚拟主机和用户\n\n~~~\n创建好虚拟主机，我们还要给用户添加访问权限：\n\n点击添加好的虚拟主机：\n~~~\n\n![image-20211115170056567](https://raw.githubusercontent.com/xzyup/image/master/202203191628593.png)\n\n`进入虚拟机设置界面`\n\n![image-20211115172528979](https://raw.githubusercontent.com/xzyup/image/master/202203191629415.png)\n\n## 4 RabbitMQ 的第一个程序\n\n### 4.1 AMQP协议的回顾\n\n![image-20211115173046680](https://raw.githubusercontent.com/xzyup/image/master/202203191629621.png)\n\n### 4.2 RabbitMQ支持的消息模型\n\n![image-20211115173136189](https://raw.githubusercontent.com/xzyup/image/master/202203191629497.png)\n\n![image-20211115173209816](https://raw.githubusercontent.com/xzyup/image/master/202203191629518.png)\n\n### 4.3 引入依赖\n\n~~~xml\n<dependency>\n    <groupId>com.rabbitmq</groupId>\n    <artifactId>amqp-client</artifactId>\n    <version>5.7.2</version>\n</dependency>\n~~~\n\n### 4.4 第一种模型(直连)\n\n![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191629336.png)\n\n~~~\n在上图的模型中，有以下概念：\n\nP：生产者，也就是要发送消息的程序\nC：消费者：消息的接受者，会一直等待消息到来。\nqueue：消息队列，图中红色部分。类似一个邮箱，\n可以缓存消息；生产者向其中投递消息，消费者从其中取出消息。\n~~~\n\n#### 4.4.1 开发生产者\n\n~~~java\npackage demo.direct;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport common.Constant;\nimport utils.RabbitMQUtil;\n\n/**\n * 第一种模型(直连)\n *\n * @author xie.wei\n * @date created at 2021-11-15 17:39\n */\npublic class Producer {\n\n    public static void main(String[] args) {\n        // 获取连接\n        Connection connection = RabbitMQUtil.getConnection();\n        Channel channel = null;\n        try {\n            // 创建通道、生产者和mq服务所有通信都在channel中完成\n            channel = connection.createChannel();\n\n            /**\n             *  声明 direct 直连队列\n             *  1. queue 队列名称\n             *  2. durable 队列是否持久化，mq重启队列还在，不会保证消息的持久化\n             *  3. exclusive 是否独占连接，队列只允许在连接中访问，如果连接关闭则队列无法\n             *  访问,如果将此参数设置为true可以用于临时队列的创建\n             *  4. autoDelete 自动删除,及队列不在使用时自动删除，一般消费者消费完成ACK确认后，\n             *  生产消费都断开了连接后，队列自动删除，\n             *  5. 参数，可以设置队列的扩展属性，比如：可设置存活时间等\n             */\n            channel.queueDeclare(Constant.DIRECT_QUEUE, false, false, false,\n                    null);\n\n            /**\n             * 发布消息\n             * 1. exchange 交换机\n             * 2. routingKey 路由key，交换机根据key将消息转发到指定队列，如果使用默认交换机\n             * 则key就是队列名称\n             * 3. props 消息属性，可以设置消息为可持久化，MessageProperties.PERSISTENT_TEXT_PLAIN\n             * 4. body 消息内容\n             */\n            channel.basicPublish(\"\", Constant.DIRECT_QUEUE, null,\n                    \"hello world\".getBytes());\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            // 关闭通道和连接\n            RabbitMQUtil.close(channel, connection);\n        }\n    }\n}\n~~~\n\n#### 4.4.2 开发消费者\n\n```java\npackage demo.direct;\n\nimport com.rabbitmq.client.*;\nimport common.Constant;\nimport utils.RabbitMQUtil;\n\nimport java.io.IOException;\n\n/**\n * 第一种模型(直连)\n *\n * @author xie.wei\n * @date created at 2021-11-15 22:43\n */\n@SuppressWarnings(\"all\")\npublic class Consumer {\n    public static void main(String[] args) {\n        Connection connection = RabbitMQUtil.getConnection();\n        Channel channel = null;\n        try {\n            channel = connection.createChannel();\n            channel.queueDeclare(Constant.DIRECT_QUEUE, false, false, false, null);\n\n            /*\n             * 参数明细：\n             * 1、queue 队列名称\n             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，\n             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复\n             * 3、callback，消费方法，当消费者接收到消息要执行的方法\n             */\n            channel.basicConsume(Constant.DIRECT_QUEUE, true, new DefaultConsumer(channel) {\n\n                /**\n                 * 当接收到消息后此方法将被调用\n                 * @param consumerTag  消费者标签，用来标识消费者的，\n                 *        在监听队列时设置channel.basicConsume\n                 * @param envelope 信封，通过envelope\n                 * @param properties 消息属性\n                 * @param body 消息内容\n                 * @throws IOException\n                 */\n                @Override\n                public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                           byte[] body) throws IOException {\n                    // key,本例即队列名称\n                    String routingKey = envelope.getRoutingKey();\n                    // 交换机\n                    String exchange = envelope.getExchange();\n                    // 消息id，mq在channel中用来标识消息的id，可用于确认消息已接收\n                    long deliveryTag = envelope.getDeliveryTag();\n                    String msg = new String(body, \"utf-8\");\n                    System.out.printf(\"routingKey:%s,exchange:%s,deliveryTag:%s,body:%s\", routingKey,\n                            exchange, deliveryTag, msg);\n                }\n            });\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            // RabbitMQUtil.close(channel, connection);\n        }\n    }\n}\n```\n\n### 4.5 第二种模型(working queque)\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191630397.png)\n\n这种模式叫工作队列或者**竞争消费者**模式。\n\nWorking queues与入门程序相比，多了一个消费端，两个消费端共同消费同一个队列中的消息，但是**一个消息只能被一个消费者获取**。\n\n这个消息模型在Web应用程序中特别有用，可以处理短的HTTP请求窗口中无法处理复杂的任务。\n\n接下来我们来模拟这个流程：\n\nP：生产者：任务的发布者\n\nC1：消费者1：领取任务并且完成任务，假设完成速度较慢（模拟耗时）\n\nC2：消费者2：领取任务并且完成任务，假设完成速度较快\n\n#### 4.5.1 生成者\n\n```java\npackage demo.wokerqueue;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport common.Constant;\nimport utils.RabbitMQUtil;\n\n/**\n * working queue 生产者\n *\n * @author xie.wei\n * @date created at 2022-01-06 15:16\n */\npublic class Producer {\n\n    public static void main(String[] args) {\n        // 获取连接\n        Connection connection = RabbitMQUtil.getConnection();\n        Channel channel = null;\n        try {\n            // 创建通道、生产者和mq服务所有通信都在channel中完成\n            channel = connection.createChannel();\n\n            /*\n             *  声明 direct 直连队列\n             *  1. queue 队列名称\n             *  2. durable 队列是否持久化，mq重启队列还在，不会保证消息的持久化\n             *  3. exclusive 是否独占连接，队列只允许在连接中访问，如果连接关闭则队列无法\n             *  访问,如果将此参数设置为true可以用于临时队列的创建\n             *  4. autoDelete 自动删除,及队列不在使用时自动删除，一般消费者消费完成ACK确认后，\n             *  生产消费都断开了连接后，队列自动删除，\n             *  5. 参数，可以设置队列的扩展属性，比如：可设置存活时间等\n             */\n            channel.queueDeclare(Constant.WORKING_QUEUE, false, false, false,\n                    null);\n\n            /*\n             * 发布消息\n             * 1. exchange 交换机\n             * 2. routingKey 路由key，交换机根据key将消息转发到指定队列，如果使用默认交换机\n             * 则key就是队列名称\n             * 3. props 消息属性，可以设置消息为可持久化，MessageProperties.PERSISTENT_TEXT_PLAIN\n             * 4. body 消息内容\n             */\n            for (int i = 0; i < 50; i++) {\n                String message = \"working queue message: \" + i;\n                channel.basicPublish(\"\", Constant.WORKING_QUEUE, null,\n                        message.getBytes());\n            }\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            // 关闭通道和连接\n            RabbitMQUtil.close(channel, connection);\n        }\n    }\n}\n```\n\n#### 4.5.2 消费者1\n\n```java\npackage demo.wokerqueue;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport java.util.concurrent.TimeUnit;\nimport utils.RabbitMQUtil;\n\n/**\n * working queue consumer one\n *\n * @author xie.wei\n * @date created at 2022-01-06 15:22\n */\npublic class Consumer1 {\n    public static void main(String[] args) {\n        Connection connection = RabbitMQUtil.getConnection();\n        Channel channel = null;\n        try {\n            channel = connection.createChannel();\n            channel.queueDeclare(Constant.WORKING_QUEUE, false, false, false, null);\n\n            /*\n             * 参数明细：\n             * 1、queue 队列名称\n             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，\n             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复\n             * 3、callback，消费方法，当消费者接收到消息要执行的方法\n             */\n            channel.basicConsume(Constant.WORKING_QUEUE, true, new DefaultConsumer(channel) {\n\n                /**\n                 * 当接收到消息后此方法将被调用\n                 * @param consumerTag  消费者标签，用来标识消费者的，\n                 *        在监听队列时设置channel.basicConsume\n                 * @param envelope 信封，通过envelope\n                 * @param properties 消息属性\n                 * @param body 消息内容\n                 * @throws IOException\n                 */\n                @Override\n                public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                           byte[] body) throws IOException {\n                    // body 即消息体\n                    String msg = new String(body, \"utf-8\");\n                    System.out.println(\" [消费者1] received : \" + msg + \"!\");\n                    //模拟任务耗时1s\n                    try {\n                        TimeUnit.SECONDS.sleep(1);\n                    } catch (Exception e) {\n                        e.printStackTrace();\n                    }\n                }\n            });\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            // RabbitMQUtil.close(channel, connection);\n        }\n    }\n}\n```\n\n#### 4.5.3 消费者2\n\n```java\npackage demo.wokerqueue;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * working queue consumer two\n *\n * @author xie.wei\n * @date created at 2022-01-06 15:22\n */\npublic class Consumer2 {\n    public static void main(String[] args) {\n        Connection connection = RabbitMQUtil.getConnection();\n        Channel channel = null;\n        try {\n            channel = connection.createChannel();\n            channel.queueDeclare(Constant.WORKING_QUEUE, false, false, false, null);\n\n            /*\n             * 参数明细：\n             * 1、queue 队列名称\n             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，\n             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复\n             * 3、callback，消费方法，当消费者接收到消息要执行的方法\n             */\n            channel.basicConsume(Constant.WORKING_QUEUE, true, new DefaultConsumer(channel) {\n\n                /**\n                 * 当接收到消息后此方法将被调用\n                 * @param consumerTag  消费者标签，用来标识消费者的，\n                 *        在监听队列时设置channel.basicConsume\n                 * @param envelope 信封，通过envelope\n                 * @param properties 消息属性\n                 * @param body 消息内容\n                 * @throws IOException\n                 */\n                @Override\n                public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                           byte[] body) throws IOException {\n                    // body 即消息体\n                    String msg = new String(body, \"utf-8\");\n                    System.out.println(\" [消费者1] received : \" + msg + \"!\");\n                }\n            });\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            // RabbitMQUtil.close(channel, connection);\n        }\n    }\n}\n```\n\n与消费者1基本类似，只是消费者2没有设置消费耗时时间。\n\n接下来，两个消费者一同启动，然后生产者发送50条消息：\n\n![image-20220106153336710](https://raw.githubusercontent.com/xzyup/image/master/202203191630026.png)\n\n![image-20220106153405659](https://raw.githubusercontent.com/xzyup/image/master/202203191630579.png)\n\n**可以发现，两个消费者各自消费了不同25条消息，这就实现了任务的分发。** \n\n#### 4.5.4 能者多劳\n\n刚才的实现有问题吗？\n\n- 消费者1比消费者2的效率要低，一次任务的耗时较长\n- 然而两人最终消费的消息数量是一样的\n- 消费者2大量时间处于空闲状态，消费者1一直忙碌\n\n现在的状态属于是把任务平均分配，正确的做法应该是消费越快的人，消费的越多。\n\n怎么实现呢？\n\n通过 BasicQos 方法设置prefetchCount = 1。这样RabbitMQ就会使得每个Consumer在同一个时间点最多处理1个Message。换句话说，在接收到该Consumer的ack前，他它不会将新的Message分发给它。相反，它会将其分派给不是仍然忙碌的下一个Consumer。\n\n**值得注意的是：prefetchCount在手动ack的情况下才生效，自动ack不生效。**\n\n设置prefetchCount和手动ack代码如下：\n\n```java\npublic static void main(String[] args) throws Exception {\n  Connection connection = RabbitMQUtil.getConnection();\n  final Channel channel = connection.createChannel();\n\n  channel.queueDeclare(Constant.WORKING_QUEUE, false, false, false, null);\n  // 设置每个消费者同时只能处理一条消息，手动ack下生效\n  channel.basicQos(1);\n\n  channel.basicConsume(Constant.WORKING_QUEUE, false, new DefaultConsumer(channel) {\n\n\n    @Override\n    public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                               byte[] body) throws IOException {\n      // body 即消息体\n      String msg = new String(body, \"utf-8\");\n      System.out.println(\" [消费者2] received : \" + msg + \"!\");\n      channel.basicAck(envelope.getDeliveryTag(), false);\n    }\n  });\n}\n```\n\n再次测试：\n\n![image-20220106155103949](https://raw.githubusercontent.com/xzyup/image/master/202203191630941.png)\n\n![image-20220106155123303](https://raw.githubusercontent.com/xzyup/image/master/202203191630053.png)\n\n\n\n### 4.6 第三种模型(订阅模型)\n\n**订阅模型分类**\n说明下：\n\n1、一个生产者多个消费者\n2、每个消费者都有一个自己的队列\n3、生产者没有将消息直接发送给队列，而是发送给exchange(交换机、转发器)\n4、每个队列都需要绑定到交换机上\n5、生产者发送的消息，经过交换机到达队列，实现一个消息被多个消费者消费\n例子：注册->发邮件、发短信\n\n**X（Exchanges）**：交换机一方面：接收生产者发送的消息。另一方面：知道如何处理消息，例如递交给某个特别队列、递交给所有队列、或是将消息丢弃。到底如何操作，取决于Exchange的类型。\n\nExchange类型有以下几种：\n\n**Fanout**：广播，将消息交给所有绑定到交换机的队列\n\n**Direct**：定向，把消息交给符合指定routing key 的队列\n\n**Topic**：通配符，把消息交给符合routing pattern（路由模式） 的队列\n\n**Header**：header模式与routing不同的地方在于，header模式取消routingkey，使用header中的 key/value（键值对）匹配队列。\n\nHeader模式不展开了，感兴趣可以参考这篇文章https://blog.csdn.net/zhu_tianwei/article/details/40923131\n\n**Exchange（交换机）只负责转发消息，不具备存储消息的能力，因此如果没有任何队列与Exchange绑定，或者没有符合路由规则的队列，那么消息会丢失！**\n\n#### 4.6.1 Publish/subcribe(交换机类型：fanout，也称广播)\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191630971.png)\n\n\n\n##### 生产者\n\n和前面两种模式不同：\n\n- 1） 声明Exchange，不再声明Queue\n- 2） 发送消息到Exchange，不再发送到Queue\n\n```java\npackage demo.pubsub;\n\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * 订阅模式：pub/sub 生产者\n *\n * @author xie.wei\n * @date created at 2022-01-06 16:11\n */\npublic class Producer {\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n\n        channel.exchangeDeclare(Constant.FANOUT_EXCHANGE, \"fanout\");\n        String message = \"registration success\";\n        channel.basicPublish(Constant.FANOUT_EXCHANGE, \"\", null, message.getBytes());\n\n        RabbitMQUtil.close(channel, connection);\n    }\n}\n```\n\n##### 消费者1 （注册成功发给短信服务）\n\n```java\npackage demo.pubsub;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * pub/sub consumer1\n * 发送短信服务\n *\n * @author xie.wei\n * @date created at 2022-01-06 16:48\n */\npublic class Consumer1 {\n\n    static String QUEUE = \"fanout_exchange_queue_sms\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明队列\n        channel.queueDeclare(QUEUE, false, false, false, null);\n        // 定义队列消费者\n        channel.queueBind(QUEUE, Constant.FANOUT_EXCHANGE, \"\");\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [短信服务] received : \" + msg + \"!\");\n            }\n        };\n        channel.basicConsume(QUEUE, true, consumer);\n    }\n}\n```\n\n##### 消费者2（注册成功发给邮件服务）\n\n```java\npackage demo.pubsub;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * pub/sub consumer2\n * 发送邮件服务\n *\n * @author xie.wei\n * @date created at 2022-01-06 16:48\n */\npublic class Consumer2 {\n\n    static String QUEUE = \"fanout_exchange_queue_email\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明队列\n        channel.queueDeclare(QUEUE, false, false, false, null);\n        // 定义队列消费者\n        channel.queueBind(QUEUE, Constant.FANOUT_EXCHANGE, \"\");\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [邮件服务] received : \" + msg + \"!\");\n            }\n        };\n        channel.basicConsume(QUEUE, true, consumer);\n    }\n}\n```\n\n我们运行两个消费者，然后生成者发送1条消息：如果先运行消费者，可能出现exchange不存在的报错，可现在admin页面创建或者先运行生产者。\n\n![image-20220106171011803](https://raw.githubusercontent.com/xzyup/image/master/202203191631939.png)\n\n![image-20220106171035697](https://raw.githubusercontent.com/xzyup/image/master/202203191631763.png)\n\n##### 思考\n\n1、publish/subscribe与work queues有什么区别。\n\n区别：\n\n1）work queues不用定义交换机，而publish/subscribe需要定义交换机。\n\n2）publish/subscribe的生产方是面向交换机发送消息，work queues的生产方是面向队列发送消息(底层使用默认交换机)。\n\n3）publish/subscribe需要设置队列和交换机的绑定，work queues不需要设置，实际上work queues会将队列绑定到默认的交换机 。\n\n相同点：\n\n所以两者实现的发布/订阅的效果是一样的，多个消费端监听同一个队列不会重复消费消息。\n\n2、实际工作用 publish/subscribe还是work queues。\n\n建议使用 publish/subscribe，发布订阅模式比工作队列模式更强大（也可以做到同一队列竞争），并且发布订阅模式可以指定自己专用的交换机。\n\n#### 4.6.2 Routing 路由模型（交换机类型：direct）\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191631447.png)\n\nP：生产者，向Exchange发送消息，发送消息时，会指定一个routing key。\n\nX：Exchange（交换机），接收生产者的消息，然后把消息递交给 与routing key完全匹配的队列\n\nC1：消费者，其所在队列指定了需要routing key 为 error 的消息\n\nC2：消费者，其所在队列指定了需要routing key 为 info、error、warning 的消息\n\n接下来看代码：\n\n##### 生产者\n\n```java\npackage demo.routing;\n\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * routing路由模式 交换机类型为direct\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:15\n */\npublic class Producer {\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明exchange,指明类型为direct\n        channel.exchangeDeclare(Constant.DIRECT_EXCHANGE, BuiltinExchangeType.DIRECT);\n        // 消息内容\n        String message = \"注册成功！请短息回复[T]退订\";\n        // 发送消息，并指定routing key 为sms，只有短信服务才能接受该消息\n        channel.basicPublish(Constant.DIRECT_EXCHANGE, \"sms\", null, message.getBytes());\n        System.out.println(\" [x] Sent '\" + message + \"'\");\n\n        RabbitMQUtil.close(channel, connection);\n    }\n}\n```\n\n##### 消费者1\n\n```java\npackage demo.routing;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * routing key路由模式 exchange type: direct\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:23\n */\npublic class Consumer1 {\n\n    static String QUEUE = \"direct_exchange_queue_sms\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n\n        // 声明队列\n        channel.queueDeclare(QUEUE, false, false, false, null);\n        // 绑定交换机,同时指定需要指定的routing key,可以同时指定多个\n        channel.queueBind(QUEUE, Constant.DIRECT_EXCHANGE, \"sms\");\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [短信服务] received : \" + msg + \"!\");\n            }\n        };\n        // 监听队列，自动ACK\n        channel.basicConsume(QUEUE, true, consumer);\n    }\n}\n```\n\n##### 消费者2\n\n```java\npackage demo.routing;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * routing key路由模式 exchange type: direct\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:23\n */\npublic class Consumer2 {\n\n    static String QUEUE = \"direct_exchange_queue_email\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n\n        // 声明队列\n        channel.queueDeclare(QUEUE, false, false, false, null);\n        // 绑定交换机,同时指定需要指定的routing key,可以同时指定多个\n        channel.queueBind(QUEUE, Constant.DIRECT_EXCHANGE, \"email\");\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [邮件服务] received : \" + msg + \"!\");\n            }\n        };\n        // 监听队列，自动ACK\n        channel.basicConsume(QUEUE, true, consumer);\n    }\n}\n```\n\n我们发送sms的RoutingKey，发现结果：只有指定短信的消费者1收到消息了\n\n![image-20220106173229176](https://raw.githubusercontent.com/xzyup/image/master/202203191631537.png)\n\n#### 4.6.3 Topics 通配符模式（交换机类型：topics）\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191631892.png)\n\n 每个消费者监听自己的队列，并且设置带统配符的routingkey,生产者将消息发给broker，由交换机根据routingkey来转发消息到指定的队列。\n\nRoutingkey一般都是有一个或者多个单词组成，多个单词之间以“.”分割，例如：inform.sms\n\n通配符规则：\n\n#：匹配一个或多个词\n\n*：匹配不多不少恰好1个词\n\n举例：\n\naudit.#：能够匹配audit.irs.corporate 或者 audit.irs\n\naudit.*：只能匹配audit.irs\n\n从示意图可知，我们将发送所有描述动物的消息。消息将使用由三个字（两个点）组成的Routing key发送。路由关键字中的第一个单词将描述速度，第二个颜色和第三个种类：“<speed>.<color>.<species>”。\n\n我们创建了三个绑定：Q1绑定了“*.orange.*”，Q2绑定了“.*.*.rabbit”和“lazy.＃”。\n\nQ1匹配所有的橙色动物。\n\nQ2匹配关于兔子以及懒惰动物的消息。\n\n 下面做个小练习，假如生产者发送如下消息，会进入哪个队列：\n\nquick.orange.rabbit       Q1 Q2   routingKey=\"quick.orange.rabbit\"的消息会同时路由到Q1与Q2\n\nlazy.orange.elephant    Q1 Q2\n\nquick.orange.fox           Q1\n\nlazy.pink.rabbit              Q2  (值得注意的是，虽然这个routingKey与Q2的两个bindingKey都匹配，但是只会投递Q2一次)\n\nquick.brown.fox            不匹配任意队列，被丢弃\n\nquick.orange.male.rabbit   不匹配任意队列，被丢弃\n\norange         不匹配任意队列，被丢弃\n\n下面我们以指定Routing key=\"quick.orange.rabbit\"为例，验证上面的答案\n\n##### 生产者\n\n```java\npackage demo.topics;\n\nimport com.rabbitmq.client.BuiltinExchangeType;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * topics模式\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:41\n */\npublic class Producer {\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明exchange，指定类型为topic\n        channel.exchangeDeclare(Constant.TOPIC_EXCHANGE, BuiltinExchangeType.TOPIC);\n        // 消息内容\n        String message = \"这是一只行动迅速的橙色的兔子\";\n        // 发送消息，并且指定routing key为：quick.orange.rabbit\n        channel.basicPublish(Constant.TOPIC_EXCHANGE, \"quick.orange.rabbit\", null, message.getBytes());\n        System.out.println(\" [动物描述：] Sent '\" + message + \"'\");\n        RabbitMQUtil.close(channel, connection);\n    }\n}\n```\n\n##### 消费者1\n\n```java\npackage demo.topics;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * topics模式\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:46\n */\npublic class Consumer1 {\n    static String QUEUE_NAME = \"topic_exchange_queue_Q1\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明队列\n        channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n\n        // 绑定队列到交换机，同时指定需要订阅的routing key。订阅所有的橙色动物\n        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, \"*.orange.*\");\n\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [消费者1] received : \" + msg + \"!\");\n            }\n        };\n        // 监听队列，自动ACK\n        channel.basicConsume(QUEUE_NAME, true, consumer);\n\n    }\n}\n```\n\n##### 消费者2\n\n```java\npackage demo.topics;\n\nimport com.rabbitmq.client.AMQP;\nimport com.rabbitmq.client.Channel;\nimport com.rabbitmq.client.Connection;\nimport com.rabbitmq.client.DefaultConsumer;\nimport com.rabbitmq.client.Envelope;\nimport common.Constant;\nimport java.io.IOException;\nimport utils.RabbitMQUtil;\n\n/**\n * topics模式\n *\n * @author xie.wei\n * @date created at 2022-01-06 17:46\n */\npublic class Consumer2 {\n    static String QUEUE_NAME = \"topic_exchange_queue_Q2\";\n\n    public static void main(String[] args) throws IOException {\n        final Connection connection = RabbitMQUtil.getConnection();\n        final Channel channel = connection.createChannel();\n        // 声明队列\n        channel.queueDeclare(QUEUE_NAME, false, false, false, null);\n\n        // 绑定队列到交换机，同时指定需要订阅的routing key。订阅关于兔子以及懒惰动物的消息\n        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, \"*.*.rabbit\");\n        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, \"lazy.＃\");\n\n        // 定义队列的消费者\n        DefaultConsumer consumer = new DefaultConsumer(channel) {\n            // 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用\n            @Override\n            public void handleDelivery(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,\n                                       byte[] body) throws IOException {\n                // body 即消息体\n                String msg = new String(body);\n                System.out.println(\" [消费者2] received : \" + msg + \"!\");\n            }\n        };\n        // 监听队列，自动ACK\n        channel.basicConsume(QUEUE_NAME, true, consumer);\n\n    }\n}\n```\n\n结果C1、C2是都接收到消息了：\n\n![image-20220106175843295](https://raw.githubusercontent.com/xzyup/image/master/202203191631828.png)\n\n![image-20220106175904638](https://raw.githubusercontent.com/xzyup/image/master/202203191632611.png)\n\n#### 4.6.3 RPC\n\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191632340.png)\n\n基本概念：\n\nCallback queue 回调队列，客户端向服务器发送请求，服务器端处理请求后，将其处理结果保存在一个存储体中。而客户端为了获得处理结果，那么客户在向服务器发送请求时，同时发送一个回调队列地址reply_to。\n\nCorrelation id 关联标识，客户端可能会发送多个请求给服务器，当服务器处理完后，客户端无法辨别在回调队列中的响应具体和那个请求时对应的。为了处理这种情况，客户端在发送每个请求时，同时会附带一个独有correlation_id属性，这样客户端在回调队列中根据correlation_id字段的值就可以分辨此响应属于哪个请求。\n\n流程说明：\n\n当客户端启动的时候，它创建一个匿名独享的回调队列。\n在 RPC 请求中，客户端发送带有两个属性的消息：一个是设置回调队列的 reply_to 属性，另一个是设置唯一值的 correlation_id 属性。\n将请求发送到一个 rpc_queue 队列中。\n服务器等待请求发送到这个队列中来。当请求出现的时候，它执行他的工作并且将带有执行结果的消息发送给 reply_to 字段指定的队列。\n客户端等待回调队列里的数据。当有消息出现的时候，它会检查 correlation_id 属性。如果此属性的值与请求匹配，将它返回给应用\n\n### 5 面试题\n\n面试题：\n\n避免消息堆积？\n\n1） 采用workqueue，多个消费者监听同一队列。\n\n2）接收到消息以后，而是通过线程池，异步消费。\n\n如何避免消息丢失？\n\n1） 消费者的ACK机制。可以防止消费者丢失消息。\n\n但是，如果在消费者消费之前，MQ就宕机了，消息就没了？\n\n2）可以将消息进行持久化。要将消息持久化，前提是：队列、Exchange都持久化\n\n交换机持久化\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191632563.png)\n队列持久化\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191632941.png)\n消息持久化\n![img](https://raw.githubusercontent.com/xzyup/image/master/202203191632365.png)\n\n","slug":"mq/rabbitmq入门","published":1,"date":"2022-04-20T12:41:20.789Z","updated":"2022-05-04T03:21:50.169Z","_id":"cl2qzftj5008b13nohds1cb2o","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"1-MQ引言\"><a href=\"#1-MQ引言\" class=\"headerlink\" title=\"1 MQ引言\"></a>1 MQ引言</h2><blockquote>\n<p>参考 <a href=\"https://blog.csdn.net/unique_perfect/article/details/109380996\">https://blog.csdn.net/unique_perfect/article/details/109380996</a></p>\n</blockquote>\n<h3 id=\"1-1-什么是MQ\"><a href=\"#1-1-什么是MQ\" class=\"headerlink\" title=\"1.1 什么是MQ\"></a>1.1 什么是MQ</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MQ(Message Quene) :  翻译为消息队列,通过典型的生产者</span><br><span class=\"line\">和消费者模型,生产者不断向消息队列中生产消息，消费者</span><br><span class=\"line\">不断的从队列中获取消息。因为消息的生产和消费都是异</span><br><span class=\"line\">步的，而且只关心消息的发送和接收，没有业务逻辑的侵</span><br><span class=\"line\">入,轻松的实现系统间解耦。别名为 消息中间件通过利用</span><br><span class=\"line\">高效可靠的消息传递机制进行平台无关的数据交流，并</span><br><span class=\"line\">基于数据通信来进行分布式系统的集成。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-MQ有哪些\"><a href=\"#1-2-MQ有哪些\" class=\"headerlink\" title=\"1.2 MQ有哪些\"></a>1.2 MQ有哪些</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">当今市面上有很多主流的消息中间件，如老牌的ActiveMQ、</span><br><span class=\"line\">RabbitMQ，炙手可热的Kafka，阿里巴巴自主开发RocketMQ等。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-3-不同MQ特点\"><a href=\"#1-3-不同MQ特点\" class=\"headerlink\" title=\"1.3 不同MQ特点\"></a>1.3 不同MQ特点</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.ActiveMQ</span><br><span class=\"line\">\t\tActiveMQ 是Apache出品，最流行的，能力强劲的开源</span><br><span class=\"line\">\t\t消息总线。它是一个完全支持JMS规范的的消息中间件。</span><br><span class=\"line\">\t\t丰富的API,多种集群架构模式让ActiveMQ在业界成为老</span><br><span class=\"line\">\t\t牌的消息中间件,在中小型企业 颇受欢迎!</span><br><span class=\"line\"></span><br><span class=\"line\">2.Kafka</span><br><span class=\"line\">\t\tKafka是LinkedIn开源的分布式发布-订阅消息系统，目</span><br><span class=\"line\">\t\t前归属于Apache顶级项目。Kafka主要特点是基于Pull</span><br><span class=\"line\">\t\t的模式来处理消息消费，追求高吞吐量，一开始的目的</span><br><span class=\"line\">\t\t就是用于日志收集和传输。0.8版本开始支持复制，不支</span><br><span class=\"line\">\t\t持事务，对消息的重复、丢失、错误没有严格要求，</span><br><span class=\"line\">\t\t适合产生大量数据的互联网服务的数据收集业务。</span><br><span class=\"line\"></span><br><span class=\"line\">3.RocketMQ</span><br><span class=\"line\">\t\tRocketMQ是阿里开源的消息中间件，它是纯Java开发，</span><br><span class=\"line\">\t\t具有高吞吐量、高可用性、适合大规模分布式系统应用</span><br><span class=\"line\">\t\t的特点。RocketMQ思路起源于Kafka，但并不是Kafka</span><br><span class=\"line\">\t\t的一个Copy，它对消息的可靠传输及事务性做了优化，</span><br><span class=\"line\">\t\t目前在阿里集团被广泛应用于交   易、充值、流计算、</span><br><span class=\"line\">\t\t消息推送、日志流式处理、binglog分发等场景。</span><br><span class=\"line\"></span><br><span class=\"line\">4.RabbitMQ</span><br><span class=\"line\">\t\tRabbitMQ是使用Erlang语言开发的开源消息队列系统，</span><br><span class=\"line\">\t\t基于AMQP协议来实现。AMQP的主要特征是面向消息、</span><br><span class=\"line\">\t\t队列、路由（包括点对点和发布/订阅）、可靠性、安全。</span><br><span class=\"line\">\t\tAMQP协议更多用在企业系统内对数据一致性、稳定性和</span><br><span class=\"line\">\t\t可靠性要求很高的场景，对性能和吞吐量的要求还在</span><br><span class=\"line\">\t\t其次。</span><br><span class=\"line\"></span><br><span class=\"line\">RabbitMQ比Kafka可靠，Kafka更适合IO高吞吐的处理，一般应用</span><br><span class=\"line\">在大数据日志处理或对实时性（少量延迟），可靠性（少量丢数据）</span><br><span class=\"line\">要求稍低的场景使用，比如ELK日志收集。\t\t</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-RabbitMQ-的引言\"><a href=\"#2-RabbitMQ-的引言\" class=\"headerlink\" title=\"2 RabbitMQ 的引言\"></a>2 RabbitMQ 的引言</h2><h3 id=\"2-1-RabbitMQ\"><a href=\"#2-1-RabbitMQ\" class=\"headerlink\" title=\"2.1 RabbitMQ\"></a>2.1 RabbitMQ</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">基于AMQP协议，erlang语言开发，是部署最广泛的开源</span><br><span class=\"line\">消息中间件,是最受欢迎的开源消息中间件之一。</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191626795.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">AMQP 协议</span><br><span class=\"line\"> \tAMQP（advanced message queuing protocol）在2003年</span><br><span class=\"line\"> \t时被提出，最早用于解决金融领不同平台之间的消息传递</span><br><span class=\"line\"> \t交互问题。顾名思义，AMQP是一种协议，更准确的说是</span><br><span class=\"line\"> \t一种binary wire-level protocol（链接协议）。这是其和</span><br><span class=\"line\"> \tJMS的本质差别，AMQP不从API层进行限定，而是直接</span><br><span class=\"line\"> \t定义网络交换的数据格式。这使得实现了AMQP的</span><br><span class=\"line\"> \tprovider天然性就是跨平台的。以下是AMQP协议模型:</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191627854.png\" alt=\"image-20211115164234247\"></p>\n<h3 id=\"2-2-RabbitMQ-的安装\"><a href=\"#2-2-RabbitMQ-的安装\" class=\"headerlink\" title=\"2.2 RabbitMQ 的安装\"></a>2.2 RabbitMQ 的安装</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">最新版的3.8版本的可以看我这篇文章</span><br><span class=\"line\">https://blog.csdn.net/unique_perfect/article/details/108643804</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-2-1-下载\"><a href=\"#2-2-1-下载\" class=\"headerlink\" title=\"2.2.1 下载\"></a>2.2.1 下载</h4><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191627315.png\" alt=\"在这里插入图片描述\"></p>\n<p><code>注意:这里的安装包是centos7安装的包</code></p>\n<h4 id=\"2-2-3-安装步骤\"><a href=\"#2-2-3-安装步骤\" class=\"headerlink\" title=\"2.2.3 安装步骤\"></a>2.2.3 安装步骤</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1.将rabbitmq安装包上传到linux系统中</span><br><span class=\"line\">\terlang-22.0.7-1.el7.x86_64.rpm  #l7表示是Centosl7,Centosl8表示Centos8</span><br><span class=\"line\">\trabbitmq-server-3.7.18-1.el7.noarch.rpm</span><br><span class=\"line\"></span><br><span class=\"line\"># 2.安装Erlang依赖包</span><br><span class=\"line\">\trpm -ivh erlang-22.0.7-1.el7.x86_64.rpm</span><br><span class=\"line\"></span><br><span class=\"line\"># 3.安装RabbitMQ安装包(需要联网)</span><br><span class=\"line\">\tyum install -y rabbitmq-server-3.7.18-1.el7.noarch.rpm</span><br><span class=\"line\">\t注意:默认安装完成后配置文件模板在:/usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example目录中,需要\t</span><br><span class=\"line\">\t将配置文件复制到/etc/rabbitmq/目录中,并修改名称为rabbitmq.config</span><br><span class=\"line\"># 4.复制配置文件</span><br><span class=\"line\">\tcp /usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example /etc/rabbitmq/rabbitmq.config</span><br><span class=\"line\"></span><br><span class=\"line\"># 5.查看配置文件位置</span><br><span class=\"line\">\tls /etc/rabbitmq/rabbitmq.config</span><br><span class=\"line\"></span><br><span class=\"line\"># 6.修改配置文件(参见下图:)</span><br><span class=\"line\">\tvim /etc/rabbitmq/rabbitmq.config </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191627769.png\" alt=\"image-20211115164655058\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">将上图中配置文件中红色部分去掉`%%`,以及最后的`,`逗号 </span><br><span class=\"line\">修改为下图:</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191627998.png\" alt=\"image-20211115164726573\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">`或者这两行的注释放开` 不能版本配置文件有差异</span><br><span class=\"line\">loopback_users.guest = true</span><br><span class=\"line\">loopback_users.guest = false</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 7.执行如下命令,启动rabbitmq中的插件管理</span><br><span class=\"line\">\trabbitmq-plugins enable rabbitmq_management</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t出现如下说明:</span><br><span class=\"line\">\t\tEnabling plugins on node rabbit@localhost:</span><br><span class=\"line\">    rabbitmq_management</span><br><span class=\"line\">    The following plugins have been configured:</span><br><span class=\"line\">      rabbitmq_management</span><br><span class=\"line\">      rabbitmq_management_agent</span><br><span class=\"line\">      rabbitmq_web_dispatch</span><br></pre></td></tr></table></figure>\n\n<pre><code>The following plugins have been enabled:\n  rabbitmq_management\n  rabbitmq_management_agent\n  rabbitmq_web_dispatch\n\nset 3 plugins.\nOffline change; changes will take effect at broker restart.\n</code></pre>\n<h1 id=\"8-启动RabbitMQ的服务\"><a href=\"#8-启动RabbitMQ的服务\" class=\"headerlink\" title=\"8.启动RabbitMQ的服务\"></a>8.启动RabbitMQ的服务</h1><pre><code>systemctl start rabbitmq-server\nsystemctl restart rabbitmq-server\nsystemctl stop rabbitmq-server\n</code></pre>\n<h1 id=\"9-查看服务状态-见下图\"><a href=\"#9-查看服务状态-见下图\" class=\"headerlink\" title=\"9.查看服务状态(见下图:)\"></a>9.查看服务状态(见下图:)</h1><pre><code>systemctl status rabbitmq-server\n</code></pre>\n<p>  ● rabbitmq-server.service - RabbitMQ broker<br>     Loaded: loaded (/usr/lib/systemd/system/rabbitmq-server.service; disabled; vendor preset: disabled)<br>     Active: active (running) since 三 2019-09-25 22:26:35 CST; 7s ago<br>   Main PID: 2904 (beam.smp)<br>     Status: “Initialized”<br>     CGroup: /system.slice/rabbitmq-server.service<br>             ├─2904 /usr/lib64/erlang/erts-10.4.4/bin/beam.smp -W w -A 64 -MBas ageffcbf -MHas ageffcbf -<br>             MBlmbcs…<br>             ├─3220 erl_child_setup 32768<br>             ├─3243 inet_gethost 4<br>             └─3244 inet_gethost 4<br>      ………</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![image-20211115164952765](https://raw.githubusercontent.com/xzyup/image/master/202203191627665.png)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"10-关闭防火墙服务\"><a href=\"#10-关闭防火墙服务\" class=\"headerlink\" title=\"10.关闭防火墙服务\"></a>10.关闭防火墙服务</h1><pre><code>systemctl disable firewalld  # 需要关闭防火墙，否则访问不了\nRemoved symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.\nRemoved symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.\nsystemctl stop firewalld   \n</code></pre>\n<h1 id=\"11-访问web管理界面\"><a href=\"#11-访问web管理界面\" class=\"headerlink\" title=\"11.访问web管理界面\"></a>11.访问web管理界面</h1><pre><code>http://10.15.0.8:15672/\n</code></pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191627468.png)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"12-登录管理界面\"><a href=\"#12-登录管理界面\" class=\"headerlink\" title=\"12.登录管理界面\"></a>12.登录管理界面</h1><pre><code>username:  guest\npassword:  guest\n</code></pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191628472.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## 3 RabiitMQ 配置</span><br><span class=\"line\"></span><br><span class=\"line\">### 3.1 RabbitMQ 管理命令行</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"1-服务启动相关\"><a href=\"#1-服务启动相关\" class=\"headerlink\" title=\"1.服务启动相关\"></a>1.服务启动相关</h1><pre><code>systemctl start|restart|stop|status rabbitmq-server\n</code></pre>\n<h1 id=\"2-管理命令行-用来在不使用web管理界面情况下命令操作RabbitMQ\"><a href=\"#2-管理命令行-用来在不使用web管理界面情况下命令操作RabbitMQ\" class=\"headerlink\" title=\"2.管理命令行  用来在不使用web管理界面情况下命令操作RabbitMQ\"></a>2.管理命令行  用来在不使用web管理界面情况下命令操作RabbitMQ</h1><pre><code>rabbitmqctl  help  可以查看更多命令\n</code></pre>\n<h1 id=\"3-插件管理命令行\"><a href=\"#3-插件管理命令行\" class=\"headerlink\" title=\"3.插件管理命令行\"></a>3.插件管理命令行</h1><pre><code>rabbitmq-plugins enable|list|disable \n</code></pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">### 3.2 web管理界面介绍</span><br><span class=\"line\"></span><br><span class=\"line\">#### 3.2.1 overview概览</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115165516989](https://raw.githubusercontent.com/xzyup/image/master/202203191628049.png)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>connections：无论生产者还是消费者，都需要与RabbitMQ建立连接后才<br>可以完成消息的生产和消费，在这里可以查看连接情况`</p>\n<p>channels：通道，建立连接后，会形成通道，消息的投递获取依赖通道。</p>\n<p>Exchanges：交换机，用来实现消息的路由</p>\n<p>Queues：队列，即消息队列，消息存放在队列中，等待消费，<br>消费后被移除队列。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#### 3.2.2 Admin用户和虚拟主机管理</span><br><span class=\"line\"></span><br><span class=\"line\">##### 3.2.2.1 添加用户</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115165811824](https://raw.githubusercontent.com/xzyup/image/master/202203191628829.png)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>上面的Tags选项，其实是指定用户的角色，可选的有以下几个：</p>\n<p>超级管理员(administrator)</p>\n<p>可登陆管理控制台，可查看所有的信息，并且可以对用户，<br>策略(policy)进行操作。</p>\n<p>监控者(monitoring)</p>\n<p>可登陆管理控制台，同时可以查看rabbitmq节点的相关信息<br>(进程数，内存使用情况，磁盘使用情况等)</p>\n<p>策略制定者(policymaker)</p>\n<p>可登陆管理控制台, 同时可以对policy进行管理。但无法查看节点的<br>相关信息(上图红框标识的部分)。</p>\n<p>普通管理者(management)</p>\n<p>仅可登陆管理控制台，无法看到节点信息，也无法对策略进行管理。</p>\n<p>其他</p>\n<p>无法登陆管理控制台，通常就是普通的生产者和消费者。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">##### 3.2.2.2 创建虚拟主机</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>虚拟主机<br>为了让各个用户可以互不干扰的工作，RabbitMQ添加了<br>虚拟主机（Virtual Hosts）的概念。其实就是一个独立的<br>访问路径，不同用户使用不同路径，各自有自己的<br>队列、交换机，互相不会影响。相当于关系型中的数据库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![image-20211115165945088](https://raw.githubusercontent.com/xzyup/image/master/202203191628947.png)</span><br><span class=\"line\"></span><br><span class=\"line\">##### 3.2.2.3 绑定虚拟主机和用户</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>创建好虚拟主机，我们还要给用户添加访问权限：</p>\n<p>点击添加好的虚拟主机：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![image-20211115170056567](https://raw.githubusercontent.com/xzyup/image/master/202203191628593.png)</span><br><span class=\"line\"></span><br><span class=\"line\">`进入虚拟机设置界面`</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115172528979](https://raw.githubusercontent.com/xzyup/image/master/202203191629415.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## 4 RabbitMQ 的第一个程序</span><br><span class=\"line\"></span><br><span class=\"line\">### 4.1 AMQP协议的回顾</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115173046680](https://raw.githubusercontent.com/xzyup/image/master/202203191629621.png)</span><br><span class=\"line\"></span><br><span class=\"line\">### 4.2 RabbitMQ支持的消息模型</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115173136189](https://raw.githubusercontent.com/xzyup/image/master/202203191629497.png)</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115173209816](https://raw.githubusercontent.com/xzyup/image/master/202203191629518.png)</span><br><span class=\"line\"></span><br><span class=\"line\">### 4.3 引入依赖</span><br><span class=\"line\"></span><br><span class=\"line\">~~~xml</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;amqp-client&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;5.7.2&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-4-第一种模型-直连\"><a href=\"#4-4-第一种模型-直连\" class=\"headerlink\" title=\"4.4 第一种模型(直连)\"></a>4.4 第一种模型(直连)</h3><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191629336.png\" alt=\"在这里插入图片描述\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在上图的模型中，有以下概念：</span><br><span class=\"line\"></span><br><span class=\"line\">P：生产者，也就是要发送消息的程序</span><br><span class=\"line\">C：消费者：消息的接受者，会一直等待消息到来。</span><br><span class=\"line\">queue：消息队列，图中红色部分。类似一个邮箱，</span><br><span class=\"line\">可以缓存消息；生产者向其中投递消息，消费者从其中取出消息。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-4-1-开发生产者\"><a href=\"#4-4-1-开发生产者\" class=\"headerlink\" title=\"4.4.1 开发生产者\"></a>4.4.1 开发生产者</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.direct;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 第一种模型(直连)</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2021-11-15 17:39</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Producer</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取连接</span></span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 创建通道、生产者和mq服务所有通信都在channel中完成</span></span><br><span class=\"line\">            channel = connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             *  声明 direct 直连队列</span></span><br><span class=\"line\"><span class=\"comment\">             *  1. queue 队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             *  2. durable 队列是否持久化，mq重启队列还在，不会保证消息的持久化</span></span><br><span class=\"line\"><span class=\"comment\">             *  3. exclusive 是否独占连接，队列只允许在连接中访问，如果连接关闭则队列无法</span></span><br><span class=\"line\"><span class=\"comment\">             *  访问,如果将此参数设置为true可以用于临时队列的创建</span></span><br><span class=\"line\"><span class=\"comment\">             *  4. autoDelete 自动删除,及队列不在使用时自动删除，一般消费者消费完成ACK确认后，</span></span><br><span class=\"line\"><span class=\"comment\">             *  生产消费都断开了连接后，队列自动删除，</span></span><br><span class=\"line\"><span class=\"comment\">             *  5. 参数，可以设置队列的扩展属性，比如：可设置存活时间等</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.queueDeclare(Constant.DIRECT_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>,</span><br><span class=\"line\">                    <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * 发布消息</span></span><br><span class=\"line\"><span class=\"comment\">             * 1. exchange 交换机</span></span><br><span class=\"line\"><span class=\"comment\">             * 2. routingKey 路由key，交换机根据key将消息转发到指定队列，如果使用默认交换机</span></span><br><span class=\"line\"><span class=\"comment\">             * 则key就是队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             * 3. props 消息属性，可以设置消息为可持久化，MessageProperties.PERSISTENT_TEXT_PLAIN</span></span><br><span class=\"line\"><span class=\"comment\">             * 4. body 消息内容</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, Constant.DIRECT_QUEUE, <span class=\"literal\">null</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;hello world&quot;</span>.getBytes());</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 关闭通道和连接</span></span><br><span class=\"line\">            RabbitMQUtil.close(channel, connection);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-4-2-开发消费者\"><a href=\"#4-4-2-开发消费者\" class=\"headerlink\" title=\"4.4.2 开发消费者\"></a>4.4.2 开发消费者</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.direct;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 第一种模型(直连)</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2021-11-15 22:43</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            channel = connection.createChannel();</span><br><span class=\"line\">            channel.queueDeclare(Constant.DIRECT_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * 参数明细：</span></span><br><span class=\"line\"><span class=\"comment\">             * 1、queue 队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，</span></span><br><span class=\"line\"><span class=\"comment\">             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复</span></span><br><span class=\"line\"><span class=\"comment\">             * 3、callback，消费方法，当消费者接收到消息要执行的方法</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.basicConsume(Constant.DIRECT_QUEUE, <span class=\"literal\">true</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">                 * 当接收到消息后此方法将被调用</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> consumerTag  消费者标签，用来标识消费者的，</span></span><br><span class=\"line\"><span class=\"comment\">                 *        在监听队列时设置channel.basicConsume</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> envelope 信封，通过envelope</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> properties 消息属性</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> body 消息内容</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@throws</span> IOException</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                           <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// key,本例即队列名称</span></span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">routingKey</span> <span class=\"operator\">=</span> envelope.getRoutingKey();</span><br><span class=\"line\">                    <span class=\"comment\">// 交换机</span></span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">exchange</span> <span class=\"operator\">=</span> envelope.getExchange();</span><br><span class=\"line\">                    <span class=\"comment\">// 消息id，mq在channel中用来标识消息的id，可用于确认消息已接收</span></span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">deliveryTag</span> <span class=\"operator\">=</span> envelope.getDeliveryTag();</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body, <span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">                    System.out.printf(<span class=\"string\">&quot;routingKey:%s,exchange:%s,deliveryTag:%s,body:%s&quot;</span>, routingKey,</span><br><span class=\"line\">                            exchange, deliveryTag, msg);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// RabbitMQUtil.close(channel, connection);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-5-第二种模型-working-queque\"><a href=\"#4-5-第二种模型-working-queque\" class=\"headerlink\" title=\"4.5 第二种模型(working queque)\"></a>4.5 第二种模型(working queque)</h3><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630397.png\" alt=\"img\"></p>\n<p>这种模式叫工作队列或者<strong>竞争消费者</strong>模式。</p>\n<p>Working queues与入门程序相比，多了一个消费端，两个消费端共同消费同一个队列中的消息，但是<strong>一个消息只能被一个消费者获取</strong>。</p>\n<p>这个消息模型在Web应用程序中特别有用，可以处理短的HTTP请求窗口中无法处理复杂的任务。</p>\n<p>接下来我们来模拟这个流程：</p>\n<p>P：生产者：任务的发布者</p>\n<p>C1：消费者1：领取任务并且完成任务，假设完成速度较慢（模拟耗时）</p>\n<p>C2：消费者2：领取任务并且完成任务，假设完成速度较快</p>\n<h4 id=\"4-5-1-生成者\"><a href=\"#4-5-1-生成者\" class=\"headerlink\" title=\"4.5.1 生成者\"></a>4.5.1 生成者</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.wokerqueue;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * working queue 生产者</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 15:16</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Producer</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取连接</span></span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 创建通道、生产者和mq服务所有通信都在channel中完成</span></span><br><span class=\"line\">            channel = connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             *  声明 direct 直连队列</span></span><br><span class=\"line\"><span class=\"comment\">             *  1. queue 队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             *  2. durable 队列是否持久化，mq重启队列还在，不会保证消息的持久化</span></span><br><span class=\"line\"><span class=\"comment\">             *  3. exclusive 是否独占连接，队列只允许在连接中访问，如果连接关闭则队列无法</span></span><br><span class=\"line\"><span class=\"comment\">             *  访问,如果将此参数设置为true可以用于临时队列的创建</span></span><br><span class=\"line\"><span class=\"comment\">             *  4. autoDelete 自动删除,及队列不在使用时自动删除，一般消费者消费完成ACK确认后，</span></span><br><span class=\"line\"><span class=\"comment\">             *  生产消费都断开了连接后，队列自动删除，</span></span><br><span class=\"line\"><span class=\"comment\">             *  5. 参数，可以设置队列的扩展属性，比如：可设置存活时间等</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.queueDeclare(Constant.WORKING_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>,</span><br><span class=\"line\">                    <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * 发布消息</span></span><br><span class=\"line\"><span class=\"comment\">             * 1. exchange 交换机</span></span><br><span class=\"line\"><span class=\"comment\">             * 2. routingKey 路由key，交换机根据key将消息转发到指定队列，如果使用默认交换机</span></span><br><span class=\"line\"><span class=\"comment\">             * 则key就是队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             * 3. props 消息属性，可以设置消息为可持久化，MessageProperties.PERSISTENT_TEXT_PLAIN</span></span><br><span class=\"line\"><span class=\"comment\">             * 4. body 消息内容</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">50</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;working queue message: &quot;</span> + i;</span><br><span class=\"line\">                channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, Constant.WORKING_QUEUE, <span class=\"literal\">null</span>,</span><br><span class=\"line\">                        message.getBytes());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 关闭通道和连接</span></span><br><span class=\"line\">            RabbitMQUtil.close(channel, connection);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-5-2-消费者1\"><a href=\"#4-5-2-消费者1\" class=\"headerlink\" title=\"4.5.2 消费者1\"></a>4.5.2 消费者1</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.wokerqueue;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * working queue consumer one</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 15:22</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer1</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            channel = connection.createChannel();</span><br><span class=\"line\">            channel.queueDeclare(Constant.WORKING_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * 参数明细：</span></span><br><span class=\"line\"><span class=\"comment\">             * 1、queue 队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，</span></span><br><span class=\"line\"><span class=\"comment\">             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复</span></span><br><span class=\"line\"><span class=\"comment\">             * 3、callback，消费方法，当消费者接收到消息要执行的方法</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.basicConsume(Constant.WORKING_QUEUE, <span class=\"literal\">true</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">                 * 当接收到消息后此方法将被调用</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> consumerTag  消费者标签，用来标识消费者的，</span></span><br><span class=\"line\"><span class=\"comment\">                 *        在监听队列时设置channel.basicConsume</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> envelope 信封，通过envelope</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> properties 消息属性</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> body 消息内容</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@throws</span> IOException</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                           <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body, <span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot; [消费者1] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//模拟任务耗时1s</span></span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        TimeUnit.SECONDS.sleep(<span class=\"number\">1</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// RabbitMQUtil.close(channel, connection);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-5-3-消费者2\"><a href=\"#4-5-3-消费者2\" class=\"headerlink\" title=\"4.5.3 消费者2\"></a>4.5.3 消费者2</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.wokerqueue;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * working queue consumer two</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 15:22</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer2</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            channel = connection.createChannel();</span><br><span class=\"line\">            channel.queueDeclare(Constant.WORKING_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * 参数明细：</span></span><br><span class=\"line\"><span class=\"comment\">             * 1、queue 队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，</span></span><br><span class=\"line\"><span class=\"comment\">             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复</span></span><br><span class=\"line\"><span class=\"comment\">             * 3、callback，消费方法，当消费者接收到消息要执行的方法</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.basicConsume(Constant.WORKING_QUEUE, <span class=\"literal\">true</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">                 * 当接收到消息后此方法将被调用</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> consumerTag  消费者标签，用来标识消费者的，</span></span><br><span class=\"line\"><span class=\"comment\">                 *        在监听队列时设置channel.basicConsume</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> envelope 信封，通过envelope</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> properties 消息属性</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> body 消息内容</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@throws</span> IOException</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                           <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body, <span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot; [消费者1] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// RabbitMQUtil.close(channel, connection);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>与消费者1基本类似，只是消费者2没有设置消费耗时时间。</p>\n<p>接下来，两个消费者一同启动，然后生产者发送50条消息：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630026.png\" alt=\"image-20220106153336710\"></p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630579.png\" alt=\"image-20220106153405659\"></p>\n<p><strong>可以发现，两个消费者各自消费了不同25条消息，这就实现了任务的分发。</strong> </p>\n<h4 id=\"4-5-4-能者多劳\"><a href=\"#4-5-4-能者多劳\" class=\"headerlink\" title=\"4.5.4 能者多劳\"></a>4.5.4 能者多劳</h4><p>刚才的实现有问题吗？</p>\n<ul>\n<li>消费者1比消费者2的效率要低，一次任务的耗时较长</li>\n<li>然而两人最终消费的消息数量是一样的</li>\n<li>消费者2大量时间处于空闲状态，消费者1一直忙碌</li>\n</ul>\n<p>现在的状态属于是把任务平均分配，正确的做法应该是消费越快的人，消费的越多。</p>\n<p>怎么实现呢？</p>\n<p>通过 BasicQos 方法设置prefetchCount = 1。这样RabbitMQ就会使得每个Consumer在同一个时间点最多处理1个Message。换句话说，在接收到该Consumer的ack前，他它不会将新的Message分发给它。相反，它会将其分派给不是仍然忙碌的下一个Consumer。</p>\n<p><strong>值得注意的是：prefetchCount在手动ack的情况下才生效，自动ack不生效。</strong></p>\n<p>设置prefetchCount和手动ack代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">  <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">  <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">  channel.queueDeclare(Constant.WORKING_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 设置每个消费者同时只能处理一条消息，手动ack下生效</span></span><br><span class=\"line\">  channel.basicQos(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  channel.basicConsume(Constant.WORKING_QUEUE, <span class=\"literal\">false</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                               <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">      <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">      <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body, <span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot; [消费者2] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">      channel.basicAck(envelope.getDeliveryTag(), <span class=\"literal\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>再次测试：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630941.png\" alt=\"image-20220106155103949\"></p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630053.png\" alt=\"image-20220106155123303\"></p>\n<h3 id=\"4-6-第三种模型-订阅模型\"><a href=\"#4-6-第三种模型-订阅模型\" class=\"headerlink\" title=\"4.6 第三种模型(订阅模型)\"></a>4.6 第三种模型(订阅模型)</h3><p><strong>订阅模型分类</strong><br>说明下：</p>\n<p>1、一个生产者多个消费者<br>2、每个消费者都有一个自己的队列<br>3、生产者没有将消息直接发送给队列，而是发送给exchange(交换机、转发器)<br>4、每个队列都需要绑定到交换机上<br>5、生产者发送的消息，经过交换机到达队列，实现一个消息被多个消费者消费<br>例子：注册-&gt;发邮件、发短信</p>\n<p><strong>X（Exchanges）</strong>：交换机一方面：接收生产者发送的消息。另一方面：知道如何处理消息，例如递交给某个特别队列、递交给所有队列、或是将消息丢弃。到底如何操作，取决于Exchange的类型。</p>\n<p>Exchange类型有以下几种：</p>\n<p><strong>Fanout</strong>：广播，将消息交给所有绑定到交换机的队列</p>\n<p><strong>Direct</strong>：定向，把消息交给符合指定routing key 的队列</p>\n<p><strong>Topic</strong>：通配符，把消息交给符合routing pattern（路由模式） 的队列</p>\n<p><strong>Header</strong>：header模式与routing不同的地方在于，header模式取消routingkey，使用header中的 key/value（键值对）匹配队列。</p>\n<p>Header模式不展开了，感兴趣可以参考这篇文章<a href=\"https://blog.csdn.net/zhu_tianwei/article/details/40923131\">https://blog.csdn.net/zhu_tianwei/article/details/40923131</a></p>\n<p><strong>Exchange（交换机）只负责转发消息，不具备存储消息的能力，因此如果没有任何队列与Exchange绑定，或者没有符合路由规则的队列，那么消息会丢失！</strong></p>\n<h4 id=\"4-6-1-Publish-subcribe-交换机类型：fanout，也称广播\"><a href=\"#4-6-1-Publish-subcribe-交换机类型：fanout，也称广播\" class=\"headerlink\" title=\"4.6.1 Publish/subcribe(交换机类型：fanout，也称广播)\"></a>4.6.1 Publish/subcribe(交换机类型：fanout，也称广播)</h4><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630971.png\" alt=\"img\"></p>\n<h5 id=\"生产者\"><a href=\"#生产者\" class=\"headerlink\" title=\"生产者\"></a>生产者</h5><p>和前面两种模式不同：</p>\n<ul>\n<li>1） 声明Exchange，不再声明Queue</li>\n<li>2） 发送消息到Exchange，不再发送到Queue</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.pubsub;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 订阅模式：pub/sub 生产者</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 16:11</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Producer</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.exchangeDeclare(Constant.FANOUT_EXCHANGE, <span class=\"string\">&quot;fanout&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;registration success&quot;</span>;</span><br><span class=\"line\">        channel.basicPublish(Constant.FANOUT_EXCHANGE, <span class=\"string\">&quot;&quot;</span>, <span class=\"literal\">null</span>, message.getBytes());</span><br><span class=\"line\"></span><br><span class=\"line\">        RabbitMQUtil.close(channel, connection);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者1-（注册成功发给短信服务）\"><a href=\"#消费者1-（注册成功发给短信服务）\" class=\"headerlink\" title=\"消费者1 （注册成功发给短信服务）\"></a>消费者1 （注册成功发给短信服务）</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.pubsub;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * pub/sub consumer1</span></span><br><span class=\"line\"><span class=\"comment\"> * 发送短信服务</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 16:48</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer1</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;fanout_exchange_queue_sms&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 定义队列消费者</span></span><br><span class=\"line\">        channel.queueBind(QUEUE, Constant.FANOUT_EXCHANGE, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [短信服务] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(QUEUE, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者2（注册成功发给邮件服务）\"><a href=\"#消费者2（注册成功发给邮件服务）\" class=\"headerlink\" title=\"消费者2（注册成功发给邮件服务）\"></a>消费者2（注册成功发给邮件服务）</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.pubsub;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * pub/sub consumer2</span></span><br><span class=\"line\"><span class=\"comment\"> * 发送邮件服务</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 16:48</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer2</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;fanout_exchange_queue_email&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 定义队列消费者</span></span><br><span class=\"line\">        channel.queueBind(QUEUE, Constant.FANOUT_EXCHANGE, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [邮件服务] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(QUEUE, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们运行两个消费者，然后生成者发送1条消息：如果先运行消费者，可能出现exchange不存在的报错，可现在admin页面创建或者先运行生产者。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631939.png\" alt=\"image-20220106171011803\"></p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631763.png\" alt=\"image-20220106171035697\"></p>\n<h5 id=\"思考\"><a href=\"#思考\" class=\"headerlink\" title=\"思考\"></a>思考</h5><p>1、publish/subscribe与work queues有什么区别。</p>\n<p>区别：</p>\n<p>1）work queues不用定义交换机，而publish/subscribe需要定义交换机。</p>\n<p>2）publish/subscribe的生产方是面向交换机发送消息，work queues的生产方是面向队列发送消息(底层使用默认交换机)。</p>\n<p>3）publish/subscribe需要设置队列和交换机的绑定，work queues不需要设置，实际上work queues会将队列绑定到默认的交换机 。</p>\n<p>相同点：</p>\n<p>所以两者实现的发布/订阅的效果是一样的，多个消费端监听同一个队列不会重复消费消息。</p>\n<p>2、实际工作用 publish/subscribe还是work queues。</p>\n<p>建议使用 publish/subscribe，发布订阅模式比工作队列模式更强大（也可以做到同一队列竞争），并且发布订阅模式可以指定自己专用的交换机。</p>\n<h4 id=\"4-6-2-Routing-路由模型（交换机类型：direct）\"><a href=\"#4-6-2-Routing-路由模型（交换机类型：direct）\" class=\"headerlink\" title=\"4.6.2 Routing 路由模型（交换机类型：direct）\"></a>4.6.2 Routing 路由模型（交换机类型：direct）</h4><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631447.png\" alt=\"img\"></p>\n<p>P：生产者，向Exchange发送消息，发送消息时，会指定一个routing key。</p>\n<p>X：Exchange（交换机），接收生产者的消息，然后把消息递交给 与routing key完全匹配的队列</p>\n<p>C1：消费者，其所在队列指定了需要routing key 为 error 的消息</p>\n<p>C2：消费者，其所在队列指定了需要routing key 为 info、error、warning 的消息</p>\n<p>接下来看代码：</p>\n<h5 id=\"生产者-1\"><a href=\"#生产者-1\" class=\"headerlink\" title=\"生产者\"></a>生产者</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.routing;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * routing路由模式 交换机类型为direct</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:15</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Producer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明exchange,指明类型为direct</span></span><br><span class=\"line\">        channel.exchangeDeclare(Constant.DIRECT_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class=\"line\">        <span class=\"comment\">// 消息内容</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;注册成功！请短息回复[T]退订&quot;</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 发送消息，并指定routing key 为sms，只有短信服务才能接受该消息</span></span><br><span class=\"line\">        channel.basicPublish(Constant.DIRECT_EXCHANGE, <span class=\"string\">&quot;sms&quot;</span>, <span class=\"literal\">null</span>, message.getBytes());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        RabbitMQUtil.close(channel, connection);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者1\"><a href=\"#消费者1\" class=\"headerlink\" title=\"消费者1\"></a>消费者1</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.routing;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * routing key路由模式 exchange type: direct</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:23</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer1</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;direct_exchange_queue_sms&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 绑定交换机,同时指定需要指定的routing key,可以同时指定多个</span></span><br><span class=\"line\">        channel.queueBind(QUEUE, Constant.DIRECT_EXCHANGE, <span class=\"string\">&quot;sms&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [短信服务] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">// 监听队列，自动ACK</span></span><br><span class=\"line\">        channel.basicConsume(QUEUE, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者2\"><a href=\"#消费者2\" class=\"headerlink\" title=\"消费者2\"></a>消费者2</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.routing;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * routing key路由模式 exchange type: direct</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:23</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer2</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;direct_exchange_queue_email&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 绑定交换机,同时指定需要指定的routing key,可以同时指定多个</span></span><br><span class=\"line\">        channel.queueBind(QUEUE, Constant.DIRECT_EXCHANGE, <span class=\"string\">&quot;email&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [邮件服务] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">// 监听队列，自动ACK</span></span><br><span class=\"line\">        channel.basicConsume(QUEUE, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们发送sms的RoutingKey，发现结果：只有指定短信的消费者1收到消息了</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631537.png\" alt=\"image-20220106173229176\"></p>\n<h4 id=\"4-6-3-Topics-通配符模式（交换机类型：topics）\"><a href=\"#4-6-3-Topics-通配符模式（交换机类型：topics）\" class=\"headerlink\" title=\"4.6.3 Topics 通配符模式（交换机类型：topics）\"></a>4.6.3 Topics 通配符模式（交换机类型：topics）</h4><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631892.png\" alt=\"img\"></p>\n<p> 每个消费者监听自己的队列，并且设置带统配符的routingkey,生产者将消息发给broker，由交换机根据routingkey来转发消息到指定的队列。</p>\n<p>Routingkey一般都是有一个或者多个单词组成，多个单词之间以“.”分割，例如：inform.sms</p>\n<p>通配符规则：</p>\n<p>#：匹配一个或多个词</p>\n<p>*：匹配不多不少恰好1个词</p>\n<p>举例：</p>\n<p>audit.#：能够匹配audit.irs.corporate 或者 audit.irs</p>\n<p>audit.*：只能匹配audit.irs</p>\n<p>从示意图可知，我们将发送所有描述动物的消息。消息将使用由三个字（两个点）组成的Routing key发送。路由关键字中的第一个单词将描述速度，第二个颜色和第三个种类：“<speed>.<color>.<species>”。</p>\n<p>我们创建了三个绑定：Q1绑定了“*.orange.<em>”，Q2绑定了“.</em>.*.rabbit”和“lazy.＃”。</p>\n<p>Q1匹配所有的橙色动物。</p>\n<p>Q2匹配关于兔子以及懒惰动物的消息。</p>\n<p> 下面做个小练习，假如生产者发送如下消息，会进入哪个队列：</p>\n<p>quick.orange.rabbit       Q1 Q2   routingKey=”quick.orange.rabbit”的消息会同时路由到Q1与Q2</p>\n<p>lazy.orange.elephant    Q1 Q2</p>\n<p>quick.orange.fox           Q1</p>\n<p>lazy.pink.rabbit              Q2  (值得注意的是，虽然这个routingKey与Q2的两个bindingKey都匹配，但是只会投递Q2一次)</p>\n<p>quick.brown.fox            不匹配任意队列，被丢弃</p>\n<p>quick.orange.male.rabbit   不匹配任意队列，被丢弃</p>\n<p>orange         不匹配任意队列，被丢弃</p>\n<p>下面我们以指定Routing key=”quick.orange.rabbit”为例，验证上面的答案</p>\n<h5 id=\"生产者-2\"><a href=\"#生产者-2\" class=\"headerlink\" title=\"生产者\"></a>生产者</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.topics;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * topics模式</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:41</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Producer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明exchange，指定类型为topic</span></span><br><span class=\"line\">        channel.exchangeDeclare(Constant.TOPIC_EXCHANGE, BuiltinExchangeType.TOPIC);</span><br><span class=\"line\">        <span class=\"comment\">// 消息内容</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;这是一只行动迅速的橙色的兔子&quot;</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 发送消息，并且指定routing key为：quick.orange.rabbit</span></span><br><span class=\"line\">        channel.basicPublish(Constant.TOPIC_EXCHANGE, <span class=\"string\">&quot;quick.orange.rabbit&quot;</span>, <span class=\"literal\">null</span>, message.getBytes());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [动物描述：] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        RabbitMQUtil.close(channel, connection);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者1-1\"><a href=\"#消费者1-1\" class=\"headerlink\" title=\"消费者1\"></a>消费者1</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.topics;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * topics模式</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:46</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer1</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;topic_exchange_queue_Q1&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE_NAME, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 绑定队列到交换机，同时指定需要订阅的routing key。订阅所有的橙色动物</span></span><br><span class=\"line\">        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, <span class=\"string\">&quot;*.orange.*&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [消费者1] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">// 监听队列，自动ACK</span></span><br><span class=\"line\">        channel.basicConsume(QUEUE_NAME, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者2-1\"><a href=\"#消费者2-1\" class=\"headerlink\" title=\"消费者2\"></a>消费者2</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.topics;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * topics模式</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:46</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer2</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;topic_exchange_queue_Q2&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE_NAME, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 绑定队列到交换机，同时指定需要订阅的routing key。订阅关于兔子以及懒惰动物的消息</span></span><br><span class=\"line\">        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, <span class=\"string\">&quot;*.*.rabbit&quot;</span>);</span><br><span class=\"line\">        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, <span class=\"string\">&quot;lazy.＃&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [消费者2] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">// 监听队列，自动ACK</span></span><br><span class=\"line\">        channel.basicConsume(QUEUE_NAME, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>结果C1、C2是都接收到消息了：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631828.png\" alt=\"image-20220106175843295\"></p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191632611.png\" alt=\"image-20220106175904638\"></p>\n<h4 id=\"4-6-3-RPC\"><a href=\"#4-6-3-RPC\" class=\"headerlink\" title=\"4.6.3 RPC\"></a>4.6.3 RPC</h4><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191632340.png\" alt=\"img\"></p>\n<p>基本概念：</p>\n<p>Callback queue 回调队列，客户端向服务器发送请求，服务器端处理请求后，将其处理结果保存在一个存储体中。而客户端为了获得处理结果，那么客户在向服务器发送请求时，同时发送一个回调队列地址reply_to。</p>\n<p>Correlation id 关联标识，客户端可能会发送多个请求给服务器，当服务器处理完后，客户端无法辨别在回调队列中的响应具体和那个请求时对应的。为了处理这种情况，客户端在发送每个请求时，同时会附带一个独有correlation_id属性，这样客户端在回调队列中根据correlation_id字段的值就可以分辨此响应属于哪个请求。</p>\n<p>流程说明：</p>\n<p>当客户端启动的时候，它创建一个匿名独享的回调队列。<br>在 RPC 请求中，客户端发送带有两个属性的消息：一个是设置回调队列的 reply_to 属性，另一个是设置唯一值的 correlation_id 属性。<br>将请求发送到一个 rpc_queue 队列中。<br>服务器等待请求发送到这个队列中来。当请求出现的时候，它执行他的工作并且将带有执行结果的消息发送给 reply_to 字段指定的队列。<br>客户端等待回调队列里的数据。当有消息出现的时候，它会检查 correlation_id 属性。如果此属性的值与请求匹配，将它返回给应用</p>\n<h3 id=\"5-面试题\"><a href=\"#5-面试题\" class=\"headerlink\" title=\"5 面试题\"></a>5 面试题</h3><p>面试题：</p>\n<p>避免消息堆积？</p>\n<p>1） 采用workqueue，多个消费者监听同一队列。</p>\n<p>2）接收到消息以后，而是通过线程池，异步消费。</p>\n<p>如何避免消息丢失？</p>\n<p>1） 消费者的ACK机制。可以防止消费者丢失消息。</p>\n<p>但是，如果在消费者消费之前，MQ就宕机了，消息就没了？</p>\n<p>2）可以将消息进行持久化。要将消息持久化，前提是：队列、Exchange都持久化</p>\n<p>交换机持久化<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191632563.png\" alt=\"img\"><br>队列持久化<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191632941.png\" alt=\"img\"><br>消息持久化<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191632365.png\" alt=\"img\"></p>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"1-MQ引言\"><a href=\"#1-MQ引言\" class=\"headerlink\" title=\"1 MQ引言\"></a>1 MQ引言</h2><blockquote>\n<p>参考 <a href=\"https://blog.csdn.net/unique_perfect/article/details/109380996\">https://blog.csdn.net/unique_perfect/article/details/109380996</a></p>\n</blockquote>\n<h3 id=\"1-1-什么是MQ\"><a href=\"#1-1-什么是MQ\" class=\"headerlink\" title=\"1.1 什么是MQ\"></a>1.1 什么是MQ</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MQ(Message Quene) :  翻译为消息队列,通过典型的生产者</span><br><span class=\"line\">和消费者模型,生产者不断向消息队列中生产消息，消费者</span><br><span class=\"line\">不断的从队列中获取消息。因为消息的生产和消费都是异</span><br><span class=\"line\">步的，而且只关心消息的发送和接收，没有业务逻辑的侵</span><br><span class=\"line\">入,轻松的实现系统间解耦。别名为 消息中间件通过利用</span><br><span class=\"line\">高效可靠的消息传递机制进行平台无关的数据交流，并</span><br><span class=\"line\">基于数据通信来进行分布式系统的集成。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-2-MQ有哪些\"><a href=\"#1-2-MQ有哪些\" class=\"headerlink\" title=\"1.2 MQ有哪些\"></a>1.2 MQ有哪些</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">当今市面上有很多主流的消息中间件，如老牌的ActiveMQ、</span><br><span class=\"line\">RabbitMQ，炙手可热的Kafka，阿里巴巴自主开发RocketMQ等。</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"1-3-不同MQ特点\"><a href=\"#1-3-不同MQ特点\" class=\"headerlink\" title=\"1.3 不同MQ特点\"></a>1.3 不同MQ特点</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.ActiveMQ</span><br><span class=\"line\">\t\tActiveMQ 是Apache出品，最流行的，能力强劲的开源</span><br><span class=\"line\">\t\t消息总线。它是一个完全支持JMS规范的的消息中间件。</span><br><span class=\"line\">\t\t丰富的API,多种集群架构模式让ActiveMQ在业界成为老</span><br><span class=\"line\">\t\t牌的消息中间件,在中小型企业 颇受欢迎!</span><br><span class=\"line\"></span><br><span class=\"line\">2.Kafka</span><br><span class=\"line\">\t\tKafka是LinkedIn开源的分布式发布-订阅消息系统，目</span><br><span class=\"line\">\t\t前归属于Apache顶级项目。Kafka主要特点是基于Pull</span><br><span class=\"line\">\t\t的模式来处理消息消费，追求高吞吐量，一开始的目的</span><br><span class=\"line\">\t\t就是用于日志收集和传输。0.8版本开始支持复制，不支</span><br><span class=\"line\">\t\t持事务，对消息的重复、丢失、错误没有严格要求，</span><br><span class=\"line\">\t\t适合产生大量数据的互联网服务的数据收集业务。</span><br><span class=\"line\"></span><br><span class=\"line\">3.RocketMQ</span><br><span class=\"line\">\t\tRocketMQ是阿里开源的消息中间件，它是纯Java开发，</span><br><span class=\"line\">\t\t具有高吞吐量、高可用性、适合大规模分布式系统应用</span><br><span class=\"line\">\t\t的特点。RocketMQ思路起源于Kafka，但并不是Kafka</span><br><span class=\"line\">\t\t的一个Copy，它对消息的可靠传输及事务性做了优化，</span><br><span class=\"line\">\t\t目前在阿里集团被广泛应用于交   易、充值、流计算、</span><br><span class=\"line\">\t\t消息推送、日志流式处理、binglog分发等场景。</span><br><span class=\"line\"></span><br><span class=\"line\">4.RabbitMQ</span><br><span class=\"line\">\t\tRabbitMQ是使用Erlang语言开发的开源消息队列系统，</span><br><span class=\"line\">\t\t基于AMQP协议来实现。AMQP的主要特征是面向消息、</span><br><span class=\"line\">\t\t队列、路由（包括点对点和发布/订阅）、可靠性、安全。</span><br><span class=\"line\">\t\tAMQP协议更多用在企业系统内对数据一致性、稳定性和</span><br><span class=\"line\">\t\t可靠性要求很高的场景，对性能和吞吐量的要求还在</span><br><span class=\"line\">\t\t其次。</span><br><span class=\"line\"></span><br><span class=\"line\">RabbitMQ比Kafka可靠，Kafka更适合IO高吞吐的处理，一般应用</span><br><span class=\"line\">在大数据日志处理或对实时性（少量延迟），可靠性（少量丢数据）</span><br><span class=\"line\">要求稍低的场景使用，比如ELK日志收集。\t\t</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-RabbitMQ-的引言\"><a href=\"#2-RabbitMQ-的引言\" class=\"headerlink\" title=\"2 RabbitMQ 的引言\"></a>2 RabbitMQ 的引言</h2><h3 id=\"2-1-RabbitMQ\"><a href=\"#2-1-RabbitMQ\" class=\"headerlink\" title=\"2.1 RabbitMQ\"></a>2.1 RabbitMQ</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">基于AMQP协议，erlang语言开发，是部署最广泛的开源</span><br><span class=\"line\">消息中间件,是最受欢迎的开源消息中间件之一。</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191626795.png\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">AMQP 协议</span><br><span class=\"line\"> \tAMQP（advanced message queuing protocol）在2003年</span><br><span class=\"line\"> \t时被提出，最早用于解决金融领不同平台之间的消息传递</span><br><span class=\"line\"> \t交互问题。顾名思义，AMQP是一种协议，更准确的说是</span><br><span class=\"line\"> \t一种binary wire-level protocol（链接协议）。这是其和</span><br><span class=\"line\"> \tJMS的本质差别，AMQP不从API层进行限定，而是直接</span><br><span class=\"line\"> \t定义网络交换的数据格式。这使得实现了AMQP的</span><br><span class=\"line\"> \tprovider天然性就是跨平台的。以下是AMQP协议模型:</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191627854.png\" alt=\"image-20211115164234247\"></p>\n<h3 id=\"2-2-RabbitMQ-的安装\"><a href=\"#2-2-RabbitMQ-的安装\" class=\"headerlink\" title=\"2.2 RabbitMQ 的安装\"></a>2.2 RabbitMQ 的安装</h3><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">最新版的3.8版本的可以看我这篇文章</span><br><span class=\"line\">https://blog.csdn.net/unique_perfect/article/details/108643804</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"2-2-1-下载\"><a href=\"#2-2-1-下载\" class=\"headerlink\" title=\"2.2.1 下载\"></a>2.2.1 下载</h4><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191627315.png\" alt=\"在这里插入图片描述\"></p>\n<p><code>注意:这里的安装包是centos7安装的包</code></p>\n<h4 id=\"2-2-3-安装步骤\"><a href=\"#2-2-3-安装步骤\" class=\"headerlink\" title=\"2.2.3 安装步骤\"></a>2.2.3 安装步骤</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 1.将rabbitmq安装包上传到linux系统中</span><br><span class=\"line\">\terlang-22.0.7-1.el7.x86_64.rpm  #l7表示是Centosl7,Centosl8表示Centos8</span><br><span class=\"line\">\trabbitmq-server-3.7.18-1.el7.noarch.rpm</span><br><span class=\"line\"></span><br><span class=\"line\"># 2.安装Erlang依赖包</span><br><span class=\"line\">\trpm -ivh erlang-22.0.7-1.el7.x86_64.rpm</span><br><span class=\"line\"></span><br><span class=\"line\"># 3.安装RabbitMQ安装包(需要联网)</span><br><span class=\"line\">\tyum install -y rabbitmq-server-3.7.18-1.el7.noarch.rpm</span><br><span class=\"line\">\t注意:默认安装完成后配置文件模板在:/usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example目录中,需要\t</span><br><span class=\"line\">\t将配置文件复制到/etc/rabbitmq/目录中,并修改名称为rabbitmq.config</span><br><span class=\"line\"># 4.复制配置文件</span><br><span class=\"line\">\tcp /usr/share/doc/rabbitmq-server-3.7.18/rabbitmq.config.example /etc/rabbitmq/rabbitmq.config</span><br><span class=\"line\"></span><br><span class=\"line\"># 5.查看配置文件位置</span><br><span class=\"line\">\tls /etc/rabbitmq/rabbitmq.config</span><br><span class=\"line\"></span><br><span class=\"line\"># 6.修改配置文件(参见下图:)</span><br><span class=\"line\">\tvim /etc/rabbitmq/rabbitmq.config </span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191627769.png\" alt=\"image-20211115164655058\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">将上图中配置文件中红色部分去掉`%%`,以及最后的`,`逗号 </span><br><span class=\"line\">修改为下图:</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191627998.png\" alt=\"image-20211115164726573\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">`或者这两行的注释放开` 不能版本配置文件有差异</span><br><span class=\"line\">loopback_users.guest = true</span><br><span class=\"line\">loopback_users.guest = false</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 7.执行如下命令,启动rabbitmq中的插件管理</span><br><span class=\"line\">\trabbitmq-plugins enable rabbitmq_management</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t出现如下说明:</span><br><span class=\"line\">\t\tEnabling plugins on node rabbit@localhost:</span><br><span class=\"line\">    rabbitmq_management</span><br><span class=\"line\">    The following plugins have been configured:</span><br><span class=\"line\">      rabbitmq_management</span><br><span class=\"line\">      rabbitmq_management_agent</span><br><span class=\"line\">      rabbitmq_web_dispatch</span><br></pre></td></tr></table></figure>\n\n<pre><code>The following plugins have been enabled:\n  rabbitmq_management\n  rabbitmq_management_agent\n  rabbitmq_web_dispatch\n\nset 3 plugins.\nOffline change; changes will take effect at broker restart.\n</code></pre>\n<h1 id=\"8-启动RabbitMQ的服务\"><a href=\"#8-启动RabbitMQ的服务\" class=\"headerlink\" title=\"8.启动RabbitMQ的服务\"></a>8.启动RabbitMQ的服务</h1><pre><code>systemctl start rabbitmq-server\nsystemctl restart rabbitmq-server\nsystemctl stop rabbitmq-server\n</code></pre>\n<h1 id=\"9-查看服务状态-见下图\"><a href=\"#9-查看服务状态-见下图\" class=\"headerlink\" title=\"9.查看服务状态(见下图:)\"></a>9.查看服务状态(见下图:)</h1><pre><code>systemctl status rabbitmq-server\n</code></pre>\n<p>  ● rabbitmq-server.service - RabbitMQ broker<br>     Loaded: loaded (/usr/lib/systemd/system/rabbitmq-server.service; disabled; vendor preset: disabled)<br>     Active: active (running) since 三 2019-09-25 22:26:35 CST; 7s ago<br>   Main PID: 2904 (beam.smp)<br>     Status: “Initialized”<br>     CGroup: /system.slice/rabbitmq-server.service<br>             ├─2904 /usr/lib64/erlang/erts-10.4.4/bin/beam.smp -W w -A 64 -MBas ageffcbf -MHas ageffcbf -<br>             MBlmbcs…<br>             ├─3220 erl_child_setup 32768<br>             ├─3243 inet_gethost 4<br>             └─3244 inet_gethost 4<br>      ………</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![image-20211115164952765](https://raw.githubusercontent.com/xzyup/image/master/202203191627665.png)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"10-关闭防火墙服务\"><a href=\"#10-关闭防火墙服务\" class=\"headerlink\" title=\"10.关闭防火墙服务\"></a>10.关闭防火墙服务</h1><pre><code>systemctl disable firewalld  # 需要关闭防火墙，否则访问不了\nRemoved symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.\nRemoved symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.\nsystemctl stop firewalld   \n</code></pre>\n<h1 id=\"11-访问web管理界面\"><a href=\"#11-访问web管理界面\" class=\"headerlink\" title=\"11.访问web管理界面\"></a>11.访问web管理界面</h1><pre><code>http://10.15.0.8:15672/\n</code></pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191627468.png)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"12-登录管理界面\"><a href=\"#12-登录管理界面\" class=\"headerlink\" title=\"12.登录管理界面\"></a>12.登录管理界面</h1><pre><code>username:  guest\npassword:  guest\n</code></pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![在这里插入图片描述](https://raw.githubusercontent.com/xzyup/image/master/202203191628472.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## 3 RabiitMQ 配置</span><br><span class=\"line\"></span><br><span class=\"line\">### 3.1 RabbitMQ 管理命令行</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"1-服务启动相关\"><a href=\"#1-服务启动相关\" class=\"headerlink\" title=\"1.服务启动相关\"></a>1.服务启动相关</h1><pre><code>systemctl start|restart|stop|status rabbitmq-server\n</code></pre>\n<h1 id=\"2-管理命令行-用来在不使用web管理界面情况下命令操作RabbitMQ\"><a href=\"#2-管理命令行-用来在不使用web管理界面情况下命令操作RabbitMQ\" class=\"headerlink\" title=\"2.管理命令行  用来在不使用web管理界面情况下命令操作RabbitMQ\"></a>2.管理命令行  用来在不使用web管理界面情况下命令操作RabbitMQ</h1><pre><code>rabbitmqctl  help  可以查看更多命令\n</code></pre>\n<h1 id=\"3-插件管理命令行\"><a href=\"#3-插件管理命令行\" class=\"headerlink\" title=\"3.插件管理命令行\"></a>3.插件管理命令行</h1><pre><code>rabbitmq-plugins enable|list|disable \n</code></pre>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">### 3.2 web管理界面介绍</span><br><span class=\"line\"></span><br><span class=\"line\">#### 3.2.1 overview概览</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115165516989](https://raw.githubusercontent.com/xzyup/image/master/202203191628049.png)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>connections：无论生产者还是消费者，都需要与RabbitMQ建立连接后才<br>可以完成消息的生产和消费，在这里可以查看连接情况`</p>\n<p>channels：通道，建立连接后，会形成通道，消息的投递获取依赖通道。</p>\n<p>Exchanges：交换机，用来实现消息的路由</p>\n<p>Queues：队列，即消息队列，消息存放在队列中，等待消费，<br>消费后被移除队列。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">#### 3.2.2 Admin用户和虚拟主机管理</span><br><span class=\"line\"></span><br><span class=\"line\">##### 3.2.2.1 添加用户</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115165811824](https://raw.githubusercontent.com/xzyup/image/master/202203191628829.png)</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>上面的Tags选项，其实是指定用户的角色，可选的有以下几个：</p>\n<p>超级管理员(administrator)</p>\n<p>可登陆管理控制台，可查看所有的信息，并且可以对用户，<br>策略(policy)进行操作。</p>\n<p>监控者(monitoring)</p>\n<p>可登陆管理控制台，同时可以查看rabbitmq节点的相关信息<br>(进程数，内存使用情况，磁盘使用情况等)</p>\n<p>策略制定者(policymaker)</p>\n<p>可登陆管理控制台, 同时可以对policy进行管理。但无法查看节点的<br>相关信息(上图红框标识的部分)。</p>\n<p>普通管理者(management)</p>\n<p>仅可登陆管理控制台，无法看到节点信息，也无法对策略进行管理。</p>\n<p>其他</p>\n<p>无法登陆管理控制台，通常就是普通的生产者和消费者。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">##### 3.2.2.2 创建虚拟主机</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>虚拟主机<br>为了让各个用户可以互不干扰的工作，RabbitMQ添加了<br>虚拟主机（Virtual Hosts）的概念。其实就是一个独立的<br>访问路径，不同用户使用不同路径，各自有自己的<br>队列、交换机，互相不会影响。相当于关系型中的数据库</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![image-20211115165945088](https://raw.githubusercontent.com/xzyup/image/master/202203191628947.png)</span><br><span class=\"line\"></span><br><span class=\"line\">##### 3.2.2.3 绑定虚拟主机和用户</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>创建好虚拟主机，我们还要给用户添加访问权限：</p>\n<p>点击添加好的虚拟主机：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">![image-20211115170056567](https://raw.githubusercontent.com/xzyup/image/master/202203191628593.png)</span><br><span class=\"line\"></span><br><span class=\"line\">`进入虚拟机设置界面`</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115172528979](https://raw.githubusercontent.com/xzyup/image/master/202203191629415.png)</span><br><span class=\"line\"></span><br><span class=\"line\">## 4 RabbitMQ 的第一个程序</span><br><span class=\"line\"></span><br><span class=\"line\">### 4.1 AMQP协议的回顾</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115173046680](https://raw.githubusercontent.com/xzyup/image/master/202203191629621.png)</span><br><span class=\"line\"></span><br><span class=\"line\">### 4.2 RabbitMQ支持的消息模型</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115173136189](https://raw.githubusercontent.com/xzyup/image/master/202203191629497.png)</span><br><span class=\"line\"></span><br><span class=\"line\">![image-20211115173209816](https://raw.githubusercontent.com/xzyup/image/master/202203191629518.png)</span><br><span class=\"line\"></span><br><span class=\"line\">### 4.3 引入依赖</span><br><span class=\"line\"></span><br><span class=\"line\">~~~xml</span><br><span class=\"line\">&lt;dependency&gt;</span><br><span class=\"line\">    &lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;</span><br><span class=\"line\">    &lt;artifactId&gt;amqp-client&lt;/artifactId&gt;</span><br><span class=\"line\">    &lt;version&gt;5.7.2&lt;/version&gt;</span><br><span class=\"line\">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-4-第一种模型-直连\"><a href=\"#4-4-第一种模型-直连\" class=\"headerlink\" title=\"4.4 第一种模型(直连)\"></a>4.4 第一种模型(直连)</h3><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191629336.png\" alt=\"在这里插入图片描述\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在上图的模型中，有以下概念：</span><br><span class=\"line\"></span><br><span class=\"line\">P：生产者，也就是要发送消息的程序</span><br><span class=\"line\">C：消费者：消息的接受者，会一直等待消息到来。</span><br><span class=\"line\">queue：消息队列，图中红色部分。类似一个邮箱，</span><br><span class=\"line\">可以缓存消息；生产者向其中投递消息，消费者从其中取出消息。</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-4-1-开发生产者\"><a href=\"#4-4-1-开发生产者\" class=\"headerlink\" title=\"4.4.1 开发生产者\"></a>4.4.1 开发生产者</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.direct;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 第一种模型(直连)</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2021-11-15 17:39</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Producer</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取连接</span></span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 创建通道、生产者和mq服务所有通信都在channel中完成</span></span><br><span class=\"line\">            channel = connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             *  声明 direct 直连队列</span></span><br><span class=\"line\"><span class=\"comment\">             *  1. queue 队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             *  2. durable 队列是否持久化，mq重启队列还在，不会保证消息的持久化</span></span><br><span class=\"line\"><span class=\"comment\">             *  3. exclusive 是否独占连接，队列只允许在连接中访问，如果连接关闭则队列无法</span></span><br><span class=\"line\"><span class=\"comment\">             *  访问,如果将此参数设置为true可以用于临时队列的创建</span></span><br><span class=\"line\"><span class=\"comment\">             *  4. autoDelete 自动删除,及队列不在使用时自动删除，一般消费者消费完成ACK确认后，</span></span><br><span class=\"line\"><span class=\"comment\">             *  生产消费都断开了连接后，队列自动删除，</span></span><br><span class=\"line\"><span class=\"comment\">             *  5. 参数，可以设置队列的扩展属性，比如：可设置存活时间等</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.queueDeclare(Constant.DIRECT_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>,</span><br><span class=\"line\">                    <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">             * 发布消息</span></span><br><span class=\"line\"><span class=\"comment\">             * 1. exchange 交换机</span></span><br><span class=\"line\"><span class=\"comment\">             * 2. routingKey 路由key，交换机根据key将消息转发到指定队列，如果使用默认交换机</span></span><br><span class=\"line\"><span class=\"comment\">             * 则key就是队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             * 3. props 消息属性，可以设置消息为可持久化，MessageProperties.PERSISTENT_TEXT_PLAIN</span></span><br><span class=\"line\"><span class=\"comment\">             * 4. body 消息内容</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, Constant.DIRECT_QUEUE, <span class=\"literal\">null</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;hello world&quot;</span>.getBytes());</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 关闭通道和连接</span></span><br><span class=\"line\">            RabbitMQUtil.close(channel, connection);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-4-2-开发消费者\"><a href=\"#4-4-2-开发消费者\" class=\"headerlink\" title=\"4.4.2 开发消费者\"></a>4.4.2 开发消费者</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.direct;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.*;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 第一种模型(直连)</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2021-11-15 22:43</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            channel = connection.createChannel();</span><br><span class=\"line\">            channel.queueDeclare(Constant.DIRECT_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * 参数明细：</span></span><br><span class=\"line\"><span class=\"comment\">             * 1、queue 队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，</span></span><br><span class=\"line\"><span class=\"comment\">             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复</span></span><br><span class=\"line\"><span class=\"comment\">             * 3、callback，消费方法，当消费者接收到消息要执行的方法</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.basicConsume(Constant.DIRECT_QUEUE, <span class=\"literal\">true</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">                 * 当接收到消息后此方法将被调用</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> consumerTag  消费者标签，用来标识消费者的，</span></span><br><span class=\"line\"><span class=\"comment\">                 *        在监听队列时设置channel.basicConsume</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> envelope 信封，通过envelope</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> properties 消息属性</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> body 消息内容</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@throws</span> IOException</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                           <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// key,本例即队列名称</span></span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">routingKey</span> <span class=\"operator\">=</span> envelope.getRoutingKey();</span><br><span class=\"line\">                    <span class=\"comment\">// 交换机</span></span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">exchange</span> <span class=\"operator\">=</span> envelope.getExchange();</span><br><span class=\"line\">                    <span class=\"comment\">// 消息id，mq在channel中用来标识消息的id，可用于确认消息已接收</span></span><br><span class=\"line\">                    <span class=\"type\">long</span> <span class=\"variable\">deliveryTag</span> <span class=\"operator\">=</span> envelope.getDeliveryTag();</span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body, <span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">                    System.out.printf(<span class=\"string\">&quot;routingKey:%s,exchange:%s,deliveryTag:%s,body:%s&quot;</span>, routingKey,</span><br><span class=\"line\">                            exchange, deliveryTag, msg);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// RabbitMQUtil.close(channel, connection);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-5-第二种模型-working-queque\"><a href=\"#4-5-第二种模型-working-queque\" class=\"headerlink\" title=\"4.5 第二种模型(working queque)\"></a>4.5 第二种模型(working queque)</h3><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630397.png\" alt=\"img\"></p>\n<p>这种模式叫工作队列或者<strong>竞争消费者</strong>模式。</p>\n<p>Working queues与入门程序相比，多了一个消费端，两个消费端共同消费同一个队列中的消息，但是<strong>一个消息只能被一个消费者获取</strong>。</p>\n<p>这个消息模型在Web应用程序中特别有用，可以处理短的HTTP请求窗口中无法处理复杂的任务。</p>\n<p>接下来我们来模拟这个流程：</p>\n<p>P：生产者：任务的发布者</p>\n<p>C1：消费者1：领取任务并且完成任务，假设完成速度较慢（模拟耗时）</p>\n<p>C2：消费者2：领取任务并且完成任务，假设完成速度较快</p>\n<h4 id=\"4-5-1-生成者\"><a href=\"#4-5-1-生成者\" class=\"headerlink\" title=\"4.5.1 生成者\"></a>4.5.1 生成者</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.wokerqueue;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * working queue 生产者</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 15:16</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Producer</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取连接</span></span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 创建通道、生产者和mq服务所有通信都在channel中完成</span></span><br><span class=\"line\">            channel = connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             *  声明 direct 直连队列</span></span><br><span class=\"line\"><span class=\"comment\">             *  1. queue 队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             *  2. durable 队列是否持久化，mq重启队列还在，不会保证消息的持久化</span></span><br><span class=\"line\"><span class=\"comment\">             *  3. exclusive 是否独占连接，队列只允许在连接中访问，如果连接关闭则队列无法</span></span><br><span class=\"line\"><span class=\"comment\">             *  访问,如果将此参数设置为true可以用于临时队列的创建</span></span><br><span class=\"line\"><span class=\"comment\">             *  4. autoDelete 自动删除,及队列不在使用时自动删除，一般消费者消费完成ACK确认后，</span></span><br><span class=\"line\"><span class=\"comment\">             *  生产消费都断开了连接后，队列自动删除，</span></span><br><span class=\"line\"><span class=\"comment\">             *  5. 参数，可以设置队列的扩展属性，比如：可设置存活时间等</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.queueDeclare(Constant.WORKING_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>,</span><br><span class=\"line\">                    <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * 发布消息</span></span><br><span class=\"line\"><span class=\"comment\">             * 1. exchange 交换机</span></span><br><span class=\"line\"><span class=\"comment\">             * 2. routingKey 路由key，交换机根据key将消息转发到指定队列，如果使用默认交换机</span></span><br><span class=\"line\"><span class=\"comment\">             * 则key就是队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             * 3. props 消息属性，可以设置消息为可持久化，MessageProperties.PERSISTENT_TEXT_PLAIN</span></span><br><span class=\"line\"><span class=\"comment\">             * 4. body 消息内容</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">50</span>; i++) &#123;</span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;working queue message: &quot;</span> + i;</span><br><span class=\"line\">                channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, Constant.WORKING_QUEUE, <span class=\"literal\">null</span>,</span><br><span class=\"line\">                        message.getBytes());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 关闭通道和连接</span></span><br><span class=\"line\">            RabbitMQUtil.close(channel, connection);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-5-2-消费者1\"><a href=\"#4-5-2-消费者1\" class=\"headerlink\" title=\"4.5.2 消费者1\"></a>4.5.2 消费者1</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.wokerqueue;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeUnit;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * working queue consumer one</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 15:22</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer1</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            channel = connection.createChannel();</span><br><span class=\"line\">            channel.queueDeclare(Constant.WORKING_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * 参数明细：</span></span><br><span class=\"line\"><span class=\"comment\">             * 1、queue 队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，</span></span><br><span class=\"line\"><span class=\"comment\">             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复</span></span><br><span class=\"line\"><span class=\"comment\">             * 3、callback，消费方法，当消费者接收到消息要执行的方法</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.basicConsume(Constant.WORKING_QUEUE, <span class=\"literal\">true</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">                 * 当接收到消息后此方法将被调用</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> consumerTag  消费者标签，用来标识消费者的，</span></span><br><span class=\"line\"><span class=\"comment\">                 *        在监听队列时设置channel.basicConsume</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> envelope 信封，通过envelope</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> properties 消息属性</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> body 消息内容</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@throws</span> IOException</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                           <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body, <span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot; [消费者1] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//模拟任务耗时1s</span></span><br><span class=\"line\">                    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                        TimeUnit.SECONDS.sleep(<span class=\"number\">1</span>);</span><br><span class=\"line\">                    &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">                        e.printStackTrace();</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// RabbitMQUtil.close(channel, connection);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"4-5-3-消费者2\"><a href=\"#4-5-3-消费者2\" class=\"headerlink\" title=\"4.5.3 消费者2\"></a>4.5.3 消费者2</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.wokerqueue;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * working queue consumer two</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 15:22</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer2</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            channel = connection.createChannel();</span><br><span class=\"line\">            channel.queueDeclare(Constant.WORKING_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">             * 参数明细：</span></span><br><span class=\"line\"><span class=\"comment\">             * 1、queue 队列名称</span></span><br><span class=\"line\"><span class=\"comment\">             * 2、autoAck 自动回复，当消费者接收到消息后要告诉mq消息已接收，</span></span><br><span class=\"line\"><span class=\"comment\">             * 如果将此参数设置为tru表示会自动回复mq，如果设置为false要通过编程实现回复</span></span><br><span class=\"line\"><span class=\"comment\">             * 3、callback，消费方法，当消费者接收到消息要执行的方法</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            channel.basicConsume(Constant.WORKING_QUEUE, <span class=\"literal\">true</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">                 * 当接收到消息后此方法将被调用</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> consumerTag  消费者标签，用来标识消费者的，</span></span><br><span class=\"line\"><span class=\"comment\">                 *        在监听队列时设置channel.basicConsume</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> envelope 信封，通过envelope</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> properties 消息属性</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@param</span> body 消息内容</span></span><br><span class=\"line\"><span class=\"comment\">                 * <span class=\"doctag\">@throws</span> IOException</span></span><br><span class=\"line\"><span class=\"comment\">                 */</span></span><br><span class=\"line\">                <span class=\"meta\">@Override</span></span><br><span class=\"line\">                <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                           <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                    <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body, <span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">                    System.out.println(<span class=\"string\">&quot; [消费者1] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">            <span class=\"comment\">// RabbitMQUtil.close(channel, connection);</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>与消费者1基本类似，只是消费者2没有设置消费耗时时间。</p>\n<p>接下来，两个消费者一同启动，然后生产者发送50条消息：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630026.png\" alt=\"image-20220106153336710\"></p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630579.png\" alt=\"image-20220106153405659\"></p>\n<p><strong>可以发现，两个消费者各自消费了不同25条消息，这就实现了任务的分发。</strong> </p>\n<h4 id=\"4-5-4-能者多劳\"><a href=\"#4-5-4-能者多劳\" class=\"headerlink\" title=\"4.5.4 能者多劳\"></a>4.5.4 能者多劳</h4><p>刚才的实现有问题吗？</p>\n<ul>\n<li>消费者1比消费者2的效率要低，一次任务的耗时较长</li>\n<li>然而两人最终消费的消息数量是一样的</li>\n<li>消费者2大量时间处于空闲状态，消费者1一直忙碌</li>\n</ul>\n<p>现在的状态属于是把任务平均分配，正确的做法应该是消费越快的人，消费的越多。</p>\n<p>怎么实现呢？</p>\n<p>通过 BasicQos 方法设置prefetchCount = 1。这样RabbitMQ就会使得每个Consumer在同一个时间点最多处理1个Message。换句话说，在接收到该Consumer的ack前，他它不会将新的Message分发给它。相反，它会将其分派给不是仍然忙碌的下一个Consumer。</p>\n<p><strong>值得注意的是：prefetchCount在手动ack的情况下才生效，自动ack不生效。</strong></p>\n<p>设置prefetchCount和手动ack代码如下：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">  <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">  <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">  channel.queueDeclare(Constant.WORKING_QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 设置每个消费者同时只能处理一条消息，手动ack下生效</span></span><br><span class=\"line\">  channel.basicQos(<span class=\"number\">1</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  channel.basicConsume(Constant.WORKING_QUEUE, <span class=\"literal\">false</span>, <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                               <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">      <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">      <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body, <span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">      System.out.println(<span class=\"string\">&quot; [消费者2] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">      channel.basicAck(envelope.getDeliveryTag(), <span class=\"literal\">false</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>再次测试：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630941.png\" alt=\"image-20220106155103949\"></p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630053.png\" alt=\"image-20220106155123303\"></p>\n<h3 id=\"4-6-第三种模型-订阅模型\"><a href=\"#4-6-第三种模型-订阅模型\" class=\"headerlink\" title=\"4.6 第三种模型(订阅模型)\"></a>4.6 第三种模型(订阅模型)</h3><p><strong>订阅模型分类</strong><br>说明下：</p>\n<p>1、一个生产者多个消费者<br>2、每个消费者都有一个自己的队列<br>3、生产者没有将消息直接发送给队列，而是发送给exchange(交换机、转发器)<br>4、每个队列都需要绑定到交换机上<br>5、生产者发送的消息，经过交换机到达队列，实现一个消息被多个消费者消费<br>例子：注册-&gt;发邮件、发短信</p>\n<p><strong>X（Exchanges）</strong>：交换机一方面：接收生产者发送的消息。另一方面：知道如何处理消息，例如递交给某个特别队列、递交给所有队列、或是将消息丢弃。到底如何操作，取决于Exchange的类型。</p>\n<p>Exchange类型有以下几种：</p>\n<p><strong>Fanout</strong>：广播，将消息交给所有绑定到交换机的队列</p>\n<p><strong>Direct</strong>：定向，把消息交给符合指定routing key 的队列</p>\n<p><strong>Topic</strong>：通配符，把消息交给符合routing pattern（路由模式） 的队列</p>\n<p><strong>Header</strong>：header模式与routing不同的地方在于，header模式取消routingkey，使用header中的 key/value（键值对）匹配队列。</p>\n<p>Header模式不展开了，感兴趣可以参考这篇文章<a href=\"https://blog.csdn.net/zhu_tianwei/article/details/40923131\">https://blog.csdn.net/zhu_tianwei/article/details/40923131</a></p>\n<p><strong>Exchange（交换机）只负责转发消息，不具备存储消息的能力，因此如果没有任何队列与Exchange绑定，或者没有符合路由规则的队列，那么消息会丢失！</strong></p>\n<h4 id=\"4-6-1-Publish-subcribe-交换机类型：fanout，也称广播\"><a href=\"#4-6-1-Publish-subcribe-交换机类型：fanout，也称广播\" class=\"headerlink\" title=\"4.6.1 Publish/subcribe(交换机类型：fanout，也称广播)\"></a>4.6.1 Publish/subcribe(交换机类型：fanout，也称广播)</h4><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191630971.png\" alt=\"img\"></p>\n<h5 id=\"生产者\"><a href=\"#生产者\" class=\"headerlink\" title=\"生产者\"></a>生产者</h5><p>和前面两种模式不同：</p>\n<ul>\n<li>1） 声明Exchange，不再声明Queue</li>\n<li>2） 发送消息到Exchange，不再发送到Queue</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.pubsub;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 订阅模式：pub/sub 生产者</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 16:11</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Producer</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.exchangeDeclare(Constant.FANOUT_EXCHANGE, <span class=\"string\">&quot;fanout&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;registration success&quot;</span>;</span><br><span class=\"line\">        channel.basicPublish(Constant.FANOUT_EXCHANGE, <span class=\"string\">&quot;&quot;</span>, <span class=\"literal\">null</span>, message.getBytes());</span><br><span class=\"line\"></span><br><span class=\"line\">        RabbitMQUtil.close(channel, connection);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者1-（注册成功发给短信服务）\"><a href=\"#消费者1-（注册成功发给短信服务）\" class=\"headerlink\" title=\"消费者1 （注册成功发给短信服务）\"></a>消费者1 （注册成功发给短信服务）</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.pubsub;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * pub/sub consumer1</span></span><br><span class=\"line\"><span class=\"comment\"> * 发送短信服务</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 16:48</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer1</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;fanout_exchange_queue_sms&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 定义队列消费者</span></span><br><span class=\"line\">        channel.queueBind(QUEUE, Constant.FANOUT_EXCHANGE, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [短信服务] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(QUEUE, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者2（注册成功发给邮件服务）\"><a href=\"#消费者2（注册成功发给邮件服务）\" class=\"headerlink\" title=\"消费者2（注册成功发给邮件服务）\"></a>消费者2（注册成功发给邮件服务）</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.pubsub;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * pub/sub consumer2</span></span><br><span class=\"line\"><span class=\"comment\"> * 发送邮件服务</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 16:48</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer2</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;fanout_exchange_queue_email&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 定义队列消费者</span></span><br><span class=\"line\">        channel.queueBind(QUEUE, Constant.FANOUT_EXCHANGE, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [邮件服务] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        channel.basicConsume(QUEUE, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们运行两个消费者，然后生成者发送1条消息：如果先运行消费者，可能出现exchange不存在的报错，可现在admin页面创建或者先运行生产者。</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631939.png\" alt=\"image-20220106171011803\"></p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631763.png\" alt=\"image-20220106171035697\"></p>\n<h5 id=\"思考\"><a href=\"#思考\" class=\"headerlink\" title=\"思考\"></a>思考</h5><p>1、publish/subscribe与work queues有什么区别。</p>\n<p>区别：</p>\n<p>1）work queues不用定义交换机，而publish/subscribe需要定义交换机。</p>\n<p>2）publish/subscribe的生产方是面向交换机发送消息，work queues的生产方是面向队列发送消息(底层使用默认交换机)。</p>\n<p>3）publish/subscribe需要设置队列和交换机的绑定，work queues不需要设置，实际上work queues会将队列绑定到默认的交换机 。</p>\n<p>相同点：</p>\n<p>所以两者实现的发布/订阅的效果是一样的，多个消费端监听同一个队列不会重复消费消息。</p>\n<p>2、实际工作用 publish/subscribe还是work queues。</p>\n<p>建议使用 publish/subscribe，发布订阅模式比工作队列模式更强大（也可以做到同一队列竞争），并且发布订阅模式可以指定自己专用的交换机。</p>\n<h4 id=\"4-6-2-Routing-路由模型（交换机类型：direct）\"><a href=\"#4-6-2-Routing-路由模型（交换机类型：direct）\" class=\"headerlink\" title=\"4.6.2 Routing 路由模型（交换机类型：direct）\"></a>4.6.2 Routing 路由模型（交换机类型：direct）</h4><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631447.png\" alt=\"img\"></p>\n<p>P：生产者，向Exchange发送消息，发送消息时，会指定一个routing key。</p>\n<p>X：Exchange（交换机），接收生产者的消息，然后把消息递交给 与routing key完全匹配的队列</p>\n<p>C1：消费者，其所在队列指定了需要routing key 为 error 的消息</p>\n<p>C2：消费者，其所在队列指定了需要routing key 为 info、error、warning 的消息</p>\n<p>接下来看代码：</p>\n<h5 id=\"生产者-1\"><a href=\"#生产者-1\" class=\"headerlink\" title=\"生产者\"></a>生产者</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.routing;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * routing路由模式 交换机类型为direct</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:15</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Producer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明exchange,指明类型为direct</span></span><br><span class=\"line\">        channel.exchangeDeclare(Constant.DIRECT_EXCHANGE, BuiltinExchangeType.DIRECT);</span><br><span class=\"line\">        <span class=\"comment\">// 消息内容</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;注册成功！请短息回复[T]退订&quot;</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 发送消息，并指定routing key 为sms，只有短信服务才能接受该消息</span></span><br><span class=\"line\">        channel.basicPublish(Constant.DIRECT_EXCHANGE, <span class=\"string\">&quot;sms&quot;</span>, <span class=\"literal\">null</span>, message.getBytes());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [x] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        RabbitMQUtil.close(channel, connection);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者1\"><a href=\"#消费者1\" class=\"headerlink\" title=\"消费者1\"></a>消费者1</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.routing;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * routing key路由模式 exchange type: direct</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:23</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer1</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;direct_exchange_queue_sms&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 绑定交换机,同时指定需要指定的routing key,可以同时指定多个</span></span><br><span class=\"line\">        channel.queueBind(QUEUE, Constant.DIRECT_EXCHANGE, <span class=\"string\">&quot;sms&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [短信服务] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">// 监听队列，自动ACK</span></span><br><span class=\"line\">        channel.basicConsume(QUEUE, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者2\"><a href=\"#消费者2\" class=\"headerlink\" title=\"消费者2\"></a>消费者2</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.routing;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * routing key路由模式 exchange type: direct</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:23</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer2</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;direct_exchange_queue_email&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 绑定交换机,同时指定需要指定的routing key,可以同时指定多个</span></span><br><span class=\"line\">        channel.queueBind(QUEUE, Constant.DIRECT_EXCHANGE, <span class=\"string\">&quot;email&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [邮件服务] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">// 监听队列，自动ACK</span></span><br><span class=\"line\">        channel.basicConsume(QUEUE, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>我们发送sms的RoutingKey，发现结果：只有指定短信的消费者1收到消息了</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631537.png\" alt=\"image-20220106173229176\"></p>\n<h4 id=\"4-6-3-Topics-通配符模式（交换机类型：topics）\"><a href=\"#4-6-3-Topics-通配符模式（交换机类型：topics）\" class=\"headerlink\" title=\"4.6.3 Topics 通配符模式（交换机类型：topics）\"></a>4.6.3 Topics 通配符模式（交换机类型：topics）</h4><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631892.png\" alt=\"img\"></p>\n<p> 每个消费者监听自己的队列，并且设置带统配符的routingkey,生产者将消息发给broker，由交换机根据routingkey来转发消息到指定的队列。</p>\n<p>Routingkey一般都是有一个或者多个单词组成，多个单词之间以“.”分割，例如：inform.sms</p>\n<p>通配符规则：</p>\n<p>#：匹配一个或多个词</p>\n<p>*：匹配不多不少恰好1个词</p>\n<p>举例：</p>\n<p>audit.#：能够匹配audit.irs.corporate 或者 audit.irs</p>\n<p>audit.*：只能匹配audit.irs</p>\n<p>从示意图可知，我们将发送所有描述动物的消息。消息将使用由三个字（两个点）组成的Routing key发送。路由关键字中的第一个单词将描述速度，第二个颜色和第三个种类：“<speed>.<color>.<species>”。</p>\n<p>我们创建了三个绑定：Q1绑定了“*.orange.<em>”，Q2绑定了“.</em>.*.rabbit”和“lazy.＃”。</p>\n<p>Q1匹配所有的橙色动物。</p>\n<p>Q2匹配关于兔子以及懒惰动物的消息。</p>\n<p> 下面做个小练习，假如生产者发送如下消息，会进入哪个队列：</p>\n<p>quick.orange.rabbit       Q1 Q2   routingKey=”quick.orange.rabbit”的消息会同时路由到Q1与Q2</p>\n<p>lazy.orange.elephant    Q1 Q2</p>\n<p>quick.orange.fox           Q1</p>\n<p>lazy.pink.rabbit              Q2  (值得注意的是，虽然这个routingKey与Q2的两个bindingKey都匹配，但是只会投递Q2一次)</p>\n<p>quick.brown.fox            不匹配任意队列，被丢弃</p>\n<p>quick.orange.male.rabbit   不匹配任意队列，被丢弃</p>\n<p>orange         不匹配任意队列，被丢弃</p>\n<p>下面我们以指定Routing key=”quick.orange.rabbit”为例，验证上面的答案</p>\n<h5 id=\"生产者-2\"><a href=\"#生产者-2\" class=\"headerlink\" title=\"生产者\"></a>生产者</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.topics;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.BuiltinExchangeType;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * topics模式</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:41</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Producer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明exchange，指定类型为topic</span></span><br><span class=\"line\">        channel.exchangeDeclare(Constant.TOPIC_EXCHANGE, BuiltinExchangeType.TOPIC);</span><br><span class=\"line\">        <span class=\"comment\">// 消息内容</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;这是一只行动迅速的橙色的兔子&quot;</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 发送消息，并且指定routing key为：quick.orange.rabbit</span></span><br><span class=\"line\">        channel.basicPublish(Constant.TOPIC_EXCHANGE, <span class=\"string\">&quot;quick.orange.rabbit&quot;</span>, <span class=\"literal\">null</span>, message.getBytes());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot; [动物描述：] Sent &#x27;&quot;</span> + message + <span class=\"string\">&quot;&#x27;&quot;</span>);</span><br><span class=\"line\">        RabbitMQUtil.close(channel, connection);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者1-1\"><a href=\"#消费者1-1\" class=\"headerlink\" title=\"消费者1\"></a>消费者1</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.topics;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * topics模式</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:46</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer1</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;topic_exchange_queue_Q1&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE_NAME, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 绑定队列到交换机，同时指定需要订阅的routing key。订阅所有的橙色动物</span></span><br><span class=\"line\">        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, <span class=\"string\">&quot;*.orange.*&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [消费者1] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">// 监听队列，自动ACK</span></span><br><span class=\"line\">        channel.basicConsume(QUEUE_NAME, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"消费者2-1\"><a href=\"#消费者2-1\" class=\"headerlink\" title=\"消费者2\"></a>消费者2</h5><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> demo.topics;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.AMQP;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.DefaultConsumer;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Envelope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> common.Constant;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> utils.RabbitMQUtil;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * topics模式</span></span><br><span class=\"line\"><span class=\"comment\"> *</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> xie.wei</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> created at 2022-01-06 17:46</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer2</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;topic_exchange_queue_Q2&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> RabbitMQUtil.getConnection();</span><br><span class=\"line\">        <span class=\"keyword\">final</span> <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 声明队列</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE_NAME, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 绑定队列到交换机，同时指定需要订阅的routing key。订阅关于兔子以及懒惰动物的消息</span></span><br><span class=\"line\">        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, <span class=\"string\">&quot;*.*.rabbit&quot;</span>);</span><br><span class=\"line\">        channel.queueBind(QUEUE_NAME, Constant.TOPIC_EXCHANGE, <span class=\"string\">&quot;lazy.＃&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 定义队列的消费者</span></span><br><span class=\"line\">        <span class=\"type\">DefaultConsumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 获取消息，并且处理，这个方法类似事件监听，如果有消息的时候，会被自动调用</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties,</span></span><br><span class=\"line\"><span class=\"params\">                                       <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                <span class=\"comment\">// body 即消息体</span></span><br><span class=\"line\">                <span class=\"type\">String</span> <span class=\"variable\">msg</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot; [消费者2] received : &quot;</span> + msg + <span class=\"string\">&quot;!&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        <span class=\"comment\">// 监听队列，自动ACK</span></span><br><span class=\"line\">        channel.basicConsume(QUEUE_NAME, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>结果C1、C2是都接收到消息了：</p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191631828.png\" alt=\"image-20220106175843295\"></p>\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191632611.png\" alt=\"image-20220106175904638\"></p>\n<h4 id=\"4-6-3-RPC\"><a href=\"#4-6-3-RPC\" class=\"headerlink\" title=\"4.6.3 RPC\"></a>4.6.3 RPC</h4><p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191632340.png\" alt=\"img\"></p>\n<p>基本概念：</p>\n<p>Callback queue 回调队列，客户端向服务器发送请求，服务器端处理请求后，将其处理结果保存在一个存储体中。而客户端为了获得处理结果，那么客户在向服务器发送请求时，同时发送一个回调队列地址reply_to。</p>\n<p>Correlation id 关联标识，客户端可能会发送多个请求给服务器，当服务器处理完后，客户端无法辨别在回调队列中的响应具体和那个请求时对应的。为了处理这种情况，客户端在发送每个请求时，同时会附带一个独有correlation_id属性，这样客户端在回调队列中根据correlation_id字段的值就可以分辨此响应属于哪个请求。</p>\n<p>流程说明：</p>\n<p>当客户端启动的时候，它创建一个匿名独享的回调队列。<br>在 RPC 请求中，客户端发送带有两个属性的消息：一个是设置回调队列的 reply_to 属性，另一个是设置唯一值的 correlation_id 属性。<br>将请求发送到一个 rpc_queue 队列中。<br>服务器等待请求发送到这个队列中来。当请求出现的时候，它执行他的工作并且将带有执行结果的消息发送给 reply_to 字段指定的队列。<br>客户端等待回调队列里的数据。当有消息出现的时候，它会检查 correlation_id 属性。如果此属性的值与请求匹配，将它返回给应用</p>\n<h3 id=\"5-面试题\"><a href=\"#5-面试题\" class=\"headerlink\" title=\"5 面试题\"></a>5 面试题</h3><p>面试题：</p>\n<p>避免消息堆积？</p>\n<p>1） 采用workqueue，多个消费者监听同一队列。</p>\n<p>2）接收到消息以后，而是通过线程池，异步消费。</p>\n<p>如何避免消息丢失？</p>\n<p>1） 消费者的ACK机制。可以防止消费者丢失消息。</p>\n<p>但是，如果在消费者消费之前，MQ就宕机了，消息就没了？</p>\n<p>2）可以将消息进行持久化。要将消息持久化，前提是：队列、Exchange都持久化</p>\n<p>交换机持久化<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191632563.png\" alt=\"img\"><br>队列持久化<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191632941.png\" alt=\"img\"><br>消息持久化<br><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191632365.png\" alt=\"img\"></p>\n"},{"uuid":"bbaf9630-c0ab-11ec-92a1-7557b2313227","title":"docker安装zookeeper","abbrlink":"9b20e9d","_content":"\n## docker下安装zookeeper\n\n启动docker后，先查看zookeeper有哪些选择。\n\n```bash\ndocker search zookeeper\t\n```\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191704919.png)\n\n选择官方版本，下载\n\n~~~bash\ndocker pull zookeeper\n~~~\n\n查看镜像\n\n~~~bash\ndocker images\n\nREPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE\ndocker.io/tomcat            latest              bb832de23021        2 days ago          680 MB\ndocker.io/vernemq/vernemq   latest              9ff6861690a3        3 days ago          159 MB\ndocker.io/zookeeper         latest              2a33b1a1e11a        12 days ago         278 MB\n~~~\n\n`docker inspect zookeeper`查看镜像详情\n\n~~~bash\n[\n    {\n        \"Id\": \"sha256:2a33b1a1e11ad0f64eba1364828fcbd4f60dd0b140e1d32b23c4f22e4c2df31d\",\n        \"RepoTags\": [\n            \"docker.io/zookeeper:latest\"\n        ],\n        \"RepoDigests\": [\n            \"docker.io/zookeeper@sha256:61463427d81ec53585711fbce35ffea147b52f6c81b9283a67bff82efe9ae202\"\n        ],\n        \"Parent\": \"\",\n        \"Comment\": \"\",\n        \"Created\": \"2021-09-04T14:31:04.949531564Z\",\n        \"Container\": \"a4d61f2a3bb7f0a594218851b0215132ea195f57df5d3e1b3a3c78d5d4da4b56\",\n        \"ContainerConfig\": {\n            \"Hostname\": \"a4d61f2a3bb7\",\n            \"Domainname\": \"\",\n            \"User\": \"\",\n            \"AttachStdin\": false,\n            \"AttachStdout\": false,\n            \"AttachStderr\": false,\n            \"ExposedPorts\": {\n                \"2181/tcp\": {},\n                \"2888/tcp\": {},\n                \"3888/tcp\": {},\n                \"8080/tcp\": {}\n            },\n            \"Tty\": false,\n            \"OpenStdin\": false,\n            \"StdinOnce\": false,\n            \"Env\": [\n                \"PATH=/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/apache-zookeeper-3.7.0-bin/bin\",\n                \"JAVA_HOME=/usr/local/openjdk-11\",\n                \"LANG=C.UTF-8\",\n                \"JAVA_VERSION=11.0.12\",\n                \"ZOO_CONF_DIR=/conf\",\n                \"ZOO_DATA_DIR=/data\",\n                \"ZOO_DATA_LOG_DIR=/datalog\",\n                \"ZOO_LOG_DIR=/logs\",\n                \"ZOO_TICK_TIME=2000\",\n                \"ZOO_INIT_LIMIT=5\",\n                \"ZOO_SYNC_LIMIT=2\",\n                \"ZOO_AUTOPURGE_PURGEINTERVAL=0\",\n                \"ZOO_AUTOPURGE_SNAPRETAINCOUNT=3\",\n                \"ZOO_MAX_CLIENT_CNXNS=60\",\n                \"ZOO_STANDALONE_ENABLED=true\",\n                \"ZOO_ADMINSERVER_ENABLED=true\",\n                \"ZOOCFGDIR=/conf\"\n            ],\n            \"Cmd\": [\n                \"/bin/sh\",\n                \"-c\",\n                \"#(nop) \",\n                \"CMD [\\\"zkServer.sh\\\" \\\"start-foreground\\\"]\"\n            ],\n            \"Image\": \"sha256:83871249bd21f7df0e3f9a25c365f2fe482cd839a62030a8cb819622a61757de\",\n            \"Volumes\": {\n                \"/data\": {},\n                \"/datalog\": {},\n                \"/logs\": {}\n            },\n            \"WorkingDir\": \"/apache-zookeeper-3.7.0-bin\",\n            \"Entrypoint\": [\n                \"/docker-entrypoint.sh\"\n            ],\n            \"OnBuild\": null,\n            \"Labels\": {}\n        },\n        \"DockerVersion\": \"20.10.7\",\n        \"Author\": \"\",\n        \"Config\": {\n            \"Hostname\": \"\",\n            \"Domainname\": \"\",\n            \"User\": \"\",\n            \"AttachStdin\": false,\n            \"AttachStdout\": false,\n            \"AttachStderr\": false,\n            \"ExposedPorts\": {\n                \"2181/tcp\": {},\n                \"2888/tcp\": {},\n                \"3888/tcp\": {},\n                \"8080/tcp\": {}\n            },\n            \"Tty\": false,\n            \"OpenStdin\": false,\n            \"StdinOnce\": false,\n            \"Env\": [\n                \"PATH=/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/apache-zookeeper-3.7.0-bin/bin\",\n                \"JAVA_HOME=/usr/local/openjdk-11\",\n                \"LANG=C.UTF-8\",\n                \"JAVA_VERSION=11.0.12\",\n                \"ZOO_CONF_DIR=/conf\",\n                \"ZOO_DATA_DIR=/data\",\n                \"ZOO_DATA_LOG_DIR=/datalog\",\n                \"ZOO_LOG_DIR=/logs\",\n                \"ZOO_TICK_TIME=2000\",\n                \"ZOO_INIT_LIMIT=5\",\n                \"ZOO_SYNC_LIMIT=2\",\n                \"ZOO_AUTOPURGE_PURGEINTERVAL=0\",\n                \"ZOO_AUTOPURGE_SNAPRETAINCOUNT=3\",\n                \"ZOO_MAX_CLIENT_CNXNS=60\",\n                \"ZOO_STANDALONE_ENABLED=true\",\n                \"ZOO_ADMINSERVER_ENABLED=true\",\n                \"ZOOCFGDIR=/conf\"\n            ],\n            \"Cmd\": [\n                \"zkServer.sh\",\n                \"start-foreground\"\n            ],\n            \"Image\": \"sha256:83871249bd21f7df0e3f9a25c365f2fe482cd839a62030a8cb819622a61757de\",\n            \"Volumes\": {\n                \"/data\": {},\n                \"/datalog\": {},\n                \"/logs\": {}\n            },\n            \"WorkingDir\": \"/apache-zookeeper-3.7.0-bin\",\n            \"Entrypoint\": [\n                \"/docker-entrypoint.sh\"\n            ],\n            \"OnBuild\": null,\n            \"Labels\": null\n        },\n        \"Architecture\": \"amd64\",\n        \"Os\": \"linux\",\n        \"Size\": 277857721,\n        \"VirtualSize\": 277857721,\n        \"GraphDriver\": {\n            \"Name\": \"overlay2\",\n            \"Data\": {\n                \"LowerDir\": \"/var/lib/docker/overlay2/c23c13970f98f9607674f41df40d0ae9631e3f733beb7f43b534b399903bdb6e/diff:/var/lib/docker/overlay2/edba8275449661a08f98aa8358acccda09f636ff63b62745cf032baaac6a83b6/diff:/var/lib/docker/overlay2/053a067737b9474d966509e0bd2bad945a8783d4b391f68aa250e37d986ca82c/diff:/var/lib/docker/overlay2/60dce72476a90d10650946e1ade294d09f0042dff3600acc0a71b3d0c790672d/diff:/var/lib/docker/overlay2/85c7adba7770d95daed846466aac57e2a5fa73df83387fd5d1edfaf4f2c2247a/diff:/var/lib/docker/overlay2/941d4279fc8ad098fa272415524753d5eae149f1b65dae1c58f358b0dcb25a36/diff:/var/lib/docker/overlay2/6a98f2f2f557a9cacf6487844baad942da9af5fb86263c7640106763ace7f8a7/diff\",\n                \"MergedDir\": \"/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/merged\",\n                \"UpperDir\": \"/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/diff\",\n                \"WorkDir\": \"/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/work\"\n            }\n        },\n        \"RootFS\": {\n            \"Type\": \"layers\",\n            \"Layers\": [\n                \"sha256:ba5a5fe4330168081f2a7e46f72c7552456d4d604ad27feadbe76ec86598587e\",\n                \"sha256:2605f54a59eca936809baec0b33d9333bc5d3cdc57a9ea6c395abb766bea73ee\",\n                \"sha256:9be53ed84a753f72f253cd789dd306a611d183b306ae265a8b4d7bbd167bac8a\",\n                \"sha256:27947c0376868058509877698b397812424ee477f7fbc3cf76b547777c048410\",\n                \"sha256:f290b03f22dda15089551b9c9b7f43f5e239da5c3c3098c1da84b2e67aa204ee\",\n                \"sha256:9439b4444bd0ad670d99026cdce9c06602863bc37910a0a62a0b9d5f414155b5\",\n                \"sha256:02a354ce9185f87185662d788cc1fcfc16b960bba27aa10d7729db37c395ea58\",\n                \"sha256:662510598bd9d6b1166da778021b98007900dd4313ceed887d8ae0a8f8ff6ae2\"\n            ]\n        }\n    }\n]\n~~~\n\n默认拉取最新的版本是3.7.0，如果想拉取其他版本，可以指定tag。\n\n### 单机\n\n~~~bash\n# 启动容器\ndocker run -d -p 2181:2181 --name standalone-zookeeper --restart always zookeeper\n\n# 查看容器\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES\nd8b7def1982c        zookeeper           \"/docker-entrypoin...\"   28 minutes ago      Up 28 minutes       2888/tcp, 3888/tcp, 0.0.0.0:2181->2181/tcp, 8080/tcp   standalone-zookeeper\nfbf17b466b4a        tomcat              \"catalina.sh run\"        12 hours ago        Up 12 hours         0.0.0.0:8080->8080/tcp                                 tomcat\n\n# 进入容器交互模式\ndocker exec -it standalone-zookeeper bash\n\n# 运行zk客户端\nroot@d8b7def1982c:/apache-zookeeper-3.7.0-bin# ./bin/zkCli.sh\n\n[zk: localhost:2181(CONNECTED) 0] ls /\n[zookeeper]\n[zk: localhost:2181(CONNECTED) 1] quit\n\nWATCHER::\n\nWatchedEvent state:Closed type:None path:null\n2021-09-16 22:35:23,414 [myid:] - INFO  [main:ZooKeeper@1232] - Session: 0x10002a3f7b70002 closed\n2021-09-16 22:35:23,416 [myid:] - ERROR [main:ServiceUtils@42] - Exiting JVM with code 0\n2021-09-16 22:35:23,420 [myid:] - INFO  [main-EventThread:ClientCnxn$EventThread@570] - EventThread shut down for session: 0x10002a3f7b70002\n~~~\n\n查看虚拟机ip\n\n~~~bash\nifconfig\n\nenp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 192.168.56.102  netmask 255.255.255.0  broadcast 192.168.56.255\n        inet6 fe80::f449:6222:f3f0:156b  prefixlen 64  scopeid 0x20<link>\n        ether 08:00:27:a3:2c:01  txqueuelen 1000  (Ethernet)\n        RX packets 315193  bytes 24898970 (23.7 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 281868  bytes 59276159 (56.5 MiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n~~~\n\n外部访问地址：192.168.56.102:2181\n\n\n\n### 集群\n\n**环境**：单台宿主机（`192.168.1.9`），启动三个zookeeper容器。\n\n**这里涉及的问题，就是docker容器之前通信的问题，这个很重要。**\n\n~~~bash\n[root@localhost ~]# docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\nf7b764ef3634        bridge              bridge              local\n15e39185d267        host                host                local\nfa65da9323b5        none                null                local\n~~~\n\nDocker有三种网络模式，bridge、host、none，在你创建容器的时候，不指定--network默认是bridge。\n\nbridge：为每一个容器分配IP，并将容器连接到一个docker0虚拟网桥，通过docker0网桥与宿主机通信。也就是说，**此模式下，你不能用宿主机的IP+容器映射端口来进行Docker容器之间的通信。**\n\nhost：容器不会虚拟自己的网卡，配置自己的IP，而是使用宿主机的IP和端口。这样一来，**Docker容器之间的通信就可以用宿主机的IP+容器映射端口**\n\nnone：无网络。\n\n---\n\n现在本地创建目录：\n\n~~~bash\n[root@localhost admin]# mkdir /usr/local/zookeeper-cluster\n[root@localhost admin]# mkdir /usr/local/zookeeper-cluster/node1\n[root@localhost admin]# mkdir /usr/local/zookeeper-cluster/node2\n[root@localhost admin]# mkdir /usr/local/zookeeper-cluster/node3\n[root@localhost admin]# ll /usr/local/zookeeper-cluster/\ntotal 0\ndrwxr-xr-x. 2 root root 6 Aug 28 23:02 node1\ndrwxr-xr-x. 2 root root 6 Aug 28 23:02 node2\ndrwxr-xr-x. 2 root root 6 Aug 28 23:02 node3\n~~~\n\n然后执行命令启动：\n\n~~~bash\ndocker run -d -p 2181:2181 -p 2888:2888 -p 3888:3888 --name zookeeper_node1 --privileged --restart always \\\n-v /usr/local/zookeeper-cluster/node1/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node1/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node1/volumes/logs:/logs \\\n-e ZOO_MY_ID=1 \\\n-e \"ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183\" zookeeper\n\ndocker run -d -p 2182:2181 -p 2889:2888 -p 3889:3888 --name zookeeper_node2 --privileged --restart always \\\n-v /usr/local/zookeeper-cluster/node2/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node2/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node2/volumes/logs:/logs \\\n-e ZOO_MY_ID=2 \\\n-e \"ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183\" zookeeper\n\ndocker run -d -p 2183:2181 -p 2890:2888 -p 3890:3888 --name zookeeper_node3 --privileged --restart always \\\n-v /usr/local/zookeeper-cluster/node3/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node3/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node3/volumes/logs:/logs \\\n-e ZOO_MY_ID=3 \\\n-e \"ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183\" zookeeper\n~~~\n\n查看容器启动情况\n\n~~~bash\n[root@localhost admin]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                              NAMES\n6dabae1d92f0        3487af26dee9        \"/docker-entrypoin...\"   31 seconds ago      Up 29 seconds       8080/tcp, 0.0.0.0:2183->2181/tcp, 0.0.0.0:2890->2888/tcp, 0.0.0.0:3890->3888/tcp   zookeeper_node3\ndbb7f1f323a0        3487af26dee9        \"/docker-entrypoin...\"   36 seconds ago      Up 35 seconds       8080/tcp, 0.0.0.0:2182->2181/tcp, 0.0.0.0:2889->2888/tcp, 0.0.0.0:3889->3888/tcp   zookeeper_node2\n4bfa6bbeb936        3487af26dee9        \"/docker-entrypoin...\"   46 seconds ago      Up 45 seconds       0.0.0.0:2181->2181/tcp, 0.0.0.0:2888->2888/tcp, 0.0.0.0:3888->3888/tcp, 8080/tcp   zookeeper_node1\n~~~\n\n我们看下节点1的启动日志\n\n~~~bash\n[root@localhost admin]# docker logs -f zookeeper_node1\nZooKeeper JMX enabled by default\n\n...\n\n2019-08-29 09:20:22,665 [myid:1] - WARN  [WorkerSender[myid=1]:QuorumCnxManager@677] - Cannot open channel to 2 at election address /192.168.1.9:3889\njava.net.ConnectException: Connection refused (Connection refused)\n    at java.net.PlainSocketImpl.socketConnect(Native Method)\n    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)\n    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)\n    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)\n    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n    at java.net.Socket.connect(Socket.java:589)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:648)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:705)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:618)\n    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.process(FastLeaderElection.java:477)\n    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.run(FastLeaderElection.java:456)\n    at java.lang.Thread.run(Thread.java:748)\n2019-08-29 09:20:22,666 [myid:1] - WARN  [WorkerSender[myid=1]:QuorumCnxManager@677] - Cannot open channel to 3 at election address /192.168.192.128:3890\njava.net.ConnectException: Connection refused (Connection refused)\n    at java.net.PlainSocketImpl.socketConnect(Native Method)\n    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)\n    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)\n    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)\n    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n    at java.net.Socket.connect(Socket.java:589)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:648)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:705)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:618)\n    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.process(FastLeaderElection.java:477)\n    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.run(FastLeaderElection.java:456)\n    at java.lang.Thread.run(Thread.java:748)\n~~~\n\n连接不上2 和 3，为什么呢，因为在默认的Docker网络模式下，通过宿主机的IP+映射端口，根本找不到啊！他们有自己的IP啊！如下：\n\n~~~bash\n[root@localhost admin]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                              NAMES\n6dabae1d92f0        3487af26dee9        \"/docker-entrypoin...\"   31 seconds ago      Up 29 seconds       8080/tcp, 0.0.0.0:2183->2181/tcp, 0.0.0.0:2890->2888/tcp, 0.0.0.0:3890->3888/tcp   zookeeper_node3\ndbb7f1f323a0        3487af26dee9        \"/docker-entrypoin...\"   36 seconds ago      Up 35 seconds       8080/tcp, 0.0.0.0:2182->2181/tcp, 0.0.0.0:2889->2888/tcp, 0.0.0.0:3889->3888/tcp   zookeeper_node2\n4bfa6bbeb936        3487af26dee9        \"/docker-entrypoin...\"   46 seconds ago      Up 45 seconds       0.0.0.0:2181->2181/tcp, 0.0.0.0:2888->2888/tcp, 0.0.0.0:3888->3888/tcp, 8080/tcp   zookeeper_node1\n\n[root@localhost ~]# docker inspect zookeeper_node1\n            \"Networks\": {\n                \"bridge\": {\n                    \"IPAMConfig\": null,\n                    \"Links\": null,\n                    \"Aliases\": null,\n                    \"NetworkID\": \"f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e\",\n                    \"EndpointID\": \"dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f\",\n                    \"Gateway\": \"172.17.0.1\",\n                    \"IPAddress\": \"172.17.0.3\",\n                    \"IPPrefixLen\": 16,\n                    \"IPv6Gateway\": \"\",\n                    \"GlobalIPv6Address\": \"\",\n                    \"GlobalIPv6PrefixLen\": 0,\n                    \"MacAddress\": \"02:42:ac:11:00:03\"\n                }\n            }\n        }\n    }\n]\n\n[root@localhost ~]# docker inspect zookeeper_node2\n            \"Networks\": {\n                \"bridge\": {\n                    \"IPAMConfig\": null,\n                    \"Links\": null,\n                    \"Aliases\": null,\n                    \"NetworkID\": \"f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e\",\n                    \"EndpointID\": \"dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f\",\n                    \"Gateway\": \"172.17.0.1\",\n                    \"IPAddress\": \"172.17.0.4\",\n                    \"IPPrefixLen\": 16,\n                    \"IPv6Gateway\": \"\",\n                    \"GlobalIPv6Address\": \"\",\n                    \"GlobalIPv6PrefixLen\": 0,\n                    \"MacAddress\": \"02:42:ac:11:00:03\"\n                }\n            }\n        }\n    }\n]\n\n[root@localhost ~]# docker inspect zookeeper_node3\n            \"Networks\": {\n                \"bridge\": {\n                    \"IPAMConfig\": null,\n                    \"Links\": null,\n                    \"Aliases\": null,\n                    \"NetworkID\": \"f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e\",\n                    \"EndpointID\": \"dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f\",\n                    \"Gateway\": \"172.17.0.1\",\n                    \"IPAddress\": \"172.17.0.5\",\n                    \"IPPrefixLen\": 16,\n                    \"IPv6Gateway\": \"\",\n                    \"GlobalIPv6Address\": \"\",\n                    \"GlobalIPv6PrefixLen\": 0,\n                    \"MacAddress\": \"02:42:ac:11:00:03\"\n                }\n            }\n        }\n    }\n]\n~~~\n\nnode1---172.17.0.3\nnode2---172.17.0.4\nnode3---172.17.0.5\n\n既然我们知道了它有自己的IP，那又出现另一个问题了，就是它的ip是动态的，启动之前我们无法得知。**有个解决办法就是创建自己的bridge网络，然后创建容器的时候指定ip。**\n\n**【正确方式开始】**\n\n~~~bash\n[root@localhost ~]# docker network create --driver bridge --subnet=172.18.0.0/16 --gateway=172.18.0.1 zoonet\n7ca91b6fa816f91b43f04529b74bcd9fa5aadef41cd3b9df7371beb44e83663b\n[root@localhost ~]# docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\nf7b764ef3634        bridge              bridge              local\n15e39185d267        host                host                local\nfa65da9323b5        none                null                local\n7ca91b6fa816        zoonet              bridge              local\n[root@localhost ~]# docker network inspect zoonet\n[\n    {\n        \"Name\": \"zoonet\",\n        \"Id\": \"7ca91b6fa816f91b43f04529b74bcd9fa5aadef41cd3b9df7371beb44e83663b\",\n        \"Created\": \"2021-09-17T07:15:33.177645556+08:00\",\n        \"Scope\": \"local\",\n        \"Driver\": \"bridge\",\n        \"EnableIPv6\": false,\n        \"IPAM\": {\n            \"Driver\": \"default\",\n            \"Options\": {},\n            \"Config\": [\n                {\n                    \"Subnet\": \"172.18.0.0/16\",\n                    \"Gateway\": \"172.18.0.1\"\n                }\n            ]\n        },\n        \"Internal\": false,\n        \"Attachable\": false,\n        \"Containers\": {},\n        \"Options\": {},\n        \"Labels\": {}\n    }\n]\n~~~\n\n然后我们修改一下zookeeper容器的创建命令。【正确命令】\n\n~~~bash\ndocker run -d -p 2181:2181 --name zookeeper_node1 --privileged --restart always --network zoonet --ip 172.18.0.2 \\\n-v /usr/local/zookeeper-cluster/node1/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node1/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node1/volumes/logs:/logs \\\n-e ZOO_MY_ID=1 \\\n-e \"ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181\" zookeeper\n\ndocker run -d -p 2182:2181 --name zookeeper_node2 --privileged --restart always --network zoonet --ip 172.18.0.3 \\\n-v /usr/local/zookeeper-cluster/node2/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node2/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node2/volumes/logs:/logs \\\n-e ZOO_MY_ID=2 \\\n-e \"ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181\" zookeeper\n\ndocker run -d -p 2183:2181 --name zookeeper_node3 --privileged --restart always --network zoonet --ip 172.18.0.4 \\\n-v /usr/local/zookeeper-cluster/node3/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node3/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node3/volumes/logs:/logs \\\n-e ZOO_MY_ID=3 \\\n-e \"ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181\" zookeeper\n\n\n[root@localhost ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES\n5f35bdd41916        zookeeper           \"/docker-entrypoin...\"   3 minutes ago       Up 3 minutes        2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2183->2181/tcp   zookeeper_node3\nc311e63820af        zookeeper           \"/docker-entrypoin...\"   4 minutes ago       Up 4 minutes        2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2182->2181/tcp   zookeeper_node2\n249fa3c091cd        zookeeper           \"/docker-entrypoin...\"   4 minutes ago       Up 4 minutes        2888/tcp, 3888/tcp, 0.0.0.0:2181->2181/tcp, 8080/tcp   zookeeper_node1\nfbf17b466b4a        tomcat              \"catalina.sh run\"        12 hours ago        Up 12 hours         0.0.0.0:8080->8080/tcp                                 tomcat\n~~~\n\n进入容器内部验证一下：\n\n~~~bash\n[root@localhost ~]# docker exec -it  zookeeper_node1 bash\nroot@249fa3c091cd:/apache-zookeeper-3.7.0-bin# ./bin/zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /conf/zoo.cfg\nClient port found: 2181. Client address: localhost. Client SSL: false.\nMode: follower\nroot@249fa3c091cd:/apache-zookeeper-3.7.0-bin# exit\nexit\n[root@localhost ~]# docker exec -it  zookeeper_node2 bash\nroot@c311e63820af:/apache-zookeeper-3.7.0-bin# ./bin/zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /conf/zoo.cfg\nClient port found: 2181. Client address: localhost. Client SSL: false.\nMode: leader\nroot@c311e63820af:/apache-zookeeper-3.7.0-bin# exit\nexit\n[root@localhost ~]# docker exec -it  zookeeper_node3 bash\nroot@5f35bdd41916:/apache-zookeeper-3.7.0-bin# ./bin/zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /conf/zoo.cfg\nClient port found: 2181. Client address: localhost. Client SSL: false.\nMode: follower\n~~~\n\n在验证一下创建节点：\n\n~~~bash\n# node3\nroot@5f35bdd41916:/apache-zookeeper-3.7.0-bin# ./bin/zkCli.sh \nConnecting to localhost:2181\n2021-09-16 23:32:52,624 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC\n2021-09-16 23:32:52,629 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=5f35bdd41916\n2021-09-16 23:32:52,724 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12\n2021-09-16 23:32:52,727 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation\n2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11\n2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:\n2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib\n2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp\n2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=<NA>\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB\n2021-09-16 23:32:52,736 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB\n2021-09-16 23:32:52,736 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB\n2021-09-16 23:32:52,783 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4c70fda8\n2021-09-16 23:32:52,788 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\n2021-09-16 23:32:52,901 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2021-09-16 23:32:53,214 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=false\nWelcome to ZooKeeper!\nJLine support is enabled\n2021-09-16 23:32:53,976 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.\n2021-09-16 23:32:53,979 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2021-09-16 23:32:54,145 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55044, server: localhost/0:0:0:0:0:0:0:1:2181\n2021-09-16 23:32:55,005 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session id = 0x30002ebbd490000, negotiated timeout = 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n[zk: localhost:2181(CONNECTED) 0] ls /\n[zookeeper]\n[zk: localhost:2181(CONNECTED) 1] create /hello\nCreated /hello\n[zk: localhost:2181(CONNECTED) 2] \n\n\n# node1\n[root@localhost ~]# docker exec -it  zookeeper_node1 bash\nroot@249fa3c091cd:/apache-zookeeper-3.7.0-bin# ./bin/zkCli.sh\nConnecting to localhost:2181\n2021-09-16 23:35:28,681 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC\n2021-09-16 23:35:28,783 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=249fa3c091cd\n2021-09-16 23:35:28,783 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12\n2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation\n2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11\n2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:\n2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib\n2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp\n2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=<NA>\n2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux\n2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64\n2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64\n2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root\n2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root\n2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin\n2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB\n2021-09-16 23:35:28,790 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB\n2021-09-16 23:35:28,790 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB\n2021-09-16 23:35:28,896 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4c70fda8\n2021-09-16 23:35:28,950 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\n2021-09-16 23:35:29,052 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2021-09-16 23:35:29,110 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=false\nWelcome to ZooKeeper!\n2021-09-16 23:35:29,483 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.\n2021-09-16 23:35:29,489 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2021-09-16 23:35:29,655 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55046, server: localhost/0:0:0:0:0:0:0:1:2181\nJLine support is enabled\n2021-09-16 23:35:30,522 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session id = 0x10002eb88340000, negotiated timeout = 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n[zk: localhost:2181(CONNECTED) 0] ls /\n[hello, zookeeper]\n[zk: localhost:2181(CONNECTED) 1] \n~~~\n\n**开启防火墙，以供外部访问**\n\n~~~bash\nfirewall-cmd --zone=public --add-port=2181/tcp --permanent\nfirewall-cmd --zone=public --add-port=2182/tcp --permanent\nfirewall-cmd --zone=public --add-port=2183/tcp --permanent\nsystemctl restart firewalld\nfirewall-cmd --list-all\n~~~\n\nMac下载zookeeper,地址:https://www.apache.org/dyn/closer.lua/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz\n\n解压后进入bin目录，执行`sh zkCli.sh -server 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183`\n\n~~~bash\n# 连接server\nbin sh zkCli.sh -server 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183\n\nConnecting to 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183\n2021-09-17 23:26:53,552 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC\n2021-09-17 23:26:53,558 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=192.168.1.9\n2021-09-17 23:26:53,558 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=1.8.0_202\n2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation\n2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/Library/Java/JavaVirtualMachines/jdk1.8.0_202.jdk/Contents/Home/jre\n2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../build/classes:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../conf:\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/Users/xiewei/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/var/folders/b4/9d7gh64s3937fcp3wwd9hvgm0000gn/T/\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=<NA>\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Mac OS X\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=x86_64\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=10.16\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=xiewei\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/Users/xiewei\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin\n2021-09-17 23:26:53,568 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=236MB\n2021-09-17 23:26:53,569 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=245MB\n2021-09-17 23:26:53,569 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=245MB\n2021-09-17 23:26:53,575 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@768debd\n2021-09-17 23:26:53,586 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\n2021-09-17 23:26:53,600 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2021-09-17 23:26:53,614 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=false\nWelcome to ZooKeeper!\nJLine support is enabled\n2021-09-17 23:26:53,639 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn$SendThread@1171] - Opening socket connection to server 192.168.56.102/192.168.56.102:2181.\n2021-09-17 23:26:53,639 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2021-09-17 23:26:53,676 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: /192.168.56.1:60556, server: 192.168.56.102/192.168.56.102:2181\n2021-09-17 23:26:53,733 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn$SendThread@1438] - Session establishment complete on server 192.168.56.102/192.168.56.102:2181, session id = 0x10002eb88340001, negotiated timeout = 30000\n[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTING) 0]\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\nls /\n[hello, zookeeper]\n[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTED) 1]\n~~~\n\n\n\n集群安装方式二：通过docker-compose安装\n\n先安装docker-compose:\n\n~~~bash\n[root@localhost admin]# curl -L \"https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   617    0   617    0     0    145      0 --:--:--  0:00:04 --:--:--   145\n100 15.4M  100 15.4M    0     0   131k      0  0:02:00  0:02:00 --:--:--  136k\n\n\n[root@localhost admin]# chmod +x /usr/local/bin/docker-compose\n~~~\n\n检查版本（验证是否安装成功):\n\n~~~bash\n[root@localhost admin]# docker-compose --version\ndocker-compose version 1.24.1, build 4667896b\n~~~\n\n卸载的话：\n\n~~~bash\nrm /usr/local/bin/docker-compose\n~~~\n\n开始配置，新建三个挂载目录：\n\n~~~bash\n[root@localhost zookeeper-cluster]# mkdir /usr/local/zookeeper-cluster/node4\n[root@localhost zookeeper-cluster]# mkdir /usr/local/zookeeper-cluster/node5\n[root@localhost zookeeper-cluster]# mkdir /usr/local/zookeeper-cluster/node6\n~~~\n\n新建任意目录，然后在里面新建一个文件：\n\n~~~bash\n[root@localhost local]# cd /usr/local\n[root@localhost local]# mkdir DockerComposeFolder\n[root@localhost local]# cd DockerComposeFolder\n\n[root@localhost DockerComposeFolder]# vim docker-compose.yml\n~~~\n\n`docker-compose.yml`文件内容如下\n\n~~~yml\nversion: '3.1'\n\nservices:\n  zoo1:\n    image: zookeeper\n    restart: always\n    privileged: true\n    hostname: zoo1\n    ports:\n      - 2181:2181\n    volumes: # 挂载数据\n      - /usr/local/zookeeper-cluster/node4/data:/data\n      - /usr/local/zookeeper-cluster/node4/datalog:/datalog\n    environment:\n      ZOO_MY_ID: 4\n      ZOO_SERVERS: server.4=0.0.0.0:2888:3888;2181 server.5=zoo2:2888:3888;2181 server.6=zoo3:2888:3888;2181\n    networks:\n      default:\n        ipv4_address: 172.18.0.14\n\n  zoo2:\n    image: zookeeper\n    restart: always\n    privileged: true\n    hostname: zoo2\n    ports:\n      - 2182:2181\n    volumes: # 挂载数据\n      - /usr/local/zookeeper-cluster/node5/data:/data\n      - /usr/local/zookeeper-cluster/node5/datalog:/datalog\n    environment:\n      ZOO_MY_ID: 5\n      ZOO_SERVERS: server.4=zoo1:2888:3888;2181 server.5=0.0.0.0:2888:3888;2181 server.6=zoo3:2888:3888;2181\n    networks:\n      default:\n        ipv4_address: 172.18.0.15\n\n  zoo3:\n    image: zookeeper\n    restart: always\n    privileged: true\n    hostname: zoo3\n    ports:\n      - 2183:2181\n    volumes: # 挂载数据\n      - /usr/local/zookeeper-cluster/node6/data:/data\n      - /usr/local/zookeeper-cluster/node6/datalog:/datalog\n    environment:\n      ZOO_MY_ID: 6\n      ZOO_SERVERS: server.4=zoo1:2888:3888;2181 server.5=zoo2:2888:3888;2181 server.6=0.0.0.0:2888:3888;2181\n    networks:\n      default:\n        ipv4_address: 172.18.0.16\n\nnetworks: # 自定义网络\n  default:\n    external:\n      name: zoonet\n~~~\n\n**注意yaml文件里不能有tab，只能有空格。**\n\n关于version与Docker版本的关系如下：\n\n![](https://github.com/lanbai1993/book/blob/master/zookeeper/images/docker-compose-file-format-compatibility.png?raw=true)\n\n 然后执行（-d后台启动）`docker-compose -f docker-compose.yml up -d`\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker-compose -f docker-compose.yml up -d\nCreating dockercomposefolder_zoo2_1 ... done\nCreating dockercomposefolder_zoo3_1 ... done\nCreating dockercomposefolder_zoo1_1 ... done\n~~~\n\n查看已启动的容器\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES\nc1e536397843        zookeeper           \"/docker-entrypoin...\"   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 0.0.0.0:2181->2181/tcp, 8080/tcp   dockercomposefolder_zoo1_1\n65ab984b726f        zookeeper           \"/docker-entrypoin...\"   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2182->2181/tcp   dockercomposefolder_zoo2_1\n553a2e2bc10c        zookeeper           \"/docker-entrypoin...\"   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2183->2181/tcp   dockercomposefolder_zoo3_1\n~~~\n\n进入一个容器\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker exec -it c1e536397843 bash\nroot@zoo1:/apache-zookeeper-3.7.0-bin# ./bin/zkCli.sh\nConnecting to localhost:2181\n2021-09-17 01:45:46,356 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC\n2021-09-17 01:45:46,360 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=zoo1\n2021-09-17 01:45:46,360 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12\n2021-09-17 01:45:46,364 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation\n2021-09-17 01:45:46,364 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11\n2021-09-17 01:45:46,365 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=<NA>\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB\n2021-09-17 01:45:46,465 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB\n2021-09-17 01:45:46,465 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB\n2021-09-17 01:45:46,470 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4c70fda8\n2021-09-17 01:45:46,633 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\n2021-09-17 01:45:46,737 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2021-09-17 01:45:46,797 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=false\nWelcome to ZooKeeper!\nJLine support is enabled\n2021-09-17 01:45:47,171 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.\n2021-09-17 01:45:47,232 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2021-09-17 01:45:47,490 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55114, server: localhost/0:0:0:0:0:0:0:1:2181\n2021-09-17 01:45:47,773 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session id = 0x4000359a82b0000, negotiated timeout = 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n[zk: localhost:2181(CONNECTED) 0] ls /\n[zookeeper]\n[zk: localhost:2181(CONNECTED) 1] create /hi\nCreated /hi\n[zk: localhost:2181(CONNECTED) 2] ls /\n[hi, zookeeper]\n~~~\n\n进入另一个容器\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker exec -it 65ab984b726f bash\nroot@zoo2:/apache-zookeeper-3.7.0-bin# ./bin/zkCli.sh\nConnecting to localhost:2181\n2021-09-17 01:48:04,861 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC\n2021-09-17 01:48:04,869 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=zoo2\n2021-09-17 01:48:04,870 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12\n2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation\n2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11\n2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:\n2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=<NA>\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB\n2021-09-17 01:48:04,924 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB\n2021-09-17 01:48:04,924 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB\n2021-09-17 01:48:04,970 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4c70fda8\n2021-09-17 01:48:05,022 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\n2021-09-17 01:48:05,027 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2021-09-17 01:48:05,087 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=false\nWelcome to ZooKeeper!\n2021-09-17 01:48:05,464 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1171] - Opening socket connection to server localhost/127.0.0.1:2181.\n2021-09-17 01:48:05,465 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2021-09-17 01:48:05,622 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: /127.0.0.1:53278, server: localhost/127.0.0.1:2181\nJLine support is enabled\n2021-09-17 01:48:06,168 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1438] - Session establishment complete on server localhost/127.0.0.1:2181, session id = 0x5000359a80d0000, negotiated timeout = 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n[zk: localhost:2181(CONNECTED) 0] ls /\n[hi, zookeeper]\n~~~\n\n本地客户端连接集群：\n\n~~~bash\nzkCli.cmd -server 192.168.192.128:2181,192.168.192.128:2182,192.168.192.128:2183\n~~~\n\n查看节点信息：\n\n~~~bash\nls /\n[hi, zookeeper]\n[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTED) 1]\n~~~\n\n停止所有活动容器`docker-compose stop`\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker-compose stop\nStopping dockercomposefolder_zoo1_1 ... done\nStopping dockercomposefolder_zoo2_1 ... done\nStopping dockercomposefolder_zoo3_1 ... done\n~~~\n\n删除所有已停止的容器\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker-compose rm\nGoing to remove dockercomposefolder_zoo1_1, dockercomposefolder_zoo2_1, dockercomposefolder_zoo3_1\nAre you sure? [yN] y\nRemoving dockercomposefolder_zoo1_1 ... done\nRemoving dockercomposefolder_zoo2_1 ... done\nRemoving dockercomposefolder_zoo3_1 ... done\n~~~\n\n更多docker-compose命令：`docker-compose --help`\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker-compose --help\nDefine and run multi-container applications with Docker.\n\nUsage:\n  docker-compose [-f <arg>...] [options] [COMMAND] [ARGS...]\n  docker-compose -h|--help\n\nOptions:\n  -f, --file FILE             Specify an alternate compose file\n                              (default: docker-compose.yml)\n  -p, --project-name NAME     Specify an alternate project name\n                              (default: directory name)\n  --verbose                   Show more output\n  --log-level LEVEL           Set log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)\n  --no-ansi                   Do not print ANSI control characters\n  -v, --version               Print version and exit\n  -H, --host HOST             Daemon socket to connect to\n\n  --tls                       Use TLS; implied by --tlsverify\n  --tlscacert CA_PATH         Trust certs signed only by this CA\n  --tlscert CLIENT_CERT_PATH  Path to TLS certificate file\n  --tlskey TLS_KEY_PATH       Path to TLS key file\n  --tlsverify                 Use TLS and verify the remote\n  --skip-hostname-check       Don't check the daemon's hostname against the\n                              name specified in the client certificate\n  --project-directory PATH    Specify an alternate working directory\n                              (default: the path of the Compose file)\n  --compatibility             If set, Compose will attempt to convert keys\n                              in v3 files to their non-Swarm equivalent\n\nCommands:\n  build              Build or rebuild services\n  bundle             Generate a Docker bundle from the Compose file\n  config             Validate and view the Compose file\n  create             Create services\n  down               Stop and remove containers, networks, images, and volumes\n  events             Receive real time events from containers\n  exec               Execute a command in a running container\n  help               Get help on a command\n  images             List images\n  kill               Kill containers\n  logs               View output from containers\n  pause              Pause services\n  port               Print the public port for a port binding\n  ps                 List containers\n  pull               Pull service images\n  push               Push service images\n  restart            Restart services\n  rm                 Remove stopped containers\n  run                Run a one-off command\n  scale              Set number of containers for a service\n  start              Start services\n  stop               Stop services\n  top                Display the running processes\n  unpause            Unpause services\n  up                 Create and start containers\n  version            Show the Docker-Compose version information\n~~~\n\n\n\nReference:\n\n> https://www.cnblogs.com/LUA123/p/11428113.html\n>\n> https://www.runoob.com/w3cnote/zookeeper-linux-cluster.html\n","source":"_posts/docker下安装zookeeper(单机&集群).md","raw":"---\nuuid: bbaf9630-c0ab-11ec-92a1-7557b2313227\ntitle: docker安装zookeeper\ncategories: Docker\ntags:\n  - docker\n  - zookeeper\nabbrlink: 9b20e9d\n---\n\n## docker下安装zookeeper\n\n启动docker后，先查看zookeeper有哪些选择。\n\n```bash\ndocker search zookeeper\t\n```\n\n![](https://raw.githubusercontent.com/xzyup/image/master/202203191704919.png)\n\n选择官方版本，下载\n\n~~~bash\ndocker pull zookeeper\n~~~\n\n查看镜像\n\n~~~bash\ndocker images\n\nREPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE\ndocker.io/tomcat            latest              bb832de23021        2 days ago          680 MB\ndocker.io/vernemq/vernemq   latest              9ff6861690a3        3 days ago          159 MB\ndocker.io/zookeeper         latest              2a33b1a1e11a        12 days ago         278 MB\n~~~\n\n`docker inspect zookeeper`查看镜像详情\n\n~~~bash\n[\n    {\n        \"Id\": \"sha256:2a33b1a1e11ad0f64eba1364828fcbd4f60dd0b140e1d32b23c4f22e4c2df31d\",\n        \"RepoTags\": [\n            \"docker.io/zookeeper:latest\"\n        ],\n        \"RepoDigests\": [\n            \"docker.io/zookeeper@sha256:61463427d81ec53585711fbce35ffea147b52f6c81b9283a67bff82efe9ae202\"\n        ],\n        \"Parent\": \"\",\n        \"Comment\": \"\",\n        \"Created\": \"2021-09-04T14:31:04.949531564Z\",\n        \"Container\": \"a4d61f2a3bb7f0a594218851b0215132ea195f57df5d3e1b3a3c78d5d4da4b56\",\n        \"ContainerConfig\": {\n            \"Hostname\": \"a4d61f2a3bb7\",\n            \"Domainname\": \"\",\n            \"User\": \"\",\n            \"AttachStdin\": false,\n            \"AttachStdout\": false,\n            \"AttachStderr\": false,\n            \"ExposedPorts\": {\n                \"2181/tcp\": {},\n                \"2888/tcp\": {},\n                \"3888/tcp\": {},\n                \"8080/tcp\": {}\n            },\n            \"Tty\": false,\n            \"OpenStdin\": false,\n            \"StdinOnce\": false,\n            \"Env\": [\n                \"PATH=/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/apache-zookeeper-3.7.0-bin/bin\",\n                \"JAVA_HOME=/usr/local/openjdk-11\",\n                \"LANG=C.UTF-8\",\n                \"JAVA_VERSION=11.0.12\",\n                \"ZOO_CONF_DIR=/conf\",\n                \"ZOO_DATA_DIR=/data\",\n                \"ZOO_DATA_LOG_DIR=/datalog\",\n                \"ZOO_LOG_DIR=/logs\",\n                \"ZOO_TICK_TIME=2000\",\n                \"ZOO_INIT_LIMIT=5\",\n                \"ZOO_SYNC_LIMIT=2\",\n                \"ZOO_AUTOPURGE_PURGEINTERVAL=0\",\n                \"ZOO_AUTOPURGE_SNAPRETAINCOUNT=3\",\n                \"ZOO_MAX_CLIENT_CNXNS=60\",\n                \"ZOO_STANDALONE_ENABLED=true\",\n                \"ZOO_ADMINSERVER_ENABLED=true\",\n                \"ZOOCFGDIR=/conf\"\n            ],\n            \"Cmd\": [\n                \"/bin/sh\",\n                \"-c\",\n                \"#(nop) \",\n                \"CMD [\\\"zkServer.sh\\\" \\\"start-foreground\\\"]\"\n            ],\n            \"Image\": \"sha256:83871249bd21f7df0e3f9a25c365f2fe482cd839a62030a8cb819622a61757de\",\n            \"Volumes\": {\n                \"/data\": {},\n                \"/datalog\": {},\n                \"/logs\": {}\n            },\n            \"WorkingDir\": \"/apache-zookeeper-3.7.0-bin\",\n            \"Entrypoint\": [\n                \"/docker-entrypoint.sh\"\n            ],\n            \"OnBuild\": null,\n            \"Labels\": {}\n        },\n        \"DockerVersion\": \"20.10.7\",\n        \"Author\": \"\",\n        \"Config\": {\n            \"Hostname\": \"\",\n            \"Domainname\": \"\",\n            \"User\": \"\",\n            \"AttachStdin\": false,\n            \"AttachStdout\": false,\n            \"AttachStderr\": false,\n            \"ExposedPorts\": {\n                \"2181/tcp\": {},\n                \"2888/tcp\": {},\n                \"3888/tcp\": {},\n                \"8080/tcp\": {}\n            },\n            \"Tty\": false,\n            \"OpenStdin\": false,\n            \"StdinOnce\": false,\n            \"Env\": [\n                \"PATH=/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/apache-zookeeper-3.7.0-bin/bin\",\n                \"JAVA_HOME=/usr/local/openjdk-11\",\n                \"LANG=C.UTF-8\",\n                \"JAVA_VERSION=11.0.12\",\n                \"ZOO_CONF_DIR=/conf\",\n                \"ZOO_DATA_DIR=/data\",\n                \"ZOO_DATA_LOG_DIR=/datalog\",\n                \"ZOO_LOG_DIR=/logs\",\n                \"ZOO_TICK_TIME=2000\",\n                \"ZOO_INIT_LIMIT=5\",\n                \"ZOO_SYNC_LIMIT=2\",\n                \"ZOO_AUTOPURGE_PURGEINTERVAL=0\",\n                \"ZOO_AUTOPURGE_SNAPRETAINCOUNT=3\",\n                \"ZOO_MAX_CLIENT_CNXNS=60\",\n                \"ZOO_STANDALONE_ENABLED=true\",\n                \"ZOO_ADMINSERVER_ENABLED=true\",\n                \"ZOOCFGDIR=/conf\"\n            ],\n            \"Cmd\": [\n                \"zkServer.sh\",\n                \"start-foreground\"\n            ],\n            \"Image\": \"sha256:83871249bd21f7df0e3f9a25c365f2fe482cd839a62030a8cb819622a61757de\",\n            \"Volumes\": {\n                \"/data\": {},\n                \"/datalog\": {},\n                \"/logs\": {}\n            },\n            \"WorkingDir\": \"/apache-zookeeper-3.7.0-bin\",\n            \"Entrypoint\": [\n                \"/docker-entrypoint.sh\"\n            ],\n            \"OnBuild\": null,\n            \"Labels\": null\n        },\n        \"Architecture\": \"amd64\",\n        \"Os\": \"linux\",\n        \"Size\": 277857721,\n        \"VirtualSize\": 277857721,\n        \"GraphDriver\": {\n            \"Name\": \"overlay2\",\n            \"Data\": {\n                \"LowerDir\": \"/var/lib/docker/overlay2/c23c13970f98f9607674f41df40d0ae9631e3f733beb7f43b534b399903bdb6e/diff:/var/lib/docker/overlay2/edba8275449661a08f98aa8358acccda09f636ff63b62745cf032baaac6a83b6/diff:/var/lib/docker/overlay2/053a067737b9474d966509e0bd2bad945a8783d4b391f68aa250e37d986ca82c/diff:/var/lib/docker/overlay2/60dce72476a90d10650946e1ade294d09f0042dff3600acc0a71b3d0c790672d/diff:/var/lib/docker/overlay2/85c7adba7770d95daed846466aac57e2a5fa73df83387fd5d1edfaf4f2c2247a/diff:/var/lib/docker/overlay2/941d4279fc8ad098fa272415524753d5eae149f1b65dae1c58f358b0dcb25a36/diff:/var/lib/docker/overlay2/6a98f2f2f557a9cacf6487844baad942da9af5fb86263c7640106763ace7f8a7/diff\",\n                \"MergedDir\": \"/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/merged\",\n                \"UpperDir\": \"/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/diff\",\n                \"WorkDir\": \"/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/work\"\n            }\n        },\n        \"RootFS\": {\n            \"Type\": \"layers\",\n            \"Layers\": [\n                \"sha256:ba5a5fe4330168081f2a7e46f72c7552456d4d604ad27feadbe76ec86598587e\",\n                \"sha256:2605f54a59eca936809baec0b33d9333bc5d3cdc57a9ea6c395abb766bea73ee\",\n                \"sha256:9be53ed84a753f72f253cd789dd306a611d183b306ae265a8b4d7bbd167bac8a\",\n                \"sha256:27947c0376868058509877698b397812424ee477f7fbc3cf76b547777c048410\",\n                \"sha256:f290b03f22dda15089551b9c9b7f43f5e239da5c3c3098c1da84b2e67aa204ee\",\n                \"sha256:9439b4444bd0ad670d99026cdce9c06602863bc37910a0a62a0b9d5f414155b5\",\n                \"sha256:02a354ce9185f87185662d788cc1fcfc16b960bba27aa10d7729db37c395ea58\",\n                \"sha256:662510598bd9d6b1166da778021b98007900dd4313ceed887d8ae0a8f8ff6ae2\"\n            ]\n        }\n    }\n]\n~~~\n\n默认拉取最新的版本是3.7.0，如果想拉取其他版本，可以指定tag。\n\n### 单机\n\n~~~bash\n# 启动容器\ndocker run -d -p 2181:2181 --name standalone-zookeeper --restart always zookeeper\n\n# 查看容器\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES\nd8b7def1982c        zookeeper           \"/docker-entrypoin...\"   28 minutes ago      Up 28 minutes       2888/tcp, 3888/tcp, 0.0.0.0:2181->2181/tcp, 8080/tcp   standalone-zookeeper\nfbf17b466b4a        tomcat              \"catalina.sh run\"        12 hours ago        Up 12 hours         0.0.0.0:8080->8080/tcp                                 tomcat\n\n# 进入容器交互模式\ndocker exec -it standalone-zookeeper bash\n\n# 运行zk客户端\nroot@d8b7def1982c:/apache-zookeeper-3.7.0-bin# ./bin/zkCli.sh\n\n[zk: localhost:2181(CONNECTED) 0] ls /\n[zookeeper]\n[zk: localhost:2181(CONNECTED) 1] quit\n\nWATCHER::\n\nWatchedEvent state:Closed type:None path:null\n2021-09-16 22:35:23,414 [myid:] - INFO  [main:ZooKeeper@1232] - Session: 0x10002a3f7b70002 closed\n2021-09-16 22:35:23,416 [myid:] - ERROR [main:ServiceUtils@42] - Exiting JVM with code 0\n2021-09-16 22:35:23,420 [myid:] - INFO  [main-EventThread:ClientCnxn$EventThread@570] - EventThread shut down for session: 0x10002a3f7b70002\n~~~\n\n查看虚拟机ip\n\n~~~bash\nifconfig\n\nenp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 192.168.56.102  netmask 255.255.255.0  broadcast 192.168.56.255\n        inet6 fe80::f449:6222:f3f0:156b  prefixlen 64  scopeid 0x20<link>\n        ether 08:00:27:a3:2c:01  txqueuelen 1000  (Ethernet)\n        RX packets 315193  bytes 24898970 (23.7 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 281868  bytes 59276159 (56.5 MiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n~~~\n\n外部访问地址：192.168.56.102:2181\n\n\n\n### 集群\n\n**环境**：单台宿主机（`192.168.1.9`），启动三个zookeeper容器。\n\n**这里涉及的问题，就是docker容器之前通信的问题，这个很重要。**\n\n~~~bash\n[root@localhost ~]# docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\nf7b764ef3634        bridge              bridge              local\n15e39185d267        host                host                local\nfa65da9323b5        none                null                local\n~~~\n\nDocker有三种网络模式，bridge、host、none，在你创建容器的时候，不指定--network默认是bridge。\n\nbridge：为每一个容器分配IP，并将容器连接到一个docker0虚拟网桥，通过docker0网桥与宿主机通信。也就是说，**此模式下，你不能用宿主机的IP+容器映射端口来进行Docker容器之间的通信。**\n\nhost：容器不会虚拟自己的网卡，配置自己的IP，而是使用宿主机的IP和端口。这样一来，**Docker容器之间的通信就可以用宿主机的IP+容器映射端口**\n\nnone：无网络。\n\n---\n\n现在本地创建目录：\n\n~~~bash\n[root@localhost admin]# mkdir /usr/local/zookeeper-cluster\n[root@localhost admin]# mkdir /usr/local/zookeeper-cluster/node1\n[root@localhost admin]# mkdir /usr/local/zookeeper-cluster/node2\n[root@localhost admin]# mkdir /usr/local/zookeeper-cluster/node3\n[root@localhost admin]# ll /usr/local/zookeeper-cluster/\ntotal 0\ndrwxr-xr-x. 2 root root 6 Aug 28 23:02 node1\ndrwxr-xr-x. 2 root root 6 Aug 28 23:02 node2\ndrwxr-xr-x. 2 root root 6 Aug 28 23:02 node3\n~~~\n\n然后执行命令启动：\n\n~~~bash\ndocker run -d -p 2181:2181 -p 2888:2888 -p 3888:3888 --name zookeeper_node1 --privileged --restart always \\\n-v /usr/local/zookeeper-cluster/node1/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node1/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node1/volumes/logs:/logs \\\n-e ZOO_MY_ID=1 \\\n-e \"ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183\" zookeeper\n\ndocker run -d -p 2182:2181 -p 2889:2888 -p 3889:3888 --name zookeeper_node2 --privileged --restart always \\\n-v /usr/local/zookeeper-cluster/node2/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node2/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node2/volumes/logs:/logs \\\n-e ZOO_MY_ID=2 \\\n-e \"ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183\" zookeeper\n\ndocker run -d -p 2183:2181 -p 2890:2888 -p 3890:3888 --name zookeeper_node3 --privileged --restart always \\\n-v /usr/local/zookeeper-cluster/node3/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node3/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node3/volumes/logs:/logs \\\n-e ZOO_MY_ID=3 \\\n-e \"ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183\" zookeeper\n~~~\n\n查看容器启动情况\n\n~~~bash\n[root@localhost admin]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                              NAMES\n6dabae1d92f0        3487af26dee9        \"/docker-entrypoin...\"   31 seconds ago      Up 29 seconds       8080/tcp, 0.0.0.0:2183->2181/tcp, 0.0.0.0:2890->2888/tcp, 0.0.0.0:3890->3888/tcp   zookeeper_node3\ndbb7f1f323a0        3487af26dee9        \"/docker-entrypoin...\"   36 seconds ago      Up 35 seconds       8080/tcp, 0.0.0.0:2182->2181/tcp, 0.0.0.0:2889->2888/tcp, 0.0.0.0:3889->3888/tcp   zookeeper_node2\n4bfa6bbeb936        3487af26dee9        \"/docker-entrypoin...\"   46 seconds ago      Up 45 seconds       0.0.0.0:2181->2181/tcp, 0.0.0.0:2888->2888/tcp, 0.0.0.0:3888->3888/tcp, 8080/tcp   zookeeper_node1\n~~~\n\n我们看下节点1的启动日志\n\n~~~bash\n[root@localhost admin]# docker logs -f zookeeper_node1\nZooKeeper JMX enabled by default\n\n...\n\n2019-08-29 09:20:22,665 [myid:1] - WARN  [WorkerSender[myid=1]:QuorumCnxManager@677] - Cannot open channel to 2 at election address /192.168.1.9:3889\njava.net.ConnectException: Connection refused (Connection refused)\n    at java.net.PlainSocketImpl.socketConnect(Native Method)\n    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)\n    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)\n    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)\n    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n    at java.net.Socket.connect(Socket.java:589)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:648)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:705)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:618)\n    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.process(FastLeaderElection.java:477)\n    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.run(FastLeaderElection.java:456)\n    at java.lang.Thread.run(Thread.java:748)\n2019-08-29 09:20:22,666 [myid:1] - WARN  [WorkerSender[myid=1]:QuorumCnxManager@677] - Cannot open channel to 3 at election address /192.168.192.128:3890\njava.net.ConnectException: Connection refused (Connection refused)\n    at java.net.PlainSocketImpl.socketConnect(Native Method)\n    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)\n    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)\n    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)\n    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)\n    at java.net.Socket.connect(Socket.java:589)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:648)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:705)\n    at org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:618)\n    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.process(FastLeaderElection.java:477)\n    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger$WorkerSender.run(FastLeaderElection.java:456)\n    at java.lang.Thread.run(Thread.java:748)\n~~~\n\n连接不上2 和 3，为什么呢，因为在默认的Docker网络模式下，通过宿主机的IP+映射端口，根本找不到啊！他们有自己的IP啊！如下：\n\n~~~bash\n[root@localhost admin]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                              NAMES\n6dabae1d92f0        3487af26dee9        \"/docker-entrypoin...\"   31 seconds ago      Up 29 seconds       8080/tcp, 0.0.0.0:2183->2181/tcp, 0.0.0.0:2890->2888/tcp, 0.0.0.0:3890->3888/tcp   zookeeper_node3\ndbb7f1f323a0        3487af26dee9        \"/docker-entrypoin...\"   36 seconds ago      Up 35 seconds       8080/tcp, 0.0.0.0:2182->2181/tcp, 0.0.0.0:2889->2888/tcp, 0.0.0.0:3889->3888/tcp   zookeeper_node2\n4bfa6bbeb936        3487af26dee9        \"/docker-entrypoin...\"   46 seconds ago      Up 45 seconds       0.0.0.0:2181->2181/tcp, 0.0.0.0:2888->2888/tcp, 0.0.0.0:3888->3888/tcp, 8080/tcp   zookeeper_node1\n\n[root@localhost ~]# docker inspect zookeeper_node1\n            \"Networks\": {\n                \"bridge\": {\n                    \"IPAMConfig\": null,\n                    \"Links\": null,\n                    \"Aliases\": null,\n                    \"NetworkID\": \"f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e\",\n                    \"EndpointID\": \"dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f\",\n                    \"Gateway\": \"172.17.0.1\",\n                    \"IPAddress\": \"172.17.0.3\",\n                    \"IPPrefixLen\": 16,\n                    \"IPv6Gateway\": \"\",\n                    \"GlobalIPv6Address\": \"\",\n                    \"GlobalIPv6PrefixLen\": 0,\n                    \"MacAddress\": \"02:42:ac:11:00:03\"\n                }\n            }\n        }\n    }\n]\n\n[root@localhost ~]# docker inspect zookeeper_node2\n            \"Networks\": {\n                \"bridge\": {\n                    \"IPAMConfig\": null,\n                    \"Links\": null,\n                    \"Aliases\": null,\n                    \"NetworkID\": \"f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e\",\n                    \"EndpointID\": \"dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f\",\n                    \"Gateway\": \"172.17.0.1\",\n                    \"IPAddress\": \"172.17.0.4\",\n                    \"IPPrefixLen\": 16,\n                    \"IPv6Gateway\": \"\",\n                    \"GlobalIPv6Address\": \"\",\n                    \"GlobalIPv6PrefixLen\": 0,\n                    \"MacAddress\": \"02:42:ac:11:00:03\"\n                }\n            }\n        }\n    }\n]\n\n[root@localhost ~]# docker inspect zookeeper_node3\n            \"Networks\": {\n                \"bridge\": {\n                    \"IPAMConfig\": null,\n                    \"Links\": null,\n                    \"Aliases\": null,\n                    \"NetworkID\": \"f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e\",\n                    \"EndpointID\": \"dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f\",\n                    \"Gateway\": \"172.17.0.1\",\n                    \"IPAddress\": \"172.17.0.5\",\n                    \"IPPrefixLen\": 16,\n                    \"IPv6Gateway\": \"\",\n                    \"GlobalIPv6Address\": \"\",\n                    \"GlobalIPv6PrefixLen\": 0,\n                    \"MacAddress\": \"02:42:ac:11:00:03\"\n                }\n            }\n        }\n    }\n]\n~~~\n\nnode1---172.17.0.3\nnode2---172.17.0.4\nnode3---172.17.0.5\n\n既然我们知道了它有自己的IP，那又出现另一个问题了，就是它的ip是动态的，启动之前我们无法得知。**有个解决办法就是创建自己的bridge网络，然后创建容器的时候指定ip。**\n\n**【正确方式开始】**\n\n~~~bash\n[root@localhost ~]# docker network create --driver bridge --subnet=172.18.0.0/16 --gateway=172.18.0.1 zoonet\n7ca91b6fa816f91b43f04529b74bcd9fa5aadef41cd3b9df7371beb44e83663b\n[root@localhost ~]# docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\nf7b764ef3634        bridge              bridge              local\n15e39185d267        host                host                local\nfa65da9323b5        none                null                local\n7ca91b6fa816        zoonet              bridge              local\n[root@localhost ~]# docker network inspect zoonet\n[\n    {\n        \"Name\": \"zoonet\",\n        \"Id\": \"7ca91b6fa816f91b43f04529b74bcd9fa5aadef41cd3b9df7371beb44e83663b\",\n        \"Created\": \"2021-09-17T07:15:33.177645556+08:00\",\n        \"Scope\": \"local\",\n        \"Driver\": \"bridge\",\n        \"EnableIPv6\": false,\n        \"IPAM\": {\n            \"Driver\": \"default\",\n            \"Options\": {},\n            \"Config\": [\n                {\n                    \"Subnet\": \"172.18.0.0/16\",\n                    \"Gateway\": \"172.18.0.1\"\n                }\n            ]\n        },\n        \"Internal\": false,\n        \"Attachable\": false,\n        \"Containers\": {},\n        \"Options\": {},\n        \"Labels\": {}\n    }\n]\n~~~\n\n然后我们修改一下zookeeper容器的创建命令。【正确命令】\n\n~~~bash\ndocker run -d -p 2181:2181 --name zookeeper_node1 --privileged --restart always --network zoonet --ip 172.18.0.2 \\\n-v /usr/local/zookeeper-cluster/node1/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node1/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node1/volumes/logs:/logs \\\n-e ZOO_MY_ID=1 \\\n-e \"ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181\" zookeeper\n\ndocker run -d -p 2182:2181 --name zookeeper_node2 --privileged --restart always --network zoonet --ip 172.18.0.3 \\\n-v /usr/local/zookeeper-cluster/node2/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node2/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node2/volumes/logs:/logs \\\n-e ZOO_MY_ID=2 \\\n-e \"ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181\" zookeeper\n\ndocker run -d -p 2183:2181 --name zookeeper_node3 --privileged --restart always --network zoonet --ip 172.18.0.4 \\\n-v /usr/local/zookeeper-cluster/node3/volumes/data:/data \\\n-v /usr/local/zookeeper-cluster/node3/volumes/datalog:/datalog \\\n-v /usr/local/zookeeper-cluster/node3/volumes/logs:/logs \\\n-e ZOO_MY_ID=3 \\\n-e \"ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181\" zookeeper\n\n\n[root@localhost ~]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES\n5f35bdd41916        zookeeper           \"/docker-entrypoin...\"   3 minutes ago       Up 3 minutes        2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2183->2181/tcp   zookeeper_node3\nc311e63820af        zookeeper           \"/docker-entrypoin...\"   4 minutes ago       Up 4 minutes        2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2182->2181/tcp   zookeeper_node2\n249fa3c091cd        zookeeper           \"/docker-entrypoin...\"   4 minutes ago       Up 4 minutes        2888/tcp, 3888/tcp, 0.0.0.0:2181->2181/tcp, 8080/tcp   zookeeper_node1\nfbf17b466b4a        tomcat              \"catalina.sh run\"        12 hours ago        Up 12 hours         0.0.0.0:8080->8080/tcp                                 tomcat\n~~~\n\n进入容器内部验证一下：\n\n~~~bash\n[root@localhost ~]# docker exec -it  zookeeper_node1 bash\nroot@249fa3c091cd:/apache-zookeeper-3.7.0-bin# ./bin/zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /conf/zoo.cfg\nClient port found: 2181. Client address: localhost. Client SSL: false.\nMode: follower\nroot@249fa3c091cd:/apache-zookeeper-3.7.0-bin# exit\nexit\n[root@localhost ~]# docker exec -it  zookeeper_node2 bash\nroot@c311e63820af:/apache-zookeeper-3.7.0-bin# ./bin/zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /conf/zoo.cfg\nClient port found: 2181. Client address: localhost. Client SSL: false.\nMode: leader\nroot@c311e63820af:/apache-zookeeper-3.7.0-bin# exit\nexit\n[root@localhost ~]# docker exec -it  zookeeper_node3 bash\nroot@5f35bdd41916:/apache-zookeeper-3.7.0-bin# ./bin/zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /conf/zoo.cfg\nClient port found: 2181. Client address: localhost. Client SSL: false.\nMode: follower\n~~~\n\n在验证一下创建节点：\n\n~~~bash\n# node3\nroot@5f35bdd41916:/apache-zookeeper-3.7.0-bin# ./bin/zkCli.sh \nConnecting to localhost:2181\n2021-09-16 23:32:52,624 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC\n2021-09-16 23:32:52,629 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=5f35bdd41916\n2021-09-16 23:32:52,724 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12\n2021-09-16 23:32:52,727 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation\n2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11\n2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:\n2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib\n2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp\n2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=<NA>\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin\n2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB\n2021-09-16 23:32:52,736 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB\n2021-09-16 23:32:52,736 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB\n2021-09-16 23:32:52,783 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4c70fda8\n2021-09-16 23:32:52,788 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\n2021-09-16 23:32:52,901 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2021-09-16 23:32:53,214 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=false\nWelcome to ZooKeeper!\nJLine support is enabled\n2021-09-16 23:32:53,976 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.\n2021-09-16 23:32:53,979 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2021-09-16 23:32:54,145 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55044, server: localhost/0:0:0:0:0:0:0:1:2181\n2021-09-16 23:32:55,005 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session id = 0x30002ebbd490000, negotiated timeout = 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n[zk: localhost:2181(CONNECTED) 0] ls /\n[zookeeper]\n[zk: localhost:2181(CONNECTED) 1] create /hello\nCreated /hello\n[zk: localhost:2181(CONNECTED) 2] \n\n\n# node1\n[root@localhost ~]# docker exec -it  zookeeper_node1 bash\nroot@249fa3c091cd:/apache-zookeeper-3.7.0-bin# ./bin/zkCli.sh\nConnecting to localhost:2181\n2021-09-16 23:35:28,681 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC\n2021-09-16 23:35:28,783 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=249fa3c091cd\n2021-09-16 23:35:28,783 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12\n2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation\n2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11\n2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:\n2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib\n2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp\n2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=<NA>\n2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux\n2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64\n2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64\n2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root\n2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root\n2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin\n2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB\n2021-09-16 23:35:28,790 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB\n2021-09-16 23:35:28,790 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB\n2021-09-16 23:35:28,896 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4c70fda8\n2021-09-16 23:35:28,950 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\n2021-09-16 23:35:29,052 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2021-09-16 23:35:29,110 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=false\nWelcome to ZooKeeper!\n2021-09-16 23:35:29,483 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.\n2021-09-16 23:35:29,489 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2021-09-16 23:35:29,655 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55046, server: localhost/0:0:0:0:0:0:0:1:2181\nJLine support is enabled\n2021-09-16 23:35:30,522 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session id = 0x10002eb88340000, negotiated timeout = 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n[zk: localhost:2181(CONNECTED) 0] ls /\n[hello, zookeeper]\n[zk: localhost:2181(CONNECTED) 1] \n~~~\n\n**开启防火墙，以供外部访问**\n\n~~~bash\nfirewall-cmd --zone=public --add-port=2181/tcp --permanent\nfirewall-cmd --zone=public --add-port=2182/tcp --permanent\nfirewall-cmd --zone=public --add-port=2183/tcp --permanent\nsystemctl restart firewalld\nfirewall-cmd --list-all\n~~~\n\nMac下载zookeeper,地址:https://www.apache.org/dyn/closer.lua/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz\n\n解压后进入bin目录，执行`sh zkCli.sh -server 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183`\n\n~~~bash\n# 连接server\nbin sh zkCli.sh -server 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183\n\nConnecting to 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183\n2021-09-17 23:26:53,552 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC\n2021-09-17 23:26:53,558 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=192.168.1.9\n2021-09-17 23:26:53,558 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=1.8.0_202\n2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation\n2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/Library/Java/JavaVirtualMachines/jdk1.8.0_202.jdk/Contents/Home/jre\n2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../build/classes:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../conf:\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/Users/xiewei/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/var/folders/b4/9d7gh64s3937fcp3wwd9hvgm0000gn/T/\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=<NA>\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Mac OS X\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=x86_64\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=10.16\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=xiewei\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/Users/xiewei\n2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin\n2021-09-17 23:26:53,568 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=236MB\n2021-09-17 23:26:53,569 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=245MB\n2021-09-17 23:26:53,569 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=245MB\n2021-09-17 23:26:53,575 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@768debd\n2021-09-17 23:26:53,586 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\n2021-09-17 23:26:53,600 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2021-09-17 23:26:53,614 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=false\nWelcome to ZooKeeper!\nJLine support is enabled\n2021-09-17 23:26:53,639 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn$SendThread@1171] - Opening socket connection to server 192.168.56.102/192.168.56.102:2181.\n2021-09-17 23:26:53,639 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2021-09-17 23:26:53,676 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: /192.168.56.1:60556, server: 192.168.56.102/192.168.56.102:2181\n2021-09-17 23:26:53,733 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn$SendThread@1438] - Session establishment complete on server 192.168.56.102/192.168.56.102:2181, session id = 0x10002eb88340001, negotiated timeout = 30000\n[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTING) 0]\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\nls /\n[hello, zookeeper]\n[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTED) 1]\n~~~\n\n\n\n集群安装方式二：通过docker-compose安装\n\n先安装docker-compose:\n\n~~~bash\n[root@localhost admin]# curl -L \"https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   617    0   617    0     0    145      0 --:--:--  0:00:04 --:--:--   145\n100 15.4M  100 15.4M    0     0   131k      0  0:02:00  0:02:00 --:--:--  136k\n\n\n[root@localhost admin]# chmod +x /usr/local/bin/docker-compose\n~~~\n\n检查版本（验证是否安装成功):\n\n~~~bash\n[root@localhost admin]# docker-compose --version\ndocker-compose version 1.24.1, build 4667896b\n~~~\n\n卸载的话：\n\n~~~bash\nrm /usr/local/bin/docker-compose\n~~~\n\n开始配置，新建三个挂载目录：\n\n~~~bash\n[root@localhost zookeeper-cluster]# mkdir /usr/local/zookeeper-cluster/node4\n[root@localhost zookeeper-cluster]# mkdir /usr/local/zookeeper-cluster/node5\n[root@localhost zookeeper-cluster]# mkdir /usr/local/zookeeper-cluster/node6\n~~~\n\n新建任意目录，然后在里面新建一个文件：\n\n~~~bash\n[root@localhost local]# cd /usr/local\n[root@localhost local]# mkdir DockerComposeFolder\n[root@localhost local]# cd DockerComposeFolder\n\n[root@localhost DockerComposeFolder]# vim docker-compose.yml\n~~~\n\n`docker-compose.yml`文件内容如下\n\n~~~yml\nversion: '3.1'\n\nservices:\n  zoo1:\n    image: zookeeper\n    restart: always\n    privileged: true\n    hostname: zoo1\n    ports:\n      - 2181:2181\n    volumes: # 挂载数据\n      - /usr/local/zookeeper-cluster/node4/data:/data\n      - /usr/local/zookeeper-cluster/node4/datalog:/datalog\n    environment:\n      ZOO_MY_ID: 4\n      ZOO_SERVERS: server.4=0.0.0.0:2888:3888;2181 server.5=zoo2:2888:3888;2181 server.6=zoo3:2888:3888;2181\n    networks:\n      default:\n        ipv4_address: 172.18.0.14\n\n  zoo2:\n    image: zookeeper\n    restart: always\n    privileged: true\n    hostname: zoo2\n    ports:\n      - 2182:2181\n    volumes: # 挂载数据\n      - /usr/local/zookeeper-cluster/node5/data:/data\n      - /usr/local/zookeeper-cluster/node5/datalog:/datalog\n    environment:\n      ZOO_MY_ID: 5\n      ZOO_SERVERS: server.4=zoo1:2888:3888;2181 server.5=0.0.0.0:2888:3888;2181 server.6=zoo3:2888:3888;2181\n    networks:\n      default:\n        ipv4_address: 172.18.0.15\n\n  zoo3:\n    image: zookeeper\n    restart: always\n    privileged: true\n    hostname: zoo3\n    ports:\n      - 2183:2181\n    volumes: # 挂载数据\n      - /usr/local/zookeeper-cluster/node6/data:/data\n      - /usr/local/zookeeper-cluster/node6/datalog:/datalog\n    environment:\n      ZOO_MY_ID: 6\n      ZOO_SERVERS: server.4=zoo1:2888:3888;2181 server.5=zoo2:2888:3888;2181 server.6=0.0.0.0:2888:3888;2181\n    networks:\n      default:\n        ipv4_address: 172.18.0.16\n\nnetworks: # 自定义网络\n  default:\n    external:\n      name: zoonet\n~~~\n\n**注意yaml文件里不能有tab，只能有空格。**\n\n关于version与Docker版本的关系如下：\n\n![](https://github.com/lanbai1993/book/blob/master/zookeeper/images/docker-compose-file-format-compatibility.png?raw=true)\n\n 然后执行（-d后台启动）`docker-compose -f docker-compose.yml up -d`\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker-compose -f docker-compose.yml up -d\nCreating dockercomposefolder_zoo2_1 ... done\nCreating dockercomposefolder_zoo3_1 ... done\nCreating dockercomposefolder_zoo1_1 ... done\n~~~\n\n查看已启动的容器\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES\nc1e536397843        zookeeper           \"/docker-entrypoin...\"   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 0.0.0.0:2181->2181/tcp, 8080/tcp   dockercomposefolder_zoo1_1\n65ab984b726f        zookeeper           \"/docker-entrypoin...\"   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2182->2181/tcp   dockercomposefolder_zoo2_1\n553a2e2bc10c        zookeeper           \"/docker-entrypoin...\"   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2183->2181/tcp   dockercomposefolder_zoo3_1\n~~~\n\n进入一个容器\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker exec -it c1e536397843 bash\nroot@zoo1:/apache-zookeeper-3.7.0-bin# ./bin/zkCli.sh\nConnecting to localhost:2181\n2021-09-17 01:45:46,356 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC\n2021-09-17 01:45:46,360 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=zoo1\n2021-09-17 01:45:46,360 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12\n2021-09-17 01:45:46,364 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation\n2021-09-17 01:45:46,364 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11\n2021-09-17 01:45:46,365 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=<NA>\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin\n2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB\n2021-09-17 01:45:46,465 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB\n2021-09-17 01:45:46,465 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB\n2021-09-17 01:45:46,470 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4c70fda8\n2021-09-17 01:45:46,633 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\n2021-09-17 01:45:46,737 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2021-09-17 01:45:46,797 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=false\nWelcome to ZooKeeper!\nJLine support is enabled\n2021-09-17 01:45:47,171 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.\n2021-09-17 01:45:47,232 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2021-09-17 01:45:47,490 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55114, server: localhost/0:0:0:0:0:0:0:1:2181\n2021-09-17 01:45:47,773 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session id = 0x4000359a82b0000, negotiated timeout = 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n[zk: localhost:2181(CONNECTED) 0] ls /\n[zookeeper]\n[zk: localhost:2181(CONNECTED) 1] create /hi\nCreated /hi\n[zk: localhost:2181(CONNECTED) 2] ls /\n[hi, zookeeper]\n~~~\n\n进入另一个容器\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker exec -it 65ab984b726f bash\nroot@zoo2:/apache-zookeeper-3.7.0-bin# ./bin/zkCli.sh\nConnecting to localhost:2181\n2021-09-17 01:48:04,861 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC\n2021-09-17 01:48:04,869 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=zoo2\n2021-09-17 01:48:04,870 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12\n2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation\n2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11\n2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:\n2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=<NA>\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin\n2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB\n2021-09-17 01:48:04,924 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB\n2021-09-17 01:48:04,924 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB\n2021-09-17 01:48:04,970 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@4c70fda8\n2021-09-17 01:48:05,022 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\n2021-09-17 01:48:05,027 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes\n2021-09-17 01:48:05,087 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=false\nWelcome to ZooKeeper!\n2021-09-17 01:48:05,464 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1171] - Opening socket connection to server localhost/127.0.0.1:2181.\n2021-09-17 01:48:05,465 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)\n2021-09-17 01:48:05,622 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1005] - Socket connection established, initiating session, client: /127.0.0.1:53278, server: localhost/127.0.0.1:2181\nJLine support is enabled\n2021-09-17 01:48:06,168 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1438] - Session establishment complete on server localhost/127.0.0.1:2181, session id = 0x5000359a80d0000, negotiated timeout = 30000\n\nWATCHER::\n\nWatchedEvent state:SyncConnected type:None path:null\n[zk: localhost:2181(CONNECTED) 0] ls /\n[hi, zookeeper]\n~~~\n\n本地客户端连接集群：\n\n~~~bash\nzkCli.cmd -server 192.168.192.128:2181,192.168.192.128:2182,192.168.192.128:2183\n~~~\n\n查看节点信息：\n\n~~~bash\nls /\n[hi, zookeeper]\n[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTED) 1]\n~~~\n\n停止所有活动容器`docker-compose stop`\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker-compose stop\nStopping dockercomposefolder_zoo1_1 ... done\nStopping dockercomposefolder_zoo2_1 ... done\nStopping dockercomposefolder_zoo3_1 ... done\n~~~\n\n删除所有已停止的容器\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker-compose rm\nGoing to remove dockercomposefolder_zoo1_1, dockercomposefolder_zoo2_1, dockercomposefolder_zoo3_1\nAre you sure? [yN] y\nRemoving dockercomposefolder_zoo1_1 ... done\nRemoving dockercomposefolder_zoo2_1 ... done\nRemoving dockercomposefolder_zoo3_1 ... done\n~~~\n\n更多docker-compose命令：`docker-compose --help`\n\n~~~bash\n[root@localhost DockerComposeFolder]# docker-compose --help\nDefine and run multi-container applications with Docker.\n\nUsage:\n  docker-compose [-f <arg>...] [options] [COMMAND] [ARGS...]\n  docker-compose -h|--help\n\nOptions:\n  -f, --file FILE             Specify an alternate compose file\n                              (default: docker-compose.yml)\n  -p, --project-name NAME     Specify an alternate project name\n                              (default: directory name)\n  --verbose                   Show more output\n  --log-level LEVEL           Set log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)\n  --no-ansi                   Do not print ANSI control characters\n  -v, --version               Print version and exit\n  -H, --host HOST             Daemon socket to connect to\n\n  --tls                       Use TLS; implied by --tlsverify\n  --tlscacert CA_PATH         Trust certs signed only by this CA\n  --tlscert CLIENT_CERT_PATH  Path to TLS certificate file\n  --tlskey TLS_KEY_PATH       Path to TLS key file\n  --tlsverify                 Use TLS and verify the remote\n  --skip-hostname-check       Don't check the daemon's hostname against the\n                              name specified in the client certificate\n  --project-directory PATH    Specify an alternate working directory\n                              (default: the path of the Compose file)\n  --compatibility             If set, Compose will attempt to convert keys\n                              in v3 files to their non-Swarm equivalent\n\nCommands:\n  build              Build or rebuild services\n  bundle             Generate a Docker bundle from the Compose file\n  config             Validate and view the Compose file\n  create             Create services\n  down               Stop and remove containers, networks, images, and volumes\n  events             Receive real time events from containers\n  exec               Execute a command in a running container\n  help               Get help on a command\n  images             List images\n  kill               Kill containers\n  logs               View output from containers\n  pause              Pause services\n  port               Print the public port for a port binding\n  ps                 List containers\n  pull               Pull service images\n  push               Push service images\n  restart            Restart services\n  rm                 Remove stopped containers\n  run                Run a one-off command\n  scale              Set number of containers for a service\n  start              Start services\n  stop               Stop services\n  top                Display the running processes\n  unpause            Unpause services\n  up                 Create and start containers\n  version            Show the Docker-Compose version information\n~~~\n\n\n\nReference:\n\n> https://www.cnblogs.com/LUA123/p/11428113.html\n>\n> https://www.runoob.com/w3cnote/zookeeper-linux-cluster.html\n","slug":"docker下安装zookeeper(单机&集群)","published":1,"date":"2022-04-20T12:41:20.977Z","updated":"2022-05-04T03:24:48.190Z","_id":"cl2qzftj8008f13no1ubz98r4","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"docker下安装zookeeper\"><a href=\"#docker下安装zookeeper\" class=\"headerlink\" title=\"docker下安装zookeeper\"></a>docker下安装zookeeper</h2><p>启动docker后，先查看zookeeper有哪些选择。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker search zookeeper\t</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191704919.png\"></p>\n<p>选择官方版本，下载</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull zookeeper</span><br></pre></td></tr></table></figure>\n\n<p>查看镜像</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images</span><br><span class=\"line\"></span><br><span class=\"line\">REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">docker.io/tomcat            latest              bb832de23021        2 days ago          680 MB</span><br><span class=\"line\">docker.io/vernemq/vernemq   latest              9ff6861690a3        3 days ago          159 MB</span><br><span class=\"line\">docker.io/zookeeper         latest              2a33b1a1e11a        12 days ago         278 MB</span><br></pre></td></tr></table></figure>\n\n<p><code>docker inspect zookeeper</code>查看镜像详情</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;Id&quot;</span>: <span class=\"string\">&quot;sha256:2a33b1a1e11ad0f64eba1364828fcbd4f60dd0b140e1d32b23c4f22e4c2df31d&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;RepoTags&quot;</span>: [</span><br><span class=\"line\">            <span class=\"string\">&quot;docker.io/zookeeper:latest&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;RepoDigests&quot;</span>: [</span><br><span class=\"line\">            <span class=\"string\">&quot;docker.io/zookeeper@sha256:61463427d81ec53585711fbce35ffea147b52f6c81b9283a67bff82efe9ae202&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;Parent&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Comment&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Created&quot;</span>: <span class=\"string\">&quot;2021-09-04T14:31:04.949531564Z&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Container&quot;</span>: <span class=\"string\">&quot;a4d61f2a3bb7f0a594218851b0215132ea195f57df5d3e1b3a3c78d5d4da4b56&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;ContainerConfig&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;Hostname&quot;</span>: <span class=\"string\">&quot;a4d61f2a3bb7&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Domainname&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;User&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStdin&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStdout&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStderr&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;2181/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;2888/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;3888/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;8080/tcp&quot;</span>: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;Tty&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;OpenStdin&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;StdinOnce&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Env&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;PATH=/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/apache-zookeeper-3.7.0-bin/bin&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;JAVA_HOME=/usr/local/openjdk-11&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;LANG=C.UTF-8&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;JAVA_VERSION=11.0.12&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_CONF_DIR=/conf&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_DATA_DIR=/data&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_DATA_LOG_DIR=/datalog&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_LOG_DIR=/logs&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_TICK_TIME=2000&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_INIT_LIMIT=5&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_SYNC_LIMIT=2&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_AUTOPURGE_PURGEINTERVAL=0&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_AUTOPURGE_SNAPRETAINCOUNT=3&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_MAX_CLIENT_CNXNS=60&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_STANDALONE_ENABLED=true&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_ADMINSERVER_ENABLED=true&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOOCFGDIR=/conf&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;Cmd&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;/bin/sh&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;-c&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;#(nop) &quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;CMD [\\&quot;zkServer.sh\\&quot; \\&quot;start-foreground\\&quot;]&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;Image&quot;</span>: <span class=\"string\">&quot;sha256:83871249bd21f7df0e3f9a25c365f2fe482cd839a62030a8cb819622a61757de&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Volumes&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;/data&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;/datalog&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;/logs&quot;</span>: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;WorkingDir&quot;</span>: <span class=\"string\">&quot;/apache-zookeeper-3.7.0-bin&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Entrypoint&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;/docker-entrypoint.sh&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;OnBuild&quot;</span>: null,</span><br><span class=\"line\">            <span class=\"string\">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;DockerVersion&quot;</span>: <span class=\"string\">&quot;20.10.7&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Author&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Config&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;Hostname&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Domainname&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;User&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStdin&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStdout&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStderr&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;2181/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;2888/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;3888/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;8080/tcp&quot;</span>: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;Tty&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;OpenStdin&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;StdinOnce&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Env&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;PATH=/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/apache-zookeeper-3.7.0-bin/bin&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;JAVA_HOME=/usr/local/openjdk-11&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;LANG=C.UTF-8&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;JAVA_VERSION=11.0.12&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_CONF_DIR=/conf&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_DATA_DIR=/data&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_DATA_LOG_DIR=/datalog&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_LOG_DIR=/logs&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_TICK_TIME=2000&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_INIT_LIMIT=5&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_SYNC_LIMIT=2&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_AUTOPURGE_PURGEINTERVAL=0&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_AUTOPURGE_SNAPRETAINCOUNT=3&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_MAX_CLIENT_CNXNS=60&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_STANDALONE_ENABLED=true&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_ADMINSERVER_ENABLED=true&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOOCFGDIR=/conf&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;Cmd&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;zkServer.sh&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;start-foreground&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;Image&quot;</span>: <span class=\"string\">&quot;sha256:83871249bd21f7df0e3f9a25c365f2fe482cd839a62030a8cb819622a61757de&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Volumes&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;/data&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;/datalog&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;/logs&quot;</span>: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;WorkingDir&quot;</span>: <span class=\"string\">&quot;/apache-zookeeper-3.7.0-bin&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Entrypoint&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;/docker-entrypoint.sh&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;OnBuild&quot;</span>: null,</span><br><span class=\"line\">            <span class=\"string\">&quot;Labels&quot;</span>: null</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;Architecture&quot;</span>: <span class=\"string\">&quot;amd64&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Os&quot;</span>: <span class=\"string\">&quot;linux&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Size&quot;</span>: 277857721,</span><br><span class=\"line\">        <span class=\"string\">&quot;VirtualSize&quot;</span>: 277857721,</span><br><span class=\"line\">        <span class=\"string\">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;Name&quot;</span>: <span class=\"string\">&quot;overlay2&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Data&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;LowerDir&quot;</span>: <span class=\"string\">&quot;/var/lib/docker/overlay2/c23c13970f98f9607674f41df40d0ae9631e3f733beb7f43b534b399903bdb6e/diff:/var/lib/docker/overlay2/edba8275449661a08f98aa8358acccda09f636ff63b62745cf032baaac6a83b6/diff:/var/lib/docker/overlay2/053a067737b9474d966509e0bd2bad945a8783d4b391f68aa250e37d986ca82c/diff:/var/lib/docker/overlay2/60dce72476a90d10650946e1ade294d09f0042dff3600acc0a71b3d0c790672d/diff:/var/lib/docker/overlay2/85c7adba7770d95daed846466aac57e2a5fa73df83387fd5d1edfaf4f2c2247a/diff:/var/lib/docker/overlay2/941d4279fc8ad098fa272415524753d5eae149f1b65dae1c58f358b0dcb25a36/diff:/var/lib/docker/overlay2/6a98f2f2f557a9cacf6487844baad942da9af5fb86263c7640106763ace7f8a7/diff&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;MergedDir&quot;</span>: <span class=\"string\">&quot;/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/merged&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;UpperDir&quot;</span>: <span class=\"string\">&quot;/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/diff&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;WorkDir&quot;</span>: <span class=\"string\">&quot;/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/work&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;RootFS&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;Type&quot;</span>: <span class=\"string\">&quot;layers&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Layers&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:ba5a5fe4330168081f2a7e46f72c7552456d4d604ad27feadbe76ec86598587e&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:2605f54a59eca936809baec0b33d9333bc5d3cdc57a9ea6c395abb766bea73ee&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:9be53ed84a753f72f253cd789dd306a611d183b306ae265a8b4d7bbd167bac8a&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:27947c0376868058509877698b397812424ee477f7fbc3cf76b547777c048410&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:f290b03f22dda15089551b9c9b7f43f5e239da5c3c3098c1da84b2e67aa204ee&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:9439b4444bd0ad670d99026cdce9c06602863bc37910a0a62a0b9d5f414155b5&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:02a354ce9185f87185662d788cc1fcfc16b960bba27aa10d7729db37c395ea58&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:662510598bd9d6b1166da778021b98007900dd4313ceed887d8ae0a8f8ff6ae2&quot;</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>默认拉取最新的版本是3.7.0，如果想拉取其他版本，可以指定tag。</p>\n<h3 id=\"单机\"><a href=\"#单机\" class=\"headerlink\" title=\"单机\"></a>单机</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 启动容器</span></span><br><span class=\"line\">docker run -d -p 2181:2181 --name standalone-zookeeper --restart always zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看容器</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES</span><br><span class=\"line\">d8b7def1982c        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   28 minutes ago      Up 28 minutes       2888/tcp, 3888/tcp, 0.0.0.0:2181-&gt;2181/tcp, 8080/tcp   standalone-zookeeper</span><br><span class=\"line\">fbf17b466b4a        tomcat              <span class=\"string\">&quot;catalina.sh run&quot;</span>        12 hours ago        Up 12 hours         0.0.0.0:8080-&gt;8080/tcp                                 tomcat</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 进入容器交互模式</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it standalone-zookeeper bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 运行zk客户端</span></span><br><span class=\"line\">root@d8b7def1982c:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkCli.sh</span></span><br><span class=\"line\"></span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 0] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[zookeeper]</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 1] quit</span><br><span class=\"line\"></span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:Closed <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\">2021-09-16 22:35:23,414 [myid:] - INFO  [main:ZooKeeper@1232] - Session: 0x10002a3f7b70002 closed</span><br><span class=\"line\">2021-09-16 22:35:23,416 [myid:] - ERROR [main:ServiceUtils@42] - Exiting JVM with code 0</span><br><span class=\"line\">2021-09-16 22:35:23,420 [myid:] - INFO  [main-EventThread:ClientCnxn<span class=\"variable\">$EventThread</span>@570] - EventThread shut down <span class=\"keyword\">for</span> session: 0x10002a3f7b70002</span><br></pre></td></tr></table></figure>\n\n<p>查看虚拟机ip</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ifconfig</span><br><span class=\"line\"></span><br><span class=\"line\">enp0s8: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class=\"line\">        inet 192.168.56.102  netmask 255.255.255.0  broadcast 192.168.56.255</span><br><span class=\"line\">        inet6 fe80::f449:6222:f3f0:156b  prefixlen 64  scopeid 0x20&lt;<span class=\"built_in\">link</span>&gt;</span><br><span class=\"line\">        ether 08:00:27:a3:2c:01  txqueuelen 1000  (Ethernet)</span><br><span class=\"line\">        RX packets 315193  bytes 24898970 (23.7 MiB)</span><br><span class=\"line\">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class=\"line\">        TX packets 281868  bytes 59276159 (56.5 MiB)</span><br><span class=\"line\">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>\n\n<p>外部访问地址：192.168.56.102:2181</p>\n<h3 id=\"集群\"><a href=\"#集群\" class=\"headerlink\" title=\"集群\"></a>集群</h3><p><strong>环境</strong>：单台宿主机（<code>192.168.1.9</code>），启动三个zookeeper容器。</p>\n<p><strong>这里涉及的问题，就是docker容器之前通信的问题，这个很重要。</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker network ls</span></span><br><span class=\"line\">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class=\"line\">f7b764ef3634        bridge              bridge              <span class=\"built_in\">local</span></span><br><span class=\"line\">15e39185d267        host                host                <span class=\"built_in\">local</span></span><br><span class=\"line\">fa65da9323b5        none                null                <span class=\"built_in\">local</span></span><br></pre></td></tr></table></figure>\n\n<p>Docker有三种网络模式，bridge、host、none，在你创建容器的时候，不指定–network默认是bridge。</p>\n<p>bridge：为每一个容器分配IP，并将容器连接到一个docker0虚拟网桥，通过docker0网桥与宿主机通信。也就是说，<strong>此模式下，你不能用宿主机的IP+容器映射端口来进行Docker容器之间的通信。</strong></p>\n<p>host：容器不会虚拟自己的网卡，配置自己的IP，而是使用宿主机的IP和端口。这样一来，<strong>Docker容器之间的通信就可以用宿主机的IP+容器映射端口</strong></p>\n<p>none：无网络。</p>\n<hr>\n<p>现在本地创建目录：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster</span></span><br><span class=\"line\">[root@localhost admin]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node1</span></span><br><span class=\"line\">[root@localhost admin]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node2</span></span><br><span class=\"line\">[root@localhost admin]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node3</span></span><br><span class=\"line\">[root@localhost admin]<span class=\"comment\"># ll /usr/local/zookeeper-cluster/</span></span><br><span class=\"line\">total 0</span><br><span class=\"line\">drwxr-xr-x. 2 root root 6 Aug 28 23:02 node1</span><br><span class=\"line\">drwxr-xr-x. 2 root root 6 Aug 28 23:02 node2</span><br><span class=\"line\">drwxr-xr-x. 2 root root 6 Aug 28 23:02 node3</span><br></pre></td></tr></table></figure>\n\n<p>然后执行命令启动：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -p 2181:2181 -p 2888:2888 -p 3888:3888 --name zookeeper_node1 --privileged --restart always \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=1 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183&quot;</span> zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d -p 2182:2181 -p 2889:2888 -p 3889:3888 --name zookeeper_node2 --privileged --restart always \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=2 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183&quot;</span> zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d -p 2183:2181 -p 2890:2888 -p 3890:3888 --name zookeeper_node3 --privileged --restart always \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=3 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183&quot;</span> zookeeper</span><br></pre></td></tr></table></figure>\n\n<p>查看容器启动情况</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                              NAMES</span><br><span class=\"line\">6dabae1d92f0        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   31 seconds ago      Up 29 seconds       8080/tcp, 0.0.0.0:2183-&gt;2181/tcp, 0.0.0.0:2890-&gt;2888/tcp, 0.0.0.0:3890-&gt;3888/tcp   zookeeper_node3</span><br><span class=\"line\">dbb7f1f323a0        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   36 seconds ago      Up 35 seconds       8080/tcp, 0.0.0.0:2182-&gt;2181/tcp, 0.0.0.0:2889-&gt;2888/tcp, 0.0.0.0:3889-&gt;3888/tcp   zookeeper_node2</span><br><span class=\"line\">4bfa6bbeb936        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   46 seconds ago      Up 45 seconds       0.0.0.0:2181-&gt;2181/tcp, 0.0.0.0:2888-&gt;2888/tcp, 0.0.0.0:3888-&gt;3888/tcp, 8080/tcp   zookeeper_node1</span><br></pre></td></tr></table></figure>\n\n<p>我们看下节点1的启动日志</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># docker logs -f zookeeper_node1</span></span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">2019-08-29 09:20:22,665 [myid:1] - WARN  [WorkerSender[myid=1]:QuorumCnxManager@677] - Cannot open channel to 2 at election address /192.168.1.9:3889</span><br><span class=\"line\">java.net.ConnectException: Connection refused (Connection refused)</span><br><span class=\"line\">    at java.net.PlainSocketImpl.socketConnect(Native Method)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)</span><br><span class=\"line\">    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)</span><br><span class=\"line\">    at java.net.Socket.connect(Socket.java:589)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:648)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:705)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:618)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger<span class=\"variable\">$WorkerSender</span>.process(FastLeaderElection.java:477)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger<span class=\"variable\">$WorkerSender</span>.run(FastLeaderElection.java:456)</span><br><span class=\"line\">    at java.lang.Thread.run(Thread.java:748)</span><br><span class=\"line\">2019-08-29 09:20:22,666 [myid:1] - WARN  [WorkerSender[myid=1]:QuorumCnxManager@677] - Cannot open channel to 3 at election address /192.168.192.128:3890</span><br><span class=\"line\">java.net.ConnectException: Connection refused (Connection refused)</span><br><span class=\"line\">    at java.net.PlainSocketImpl.socketConnect(Native Method)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)</span><br><span class=\"line\">    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)</span><br><span class=\"line\">    at java.net.Socket.connect(Socket.java:589)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:648)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:705)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:618)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger<span class=\"variable\">$WorkerSender</span>.process(FastLeaderElection.java:477)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger<span class=\"variable\">$WorkerSender</span>.run(FastLeaderElection.java:456)</span><br><span class=\"line\">    at java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure>\n\n<p>连接不上2 和 3，为什么呢，因为在默认的Docker网络模式下，通过宿主机的IP+映射端口，根本找不到啊！他们有自己的IP啊！如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                              NAMES</span><br><span class=\"line\">6dabae1d92f0        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   31 seconds ago      Up 29 seconds       8080/tcp, 0.0.0.0:2183-&gt;2181/tcp, 0.0.0.0:2890-&gt;2888/tcp, 0.0.0.0:3890-&gt;3888/tcp   zookeeper_node3</span><br><span class=\"line\">dbb7f1f323a0        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   36 seconds ago      Up 35 seconds       8080/tcp, 0.0.0.0:2182-&gt;2181/tcp, 0.0.0.0:2889-&gt;2888/tcp, 0.0.0.0:3889-&gt;3888/tcp   zookeeper_node2</span><br><span class=\"line\">4bfa6bbeb936        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   46 seconds ago      Up 45 seconds       0.0.0.0:2181-&gt;2181/tcp, 0.0.0.0:2888-&gt;2888/tcp, 0.0.0.0:3888-&gt;3888/tcp, 8080/tcp   zookeeper_node1</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker inspect zookeeper_node1</span></span><br><span class=\"line\">            <span class=\"string\">&quot;Networks&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;bridge&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAMConfig&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Links&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Aliases&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;NetworkID&quot;</span>: <span class=\"string\">&quot;f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;EndpointID&quot;</span>: <span class=\"string\">&quot;dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Gateway&quot;</span>: <span class=\"string\">&quot;172.17.0.1&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAddress&quot;</span>: <span class=\"string\">&quot;172.17.0.3&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPv6Gateway&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6Address&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class=\"line\">                    <span class=\"string\">&quot;MacAddress&quot;</span>: <span class=\"string\">&quot;02:42:ac:11:00:03&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker inspect zookeeper_node2</span></span><br><span class=\"line\">            <span class=\"string\">&quot;Networks&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;bridge&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAMConfig&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Links&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Aliases&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;NetworkID&quot;</span>: <span class=\"string\">&quot;f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;EndpointID&quot;</span>: <span class=\"string\">&quot;dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Gateway&quot;</span>: <span class=\"string\">&quot;172.17.0.1&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAddress&quot;</span>: <span class=\"string\">&quot;172.17.0.4&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPv6Gateway&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6Address&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class=\"line\">                    <span class=\"string\">&quot;MacAddress&quot;</span>: <span class=\"string\">&quot;02:42:ac:11:00:03&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker inspect zookeeper_node3</span></span><br><span class=\"line\">            <span class=\"string\">&quot;Networks&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;bridge&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAMConfig&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Links&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Aliases&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;NetworkID&quot;</span>: <span class=\"string\">&quot;f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;EndpointID&quot;</span>: <span class=\"string\">&quot;dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Gateway&quot;</span>: <span class=\"string\">&quot;172.17.0.1&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAddress&quot;</span>: <span class=\"string\">&quot;172.17.0.5&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPv6Gateway&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6Address&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class=\"line\">                    <span class=\"string\">&quot;MacAddress&quot;</span>: <span class=\"string\">&quot;02:42:ac:11:00:03&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>node1—172.17.0.3<br>node2—172.17.0.4<br>node3—172.17.0.5</p>\n<p>既然我们知道了它有自己的IP，那又出现另一个问题了，就是它的ip是动态的，启动之前我们无法得知。<strong>有个解决办法就是创建自己的bridge网络，然后创建容器的时候指定ip。</strong></p>\n<p><strong>【正确方式开始】</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker network create --driver bridge --subnet=172.18.0.0/16 --gateway=172.18.0.1 zoonet</span></span><br><span class=\"line\">7ca91b6fa816f91b43f04529b74bcd9fa5aadef41cd3b9df7371beb44e83663b</span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker network ls</span></span><br><span class=\"line\">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class=\"line\">f7b764ef3634        bridge              bridge              <span class=\"built_in\">local</span></span><br><span class=\"line\">15e39185d267        host                host                <span class=\"built_in\">local</span></span><br><span class=\"line\">fa65da9323b5        none                null                <span class=\"built_in\">local</span></span><br><span class=\"line\">7ca91b6fa816        zoonet              bridge              <span class=\"built_in\">local</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker network inspect zoonet</span></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;Name&quot;</span>: <span class=\"string\">&quot;zoonet&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Id&quot;</span>: <span class=\"string\">&quot;7ca91b6fa816f91b43f04529b74bcd9fa5aadef41cd3b9df7371beb44e83663b&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Created&quot;</span>: <span class=\"string\">&quot;2021-09-17T07:15:33.177645556+08:00&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Scope&quot;</span>: <span class=\"string\">&quot;local&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Driver&quot;</span>: <span class=\"string\">&quot;bridge&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;EnableIPv6&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;IPAM&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;Driver&quot;</span>: <span class=\"string\">&quot;default&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;Config&quot;</span>: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;Subnet&quot;</span>: <span class=\"string\">&quot;172.18.0.0/16&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Gateway&quot;</span>: <span class=\"string\">&quot;172.18.0.1&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;Internal&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Attachable&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Containers&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>然后我们修改一下zookeeper容器的创建命令。【正确命令】</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -p 2181:2181 --name zookeeper_node1 --privileged --restart always --network zoonet --ip 172.18.0.2 \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=1 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181&quot;</span> zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d -p 2182:2181 --name zookeeper_node2 --privileged --restart always --network zoonet --ip 172.18.0.3 \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=2 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181&quot;</span> zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d -p 2183:2181 --name zookeeper_node3 --privileged --restart always --network zoonet --ip 172.18.0.4 \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=3 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181&quot;</span> zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES</span><br><span class=\"line\">5f35bdd41916        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   3 minutes ago       Up 3 minutes        2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2183-&gt;2181/tcp   zookeeper_node3</span><br><span class=\"line\">c311e63820af        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   4 minutes ago       Up 4 minutes        2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2182-&gt;2181/tcp   zookeeper_node2</span><br><span class=\"line\">249fa3c091cd        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   4 minutes ago       Up 4 minutes        2888/tcp, 3888/tcp, 0.0.0.0:2181-&gt;2181/tcp, 8080/tcp   zookeeper_node1</span><br><span class=\"line\">fbf17b466b4a        tomcat              <span class=\"string\">&quot;catalina.sh run&quot;</span>        12 hours ago        Up 12 hours         0.0.0.0:8080-&gt;8080/tcp                                 tomcat</span><br></pre></td></tr></table></figure>\n\n<p>进入容器内部验证一下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker exec -it  zookeeper_node1 bash</span></span><br><span class=\"line\">root@249fa3c091cd:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkServer.sh status</span></span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\">Using config: /conf/zoo.cfg</span><br><span class=\"line\">Client port found: 2181. Client address: localhost. Client SSL: <span class=\"literal\">false</span>.</span><br><span class=\"line\">Mode: follower</span><br><span class=\"line\">root@249fa3c091cd:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># exit</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker exec -it  zookeeper_node2 bash</span></span><br><span class=\"line\">root@c311e63820af:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkServer.sh status</span></span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\">Using config: /conf/zoo.cfg</span><br><span class=\"line\">Client port found: 2181. Client address: localhost. Client SSL: <span class=\"literal\">false</span>.</span><br><span class=\"line\">Mode: leader</span><br><span class=\"line\">root@c311e63820af:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># exit</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker exec -it  zookeeper_node3 bash</span></span><br><span class=\"line\">root@5f35bdd41916:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkServer.sh status</span></span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\">Using config: /conf/zoo.cfg</span><br><span class=\"line\">Client port found: 2181. Client address: localhost. Client SSL: <span class=\"literal\">false</span>.</span><br><span class=\"line\">Mode: follower</span><br></pre></td></tr></table></figure>\n\n<p>在验证一下创建节点：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># node3</span></span><br><span class=\"line\">root@5f35bdd41916:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkCli.sh </span></span><br><span class=\"line\">Connecting to localhost:2181</span><br><span class=\"line\">2021-09-16 23:32:52,624 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC</span><br><span class=\"line\">2021-09-16 23:32:52,629 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=5f35bdd41916</span><br><span class=\"line\">2021-09-16 23:32:52,724 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12</span><br><span class=\"line\">2021-09-16 23:32:52,727 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation</span><br><span class=\"line\">2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11</span><br><span class=\"line\">2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:</span><br><span class=\"line\">2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class=\"line\">2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp</span><br><span class=\"line\">2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB</span><br><span class=\"line\">2021-09-16 23:32:52,736 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB</span><br><span class=\"line\">2021-09-16 23:32:52,736 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB</span><br><span class=\"line\">2021-09-16 23:32:52,783 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain<span class=\"variable\">$MyWatcher</span>@4c70fda8</span><br><span class=\"line\">2021-09-16 23:32:52,788 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=<span class=\"literal\">true</span> to <span class=\"built_in\">disable</span> client-initiated TLS renegotiation</span><br><span class=\"line\">2021-09-16 23:32:52,901 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes</span><br><span class=\"line\">2021-09-16 23:32:53,214 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=<span class=\"literal\">false</span></span><br><span class=\"line\">Welcome to ZooKeeper!</span><br><span class=\"line\">JLine support is enabled</span><br><span class=\"line\">2021-09-16 23:32:53,976 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.</span><br><span class=\"line\">2021-09-16 23:32:53,979 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)</span><br><span class=\"line\">2021-09-16 23:32:54,145 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55044, server: localhost/0:0:0:0:0:0:0:1:2181</span><br><span class=\"line\">2021-09-16 23:32:55,005 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session <span class=\"built_in\">id</span> = 0x30002ebbd490000, negotiated <span class=\"built_in\">timeout</span> = 30000</span><br><span class=\"line\"></span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:SyncConnected <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 0] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[zookeeper]</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 1] create /hello</span><br><span class=\"line\">Created /hello</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 2] </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># node1</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker exec -it  zookeeper_node1 bash</span></span><br><span class=\"line\">root@249fa3c091cd:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkCli.sh</span></span><br><span class=\"line\">Connecting to localhost:2181</span><br><span class=\"line\">2021-09-16 23:35:28,681 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC</span><br><span class=\"line\">2021-09-16 23:35:28,783 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=249fa3c091cd</span><br><span class=\"line\">2021-09-16 23:35:28,783 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12</span><br><span class=\"line\">2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation</span><br><span class=\"line\">2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11</span><br><span class=\"line\">2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:</span><br><span class=\"line\">2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class=\"line\">2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp</span><br><span class=\"line\">2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class=\"line\">2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux</span><br><span class=\"line\">2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64</span><br><span class=\"line\">2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64</span><br><span class=\"line\">2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root</span><br><span class=\"line\">2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root</span><br><span class=\"line\">2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin</span><br><span class=\"line\">2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB</span><br><span class=\"line\">2021-09-16 23:35:28,790 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB</span><br><span class=\"line\">2021-09-16 23:35:28,790 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB</span><br><span class=\"line\">2021-09-16 23:35:28,896 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain<span class=\"variable\">$MyWatcher</span>@4c70fda8</span><br><span class=\"line\">2021-09-16 23:35:28,950 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=<span class=\"literal\">true</span> to <span class=\"built_in\">disable</span> client-initiated TLS renegotiation</span><br><span class=\"line\">2021-09-16 23:35:29,052 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes</span><br><span class=\"line\">2021-09-16 23:35:29,110 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=<span class=\"literal\">false</span></span><br><span class=\"line\">Welcome to ZooKeeper!</span><br><span class=\"line\">2021-09-16 23:35:29,483 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.</span><br><span class=\"line\">2021-09-16 23:35:29,489 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)</span><br><span class=\"line\">2021-09-16 23:35:29,655 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55046, server: localhost/0:0:0:0:0:0:0:1:2181</span><br><span class=\"line\">JLine support is enabled</span><br><span class=\"line\">2021-09-16 23:35:30,522 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session <span class=\"built_in\">id</span> = 0x10002eb88340000, negotiated <span class=\"built_in\">timeout</span> = 30000</span><br><span class=\"line\"></span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:SyncConnected <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 0] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[hello, zookeeper]</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 1] </span><br></pre></td></tr></table></figure>\n\n<p><strong>开启防火墙，以供外部访问</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=2181/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=2182/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=2183/tcp --permanent</span><br><span class=\"line\">systemctl restart firewalld</span><br><span class=\"line\">firewall-cmd --list-all</span><br></pre></td></tr></table></figure>\n\n<p>Mac下载zookeeper,地址:<a href=\"https://www.apache.org/dyn/closer.lua/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz\">https://www.apache.org/dyn/closer.lua/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz</a></p>\n<p>解压后进入bin目录，执行<code>sh zkCli.sh -server 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 连接server</span></span><br><span class=\"line\">bin sh zkCli.sh -server 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183</span><br><span class=\"line\"></span><br><span class=\"line\">Connecting to 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183</span><br><span class=\"line\">2021-09-17 23:26:53,552 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC</span><br><span class=\"line\">2021-09-17 23:26:53,558 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=192.168.1.9</span><br><span class=\"line\">2021-09-17 23:26:53,558 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=1.8.0_202</span><br><span class=\"line\">2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation</span><br><span class=\"line\">2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/Library/Java/JavaVirtualMachines/jdk1.8.0_202.jdk/Contents/Home/jre</span><br><span class=\"line\">2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../build/classes:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../conf:</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/Users/xiewei/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/var/folders/b4/9d7gh64s3937fcp3wwd9hvgm0000gn/T/</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Mac OS X</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=x86_64</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=10.16</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=xiewei</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/Users/xiewei</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin</span><br><span class=\"line\">2021-09-17 23:26:53,568 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=236MB</span><br><span class=\"line\">2021-09-17 23:26:53,569 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=245MB</span><br><span class=\"line\">2021-09-17 23:26:53,569 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=245MB</span><br><span class=\"line\">2021-09-17 23:26:53,575 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain<span class=\"variable\">$MyWatcher</span>@768debd</span><br><span class=\"line\">2021-09-17 23:26:53,586 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=<span class=\"literal\">true</span> to <span class=\"built_in\">disable</span> client-initiated TLS renegotiation</span><br><span class=\"line\">2021-09-17 23:26:53,600 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes</span><br><span class=\"line\">2021-09-17 23:26:53,614 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=<span class=\"literal\">false</span></span><br><span class=\"line\">Welcome to ZooKeeper!</span><br><span class=\"line\">JLine support is enabled</span><br><span class=\"line\">2021-09-17 23:26:53,639 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1171] - Opening socket connection to server 192.168.56.102/192.168.56.102:2181.</span><br><span class=\"line\">2021-09-17 23:26:53,639 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)</span><br><span class=\"line\">2021-09-17 23:26:53,676 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1005] - Socket connection established, initiating session, client: /192.168.56.1:60556, server: 192.168.56.102/192.168.56.102:2181</span><br><span class=\"line\">2021-09-17 23:26:53,733 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1438] - Session establishment complete on server 192.168.56.102/192.168.56.102:2181, session <span class=\"built_in\">id</span> = 0x10002eb88340001, negotiated <span class=\"built_in\">timeout</span> = 30000</span><br><span class=\"line\">[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTING) 0]</span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:SyncConnected <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\"><span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[hello, zookeeper]</span><br><span class=\"line\">[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTED) 1]</span><br></pre></td></tr></table></figure>\n\n\n\n<p>集群安装方式二：通过docker-compose安装</p>\n<p>先安装docker-compose:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># curl -L &quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span></span><br><span class=\"line\">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class=\"line\">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class=\"line\">100   617    0   617    0     0    145      0 --:--:--  0:00:04 --:--:--   145</span><br><span class=\"line\">100 15.4M  100 15.4M    0     0   131k      0  0:02:00  0:02:00 --:--:--  136k</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost admin]<span class=\"comment\"># chmod +x /usr/local/bin/docker-compose</span></span><br></pre></td></tr></table></figure>\n\n<p>检查版本（验证是否安装成功):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># docker-compose --version</span></span><br><span class=\"line\">docker-compose version 1.24.1, build 4667896b</span><br></pre></td></tr></table></figure>\n\n<p>卸载的话：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">rm</span> /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>\n\n<p>开始配置，新建三个挂载目录：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost zookeeper-cluster]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node4</span></span><br><span class=\"line\">[root@localhost zookeeper-cluster]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node5</span></span><br><span class=\"line\">[root@localhost zookeeper-cluster]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node6</span></span><br></pre></td></tr></table></figure>\n\n<p>新建任意目录，然后在里面新建一个文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost <span class=\"built_in\">local</span>]<span class=\"comment\"># cd /usr/local</span></span><br><span class=\"line\">[root@localhost <span class=\"built_in\">local</span>]<span class=\"comment\"># mkdir DockerComposeFolder</span></span><br><span class=\"line\">[root@localhost <span class=\"built_in\">local</span>]<span class=\"comment\"># cd DockerComposeFolder</span></span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># vim docker-compose.yml</span></span><br></pre></td></tr></table></figure>\n\n<p><code>docker-compose.yml</code>文件内容如下</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.1&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">zoo1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zookeeper</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">zoo1</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">2181</span><span class=\"string\">:2181</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span> <span class=\"comment\"># 挂载数据</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node4/data:/data</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node4/datalog:/datalog</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_MY_ID:</span> <span class=\"number\">4</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_SERVERS:</span> <span class=\"string\">server.4=0.0.0.0:2888:3888;2181</span> <span class=\"string\">server.5=zoo2:2888:3888;2181</span> <span class=\"string\">server.6=zoo3:2888:3888;2181</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">default:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.14</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">zoo2:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zookeeper</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">zoo2</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">2182</span><span class=\"string\">:2181</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span> <span class=\"comment\"># 挂载数据</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node5/data:/data</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node5/datalog:/datalog</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_MY_ID:</span> <span class=\"number\">5</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_SERVERS:</span> <span class=\"string\">server.4=zoo1:2888:3888;2181</span> <span class=\"string\">server.5=0.0.0.0:2888:3888;2181</span> <span class=\"string\">server.6=zoo3:2888:3888;2181</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">default:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.15</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">zoo3:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zookeeper</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">zoo3</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">2183</span><span class=\"string\">:2181</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span> <span class=\"comment\"># 挂载数据</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node6/data:/data</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node6/datalog:/datalog</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_MY_ID:</span> <span class=\"number\">6</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_SERVERS:</span> <span class=\"string\">server.4=zoo1:2888:3888;2181</span> <span class=\"string\">server.5=zoo2:2888:3888;2181</span> <span class=\"string\">server.6=0.0.0.0:2888:3888;2181</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">default:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.16</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span> <span class=\"comment\"># 自定义网络</span></span><br><span class=\"line\">  <span class=\"attr\">default:</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">zoonet</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>注意yaml文件里不能有tab，只能有空格。</strong></p>\n<p>关于version与Docker版本的关系如下：</p>\n<p><img src=\"https://github.com/lanbai1993/book/blob/master/zookeeper/images/docker-compose-file-format-compatibility.png?raw=true\"></p>\n<p> 然后执行（-d后台启动）<code>docker-compose -f docker-compose.yml up -d</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker-compose -f docker-compose.yml up -d</span></span><br><span class=\"line\">Creating dockercomposefolder_zoo2_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Creating dockercomposefolder_zoo3_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Creating dockercomposefolder_zoo1_1 ... <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<p>查看已启动的容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES</span><br><span class=\"line\">c1e536397843        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 0.0.0.0:2181-&gt;2181/tcp, 8080/tcp   dockercomposefolder_zoo1_1</span><br><span class=\"line\">65ab984b726f        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2182-&gt;2181/tcp   dockercomposefolder_zoo2_1</span><br><span class=\"line\">553a2e2bc10c        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2183-&gt;2181/tcp   dockercomposefolder_zoo3_1</span><br></pre></td></tr></table></figure>\n\n<p>进入一个容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker exec -it c1e536397843 bash</span></span><br><span class=\"line\">root@zoo1:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkCli.sh</span></span><br><span class=\"line\">Connecting to localhost:2181</span><br><span class=\"line\">2021-09-17 01:45:46,356 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC</span><br><span class=\"line\">2021-09-17 01:45:46,360 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=zoo1</span><br><span class=\"line\">2021-09-17 01:45:46,360 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12</span><br><span class=\"line\">2021-09-17 01:45:46,364 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation</span><br><span class=\"line\">2021-09-17 01:45:46,364 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11</span><br><span class=\"line\">2021-09-17 01:45:46,365 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB</span><br><span class=\"line\">2021-09-17 01:45:46,465 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB</span><br><span class=\"line\">2021-09-17 01:45:46,465 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB</span><br><span class=\"line\">2021-09-17 01:45:46,470 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain<span class=\"variable\">$MyWatcher</span>@4c70fda8</span><br><span class=\"line\">2021-09-17 01:45:46,633 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=<span class=\"literal\">true</span> to <span class=\"built_in\">disable</span> client-initiated TLS renegotiation</span><br><span class=\"line\">2021-09-17 01:45:46,737 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes</span><br><span class=\"line\">2021-09-17 01:45:46,797 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=<span class=\"literal\">false</span></span><br><span class=\"line\">Welcome to ZooKeeper!</span><br><span class=\"line\">JLine support is enabled</span><br><span class=\"line\">2021-09-17 01:45:47,171 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.</span><br><span class=\"line\">2021-09-17 01:45:47,232 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)</span><br><span class=\"line\">2021-09-17 01:45:47,490 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55114, server: localhost/0:0:0:0:0:0:0:1:2181</span><br><span class=\"line\">2021-09-17 01:45:47,773 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session <span class=\"built_in\">id</span> = 0x4000359a82b0000, negotiated <span class=\"built_in\">timeout</span> = 30000</span><br><span class=\"line\"></span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:SyncConnected <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 0] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[zookeeper]</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 1] create /hi</span><br><span class=\"line\">Created /hi</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 2] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[hi, zookeeper]</span><br></pre></td></tr></table></figure>\n\n<p>进入另一个容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker exec -it 65ab984b726f bash</span></span><br><span class=\"line\">root@zoo2:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkCli.sh</span></span><br><span class=\"line\">Connecting to localhost:2181</span><br><span class=\"line\">2021-09-17 01:48:04,861 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC</span><br><span class=\"line\">2021-09-17 01:48:04,869 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=zoo2</span><br><span class=\"line\">2021-09-17 01:48:04,870 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12</span><br><span class=\"line\">2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation</span><br><span class=\"line\">2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11</span><br><span class=\"line\">2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:</span><br><span class=\"line\">2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB</span><br><span class=\"line\">2021-09-17 01:48:04,924 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB</span><br><span class=\"line\">2021-09-17 01:48:04,924 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB</span><br><span class=\"line\">2021-09-17 01:48:04,970 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain<span class=\"variable\">$MyWatcher</span>@4c70fda8</span><br><span class=\"line\">2021-09-17 01:48:05,022 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=<span class=\"literal\">true</span> to <span class=\"built_in\">disable</span> client-initiated TLS renegotiation</span><br><span class=\"line\">2021-09-17 01:48:05,027 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes</span><br><span class=\"line\">2021-09-17 01:48:05,087 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=<span class=\"literal\">false</span></span><br><span class=\"line\">Welcome to ZooKeeper!</span><br><span class=\"line\">2021-09-17 01:48:05,464 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1171] - Opening socket connection to server localhost/127.0.0.1:2181.</span><br><span class=\"line\">2021-09-17 01:48:05,465 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)</span><br><span class=\"line\">2021-09-17 01:48:05,622 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1005] - Socket connection established, initiating session, client: /127.0.0.1:53278, server: localhost/127.0.0.1:2181</span><br><span class=\"line\">JLine support is enabled</span><br><span class=\"line\">2021-09-17 01:48:06,168 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1438] - Session establishment complete on server localhost/127.0.0.1:2181, session <span class=\"built_in\">id</span> = 0x5000359a80d0000, negotiated <span class=\"built_in\">timeout</span> = 30000</span><br><span class=\"line\"></span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:SyncConnected <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 0] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[hi, zookeeper]</span><br></pre></td></tr></table></figure>\n\n<p>本地客户端连接集群：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zkCli.cmd -server 192.168.192.128:2181,192.168.192.128:2182,192.168.192.128:2183</span><br></pre></td></tr></table></figure>\n\n<p>查看节点信息：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[hi, zookeeper]</span><br><span class=\"line\">[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTED) 1]</span><br></pre></td></tr></table></figure>\n\n<p>停止所有活动容器<code>docker-compose stop</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker-compose stop</span></span><br><span class=\"line\">Stopping dockercomposefolder_zoo1_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Stopping dockercomposefolder_zoo2_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Stopping dockercomposefolder_zoo3_1 ... <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<p>删除所有已停止的容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker-compose rm</span></span><br><span class=\"line\">Going to remove dockercomposefolder_zoo1_1, dockercomposefolder_zoo2_1, dockercomposefolder_zoo3_1</span><br><span class=\"line\">Are you sure? [yN] y</span><br><span class=\"line\">Removing dockercomposefolder_zoo1_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Removing dockercomposefolder_zoo2_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Removing dockercomposefolder_zoo3_1 ... <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<p>更多docker-compose命令：<code>docker-compose --help</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker-compose --help</span></span><br><span class=\"line\">Define and run multi-container applications with Docker.</span><br><span class=\"line\"></span><br><span class=\"line\">Usage:</span><br><span class=\"line\">  docker-compose [-f &lt;arg&gt;...] [options] [COMMAND] [ARGS...]</span><br><span class=\"line\">  docker-compose -h|--<span class=\"built_in\">help</span></span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">  -f, --file FILE             Specify an alternate compose file</span><br><span class=\"line\">                              (default: docker-compose.yml)</span><br><span class=\"line\">  -p, --project-name NAME     Specify an alternate project name</span><br><span class=\"line\">                              (default: directory name)</span><br><span class=\"line\">  --verbose                   Show more output</span><br><span class=\"line\">  --log-level LEVEL           Set <span class=\"built_in\">log</span> level (DEBUG, INFO, WARNING, ERROR, CRITICAL)</span><br><span class=\"line\">  --no-ansi                   Do not <span class=\"built_in\">print</span> ANSI control characters</span><br><span class=\"line\">  -v, --version               Print version and <span class=\"built_in\">exit</span></span><br><span class=\"line\">  -H, --host HOST             Daemon socket to connect to</span><br><span class=\"line\"></span><br><span class=\"line\">  --tls                       Use TLS; implied by --tlsverify</span><br><span class=\"line\">  --tlscacert CA_PATH         Trust certs signed only by this CA</span><br><span class=\"line\">  --tlscert CLIENT_CERT_PATH  Path to TLS certificate file</span><br><span class=\"line\">  --tlskey TLS_KEY_PATH       Path to TLS key file</span><br><span class=\"line\">  --tlsverify                 Use TLS and verify the remote</span><br><span class=\"line\">  --skip-hostname-check       Don<span class=\"string\">&#x27;t check the daemon&#x27;</span>s hostname against the</span><br><span class=\"line\">                              name specified <span class=\"keyword\">in</span> the client certificate</span><br><span class=\"line\">  --project-directory PATH    Specify an alternate working directory</span><br><span class=\"line\">                              (default: the path of the Compose file)</span><br><span class=\"line\">  --compatibility             If <span class=\"built_in\">set</span>, Compose will attempt to convert keys</span><br><span class=\"line\">                              <span class=\"keyword\">in</span> v3 files to their non-Swarm equivalent</span><br><span class=\"line\"></span><br><span class=\"line\">Commands:</span><br><span class=\"line\">  build              Build or rebuild services</span><br><span class=\"line\">  bundle             Generate a Docker bundle from the Compose file</span><br><span class=\"line\">  config             Validate and view the Compose file</span><br><span class=\"line\">  create             Create services</span><br><span class=\"line\">  down               Stop and remove containers, networks, images, and volumes</span><br><span class=\"line\">  events             Receive real time events from containers</span><br><span class=\"line\">  <span class=\"built_in\">exec</span>               Execute a <span class=\"built_in\">command</span> <span class=\"keyword\">in</span> a running container</span><br><span class=\"line\">  <span class=\"built_in\">help</span>               Get <span class=\"built_in\">help</span> on a <span class=\"built_in\">command</span></span><br><span class=\"line\">  images             List images</span><br><span class=\"line\">  <span class=\"built_in\">kill</span>               Kill containers</span><br><span class=\"line\">  logs               View output from containers</span><br><span class=\"line\">  pause              Pause services</span><br><span class=\"line\">  port               Print the public port <span class=\"keyword\">for</span> a port binding</span><br><span class=\"line\">  ps                 List containers</span><br><span class=\"line\">  pull               Pull service images</span><br><span class=\"line\">  push               Push service images</span><br><span class=\"line\">  restart            Restart services</span><br><span class=\"line\">  <span class=\"built_in\">rm</span>                 Remove stopped containers</span><br><span class=\"line\">  run                Run a one-off <span class=\"built_in\">command</span></span><br><span class=\"line\">  scale              Set number of containers <span class=\"keyword\">for</span> a service</span><br><span class=\"line\">  start              Start services</span><br><span class=\"line\">  stop               Stop services</span><br><span class=\"line\">  top                Display the running processes</span><br><span class=\"line\">  unpause            Unpause services</span><br><span class=\"line\">  up                 Create and start containers</span><br><span class=\"line\">  version            Show the Docker-Compose version information</span><br></pre></td></tr></table></figure>\n\n\n\n<p>Reference:</p>\n<blockquote>\n<p><a href=\"https://www.cnblogs.com/LUA123/p/11428113.html\">https://www.cnblogs.com/LUA123/p/11428113.html</a></p>\n<p><a href=\"https://www.runoob.com/w3cnote/zookeeper-linux-cluster.html\">https://www.runoob.com/w3cnote/zookeeper-linux-cluster.html</a></p>\n</blockquote>\n","site":{"data":{"link":[{"class_name":"前沿技术","class_desc":"那些人，那些事","link_list":[{"name":"美团前沿技术","link":"https://tech.meituan.com/","avatar":"/img/美团.png","descr":"了解美团相关前沿技术"}]},{"class_name":"工具","link_list":[{"name":"Draw IO","link":"https://www.diagrams.net/","descr":""},{"name":"菜鸟教程","link":"https://www.runoob.com/","descr":""},{"name":"Idea Theme","link":"https://plugins.jetbrains.com/search?tags=Theme","descr":""},{"name":"Typora picGo","link":"https://juejin.cn/post/6847902225881104397","descr":""},{"name":"内网穿透","link":"https://natapp.cn/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"Ip Address","link":"https://www.ipaddress.com/","descr":""},{"name":"MacWK 软件","link":"https://www.macwk.com/","descr":""},{"name":"MVN Repository","link":"https://mvnrepository.com/","descr":""},{"name":"Jwt Token解析","link":"https://jwt.io/","descr":""},{"name":"font icons","link":"https://fontawesome.com/","descr":""},{"name":"icon 素材库","link":"https://www.iconfont.cn/","descr":""},{"name":"梯子","link":"https://shadowflys.us/user","descr":""}]},{"class_name":"JAVA","link_list":[{"name":"JAVA全栈技术手册","link":"https://pdai.tech/","descr":""},{"name":"Java IO模型","link":"https://youthlql.gitee.io/javayouth/#/docs/netty/Netty%E5%85%A5%E9%97%A8-%E7%AC%AC%E4%B8%80%E8%AF%9D?id=java-nio%e7%bc%96%e7%a8%8b","descr":""},{"name":"Mall商城 Github","link":"https://github.com/macrozheng/mall-learning","descr":""},{"name":"Guava 教程","link":"https://www.yiibai.com/guava/guava_charmatcher.html","descr":""},{"name":"Java设计模式","link":"https://www.journaldev.com/1827/java-design-patterns-example-tutorial","descr":""},{"name":"Kan cloud 看云 - SpringBoot","link":"https://www.kancloud.cn/explore","descr":""},{"name":"KeyCloak 文档","link":"https://www.keycloak.org/docs/latest/authorization_services/index.html#_service_rpt_overview","descr":""},{"name":"RabbitMQ 入门","link":"https://blog.csdn.net/kavito/article/details/91403659","descr":""}]},{"class_name":"Go","link_list":[{"name":"地鼠文档","link":"https://www.topgoer.cn/","descr":""},{"name":"Go 高级编程","link":"https://chai2010.gitbooks.io/advanced-go-programming-book/content/","descr":""}]},{"class_name":"文档","link_list":[{"name":"NestJS 文档","link":"https://nestjs.bootcss.com/","descr":""},{"name":"Vuetify 文档","link":"https://vuetifyjs.com/en/","descr":""},{"name":"CDNJS 搜索","link":"https://cdnjs.com/libraries/vuetify/2.6.3","descr":""},{"name":"Flutter 文档","link":"https://docs.flutter.dev/get-started/install","descr":""},{"name":"Openresty最佳实践","link":"https://moonbingbing.gitbooks.io/openresty-best-practices/content/openresty/helloworld.html","descr":""},{"name":"Nginx 官方文档","link":"http://nginx.org/en/docs/","descr":""},{"name":"Nginx 运维手册","link":"http://www.sunrisenan.com/docs/nginx/nginx-1b0ic2kuthbau","descr":""},{"name":"Nginx 极简教程","link":"https://github.com/dunwu/nginx-tutorial","descr":""},{"name":"linux教程","link":"http://c.biancheng.net/linux_tutorial/text_processing/","descr":""},{"name":"Docker Hub","link":"https://hub.docker.com/","descr":""},{"name":"Docker 从入门到实践","link":"https://yeasy.gitbook.io/docker_practice/","descr":""},{"name":"Docker到Kubernetes进阶","link":"https://www.qikqiak.com/k8s-book/","descr":""},{"name":"Alpine linux lib","link":"https://pkgs.alpinelinux.org/packages?name=gettext&branch=v3.14","descr":""},{"name":"GitBook简明教程","link":"https://www.chengweiyang.cn/gitbook/gitbook.com/newbook.html","descr":""},{"name":"Hexo docs","link":"https://hexo.io/docs/","descr":""}]},{"class_name":"面试","link_list":[{"name":"常用网址、面试合集","link":"https://istio.tech/about/","descr":""},{"name":"常见技术手册","link":"https://book.altitude.xin/home/#/chapter/e0bdafd906cb5c53ec1eb77b65b6a764","descr":""}]},{"class_name":"视频网站","class_desc":"值得推薦的網站","link_list":[{"name":"Youtube","link":"https://www.youtube.com/","avatar":"https://i.loli.net/2020/05/14/9ZkGg8v3azHJfM1.png","descr":"視頻網站"},{"name":"Weibo","link":"https://www.weibo.com/","avatar":"https://i.loli.net/2020/05/14/TLJBum386vcnI1P.png","descr":"中國最大社交分享平臺"},{"name":"Twitter","link":"https://twitter.com/","avatar":"https://i.loli.net/2020/05/14/5VyHPQqR6LWF39a.png","descr":"社交分享平臺"}]}]}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<h2 id=\"docker下安装zookeeper\"><a href=\"#docker下安装zookeeper\" class=\"headerlink\" title=\"docker下安装zookeeper\"></a>docker下安装zookeeper</h2><p>启动docker后，先查看zookeeper有哪些选择。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker search zookeeper\t</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://raw.githubusercontent.com/xzyup/image/master/202203191704919.png\"></p>\n<p>选择官方版本，下载</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull zookeeper</span><br></pre></td></tr></table></figure>\n\n<p>查看镜像</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker images</span><br><span class=\"line\"></span><br><span class=\"line\">REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE</span><br><span class=\"line\">docker.io/tomcat            latest              bb832de23021        2 days ago          680 MB</span><br><span class=\"line\">docker.io/vernemq/vernemq   latest              9ff6861690a3        3 days ago          159 MB</span><br><span class=\"line\">docker.io/zookeeper         latest              2a33b1a1e11a        12 days ago         278 MB</span><br></pre></td></tr></table></figure>\n\n<p><code>docker inspect zookeeper</code>查看镜像详情</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;Id&quot;</span>: <span class=\"string\">&quot;sha256:2a33b1a1e11ad0f64eba1364828fcbd4f60dd0b140e1d32b23c4f22e4c2df31d&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;RepoTags&quot;</span>: [</span><br><span class=\"line\">            <span class=\"string\">&quot;docker.io/zookeeper:latest&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;RepoDigests&quot;</span>: [</span><br><span class=\"line\">            <span class=\"string\">&quot;docker.io/zookeeper@sha256:61463427d81ec53585711fbce35ffea147b52f6c81b9283a67bff82efe9ae202&quot;</span></span><br><span class=\"line\">        ],</span><br><span class=\"line\">        <span class=\"string\">&quot;Parent&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Comment&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Created&quot;</span>: <span class=\"string\">&quot;2021-09-04T14:31:04.949531564Z&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Container&quot;</span>: <span class=\"string\">&quot;a4d61f2a3bb7f0a594218851b0215132ea195f57df5d3e1b3a3c78d5d4da4b56&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;ContainerConfig&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;Hostname&quot;</span>: <span class=\"string\">&quot;a4d61f2a3bb7&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Domainname&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;User&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStdin&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStdout&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStderr&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;2181/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;2888/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;3888/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;8080/tcp&quot;</span>: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;Tty&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;OpenStdin&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;StdinOnce&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Env&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;PATH=/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/apache-zookeeper-3.7.0-bin/bin&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;JAVA_HOME=/usr/local/openjdk-11&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;LANG=C.UTF-8&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;JAVA_VERSION=11.0.12&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_CONF_DIR=/conf&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_DATA_DIR=/data&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_DATA_LOG_DIR=/datalog&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_LOG_DIR=/logs&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_TICK_TIME=2000&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_INIT_LIMIT=5&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_SYNC_LIMIT=2&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_AUTOPURGE_PURGEINTERVAL=0&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_AUTOPURGE_SNAPRETAINCOUNT=3&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_MAX_CLIENT_CNXNS=60&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_STANDALONE_ENABLED=true&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_ADMINSERVER_ENABLED=true&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOOCFGDIR=/conf&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;Cmd&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;/bin/sh&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;-c&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;#(nop) &quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;CMD [\\&quot;zkServer.sh\\&quot; \\&quot;start-foreground\\&quot;]&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;Image&quot;</span>: <span class=\"string\">&quot;sha256:83871249bd21f7df0e3f9a25c365f2fe482cd839a62030a8cb819622a61757de&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Volumes&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;/data&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;/datalog&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;/logs&quot;</span>: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;WorkingDir&quot;</span>: <span class=\"string\">&quot;/apache-zookeeper-3.7.0-bin&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Entrypoint&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;/docker-entrypoint.sh&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;OnBuild&quot;</span>: null,</span><br><span class=\"line\">            <span class=\"string\">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;DockerVersion&quot;</span>: <span class=\"string\">&quot;20.10.7&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Author&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Config&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;Hostname&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Domainname&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;User&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStdin&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStdout&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;AttachStderr&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;ExposedPorts&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;2181/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;2888/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;3888/tcp&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;8080/tcp&quot;</span>: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;Tty&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;OpenStdin&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;StdinOnce&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Env&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;PATH=/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/apache-zookeeper-3.7.0-bin/bin&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;JAVA_HOME=/usr/local/openjdk-11&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;LANG=C.UTF-8&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;JAVA_VERSION=11.0.12&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_CONF_DIR=/conf&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_DATA_DIR=/data&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_DATA_LOG_DIR=/datalog&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_LOG_DIR=/logs&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_TICK_TIME=2000&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_INIT_LIMIT=5&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_SYNC_LIMIT=2&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_AUTOPURGE_PURGEINTERVAL=0&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_AUTOPURGE_SNAPRETAINCOUNT=3&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_MAX_CLIENT_CNXNS=60&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_STANDALONE_ENABLED=true&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOO_ADMINSERVER_ENABLED=true&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;ZOOCFGDIR=/conf&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;Cmd&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;zkServer.sh&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;start-foreground&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;Image&quot;</span>: <span class=\"string\">&quot;sha256:83871249bd21f7df0e3f9a25c365f2fe482cd839a62030a8cb819622a61757de&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Volumes&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;/data&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;/datalog&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">                <span class=\"string\">&quot;/logs&quot;</span>: &#123;&#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;WorkingDir&quot;</span>: <span class=\"string\">&quot;/apache-zookeeper-3.7.0-bin&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Entrypoint&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;/docker-entrypoint.sh&quot;</span></span><br><span class=\"line\">            ],</span><br><span class=\"line\">            <span class=\"string\">&quot;OnBuild&quot;</span>: null,</span><br><span class=\"line\">            <span class=\"string\">&quot;Labels&quot;</span>: null</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;Architecture&quot;</span>: <span class=\"string\">&quot;amd64&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Os&quot;</span>: <span class=\"string\">&quot;linux&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Size&quot;</span>: 277857721,</span><br><span class=\"line\">        <span class=\"string\">&quot;VirtualSize&quot;</span>: 277857721,</span><br><span class=\"line\">        <span class=\"string\">&quot;GraphDriver&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;Name&quot;</span>: <span class=\"string\">&quot;overlay2&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Data&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;LowerDir&quot;</span>: <span class=\"string\">&quot;/var/lib/docker/overlay2/c23c13970f98f9607674f41df40d0ae9631e3f733beb7f43b534b399903bdb6e/diff:/var/lib/docker/overlay2/edba8275449661a08f98aa8358acccda09f636ff63b62745cf032baaac6a83b6/diff:/var/lib/docker/overlay2/053a067737b9474d966509e0bd2bad945a8783d4b391f68aa250e37d986ca82c/diff:/var/lib/docker/overlay2/60dce72476a90d10650946e1ade294d09f0042dff3600acc0a71b3d0c790672d/diff:/var/lib/docker/overlay2/85c7adba7770d95daed846466aac57e2a5fa73df83387fd5d1edfaf4f2c2247a/diff:/var/lib/docker/overlay2/941d4279fc8ad098fa272415524753d5eae149f1b65dae1c58f358b0dcb25a36/diff:/var/lib/docker/overlay2/6a98f2f2f557a9cacf6487844baad942da9af5fb86263c7640106763ace7f8a7/diff&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;MergedDir&quot;</span>: <span class=\"string\">&quot;/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/merged&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;UpperDir&quot;</span>: <span class=\"string\">&quot;/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/diff&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;WorkDir&quot;</span>: <span class=\"string\">&quot;/var/lib/docker/overlay2/72999c7c2abd5117ef5a8c75bd1091e3f0919b10aaf19cb8706c9431e07f24a5/work&quot;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;RootFS&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;Type&quot;</span>: <span class=\"string\">&quot;layers&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Layers&quot;</span>: [</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:ba5a5fe4330168081f2a7e46f72c7552456d4d604ad27feadbe76ec86598587e&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:2605f54a59eca936809baec0b33d9333bc5d3cdc57a9ea6c395abb766bea73ee&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:9be53ed84a753f72f253cd789dd306a611d183b306ae265a8b4d7bbd167bac8a&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:27947c0376868058509877698b397812424ee477f7fbc3cf76b547777c048410&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:f290b03f22dda15089551b9c9b7f43f5e239da5c3c3098c1da84b2e67aa204ee&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:9439b4444bd0ad670d99026cdce9c06602863bc37910a0a62a0b9d5f414155b5&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:02a354ce9185f87185662d788cc1fcfc16b960bba27aa10d7729db37c395ea58&quot;</span>,</span><br><span class=\"line\">                <span class=\"string\">&quot;sha256:662510598bd9d6b1166da778021b98007900dd4313ceed887d8ae0a8f8ff6ae2&quot;</span></span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>默认拉取最新的版本是3.7.0，如果想拉取其他版本，可以指定tag。</p>\n<h3 id=\"单机\"><a href=\"#单机\" class=\"headerlink\" title=\"单机\"></a>单机</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 启动容器</span></span><br><span class=\"line\">docker run -d -p 2181:2181 --name standalone-zookeeper --restart always zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 查看容器</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES</span><br><span class=\"line\">d8b7def1982c        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   28 minutes ago      Up 28 minutes       2888/tcp, 3888/tcp, 0.0.0.0:2181-&gt;2181/tcp, 8080/tcp   standalone-zookeeper</span><br><span class=\"line\">fbf17b466b4a        tomcat              <span class=\"string\">&quot;catalina.sh run&quot;</span>        12 hours ago        Up 12 hours         0.0.0.0:8080-&gt;8080/tcp                                 tomcat</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 进入容器交互模式</span></span><br><span class=\"line\">docker <span class=\"built_in\">exec</span> -it standalone-zookeeper bash</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 运行zk客户端</span></span><br><span class=\"line\">root@d8b7def1982c:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkCli.sh</span></span><br><span class=\"line\"></span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 0] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[zookeeper]</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 1] quit</span><br><span class=\"line\"></span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:Closed <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\">2021-09-16 22:35:23,414 [myid:] - INFO  [main:ZooKeeper@1232] - Session: 0x10002a3f7b70002 closed</span><br><span class=\"line\">2021-09-16 22:35:23,416 [myid:] - ERROR [main:ServiceUtils@42] - Exiting JVM with code 0</span><br><span class=\"line\">2021-09-16 22:35:23,420 [myid:] - INFO  [main-EventThread:ClientCnxn<span class=\"variable\">$EventThread</span>@570] - EventThread shut down <span class=\"keyword\">for</span> session: 0x10002a3f7b70002</span><br></pre></td></tr></table></figure>\n\n<p>查看虚拟机ip</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ifconfig</span><br><span class=\"line\"></span><br><span class=\"line\">enp0s8: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class=\"line\">        inet 192.168.56.102  netmask 255.255.255.0  broadcast 192.168.56.255</span><br><span class=\"line\">        inet6 fe80::f449:6222:f3f0:156b  prefixlen 64  scopeid 0x20&lt;<span class=\"built_in\">link</span>&gt;</span><br><span class=\"line\">        ether 08:00:27:a3:2c:01  txqueuelen 1000  (Ethernet)</span><br><span class=\"line\">        RX packets 315193  bytes 24898970 (23.7 MiB)</span><br><span class=\"line\">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class=\"line\">        TX packets 281868  bytes 59276159 (56.5 MiB)</span><br><span class=\"line\">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>\n\n<p>外部访问地址：192.168.56.102:2181</p>\n<h3 id=\"集群\"><a href=\"#集群\" class=\"headerlink\" title=\"集群\"></a>集群</h3><p><strong>环境</strong>：单台宿主机（<code>192.168.1.9</code>），启动三个zookeeper容器。</p>\n<p><strong>这里涉及的问题，就是docker容器之前通信的问题，这个很重要。</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker network ls</span></span><br><span class=\"line\">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class=\"line\">f7b764ef3634        bridge              bridge              <span class=\"built_in\">local</span></span><br><span class=\"line\">15e39185d267        host                host                <span class=\"built_in\">local</span></span><br><span class=\"line\">fa65da9323b5        none                null                <span class=\"built_in\">local</span></span><br></pre></td></tr></table></figure>\n\n<p>Docker有三种网络模式，bridge、host、none，在你创建容器的时候，不指定–network默认是bridge。</p>\n<p>bridge：为每一个容器分配IP，并将容器连接到一个docker0虚拟网桥，通过docker0网桥与宿主机通信。也就是说，<strong>此模式下，你不能用宿主机的IP+容器映射端口来进行Docker容器之间的通信。</strong></p>\n<p>host：容器不会虚拟自己的网卡，配置自己的IP，而是使用宿主机的IP和端口。这样一来，<strong>Docker容器之间的通信就可以用宿主机的IP+容器映射端口</strong></p>\n<p>none：无网络。</p>\n<hr>\n<p>现在本地创建目录：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster</span></span><br><span class=\"line\">[root@localhost admin]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node1</span></span><br><span class=\"line\">[root@localhost admin]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node2</span></span><br><span class=\"line\">[root@localhost admin]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node3</span></span><br><span class=\"line\">[root@localhost admin]<span class=\"comment\"># ll /usr/local/zookeeper-cluster/</span></span><br><span class=\"line\">total 0</span><br><span class=\"line\">drwxr-xr-x. 2 root root 6 Aug 28 23:02 node1</span><br><span class=\"line\">drwxr-xr-x. 2 root root 6 Aug 28 23:02 node2</span><br><span class=\"line\">drwxr-xr-x. 2 root root 6 Aug 28 23:02 node3</span><br></pre></td></tr></table></figure>\n\n<p>然后执行命令启动：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -p 2181:2181 -p 2888:2888 -p 3888:3888 --name zookeeper_node1 --privileged --restart always \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=1 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183&quot;</span> zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d -p 2182:2181 -p 2889:2888 -p 3889:3888 --name zookeeper_node2 --privileged --restart always \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=2 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183&quot;</span> zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d -p 2183:2181 -p 2890:2888 -p 3890:3888 --name zookeeper_node3 --privileged --restart always \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=3 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=192.168.1.9:2888:3888;2181 server.2=192.168.1.9:2889:3889;2182 server.3=192.168.1.9:2890:3890;2183&quot;</span> zookeeper</span><br></pre></td></tr></table></figure>\n\n<p>查看容器启动情况</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                              NAMES</span><br><span class=\"line\">6dabae1d92f0        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   31 seconds ago      Up 29 seconds       8080/tcp, 0.0.0.0:2183-&gt;2181/tcp, 0.0.0.0:2890-&gt;2888/tcp, 0.0.0.0:3890-&gt;3888/tcp   zookeeper_node3</span><br><span class=\"line\">dbb7f1f323a0        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   36 seconds ago      Up 35 seconds       8080/tcp, 0.0.0.0:2182-&gt;2181/tcp, 0.0.0.0:2889-&gt;2888/tcp, 0.0.0.0:3889-&gt;3888/tcp   zookeeper_node2</span><br><span class=\"line\">4bfa6bbeb936        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   46 seconds ago      Up 45 seconds       0.0.0.0:2181-&gt;2181/tcp, 0.0.0.0:2888-&gt;2888/tcp, 0.0.0.0:3888-&gt;3888/tcp, 8080/tcp   zookeeper_node1</span><br></pre></td></tr></table></figure>\n\n<p>我们看下节点1的启动日志</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># docker logs -f zookeeper_node1</span></span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">2019-08-29 09:20:22,665 [myid:1] - WARN  [WorkerSender[myid=1]:QuorumCnxManager@677] - Cannot open channel to 2 at election address /192.168.1.9:3889</span><br><span class=\"line\">java.net.ConnectException: Connection refused (Connection refused)</span><br><span class=\"line\">    at java.net.PlainSocketImpl.socketConnect(Native Method)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)</span><br><span class=\"line\">    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)</span><br><span class=\"line\">    at java.net.Socket.connect(Socket.java:589)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:648)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:705)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:618)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger<span class=\"variable\">$WorkerSender</span>.process(FastLeaderElection.java:477)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger<span class=\"variable\">$WorkerSender</span>.run(FastLeaderElection.java:456)</span><br><span class=\"line\">    at java.lang.Thread.run(Thread.java:748)</span><br><span class=\"line\">2019-08-29 09:20:22,666 [myid:1] - WARN  [WorkerSender[myid=1]:QuorumCnxManager@677] - Cannot open channel to 3 at election address /192.168.192.128:3890</span><br><span class=\"line\">java.net.ConnectException: Connection refused (Connection refused)</span><br><span class=\"line\">    at java.net.PlainSocketImpl.socketConnect(Native Method)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)</span><br><span class=\"line\">    at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)</span><br><span class=\"line\">    at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)</span><br><span class=\"line\">    at java.net.Socket.connect(Socket.java:589)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:648)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:705)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.QuorumCnxManager.toSend(QuorumCnxManager.java:618)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger<span class=\"variable\">$WorkerSender</span>.process(FastLeaderElection.java:477)</span><br><span class=\"line\">    at org.apache.zookeeper.server.quorum.FastLeaderElection$Messenger<span class=\"variable\">$WorkerSender</span>.run(FastLeaderElection.java:456)</span><br><span class=\"line\">    at java.lang.Thread.run(Thread.java:748)</span><br></pre></td></tr></table></figure>\n\n<p>连接不上2 和 3，为什么呢，因为在默认的Docker网络模式下，通过宿主机的IP+映射端口，根本找不到啊！他们有自己的IP啊！如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                              NAMES</span><br><span class=\"line\">6dabae1d92f0        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   31 seconds ago      Up 29 seconds       8080/tcp, 0.0.0.0:2183-&gt;2181/tcp, 0.0.0.0:2890-&gt;2888/tcp, 0.0.0.0:3890-&gt;3888/tcp   zookeeper_node3</span><br><span class=\"line\">dbb7f1f323a0        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   36 seconds ago      Up 35 seconds       8080/tcp, 0.0.0.0:2182-&gt;2181/tcp, 0.0.0.0:2889-&gt;2888/tcp, 0.0.0.0:3889-&gt;3888/tcp   zookeeper_node2</span><br><span class=\"line\">4bfa6bbeb936        3487af26dee9        <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   46 seconds ago      Up 45 seconds       0.0.0.0:2181-&gt;2181/tcp, 0.0.0.0:2888-&gt;2888/tcp, 0.0.0.0:3888-&gt;3888/tcp, 8080/tcp   zookeeper_node1</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker inspect zookeeper_node1</span></span><br><span class=\"line\">            <span class=\"string\">&quot;Networks&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;bridge&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAMConfig&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Links&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Aliases&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;NetworkID&quot;</span>: <span class=\"string\">&quot;f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;EndpointID&quot;</span>: <span class=\"string\">&quot;dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Gateway&quot;</span>: <span class=\"string\">&quot;172.17.0.1&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAddress&quot;</span>: <span class=\"string\">&quot;172.17.0.3&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPv6Gateway&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6Address&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class=\"line\">                    <span class=\"string\">&quot;MacAddress&quot;</span>: <span class=\"string\">&quot;02:42:ac:11:00:03&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker inspect zookeeper_node2</span></span><br><span class=\"line\">            <span class=\"string\">&quot;Networks&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;bridge&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAMConfig&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Links&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Aliases&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;NetworkID&quot;</span>: <span class=\"string\">&quot;f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;EndpointID&quot;</span>: <span class=\"string\">&quot;dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Gateway&quot;</span>: <span class=\"string\">&quot;172.17.0.1&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAddress&quot;</span>: <span class=\"string\">&quot;172.17.0.4&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPv6Gateway&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6Address&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class=\"line\">                    <span class=\"string\">&quot;MacAddress&quot;</span>: <span class=\"string\">&quot;02:42:ac:11:00:03&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker inspect zookeeper_node3</span></span><br><span class=\"line\">            <span class=\"string\">&quot;Networks&quot;</span>: &#123;</span><br><span class=\"line\">                <span class=\"string\">&quot;bridge&quot;</span>: &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAMConfig&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Links&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Aliases&quot;</span>: null,</span><br><span class=\"line\">                    <span class=\"string\">&quot;NetworkID&quot;</span>: <span class=\"string\">&quot;f7b764ef3634342a04146929ae261dcc759001b312f5400a3639c9d66dcccc7e&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;EndpointID&quot;</span>: <span class=\"string\">&quot;dd9bb88a24375814008903b056447ae85dc5ccc934eb69d80c3dcc71da8b424f&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Gateway&quot;</span>: <span class=\"string\">&quot;172.17.0.1&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPAddress&quot;</span>: <span class=\"string\">&quot;172.17.0.5&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPPrefixLen&quot;</span>: 16,</span><br><span class=\"line\">                    <span class=\"string\">&quot;IPv6Gateway&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6Address&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;GlobalIPv6PrefixLen&quot;</span>: 0,</span><br><span class=\"line\">                    <span class=\"string\">&quot;MacAddress&quot;</span>: <span class=\"string\">&quot;02:42:ac:11:00:03&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>node1—172.17.0.3<br>node2—172.17.0.4<br>node3—172.17.0.5</p>\n<p>既然我们知道了它有自己的IP，那又出现另一个问题了，就是它的ip是动态的，启动之前我们无法得知。<strong>有个解决办法就是创建自己的bridge网络，然后创建容器的时候指定ip。</strong></p>\n<p><strong>【正确方式开始】</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker network create --driver bridge --subnet=172.18.0.0/16 --gateway=172.18.0.1 zoonet</span></span><br><span class=\"line\">7ca91b6fa816f91b43f04529b74bcd9fa5aadef41cd3b9df7371beb44e83663b</span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker network ls</span></span><br><span class=\"line\">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class=\"line\">f7b764ef3634        bridge              bridge              <span class=\"built_in\">local</span></span><br><span class=\"line\">15e39185d267        host                host                <span class=\"built_in\">local</span></span><br><span class=\"line\">fa65da9323b5        none                null                <span class=\"built_in\">local</span></span><br><span class=\"line\">7ca91b6fa816        zoonet              bridge              <span class=\"built_in\">local</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker network inspect zoonet</span></span><br><span class=\"line\">[</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"string\">&quot;Name&quot;</span>: <span class=\"string\">&quot;zoonet&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Id&quot;</span>: <span class=\"string\">&quot;7ca91b6fa816f91b43f04529b74bcd9fa5aadef41cd3b9df7371beb44e83663b&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Created&quot;</span>: <span class=\"string\">&quot;2021-09-17T07:15:33.177645556+08:00&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Scope&quot;</span>: <span class=\"string\">&quot;local&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Driver&quot;</span>: <span class=\"string\">&quot;bridge&quot;</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;EnableIPv6&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;IPAM&quot;</span>: &#123;</span><br><span class=\"line\">            <span class=\"string\">&quot;Driver&quot;</span>: <span class=\"string\">&quot;default&quot;</span>,</span><br><span class=\"line\">            <span class=\"string\">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">            <span class=\"string\">&quot;Config&quot;</span>: [</span><br><span class=\"line\">                &#123;</span><br><span class=\"line\">                    <span class=\"string\">&quot;Subnet&quot;</span>: <span class=\"string\">&quot;172.18.0.0/16&quot;</span>,</span><br><span class=\"line\">                    <span class=\"string\">&quot;Gateway&quot;</span>: <span class=\"string\">&quot;172.18.0.1&quot;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;Internal&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Attachable&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">        <span class=\"string\">&quot;Containers&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;Options&quot;</span>: &#123;&#125;,</span><br><span class=\"line\">        <span class=\"string\">&quot;Labels&quot;</span>: &#123;&#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>然后我们修改一下zookeeper容器的创建命令。【正确命令】</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -p 2181:2181 --name zookeeper_node1 --privileged --restart always --network zoonet --ip 172.18.0.2 \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node1/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=1 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181&quot;</span> zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d -p 2182:2181 --name zookeeper_node2 --privileged --restart always --network zoonet --ip 172.18.0.3 \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node2/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=2 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181&quot;</span> zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\">docker run -d -p 2183:2181 --name zookeeper_node3 --privileged --restart always --network zoonet --ip 172.18.0.4 \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/data:/data \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/datalog:/datalog \\</span><br><span class=\"line\">-v /usr/local/zookeeper-cluster/node3/volumes/logs:/logs \\</span><br><span class=\"line\">-e ZOO_MY_ID=3 \\</span><br><span class=\"line\">-e <span class=\"string\">&quot;ZOO_SERVERS=server.1=172.18.0.2:2888:3888;2181 server.2=172.18.0.3:2888:3888;2181 server.3=172.18.0.4:2888:3888;2181&quot;</span> zookeeper</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES</span><br><span class=\"line\">5f35bdd41916        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   3 minutes ago       Up 3 minutes        2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2183-&gt;2181/tcp   zookeeper_node3</span><br><span class=\"line\">c311e63820af        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   4 minutes ago       Up 4 minutes        2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2182-&gt;2181/tcp   zookeeper_node2</span><br><span class=\"line\">249fa3c091cd        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   4 minutes ago       Up 4 minutes        2888/tcp, 3888/tcp, 0.0.0.0:2181-&gt;2181/tcp, 8080/tcp   zookeeper_node1</span><br><span class=\"line\">fbf17b466b4a        tomcat              <span class=\"string\">&quot;catalina.sh run&quot;</span>        12 hours ago        Up 12 hours         0.0.0.0:8080-&gt;8080/tcp                                 tomcat</span><br></pre></td></tr></table></figure>\n\n<p>进入容器内部验证一下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker exec -it  zookeeper_node1 bash</span></span><br><span class=\"line\">root@249fa3c091cd:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkServer.sh status</span></span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\">Using config: /conf/zoo.cfg</span><br><span class=\"line\">Client port found: 2181. Client address: localhost. Client SSL: <span class=\"literal\">false</span>.</span><br><span class=\"line\">Mode: follower</span><br><span class=\"line\">root@249fa3c091cd:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># exit</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker exec -it  zookeeper_node2 bash</span></span><br><span class=\"line\">root@c311e63820af:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkServer.sh status</span></span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\">Using config: /conf/zoo.cfg</span><br><span class=\"line\">Client port found: 2181. Client address: localhost. Client SSL: <span class=\"literal\">false</span>.</span><br><span class=\"line\">Mode: leader</span><br><span class=\"line\">root@c311e63820af:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># exit</span></span><br><span class=\"line\"><span class=\"built_in\">exit</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker exec -it  zookeeper_node3 bash</span></span><br><span class=\"line\">root@5f35bdd41916:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkServer.sh status</span></span><br><span class=\"line\">ZooKeeper JMX enabled by default</span><br><span class=\"line\">Using config: /conf/zoo.cfg</span><br><span class=\"line\">Client port found: 2181. Client address: localhost. Client SSL: <span class=\"literal\">false</span>.</span><br><span class=\"line\">Mode: follower</span><br></pre></td></tr></table></figure>\n\n<p>在验证一下创建节点：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># node3</span></span><br><span class=\"line\">root@5f35bdd41916:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkCli.sh </span></span><br><span class=\"line\">Connecting to localhost:2181</span><br><span class=\"line\">2021-09-16 23:32:52,624 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC</span><br><span class=\"line\">2021-09-16 23:32:52,629 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=5f35bdd41916</span><br><span class=\"line\">2021-09-16 23:32:52,724 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12</span><br><span class=\"line\">2021-09-16 23:32:52,727 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation</span><br><span class=\"line\">2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11</span><br><span class=\"line\">2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:</span><br><span class=\"line\">2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class=\"line\">2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp</span><br><span class=\"line\">2021-09-16 23:32:52,728 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin</span><br><span class=\"line\">2021-09-16 23:32:52,729 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB</span><br><span class=\"line\">2021-09-16 23:32:52,736 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB</span><br><span class=\"line\">2021-09-16 23:32:52,736 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB</span><br><span class=\"line\">2021-09-16 23:32:52,783 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain<span class=\"variable\">$MyWatcher</span>@4c70fda8</span><br><span class=\"line\">2021-09-16 23:32:52,788 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=<span class=\"literal\">true</span> to <span class=\"built_in\">disable</span> client-initiated TLS renegotiation</span><br><span class=\"line\">2021-09-16 23:32:52,901 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes</span><br><span class=\"line\">2021-09-16 23:32:53,214 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=<span class=\"literal\">false</span></span><br><span class=\"line\">Welcome to ZooKeeper!</span><br><span class=\"line\">JLine support is enabled</span><br><span class=\"line\">2021-09-16 23:32:53,976 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.</span><br><span class=\"line\">2021-09-16 23:32:53,979 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)</span><br><span class=\"line\">2021-09-16 23:32:54,145 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55044, server: localhost/0:0:0:0:0:0:0:1:2181</span><br><span class=\"line\">2021-09-16 23:32:55,005 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session <span class=\"built_in\">id</span> = 0x30002ebbd490000, negotiated <span class=\"built_in\">timeout</span> = 30000</span><br><span class=\"line\"></span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:SyncConnected <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 0] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[zookeeper]</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 1] create /hello</span><br><span class=\"line\">Created /hello</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 2] </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># node1</span></span><br><span class=\"line\">[root@localhost ~]<span class=\"comment\"># docker exec -it  zookeeper_node1 bash</span></span><br><span class=\"line\">root@249fa3c091cd:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkCli.sh</span></span><br><span class=\"line\">Connecting to localhost:2181</span><br><span class=\"line\">2021-09-16 23:35:28,681 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC</span><br><span class=\"line\">2021-09-16 23:35:28,783 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=249fa3c091cd</span><br><span class=\"line\">2021-09-16 23:35:28,783 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12</span><br><span class=\"line\">2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation</span><br><span class=\"line\">2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11</span><br><span class=\"line\">2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:</span><br><span class=\"line\">2021-09-16 23:35:28,785 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class=\"line\">2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp</span><br><span class=\"line\">2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class=\"line\">2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux</span><br><span class=\"line\">2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64</span><br><span class=\"line\">2021-09-16 23:35:28,786 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64</span><br><span class=\"line\">2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root</span><br><span class=\"line\">2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root</span><br><span class=\"line\">2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin</span><br><span class=\"line\">2021-09-16 23:35:28,787 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB</span><br><span class=\"line\">2021-09-16 23:35:28,790 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB</span><br><span class=\"line\">2021-09-16 23:35:28,790 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB</span><br><span class=\"line\">2021-09-16 23:35:28,896 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain<span class=\"variable\">$MyWatcher</span>@4c70fda8</span><br><span class=\"line\">2021-09-16 23:35:28,950 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=<span class=\"literal\">true</span> to <span class=\"built_in\">disable</span> client-initiated TLS renegotiation</span><br><span class=\"line\">2021-09-16 23:35:29,052 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes</span><br><span class=\"line\">2021-09-16 23:35:29,110 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=<span class=\"literal\">false</span></span><br><span class=\"line\">Welcome to ZooKeeper!</span><br><span class=\"line\">2021-09-16 23:35:29,483 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.</span><br><span class=\"line\">2021-09-16 23:35:29,489 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)</span><br><span class=\"line\">2021-09-16 23:35:29,655 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55046, server: localhost/0:0:0:0:0:0:0:1:2181</span><br><span class=\"line\">JLine support is enabled</span><br><span class=\"line\">2021-09-16 23:35:30,522 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session <span class=\"built_in\">id</span> = 0x10002eb88340000, negotiated <span class=\"built_in\">timeout</span> = 30000</span><br><span class=\"line\"></span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:SyncConnected <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 0] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[hello, zookeeper]</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 1] </span><br></pre></td></tr></table></figure>\n\n<p><strong>开启防火墙，以供外部访问</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">firewall-cmd --zone=public --add-port=2181/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=2182/tcp --permanent</span><br><span class=\"line\">firewall-cmd --zone=public --add-port=2183/tcp --permanent</span><br><span class=\"line\">systemctl restart firewalld</span><br><span class=\"line\">firewall-cmd --list-all</span><br></pre></td></tr></table></figure>\n\n<p>Mac下载zookeeper,地址:<a href=\"https://www.apache.org/dyn/closer.lua/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz\">https://www.apache.org/dyn/closer.lua/zookeeper/zookeeper-3.7.0/apache-zookeeper-3.7.0-bin.tar.gz</a></p>\n<p>解压后进入bin目录，执行<code>sh zkCli.sh -server 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 连接server</span></span><br><span class=\"line\">bin sh zkCli.sh -server 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183</span><br><span class=\"line\"></span><br><span class=\"line\">Connecting to 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183</span><br><span class=\"line\">2021-09-17 23:26:53,552 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC</span><br><span class=\"line\">2021-09-17 23:26:53,558 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=192.168.1.9</span><br><span class=\"line\">2021-09-17 23:26:53,558 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=1.8.0_202</span><br><span class=\"line\">2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation</span><br><span class=\"line\">2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/Library/Java/JavaVirtualMachines/jdk1.8.0_202.jdk/Contents/Home/jre</span><br><span class=\"line\">2021-09-17 23:26:53,561 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../build/classes:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin/../conf:</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/Users/xiewei/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/var/folders/b4/9d7gh64s3937fcp3wwd9hvgm0000gn/T/</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Mac OS X</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=x86_64</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=10.16</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=xiewei</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/Users/xiewei</span><br><span class=\"line\">2021-09-17 23:26:53,567 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/Users/xiewei/tools/apache-zookeeper-3.7.0-bin/bin</span><br><span class=\"line\">2021-09-17 23:26:53,568 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=236MB</span><br><span class=\"line\">2021-09-17 23:26:53,569 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=245MB</span><br><span class=\"line\">2021-09-17 23:26:53,569 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=245MB</span><br><span class=\"line\">2021-09-17 23:26:53,575 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain<span class=\"variable\">$MyWatcher</span>@768debd</span><br><span class=\"line\">2021-09-17 23:26:53,586 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=<span class=\"literal\">true</span> to <span class=\"built_in\">disable</span> client-initiated TLS renegotiation</span><br><span class=\"line\">2021-09-17 23:26:53,600 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes</span><br><span class=\"line\">2021-09-17 23:26:53,614 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=<span class=\"literal\">false</span></span><br><span class=\"line\">Welcome to ZooKeeper!</span><br><span class=\"line\">JLine support is enabled</span><br><span class=\"line\">2021-09-17 23:26:53,639 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1171] - Opening socket connection to server 192.168.56.102/192.168.56.102:2181.</span><br><span class=\"line\">2021-09-17 23:26:53,639 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)</span><br><span class=\"line\">2021-09-17 23:26:53,676 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1005] - Socket connection established, initiating session, client: /192.168.56.1:60556, server: 192.168.56.102/192.168.56.102:2181</span><br><span class=\"line\">2021-09-17 23:26:53,733 [myid:192.168.56.102:2181] - INFO  [main-SendThread(192.168.56.102:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1438] - Session establishment complete on server 192.168.56.102/192.168.56.102:2181, session <span class=\"built_in\">id</span> = 0x10002eb88340001, negotiated <span class=\"built_in\">timeout</span> = 30000</span><br><span class=\"line\">[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTING) 0]</span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:SyncConnected <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\"><span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[hello, zookeeper]</span><br><span class=\"line\">[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTED) 1]</span><br></pre></td></tr></table></figure>\n\n\n\n<p>集群安装方式二：通过docker-compose安装</p>\n<p>先安装docker-compose:</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># curl -L &quot;https://github.com/docker/compose/releases/download/1.24.1/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span></span><br><span class=\"line\">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class=\"line\">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class=\"line\">100   617    0   617    0     0    145      0 --:--:--  0:00:04 --:--:--   145</span><br><span class=\"line\">100 15.4M  100 15.4M    0     0   131k      0  0:02:00  0:02:00 --:--:--  136k</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost admin]<span class=\"comment\"># chmod +x /usr/local/bin/docker-compose</span></span><br></pre></td></tr></table></figure>\n\n<p>检查版本（验证是否安装成功):</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost admin]<span class=\"comment\"># docker-compose --version</span></span><br><span class=\"line\">docker-compose version 1.24.1, build 4667896b</span><br></pre></td></tr></table></figure>\n\n<p>卸载的话：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">rm</span> /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>\n\n<p>开始配置，新建三个挂载目录：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost zookeeper-cluster]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node4</span></span><br><span class=\"line\">[root@localhost zookeeper-cluster]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node5</span></span><br><span class=\"line\">[root@localhost zookeeper-cluster]<span class=\"comment\"># mkdir /usr/local/zookeeper-cluster/node6</span></span><br></pre></td></tr></table></figure>\n\n<p>新建任意目录，然后在里面新建一个文件：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost <span class=\"built_in\">local</span>]<span class=\"comment\"># cd /usr/local</span></span><br><span class=\"line\">[root@localhost <span class=\"built_in\">local</span>]<span class=\"comment\"># mkdir DockerComposeFolder</span></span><br><span class=\"line\">[root@localhost <span class=\"built_in\">local</span>]<span class=\"comment\"># cd DockerComposeFolder</span></span><br><span class=\"line\"></span><br><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># vim docker-compose.yml</span></span><br></pre></td></tr></table></figure>\n\n<p><code>docker-compose.yml</code>文件内容如下</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;3.1&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">zoo1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zookeeper</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">zoo1</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">2181</span><span class=\"string\">:2181</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span> <span class=\"comment\"># 挂载数据</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node4/data:/data</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node4/datalog:/datalog</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_MY_ID:</span> <span class=\"number\">4</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_SERVERS:</span> <span class=\"string\">server.4=0.0.0.0:2888:3888;2181</span> <span class=\"string\">server.5=zoo2:2888:3888;2181</span> <span class=\"string\">server.6=zoo3:2888:3888;2181</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">default:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.14</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">zoo2:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zookeeper</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">zoo2</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">2182</span><span class=\"string\">:2181</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span> <span class=\"comment\"># 挂载数据</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node5/data:/data</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node5/datalog:/datalog</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_MY_ID:</span> <span class=\"number\">5</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_SERVERS:</span> <span class=\"string\">server.4=zoo1:2888:3888;2181</span> <span class=\"string\">server.5=0.0.0.0:2888:3888;2181</span> <span class=\"string\">server.6=zoo3:2888:3888;2181</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">default:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.15</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"attr\">zoo3:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">zookeeper</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span></span><br><span class=\"line\">    <span class=\"attr\">privileged:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">hostname:</span> <span class=\"string\">zoo3</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">2183</span><span class=\"string\">:2181</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span> <span class=\"comment\"># 挂载数据</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node6/data:/data</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/usr/local/zookeeper-cluster/node6/datalog:/datalog</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_MY_ID:</span> <span class=\"number\">6</span></span><br><span class=\"line\">      <span class=\"attr\">ZOO_SERVERS:</span> <span class=\"string\">server.4=zoo1:2888:3888;2181</span> <span class=\"string\">server.5=zoo2:2888:3888;2181</span> <span class=\"string\">server.6=0.0.0.0:2888:3888;2181</span></span><br><span class=\"line\">    <span class=\"attr\">networks:</span></span><br><span class=\"line\">      <span class=\"attr\">default:</span></span><br><span class=\"line\">        <span class=\"attr\">ipv4_address:</span> <span class=\"number\">172.18</span><span class=\"number\">.0</span><span class=\"number\">.16</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">networks:</span> <span class=\"comment\"># 自定义网络</span></span><br><span class=\"line\">  <span class=\"attr\">default:</span></span><br><span class=\"line\">    <span class=\"attr\">external:</span></span><br><span class=\"line\">      <span class=\"attr\">name:</span> <span class=\"string\">zoonet</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>注意yaml文件里不能有tab，只能有空格。</strong></p>\n<p>关于version与Docker版本的关系如下：</p>\n<p><img src=\"https://github.com/lanbai1993/book/blob/master/zookeeper/images/docker-compose-file-format-compatibility.png?raw=true\"></p>\n<p> 然后执行（-d后台启动）<code>docker-compose -f docker-compose.yml up -d</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker-compose -f docker-compose.yml up -d</span></span><br><span class=\"line\">Creating dockercomposefolder_zoo2_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Creating dockercomposefolder_zoo3_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Creating dockercomposefolder_zoo1_1 ... <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<p>查看已启动的容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker ps</span></span><br><span class=\"line\">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                  NAMES</span><br><span class=\"line\">c1e536397843        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 0.0.0.0:2181-&gt;2181/tcp, 8080/tcp   dockercomposefolder_zoo1_1</span><br><span class=\"line\">65ab984b726f        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2182-&gt;2181/tcp   dockercomposefolder_zoo2_1</span><br><span class=\"line\">553a2e2bc10c        zookeeper           <span class=\"string\">&quot;/docker-entrypoin...&quot;</span>   21 minutes ago      Up 20 minutes       2888/tcp, 3888/tcp, 8080/tcp, 0.0.0.0:2183-&gt;2181/tcp   dockercomposefolder_zoo3_1</span><br></pre></td></tr></table></figure>\n\n<p>进入一个容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker exec -it c1e536397843 bash</span></span><br><span class=\"line\">root@zoo1:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkCli.sh</span></span><br><span class=\"line\">Connecting to localhost:2181</span><br><span class=\"line\">2021-09-17 01:45:46,356 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC</span><br><span class=\"line\">2021-09-17 01:45:46,360 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=zoo1</span><br><span class=\"line\">2021-09-17 01:45:46,360 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12</span><br><span class=\"line\">2021-09-17 01:45:46,364 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation</span><br><span class=\"line\">2021-09-17 01:45:46,364 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11</span><br><span class=\"line\">2021-09-17 01:45:46,365 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin</span><br><span class=\"line\">2021-09-17 01:45:46,462 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB</span><br><span class=\"line\">2021-09-17 01:45:46,465 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB</span><br><span class=\"line\">2021-09-17 01:45:46,465 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB</span><br><span class=\"line\">2021-09-17 01:45:46,470 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain<span class=\"variable\">$MyWatcher</span>@4c70fda8</span><br><span class=\"line\">2021-09-17 01:45:46,633 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=<span class=\"literal\">true</span> to <span class=\"built_in\">disable</span> client-initiated TLS renegotiation</span><br><span class=\"line\">2021-09-17 01:45:46,737 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes</span><br><span class=\"line\">2021-09-17 01:45:46,797 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=<span class=\"literal\">false</span></span><br><span class=\"line\">Welcome to ZooKeeper!</span><br><span class=\"line\">JLine support is enabled</span><br><span class=\"line\">2021-09-17 01:45:47,171 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1171] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181.</span><br><span class=\"line\">2021-09-17 01:45:47,232 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)</span><br><span class=\"line\">2021-09-17 01:45:47,490 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1005] - Socket connection established, initiating session, client: /0:0:0:0:0:0:0:1:55114, server: localhost/0:0:0:0:0:0:0:1:2181</span><br><span class=\"line\">2021-09-17 01:45:47,773 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1438] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, session <span class=\"built_in\">id</span> = 0x4000359a82b0000, negotiated <span class=\"built_in\">timeout</span> = 30000</span><br><span class=\"line\"></span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:SyncConnected <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 0] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[zookeeper]</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 1] create /hi</span><br><span class=\"line\">Created /hi</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 2] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[hi, zookeeper]</span><br></pre></td></tr></table></figure>\n\n<p>进入另一个容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker exec -it 65ab984b726f bash</span></span><br><span class=\"line\">root@zoo2:/apache-zookeeper-3.7.0-bin<span class=\"comment\"># ./bin/zkCli.sh</span></span><br><span class=\"line\">Connecting to localhost:2181</span><br><span class=\"line\">2021-09-17 01:48:04,861 [myid:] - INFO  [main:Environment@98] - Client environment:zookeeper.version=3.7.0-e3704b390a6697bfdf4b0bef79e3da7a4f6bac4b, built on 2021-03-17 09:46 UTC</span><br><span class=\"line\">2021-09-17 01:48:04,869 [myid:] - INFO  [main:Environment@98] - Client environment:host.name=zoo2</span><br><span class=\"line\">2021-09-17 01:48:04,870 [myid:] - INFO  [main:Environment@98] - Client environment:java.version=11.0.12</span><br><span class=\"line\">2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.vendor=Oracle Corporation</span><br><span class=\"line\">2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.home=/usr/local/openjdk-11</span><br><span class=\"line\">2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.class.path=/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/classes:/apache-zookeeper-3.7.0-bin/bin/../build/classes:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/target/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../build/lib/*.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-prometheus-metrics-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-jute-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/zookeeper-3.7.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/snappy-java-1.1.7.7.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-log4j12-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/slf4j-api-1.7.30.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_servlet-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_hotspot-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient_common-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/simpleclient-0.9.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-unix-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-native-epoll-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-transport-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-resolver-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-handler-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-common-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-codec-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/netty-buffer-4.1.59.Final.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/metrics-core-4.1.12.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/log4j-1.2.17.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jline-2.14.6.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-ajax-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-util-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-servlet-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-server-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-security-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-io-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jetty-http-9.4.38.v20210224.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/javax.servlet-api-3.1.0.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-databind-2.10.5.1.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-core-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/jackson-annotations-2.10.5.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/commons-cli-1.4.jar:/apache-zookeeper-3.7.0-bin/bin/../lib/audience-annotations-0.12.0.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-*.jar:/apache-zookeeper-3.7.0-bin/bin/../zookeeper-server/src/main/resources/lib/*.jar:/conf:</span><br><span class=\"line\">2021-09-17 01:48:04,919 [myid:] - INFO  [main:Environment@98] - Client environment:java.library.path=/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:java.io.tmpdir=/tmp</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.name=Linux</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.arch=amd64</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.version=3.10.0-1062.el7.x86_64</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.name=root</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.home=/root</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:user.dir=/apache-zookeeper-3.7.0-bin</span><br><span class=\"line\">2021-09-17 01:48:04,920 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.free=10MB</span><br><span class=\"line\">2021-09-17 01:48:04,924 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.max=247MB</span><br><span class=\"line\">2021-09-17 01:48:04,924 [myid:] - INFO  [main:Environment@98] - Client environment:os.memory.total=15MB</span><br><span class=\"line\">2021-09-17 01:48:04,970 [myid:] - INFO  [main:ZooKeeper@637] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain<span class=\"variable\">$MyWatcher</span>@4c70fda8</span><br><span class=\"line\">2021-09-17 01:48:05,022 [myid:] - INFO  [main:X509Util@77] - Setting -D jdk.tls.rejectClientInitiatedRenegotiation=<span class=\"literal\">true</span> to <span class=\"built_in\">disable</span> client-initiated TLS renegotiation</span><br><span class=\"line\">2021-09-17 01:48:05,027 [myid:] - INFO  [main:ClientCnxnSocket@239] - jute.maxbuffer value is 1048575 Bytes</span><br><span class=\"line\">2021-09-17 01:48:05,087 [myid:] - INFO  [main:ClientCnxn@1726] - zookeeper.request.timeout value is 0. feature enabled=<span class=\"literal\">false</span></span><br><span class=\"line\">Welcome to ZooKeeper!</span><br><span class=\"line\">2021-09-17 01:48:05,464 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1171] - Opening socket connection to server localhost/127.0.0.1:2181.</span><br><span class=\"line\">2021-09-17 01:48:05,465 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1173] - SASL config status: Will not attempt to authenticate using SASL (unknown error)</span><br><span class=\"line\">2021-09-17 01:48:05,622 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1005] - Socket connection established, initiating session, client: /127.0.0.1:53278, server: localhost/127.0.0.1:2181</span><br><span class=\"line\">JLine support is enabled</span><br><span class=\"line\">2021-09-17 01:48:06,168 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn<span class=\"variable\">$SendThread</span>@1438] - Session establishment complete on server localhost/127.0.0.1:2181, session <span class=\"built_in\">id</span> = 0x5000359a80d0000, negotiated <span class=\"built_in\">timeout</span> = 30000</span><br><span class=\"line\"></span><br><span class=\"line\">WATCHER::</span><br><span class=\"line\"></span><br><span class=\"line\">WatchedEvent state:SyncConnected <span class=\"built_in\">type</span>:None path:null</span><br><span class=\"line\">[zk: localhost:2181(CONNECTED) 0] <span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[hi, zookeeper]</span><br></pre></td></tr></table></figure>\n\n<p>本地客户端连接集群：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">zkCli.cmd -server 192.168.192.128:2181,192.168.192.128:2182,192.168.192.128:2183</span><br></pre></td></tr></table></figure>\n\n<p>查看节点信息：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">ls</span> /</span><br><span class=\"line\">[hi, zookeeper]</span><br><span class=\"line\">[zk: 192.168.56.102:2181,192.168.56.102:2182,192.168.56.102:2183(CONNECTED) 1]</span><br></pre></td></tr></table></figure>\n\n<p>停止所有活动容器<code>docker-compose stop</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker-compose stop</span></span><br><span class=\"line\">Stopping dockercomposefolder_zoo1_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Stopping dockercomposefolder_zoo2_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Stopping dockercomposefolder_zoo3_1 ... <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<p>删除所有已停止的容器</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker-compose rm</span></span><br><span class=\"line\">Going to remove dockercomposefolder_zoo1_1, dockercomposefolder_zoo2_1, dockercomposefolder_zoo3_1</span><br><span class=\"line\">Are you sure? [yN] y</span><br><span class=\"line\">Removing dockercomposefolder_zoo1_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Removing dockercomposefolder_zoo2_1 ... <span class=\"keyword\">done</span></span><br><span class=\"line\">Removing dockercomposefolder_zoo3_1 ... <span class=\"keyword\">done</span></span><br></pre></td></tr></table></figure>\n\n<p>更多docker-compose命令：<code>docker-compose --help</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@localhost DockerComposeFolder]<span class=\"comment\"># docker-compose --help</span></span><br><span class=\"line\">Define and run multi-container applications with Docker.</span><br><span class=\"line\"></span><br><span class=\"line\">Usage:</span><br><span class=\"line\">  docker-compose [-f &lt;arg&gt;...] [options] [COMMAND] [ARGS...]</span><br><span class=\"line\">  docker-compose -h|--<span class=\"built_in\">help</span></span><br><span class=\"line\"></span><br><span class=\"line\">Options:</span><br><span class=\"line\">  -f, --file FILE             Specify an alternate compose file</span><br><span class=\"line\">                              (default: docker-compose.yml)</span><br><span class=\"line\">  -p, --project-name NAME     Specify an alternate project name</span><br><span class=\"line\">                              (default: directory name)</span><br><span class=\"line\">  --verbose                   Show more output</span><br><span class=\"line\">  --log-level LEVEL           Set <span class=\"built_in\">log</span> level (DEBUG, INFO, WARNING, ERROR, CRITICAL)</span><br><span class=\"line\">  --no-ansi                   Do not <span class=\"built_in\">print</span> ANSI control characters</span><br><span class=\"line\">  -v, --version               Print version and <span class=\"built_in\">exit</span></span><br><span class=\"line\">  -H, --host HOST             Daemon socket to connect to</span><br><span class=\"line\"></span><br><span class=\"line\">  --tls                       Use TLS; implied by --tlsverify</span><br><span class=\"line\">  --tlscacert CA_PATH         Trust certs signed only by this CA</span><br><span class=\"line\">  --tlscert CLIENT_CERT_PATH  Path to TLS certificate file</span><br><span class=\"line\">  --tlskey TLS_KEY_PATH       Path to TLS key file</span><br><span class=\"line\">  --tlsverify                 Use TLS and verify the remote</span><br><span class=\"line\">  --skip-hostname-check       Don<span class=\"string\">&#x27;t check the daemon&#x27;</span>s hostname against the</span><br><span class=\"line\">                              name specified <span class=\"keyword\">in</span> the client certificate</span><br><span class=\"line\">  --project-directory PATH    Specify an alternate working directory</span><br><span class=\"line\">                              (default: the path of the Compose file)</span><br><span class=\"line\">  --compatibility             If <span class=\"built_in\">set</span>, Compose will attempt to convert keys</span><br><span class=\"line\">                              <span class=\"keyword\">in</span> v3 files to their non-Swarm equivalent</span><br><span class=\"line\"></span><br><span class=\"line\">Commands:</span><br><span class=\"line\">  build              Build or rebuild services</span><br><span class=\"line\">  bundle             Generate a Docker bundle from the Compose file</span><br><span class=\"line\">  config             Validate and view the Compose file</span><br><span class=\"line\">  create             Create services</span><br><span class=\"line\">  down               Stop and remove containers, networks, images, and volumes</span><br><span class=\"line\">  events             Receive real time events from containers</span><br><span class=\"line\">  <span class=\"built_in\">exec</span>               Execute a <span class=\"built_in\">command</span> <span class=\"keyword\">in</span> a running container</span><br><span class=\"line\">  <span class=\"built_in\">help</span>               Get <span class=\"built_in\">help</span> on a <span class=\"built_in\">command</span></span><br><span class=\"line\">  images             List images</span><br><span class=\"line\">  <span class=\"built_in\">kill</span>               Kill containers</span><br><span class=\"line\">  logs               View output from containers</span><br><span class=\"line\">  pause              Pause services</span><br><span class=\"line\">  port               Print the public port <span class=\"keyword\">for</span> a port binding</span><br><span class=\"line\">  ps                 List containers</span><br><span class=\"line\">  pull               Pull service images</span><br><span class=\"line\">  push               Push service images</span><br><span class=\"line\">  restart            Restart services</span><br><span class=\"line\">  <span class=\"built_in\">rm</span>                 Remove stopped containers</span><br><span class=\"line\">  run                Run a one-off <span class=\"built_in\">command</span></span><br><span class=\"line\">  scale              Set number of containers <span class=\"keyword\">for</span> a service</span><br><span class=\"line\">  start              Start services</span><br><span class=\"line\">  stop               Stop services</span><br><span class=\"line\">  top                Display the running processes</span><br><span class=\"line\">  unpause            Unpause services</span><br><span class=\"line\">  up                 Create and start containers</span><br><span class=\"line\">  version            Show the Docker-Compose version information</span><br></pre></td></tr></table></figure>\n\n\n\n<p>Reference:</p>\n<blockquote>\n<p><a href=\"https://www.cnblogs.com/LUA123/p/11428113.html\">https://www.cnblogs.com/LUA123/p/11428113.html</a></p>\n<p><a href=\"https://www.runoob.com/w3cnote/zookeeper-linux-cluster.html\">https://www.runoob.com/w3cnote/zookeeper-linux-cluster.html</a></p>\n</blockquote>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cl2qzftgp000313nocmxk7cm2","category_id":"cl2qzftgt000713nogch22268","_id":"cl2qzfth1000k13no246i29tp"},{"post_id":"cl2qzftgu000913no5ec64wd7","category_id":"cl2qzftgy000g13no09egamdl","_id":"cl2qzfth5000r13noda2nel0m"},{"post_id":"cl2qzftgv000b13nognza5g87","category_id":"cl2qzftgy000g13no09egamdl","_id":"cl2qzfth6000w13no7p03a269"},{"post_id":"cl2qzftgx000f13no9p0phptv","category_id":"cl2qzfth4000q13no2u2y1l4s","_id":"cl2qzfth8001213noc8g56ahf"},{"post_id":"cl2qzftgy000h13no9tft7s94","category_id":"cl2qzfth6000x13no23061hyn","_id":"cl2qzftha001913no82ua3zmy"},{"post_id":"cl2qzfth0000j13no1dhocivl","category_id":"cl2qzfth6000x13no23061hyn","_id":"cl2qzfthc001f13noh8gi3q05"},{"post_id":"cl2qzfth4000p13no96mm355q","category_id":"cl2qzfth6000x13no23061hyn","_id":"cl2qzfthe001k13noflnx4ten"},{"post_id":"cl2qzfth5000t13nohx02gqy7","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthg001s13nofhcmbrfb"},{"post_id":"cl2qzfth6000v13noc3sfcdp7","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthi001y13no1klm6x3n"},{"post_id":"cl2qzfth7000z13no984541p3","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthl002313no0m9n4nbk"},{"post_id":"cl2qzfthi002013nocfhihapj","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthn002813nob56g1guj"},{"post_id":"cl2qzfth8001113no89dz1vwj","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftho002d13no015j33xt"},{"post_id":"cl2qzfthk002113no26ve3bcd","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthp002f13noc4oe1k6b"},{"post_id":"cl2qzfthm002613noaz89fn27","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthq002k13no7ctx62gv"},{"post_id":"cl2qzfth9001513noe9gb1q6x","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthq002m13no61oa8o8g"},{"post_id":"cl2qzfthm002713noc60o9eko","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfths002r13nob4451702"},{"post_id":"cl2qzfthn002c13no10505wdd","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftht002t13no3dax09qv"},{"post_id":"cl2qzfth9001613no7ao2et1o","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthu002y13no5y89f97t"},{"post_id":"cl2qzftho002e13no7zyo2n7u","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthu003013nofakk1lg7"},{"post_id":"cl2qzfthp002j13no5ut6h85x","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthw003513no66fh6nqs"},{"post_id":"cl2qzftha001b13nocz4ogp73","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthw003713noa7ej9mv7"},{"post_id":"cl2qzfthq002l13no4nupbdoo","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthx003c13no4h4bcq2h"},{"post_id":"cl2qzfthr002q13no539w89c9","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthy003e13nobpuc5kf7"},{"post_id":"cl2qzfthb001c13nobb2sgl2a","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfthz003j13no6k4pb6vw"},{"post_id":"cl2qzfths002s13no010y0z6t","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfti0003l13no6eg7dnub"},{"post_id":"cl2qzftht002x13nodfnj9dnn","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfti1003p13no5991fjwf"},{"post_id":"cl2qzfthc001g13no1q5w3jmn","category_id":"cl2qzftht002u13nobcasdppd","_id":"cl2qzfti2003s13no5oerbn4m"},{"post_id":"cl2qzfthu002z13no2wy0df2m","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfti3003w13no6i2f6hmd"},{"post_id":"cl2qzfthv003413no8lqqarrq","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfti4003z13nodrhqh9vm"},{"post_id":"cl2qzfthd001i13no2h5yfzgu","category_id":"cl2qzftht002u13nobcasdppd","_id":"cl2qzfti5004313no9j9tciry"},{"post_id":"cl2qzfthw003613no8yus3vnm","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfti6004613nobyde6pym"},{"post_id":"cl2qzfthx003b13no1xkj8sgn","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfti6004913nocz7rcil0"},{"post_id":"cl2qzfthe001l13no4cdohagy","category_id":"cl2qzfthw003913nob2q9f1l4","_id":"cl2qzfti7004d13nobryn7kjz"},{"post_id":"cl2qzfthz003i13no7s967749","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzfti8004g13noeku8alio"},{"post_id":"cl2qzfthf001o13no7u9u8q2j","category_id":"cl2qzfthw003913nob2q9f1l4","_id":"cl2qzfti9004k13no05a9dvxk"},{"post_id":"cl2qzfthf001q13noagd2en4c","category_id":"cl2qzfthw003913nob2q9f1l4","_id":"cl2qzftia004m13nodv7hagy0"},{"post_id":"cl2qzfthg001u13no611o7rrc","category_id":"cl2qzfti2003t13no9b85d39c","_id":"cl2qzftib004r13no4ekfe968"},{"post_id":"cl2qzfti5004513no5l8c6rqi","category_id":"cl2qzftgy000g13no09egamdl","_id":"cl2qzftic004t13noebgef2v3"},{"post_id":"cl2qzfthh001w13nofsu6b1fa","category_id":"cl2qzfti4004013no0id14ibz","_id":"cl2qzftid004x13noa6rs0b7l"},{"post_id":"cl2qzfti7004c13no50hadk03","category_id":"cl2qzfti6004a13no6zuz4stf","_id":"cl2qzftie005013no0ukj5vmc"},{"post_id":"cl2qzfthz003k13nob57mapd6","category_id":"cl2qzfti6004a13no6zuz4stf","_id":"cl2qzftif005413noeb5f90ls"},{"post_id":"cl2qzfti8004f13no8q0iavid","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftig005713no2t1i02ky"},{"post_id":"cl2qzfti9004j13no7w0247s2","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftih005b13no5zorfzla"},{"post_id":"cl2qzfti1003o13no4n2y0blc","category_id":"cl2qzfti6004a13no6zuz4stf","_id":"cl2qzftih005e13noezjmffj8"},{"post_id":"cl2qzftia004l13nof0l8g5q4","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftik005j13nock80dwrb"},{"post_id":"cl2qzftib004q13nofn7ob2fk","category_id":"cl2qzfti6004a13no6zuz4stf","_id":"cl2qzftik005m13no2o2p8irm"},{"post_id":"cl2qzfti1003r13nohdxc0ner","category_id":"cl2qzfti6004a13no6zuz4stf","_id":"cl2qzftim005r13no72ap8b97"},{"post_id":"cl2qzftib004s13no8wiagwn4","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftim005t13nocbt49ce0"},{"post_id":"cl2qzftid004w13noghayfvxa","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftin005x13nodcm6btbb"},{"post_id":"cl2qzfti2003v13no1pqa6154","category_id":"cl2qzfti6004a13no6zuz4stf","_id":"cl2qzftin005z13no2meb5nq2"},{"post_id":"cl2qzftif005313no8n873yog","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftio006213no9b3acmov"},{"post_id":"cl2qzfti3003y13no3h7m90n9","category_id":"cl2qzfti6004a13no6zuz4stf","_id":"cl2qzftio006413no4b9pc5vu"},{"post_id":"cl2qzftig005a13no6noag53u","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftio006613no6wqo595n"},{"post_id":"cl2qzfti4004213nohmckajc7","category_id":"cl2qzfti6004a13no6zuz4stf","_id":"cl2qzftio006813no87e0f81z"},{"post_id":"cl2qzftih005d13noa95kfk19","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftip006a13no19vyc46d"},{"post_id":"cl2qzftii005i13nog2i47u6m","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftip006c13no9w7aeztz"},{"post_id":"cl2qzfti6004813no9a7k8f86","category_id":"cl2qzfti6004a13no6zuz4stf","_id":"cl2qzftip006e13no9yvq52gv"},{"post_id":"cl2qzftik005l13nof3bgermc","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftip006g13no4j9capwd"},{"post_id":"cl2qzftil005q13noh9jv383b","category_id":"cl2qzftil005n13no7resbm4e","_id":"cl2qzftiq006i13no9u1z16ft"},{"post_id":"cl2qzftid004z13no5sbybwuk","category_id":"cl2qzftil005n13no7resbm4e","_id":"cl2qzftiq006k13noh4m9cyfg"},{"post_id":"cl2qzftif005613nodsb4bnv3","category_id":"cl2qzftil005n13no7resbm4e","_id":"cl2qzftiq006m13nof8b5g3jj"},{"post_id":"cl2qzftj3008413no00w6a1le","category_id":"cl2qzfthw003913nob2q9f1l4","_id":"cl2qzftj4008813no3qss44vk"},{"post_id":"cl2qzftj3008513nogz8efcd2","category_id":"cl2qzfthc001e13no1q5yhmfx","_id":"cl2qzftj4008913noa8plald4"},{"post_id":"cl2qzftj5008b13nohds1cb2o","category_id":"cl2qzftgy000g13no09egamdl","_id":"cl2qzftj6008d13nodk4vduwm"},{"post_id":"cl2qzftj8008f13no1ubz98r4","category_id":"cl2qzftht002u13nobcasdppd","_id":"cl2qzftj9008h13nod2xv5rdr"}],"PostTag":[{"post_id":"cl2qzftgl000113no075r7gte","tag_id":"cl2qzftgq000413no4w3b1x8r","_id":"cl2qzftgw000d13nod3il8hl4"},{"post_id":"cl2qzftgp000313nocmxk7cm2","tag_id":"cl2qzftgw000c13no6vkz2xuc","_id":"cl2qzfth1000l13no71g6dv7d"},{"post_id":"cl2qzftgs000613nod0oh2si9","tag_id":"cl2qzfth0000i13no207id8re","_id":"cl2qzfth5000s13no508f0gkm"},{"post_id":"cl2qzftgu000913no5ec64wd7","tag_id":"cl2qzfth3000o13nobfdrb3y1","_id":"cl2qzfth7000y13nog4qhatnz"},{"post_id":"cl2qzftgv000b13nognza5g87","tag_id":"cl2qzfth0000i13no207id8re","_id":"cl2qzfth8001313no9zoq8oic"},{"post_id":"cl2qzftgx000f13no9p0phptv","tag_id":"cl2qzfth7001013nof7e09l47","_id":"cl2qzftha001a13no6t454lyw"},{"post_id":"cl2qzftgy000h13no9tft7s94","tag_id":"cl2qzftha001713nof9ti186p","_id":"cl2qzfthd001h13no7ogg3okg"},{"post_id":"cl2qzfth0000j13no1dhocivl","tag_id":"cl2qzfthc001d13no1uq95sy2","_id":"cl2qzfthf001n13no94kbb0gd"},{"post_id":"cl2qzfth3000n13no7h2k8nlg","tag_id":"cl2qzfthd001j13nogyu061yl","_id":"cl2qzfthg001t13no6yopg3ow"},{"post_id":"cl2qzfth4000p13no96mm355q","tag_id":"cl2qzftha001713nof9ti186p","_id":"cl2qzfthi001z13no27avg5wz"},{"post_id":"cl2qzfth5000t13nohx02gqy7","tag_id":"cl2qzfthh001v13no74z3g2b5","_id":"cl2qzfthl002513nogwj56q0o"},{"post_id":"cl2qzfth6000v13noc3sfcdp7","tag_id":"cl2qzfthh001v13no74z3g2b5","_id":"cl2qzfthn002b13no3p3hf13m"},{"post_id":"cl2qzfth7000z13no984541p3","tag_id":"cl2qzfthh001v13no74z3g2b5","_id":"cl2qzfthp002i13no2baz1eyl"},{"post_id":"cl2qzfth8001113no89dz1vwj","tag_id":"cl2qzfthh001v13no74z3g2b5","_id":"cl2qzfthr002p13no9hv41p2n"},{"post_id":"cl2qzfth9001513noe9gb1q6x","tag_id":"cl2qzfthh001v13no74z3g2b5","_id":"cl2qzftht002w13no26mm93ji"},{"post_id":"cl2qzfth9001613no7ao2et1o","tag_id":"cl2qzfthh001v13no74z3g2b5","_id":"cl2qzfthv003313no76sahfkr"},{"post_id":"cl2qzftha001b13nocz4ogp73","tag_id":"cl2qzfthh001v13no74z3g2b5","_id":"cl2qzfthx003a13no3e5ick7h"},{"post_id":"cl2qzfthb001c13nobb2sgl2a","tag_id":"cl2qzfthh001v13no74z3g2b5","_id":"cl2qzfthz003h13no6vyq59aq"},{"post_id":"cl2qzfthc001g13no1q5w3jmn","tag_id":"cl2qzfthy003f13no1kbv6658","_id":"cl2qzfti1003q13no929yg8j1"},{"post_id":"cl2qzfthd001i13no2h5yfzgu","tag_id":"cl2qzfti0003m13no87px51bi","_id":"cl2qzfti3003x13noe6z7c686"},{"post_id":"cl2qzfthe001l13no4cdohagy","tag_id":"cl2qzfti2003u13no0h57fl9x","_id":"cl2qzfti5004413no8g0b9c1z"},{"post_id":"cl2qzfthf001o13no7u9u8q2j","tag_id":"cl2qzfti2003u13no0h57fl9x","_id":"cl2qzfti7004b13no4nmtgoku"},{"post_id":"cl2qzfthf001q13noagd2en4c","tag_id":"cl2qzfti2003u13no0h57fl9x","_id":"cl2qzfti9004i13noblrnaak3"},{"post_id":"cl2qzfthg001u13no611o7rrc","tag_id":"cl2qzfti8004e13nofhgyd64w","_id":"cl2qzftib004p13no1s2pebcv"},{"post_id":"cl2qzfthh001w13nofsu6b1fa","tag_id":"cl2qzftia004n13no05kg9abv","_id":"cl2qzftid004y13nob3lqbszu"},{"post_id":"cl2qzfthi002013nocfhihapj","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftif005513no547tcmjp"},{"post_id":"cl2qzfthk002113no26ve3bcd","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftih005c13nocic14218"},{"post_id":"cl2qzftig005a13no6noag53u","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftii005h13nobvjbhcsn"},{"post_id":"cl2qzfthm002613noaz89fn27","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftik005k13nogc46acdj"},{"post_id":"cl2qzftih005d13noa95kfk19","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftil005p13no98f9bh99"},{"post_id":"cl2qzftii005i13nog2i47u6m","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftim005s13no63wm528t"},{"post_id":"cl2qzfthm002713noc60o9eko","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftim005w13noem9ndtb5"},{"post_id":"cl2qzftik005l13nof3bgermc","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftin005y13no5jbsbggq"},{"post_id":"cl2qzfthn002c13no10505wdd","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftin006113no8zcl1f44"},{"post_id":"cl2qzftho002e13no7zyo2n7u","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftio006313no7r65677c"},{"post_id":"cl2qzfthp002j13no5ut6h85x","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftio006713no3v2fd9fq"},{"post_id":"cl2qzfthq002l13no4nupbdoo","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftip006b13nocadh6zw3"},{"post_id":"cl2qzfthr002q13no539w89c9","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftip006f13no2wc5f81i"},{"post_id":"cl2qzfths002s13no010y0z6t","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftiq006j13no14c516dt"},{"post_id":"cl2qzftht002x13nodfnj9dnn","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftiq006n13nofx9m15ac"},{"post_id":"cl2qzfthu002z13no2wy0df2m","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftir006p13noggxoc6uq"},{"post_id":"cl2qzfthv003413no8lqqarrq","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftir006r13no3wm2edc2"},{"post_id":"cl2qzfthw003613no8yus3vnm","tag_id":"cl2qzftic004v13no9pj8gr16","_id":"cl2qzftir006t13nobk5263fq"},{"post_id":"cl2qzfthx003b13no1xkj8sgn","tag_id":"cl2qzftir006s13nodjcl3ql9","_id":"cl2qzftis006v13nochrq0fb1"},{"post_id":"cl2qzfthy003d13nodhgofhex","tag_id":"cl2qzftir006u13no39ela4hn","_id":"cl2qzftis006x13nohuab2yc0"},{"post_id":"cl2qzfthz003i13no7s967749","tag_id":"cl2qzftir006s13nodjcl3ql9","_id":"cl2qzftis006z13noghap7k4c"},{"post_id":"cl2qzfthz003k13nob57mapd6","tag_id":"cl2qzftis006y13no6oni9aes","_id":"cl2qzftit007113no5iqndxaz"},{"post_id":"cl2qzfti1003o13no4n2y0blc","tag_id":"cl2qzftis006y13no6oni9aes","_id":"cl2qzftit007313nogftm4vfi"},{"post_id":"cl2qzfti1003r13nohdxc0ner","tag_id":"cl2qzftis006y13no6oni9aes","_id":"cl2qzftit007513no4r0h2pjw"},{"post_id":"cl2qzfti2003v13no1pqa6154","tag_id":"cl2qzftis006y13no6oni9aes","_id":"cl2qzftiu007813nohfq6966w"},{"post_id":"cl2qzfti2003v13no1pqa6154","tag_id":"cl2qzftit007613no02wedf6n","_id":"cl2qzftiu007913nodnsf52jv"},{"post_id":"cl2qzfti3003y13no3h7m90n9","tag_id":"cl2qzftis006y13no6oni9aes","_id":"cl2qzftiu007b13nogua022vh"},{"post_id":"cl2qzfti4004213nohmckajc7","tag_id":"cl2qzftis006y13no6oni9aes","_id":"cl2qzftiv007d13no8iogfec2"},{"post_id":"cl2qzfti5004513no5l8c6rqi","tag_id":"cl2qzftiu007c13no0cape3ql","_id":"cl2qzftiv007f13no349lfeme"},{"post_id":"cl2qzfti6004813no9a7k8f86","tag_id":"cl2qzftiv007e13noarb28k1v","_id":"cl2qzftiv007h13noe5shf6lp"},{"post_id":"cl2qzfti7004c13no50hadk03","tag_id":"cl2qzftiv007e13noarb28k1v","_id":"cl2qzftiv007j13noa0pedn8x"},{"post_id":"cl2qzfti8004f13no8q0iavid","tag_id":"cl2qzftiv007i13no10fl9uf6","_id":"cl2qzftiw007l13nohxgff72o"},{"post_id":"cl2qzfti9004j13no7w0247s2","tag_id":"cl2qzftiv007i13no10fl9uf6","_id":"cl2qzftix007n13no4cvs6i73"},{"post_id":"cl2qzftia004l13nof0l8g5q4","tag_id":"cl2qzftiv007i13no10fl9uf6","_id":"cl2qzftix007p13nofeax8clh"},{"post_id":"cl2qzftia004l13nof0l8g5q4","tag_id":"cl2qzfth3000o13nobfdrb3y1","_id":"cl2qzftiy007q13no8gus9n7s"},{"post_id":"cl2qzftib004q13nofn7ob2fk","tag_id":"cl2qzftiv007e13noarb28k1v","_id":"cl2qzftiy007s13no23tmdznc"},{"post_id":"cl2qzftib004s13no8wiagwn4","tag_id":"cl2qzftiv007i13no10fl9uf6","_id":"cl2qzftiy007u13nodm0h4y0r"},{"post_id":"cl2qzftid004w13noghayfvxa","tag_id":"cl2qzftiv007i13no10fl9uf6","_id":"cl2qzftiz007w13no9fvs8vs3"},{"post_id":"cl2qzftid004z13no5sbybwuk","tag_id":"cl2qzftiz007v13no9us544hj","_id":"cl2qzftj0007y13nofi2i3tfw"},{"post_id":"cl2qzftif005313no8n873yog","tag_id":"cl2qzftiv007i13no10fl9uf6","_id":"cl2qzftj0008013no9t1j5kzc"},{"post_id":"cl2qzftif005613nodsb4bnv3","tag_id":"cl2qzftiz007v13no9us544hj","_id":"cl2qzftj0008213nocqelfx9k"},{"post_id":"cl2qzftil005q13noh9jv383b","tag_id":"cl2qzftiz007v13no9us544hj","_id":"cl2qzftj1008313no8jax2yws"},{"post_id":"cl2qzftj3008413no00w6a1le","tag_id":"cl2qzfti2003u13no0h57fl9x","_id":"cl2qzftj4008613no8agnfntm"},{"post_id":"cl2qzftj3008513nogz8efcd2","tag_id":"cl2qzftj4008713nobwpq8wp5","_id":"cl2qzftj4008a13no2ge3bnx7"},{"post_id":"cl2qzftj5008b13nohds1cb2o","tag_id":"cl2qzftj6008c13no2k780esm","_id":"cl2qzftj6008e13no7n1x0n2l"},{"post_id":"cl2qzftj8008f13no1ubz98r4","tag_id":"cl2qzftj9008g13no2o4t7cza","_id":"cl2qzftj9008j13no5i35hmz3"},{"post_id":"cl2qzftj8008f13no1ubz98r4","tag_id":"cl2qzftj9008i13no9z0qe916","_id":"cl2qzftj9008k13no3z23ff2e"}],"Tag":[{"name":"hexo","_id":"cl2qzftgq000413no4w3b1x8r"},{"name":"idea","_id":"cl2qzftgw000c13no6vkz2xuc"},{"name":"mac","_id":"cl2qzfth0000i13no207id8re"},{"name":"todo","_id":"cl2qzfth3000o13nobfdrb3y1"},{"name":"sonarqube","_id":"cl2qzfth7001013nof7e09l47"},{"name":"swagger","_id":"cl2qzftha001713nof9ti186p"},{"name":"openapi","_id":"cl2qzfthc001d13no1uq95sy2"},{"name":"项目开发环境","_id":"cl2qzfthd001j13nogyu061yl"},{"name":"设计模式","_id":"cl2qzfthh001v13no74z3g2b5"},{"name":"Docker","_id":"cl2qzfthy003f13no1kbv6658"},{"name":"Dockerfile","_id":"cl2qzfti0003m13no87px51bi"},{"name":"gauge","_id":"cl2qzfti2003u13no0h57fl9x"},{"name":"Git","_id":"cl2qzfti8004e13nofhgyd64w"},{"name":"Go","_id":"cl2qzftia004n13no05kg9abv"},{"name":"guava","_id":"cl2qzftic004v13no9pj8gr16"},{"name":"spi","_id":"cl2qzftir006s13nodjcl3ql9"},{"name":"定时任务","_id":"cl2qzftir006u13no39ela4hn"},{"name":"linux","_id":"cl2qzftis006y13no6oni9aes"},{"name":"shell","_id":"cl2qzftit007613no02wedf6n"},{"name":"MQ","_id":"cl2qzftiu007c13no0cape3ql"},{"name":"curl","_id":"cl2qzftiv007e13noarb28k1v"},{"name":"springBoot","_id":"cl2qzftiv007i13no10fl9uf6"},{"name":"plantuml","_id":"cl2qzftiz007v13no9us544hj"},{"name":"spring","_id":"cl2qzftj4008713nobwpq8wp5"},{"name":"rabbitmq","_id":"cl2qzftj6008c13no2k780esm"},{"name":"docker","_id":"cl2qzftj9008g13no2o4t7cza"},{"name":"zookeeper","_id":"cl2qzftj9008i13no9z0qe916"}]}}